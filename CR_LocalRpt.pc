




#include "CO_HostStructdef.h"

EXEC SQL INCLUDE SQLCA.H;


int CR_Def_LRErrEntCursor(DEBUG_INFO_STRUCT_H **l_debug_info_ptr)
{
	EXEC SQL BEGIN DECLARE SECTION;
		struct sqlca sqlca;
	EXEC SQL END DECLARE SECTION;
	sqlca.sqlcode = 0;
	
	#ifdef SYS_DEBUG
		fprintf(APL_OUT_FILE,"Entered CR_Def_LRErrEntCursor\n");
	#endif

	EXEC SQL DECLARE errent_curs CURSOR FOR
	SELECT * FROM DL_LOCALREPPROC where R_CODE = 2
	ORDER by client,IDENTIY_NO;

	IS_ANY_ORA_ERROR;
	
	EXEC SQL OPEN errent_curs;

	IS_ANY_ORA_ERROR;

	APL_GOBACK_SUCCESS	
	
	RETURN_SUCCESS :
	{
		#ifdef SYS_DEBUG
			fprintf(APL_OUT_FILE,"Exiting CR_Def_LRErrEntCursor successfully\n");
		#endif
		return(APL_SUCCESS);
	}

	RETURN_FAILURE :
	{
		#ifdef SYS_DEBUG
			fprintf(APL_OUT_FILE,"Exiting CR_Def_LRErrEntCursor with errors\n");
		#endif
		return(APL_FAILURE);
	}
}	



int CR_Rtv_LRErrEntCursor( short *p_eocursor, 
								DL_LOCALREPPROC_STRUCT_H *l_dl_loc_repproc_struct_h, 
								DL_LOCALREPPROC_STRUCT_I *l_dl_localrepproc_struct_ia, 
								DEBUG_INFO_STRUCT_H **l_debug_info_ptr) 
{

	EXEC SQL BEGIN DECLARE SECTION;
	EXEC SQL VAR l_dl_loc_repproc_struct_h->h_dl_client IS STRING;
	EXEC SQL VAR l_dl_loc_repproc_struct_h->h_indentity_no IS STRING;
	EXEC SQL VAR l_dl_loc_repproc_struct_h->h_instr_code IS STRING;
	EXEC SQL VAR l_dl_loc_repproc_struct_h->h_ctclt IS STRING;
	EXEC SQL VAR l_dl_loc_repproc_struct_h->h_dbclt IS STRING;
	EXEC SQL VAR l_dl_loc_repproc_struct_h->h_domcpclt_cd IS STRING;
	EXEC SQL VAR l_dl_loc_repproc_struct_h->h_ord_ind IS STRING;
	EXEC SQL VAR l_dl_loc_repproc_struct_h->h_lrdltype IS STRING;
	EXEC SQL VAR l_dl_loc_repproc_struct_h->h_dealcd IS STRING;
	EXEC SQL VAR l_dl_loc_repproc_struct_h->h_reset_ind IS STRING;
	EXEC SQL END DECLARE SECTION;
	
	EXEC SQL BEGIN DECLARE SECTION;
		struct sqlca sqlca;
	EXEC SQL END DECLARE SECTION;
	sqlca.sqlcode = 0;
	
	#ifdef SYS_DEBUG
		fprintf(APL_OUT_FILE,"Entered CR_Rtv_LRErrEntCursor\n");
	#endif

	EXEC SQL FETCH errent_curs INTO :l_dl_loc_repproc_struct_h:l_dl_localrepproc_struct_ia;
	
	IS_ANY_ORA_ERROR;
	
	if (sqlca.sqlcode == 1403)
	{
		*p_eocursor = 1;
	}


	APL_GOBACK_SUCCESS

	RETURN_SUCCESS :
	{
		#ifdef SYS_DEBUG
			fprintf(APL_OUT_FILE,"Exiting CR_Rtv_LRErrEntCursor successfully\n");
		#endif
		return(APL_SUCCESS);
	}

	RETURN_FAILURE :
	{
		#ifdef SYS_DEBUG
			fprintf(APL_OUT_FILE,"Exiting CR_Rtv_LRErrEntCursor with errors\n");
		#endif
		return(APL_FAILURE);
	}
}



int CR_Proc_LRErrWordCursor(  DL_LOCALREPPROC_STRUCT_H *l_dl_loc_repproc_struct_h,
								char *p_wording , 
								char *p_dclient, 
								char *p_cclient, 
								DEBUG_INFO_STRUCT_H **l_debug_info_ptr) 
{
	char h_desc[66] = APL_NULL_STRING;
	char h_desc_a[21] = APL_NULL_STRING;
	char h_desc_b[21] = APL_NULL_STRING;
	char h_DB100[20] = APL_NULL_STRING;
	char h_CT100[20] = APL_NULL_STRING;
	char h_clt_class[3] = APL_NULL_STRING;
	short i_desc;
	short i_desc_a;
	short i_desc_b;
	short i_DB100;
	short i_CT100;
	char chr_p_ndsdt[APL_DATE_LEN] = APL_NULL_STRING;
	char chr_p_ndsbldt[APL_DATE_LEN] = APL_NULL_STRING;

   EXEC SQL BEGIN DECLARE SECTION;
   EXEC SQL VAR l_dl_loc_repproc_struct_h->h_dl_client IS STRING;
   EXEC SQL VAR l_dl_loc_repproc_struct_h->h_indentity_no IS STRING;
   EXEC SQL VAR l_dl_loc_repproc_struct_h->h_instr_code IS STRING;
   EXEC SQL VAR l_dl_loc_repproc_struct_h->h_ctclt IS STRING;
   EXEC SQL VAR l_dl_loc_repproc_struct_h->h_dbclt IS STRING;
   EXEC SQL VAR l_dl_loc_repproc_struct_h->h_domcpclt_cd IS STRING;
   EXEC SQL VAR l_dl_loc_repproc_struct_h->h_ord_ind IS STRING;
   EXEC SQL VAR l_dl_loc_repproc_struct_h->h_lrdltype IS STRING;
   EXEC SQL VAR l_dl_loc_repproc_struct_h->h_dealcd IS STRING;
   EXEC SQL VAR l_dl_loc_repproc_struct_h->h_reset_ind IS STRING;
	
	EXEC SQL VAR h_desc 		IS STRING;
	EXEC SQL VAR h_desc_a 		IS STRING;
	EXEC SQL VAR h_desc_b 		IS STRING;
	EXEC SQL VAR h_DB100	 		IS STRING;
	EXEC SQL VAR h_CT100	 		IS STRING;
	EXEC SQL VAR h_clt_class	IS STRING;
	EXEC SQL END DECLARE SECTION;
	
	EXEC SQL BEGIN DECLARE SECTION;
		struct sqlca sqlca;
	EXEC SQL END DECLARE SECTION;
	sqlca.sqlcode = 0;
	
	#ifdef SYS_DEBUG
		fprintf(APL_OUT_FILE,"Entered CR_Proc_LRErrWordCursor\n");
	#endif

	EXEC SQL DECLARE geterrword_curs CURSOR FOR
				SELECT DET,
						 DESC_A,
						 DESC_B,
						 DEBIT_IND_100,
						 CREDIT_IND_100
		FROM DL_LOCALREPSPEC 
		WHERE 		DEALCLASS 	 = :l_dl_loc_repproc_struct_h->h_lrdltype AND
						deal_cd 	 = :l_dl_loc_repproc_struct_h->h_dealcd AND
						DT_FIELD	 = :l_dl_loc_repproc_struct_h->h_dtfld;

	EXEC SQL OPEN geterrword_curs;
	IS_ANY_ORA_ERROR;

	EXEC SQL FETCH geterrword_curs 
				INTO 	 :h_desc:i_desc, 
					  	 :h_desc_a:i_desc_a, 
					 	 :h_desc_b:i_desc_b,
						 :h_DB100:i_DB100,
						 :h_CT100:i_CT100;
	
	IS_ANY_ORA_ERROR;

	EXEC SQL CLOSE geterrword_curs;
	IS_ANY_ORA_ERROR;

	if (strcmp(p_dclient,APL_NULL_STRING))
	{
		strcpy(p_dclient,l_dl_loc_repproc_struct_h->h_dbclt);

		if (i_DB100 != -1)
		{
			if(!strcmp(h_DB100,"DOMESTIC_CPCLT"))
			{
				EXEC SQL SELECT CLN_CLAS INTO :h_clt_class FROM MT_CLIENT
				WHERE cln_code = :l_dl_loc_repproc_struct_h->h_domcpclt_cd;

				IS_ANY_ORA_ERROR;

				if(strcmp(h_clt_class,"2"))
				{
					strcat(p_dclient,"/");
					strcat(p_dclient,l_dl_loc_repproc_struct_h->h_dl_client);
				}
			}
			
			if(!strcmp(h_DB100,"CLIENT"))
			{
				EXEC SQL SELECT CLN_CLAS INTO :h_clt_class FROM MT_CLIENT
				WHERE cln_Code = :l_dl_loc_repproc_struct_h->h_dl_client;

				IS_ANY_ORA_ERROR;
				
				if(strcmp(h_clt_class,"2"))
				{
					strcat(p_dclient,"/");
					strcat(p_dclient,l_dl_loc_repproc_struct_h->h_dl_client);
				}
			}		

			if(!strcmp(h_DB100,"CP_CLT"))
			{
				EXEC SQL SELECT CLN_CLAS INTO :h_clt_class FROM MT_CLIENT
				WHERE cln_code = :l_dl_loc_repproc_struct_h->h_domcpclt_cd;

				IS_ANY_ORA_ERROR;

				if(strcmp(h_clt_class,"2"))
				{
					strcat(p_dclient,"/");
					strcat(p_dclient,l_dl_loc_repproc_struct_h->h_dl_client);
				}
			}
		}

		strcpy(p_cclient,l_dl_loc_repproc_struct_h->h_ctclt);

		if (i_CT100 != -1)
		{
			if(!strcmp(h_CT100,"DOMESTIC_CPCLT"))
			{
				EXEC SQL SELECT CLN_CLAS INTO :h_clt_class FROM MT_CLIENT
				WHERE cln_code = :l_dl_loc_repproc_struct_h->h_domcpclt_cd;

				IS_ANY_ORA_ERROR;

				if(strcmp(h_clt_class,"2"))
				{
					strcat(p_cclient,"/");
					strcat(p_cclient,l_dl_loc_repproc_struct_h->h_dl_client);
				}
			}

			if(!strcmp(h_CT100,"CLIENT"))
			{
				EXEC SQL SELECT CLN_CLAS INTO :h_clt_class FROM MT_CLIENT
				WHERE cln_code = :l_dl_loc_repproc_struct_h->h_dl_client;

				IS_ANY_ORA_ERROR;

				if(strcmp(h_clt_class,"2"))
				{
					strcat(p_cclient,"/");
					strcat(p_cclient,l_dl_loc_repproc_struct_h->h_dl_client);
				}
			}

			if(!strcmp(h_CT100,"CP_CLT"))
			{
				EXEC SQL SELECT CLN_CLAS INTO :h_clt_class FROM MT_CLIENT
				WHERE cln_code = :l_dl_loc_repproc_struct_h->h_domcpclt_cd;

				IS_ANY_ORA_ERROR;

				if(strcmp(h_clt_class,"2"))
				{
					strcat(p_cclient,"/");
					strcat(p_cclient,l_dl_loc_repproc_struct_h->h_dl_client);
				}
			}
		}
	}
	strcpy(p_wording,h_desc);
	
	if (i_desc_a != -1)
	{
		strcat(p_wording," - ");

		if (!strcmp(h_desc_a,"NDS_DATE") || !strcmp(h_desc_a,"NDS_BLK_DT"))
		{
			if (APL_FAILURE == CR_Def_LRErrTxnCursor(l_dl_loc_repproc_struct_h->h_dl_client,
															l_dl_loc_repproc_struct_h->h_indentity_no,
															l_debug_info_ptr))
			{
				APL_GOBACK_FAIL
			}

			if (APL_FAILURE == CR_Rtv_LRErrTxnCursor(chr_p_ndsdt, chr_p_ndsbldt, l_debug_info_ptr))
			{
				APL_GOBACK_FAIL
			}

			if (!strcmp(h_desc_a,"NDS_DATE"))
			{
				strcat(p_wording,chr_p_ndsdt);
			}

			if (!strcmp(h_desc_a,"NDS_BLK_DT"))
			{
				strcat(p_wording,chr_p_ndsbldt);
			}
		}

		if (!strcmp(h_desc_a,"CLIENT"))
		{
			strcat(p_wording,l_dl_loc_repproc_struct_h->h_dl_client);
		}

		if (!strcmp(h_desc_a,"IDENTIY_NO"))
		{
			strcat(p_wording,l_dl_loc_repproc_struct_h->h_indentity_no);
		}
	}
		
	if(i_desc_b != -1)
	{
		strcat(p_wording,"/");

		if (!strcmp(h_desc_b,"NDS_DATE") || !strcmp(h_desc_b,"NDS_BLK_DT"))
		{
			if (APL_FAILURE == CR_Def_LRErrTxnCursor(l_dl_loc_repproc_struct_h->h_dl_client,
															l_dl_loc_repproc_struct_h->h_indentity_no,
															l_debug_info_ptr))
			{
				APL_GOBACK_FAIL
			}

			if (APL_FAILURE == CR_Rtv_LRErrTxnCursor(chr_p_ndsdt, chr_p_ndsbldt, l_debug_info_ptr))
			{
				APL_GOBACK_FAIL
			}

			if (!strcmp(h_desc_b,"NDS_DATE"))
			{
				strcat(p_wording,chr_p_ndsdt);
			}

			if (!strcmp(h_desc_b,"NDS_BLK_DT"))
			{
				strcat(p_wording,chr_p_ndsbldt);
			}
		}

		if (!strcmp(h_desc_b,"CLIENT"))
		{
			strcat(p_wording,l_dl_loc_repproc_struct_h->h_dl_client);
		}

		if (!strcmp(h_desc_b,"IDENTIY_NO"))
		{
			strcat(p_wording,l_dl_loc_repproc_struct_h->h_indentity_no);
		}
	}

	APL_GOBACK_SUCCESS

	RETURN_SUCCESS :
	{
		#ifdef SYS_DEBUG
			fprintf(APL_OUT_FILE,"Exiting CR_Proc_LRErrWordCursor successfully\n");
		#endif
		return(APL_SUCCESS);
	}

	RETURN_FAILURE :
	{
		#ifdef SYS_DEBUG
			fprintf(APL_OUT_FILE,"Exiting CR_Proc_LRErrWordCursor with errors\n");
		#endif
		return(APL_FAILURE);
	}
}



int CR_Rtv_LRErrWord(  DL_LOCALREPPROC_STRUCT_H *l_dl_loc_repproc_struct_h,
							char *p_wording , 
							char *p_dclient, 
							char *p_cclient, 
							DEBUG_INFO_STRUCT_H **l_debug_info_ptr) 
{
	char h_desc[66] = APL_NULL_STRING;
	char h_desc_a[21] = APL_NULL_STRING;
	char h_desc_b[21] = APL_NULL_STRING;
	char h_DB100[20] = APL_NULL_STRING;
	char h_CT100[20] = APL_NULL_STRING;
	char h_clt_class[3] = APL_NULL_STRING;
	short i_desc;
	short i_desc_a;
	short i_desc_b;
	short i_DB100;
	short i_CT100;
	char chr_p_ndsdt[APL_DATE_LEN] = APL_NULL_STRING;
	char chr_p_ndsbldt[APL_DATE_LEN] = APL_NULL_STRING;

   EXEC SQL BEGIN DECLARE SECTION;
   EXEC SQL VAR l_dl_loc_repproc_struct_h->h_dl_client IS STRING;
   EXEC SQL VAR l_dl_loc_repproc_struct_h->h_indentity_no IS STRING;
   EXEC SQL VAR l_dl_loc_repproc_struct_h->h_instr_code IS STRING;
   EXEC SQL VAR l_dl_loc_repproc_struct_h->h_ctclt IS STRING;
   EXEC SQL VAR l_dl_loc_repproc_struct_h->h_dbclt IS STRING;
   EXEC SQL VAR l_dl_loc_repproc_struct_h->h_domcpclt_cd IS STRING;
   EXEC SQL VAR l_dl_loc_repproc_struct_h->h_ord_ind IS STRING;
   EXEC SQL VAR l_dl_loc_repproc_struct_h->h_lrdltype IS STRING;
   EXEC SQL VAR l_dl_loc_repproc_struct_h->h_dealcd IS STRING;
   EXEC SQL VAR l_dl_loc_repproc_struct_h->h_reset_ind IS STRING;

	EXEC SQL VAR h_desc IS STRING;
	EXEC SQL VAR h_desc_a IS STRING;
	EXEC SQL VAR h_desc_b IS STRING;
	EXEC SQL VAR h_DB100	 IS STRING;
	EXEC SQL VAR h_CT100	 IS STRING;
	EXEC SQL VAR h_clt_class   IS STRING;
	EXEC SQL END DECLARE SECTION;
	
	EXEC SQL BEGIN DECLARE SECTION;
		struct sqlca sqlca;
	EXEC SQL END DECLARE SECTION;
	sqlca.sqlcode = 0;
	
	#ifdef SYS_DEBUG
		fprintf(APL_OUT_FILE,"Entered CR_Rtv_LRErrWord\n");
	#endif
	
	EXEC SQL DECLARE getword_curs CURSOR FOR 
				SELECT DET,
						 DESC_A,
						 DESC_B,
						 DEBIT_IND_100,
						 CREDIT_IND_100
		FROM DL_LOCALREPSPEC 
		WHERE 		DEALCLASS 	 = :l_dl_loc_repproc_struct_h->h_lrdltype AND
						deal_cd 	 = :l_dl_loc_repproc_struct_h->h_dealcd AND
						DT_FIELD	 = :l_dl_loc_repproc_struct_h->h_dtfld;
	
	EXEC SQL OPEN getword_curs;
	IS_ANY_ORA_ERROR;

	EXEC SQL FETCH getword_curs 
				INTO 	 :h_desc:i_desc, 
					  	 :h_desc_a:i_desc_a, 
					 	 :h_desc_b:i_desc_b,
						 :h_DB100:i_DB100,
						 :h_CT100:i_CT100;

	IS_ANY_ORA_ERROR;

	EXEC SQL CLOSE getword_curs;

	strcpy(p_dclient,l_dl_loc_repproc_struct_h->h_dbclt);
	if ( i_DB100 == -1)
	{
		strcat( p_dclient, " ");
	}

	if (i_DB100 != -1)
	{
		if(!strcmp(h_DB100,"DOMESTIC_CPCLT"))
		{
			EXEC SQL SELECT CLN_CLAS INTO :h_clt_class FROM MT_CLIENT
			WHERE cln_code = :l_dl_loc_repproc_struct_h->h_domcpclt_cd;

			IS_ANY_ORA_ERROR;

			if(strcmp(h_clt_class,"2"))
			{
				strcat(p_dclient,"/");
				strcat(p_dclient,l_dl_loc_repproc_struct_h->h_domcpclt_cd);
			}
		}
			
		if(!strcmp(h_DB100,"CLIENT"))
		{
			EXEC SQL SELECT CLN_CLAS INTO :h_clt_class FROM MT_CLIENT
			WHERE cln_code = :l_dl_loc_repproc_struct_h->h_dl_client;

			IS_ANY_ORA_ERROR;
			
			if(strcmp(h_clt_class,"2"))
			{
				strcat(p_dclient,"/");
				strcat(p_dclient,l_dl_loc_repproc_struct_h->h_dl_client);
			}
		}		

		if(!strcmp(h_DB100,"CP_CLT"))
		{
			EXEC SQL SELECT CLN_CLAS INTO :h_clt_class FROM MT_CLIENT
			WHERE cln_code = :l_dl_loc_repproc_struct_h->h_domcpclt_cd;

			IS_ANY_ORA_ERROR;

			if(strcmp(h_clt_class,"2"))
			{
				strcat(p_dclient,"/");
				strcat(p_dclient,l_dl_loc_repproc_struct_h->h_domcpclt_cd);
			}
		}
	}

	strcpy(p_cclient,l_dl_loc_repproc_struct_h->h_ctclt);
	if ( i_CT100 == -1)
	{
		strcat(p_cclient, " ");
	}

	if (i_CT100 != -1)
	{
		if(!strcmp(h_CT100,"DOMESTIC_CPCLT"))
		{
			EXEC SQL SELECT CLN_CLAS INTO :h_clt_class FROM MT_CLIENT
			WHERE cln_code = :l_dl_loc_repproc_struct_h->h_domcpclt_cd;

			IS_ANY_ORA_ERROR;

			if(strcmp(h_clt_class,"2"))
			{
				strcat(p_cclient,"/");
				strcat(p_cclient,l_dl_loc_repproc_struct_h->h_domcpclt_cd);
			}
		}

		if(!strcmp(h_CT100,"CLIENT"))
		{
			EXEC SQL SELECT CLN_CLAS INTO :h_clt_class FROM MT_CLIENT
			WHERE cln_code = :l_dl_loc_repproc_struct_h->h_dl_client;

			IS_ANY_ORA_ERROR;

			if(strcmp(h_clt_class,"2"))
			{
				strcat(p_cclient,"/");
				strcat(p_cclient,l_dl_loc_repproc_struct_h->h_dl_client);
			}
		}

		if(!strcmp(h_CT100,"CP_CLT"))
		{
			EXEC SQL SELECT CLN_CLAS INTO :h_clt_class FROM MT_CLIENT
			WHERE cln_code = :l_dl_loc_repproc_struct_h->h_domcpclt_cd;

			IS_ANY_ORA_ERROR;

			if(strcmp(h_clt_class,"2"))
			{
				strcat(p_cclient,"/");
				strcat(p_cclient,l_dl_loc_repproc_struct_h->h_domcpclt_cd);
			}
		}
	}

	strcpy(p_wording,h_desc);
	
	if (i_desc_a != -1)
	{
		strcat(p_wording," - ");

		if (!strcmp(h_desc_a,"NDS_DATE") || !strcmp(h_desc_a,"NDS_BLK_DT"))
		{
			if (APL_FAILURE == CR_Def_LRErrTxnCursor(l_dl_loc_repproc_struct_h->h_dl_client,
															l_dl_loc_repproc_struct_h->h_indentity_no,
															l_debug_info_ptr))
			{
				APL_GOBACK_FAIL
			}

			if (APL_FAILURE == CR_Rtv_LRErrTxnCursor(chr_p_ndsdt, chr_p_ndsbldt, l_debug_info_ptr))
			{
				APL_GOBACK_FAIL
			}

			if (!strcmp(h_desc_a,"NDS_DATE"))
			{
				strcat(p_wording,chr_p_ndsdt);
			}

			if (!strcmp(h_desc_a,"NDS_BLK_DT"))
			{
				strcat(p_wording,chr_p_ndsbldt);
			}
		}

		if (!strcmp(h_desc_a,"CLIENT"))
		{
			strcat(p_wording,l_dl_loc_repproc_struct_h->h_dl_client);
		}

		if (!strcmp(h_desc_a,"IDENTIY_NO"))
		{
			strcat(p_wording,l_dl_loc_repproc_struct_h->h_indentity_no);
		}
	}
		
	if(i_desc_b != -1)
	{
		strcat(p_wording,"/");

		if (!strcmp(h_desc_b,"NDS_DATE") || !strcmp(h_desc_b,"NDS_BLK_DT"))
		{
			if (APL_FAILURE == CR_Def_LRErrTxnCursor(l_dl_loc_repproc_struct_h->h_dl_client,
															l_dl_loc_repproc_struct_h->h_indentity_no,
															l_debug_info_ptr))
			{
				APL_GOBACK_FAIL
			}

			if (APL_FAILURE == CR_Rtv_LRErrTxnCursor(chr_p_ndsdt, chr_p_ndsbldt, l_debug_info_ptr))
			{
				APL_GOBACK_FAIL
			}

			if (!strcmp(h_desc_b,"NDS_DATE"))
			{
				strcat(p_wording,chr_p_ndsdt);
			}

			if (!strcmp(h_desc_b,"NDS_BLK_DT"))
			{
				strcat(p_wording,chr_p_ndsbldt);
			}
		}

		if (!strcmp(h_desc_b,"CLIENT"))
		{
			strcat(p_wording,l_dl_loc_repproc_struct_h->h_dl_client);
		}

		if (!strcmp(h_desc_b,"IDENTIY_NO"))
		{
			strcat(p_wording,l_dl_loc_repproc_struct_h->h_indentity_no);
		}
	}

	APL_GOBACK_SUCCESS

	RETURN_SUCCESS :
	{
		#ifdef SYS_DEBUG
			fprintf(APL_OUT_FILE,"Exiting CR_Rtv_LRErrWord successfully\n");
		#endif
		return(APL_SUCCESS);
	}

	RETURN_FAILURE :
	{
		#ifdef SYS_DEBUG
			fprintf(APL_OUT_FILE,"Exiting CR_Rtv_LRErrWord with errors\n");
		#endif
		return(APL_FAILURE);
	}
}


int CR_Chk_EOFLR(  short *p_status_ind, 
								short	p_heading,
								DEBUG_INFO_STRUCT_H **l_debug_info_ptr) 
{
	short h_EOF = 0;

	EXEC SQL BEGIN DECLARE SECTION;
		struct sqlca sqlca;
	EXEC SQL END DECLARE SECTION;

	#ifdef SYS_DEBUG
		fprintf(APL_OUT_FILE,"Entered CR_Chk_EOFLR \n");
	#endif

	if ( p_heading == 1 || p_heading == 3) 
	{
		EXEC SQL SELECT NVL(COUNT(*),0) INTO :h_EOF FROM DL_LOCALREPPROC 
				WHERE CLIENT NOT IN ( '100000','100001','100002');

		IS_ANY_ORA_ERROR;
	}
	else if ( p_heading == 2)
	{
		EXEC SQL SELECT NVL(COUNT(*),0) INTO :h_EOF FROM DL_LOCALREPPROC 
				WHERE CLIENT =  '100000'
				OR		CLIENT =  '100001'
				OR		CLIENT != '100002';

		IS_ANY_ORA_ERROR;
	}

	if (h_EOF == 0)
	{
		*p_status_ind = 3;
	}

	APL_GOBACK_SUCCESS


	RETURN_SUCCESS :
	{
		#ifdef SYS_DEBUG
			fprintf(APL_OUT_FILE,"Exiting CR_Chk_EOFLR successfully\n");
		#endif
		return(APL_SUCCESS);
	}

	RETURN_FAILURE :
	{
		#ifdef SYS_DEBUG
			fprintf(APL_OUT_FILE,"Exiting CR_Chk_EOFLR with errors\n");
		#endif
		return(APL_FAILURE);
	}
}



int CR_Def_LROpBkCursor( short p_heading, DEBUG_INFO_STRUCT_H **l_debug_info_ptr)
{
	EXEC SQL BEGIN DECLARE SECTION;
		struct sqlca sqlca;
	EXEC SQL END DECLARE SECTION;
	sqlca.sqlcode = 0;
	
	#ifdef SYS_DEBUG
		fprintf(APL_OUT_FILE,"Entered CR_Def_LROpBkCursor\n");
	#endif

   
	
	if ( p_heading == 1)
	{
		
		EXEC SQL DECLARE opbkdet1_curs CURSOR FOR
		SELECT a.* FROM DL_LOCALREPPROC a,MT_INSTRUMENT b,MT_CLIENT c,DEAL_LOCALREP_VEW d 
		WHERE 
      a.client = c.cln_code
      AND a.instr_code = b.instr_code
		AND a.client=d.client
		AND a.IDENTIY_NO=d.IDENTIY_NO

      AND a.R_CODE != 0
      AND a.CLIENT NOT IN ( '100000','100001','100002')
		AND (d.EX_ARENA!='3' OR d.INSTRUMENT_DT IS NOT NULL)
      AND a.ROWID NOT IN (SELECT d.rowid
                     FROM DL_LOCALREPPROC d,MT_INSTRUMENT e,MT_CLIENT f
                     WHERE d.client = f.cln_code
                     AND d.instr_code = e.instr_code
                     AND e.PROD_CLASS = '2'
                     AND e.location_cd = 'NDS'
                     AND f.CLN_BRNCHCODE NOT IN ('PO','PL') )
   	
		ORDER BY a.instr_code,d.SETL_IDEN_NO; 
		

		EXEC SQL OPEN opbkdet1_curs;
		IS_ANY_ORA_ERROR;
	}
	else if (p_heading == 2)
	{
	

		EXEC SQL DECLARE opbkdet2_curs CURSOR FOR
		SELECT * FROM DL_LOCALREPPROC a,DEAL_LOCALREP_VEW b WHERE a.R_CODE != 0
		AND a.CLIENT IN ( '100000', '100001' ,'100002')
		AND a.client=b.client
		AND a.IDENTIY_NO=b.IDENTIY_NO
		AND (b.EX_ARENA!='3' OR b.INSTRUMENT_DT IS NOT NULL)
   	
		ORDER BY  b.instr_code, b.SETL_IDEN_NO; 
		

		EXEC SQL OPEN opbkdet2_curs;
		IS_ANY_ORA_ERROR;
	}

	else if ( p_heading == 3)
	{
		
		EXEC SQL DECLARE opbkdet3_curs CURSOR FOR
		SELECT a.* FROM DL_LOCALREPPROC a,MT_INSTRUMENT b,MT_CLIENT c,DEAL_LOCALREP_VEW d 
		WHERE 
		a.client = c.cln_code
		AND a.client=d.client
		AND a.IDENTIY_NO=d.IDENTIY_NO
		AND a.instr_code = b.instr_code
		AND b.PROD_CLASS = '2'
		AND b.location_cd = 'NDS'
		AND c.CLN_BRNCHCODE NOT IN ('PO','PL')
		AND a.R_CODE != 0
		AND (d.EX_ARENA!='3' OR d.INSTRUMENT_DT IS NOT NULL)
		AND a.CLIENT NOT IN ( '100000','100001','100002')
   	
		ORDER BY a.instr_code,d.SETL_IDEN_NO; 
		

		EXEC SQL OPEN opbkdet3_curs;
		IS_ANY_ORA_ERROR;
	}

	APL_GOBACK_SUCCESS	
	
	RETURN_SUCCESS :
	{
		#ifdef SYS_DEBUG
			fprintf(APL_OUT_FILE,"Exiting CR_Def_LROpBkCursor successfully\n");
		#endif
		return(APL_SUCCESS);
	}

	RETURN_FAILURE :
	{
		#ifdef SYS_DEBUG
			fprintf(APL_OUT_FILE,"Exiting CR_Def_LROpBkCursor with errors\n");
		#endif
		return(APL_FAILURE);
	}
}	




int CR_Rtv_LROpBkCursor(short *p_eocursor, 
								short p_heading,
								DL_LOCALREPPROC_STRUCT_H *l_dl_loc_repproc_struct_h, 
								DL_LOCALREPPROC_STRUCT_I *l_dl_localrepproc_struct_ia, 
								DEBUG_INFO_STRUCT_H **l_debug_info_ptr) 
{

	EXEC SQL BEGIN DECLARE SECTION;
		struct sqlca sqlca;
	EXEC SQL END DECLARE SECTION;
	sqlca.sqlcode = 0;

   EXEC SQL BEGIN DECLARE SECTION;
   EXEC SQL VAR l_dl_loc_repproc_struct_h->h_dl_client IS STRING;
   EXEC SQL VAR l_dl_loc_repproc_struct_h->h_indentity_no IS STRING;
   EXEC SQL VAR l_dl_loc_repproc_struct_h->h_instr_code IS STRING;
   EXEC SQL VAR l_dl_loc_repproc_struct_h->h_ctclt IS STRING;
   EXEC SQL VAR l_dl_loc_repproc_struct_h->h_dbclt IS STRING;
   EXEC SQL VAR l_dl_loc_repproc_struct_h->h_domcpclt_cd IS STRING;
   EXEC SQL VAR l_dl_loc_repproc_struct_h->h_ord_ind IS STRING;
   EXEC SQL VAR l_dl_loc_repproc_struct_h->h_lrdltype IS STRING;
   EXEC SQL VAR l_dl_loc_repproc_struct_h->h_dealcd IS STRING;
   EXEC SQL VAR l_dl_loc_repproc_struct_h->h_reset_ind IS STRING;
   EXEC SQL END DECLARE SECTION;

	
	#ifdef SYS_DEBUG
		fprintf(APL_OUT_FILE,"Entered CR_Rtv_LROpBkCursor\n");
	#endif

	if ( p_heading == 1)
	{
		EXEC SQL FETCH opbkdet1_curs INTO :l_dl_loc_repproc_struct_h:l_dl_localrepproc_struct_ia ;
		IS_ANY_ORA_ERROR
	}
	else if ( p_heading == 2)
	{
		EXEC SQL FETCH opbkdet2_curs INTO :l_dl_loc_repproc_struct_h:l_dl_localrepproc_struct_ia ;
		IS_ANY_ORA_ERROR
	}
	else if (p_heading == 3) 
	{
		EXEC SQL FETCH opbkdet3_curs INTO :l_dl_loc_repproc_struct_h:l_dl_localrepproc_struct_ia ;
		IS_ANY_ORA_ERROR
	}

	if (sqlca.sqlcode == 1403)
	{
		*p_eocursor = 1;
	}

	if ( ( p_heading == 1 ) && ( sqlca.sqlcode == 1403) )
	{
		EXEC SQL CLOSE opbkdet1_curs;
		IS_ANY_ORA_ERROR
	}
	if ( ( p_heading == 2) && (sqlca.sqlcode == 1403) )
	{
		EXEC SQL CLOSE opbkdet2_curs;
		IS_ANY_ORA_ERROR
	}
	if ( ( p_heading == 3) && (sqlca.sqlcode == 1403) )  
	{
		EXEC SQL CLOSE opbkdet3_curs;
		IS_ANY_ORA_ERROR
	}
	
	APL_GOBACK_SUCCESS

	RETURN_SUCCESS :
	{
		#ifdef SYS_DEBUG
			fprintf(APL_OUT_FILE,"Exiting CR_Rtv_LROpBkCursor successfully\n");
		#endif
		return(APL_SUCCESS);
	}

	RETURN_FAILURE :
	{
		#ifdef SYS_DEBUG
			fprintf(APL_OUT_FILE,"Exiting CR_Rtv_LROpBkCursor with errors\n");
		#endif
		return(APL_FAILURE);
	}
}



int CR_Rtv_LRInstrDesc(char *p_instr_code, 
							char *chr_p_instrdesc, 
							char *chr_p_isin, 
							DEBUG_INFO_STRUCT_H **l_debug_info_ptr) 
{
	char h_instr_name[131] = APL_NULL_STRING;
	char h_instr_isin[13] = APL_NULL_STRING;

	EXEC SQL VAR h_instr_name IS STRING;
	EXEC SQL VAR h_instr_isin IS STRING;

	EXEC SQL BEGIN DECLARE SECTION;
		struct sqlca sqlca;
	EXEC SQL END DECLARE SECTION;
	sqlca.sqlcode = 0;
	
	#ifdef SYS_DEBUG
		fprintf(APL_OUT_FILE,"Entered CR_Rtv_LRInstrDesc\n");
	#endif

	EXEC SQL SELECT instr_name,instr_isin INTO :h_instr_name, h_instr_isin FROM MT_INSTRUMENT 
	WHERE instr_code = :p_instr_code;

	IS_ANY_ORA_ERROR;

	strcpy(chr_p_instrdesc,h_instr_name);
	strcpy(chr_p_isin,h_instr_isin);

	APL_GOBACK_SUCCESS

	RETURN_SUCCESS :
	{
		#ifdef SYS_DEBUG
			fprintf(APL_OUT_FILE,"Exiting CR_Rtv_LRInstrDesc successfully\n");
		#endif
		return(APL_SUCCESS);
	}

	RETURN_FAILURE :
	{
		#ifdef SYS_DEBUG
			fprintf(APL_OUT_FILE,"Exiting CR_Rtv_LRInstrDesc with errors\n");
		#endif
		return(APL_FAILURE);
	}
}




int CR_Rtv_LRSumPos( DEBUG_INFO_STRUCT_H **l_debug_info_ptr) 
{

	EXEC SQL BEGIN DECLARE SECTION;
		struct sqlca sqlca;
	EXEC SQL END DECLARE SECTION;
	sqlca.sqlcode = 0;
	
	#ifdef SYS_DEBUG
		fprintf(APL_OUT_FILE,"Entered CR_Rtv_LRSumPos\n");
	#endif

	EXEC SQL  DECLARE sum_curs CURSOR FOR 
		SELECT a.instr_code, a.CREDIT_CLT, SUM(a.CLOSING_BAL) FROM
		DL_LOCALREPSAFEK a, DL_LOCALREPCLIENT b
		WHERE b.CREDIT_CLT IN ( SELECT  a.CREDIT_CLT FROM DL_LOCALREPSAFEK)
		GROUP BY a.instr_code, a.CREDIT_CLT 
	UNION ALL
		SELECT a.instr_code, b.CREDIT_CLT, 0 FROM
		DL_LOCALREPSAFEK a, DL_LOCALREPCLIENT b
		WHERE b.CREDIT_CLT NOT IN ( SELECT a.CREDIT_CLT FROM DL_LOCALREPSAFEK)  
		GROUP BY a.instr_code, b.CREDIT_CLT
		ORDER BY instr_code;  

	IS_ANY_ORA_ERROR;

	EXEC SQL OPEN sum_curs;

	IS_ANY_ORA_ERROR;
	
	APL_GOBACK_SUCCESS

	RETURN_SUCCESS :
	{
		#ifdef SYS_DEBUG
			fprintf(APL_OUT_FILE,"Exiting CR_Rtv_LRSumPos successfully\n");
		#endif
		return(APL_SUCCESS);
	}

	RETURN_FAILURE :
	{
		#ifdef SYS_DEBUG
			fprintf(APL_OUT_FILE,"Exiting CR_Rtv_LRSumPos with errors\n");
		#endif
		return(APL_FAILURE);
	}
}



int CR_Rtv_LRPosSumCursor(short *p_eocursor,
								 char *p_instr_code, 
								 char *p_ct_clt, 
								 double *p_totqty , 
								 DEBUG_INFO_STRUCT_H **l_debug_info_ptr) 
{
	double h_closing_bal = 0;
	char h_instr_code[APL_INSTRUMENTCODE_LEN] = APL_NULL_STRING;
	char h_ct_clt[4] = APL_NULL_STRING;

	EXEC SQL VAR h_instr_code is STRING;
	EXEC SQL VAR h_ct_clt IS STRING;

	EXEC SQL BEGIN DECLARE SECTION;
		struct sqlca sqlca;
	EXEC SQL END DECLARE SECTION;
	sqlca.sqlcode = 0;
	
	#ifdef SYS_DEBUG
		fprintf(APL_OUT_FILE,"Entered CR_Rtv_LRPosSumCursor\n");
	#endif

	EXEC SQL FETCH sum_curs INTO :h_instr_code, :h_ct_clt, :h_closing_bal;
	
	IS_ANY_ORA_ERROR;

	if (sqlca.sqlcode == 1403)
	{
		*p_eocursor = 1;
	}
	
	*p_totqty = h_closing_bal;
	strcpy(p_instr_code,h_instr_code);
	strcpy(p_ct_clt,h_ct_clt);

	APL_GOBACK_SUCCESS

	RETURN_SUCCESS :
	{
		#ifdef SYS_DEBUG
			fprintf(APL_OUT_FILE,"Exiting CR_Rtv_LRPosSumCursor successfully\n");
		#endif
		return(APL_SUCCESS);
	}

	RETURN_FAILURE :
	{
		#ifdef SYS_DEBUG
			fprintf(APL_OUT_FILE,"Exiting CR_Rtv_LRPosSumCursor with errors\n");
		#endif
		return(APL_FAILURE);
	}
}




int CR_Rtv_LRCustEntCursor( DEBUG_INFO_STRUCT_H **l_debug_info_ptr) 
{

	EXEC SQL BEGIN DECLARE SECTION;
		struct sqlca sqlca;
	EXEC SQL END DECLARE SECTION;
	sqlca.sqlcode = 0;
	
	#ifdef SYS_DEBUG
		fprintf(APL_OUT_FILE,"Entered CR_Rtv_LRCustEntCursor\n");
	#endif

	EXEC SQL DECLARE cust_curs CURSOR FOR 
	SELECT * FROM DL_LOCALREPPROC a
	WHERE 'Y' = (SELECT FLAG FROM DL_LOCALREPCLIENT b WHERE b.CREDIT_CLT = a.CREDITCLIENT)
	and '2' <> (SELECT CLN_CLAS FROM MT_CLIENT c WHERE c.cln_code = a.client)
	ORDER BY client,instr_code,CREDITCLIENT,DEBIT_CLT,IDENTIY_NO,domestic_cpclt;

	IS_ANY_ORA_ERROR;

	EXEC SQL OPEN cust_curs;

	IS_ANY_ORA_ERROR;
	
	APL_GOBACK_SUCCESS

	RETURN_SUCCESS :
	{
		#ifdef SYS_DEBUG
			fprintf(APL_OUT_FILE,"Exiting CR_Rtv_LRCustEntCursor successfully\n");
		#endif
		return(APL_SUCCESS);
	}

	RETURN_FAILURE :
	{
		#ifdef SYS_DEBUG
			fprintf(APL_OUT_FILE,"Exiting CR_Rtv_LRCustEntCursor with errors\n");
		#endif
		return(APL_FAILURE);
	}
}



int CR_Rtv_LRAccCursor(short *p_eocursor, 
								 double *p_openbal, 
								 DL_LOCALREPPROC_STRUCT_H *l_dl_loc_repproc_struct_h, 
								 DL_LOCALREPPROC_STRUCT_I *l_dl_localrepproc_struct_ia , 
								 DEBUG_INFO_STRUCT_H **l_debug_info_ptr) 
{

	double h_openbalance = 0;
	EXEC SQL VAR l_dl_loc_repproc_struct_h->h_dl_client IS STRING;
	EXEC SQL VAR l_dl_loc_repproc_struct_h->h_indentity_no IS STRING;
	EXEC SQL VAR l_dl_loc_repproc_struct_h->h_instr_code IS STRING;
	EXEC SQL VAR l_dl_loc_repproc_struct_h->h_ctclt IS STRING;
	EXEC SQL VAR l_dl_loc_repproc_struct_h->h_dbclt IS STRING;
	EXEC SQL VAR l_dl_loc_repproc_struct_h->h_domcpclt_cd IS STRING;
	EXEC SQL VAR l_dl_loc_repproc_struct_h->h_lrdltype IS STRING;
	
	EXEC SQL BEGIN DECLARE SECTION;
		struct sqlca sqlca;
	EXEC SQL END DECLARE SECTION;
	sqlca.sqlcode = 0;
	
	#ifdef SYS_DEBUG
		fprintf(APL_OUT_FILE,"Entered CR_Rtv_LRAccCursor\n");
	#endif

	EXEC SQL FETCH cust_curs INTO :l_dl_loc_repproc_struct_h:l_dl_localrepproc_struct_ia;
	
	IS_ANY_ORA_ERROR;

	if (sqlca.sqlcode == 1403)
	{
		*p_eocursor = 1;
		APL_GOBACK_SUCCESS
	}



	if ( l_dl_localrepproc_struct_ia->i_domcpclt_cd == -1 )
	{
		EXEC SQL SELECT CLOSING_BAL INTO :h_openbalance FROM DL_LOCALREPSAFEK
					WHERE client = :l_dl_loc_repproc_struct_h->h_dl_client AND
					instr_code  = :l_dl_loc_repproc_struct_h->h_instr_code  AND
					CREDIT_CLT  = :l_dl_loc_repproc_struct_h->h_ctclt;

		IS_ANY_ORA_ERROR;
	}
	else 
	{
		EXEC SQL SELECT CLOSING_BAL INTO :h_openbalance FROM DL_LOCALREPSAFEK
					WHERE client = :l_dl_loc_repproc_struct_h->h_dl_client AND
					instr_code  = :l_dl_loc_repproc_struct_h->h_instr_code  AND
					CREDIT_CLT  = :l_dl_loc_repproc_struct_h->h_ctclt   AND
					domestic_cpclt = :l_dl_loc_repproc_struct_h->h_domcpclt_cd;

		IS_ANY_ORA_ERROR;
	}


	*p_openbal = h_openbalance;
	
	APL_GOBACK_SUCCESS

	RETURN_SUCCESS :
	{
		#ifdef SYS_DEBUG
			fprintf(APL_OUT_FILE,"Exiting CR_Rtv_LRAccCursor successfully\n");
		#endif
		return(APL_SUCCESS);
	}

	RETURN_FAILURE :
	{
		#ifdef SYS_DEBUG
			fprintf(APL_OUT_FILE,"Exiting CR_Rtv_LRAccCursor with errors\n");
		#endif
		return(APL_FAILURE);
	}
}




int CR_Def_LRCursor( DEBUG_INFO_STRUCT_H **l_debug_info_ptr) 
{

	EXEC SQL BEGIN DECLARE SECTION;
		struct sqlca sqlca;
	EXEC SQL END DECLARE SECTION;
	sqlca.sqlcode = 0;
	
	#ifdef SYS_DEBUG
		fprintf(APL_OUT_FILE,"Entered CR_Def_LRCursor\n");
	#endif

	EXEC SQL DECLARE main_curs CURSOR FOR 
	SELECT * FROM DL_LOCALREPPROC a
	WHERE ( ('Y' <> (SELECT FLAG FROM DL_LOCALREPCLIENT b WHERE b.CREDIT_CLT = a.CREDITCLIENT)) OR (CREDITCLIENT NOT IN(SELECT CREDIT_CLT FROM DL_LOCALREPCLIENT)) )
	and CREDITCLIENT IS NOT NULL 
	and CREDITCLIENT <> '   '
	ORDER BY instr_code,CREDITCLIENT,DEBIT_CLT,IDENTIY_NO,domestic_cpclt;

	IS_ANY_ORA_ERROR;

	EXEC SQL OPEN main_curs;

	IS_ANY_ORA_ERROR;
	
	APL_GOBACK_SUCCESS

	RETURN_SUCCESS :
	{
		#ifdef SYS_DEBUG
			fprintf(APL_OUT_FILE,"Exiting CR_Def_LRCursor successfully\n");
		#endif
		return(APL_SUCCESS);
	}

	RETURN_FAILURE :
	{
		#ifdef SYS_DEBUG
			fprintf(APL_OUT_FILE,"Exiting CR_Def_LRCursor with errors\n");
		#endif
		return(APL_FAILURE);
	}
}



int CR_Rtv_LRCursor( short *p_eocursor, 
									double *p_openbal, 
									DL_LOCALREPPROC_STRUCT_H *l_dl_loc_repproc_struct_h , 
									DL_LOCALREPPROC_STRUCT_I *l_dl_localrepproc_struct_ia , 
									DEBUG_INFO_STRUCT_H **l_debug_info_ptr) 
{

	double h_openbalance = 0;
	
	EXEC SQL VAR l_dl_loc_repproc_struct_h->h_dl_client IS STRING;
	EXEC SQL VAR l_dl_loc_repproc_struct_h->h_indentity_no IS STRING;
	EXEC SQL VAR l_dl_loc_repproc_struct_h->h_instr_code IS STRING;
	EXEC SQL VAR l_dl_loc_repproc_struct_h->h_ctclt IS STRING;
	EXEC SQL VAR l_dl_loc_repproc_struct_h->h_dbclt IS STRING;
	EXEC SQL VAR l_dl_loc_repproc_struct_h->h_domcpclt_cd IS STRING;
	EXEC SQL VAR l_dl_loc_repproc_struct_h->h_lrdltype IS STRING;
	
	EXEC SQL BEGIN DECLARE SECTION;
		struct sqlca sqlca;
	EXEC SQL END DECLARE SECTION;
	sqlca.sqlcode = 0;
	
	#ifdef SYS_DEBUG
		fprintf(APL_OUT_FILE,"Entered CR_Rtv_LRCursor\n");
	#endif

	EXEC SQL FETCH main_curs INTO :l_dl_loc_repproc_struct_h:l_dl_localrepproc_struct_ia;
	
	IS_ANY_ORA_ERROR;

	if (sqlca.sqlcode == 1403)
	{
		*p_eocursor = 1;
		APL_GOBACK_SUCCESS
	}

	EXEC SQL SELECT NVL( SUM(CLOSING_BAL),0 ) INTO :h_openbalance FROM DL_LOCALREPSAFEK
	WHERE instr_code  = :l_dl_loc_repproc_struct_h->h_instr_code  AND
			CREDIT_CLT  = :l_dl_loc_repproc_struct_h->h_ctclt;

	if ( sqlca.sqlcode != -1405 )
   {
      IS_ANY_ORA_ERROR
    }

	*p_openbal = h_openbalance;
	
	APL_GOBACK_SUCCESS

	RETURN_SUCCESS :
	{
		#ifdef SYS_DEBUG
			fprintf(APL_OUT_FILE,"Exiting CR_Rtv_LRCursor successfully\n");
		#endif
		return(APL_SUCCESS);
	}

	RETURN_FAILURE :
	{
		#ifdef SYS_DEBUG
			fprintf(APL_OUT_FILE,"Exiting CR_Rtv_LRCursor with errors\n");
		#endif
		return(APL_FAILURE);
	}
}



int CR_Rtv_LROneSpecCursor( char *p_lrdealtype, 
							char *p_dealcd, int p_datefld, 
							DL_LOCALREPSPEC_STRUCT_H *l_dl_localrepspec_struct_ha, 
							DL_LOCALREPSPEC_STRUCT_I *l_dl_localrepspec_struct_ia, 
							DEBUG_INFO_STRUCT_H **l_debug_info_ptr)
{
	

	EXEC SQL VAR l_dl_localrepspec_struct_ha->h_dealclass IS STRING;
	EXEC SQL VAR l_dl_localrepspec_struct_ha->h_dealcd IS STRING;
	EXEC SQL VAR l_dl_localrepspec_struct_ha->h_status_active IS STRING;
	EXEC SQL VAR l_dl_localrepspec_struct_ha->h_dtname IS STRING;
	EXEC SQL VAR l_dl_localrepspec_struct_ha->h_indname IS STRING;
	EXEC SQL VAR l_dl_localrepspec_struct_ha->h_debit_flag IS STRING;
	EXEC SQL VAR l_dl_localrepspec_struct_ha->h_debit_ind_100 IS STRING;
	EXEC SQL VAR l_dl_localrepspec_struct_ha->h_credit_flag IS STRING;
	EXEC SQL VAR l_dl_localrepspec_struct_ha->h_credit_ind_100 IS STRING;
	EXEC SQL VAR l_dl_localrepspec_struct_ha->h_desc IS STRING;
	EXEC SQL VAR l_dl_localrepspec_struct_ha->h_info IS STRING;
	EXEC SQL VAR l_dl_localrepspec_struct_ha->h_iv_cond IS STRING;
	EXEC SQL VAR l_dl_localrepspec_struct_ha->h_local_iv_cond IS STRING;
	EXEC SQL VAR l_dl_localrepspec_struct_ha->h_desc_a IS STRING;
	EXEC SQL VAR l_dl_localrepspec_struct_ha->h_desc_b IS STRING;
	
	EXEC SQL BEGIN DECLARE SECTION;
		struct sqlca sqlca;
	EXEC SQL END DECLARE SECTION;
	sqlca.sqlcode = 0;
	
	#ifdef SYS_DEBUG
		fprintf(APL_OUT_FILE,"Entered CR_Rtv_LROneSpecCursor\n");
	#endif

	EXEC SQL	DECLARE lronespecs_curs CURSOR FOR 
			SELECT * 
		FROM DL_LOCALREPSPEC 
		WHERE DEALCLASS = :p_lrdealtype
		AND deal_cd = :p_dealcd
		AND DT_FIELD = :p_datefld;

	EXEC SQL OPEN lronespecs_curs;

	IS_ANY_ORA_ERROR;

	EXEC SQL FETCH lronespecs_curs 
			INTO :l_dl_localrepspec_struct_ha:l_dl_localrepspec_struct_ia ;

	IS_ANY_ORA_ERROR;

	EXEC SQL CLOSE lronespecs_curs;
	IS_ANY_ORA_ERROR;
	
	APL_GOBACK_SUCCESS	
	
	RETURN_SUCCESS :
	{
		#ifdef SYS_DEBUG
			fprintf(APL_OUT_FILE,"Exiting CR_Rtv_LROneSpecCursor successfully\n");
		#endif
		return(APL_SUCCESS);
	}

	RETURN_FAILURE :
	{
		#ifdef SYS_DEBUG
			fprintf(APL_OUT_FILE,"Exiting CR_Rtv_LROneSpecCursor with errors\n");
		#endif
		return(APL_FAILURE);
	}
}	



int CR_Rtv_LROppCust ( char p_clttype, 
								char *chr_p_client, 
								char *p_domcpac,
								DL_LOCALREPSPEC_STRUCT_H *l_dl_localrepspec_struct_ha, 
								DL_LOCALREPSPEC_STRUCT_I *l_dl_localrepspec_struct_ia, 
								DL_LOCALREPPROC_STRUCT_H	*l_dl_loc_repproc_struct_h,
								DL_LOCALREPPROC_STRUCT_I	*l_dl_localrepproc_struct_ia,
								char *p_dbclt, DEBUG_INFO_STRUCT_H **l_debug_info_ptr)
{

	char chr_hclient[APL_CLIENT_LENGTH] = APL_NULL_STRING;
	char chr_l_acc_class[3] = APL_NULL_STRING;

	EXEC SQL VAR chr_l_acc_class IS STRING;
	
	EXEC SQL BEGIN DECLARE SECTION;
		struct sqlca sqlca;
	EXEC SQL END DECLARE SECTION;

   EXEC SQL BEGIN DECLARE SECTION;
   EXEC SQL VAR l_dl_loc_repproc_struct_h->h_dl_client IS STRING;
   EXEC SQL VAR l_dl_loc_repproc_struct_h->h_indentity_no IS STRING;
   EXEC SQL VAR l_dl_loc_repproc_struct_h->h_instr_code IS STRING;
   EXEC SQL VAR l_dl_loc_repproc_struct_h->h_ctclt IS STRING;
   EXEC SQL VAR l_dl_loc_repproc_struct_h->h_dbclt IS STRING;
   EXEC SQL VAR l_dl_loc_repproc_struct_h->h_domcpclt_cd IS STRING;
   EXEC SQL VAR l_dl_loc_repproc_struct_h->h_ord_ind IS STRING;
   EXEC SQL VAR l_dl_loc_repproc_struct_h->h_lrdltype IS STRING;
   EXEC SQL VAR l_dl_loc_repproc_struct_h->h_dealcd IS STRING;
   EXEC SQL VAR l_dl_loc_repproc_struct_h->h_reset_ind IS STRING;

   EXEC SQL VAR l_dl_localrepspec_struct_ha->h_dealclass IS STRING;
   EXEC SQL VAR l_dl_localrepspec_struct_ha->h_dealcd IS STRING;
   EXEC SQL VAR l_dl_localrepspec_struct_ha->h_status_active IS STRING;
   EXEC SQL VAR l_dl_localrepspec_struct_ha->h_dtname IS STRING;
   EXEC SQL VAR l_dl_localrepspec_struct_ha->h_indname IS STRING;
   EXEC SQL VAR l_dl_localrepspec_struct_ha->h_debit_flag IS STRING;
   EXEC SQL VAR l_dl_localrepspec_struct_ha->h_debit_ind_100 IS STRING;
   EXEC SQL VAR l_dl_localrepspec_struct_ha->h_credit_flag IS STRING;
   EXEC SQL VAR l_dl_localrepspec_struct_ha->h_credit_ind_100 IS STRING;
   EXEC SQL VAR l_dl_localrepspec_struct_ha->h_desc IS STRING;
   EXEC SQL VAR l_dl_localrepspec_struct_ha->h_info IS STRING;
   EXEC SQL VAR l_dl_localrepspec_struct_ha->h_iv_cond IS STRING;
   EXEC SQL VAR l_dl_localrepspec_struct_ha->h_local_iv_cond IS STRING;
   EXEC SQL VAR l_dl_localrepspec_struct_ha->h_desc_a IS STRING;
   EXEC SQL VAR l_dl_localrepspec_struct_ha->h_desc_b IS STRING;
	EXEC SQL END DECLARE SECTION;



	sqlca.sqlcode = 0;

	#ifdef SYS_DEBUG
		fprintf(APL_OUT_FILE,"Entered CR_Rtv_LROppCust \n");
	#endif
	
	EXEC SQL SELECT CLN_CLAS INTO :chr_l_acc_class FROM MT_CLIENT 
	WHERE cln_code = :chr_p_client;

	IS_ANY_ORA_ERROR;
	
	if (p_clttype == 'C' || p_clttype == 'E')
	{
		if ( l_dl_loc_repproc_struct_h->h_dtfld == 3 && 
			(strcmp(l_dl_loc_repproc_struct_h->h_lrdltype,"18") == 0 ) &&
			 p_clttype == 'C')
		{
			if ((l_dl_localrepspec_struct_ia->i_debit_ind_100 == -1) || !strcmp(chr_l_acc_class,"2"))
			{
				if (!strcmp(l_dl_localrepspec_struct_ha->h_debit_ind_100,"DOMESTIC_CPCLT"))
				{
					strcat(p_dbclt,"/");
					strcat(p_dbclt,p_domcpac);
				}
				if (!strcmp(l_dl_localrepspec_struct_ha->h_debit_ind_100,"CLIENT"))
				{
					strcat(p_dbclt,"/");
					strcat(p_dbclt,chr_p_client);
				}
				if (!strcmp(l_dl_localrepspec_struct_ha->h_debit_ind_100,"CP_CLT"))
				{
					strcat(p_dbclt,"/");
					strcat(p_dbclt,p_domcpac);
				}
			}		
			else
			{
				strcat(p_dbclt," ");
			}
		}
		else
		{
			if ((l_dl_localrepspec_struct_ia->i_credit_ind_100 == -1) || 
				((strcmp(chr_l_acc_class,"2") == 0) && p_clttype == 'C'))
			{
				if (!strcmp(l_dl_localrepspec_struct_ha->h_credit_ind_100,"DOMESTIC_CPCLT"))
				{
					strcat(p_dbclt,"/");
					strcat(p_dbclt,p_domcpac);
				}
				if (!strcmp(l_dl_localrepspec_struct_ha->h_credit_ind_100,"CLIENT"))
				{
					strcat(p_dbclt,"/");
					strcat(p_dbclt,chr_p_client);
				}
				if (!strcmp(l_dl_localrepspec_struct_ha->h_credit_ind_100,"CP_CLT"))
				{
					strcat(p_dbclt,"/");
					strcat(p_dbclt,p_domcpac);
				}
			}		
			else
			{
				strcat(p_dbclt," ");
			}
		}

		if (l_dl_localrepspec_struct_ia->i_credit_ind_100 != -1)
		{
			

			if (!strcmp(l_dl_localrepspec_struct_ha->h_credit_ind_100,"DOMESTIC_CPCLT"))
			{
				EXEC SQL SELECT CLN_CLAS INTO :chr_l_acc_class FROM MT_CLIENT
				WHERE cln_code = :p_domcpac;

				IS_ANY_ORA_ERROR;

				if (!strcmp(chr_l_acc_class,"2"))
				{
					strcpy(p_dbclt, &p_domcpac[strlen(p_domcpac - 3)] );
					
				}
			}

			if (!strcmp(l_dl_localrepspec_struct_ha->h_credit_ind_100,"CLIENT"))
			{
				EXEC SQL SELECT CLN_CLAS INTO :chr_l_acc_class FROM MT_CLIENT
				WHERE cln_code = :chr_p_client;

				IS_ANY_ORA_ERROR;

				if (!strcmp(chr_l_acc_class,"2"))
				{
					strcpy(p_dbclt, &chr_p_client[strlen(chr_p_client - 3)] );
					
				}
			}

			if (!strcmp(l_dl_localrepspec_struct_ha->h_credit_ind_100,"CP_CLT"))
			{
				EXEC SQL SELECT CLN_CLAS INTO :chr_l_acc_class FROM MT_CLIENT
				WHERE cln_code = :p_domcpac;

				IS_ANY_ORA_ERROR;

				if (!strcmp(chr_l_acc_class,"2"))
				{
					strcpy(p_dbclt, &p_domcpac[strlen(p_domcpac - 3)] );
					
				}
			}

		}		
	}
	
	if (p_clttype == 'D' )
	{
		if (l_dl_localrepspec_struct_ia->i_debit_ind_100 != -1) 
		{
			if (!strcmp(l_dl_localrepspec_struct_ha->h_debit_ind_100,"DOMESTIC_CPCLT"))
			{
				strcat(p_dbclt,"/");
				strcat(p_dbclt,p_domcpac);
			}
			if (!strcmp(l_dl_localrepspec_struct_ha->h_debit_ind_100,"CLIENT"))
			{
				strcat(p_dbclt,"/");
				strcat(p_dbclt,chr_p_client);
			}

			if (!strcmp(l_dl_localrepspec_struct_ha->h_debit_ind_100,"CP_CLT"))
			{
				strcat(p_dbclt,"/");
				strcat(p_dbclt,p_domcpac);
			}
		}		
		else
		{
			strcat(p_dbclt," ");
		}

		if (l_dl_localrepspec_struct_ia->i_debit_ind_100 != -1)
		{
			if (!strcmp(l_dl_localrepspec_struct_ha->h_debit_ind_100,"DOMESTIC_CPCLT"))
			{
				EXEC SQL SELECT CLN_CLAS INTO :chr_l_acc_class FROM MT_CLIENT
				WHERE cln_code = :p_domcpac;

				IS_ANY_ORA_ERROR;

				if (!strcmp(chr_l_acc_class,"2"))
				{
					strcpy(p_dbclt, &p_domcpac[strlen(p_domcpac - 3)] );
					
				}
			}

			if (!strcmp(l_dl_localrepspec_struct_ha->h_debit_ind_100,"CLIENT"))
			{
				EXEC SQL SELECT CLN_CLAS INTO :chr_l_acc_class FROM MT_CLIENT
				WHERE cln_code = :chr_p_client;

				IS_ANY_ORA_ERROR;

				if (!strcmp(chr_l_acc_class,"2"))
				{
					strcpy(p_dbclt, &chr_p_client[strlen(chr_p_client - 3)] );
					
				}
			}

			if (!strcmp(l_dl_localrepspec_struct_ha->h_debit_ind_100,"CP_CLT"))
			{
				EXEC SQL SELECT CLN_CLAS INTO :chr_l_acc_class FROM MT_CLIENT
				WHERE cln_code = :p_domcpac;

				IS_ANY_ORA_ERROR;

				if (!strcmp(chr_l_acc_class,"2"))
				{
					strcpy(p_dbclt, &p_domcpac[strlen(p_domcpac - 3)] );
					
				}
			}
		}		
	}
	
	APL_GOBACK_SUCCESS	
	
	RETURN_SUCCESS :
	{
		#ifdef SYS_DEBUG
			fprintf(APL_OUT_FILE,"Exiting CR_Rtv_LROppCust successfully\n");
		#endif
		return(APL_SUCCESS);
	}

	RETURN_FAILURE :
	{
		#ifdef SYS_DEBUG
			fprintf(APL_OUT_FILE,"Exiting CR_Rtv_LROppCust with errors\n");
		#endif
		return(APL_FAILURE);
	}
}	




int CR_Rtv_LRCust(char *chr_p_client, 
							 char *chr_p_cname, 
							 DEBUG_INFO_STRUCT_H **l_debug_info_ptr) 
{
	char h_clnt_clr_name[66] = APL_NULL_STRING;

	EXEC SQL VAR h_clnt_clr_name IS STRING;

	EXEC SQL BEGIN DECLARE SECTION;
		struct sqlca sqlca;
	EXEC SQL END DECLARE SECTION;
	sqlca.sqlcode = 0;
	
	#ifdef SYS_DEBUG
		fprintf(APL_OUT_FILE,"Entered CR_Rtv_LRCust\n");
	#endif

	EXEC SQL SELECT cln_name INTO :h_clnt_clr_name FROM MT_CLIENT
	WHERE cln_code = :chr_p_client;

	IS_ANY_ORA_ERROR;

	strcpy(chr_p_cname,h_clnt_clr_name);

	APL_GOBACK_SUCCESS

	RETURN_SUCCESS :
	{
		#ifdef SYS_DEBUG
			fprintf(APL_OUT_FILE,"Exiting CR_Rtv_LRCust successfully\n");
		#endif
		return(APL_SUCCESS);
	}

	RETURN_FAILURE :
	{
		#ifdef SYS_DEBUG
			fprintf(APL_OUT_FILE,"Exiting CR_Rtv_LRCust with errors\n");
		#endif
		return(APL_FAILURE);
	}
}


int CR_Mod_LRProcDet(char *p_procdate, 
							DEBUG_INFO_STRUCT_H **l_debug_info_ptr)
{

   EXEC SQL BEGIN DECLARE SECTION;
      struct sqlca sqlca;
   EXEC SQL END DECLARE SECTION;
   sqlca.sqlcode = 0;

   #ifdef SYS_DEBUG
      fprintf(APL_OUT_FILE,"Entered CR_Mod_LRProcDet\n");
   #endif

		EXEC SQL DELETE DL_LOCALREPPROC;
		IS_ANY_ORA_ERROR;

		EXEC SQL DELETE DL_LOCALREPPROC2;
		IS_ANY_ORA_ERROR;

		EXEC SQL DELETE DL_LOCALREPPROC3;
		IS_ANY_ORA_ERROR;

      EXEC SQL UPDATE DL_LOCALREPDATES SET LR_DT=:p_procdate
      WHERE DL_LOCALREPDATES.CLR_NAME = 1;

   IS_ANY_ORA_ERROR;

   APL_GOBACK_SUCCESS

   RETURN_SUCCESS :
   {
      #ifdef SYS_DEBUG
         fprintf(APL_OUT_FILE,"Exiting CR_Mod_LRProcDet successfully\n");
      #endif
      return(APL_SUCCESS);
   }

   RETURN_FAILURE :
   {
      #ifdef SYS_DEBUG
         fprintf(APL_OUT_FILE,"Exiting CR_Mod_LRProcDet with errors\n");
      #endif
      return(APL_FAILURE);
   }
}



int CR_Def_LRErrTxnCursor(char *chr_p_client, 
							char *chr_p_refno, 
							DEBUG_INFO_STRUCT_H **l_debug_info_ptr)
{
   EXEC SQL BEGIN DECLARE SECTION;
      struct sqlca sqlca;
   EXEC SQL END DECLARE SECTION;
   sqlca.sqlcode = 0;

   #ifdef SYS_DEBUG
      fprintf(APL_OUT_FILE,"Entered CR_Def_LRErrTxnCursor\n");
   #endif

   EXEC SQL DECLARE errtxn_curs CURSOR FOR
   SELECT NDS_DATE,NDS_BLK_DT FROM dl_deal where    client  = :chr_p_client    AND
                                                      IDENTIY_NO    = :chr_p_refno      AND
                                                      (NDS_DATE IS NOT NULL   OR
                                                      NDS_BLK_DT IS NOT NULL)
   UNION ALL
   SELECT NDS_DATE,NDS_BLK_DT FROM DL_HISDEAL where    client  = :chr_p_client    AND
                                                      IDENTIY_NO    = :chr_p_refno      AND
                                                      (NDS_DATE IS NOT NULL   OR
                                                      NDS_BLK_DT IS NOT NULL);

   IS_ANY_ORA_ERROR;

   EXEC SQL OPEN errtxn_curs;

   IS_ANY_ORA_ERROR;

   APL_GOBACK_SUCCESS

   RETURN_SUCCESS :
   {
      #ifdef SYS_DEBUG
         fprintf(APL_OUT_FILE,"Exiting CR_Def_LRErrTxnCursor successfully\n");
      #endif
      return(APL_SUCCESS);
   }

   RETURN_FAILURE :
   {
      #ifdef SYS_DEBUG
         fprintf(APL_OUT_FILE,"Exiting CR_Def_LRErrTxnCursor with errors\n");
      #endif
      return(APL_FAILURE);
   }
}



int CR_Rtv_LRErrTxnCursor( char *chr_p_ndsdt, 
								char *chr_p_ndsbldt, 
								DEBUG_INFO_STRUCT_H **l_debug_info_ptr)
{
   char chr_l_ndsdt[APL_DATE_LEN] = APL_NULL_STRING;
   char chr_l_ndsbldt[APL_DATE_LEN] = APL_NULL_STRING;
   short i_ndsdate = 0;
   short i_ndsbldate = 0;

   EXEC SQL VAR chr_l_ndsdt IS STRING;
   EXEC SQL VAR chr_l_ndsbldt IS STRING;

   EXEC SQL BEGIN DECLARE SECTION;
      struct sqlca sqlca;
   EXEC SQL END DECLARE SECTION;
   sqlca.sqlcode = 0;

   #ifdef SYS_DEBUG
      fprintf(APL_OUT_FILE,"Entered CR_Rtv_LRErrTxnCursor\n");
   #endif

   EXEC SQL FETCH errtxn_curs INTO :chr_l_ndsdt:i_ndsdate,:chr_l_ndsbldt:i_ndsbldate;

   if((sqlca.sqlcode != 0) && (sqlca.sqlcode != -1405))
   {
      IS_ANY_ORA_ERROR;
   }
   if (i_ndsdate != -1)
   {
      strncpy(chr_p_ndsdt,chr_l_ndsdt,10);
      chr_p_ndsdt[10] = '\0';
   }
   if (i_ndsbldate != -1)
   {
      strncpy(chr_p_ndsbldt,chr_l_ndsbldt,10);
      chr_p_ndsbldt[10] = '\0';
   }

   APL_GOBACK_SUCCESS

   RETURN_SUCCESS :
   {
      #ifdef SYS_DEBUG
         fprintf(APL_OUT_FILE,"Exiting CR_Rtv_LRErrTxnCursor successfully\n");
      #endif
      return(APL_SUCCESS);
   }

   RETURN_FAILURE :
   {
      #ifdef SYS_DEBUG
         fprintf(APL_OUT_FILE,"Exiting CR_Rtv_LRErrTxnCursor with errors\n");
      #endif
      return(APL_FAILURE);
   }
}






