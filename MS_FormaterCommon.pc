









#include "IV_Control_A.h"
#include "MS_Swift.h"
#include "CA_InterFace.h"
#include "CA_Common.h"
#include "CO_Commdef.h"
#include <string.h>
#include "stdio_64.h"
#include <stdlib.h>
#include <math.h>


#define MAX_ITEMS         200


#define MAX_VNAMERR_LEN     30
#define MAX_INAMERR_LEN     30
/* OPT:AIX   */
#ifdef SETTLEMENT
#undef SETTLEMENT
#endif 
#define SETTLEMENT 		  6    
#define DEALTYPE_CORP 	  9    




EXEC SQL INCLUDE SQLCA;
EXEC SQL INCLUDE SQLDA;

extern SQLDA *sqlald();
extern void sqlnul();

typedef struct{
char detail[36];
}note_desc;




extern int MS_Rtv_DataFileSelStmt(char *p_msg_no,MS_MSGENT_STRUCT *,char **,MS_STATIC_VAL **,MS_STATIC_VAL **,int *,DEBUG_INFO_STRUCT_H **);

extern int MS_Proc_SelExec(long *,char *,MS_MSGENT_STRUCT *,char *,MS_STATIC_VAL *,MS_STATIC_VAL **,FILE *,int *,long *,int *,DEBUG_INFO_STRUCT_H **);

int MS_Proc_SelectLst(long *,char *,MS_MSGENT_STRUCT *,FILE *,MS_STATIC_VAL *,MS_STATIC_VAL **,int *,long *,SQLDA *,SQLDA *,char *,DEBUG_INFO_STRUCT_H **); //AIX - Warnings Removal

extern int MS_Rtv_DataFlName(char *,long *,DEBUG_INFO_STRUCT_H **);

extern int MS_Rtv_OTHValues(long *,char *,int ,MS_STATIC_VAL *,MS_STATIC_VAL *,int * ,long *,FILE *,DEBUG_INFO_STRUCT_H **);
short l_cond_ibanacc = 0;

char chr_g_secb_flg[2]  = APL_NULL_STRING; 
char chr_g_trad_val[38] = APL_NULL_STRING; 
char chr_g_safe_val[47] = APL_NULL_STRING; 
char chr_g_setr_val[5] = APL_NULL_STRING; 	
//AIX - Warnings Removal	
/**char chr_g_stco_array[3][5] = {'\0','\0','\0','\0','\0','\0','\0','\0','\0','\0','\0','\0','\0','\0','\0'};               Commented for AIX Migration to remove warnings      ***/ 
char chr_g_stco_array[3][5] = {{'\0','\0','\0','\0','\0'},{'\0','\0','\0','\0','\0'},{'\0','\0','\0','\0','\0'}};
char chr_g_isin1[13]=APL_NULL_STRING; 
char chr_g_seme_prev[17]=APL_NULL_STRING; 




int MS_Rtv_DataFile(long *p_next_seq_no_15022,char *chr_p_client,char *p_msg_no,char *chr_p_key,
                      char *chr_p_param_str,
		      long *p_msg_seq_no,
		      char chr_p_autotransmit,
                      char *p_Data_Filename,
                      int *int_p_retstat,
                      DEBUG_INFO_STRUCT_H **l_debug_info_ptr)
{
fflush(stdout);

EXEC SQL BEGIN DECLARE SECTION;
MS_MSGENT_STRUCT l_ms_msgent_structa;
char chr_h_crf_no[3] = APL_NULL_STRING;
I_MS_MSGENT_STRUCT l_i_ms_msgent_struct;
int	chr_h_count = 0;
short int int_i_crf_no = 0;
EXEC SQL VAR l_ms_msgent_structa.client IS STRING;
EXEC SQL VAR l_ms_msgent_structa.swift_msg_no IS STRING;
EXEC SQL VAR l_ms_msgent_structa.proc_init IS STRING;
EXEC SQL VAR l_ms_msgent_structa.proc_data IS STRING;
EXEC SQL VAR chr_h_crf_no  IS STRING;
EXEC SQL END DECLARE SECTION;

struct sqlca sqlca;
FILE *INFO_FILE=NULL;
FILE *chr_finifile=NULL;
int int_returnval = 0;
int int_retstat = 0;
int int_l_seq_no=0;
int int_noelem=0;
char *chr_l_sel_msg_stmt ;
char  chr_fl_msgdatafile[PATH_LENGTH] = APL_NULL_STRING;
char chr_inifile[PATH_LENGTH]=APL_NULL_STRING;
char chr_l_data_fname[PATH_LENGTH]=APL_NULL_STRING;
char **chr_l_param;
char chr_gen_pendgs[2]=APL_NULL_STRING;
char chr_gen_alleg[2]=APL_NULL_STRING;
char chr_temp[20000]=APL_NULL_STRING; /*Changed by Mangesh for ISKB_4212 */
  char chr_deal_dt[APL_DATE_LEN] = APL_NULL_STRING;
   char chr_broker_cd[11] = APL_NULL_STRING;
   char chr_contract_cd[17] = APL_NULL_STRING;


char chr_l_data_fname_new[PATH_LENGTH]=APL_NULL_STRING;
char chr_cpy_fl_msgdatafile[PATH_LENGTH]=APL_NULL_STRING;
MS_STATIC_VAL *l_ms_static_val= NULL;
MS_STATIC_VAL *l_ms_dynamic_val=NULL;
MS_MSGENT_STRUCT l_ms_msgent_struct;
char chr_tempjunk=APL_NULL_CHAR;


#ifdef APL_THREADS
        APL_SET_CONTEXT
        EXEC SQL CONTEXT USE :my_ctx_local;
#endif


chr_l_sel_msg_stmt = (char *)calloc(20000,sizeof(char));  /*Changed by Mangesh for Issue ISKB_4212 */
memset(chr_temp,APL_NULL_CHAR,sizeof(chr_temp));
/* l_ms_static_val = (MS_STATIC_VAL *)calloc(1,sizeof(MS_STATIC_VAL));
APL_MALLOC_FAIL(l_ms_static_val);
l_ms_dynamic_val = (MS_STATIC_VAL *)calloc(1,sizeof(MS_STATIC_VAL));
APL_MALLOC_FAIL(l_ms_dynamic_val); */

memset(chr_l_sel_msg_stmt,APL_NULL_CHAR,sizeof(chr_l_sel_msg_stmt));/*Changed by Mangesh for ISKB_4212 */
memset(chr_fl_msgdatafile,APL_NULL_CHAR,PATH_LENGTH);
memset(chr_cpy_fl_msgdatafile,APL_NULL_CHAR,PATH_LENGTH);
memset(chr_inifile,APL_NULL_CHAR,PATH_LENGTH);
memset(chr_l_data_fname,APL_NULL_CHAR,PATH_LENGTH);
memset(&l_ms_msgent_structa,NULL,sizeof(MS_MSGENT_STRUCT));
memset(&l_ms_msgent_struct,NULL,sizeof(MS_MSGENT_STRUCT));

/** Added By Sana for Memory Allocation of MS_STATIC_VAL **/
if((l_ms_static_val = (MS_STATIC_VAL *)(calloc(1,sizeof(MS_STATIC_VAL *)))) == NULL)
	{
		printf("\n Problem in memory allocation for l_ms_static_val ............. \n");
		fflush(stdout);
		APL_GOBACK_FAIL
	}
if((l_ms_dynamic_val = (MS_STATIC_VAL *)(calloc(1,sizeof(MS_STATIC_VAL *)))) == NULL)
	{
		printf("\n Problem in memory allocation for l_ms_dynamic_val............. \n");
		fflush(stdout);
		APL_GOBACK_FAIL
	}

/**if (!chr_p_param_str) chr_p_param_str=&chr_tempjunk;***/
if(strlen(chr_p_param_str)==0) 
	strcpy(chr_p_param_str,APL_NULL_STRING);

	  strcpy(chr_inifile,getenv("INTL_ROOT_PATH"));
	  strcat(chr_inifile,"/intl_sun.cfg");
	  if ( (chr_finifile = fopen(chr_inifile,"r") ) == NULL)
          {
                        CO_InsertErr(l_debug_info_ptr,ERR_FILE_NOTFND, APL_NULL_STRING,
                                                                APL_NULL_STRING,
 APL_NULL_STRING, __LINE__, __FILE__);
                        APL_GOBACK_FAIL;
          }
	fflush(stdout);


 	  if(CO_ReadToken(chr_finifile,"INTL_MS_DATA_PATH",chr_fl_msgdatafile,l_debug_info_ptr) == APL_FAILURE)
          {
                        CO_InsertErr(l_debug_info_ptr,ERR_FILE_NOTFND, APL_NULL_STRING,
                                                                APL_NULL_STRING, APL_NULL_STRING, __LINE__, __FILE__);
                        APL_GOBACK_FAIL;
          }

	  strcpy(chr_cpy_fl_msgdatafile,chr_fl_msgdatafile);
	  strcat(chr_cpy_fl_msgdatafile,APL_NULL_STRING);

          int_returnval = MS_Rtv_DataFlName(chr_l_data_fname,p_msg_seq_no,l_debug_info_ptr);
          if(int_returnval == APL_FAILURE)
	  {
              APL_GOBACK_FAIL;
	  }

          strcat(chr_fl_msgdatafile,chr_l_data_fname);
			 printf("chr_fl_msgdatafile i |%s|\n",chr_fl_msgdatafile);
			 fflush(stdout);
			 printf("PATH LENGTH IS %d",PATH_LENGTH);
			 fflush(stdout);
	  strcat(chr_fl_msgdatafile,APL_NULL_STRING);

 	  if((INFO_FILE = fopen(chr_fl_msgdatafile,"w+")) == (FILE *)NULL)
 	  {
     		CO_InsertErr(l_debug_info_ptr,ERR_FILE_NOTFND, APL_NULL_STRING, APL_NULL_STRING,APL_NULL_STRING, __LINE__, __FILE__);
                APL_GOBACK_FAIL;
  
 	  }
          strcpy(p_Data_Filename,chr_l_data_fname);
          
			EXEC SQL SELECT COUNT(*) 
			INTO :chr_h_count
			FROM MS_MSGCRF 
			WHERE swift_msg_no = :p_msg_no;


   	  IS_ANY_ORA_ERROR

			printf("\n TestPrintf getting count from MS_MSGCRF ");
			fflush(stdout);					
   	  
			if ( sqlca.sqlcode == 1403)
          {
            CO_InsertErr(l_debug_info_ptr,ERR_MSG_CREFNO_NOTFND,p_msg_no,APL_NULL_STRING,APL_NULL_STRING,__LINE__ , __FILE__);
            APL_GOBACK_FAIL
          }

					
           
				strcpy(l_ms_msgent_structa.swift_msg_no,p_msg_no);
			
           strcpy(l_ms_msgent_structa.client,chr_p_client);
           strcpy(l_ms_msgent_structa.proc_init,chr_p_key);
           strcpy(l_ms_msgent_structa.proc_data,chr_p_param_str);
           int_l_seq_no=0;

	printf("satish for test p_msg_no |%s|",p_msg_no); 
	fflush(stdout);					
         
         
 
           
  if( strcmp(p_msg_no,"571") == 0)
  {
			 	printf("Inside 571!!!!!!\n");
				fflush(stdout);
             CO_SplitStr(chr_p_param_str,
                          ';', &int_noelem, &chr_l_param);
				 printf("no of elem is %d\n",int_noelem);
				 fflush(stdout);
             strcpy(l_ms_msgent_structa.proc_data,chr_l_param[0]); 
             strcat(l_ms_msgent_structa.proc_data,";");
             strcat(l_ms_msgent_structa.proc_data,chr_l_param[1]);
             strcat(l_ms_msgent_structa.proc_data,";");
             strcat(l_ms_msgent_structa.proc_data,chr_l_param[2]);
             strcat(l_ms_msgent_structa.proc_data,";");
             strcat(l_ms_msgent_structa.proc_data,chr_l_param[3]);
             strcat(l_ms_msgent_structa.proc_data,";");
             strcat(l_ms_msgent_structa.proc_data,chr_l_param[4]);
             strcat(l_ms_msgent_structa.proc_data,";");
	
               if (int_noelem == 9)
                  {  strcat(l_ms_msgent_structa.proc_data,chr_l_param[5]);
							strcat(l_ms_msgent_structa.proc_data,";");
							strcat(l_ms_msgent_structa.proc_data,chr_l_param[6]);
							strcat(l_ms_msgent_structa.proc_data,";");
							strcat(l_ms_msgent_structa.proc_data,chr_l_param[7]);
							strcat(l_ms_msgent_structa.proc_data,";");
							strcat(l_ms_msgent_structa.proc_data,chr_l_param[8]);
                     strcat(l_ms_msgent_structa.proc_data,";");}
             strcat(l_ms_msgent_structa.proc_data,"Y;S;");
   	     int_returnval = MS_Rtv_DataFileSelStmt(p_msg_no,&l_ms_msgent_structa,&chr_l_sel_msg_stmt,&l_ms_static_val, &l_ms_dynamic_val,&int_retstat,l_debug_info_ptr);
         
	      if(int_returnval == APL_FAILURE)
              {
                 CO_InsertErr(l_debug_info_ptr,ERR_MSG_NOTGENERATED,p_msg_no,chr_p_client,chr_p_key,__LINE__ , __FILE__);
                 APL_GOBACK_FAIL
	       }
             
               
			/*** Added (int) for AIX Migration ****/ 	  
			printf("chr_l_sel_msg_stmt is |%s| \nStmt Len:[%d] \n",chr_l_sel_msg_stmt, (int)strlen(chr_l_sel_msg_stmt));
   fflush(stdout);
				  
			printf("chr_l_sel_msg_stmt is |%s|\n",chr_l_sel_msg_stmt);
			fflush(stdout);
			strcpy(chr_temp,chr_l_sel_msg_stmt);
              int_returnval = MS_Proc_SelExec(p_next_seq_no_15022,p_msg_no,&l_ms_msgent_structa,chr_temp,l_ms_static_val,&l_ms_dynamic_val,INFO_FILE,&int_l_seq_no,p_msg_seq_no,&int_retstat,l_debug_info_ptr);
              if(int_returnval == APL_FAILURE)
              {
                  CO_InsertErr(l_debug_info_ptr,ERR_MSG_NOTGENERATED,p_msg_no,chr_p_client,chr_p_key,__LINE__ , __FILE__);
                  APL_GOBACK_FAIL
	      }
          if(ftell(INFO_FILE) > 0)
          {
          fprintf(INFO_FILE,"%dEOF=T\n",int_l_seq_no+1);
          fprintf(INFO_FILE,"%dACCOUNT=\n",int_l_seq_no+1);
          fprintf(INFO_FILE,"%dKEY=\n",int_l_seq_no+1);
          l_ms_msgent_struct.swift_msg_seqno = *p_msg_seq_no;
          
          strcpy(l_ms_msgent_struct.swift_msg_no,"571B");
          strcpy(l_ms_msgent_struct.proc_init,APL_NULL_STRING);
          strcpy(l_ms_msgent_struct.client,chr_p_client);
          strcpy(l_ms_msgent_struct.info_file,chr_l_data_fname);
          strcpy(l_ms_msgent_struct.proc_data,chr_p_param_str);
          l_ms_msgent_struct.auto_tran_ind[0] = chr_p_autotransmit;
          l_ms_msgent_struct.auto_tran_ind[1] = APL_NULL_CHAR;
          l_ms_msgent_struct.status_ind[0] = 'P';
          l_ms_msgent_struct.status_ind[1] = APL_NULL_CHAR;
          l_ms_msgent_struct.swift_count = 0;
          l_ms_msgent_struct.gcn_count = 0;
          l_ms_msgent_struct.telex_count = 0;
          l_ms_msgent_struct.fax_count = 0;
          l_ms_msgent_struct.clts_count = 0;

          int_returnval = MS_Mod_MsgEntAdd(l_ms_msgent_struct,&int_retstat,l_debug_info_ptr);
          if(int_returnval == APL_FAILURE)
          {
            APL_GOBACK_FAIL
          }
           } 
          fclose(INFO_FILE);



				
           int_l_seq_no = 0;
           memset(chr_l_data_fname,APL_NULL_CHAR,PATH_LENGTH);
           int_returnval = MS_Rtv_DataFlName(chr_l_data_fname,p_msg_seq_no,l_debug_info_ptr);
           if(int_returnval == APL_FAILURE)
               APL_GOBACK_FAIL;

           memset(chr_fl_msgdatafile,APL_NULL_CHAR,PATH_LENGTH);
           strcpy(chr_fl_msgdatafile,chr_cpy_fl_msgdatafile);
           strcat(chr_fl_msgdatafile,chr_l_data_fname);
			  
           if((INFO_FILE = fopen(chr_fl_msgdatafile,"w+")) == (FILE *)NULL)
           {
                 CO_InsertErr(l_debug_info_ptr,ERR_FILE_NOTFND, APL_NULL_STRING, APL_NULL_STRING,APL_NULL_STRING, __LINE__, __FILE__);
                 APL_GOBACK_FAIL;

           }

   	     int_returnval = MS_Rtv_DataFileSelStmt("535B",&l_ms_msgent_structa,&chr_l_sel_msg_stmt,&l_ms_static_val, &l_ms_dynamic_val,&int_retstat,l_debug_info_ptr);
         
	      if(int_returnval == APL_FAILURE)
              {
                 CO_InsertErr(l_debug_info_ptr,ERR_MSG_NOTGENERATED,p_msg_no,chr_p_client,chr_p_key,__LINE__ , __FILE__);
                 APL_GOBACK_FAIL
	       }
             
              printf("\n TestPrintf returning MS_Rtv_DataFileSelStmt() functioncal ");
			  fflush(stdout);
              
	          strcpy(chr_temp,chr_l_sel_msg_stmt); 
              int_returnval = MS_Proc_SelExec(p_next_seq_no_15022,"535B",&l_ms_msgent_structa,chr_temp,l_ms_static_val,&l_ms_dynamic_val,INFO_FILE,&int_l_seq_no,p_msg_seq_no,&int_retstat,l_debug_info_ptr);
              if(int_returnval == APL_FAILURE)
              {
                  CO_InsertErr(l_debug_info_ptr,ERR_MSG_NOTGENERATED,p_msg_no,chr_p_client,chr_p_key,__LINE__ , __FILE__);
                  APL_GOBACK_FAIL
			  }

			  printf("\n TestPrintf returning MS_Proc_SelExec() functioncal ");
			  fflush(stdout);


          if(ftell(INFO_FILE) > 0)
          {
          fprintf(INFO_FILE,"%dEOF=T\n",int_l_seq_no+1);
          fprintf(INFO_FILE,"%dACCOUNT=\n",int_l_seq_no+1);
          fprintf(INFO_FILE,"%dKEY=\n",int_l_seq_no+1);
          l_ms_msgent_struct.swift_msg_seqno = *p_msg_seq_no;
          
          strcpy(l_ms_msgent_struct.swift_msg_no,"535B");
          strcpy(l_ms_msgent_struct.proc_init,APL_NULL_STRING);
          strcpy(l_ms_msgent_struct.client,chr_p_client);
          strcpy(l_ms_msgent_struct.info_file,chr_l_data_fname);
          strcpy(l_ms_msgent_struct.proc_data,chr_p_param_str);
          l_ms_msgent_struct.auto_tran_ind[0] = chr_p_autotransmit;
          l_ms_msgent_struct.auto_tran_ind[1] = APL_NULL_CHAR;
          l_ms_msgent_struct.status_ind[0] = 'R';
          l_ms_msgent_struct.status_ind[1] = APL_NULL_CHAR;
          l_ms_msgent_struct.swift_count = 0;
          l_ms_msgent_struct.gcn_count = 0;
          l_ms_msgent_struct.telex_count = 0;
          l_ms_msgent_struct.fax_count = 0;
          l_ms_msgent_struct.clts_count = 0;


          int_returnval = MS_Mod_MsgEntAdd(l_ms_msgent_struct,&int_retstat,l_debug_info_ptr);
          if(int_returnval == APL_FAILURE)
          {
            APL_GOBACK_FAIL
          }
           }         
          fclose(INFO_FILE);

			printf("\n TestPrintf returning MS_Mod_MsgEntAdd() functioncal ");
			fflush(stdout);


	         
           int_l_seq_no = 0;
           memset(chr_l_data_fname,APL_NULL_CHAR,PATH_LENGTH);
           int_returnval = MS_Rtv_DataFlName(chr_l_data_fname,p_msg_seq_no,l_debug_info_ptr);
           if(int_returnval == APL_FAILURE)
               APL_GOBACK_FAIL;

           memset(chr_fl_msgdatafile,APL_NULL_CHAR,PATH_LENGTH);
           strcpy(chr_fl_msgdatafile,chr_cpy_fl_msgdatafile);
           strcat(chr_fl_msgdatafile,chr_l_data_fname);
			  
           if((INFO_FILE = fopen(chr_fl_msgdatafile,"w+")) == (FILE *)NULL)
           {
                 CO_InsertErr(l_debug_info_ptr,ERR_FILE_NOTFND, APL_NULL_STRING, APL_NULL_STRING,APL_NULL_STRING, __LINE__, __FILE__);
                 APL_GOBACK_FAIL;

           }

              strcpy(l_ms_msgent_structa.proc_data,chr_p_param_str);
              strcat(l_ms_msgent_structa.proc_data,"Y;T;");
              int_returnval = MS_Rtv_DataFileSelStmt(p_msg_no,&l_ms_msgent_structa,&chr_l_sel_msg_stmt,&l_ms_static_val, &l_ms_dynamic_val,&int_retstat, l_debug_info_ptr);

               if(int_returnval == APL_FAILURE)
               {
                  CO_InsertErr(l_debug_info_ptr,ERR_MSG_NOTGENERATED,p_msg_no,chr_p_client,chr_p_key,__LINE__ , __FILE__);
                  APL_GOBACK_FAIL
                }

			printf("\n TestPrintf returning MS_Rtv_DataFileSelStmt() functioncal ");
			fflush(stdout);           
               
               
	         strcpy(chr_temp,chr_l_sel_msg_stmt);	
               int_returnval = MS_Proc_SelExec(p_next_seq_no_15022,p_msg_no,&l_ms_msgent_structa,chr_temp,l_ms_static_val,&l_ms_dynamic_val,INFO_FILE,&int_l_seq_no,p_msg_seq_no,&int_retstat,l_debug_info_ptr);
               if(int_returnval == APL_FAILURE)
               {
                   CO_InsertErr(l_debug_info_ptr,ERR_MSG_NOTGENERATED,p_msg_no,chr_p_client,chr_p_key,__LINE__ , __FILE__);
                   APL_GOBACK_FAIL
               }
            if(ftell(INFO_FILE) > 0) 
          {
           fprintf(INFO_FILE,"%dEOF=T\n",int_l_seq_no+1);
           fprintf(INFO_FILE,"%dACCOUNT=\n",int_l_seq_no+1);
           fprintf(INFO_FILE,"%dKEY=\n",int_l_seq_no+1);
           l_ms_msgent_struct.swift_msg_seqno = *p_msg_seq_no;
           
           strcpy(l_ms_msgent_struct.swift_msg_no,"571B");
           strcpy(l_ms_msgent_struct.proc_init,APL_NULL_STRING);
           strcpy(l_ms_msgent_struct.client,chr_p_client);
           strcpy(l_ms_msgent_struct.info_file,chr_l_data_fname);
           strcpy(l_ms_msgent_struct.proc_data,chr_p_param_str);
           l_ms_msgent_struct.auto_tran_ind[0] = chr_p_autotransmit;
          l_ms_msgent_struct.auto_tran_ind[1] = APL_NULL_CHAR;
           l_ms_msgent_struct.status_ind[0] = 'P';
           l_ms_msgent_struct.status_ind[1] = APL_NULL_CHAR;
           l_ms_msgent_struct.swift_count = 0;
           l_ms_msgent_struct.gcn_count = 0;
           l_ms_msgent_struct.telex_count = 0;
           l_ms_msgent_struct.fax_count = 0;
           l_ms_msgent_struct.clts_count = 0;


           int_returnval = MS_Mod_MsgEntAdd(l_ms_msgent_struct,&int_retstat,l_debug_info_ptr);
           if(int_returnval == APL_FAILURE)
           {
             APL_GOBACK_FAIL
           }
			} 

			printf("\n TestPrintf returning MS_Mod_MsgEntAdd() functioncal ");
			fflush(stdout);           


           fclose(INFO_FILE);

	         
          if(strcmp(chr_l_param[2],"Y") == 0)
          {
          int_l_seq_no = 0;
	  memset(chr_l_data_fname,APL_NULL_CHAR,PATH_LENGTH);
          int_returnval = MS_Rtv_DataFlName(chr_l_data_fname,p_msg_seq_no,l_debug_info_ptr);
          if(int_returnval == APL_FAILURE)
              APL_GOBACK_FAIL;

	  memset(chr_fl_msgdatafile,APL_NULL_CHAR,PATH_LENGTH);
          strcpy(chr_fl_msgdatafile,chr_cpy_fl_msgdatafile);
          strcat(chr_fl_msgdatafile,chr_l_data_fname);
			 
          if((INFO_FILE = fopen(chr_fl_msgdatafile,"w+")) == (FILE *)NULL)
          {
                CO_InsertErr(l_debug_info_ptr,ERR_FILE_NOTFND, APL_NULL_STRING, APL_NULL_STRING,APL_NULL_STRING, __LINE__, __FILE__);
                APL_GOBACK_FAIL;
 
          }

           strcpy(l_ms_msgent_structa.proc_data,chr_p_param_str);
           strcat(l_ms_msgent_structa.proc_data,"Y;;");
            int_returnval = MS_Rtv_DataFileSelStmt("571A",&l_ms_msgent_structa,&chr_l_sel_msg_stmt,&l_ms_static_val, &l_ms_dynamic_val,&int_retstat,l_debug_info_ptr);

         if(int_returnval == APL_FAILURE)
              {
                 CO_InsertErr(l_debug_info_ptr,ERR_MSG_NOTGENERATED,p_msg_no,chr_p_client,chr_p_key,__LINE__ , __FILE__);
                 APL_GOBACK_FAIL
          }

               
              
              
	           strcpy(chr_temp,chr_l_sel_msg_stmt);	
              int_returnval = MS_Proc_SelExec(p_next_seq_no_15022,"571A",&l_ms_msgent_structa,chr_temp,l_ms_static_val,&l_ms_dynamic_val,INFO_FILE,&int_l_seq_no,p_msg_seq_no,&int_retstat,l_debug_info_ptr);
              if(int_returnval == APL_FAILURE)
              {
                  CO_InsertErr(l_debug_info_ptr,ERR_MSG_NOTGENERATED,p_msg_no,chr_p_client,chr_p_key,__LINE__ , __FILE__);
                  APL_GOBACK_FAIL
         }

			printf("\n TestPrintf returning MS_Mod_MsgEntAdd() 571A functioncal ");
			fflush(stdout);           

			 if(ftell(INFO_FILE) > 0) 
          {
          fprintf(INFO_FILE,"%dEOF=T\n",int_l_seq_no+1);
          fprintf(INFO_FILE,"%dACCOUNT=\n",int_l_seq_no+1);
          fprintf(INFO_FILE,"%dKEY=\n",int_l_seq_no+1);
          l_ms_msgent_struct.swift_msg_seqno = *p_msg_seq_no;
          
          strcpy(l_ms_msgent_struct.swift_msg_no,"571A");
          strcpy(l_ms_msgent_struct.proc_init,APL_NULL_STRING);
          strcpy(l_ms_msgent_struct.client,chr_p_client);
          strcpy(l_ms_msgent_struct.info_file,chr_l_data_fname);
          strcpy(l_ms_msgent_struct.proc_data,chr_p_param_str);
          l_ms_msgent_struct.auto_tran_ind[0] = chr_p_autotransmit;
          l_ms_msgent_struct.auto_tran_ind[1] = APL_NULL_CHAR;
          l_ms_msgent_struct.status_ind[0] = 'P';
          l_ms_msgent_struct.status_ind[1] = APL_NULL_CHAR;
          l_ms_msgent_struct.swift_count = 0;
          l_ms_msgent_struct.gcn_count = 0;
          l_ms_msgent_struct.telex_count = 0;
          l_ms_msgent_struct.fax_count = 0;
          l_ms_msgent_struct.clts_count = 0;


          int_returnval = MS_Mod_MsgEntAdd(l_ms_msgent_struct,&int_retstat,l_debug_info_ptr);
          if(int_returnval == APL_FAILURE)
          {
            APL_GOBACK_FAIL
          }
          } 



          int_l_seq_no = 0;
				memset(chr_l_data_fname_new,APL_NULL_CHAR,PATH_LENGTH);
          	int_returnval = MS_Rtv_DataFlName(chr_l_data_fname_new,p_msg_seq_no,l_debug_info_ptr);
          	if(int_returnval == APL_FAILURE)
              APL_GOBACK_FAIL;

           l_ms_msgent_struct.swift_msg_seqno = *p_msg_seq_no;
           
           strcpy(l_ms_msgent_struct.swift_msg_no,"535A");
           strcpy(l_ms_msgent_struct.proc_init,APL_NULL_STRING);
           strcpy(l_ms_msgent_struct.client,chr_p_client);
           strcpy(l_ms_msgent_struct.info_file,chr_l_data_fname);
           strcpy(l_ms_msgent_struct.proc_data,chr_p_param_str);
           l_ms_msgent_struct.auto_tran_ind[0] = chr_p_autotransmit;
           l_ms_msgent_struct.auto_tran_ind[1] =APL_NULL_CHAR;
           l_ms_msgent_struct.status_ind[0] = 'R';
           l_ms_msgent_struct.status_ind[1] = APL_NULL_CHAR;
           l_ms_msgent_struct.swift_count = 0;
           l_ms_msgent_struct.gcn_count = 0;
           l_ms_msgent_struct.telex_count = 0;
           l_ms_msgent_struct.fax_count = 0;
           l_ms_msgent_struct.clts_count = 0;


           int_returnval = MS_Mod_MsgEntAdd(l_ms_msgent_struct,&int_retstat,l_debug_info_ptr);
           if(int_returnval == APL_FAILURE)
           {
             APL_GOBACK_FAIL
           }


          fclose(INFO_FILE);
	  } 

          if(strcmp(chr_l_param[2],"Y") == 0)
          {
          int_l_seq_no = 0;
          memset(chr_l_data_fname,APL_NULL_CHAR,PATH_LENGTH);
          int_returnval = MS_Rtv_DataFlName(chr_l_data_fname,p_msg_seq_no,l_debug_info_ptr);
          if(int_returnval == APL_FAILURE)
              APL_GOBACK_FAIL;

          memset(chr_fl_msgdatafile,APL_NULL_CHAR,PATH_LENGTH);
          strcpy(chr_fl_msgdatafile,chr_cpy_fl_msgdatafile);
          strcat(chr_fl_msgdatafile,chr_l_data_fname);
			 
          if((INFO_FILE = fopen(chr_fl_msgdatafile,"w+")) == (FILE *)NULL)
          {
                CO_InsertErr(l_debug_info_ptr,ERR_FILE_NOTFND, APL_NULL_STRING, APL_NULL_STRING,APL_NULL_STRING, __LINE__, __FILE__);
                APL_GOBACK_FAIL;

          }

           strcpy(l_ms_msgent_structa.proc_data,chr_p_param_str);
           strcat(l_ms_msgent_structa.proc_data,"N;;");
            int_returnval = MS_Rtv_DataFileSelStmt("571A",&l_ms_msgent_structa,&chr_l_sel_msg_stmt,&l_ms_static_val, &l_ms_dynamic_val,&int_retstat,l_debug_info_ptr);

         if(int_returnval == APL_FAILURE)
              {
                 CO_InsertErr(l_debug_info_ptr,ERR_MSG_NOTGENERATED,p_msg_no,chr_p_client,chr_p_key,__LINE__ , __FILE__);
                 APL_GOBACK_FAIL
          }

               
              
              
	         strcpy(chr_temp,chr_l_sel_msg_stmt);			  
              int_returnval = MS_Proc_SelExec(p_next_seq_no_15022,"571A",&l_ms_msgent_structa,chr_temp,l_ms_static_val,&l_ms_dynamic_val,INFO_FILE,&int_l_seq_no,p_msg_seq_no,&int_retstat,l_debug_info_ptr);
              if(int_returnval == APL_FAILURE)
              {
                  CO_InsertErr(l_debug_info_ptr,ERR_MSG_NOTGENERATED,p_msg_no,chr_p_client,chr_p_key,__LINE__ , __FILE__);
                  APL_GOBACK_FAIL
	         }

			printf("\n TestPrintf returning MS_Proc_SelExec() 571A functioncal ");
			fflush(stdout);           


          if(ftell(INFO_FILE) > 0) 
          {
          fprintf(INFO_FILE,"%dEOF=T\n",int_l_seq_no+1);
          fprintf(INFO_FILE,"%dACCOUNT=\n",int_l_seq_no+1);
          fprintf(INFO_FILE,"%dKEY=\n",int_l_seq_no+1);
          l_ms_msgent_struct.swift_msg_seqno = *p_msg_seq_no;
          
          strcpy(l_ms_msgent_struct.swift_msg_no,"571A");
          strcpy(l_ms_msgent_struct.proc_init,APL_NULL_STRING);
          strcpy(l_ms_msgent_struct.client,chr_p_client);
          strcpy(l_ms_msgent_struct.info_file,chr_l_data_fname);
          strcpy(l_ms_msgent_struct.proc_data,chr_p_param_str);
          l_ms_msgent_struct.auto_tran_ind[0] = chr_p_autotransmit;
			 l_ms_msgent_struct.auto_tran_ind[1] =APL_NULL_CHAR;
          l_ms_msgent_struct.status_ind[0] = 'P';
			 l_ms_msgent_struct.status_ind[1] = APL_NULL_CHAR;
          l_ms_msgent_struct.swift_count = 0;
          l_ms_msgent_struct.gcn_count = 0;
          l_ms_msgent_struct.telex_count = 0;
          l_ms_msgent_struct.fax_count = 0;
          l_ms_msgent_struct.clts_count = 0;


          int_returnval = MS_Mod_MsgEntAdd(l_ms_msgent_struct,&int_retstat,l_debug_info_ptr);
          if(int_returnval == APL_FAILURE)
          {
            APL_GOBACK_FAIL
          }
          } 



          int_l_seq_no = 0;
				memset(chr_l_data_fname_new,APL_NULL_CHAR,PATH_LENGTH);
          	int_returnval = MS_Rtv_DataFlName(chr_l_data_fname_new,p_msg_seq_no,l_debug_info_ptr);
          	if(int_returnval == APL_FAILURE)
              APL_GOBACK_FAIL;


           l_ms_msgent_struct.swift_msg_seqno = *p_msg_seq_no;
           
           strcpy(l_ms_msgent_struct.swift_msg_no,"535A");
           strcpy(l_ms_msgent_struct.proc_init,APL_NULL_STRING);
           strcpy(l_ms_msgent_struct.client,chr_p_client);
           strcpy(l_ms_msgent_struct.info_file,chr_l_data_fname);
           strcpy(l_ms_msgent_struct.proc_data,chr_p_param_str);
           l_ms_msgent_struct.auto_tran_ind[0] = chr_p_autotransmit;
l_ms_msgent_struct.auto_tran_ind[1] =APL_NULL_CHAR;
           l_ms_msgent_struct.status_ind[0] = 'R';
				l_ms_msgent_struct.status_ind[1] = APL_NULL_CHAR;
           l_ms_msgent_struct.swift_count = 0;
           l_ms_msgent_struct.gcn_count = 0;
           l_ms_msgent_struct.telex_count = 0;
           l_ms_msgent_struct.fax_count = 0;
           l_ms_msgent_struct.clts_count = 0;


           int_returnval = MS_Mod_MsgEntAdd(l_ms_msgent_struct,&int_retstat,l_debug_info_ptr);
           if(int_returnval == APL_FAILURE)
           {
             APL_GOBACK_FAIL
           }



          fclose(INFO_FILE);

         
          int_l_seq_no = 0;
          memset(chr_l_data_fname,APL_NULL_CHAR,PATH_LENGTH);
          int_returnval = MS_Rtv_DataFlName(chr_l_data_fname,p_msg_seq_no,l_debug_info_ptr);
          if(int_returnval == APL_FAILURE)
              APL_GOBACK_FAIL;

          memset(chr_fl_msgdatafile,APL_NULL_CHAR,PATH_LENGTH);
          strcpy(chr_fl_msgdatafile,chr_cpy_fl_msgdatafile);
          strcat(chr_fl_msgdatafile,chr_l_data_fname);

          if((INFO_FILE = fopen(chr_fl_msgdatafile,"w+")) == (FILE *)NULL)
          {
                CO_InsertErr(l_debug_info_ptr,ERR_FILE_NOTFND, APL_NULL_STRING, APL_NULL_STRING,APL_NULL_STRING, __LINE__, __FILE__);
                APL_GOBACK_FAIL;

          }

           strcpy(l_ms_msgent_structa.proc_data,chr_p_param_str);
           strcat(l_ms_msgent_structa.proc_data,"N;;");
            int_returnval = MS_Rtv_DataFileSelStmt("571C",&l_ms_msgent_structa,&chr_l_sel_msg_stmt,&l_ms_static_val, &l_ms_dynamic_val,&int_retstat,l_debug_info_ptr);

         if(int_returnval == APL_FAILURE)
              {
                 CO_InsertErr(l_debug_info_ptr,ERR_MSG_NOTGENERATED,p_msg_no,chr_p_client,chr_p_key,__LINE__ , __FILE__);
                 APL_GOBACK_FAIL
          }

			         strcpy(chr_temp,chr_l_sel_msg_stmt);
              int_returnval = MS_Proc_SelExec(p_next_seq_no_15022,"571A",&l_ms_msgent_structa,chr_temp,l_ms_static_val,&l_ms_dynamic_val,INFO_FILE,&int_l_seq_no,p_msg_seq_no,&int_retstat,l_debug_info_ptr);
              if(int_returnval == APL_FAILURE)
              {
                  CO_InsertErr(l_debug_info_ptr,ERR_MSG_NOTGENERATED,p_msg_no,chr_p_client,chr_p_key,__LINE__ , __FILE__);
                  APL_GOBACK_FAIL
         }
          fprintf(INFO_FILE,"%dEOF=T\n",int_l_seq_no+1);
          fprintf(INFO_FILE,"%dACCOUNT=\n",int_l_seq_no+1);
          fprintf(INFO_FILE,"%dKEY=\n",int_l_seq_no+1);
          l_ms_msgent_struct.swift_msg_seqno = *p_msg_seq_no;
          strcpy(l_ms_msgent_struct.swift_msg_no,"571A");
          strcpy(l_ms_msgent_struct.proc_init,APL_NULL_STRING);
          strcpy(l_ms_msgent_struct.client,chr_p_client);
          strcpy(l_ms_msgent_struct.info_file,chr_l_data_fname);
          strcpy(l_ms_msgent_struct.proc_data,chr_p_param_str);
          l_ms_msgent_struct.auto_tran_ind[0] = chr_p_autotransmit;
          l_ms_msgent_struct.status_ind[0] = 'P';
l_ms_msgent_struct.auto_tran_ind[1] =APL_NULL_CHAR;
l_ms_msgent_struct.status_ind[1] = APL_NULL_CHAR;
          l_ms_msgent_struct.swift_count = 0;
          l_ms_msgent_struct.gcn_count = 0;
          l_ms_msgent_struct.telex_count = 0;
          l_ms_msgent_struct.fax_count = 0;
          l_ms_msgent_struct.clts_count = 0;

          int_returnval = MS_Mod_MsgEntAdd(l_ms_msgent_struct,&int_retstat,l_debug_info_ptr);
          if(int_returnval == APL_FAILURE)
          {
            APL_GOBACK_FAIL
          }

          int_l_seq_no = 0;
            memset(chr_l_data_fname_new,APL_NULL_CHAR,PATH_LENGTH);
            int_returnval = MS_Rtv_DataFlName(chr_l_data_fname_new,p_msg_seq_no,l_debug_info_ptr);
            if(int_returnval == APL_FAILURE)
              APL_GOBACK_FAIL;

           l_ms_msgent_struct.swift_msg_seqno = *p_msg_seq_no;
           strcpy(l_ms_msgent_struct.swift_msg_no,"535A");
           strcpy(l_ms_msgent_struct.proc_init,APL_NULL_STRING);
           strcpy(l_ms_msgent_struct.client,chr_p_client);
           strcpy(l_ms_msgent_struct.info_file,chr_l_data_fname);
           strcpy(l_ms_msgent_struct.proc_data,chr_p_param_str);
           l_ms_msgent_struct.auto_tran_ind[0] = chr_p_autotransmit;
           l_ms_msgent_struct.status_ind[0] = 'R';
l_ms_msgent_struct.auto_tran_ind[1] =APL_NULL_CHAR;
l_ms_msgent_struct.status_ind[1] = APL_NULL_CHAR;
           l_ms_msgent_struct.swift_count = 0;
           l_ms_msgent_struct.gcn_count = 0;
           l_ms_msgent_struct.telex_count = 0;
           l_ms_msgent_struct.fax_count = 0;
           l_ms_msgent_struct.clts_count = 0;

           int_returnval = MS_Mod_MsgEntAdd(l_ms_msgent_struct,&int_retstat,l_debug_info_ptr);
           if(int_returnval == APL_FAILURE)
           {
             APL_GOBACK_FAIL
           }

          fclose(INFO_FILE);

         

          } 



          

          int_l_seq_no = 0;
     memset(chr_l_data_fname,APL_NULL_CHAR,PATH_LENGTH);
          int_returnval = MS_Rtv_DataFlName(chr_l_data_fname,p_msg_seq_no,l_debug_info_ptr);
          if(int_returnval == APL_FAILURE)
              APL_GOBACK_FAIL;

     memset(chr_fl_msgdatafile,APL_NULL_CHAR,PATH_LENGTH);
          strcpy(chr_fl_msgdatafile,chr_cpy_fl_msgdatafile);
          strcat(chr_fl_msgdatafile,chr_l_data_fname);
          
          if((INFO_FILE = fopen(chr_fl_msgdatafile,"w+")) == (FILE *)NULL)
          {
                CO_InsertErr(l_debug_info_ptr,ERR_FILE_NOTFND, APL_NULL_STRING, APL_NULL_STRING,APL_NULL_STRING, __LINE__, __FILE__);
                APL_GOBACK_FAIL;

          }
          strcpy(p_Data_Filename,chr_l_data_fname);
              strcpy(l_ms_msgent_structa.proc_data,chr_p_param_str);
              strcat(l_ms_msgent_structa.proc_data,"N;;");
            int_returnval = MS_Rtv_DataFileSelStmt("535C",&l_ms_msgent_structa,&chr_l_sel_msg_stmt,&l_ms_static_val, &l_ms_dynamic_val,&int_retstat,l_debug_info_ptr);

         if(int_returnval == APL_FAILURE)
              {
                 CO_InsertErr(l_debug_info_ptr,ERR_MSG_NOTGENERATED,"535C",chr_p_client,chr_p_key,
                              __LINE__ , __FILE__);
                 APL_GOBACK_FAIL
          }

               
              
                      strcpy(chr_temp,chr_l_sel_msg_stmt); 
              
              int_returnval = MS_Proc_SelExec(p_next_seq_no_15022,"571",&l_ms_msgent_structa,chr_temp,
                  l_ms_static_val,&l_ms_dynamic_val,INFO_FILE,&int_l_seq_no,p_msg_seq_no,&int_retstat,l_debug_info_ptr);
              if(int_returnval == APL_FAILURE)
              {
                  CO_InsertErr(l_debug_info_ptr,ERR_MSG_NOTGENERATED,p_msg_no,chr_p_client,chr_p_key,__LINE__ , __FILE__);
                  APL_GOBACK_FAIL
         }

          fprintf(INFO_FILE,"%dEOF=T\n",int_l_seq_no+1);
          fprintf(INFO_FILE,"%dACCOUNT=\n",int_l_seq_no+1);
          fprintf(INFO_FILE,"%dKEY=\n",int_l_seq_no+1);
          l_ms_msgent_struct.swift_msg_seqno = *p_msg_seq_no;
          strcpy(l_ms_msgent_struct.swift_msg_no,"571");
          strcpy(l_ms_msgent_struct.proc_init,APL_NULL_STRING);
          strcpy(l_ms_msgent_struct.client,chr_p_client);
          strcpy(l_ms_msgent_struct.info_file,chr_l_data_fname);
          strcpy(l_ms_msgent_struct.proc_data,chr_p_param_str);
          l_ms_msgent_struct.auto_tran_ind[0] = chr_p_autotransmit;
          l_ms_msgent_struct.status_ind[0] = 'P';
l_ms_msgent_struct.auto_tran_ind[1] =APL_NULL_CHAR;
l_ms_msgent_struct.status_ind[1] = APL_NULL_CHAR;
          l_ms_msgent_struct.swift_count = 0;
          l_ms_msgent_struct.gcn_count = 0;
          l_ms_msgent_struct.telex_count = 0;
          l_ms_msgent_struct.fax_count = 0;
          l_ms_msgent_struct.clts_count = 0;
          int_returnval = MS_Mod_MsgEntAdd(l_ms_msgent_struct,&int_retstat,l_debug_info_ptr);
          if(int_returnval == APL_FAILURE)
          {
            APL_GOBACK_FAIL
          }

          int_l_seq_no = 0;
            memset(chr_l_data_fname_new,APL_NULL_CHAR,PATH_LENGTH);
            int_returnval = MS_Rtv_DataFlName(chr_l_data_fname_new,p_msg_seq_no,l_debug_info_ptr);
            if(int_returnval == APL_FAILURE)
              APL_GOBACK_FAIL;
           l_ms_msgent_struct.swift_msg_seqno = *p_msg_seq_no;
           
           strcpy(l_ms_msgent_struct.swift_msg_no,"535");
           strcpy(l_ms_msgent_struct.proc_init,APL_NULL_STRING);
           strcpy(l_ms_msgent_struct.client,chr_p_client);
           strcpy(l_ms_msgent_struct.info_file,chr_l_data_fname);
           strcpy(l_ms_msgent_struct.proc_data,chr_p_param_str);
           l_ms_msgent_struct.auto_tran_ind[0] = chr_p_autotransmit;
           l_ms_msgent_struct.status_ind[0] = 'R';
l_ms_msgent_struct.auto_tran_ind[1] =APL_NULL_CHAR;
l_ms_msgent_struct.status_ind[1] = APL_NULL_CHAR;
           l_ms_msgent_struct.swift_count = 0;
           l_ms_msgent_struct.gcn_count = 0;
           l_ms_msgent_struct.telex_count = 0;
           l_ms_msgent_struct.fax_count = 0;
           l_ms_msgent_struct.clts_count = 0;

           int_returnval = MS_Mod_MsgEntAdd(l_ms_msgent_struct,&int_retstat,l_debug_info_ptr);
           if(int_returnval == APL_FAILURE)
           {
             APL_GOBACK_FAIL
           }


          fclose(INFO_FILE);
         

          

          int_l_seq_no = 0;
	  memset(chr_l_data_fname,APL_NULL_CHAR,PATH_LENGTH);
          int_returnval = MS_Rtv_DataFlName(chr_l_data_fname,p_msg_seq_no,l_debug_info_ptr);
          if(int_returnval == APL_FAILURE)
              APL_GOBACK_FAIL;

	  memset(chr_fl_msgdatafile,APL_NULL_CHAR,PATH_LENGTH);
          strcpy(chr_fl_msgdatafile,chr_cpy_fl_msgdatafile);
          strcat(chr_fl_msgdatafile,chr_l_data_fname);
			 
          if((INFO_FILE = fopen(chr_fl_msgdatafile,"w+")) == (FILE *)NULL)
          {
                CO_InsertErr(l_debug_info_ptr,ERR_FILE_NOTFND, APL_NULL_STRING, APL_NULL_STRING,APL_NULL_STRING, __LINE__, __FILE__);
                APL_GOBACK_FAIL;
 
          }

          strcpy(p_Data_Filename,chr_l_data_fname);
              strcpy(l_ms_msgent_structa.proc_data,chr_p_param_str);
              strcat(l_ms_msgent_structa.proc_data,"N;;");
   	      int_returnval = MS_Rtv_DataFileSelStmt(p_msg_no,&l_ms_msgent_structa,&chr_l_sel_msg_stmt,&l_ms_static_val, &l_ms_dynamic_val,&int_retstat,l_debug_info_ptr);
         
	      if(int_returnval == APL_FAILURE)
              {
                 CO_InsertErr(l_debug_info_ptr,ERR_MSG_NOTGENERATED,p_msg_no,chr_p_client,chr_p_key,__LINE__ , __FILE__);
                 APL_GOBACK_FAIL
	       }
             
			printf("\n TestPrintf returning MS_Proc_SelExec() p_next_seq_no_15022 functioncal ");
			fflush(stdout);           			   
              
              
			strcpy(chr_temp,chr_l_sel_msg_stmt); 
              int_returnval = MS_Proc_SelExec(p_next_seq_no_15022,p_msg_no,&l_ms_msgent_structa,chr_temp,l_ms_static_val,&l_ms_dynamic_val,INFO_FILE,&int_l_seq_no,p_msg_seq_no,&int_retstat,l_debug_info_ptr);
              if(int_returnval == APL_FAILURE)
              {
                  CO_InsertErr(l_debug_info_ptr,ERR_MSG_NOTGENERATED,p_msg_no,chr_p_client,chr_p_key,__LINE__ , __FILE__);
                  APL_GOBACK_FAIL
	      }

   } 
	   else if(strcmp(p_msg_no,"573") == 0)
	   {
			

	      
	      
	      strcat(l_ms_msgent_structa.proc_data,"N;");

   	      int_returnval = MS_Rtv_DataFileSelStmt(p_msg_no,&l_ms_msgent_structa,&chr_l_sel_msg_stmt,&l_ms_static_val, &l_ms_dynamic_val,&int_retstat,l_debug_info_ptr);
         
	      if(int_returnval == APL_FAILURE)
              {
                 CO_InsertErr(l_debug_info_ptr,ERR_MSG_NOTGENERATED,p_msg_no,chr_p_client,chr_p_key,__LINE__ , __FILE__);
                 APL_GOBACK_FAIL
	       }
             
               
              
              
				          strcpy(chr_temp,chr_l_sel_msg_stmt); 
              int_returnval = MS_Proc_SelExec(p_next_seq_no_15022,p_msg_no,&l_ms_msgent_structa,chr_temp,l_ms_static_val,&l_ms_dynamic_val,INFO_FILE,&int_l_seq_no,p_msg_seq_no,&int_retstat,l_debug_info_ptr);
              if(int_returnval == APL_FAILURE)
              {
                  CO_InsertErr(l_debug_info_ptr,ERR_MSG_NOTGENERATED,p_msg_no,chr_p_client,chr_p_key,__LINE__ , __FILE__);
                  APL_GOBACK_FAIL
	       }

	      strcpy(l_ms_msgent_structa.proc_data,chr_p_param_str);

              CO_SplitStr(chr_p_param_str,';', &int_noelem, &chr_l_param);
              strcpy(chr_gen_pendgs,chr_l_param[1]);
	      if(strcmp(chr_gen_pendgs,"Y") == 0)
	      { 
	      strcat(l_ms_msgent_structa.proc_data,"Y;");
   	      int_returnval = MS_Rtv_DataFileSelStmt(p_msg_no,&l_ms_msgent_structa,&chr_l_sel_msg_stmt,&l_ms_static_val, &l_ms_dynamic_val,&int_retstat,l_debug_info_ptr);
         
	      if(int_returnval == APL_FAILURE)
              {
                 CO_InsertErr(l_debug_info_ptr,ERR_MSG_NOTGENERATED,p_msg_no,chr_p_client,chr_p_key,__LINE__ , __FILE__);
                 APL_GOBACK_FAIL
	       }
             
               
              
              
				          strcpy(chr_temp,chr_l_sel_msg_stmt); 
              int_returnval = MS_Proc_SelExec(p_next_seq_no_15022,p_msg_no,&l_ms_msgent_structa,chr_temp,l_ms_static_val,&l_ms_dynamic_val,INFO_FILE,&int_l_seq_no,p_msg_seq_no,&int_retstat,l_debug_info_ptr);
              if(int_returnval == APL_FAILURE)
              {
                  CO_InsertErr(l_debug_info_ptr,ERR_MSG_NOTGENERATED,p_msg_no,chr_p_client,chr_p_key,__LINE__ , __FILE__);
                  APL_GOBACK_FAIL
	       }
	       } 
	   }
  
          else if(strcmp(p_msg_no,"53xN01") == 0)
     {

			printf("\n TestPrintf returning MS_Proc_SelExec() 53xN01 functioncal ");
			fflush(stdout);           			   


      int_returnval = MS_Rtv_DataFileSelStmt("53x",&l_ms_msgent_structa,&chr_l_sel_msg_stmt,&l_ms_static_val, &l_ms_dynamic_val,&int_retstat,l_debug_info_ptr);
      if (int_returnval == APL_FAILURE)
      {
         CO_InsertErr(l_debug_info_ptr,ERR_MSG_NOTGENERATED,p_msg_no,chr_p_client,chr_p_key,__LINE__ , __FILE__);
         APL_GOBACK_FAIL
      }
      
      
      
	         strcpy(chr_temp,chr_l_sel_msg_stmt);	
      int_returnval = MS_Proc_SelExec(p_next_seq_no_15022,"53x",&l_ms_msgent_structa,chr_temp,l_ms_static_val,&l_ms_dynamic_val,INFO_FILE,&int_l_seq_no,p_msg_seq_no,&int_retstat,l_debug_info_ptr);

      if(int_returnval == APL_FAILURE)
      {
         CO_InsertErr(l_debug_info_ptr,ERR_MSG_NOTGENERATED,p_msg_no,chr_p_client,chr_p_key,__LINE__ , __FILE__);
         APL_GOBACK_FAIL
      }

          }
     else if(strcmp(p_msg_no,"508") == 0)
     {
			
			printf("\n TestPrintf returning MS_Proc_SelExec() 508 functioncal ");
			fflush(stdout);           			   

      int_returnval = MS_Rtv_DataFileSelStmt(p_msg_no,&l_ms_msgent_structa,&chr_l_sel_msg_stmt,&l_ms_static_val, &l_ms_dynamic_val,&int_retstat,l_debug_info_ptr);
      if (int_returnval == APL_FAILURE)
      {
         CO_InsertErr(l_debug_info_ptr,ERR_MSG_NOTGENERATED,p_msg_no,chr_p_client,chr_p_key,__LINE__ , __FILE__);
         APL_GOBACK_FAIL
    }
      
      
      
	         strcpy(chr_temp,chr_l_sel_msg_stmt);	
      int_returnval = MS_Proc_SelExec(p_next_seq_no_15022,p_msg_no,&l_ms_msgent_structa,chr_temp,l_ms_static_val,&l_ms_dynamic_val,INFO_FILE,&int_l_seq_no,p_msg_seq_no,&int_retstat,l_debug_info_ptr);

      if(int_returnval == APL_FAILURE)
      {
         CO_InsertErr(l_debug_info_ptr,ERR_MSG_NOTGENERATED,p_msg_no,chr_p_client,chr_p_key,__LINE__ , __FILE__);
         APL_GOBACK_FAIL
      }

     }
     else
           {
		fflush(stdout);
   	      int_returnval = MS_Rtv_DataFileSelStmt(p_msg_no,&l_ms_msgent_structa,&chr_l_sel_msg_stmt,&l_ms_static_val, &l_ms_dynamic_val,&int_retstat,l_debug_info_ptr);
         
	      if(int_returnval == APL_FAILURE)
              {
		printf("\nsatish in  MS_Rtv_DataFileSelStmt failure\n");
		fflush(stdout);

                 CO_InsertErr(l_debug_info_ptr,ERR_MSG_NOTGENERATED,p_msg_no,chr_p_client,chr_p_key,__LINE__ , __FILE__);
                 APL_GOBACK_FAIL
	       }
             
		memset(chr_temp,APL_NULL_CHAR,sizeof(chr_temp));	/* Added By Sana for AIX migration */
              strcpy(chr_temp ,chr_l_sel_msg_stmt);
				  //printf("strlen of  chr_l_sel_msg_stmt is %d\n",strlen(chr_l_sel_msg_stmt)); Changes done for AIX Migration
				  printf("strlen of  chr_l_sel_msg_stmt is %d\n",(int)strlen(chr_l_sel_msg_stmt));
				  fflush(stdout);

              /* int_returnval = MS_Proc_SelExec(p_next_seq_no_15022,p_msg_no,&l_ms_msgent_structa,chr_l_sel_msg_stmt,l_ms_static_val,&l_ms_dynamic_val,INFO_FILE,&int_l_seq_no,p_msg_seq_no,&int_retstat,l_debug_info_ptr); PJ */
              int_returnval = MS_Proc_SelExec(p_next_seq_no_15022,p_msg_no,&l_ms_msgent_structa,chr_temp,l_ms_static_val,&l_ms_dynamic_val,INFO_FILE,&int_l_seq_no,p_msg_seq_no,&int_retstat,l_debug_info_ptr);
			  if(int_returnval == APL_FAILURE)
              {
                  CO_InsertErr(l_debug_info_ptr,ERR_MSG_NOTGENERATED,p_msg_no,chr_p_client,chr_p_key,__LINE__ , __FILE__);
                  APL_GOBACK_FAIL
	       }
             }

            fprintf(INFO_FILE,"%dEOF=T\n",int_l_seq_no+1);
            fprintf(INFO_FILE,"%dACCOUNT=\n",int_l_seq_no+1);
            fprintf(INFO_FILE,"%dKEY=\n",int_l_seq_no+1);
		
APL_GOBACK_SUCCESS // AIX - Warnings

RETURN_SUCCESS:

	CO_ProcMonitor(APL_OUT_FILE,"Exiting successfully  out of MS_Rtv_DataFile\n",NULL,NULL);
        fclose(INFO_FILE);
		  fclose(chr_finifile);
 /*       APL_FREE(chr_l_sel_msg_stmt);*/
        APL_FREE(l_ms_static_val);

		  APL_FREE(l_ms_dynamic_val); 
	return APL_SUCCESS;
	
RETURN_FAILURE:
	CO_ProcMonitor(APL_OUT_FILE,"Exiting unsuccesfully out of MS_Rtv_DataFile\n",NULL,NULL);
        fclose(INFO_FILE);
		  fclose(chr_finifile);
        /*APL_FREE(chr_l_sel_msg_stmt);*/
        APL_FREE(l_ms_static_val);

		  APL_FREE(l_ms_dynamic_val); 
	return APL_FAILURE;
}




int MS_Rtv_DataFileSelStmt(char *p_msg_no,MS_MSGENT_STRUCT *p_imsgent_struct,
                  char **p_sel_msg_stmt,
		  MS_STATIC_VAL **p_STAT_VAL,MS_STATIC_VAL **p_SEL_VAL,
                  int *int_p_retstat,DEBUG_INFO_STRUCT_H **l_debug_info_ptr)
{

EXEC SQL BEGIN DECLARE SECTION;
MS_MSGENT_STRUCT l_ms_msgent_structa_a;
char chr_h_dom_instr[5],chr_h_sysdrt_date[APL_DATE_LEN], h_sys_dt[APL_DATE_LEN],l_new_date[APL_DATE_LEN],chr_h_vtb_acct_code[APL_CLIENT_LENGTH];
char chr_h_vtbrefer[41],chr_h_vtb_acct_name[41],chr_h_citibank_acct_code[APL_CLIENT_LENGTH];
char h_nation_code[APL_CTRY_CODE_LEN],chr_h_dom_ccycode[APL_CCYCODE_LEN];
char chr_h_process_reg_flg[2],chr_h_sub_acct_processing[2],chr_h_corporate_name[41];
char chr_h_system_date[APL_DATE_LEN],chr_h_ny_branch_usd_acct[APL_CLIENT_LENGTH];
char chr_tlx_date[11],chr_h_msys_date[11];
char chr_h_fx_quote[2],chr_h_domccy_desc[41];
char chr_l_typeofinstr[APL_FLAG_LENGTH]	=	APL_NULL_STRING;
char chr_l_tipotrade[APL_FLAG_LENGTH] = APL_NULL_STRING;
char chr_l_reverse[APL_FLAG_LENGTH]  =  APL_NULL_STRING ;
char chr_l_cash_acc[APL_IBANACC_LEN] = APL_NULL_STRING; 

char chr_h_date_new[APL_DATE_LEN];

short i_dom_instr=0,i_vtbrefer=0,i_citibank_cltt_code=0;
short i_dom_ccycode=0,i_nation_code = 0,i_sub_cltt_processing=0,i_ny_branch_usd_cltt=0;
short i_ca_identclr_name=0,i_fx_quote=0,i_proc_reg_ind = 0;
short chr_l_cond = 0;
short l_cond_vtb = 0; 
short i_vtb_cltt_name=0,i_vtb_cltt_code=0;
short int_l_condexists = 0;
double l_new_safek_rt = 0,chr_l_new_stock_qty = 0,chr_l_old_stock_qty = 0;
char chr_l_op_event_type[3] = APL_NULL_STRING,chr_conv_rate_str[20] = APL_NULL_STRING;  
char l_event_class[3] = APL_NULL_STRING;
char l_notice_date[APL_DATE_LEN] = APL_NULL_STRING;
short i_op_evt_class = 0; 
char chr_l_expire_dt[30] = APL_NULL_STRING;  
short i_expire_date = 0;  
float conv_ae_rate = 0.00;
int int_l_next_month=0;
short l_keep_fract_exists = 0;  					 
char chr_l_keep_fract_temp[2] = APL_NULL_STRING;  

/* UAT */
//Changed from APL_DATE_LEN to 21 By Sana char chr_deal_dt[APL_DATE_LEN] = APL_NULL_STRING;
char chr_deal_dt[21] = APL_NULL_STRING;
   char chr_broker_cd[11] = APL_NULL_STRING;
   char chr_contract_cd[17] = APL_NULL_STRING;

char chr_l_client[APL_CLIENT_LENGTH], chr_l_refer[41],chr_l_msgval[3];
char chr_l_broker[APL_CLIENT_LENGTH];	

double l_elig_qty = 0;

double l_elig_pos = 0;

EXEC SQL VAR l_ms_msgent_structa_a.swift_msg_no IS STRING;
EXEC SQL VAR l_ms_msgent_structa_a.proc_init IS STRING;
EXEC SQL VAR l_ms_msgent_structa_a.client IS STRING;
EXEC SQL VAR chr_h_dom_instr IS STRING;
EXEC SQL VAR chr_h_fx_quote IS STRING;
EXEC SQL VAR chr_h_domccy_desc IS STRING;
EXEC SQL VAR chr_h_vtb_acct_code IS STRING;
EXEC SQL VAR chr_h_vtb_acct_name IS STRING;
EXEC SQL VAR chr_h_vtbrefer IS STRING;
EXEC SQL VAR h_sys_dt IS STRING;
EXEC SQL VAR l_new_date IS STRING;
EXEC SQL VAR chr_h_sysdrt_date IS STRING;
EXEC SQL VAR chr_h_msys_date IS STRING;
EXEC SQL VAR chr_h_system_date IS STRING;
EXEC SQL VAR chr_tlx_date IS STRING;
EXEC SQL VAR chr_h_citibank_acct_code IS STRING;
EXEC SQL VAR chr_h_ny_branch_usd_acct IS STRING;
EXEC SQL VAR h_nation_code IS STRING;
EXEC SQL VAR chr_h_process_reg_flg IS STRING;
EXEC SQL VAR chr_h_sub_acct_processing IS STRING;
EXEC SQL VAR chr_h_corporate_name IS STRING;
EXEC SQL VAR chr_l_client IS STRING ;
EXEC SQL VAR chr_l_refer IS STRING;
EXEC SQL VAR chr_l_msgval IS STRING;
EXEC SQL VAR chr_l_broker IS STRING; 

EXEC SQL VAR chr_h_date_new IS STRING;

EXEC SQL VAR chr_l_cash_acc IS STRING;
EXEC SQL VAR chr_l_op_event_type IS STRING;
EXEC SQL VAR chr_l_expire_dt     IS STRING; 		
EXEC SQL END DECLARE SECTION;

   struct sqlca sqlca;
   char chr_l_sel_msg_stmt[20000]=APL_NULL_STRING;/*Changed by Mangesh for ISKB_4212 */
	char chr_l_sys_date[APL_DATE_LEN]=APL_NULL_STRING;
	char *chr_temp;
	char *chr_dtemp;
	char *chr_p_choice ;
	char *chr_p_nopendgs ;
	char *chr_selpendgs ;
	char *chr_l_sellocnchg ;
	char chr_l_consmsg[2];
	char **chr_l_param;
   char chr_fl_msgdatalogname[PATH_LENGTH],*chr_p_as_of_date,chr_l_as_of_date[APL_DATE_LEN],chr_as_of_date[APL_DATE_LEN],chr_t_as_of_date[APL_DATE_LEN],chr_l_as_of_date_586[9],chr_l_last_gen_date[APL_DATE_LEN],chr_last_gen_date[APL_DATE_LEN];
   char *chr_l_historical,*chr_l_last_update,*chr_l_zero_bal,*chr_l_week_stm,*chr_l_mult_548,*chr_l_no_locnchg,*chr_l_no_alleg,*chr_l_loc_stat,*chr_l_dd,*chr_l_mm,*chr_p_yy,chr_l_yy[3] = APL_NULL_STRING; 
   char chr_l_ca_id[CORP_ID_LEN],chr_l_ce_typ[3],chr_l_rep_ccy[4],chr_l_send[2],chr_l_mast_sub_rep[2],chr_l_ddate[11];
   char chr_l_msgno[4],chr_l_txndt[9],chr_l_trdt[9],chr_l_isin[13],chr_l_instrdesc[36],chr_l_typeofinstrval[40],chr_l_domcpac[11],chr_l_domcpdesc[36],chr_l_ccyvalue[40],chr_l_from_date[APL_DATE_LEN],chr_l_to_date[APL_DATE_LEN];

   
  
   char chr_l_ftypeofinstr[4], chr_l_qty[35], chr_l_ccycode[4], chr_l_amount[35], chr_l_countacc[16], chr_l_countaccnm[36], chr_l_failcode[3];
	char chr_l_typeoftrd[3]; 
	char chr_l_refno[21]=APL_NULL_STRING;
   
   

	char chr_l_increfno[17]; 
	char chr_l_int[2]; /* Vedavati for E-mail Messages*/
   char    chr_buffer[KEY_LENGTH],*chr_temp_part = NULL,chr_l_swftlx[2];
   int int_returnval = 0,int_retstat = 0,int_noelem=0,dbl_i=0;
   long l_msgaddr=0;
	long l_msgaddr1=0; 
   char chr_l_fdate[11],chr_l_tdate[11];
   FILE *fl_MsgDataLog;
   char    chr_mainfuncarea_h[APL_MAINFUNCAREA_LEN];
   char    chr_condid_h[APL_CONDID_LEN],chr_l_qty_recd[50], chr_l_qty_del[50];
   char  chr_l_instrcode[APL_INSTRUMENTCODE_LEN],chr_l_decl_date[APL_DATE_LEN],chr_l_event_srl_nbr[3];
   
   char chr_l_eventid[17];
   char chr_l_sc_eventid[17];
   char chr_l_sc_mode[2];
   char chr_l_prevseme[17];
   char chr_l_566reverse[APL_FLAG_LENGTH];
   char chr_l_tmp_instr_dt[APL_DATE_LEN];
   char chr_l_tmp_moneydt[APL_DATE_LEN];
   char chr_l_postdt[APL_DATE_LEN];
   char chr_l_new_postdt[APL_DATE_LEN];
   short i_postdt=0;
   short i_new_postdt=0;
   

   short Cond_exists_h;
	char  chr_l_trcode[APL_FLAG_LENGTH] = APL_NULL_STRING;
	
	char chr_h_order_proc[2]=APL_NULL_STRING;
	
	
	char chr_from_date[APL_DATE_LEN] = APL_NULL_STRING;
	
	short l_cond_tax = 0 ; 
	short l_cond_taxable_div = 0;   


#ifdef EMU_PROCESSING
	char chr_l_emu_effd_8[9];
	char chr_l_emu_effd_6[7];
	char chr_l_emu_mnva[5];
	char chr_l_emu_effd_t_6[7];
#endif


	
	int int_period_flg=0;
	
short l_nohold_rus = 0; 
	

	char chr_h_pasofdate_new[9]=APL_NULL_STRING;
	short i_pasofdate_new = 0;

	
	char chr_new_unique_ref_num[APL_UNIQUE_REF_NUM_LEN]=APL_NULL_STRING; 
	char chr_new_ca_unique_ref_num[APL_UNIQUE_REF_NUM_LEN]=APL_NULL_STRING; 
	char chr_l_ca_unique_ref_num[APL_UNIQUE_REF_NUM_LEN]=APL_NULL_STRING; 
	int chr_l_txn_type = 0; 
	int int_l_rprflag = 0; 

	EXEC SQL VAR chr_l_trcode IS STRING;
	EXEC SQL VAR chr_l_ca_unique_ref_num IS STRING;
	EXEC SQL VAR chr_l_refno IS STRING;

#ifdef APL_THREADS
        APL_SET_CONTEXT
        EXEC SQL CONTEXT USE :my_ctx_local;
#endif


   chr_p_as_of_date = (char *)calloc(APL_DATE_LEN,sizeof(char));
	
   
   chr_l_dd     = (char *)calloc(4,sizeof(char));


   chr_p_yy     = (char *)calloc(5,sizeof(char));
	
   

   chr_l_mm     = (char *)calloc(4,sizeof(char));
   chr_l_last_update = (char *)calloc(APL_DATE_LEN,sizeof(char));
   chr_l_historical = (char *)calloc(2,sizeof(char));
   chr_l_zero_bal = (char *)calloc(2,sizeof(char));
   chr_l_week_stm = (char *)calloc(2,sizeof(char));
	
	chr_l_no_alleg = (char *)calloc(2,sizeof(char));
	chr_l_no_locnchg = (char *)calloc(2,sizeof(char));

   chr_l_loc_stat = (char *)calloc(2,sizeof(char));
   chr_temp_part = (char *)calloc(20,sizeof(char));
   
	       
       
	
   chr_p_choice = (char *)calloc(2,sizeof(char));
   chr_p_nopendgs = (char *)calloc(2,sizeof(char));
   chr_selpendgs = (char *)calloc(2,sizeof(char));
	chr_l_sellocnchg = (char *)calloc(2,sizeof(char));
	chr_temp = (char *)calloc(201,sizeof(char));
	chr_dtemp = (char *)calloc(50,sizeof(char));
   chr_l_mult_548 = (char *)calloc(4,sizeof(char)); 
	
	
   memset(chr_l_sel_msg_stmt,APL_NULL_CHAR,sizeof(chr_l_sel_msg_stmt));  /*Changed by Mangesh for ISKB_4212 */
   memset(chr_l_sys_date,APL_NULL_CHAR,APL_DATE_LEN);
   memset(chr_l_as_of_date_586,APL_NULL_CHAR,9);
	memset(chr_l_as_of_date,APL_NULL_CHAR,7);
   memset(chr_l_ddate,APL_NULL_CHAR,11);
   memset(chr_as_of_date,APL_NULL_CHAR,APL_DATE_LEN);
   memset(chr_l_last_gen_date,APL_NULL_CHAR,APL_DATE_LEN);
   memset(chr_last_gen_date,APL_NULL_CHAR,APL_DATE_LEN);
   memset(chr_l_consmsg,APL_NULL_CHAR,2);
   memset(chr_l_ca_id,APL_NULL_CHAR,CORP_ID_LEN);
   memset(chr_l_refno,APL_NULL_CHAR,21);
   memset(chr_l_ce_typ,APL_NULL_CHAR,3);
   memset(chr_l_rep_ccy,APL_NULL_CHAR,3);
   memset(chr_l_send,APL_NULL_CHAR,3);
   memset(chr_l_mast_sub_rep,APL_NULL_CHAR,3);
   memset(chr_l_msgno,APL_NULL_CHAR,4);
   memset(chr_l_txndt,APL_NULL_CHAR,9);
   memset(chr_l_trdt,APL_NULL_CHAR,9);
   memset(chr_l_isin,APL_NULL_CHAR,13);
   memset(chr_l_instrdesc,APL_NULL_CHAR,36);
   memset(chr_l_typeofinstrval,APL_NULL_CHAR,40);
   memset(chr_l_domcpac,APL_NULL_CHAR,11);
   memset(chr_l_domcpdesc,APL_NULL_CHAR,36);
   memset(chr_l_ccyvalue,APL_NULL_CHAR,40);
   memset(chr_l_fdate,APL_NULL_CHAR,11);
   memset(chr_l_tdate,APL_NULL_CHAR,11);
   memset(chr_buffer,APL_NULL_CHAR,KEY_LENGTH);
   memset(chr_temp_part,APL_NULL_CHAR,20);
   memset(chr_l_instrcode,APL_NULL_CHAR,APL_INSTRUMENTCODE_LEN);
   
   memset(chr_l_eventid,APL_NULL_CHAR,17);
   memset(chr_l_sc_eventid,APL_NULL_CHAR,17);
   memset(chr_l_prevseme,APL_NULL_CHAR,17);
   memset(chr_l_566reverse,APL_NULL_CHAR,APL_FLAG_LENGTH);
   
   memset(chr_l_decl_date,APL_NULL_CHAR,APL_DATE_LEN);
   memset(chr_l_event_srl_nbr,APL_NULL_CHAR,3);
   memset(chr_l_qty_recd,APL_NULL_CHAR,50);
   memset(chr_l_qty_del,APL_NULL_CHAR,50);
   memset(chr_l_swftlx,APL_NULL_CHAR,2);
	
	memset (chr_l_ftypeofinstr   , APL_NULL_CHAR, 4);
	memset (chr_l_qty        , APL_NULL_CHAR, 35);
	memset (chr_l_ccycode    , APL_NULL_CHAR, 4);
	memset (chr_l_amount     , APL_NULL_CHAR, 35);
	memset (chr_l_countacc   , APL_NULL_CHAR, 16);  
	memset (chr_l_countaccnm , APL_NULL_CHAR, 36);
	memset (chr_l_failcode   , APL_NULL_CHAR, 3);
	memset (chr_l_typeoftrd  , APL_NULL_CHAR, 3);
	

    memset (chr_l_increfno, APL_NULL_CHAR, 17); 
	 memset (chr_l_cash_acc, APL_NULL_CHAR, APL_IBANACC_LEN);

    memset(l_ms_msgent_structa_a.swift_msg_no,APL_NULL_CHAR,7);
    memset(l_ms_msgent_structa_a.proc_init,APL_NULL_CHAR,61);
    memset(l_ms_msgent_structa_a.client,APL_NULL_CHAR,APL_CLIENT_LENGTH);
    memset(l_ms_msgent_structa_a.info_file,APL_NULL_CHAR,31);
    memset(l_ms_msgent_structa_a.proc_data,APL_NULL_CHAR,201);
    memset(l_ms_msgent_structa_a.rowid,APL_NULL_CHAR,APL_ROWID_LEN);
	memset (chr_l_int  , APL_NULL_CHAR, 2); /* Vedavati for Email Messages */
	memset (chr_h_dom_instr,APL_NULL_CHAR,5);//Added by Gouse for ISKB_6013 - 22/01/2013


#ifdef EMU_PROCESSING
	 memset(chr_l_emu_effd_8,APL_NULL_CHAR,9);
	 memset(chr_l_emu_effd_6,APL_NULL_CHAR,7);
	 memset(chr_l_emu_effd_t_6,APL_NULL_CHAR,7);
	 memset(chr_l_emu_mnva,APL_NULL_CHAR,5);

	 strcpy(chr_l_emu_effd_8,EMU_EFFD_8);
	 strcpy(chr_l_emu_effd_6,EMU_EFFD_6);
	 strcpy(chr_l_emu_effd_t_6,EMU_EFFD_T_6);
	 strcpy(chr_l_emu_mnva,EMU_MNVA);
#endif


    l_ms_msgent_structa_a.swift_msg_seqno = 0;
    l_ms_msgent_structa_a.swift_count = 0;
    l_ms_msgent_structa_a.telex_count = 0;
    l_ms_msgent_structa_a.fax_count = 0;
    l_ms_msgent_structa_a.gcn_count = 0;
    l_ms_msgent_structa_a.clts_count = 0;
    strcpy(l_ms_msgent_structa_a.status_ind , APL_NULL_STRING);
    strcpy(l_ms_msgent_structa_a.auto_tran_ind , APL_NULL_STRING);



   l_ms_msgent_structa_a = *p_imsgent_struct;

          *p_STAT_VAL = realloc(*p_STAT_VAL,sizeof(MS_STATIC_VAL)*24);     
 
   strcpy((*p_STAT_VAL)[0].link_val,"PROC_INIT");
   strcpy((*p_STAT_VAL)[0].link_tag,l_ms_msgent_structa_a.proc_init);

   EXEC SQL SELECT substr(to_char(SYS_DATE,'YYMMDD'),1,6),SYS_DATE,
		   substr(to_char(SYS_DATE,'MM/DD/YYYY'),1,10),substr(to_char(SYS_DATE,'DD/MM/YYYY'),1,10),substr(to_char(SYS_DATE,'YYYYMMDD'),1,8)
            INTO :h_sys_dt,:chr_h_system_date,:chr_h_msys_date, chr_h_sysdrt_date ,:l_new_date
                   FROM PRO_SYS_DATE;

   IS_ANY_ORA_ERROR

   EXEC SQL SELECT dom_instrument,
                   nation_code,dom_ccy,
                   ca_identname
                   INTO :chr_h_dom_instr:i_dom_instr,:h_nation_code:i_nation_code,
                        :chr_h_dom_ccycode:i_dom_ccycode,
                        :chr_h_corporate_name:i_ca_identclr_name
                   FROM MT_COMMON_SYS_PARAMS;

   IS_ANY_ORA_ERROR

   EXEC SQL SELECT proc_reg_ind,sub_clt_proc,
                   brnch_usd_clt,dir_indir_fxqt_ind,
		   custody_clt_cd,ord_proc_ind
            INTO :chr_h_process_reg_flg:i_proc_reg_ind,
                 :chr_h_sub_acct_processing:i_sub_cltt_processing,
                 :chr_h_ny_branch_usd_acct:i_ny_branch_usd_cltt,
                 :chr_h_fx_quote:i_fx_quote,
		 :chr_h_citibank_acct_code:i_citibank_cltt_code,
		 :chr_h_order_proc 
            FROM MT_CORE_SYS_PARAMS;

   IS_ANY_ORA_ERROR

	

	chr_l_txn_type=SETTLEMENT;
	fflush(stdout);
	Alert("chr_new_unique_ref_num = |%s|",chr_new_unique_ref_num);
	fflush(stdout);
	if (MS_Rtv_RefNo_A(chr_l_txn_type,chr_new_unique_ref_num,l_debug_info_ptr) == APL_FAILURE)
	{
			printf("Failure from MS_Rtv_RefNo_A\n");
			fflush(stdout);
			APL_GOBACK_FAIL
	}
	else
	{
		printf("Returned successfully from MS_Rtv_RefNo_A");
		fflush(stdout);
	}

   chr_l_txn_type=DEALTYPE_CORP;

		printf("Returned successfully from MS_Rtv_RefNo_A |%d|",chr_l_txn_type);//%s to %d - Modified by Gouse - ISKB_6013 - 22/01/2013
		fflush(stdout);
   if (MS_Rtv_RefNo_A(chr_l_txn_type,chr_new_ca_unique_ref_num,l_debug_info_ptr) == APL_FAILURE)
   {
		printf(" satish MS_Rtv_RefNo_A 2  |%d|",chr_l_txn_type);
		fflush(stdout);

	   CO_ProcMonitor(APL_OUT_FILE,"Failure from GenUniqRefNum", NULL, NULL);
	   APL_GOBACK_FAIL;
   }


   if(i_ny_branch_usd_cltt == -1)
        strcpy(chr_h_ny_branch_usd_acct,"");

       if(strcmp(p_msg_no,"572") == 0)
       {
          l_msgaddr = MSTMTTRANMSGNO;       

	  if(strlen(l_ms_msgent_structa_a.proc_data) != 0)
          {
             CO_SplitStr((*p_imsgent_struct).proc_data,
                          ';', &int_noelem, &chr_l_param);

             strcpy(chr_as_of_date,chr_l_param[0]); 
             strcpy(chr_l_zero_bal,chr_l_param[1]);

				 
				
				 if ( int_noelem > 2 && (int_noelem != 7))
				 {
					strcpy(chr_l_typeofinstr, chr_l_param[2]);
				 }
				 if (int_noelem==7)
				 {
					strcpy(chr_l_last_gen_date,chr_l_param[5]);
					strcat(chr_l_last_gen_date," 12:00:00");
					strcpy(chr_l_week_stm,chr_l_param[6]);
				 }
   	  }
			 
			 

			 if ( chr_l_typeofinstr[0] != 'B' && chr_l_typeofinstr[0] != 'S' 
					&& chr_l_typeofinstr[0] != 'A' )
			 {
				chr_l_typeofinstr[0] = 'A';
				chr_l_typeofinstr[1] = '\0';
			 }

          if(strlen(chr_as_of_date)== 0)
          {
		APL_DATA_MISSING("AS OF DATE", APL_NULL_STRING, APL_NULL_STRING)
                APL_GOBACK_FAIL
          }
          if(strlen(chr_l_zero_bal)== 0)
          {
		APL_DATA_MISSING("ZERO MOVEMENTS", APL_NULL_STRING, APL_NULL_STRING)
                APL_GOBACK_FAIL
          }
           
          *p_STAT_VAL = realloc(*p_STAT_VAL,sizeof(MS_STATIC_VAL)*14); 
          *p_SEL_VAL = realloc(*p_SEL_VAL,sizeof(MS_STATIC_VAL)*14); 
			
          exec sql select substr(to_char(to_date(:chr_as_of_date),'YYMMDD'),1,6) 
                   into :chr_l_as_of_date
                   from dual;
          IS_ANY_ORA_ERROR
			
			 if (strcmp(chr_l_week_stm,"Y")==0)	
			 {
            exec sql select substr(to_char(to_date(:chr_l_last_gen_date),'YYYYMMDD'),1,8) 
                   into :chr_last_gen_date
                   from dual;
            IS_ANY_ORA_ERROR
		EXEC SQL SELECT TO_NUMBER(TO_CHAR(TO_DATE(:chr_as_of_date),'MM')) 
							- TO_NUMBER(TO_CHAR(TO_DATE(:chr_l_last_gen_date),'MM')) 
							INTO :int_l_next_month from DUAL;
		IS_ANY_ORA_ERROR;
			 }
          strcpy((*p_STAT_VAL)[0].link_val,"DUMMY");
          strcpy((*p_STAT_VAL)[0].link_tag,"DUMMY");
          strcpy((*p_STAT_VAL)[1].link_val,"ASOFDATE");
          strcpy((*p_STAT_VAL)[1].link_tag,chr_l_as_of_date);
          strcpy((*p_STAT_VAL)[2].link_val,"POSIT_DATE");
          strcpy((*p_STAT_VAL)[2].link_tag,chr_as_of_date);
          strcpy((*p_STAT_VAL)[3].link_val,"DOMSEC");
          strcpy((*p_STAT_VAL)[3].link_tag,chr_h_dom_instr);
          strcpy((*p_STAT_VAL)[4].link_val,"REPZMOV");
          strcpy((*p_STAT_VAL)[4].link_tag,chr_l_zero_bal);
          if(strlen(l_ms_msgent_structa_a.client) != 0)
          {
             strcpy((*p_STAT_VAL)[5].link_val,"PACCOUNT");
             strcpy((*p_STAT_VAL)[5].link_tag,l_ms_msgent_structa_a.client);
				 
			    if (int_noelem == 7) 	
				{
             	strcpy((*p_STAT_VAL)[6].link_val,"CONTACTSEQ");
             	strcpy((*p_STAT_VAL)[6].link_tag,chr_l_param[2]);
					
					strcpy((*p_STAT_VAL)[7].link_val,"NATION");
					strcpy((*p_STAT_VAL)[7].link_tag,g_mt_commonsys_params_struct_h.nation_code);

					
					strcpy((*p_STAT_VAL)[8].link_val,"NEW_MNTH");
					strcpy((*p_STAT_VAL)[8].link_tag,chr_l_param[4]);
					strcpy((*p_STAT_VAL)[9].link_val,"WEEKLY_STM");
					strcpy((*p_STAT_VAL)[9].link_tag,chr_l_param[6]);
					strcpy((*p_STAT_VAL)[10].link_val,"LAST_GEN_DATE");
					strcpy((*p_STAT_VAL)[10].link_tag,chr_last_gen_date);
               strcpy((*p_STAT_VAL)[11].link_val,"TEMP_GEN_DATE"); 
					strcpy((*p_STAT_VAL)[11].link_tag,chr_l_last_gen_date);
					strcpy((*p_STAT_VAL)[12].link_val,"CNTRY_BIC");	
					strcpy((*p_STAT_VAL)[12].link_tag,l_mt_message_sys_params_struct_h.swift_cd);
					strcpy((*p_STAT_VAL)[13].link_val,"");
	 				strcpy((*p_STAT_VAL)[13].link_tag,"");
				}
				else {
					strcpy((*p_STAT_VAL)[6].link_val,"NATION");
					strcpy((*p_STAT_VAL)[6].link_tag,g_mt_commonsys_params_struct_h.nation_code);
					
					strcpy((*p_STAT_VAL)[7].link_val,"NEW_MNTH");
					strcpy((*p_STAT_VAL)[7].link_tag,"N");
					strcpy((*p_STAT_VAL)[8].link_val,"CNTRY_BIC");	
					strcpy((*p_STAT_VAL)[8].link_tag,l_mt_message_sys_params_struct_h.swift_cd);
					strcpy((*p_STAT_VAL)[9].link_val,"");
					strcpy((*p_STAT_VAL)[9].link_tag,"");
					}
					
          }
          else
          {
				 
			    if (int_noelem == 7) 	
				{
             strcpy((*p_STAT_VAL)[5].link_val,"CONTACTSEQ");
             strcpy((*p_STAT_VAL)[5].link_tag,chr_l_param[2]);
				 strcpy((*p_STAT_VAL)[6].link_val,"NATION");
				 strcpy((*p_STAT_VAL)[6].link_tag,g_mt_commonsys_params_struct_h.nation_code);
				 
				 strcpy((*p_STAT_VAL)[7].link_val,"NEW_MNTH");
				 strcpy((*p_STAT_VAL)[7].link_tag,chr_l_param[4]);
				 strcpy((*p_STAT_VAL)[8].link_val,"WEEKLY_STM");
				 strcpy((*p_STAT_VAL)[8].link_tag,chr_l_param[6]);
				 strcpy((*p_STAT_VAL)[9].link_val,"LAST_GEN_DATE");
				 strcpy((*p_STAT_VAL)[9].link_tag,chr_last_gen_date);
             strcpy((*p_STAT_VAL)[10].link_val,"TEMP_GEN_DATE"); 
				 strcpy((*p_STAT_VAL)[10].link_tag,chr_l_last_gen_date);
				 strcpy((*p_STAT_VAL)[11].link_val,"CNTRY_BIC");	
				 strcpy((*p_STAT_VAL)[11].link_tag,l_mt_message_sys_params_struct_h.swift_cd);
				 strcpy((*p_STAT_VAL)[12].link_val,"");
				 strcpy((*p_STAT_VAL)[12].link_tag,"");
				}
				else {
					
				strcpy((*p_STAT_VAL)[5].link_val,"NATION");
				strcpy((*p_STAT_VAL)[5].link_tag,g_mt_commonsys_params_struct_h.nation_code);
				
				strcpy((*p_STAT_VAL)[6].link_val,"NEW_MNTH");
				strcpy((*p_STAT_VAL)[6].link_tag,"N");
				strcpy((*p_STAT_VAL)[7].link_val,"CNTRY_BIC");	
				strcpy((*p_STAT_VAL)[7].link_tag,l_mt_message_sys_params_struct_h.swift_cd);
				strcpy((*p_STAT_VAL)[8].link_val,"");
				strcpy((*p_STAT_VAL)[8].link_tag,"");
					
						}
          }

          strcpy((*p_SEL_VAL)[0].link_val,"OPNBAL");
          strcpy((*p_SEL_VAL)[1].link_val,"CA_EVENT");
          strcpy((*p_SEL_VAL)[2].link_val,"DUMMY");
          strcpy((*p_SEL_VAL)[3].link_val,"IDENTIY_NO");
          strcpy((*p_SEL_VAL)[4].link_val,"INSTR_CODE");
          strcpy((*p_SEL_VAL)[5].link_val,"CLIENT");
          strcpy((*p_SEL_VAL)[6].link_val,"TTRD");
          strcpy((*p_SEL_VAL)[7].link_val,"DEAL_CD");
		
          strcpy((*p_SEL_VAL)[8].link_val,"NEW_DOMCPAC");
          strcpy((*p_SEL_VAL)[9].link_val,"ENTRY"); 
          strcpy((*p_SEL_VAL)[10].link_val,"NEW_FMTFLG");
          strcpy((*p_SEL_VAL)[11].link_val,"HISTORY_TRADE");
          strcpy((*p_SEL_VAL)[12].link_val,"UNIQ_IDENT_NO");
          strcpy((*p_SEL_VAL)[13].link_val,"");
          strcpy((*p_SEL_VAL)[13].link_tag,"");
  



			strcpy(chr_l_sel_msg_stmt,"SELECT a.client , a.IDENTIY_NO ,'N' as REVERSE,'");
			strcat(chr_l_sel_msg_stmt,chr_l_week_stm);
			strcat(chr_l_sel_msg_stmt,"' as WEEK_IND ,");
			strcat(chr_l_sel_msg_stmt,"'N' as HISTORY_TRADE, CONCAT(a.IDENTIY_NO,CONCAT('|','N'))as REFNO_R,' ' as RTYP, a.IDENTIY_NO as PROC_INIT,substr(replace (replace(b.cln_name,chr(13),NULL),chr(10),NULL),1,35 )as CLNT_NAME,b.CLN_SHORTNM as ALPHACODE,");
      	strcat(chr_l_sel_msg_stmt,"b.CLN_USE_ISIN_IND as FLGISIN,b.CLN_FMT_RPTIND,b.cln_master,a.instr_code,c.NOMINAL_VALUE,");
	  strcat(chr_l_sel_msg_stmt," decode(c.INSTR_TYPE,'BON',decode(b.CLN_FMT_RPTIND,'Y','FMT'");
	  strcat(chr_l_sel_msg_stmt,",c.INSTR_TYPE),c.INSTR_TYPE) as FTYPEOFINSTR,decode(c.INSTR_TYPE,'BON',decode(b.CLN_FMT_RPTIND,'Y',to_char(a.QTY*c.NOMINAL_VALUE),a.QTY),a.QTY) as FENT_POS,");


	  strcat(chr_l_sel_msg_stmt," decode(c.INSTR_TYPE,'BON',decode(b.CLN_FMT_RPTIND,'Y','Y','N'),'N') as NEW_FMTFLG,");
          strcat(chr_l_sel_msg_stmt,"substr(to_char(a.setl_date,'YYMMDD'),1,6) as SETL_DATE,substr(to_char(a.setl_date,'YYYYMMDD'),1,8) as NEW_SETTLEDT,");
			 
					
          strcat(chr_l_sel_msg_stmt,"c.INSTR_TYPE,substr(replace(replace(c.instr_name,chr(13),NULL),chr(10),NULL),1,31) as INSTR_NAME,c.currency_cd,c.INSTR_ISIN,decode(a.dl_class,'27','26','29','26',a.dl_class) as TTRD,"); 

					

	  
	  

	  
          strcat(chr_l_sel_msg_stmt,"a.deal_cd,concat(a.IDENTIY_NO,'//') as ORIG_REFNO,'SE'||a.UNIQ_IDENT_NO as UNIQ_IDENT_NO,a.ORIG_REFNO as NEW_ORIGREFNO,a.lcl_identno as NEW_LOCREFNO,a.domestic_cpclt as NEW_DOMCPAC,decode(rtrim(ltrim(a.cp_clt)),NULL,NULL,rtrim(ltrim(a.cp_clt))) as NEW_COUNTACC,decode(ltrim(a.CP_CLTNAME),NULL,upper(substr(replace(replace(d.pty_name,chr(13),NULL),chr(10),NULL),1,35)),upper(decode(substr(replace(replace(a.CP_CLTNAME,chr(13),NULL),chr(10),NULL),1,1),'/',substr(replace(replace(a.CP_CLTNAME,chr(13),NULL),chr(10),NULL),2,34),substr(replace(replace(a.CP_CLTNAME,chr(13),NULL),chr(10),NULL),1,35)))) as CP_CLTNAME,substr(to_char(a.INSTRUMENT_DT,'YYMMDD'),1,6) as INSTRUMENT_DT,substr(to_char(a.INSTRUMENT_DT,'YYYYMMDD'),1,8) as NEW_INSTR_DT,");
			 

			 strcat(chr_l_sel_msg_stmt, "decode(to_char(a.MONEY_SETL_DT, 'YYYYMMDD'), to_char(a.INSTRUMENT_DT,'YYYYMMDD'), NULL, to_char(a.MONEY_SETL_DT, 'YYYYMMDD')) as VALU_DT, ");     
          strcat(chr_l_sel_msg_stmt,"decode(a.dl_class,19,NULL,decode(a.dl_class,1,decode(a.deal_cd,1,12,decode(a.deal_cd,3,12,decode(a.deal_cd,5,12,decode(a.deal_cd,7,12,11)))),");
          strcat(chr_l_sel_msg_stmt,"3,decode(a.deal_cd,1,12,decode(a.deal_cd,3,12,decode(a.deal_cd,5,12,decode(a.deal_cd,7,12,11)))),");
          strcat(chr_l_sel_msg_stmt,"18,decode(a.deal_cd,1,12,decode(a.deal_cd,3,12,decode(a.deal_cd,5,12,decode(a.deal_cd,7,12,11)))),");
          strcat(chr_l_sel_msg_stmt,"20,decode(a.deal_cd,1,12,decode(a.deal_cd,3,12,decode(a.deal_cd,5,12,decode(a.deal_cd,7,12,11)))),");
          strcat(chr_l_sel_msg_stmt," 21,decode(a.deal_cd,1,12,decode(a.deal_cd,3,12,decode(a.deal_cd,5,12,decode(a.deal_cd,7,12,11)))),");
          strcat(chr_l_sel_msg_stmt,"22,decode(a.deal_cd,1,12,decode(a.deal_cd,3,12,decode(a.deal_cd,5,12,decode(a.deal_cd,7,12,11)))),");
          strcat(chr_l_sel_msg_stmt,"25,decode(a.deal_cd,1,12,decode(a.deal_cd,3,12,decode(a.deal_cd,5,12,decode(a.deal_cd,7,12,11)))),");
          strcat(chr_l_sel_msg_stmt,"26,decode(a.deal_cd,1,12,decode(a.deal_cd,3,12,decode(a.deal_cd,5,12,decode(a.deal_cd,7,12,11)))),");
          strcat(chr_l_sel_msg_stmt,"99,decode(a.deal_cd,1,12,decode(a.deal_cd,3,12,decode(a.deal_cd,5,12,decode(a.deal_cd,7,12,11)))),");
          strcat(chr_l_sel_msg_stmt,"2,14,");
          strcat(chr_l_sel_msg_stmt,"10,22,");
          strcat(chr_l_sel_msg_stmt,"decode(a.deal_cd,1,12,decode(a.deal_cd,3,12,decode(a.deal_cd,5,12,decode(a.deal_cd,7,12,11)))))) as NCATYP,");
		 
          
      
          strcat(chr_l_sel_msg_stmt,"substr(to_char(a.MONEY_SETL_DT,'YYMMDD'),1,6) as MONEY_SETL_DT,a.PARTIAL_IND_B,substr(to_char(a.deal_date,'YYYYMMDD'),1,8) as DEAL_DATE,substr(to_char(a.deal_date,'YYYYMMDD'),1,8) as NEW_TRDT,decode(a.failreason_cd,NULL,'0',substr(lpad(a.failreason_cd,2,'0'),1,2)) as FAILREASON_CD,'N' as NIL_MOV_IND,");
          strcat(chr_l_sel_msg_stmt,"concat('/',a.client) as NACCOUNT,c.currency_cd as CCYOPNBAL,c.currency_cd,c.currency_cd as CCYAMOUNT,decode(a.QTY,a.ORIG_QTY,'Y','N') as SAMEQTY , ");
			
			strcat(chr_l_sel_msg_stmt," b.CLN_TAXABLE_IND  as IND_83C83D ");
         /* 03July Vaibhav New tag has been added for msg 536 .....ISKB:1643 Start */ 
         strcat(chr_l_sel_msg_stmt," ,b.CLN_DEAL_SETL_IND as CLN_DEAL_SETL_IND ");
		   /* 03July Vaibhav New tag has been added for msg 536 .....End */	
         strcat(chr_l_sel_msg_stmt," ,concat(a.client,concat('||',a.instr_code)) as ACC_INSTR_CODE ");
			
			strcat(chr_l_sel_msg_stmt," , substr(to_char(to_date('");
			strcat(chr_l_sel_msg_stmt,chr_l_as_of_date);
      
         strcat(chr_l_sel_msg_stmt,"','RRMMDD'),'YYYYMMDD'),1,8) as NEW_ASOFDATE ");
			strcat(chr_l_sel_msg_stmt,",decode(a.domestic_cpclt,'");
			strcat(chr_l_sel_msg_stmt,chr_h_citibank_acct_code);
			strcat(chr_l_sel_msg_stmt,"','Y','N') as IS_CT_DOMCPAC ");

			

         if (int_noelem == 7)
         {
               strcat(chr_l_sel_msg_stmt,",");
               strcat(chr_l_sel_msg_stmt,chr_l_param[2]);
               strcat(chr_l_sel_msg_stmt," as CONTACTSEQ  ");
         }
			
	  		
			
			#ifdef EMU_PROCESSING
				strcat(chr_l_sel_msg_stmt," ,'");
				strcat(chr_l_sel_msg_stmt,chr_l_emu_effd_t_6);
				strcat(chr_l_sel_msg_stmt,"' as EFFD ");
				
				strcat(chr_l_sel_msg_stmt," , substr(to_char(to_date('");
				strcat(chr_l_sel_msg_stmt,chr_l_emu_effd_t_6);
      
            strcat(chr_l_sel_msg_stmt,"','RRMMDD'),'YYYYMMDD'),1,8) as NEW_EFFD ");

			#endif



			
			strcat(chr_l_sel_msg_stmt," , CONCAT(a.client,CONCAT('|',CONCAT (a.IDENTIY_NO,CONCAT('|','N')))) as ACC_REFNO ");
			
			strcat(chr_l_sel_msg_stmt," ,decode(ltrim(rtrim(substr(a.clientof,1,35))),NULL,NULL,ltrim(rtrim(substr(a.clientof,1,35)))) as NEW_ACCOUNTOF1  ");
			strcat(chr_l_sel_msg_stmt," ,decode(ltrim(rtrim(substr(a.clientof,36,30))),NULL,NULL,ltrim(rtrim(substr(a.clientof,36,30)))) as NEW_ACCOUNTOF2  ");
			strcat(chr_l_sel_msg_stmt," ,decode(ltrim(rtrim(substr(a.INSTRUCT_PERSONNM,1,35))),NULL,NULL,ltrim(rtrim(substr(a.INSTRUCT_PERSONNM,1,35)))) as INSTPARTYNM1  ");
			strcat(chr_l_sel_msg_stmt," ,decode(ltrim(rtrim(substr(a.INSTRUCT_PERSONNM,36,30))),NULL,NULL,ltrim(rtrim(substr(a.INSTRUCT_PERSONNM,36,30)))) as INSTPARTYNM2  "); 
			
         strcat(chr_l_sel_msg_stmt," , a.ENTRY "); 
			
			strcat(chr_l_sel_msg_stmt," ,decode(ltrim(rtrim(substr(a.CP_CLTNAME,1,35))),NULL,NULL,ltrim(rtrim(substr(a.CP_CLTNAME,1,35)))) as NEW_COUNTACCNAME ");
			strcat(chr_l_sel_msg_stmt," ,decode(ltrim(rtrim(substr(a.CP_CLTNAME,36,30))),NULL,NULL,ltrim(rtrim(substr(a.CP_CLTNAME,36,30)))) as NEW_COUNTACCNAME1 ");

          strcat(chr_l_sel_msg_stmt," FROM DL_DEAL a,MT_CLIENT b,MT_INSTRUMENT c, MT_PARTY d ");
          
          strcat(chr_l_sel_msg_stmt," WHERE ");
          if(strlen(l_ms_msgent_structa_a.client) != 0)
          {
         	strcat(chr_l_sel_msg_stmt," a.client = '");
        	strcat(chr_l_sel_msg_stmt,l_ms_msgent_structa_a.client);
         	strcat(chr_l_sel_msg_stmt,"' AND ");
      	  }

          strcat(chr_l_sel_msg_stmt," b.CLN_BRK_ALL != 'B' and b.STATUS != '");
          strcat(chr_l_sel_msg_stmt,STATUS_CLS_AUTH);

			
			 
			if(strcmp(chr_l_week_stm,"Y") !=0)
			{
   		 	strcat(chr_l_sel_msg_stmt,"' AND instr(nvl(a.MSG_STAT,' '),'");
		    	strcat(chr_l_sel_msg_stmt,MSG_FLG_572);
			 	strcat(chr_l_sel_msg_stmt,"') = 0 AND ");


      	  strcat(chr_l_sel_msg_stmt," a.INSTRUMENT_DT is not null and a.INSTRUMENT_DT <= '");
          strcat(chr_l_sel_msg_stmt,chr_as_of_date);
          strcat(chr_l_sel_msg_stmt,"'");
			}
			else
			{
   		 	strcat(chr_l_sel_msg_stmt,"' AND instr(nvl(a.MSG_STAT,' '),'");
		    	strcat(chr_l_sel_msg_stmt,MSG_FLG_WEEKLY_STM);
			 	strcat(chr_l_sel_msg_stmt,"') = 0  ");
            strcat(chr_l_sel_msg_stmt," AND a.INSTRUMENT_DT is not null and ((a.INSTRUMENT_DT<='");
          	strcat(chr_l_sel_msg_stmt,chr_as_of_date);
				strcat(chr_l_sel_msg_stmt,"'");
				strcat(chr_l_sel_msg_stmt," and a.INSTRUMENT_DT>'");
				strcat(chr_l_sel_msg_stmt,chr_l_last_gen_date);
				strcat(chr_l_sel_msg_stmt,"')");
				strcat(chr_l_sel_msg_stmt," or (a.MOD_HISPOS_DATE>'");
				strcat(chr_l_sel_msg_stmt,chr_l_last_gen_date);
				strcat(chr_l_sel_msg_stmt,"'");
				strcat(chr_l_sel_msg_stmt," and a.MOD_HISPOS_DATE<='");
				strcat(chr_l_sel_msg_stmt,chr_as_of_date);
				strcat(chr_l_sel_msg_stmt,"')");
				strcat(chr_l_sel_msg_stmt," OR (a.MOD_HISPOS_IND='Y'))");
			}

			

			if ( chr_l_typeofinstr[0] == 'B' )
			{
				strcat( chr_l_sel_msg_stmt, " AND c.INSTR_TYPE in ('BON','FMT')");
			}
			else if ( chr_l_typeofinstr[0] == 'S' )
			{
				strcat( chr_l_sel_msg_stmt, " AND c.INSTR_TYPE in ('SHS','RTS')");
			}

          strcat(chr_l_sel_msg_stmt," AND a.client = b.cln_code  and b.checker is not null ");
          strcat(chr_l_sel_msg_stmt," AND a.domestic_cpclt = d.pty_code  and d.checker is not null ");
          strcat(chr_l_sel_msg_stmt," AND a.instr_code  = c.instr_code  UNION ");

          strcat(chr_l_sel_msg_stmt,"SELECT e.client ,e.IDENTIY_NO ,'Y' as REVERSE,'");
			 strcat(chr_l_sel_msg_stmt,chr_l_week_stm);
         strcat(chr_l_sel_msg_stmt,"' as WEEK_IND ,");
         strcat(chr_l_sel_msg_stmt," 'N' as HISTORY_TRADE,CONCAT(e.IDENTIY_NO,CONCAT('|','Y'))as REFNO_R,'35' as RTYP,e.IDENTIY_NO as PROC_INIT,substr(replace(replace(f.cln_name,chr(13),NULL),chr(10),NULL),1,35 )as CLNT_NAME,f.CLN_SHORTNM as ALPHACODE,"); 
          strcat(chr_l_sel_msg_stmt,"f.CLN_USE_ISIN_IND as FLGISIN,f.CLN_FMT_RPTIND,f.cln_master,e.instr_code,g.NOMINAL_VALUE,"); 
          strcat(chr_l_sel_msg_stmt," decode(g.INSTR_TYPE,'BON',decode(f.CLN_FMT_RPTIND,'Y','FMT'");
          strcat(chr_l_sel_msg_stmt,",g.INSTR_TYPE),g.INSTR_TYPE) as FTYPEOFINSTR,decode(g.INSTR_TYPE,'BON',decode(f.CLN_FMT_RPTIND,'Y',to_char(e.QTY*g.NOMINAL_VALUE),e.QTY),e.QTY) as FENT_POS,");        
          strcat(chr_l_sel_msg_stmt," decode(g.INSTR_TYPE,'BON',decode(f.CLN_FMT_RPTIND,'Y','Y','N'),'N') as NEW_FMTFLG,");
          strcat(chr_l_sel_msg_stmt,"substr(to_char(e.setl_date,'YYMMDD'),1,6) as SETL_DATE,substr(to_char(e.setl_date,'YYYYMMDD'),1,8) as NEW_SETTLEDT,");
          strcat(chr_l_sel_msg_stmt,"g.INSTR_TYPE,substr(replace(replace(g.instr_name,chr(13),NULL),chr(10),NULL),1,31) as INSTR_NAME,g.currency_cd,g.INSTR_ISIN,decode(e.dl_class,'27','26','29','26',e.dl_class) as TTRD,");  
			 
          strcat(chr_l_sel_msg_stmt,"e.deal_cd,concat(e.IDENTIY_NO,'//') as ORIG_REFNO,'SE'||dbl_i.UNIQ_IDENT_NO as UNIQ_IDENT_NO,e.ORIG_REFNO as NEW_ORIGREFNO,e.lcl_identno as NEW_LOCREFNO,e.domestic_cpclt as NEW_DOMCPAC,decode(rtrim(ltrim(e.cp_clt)),NULL,NULL,rtrim(ltrim(e.cp_clt))) as NEW_COUNTACC,decode(ltrim(e.CP_CLTNAME),NULL,upper(substr(replace(replace(h.pty_name,chr(13),NULL),chr(10),NULL),1,35)),upper(decode(substr(replace(replace(e.CP_CLTNAME,chr(13),NULL),chr(10),NULL),1,1),'/',substr(replace(replace(e.CP_CLTNAME,chr(13),NULL),chr(10),NULL),2,34),substr(replace(replace(e.CP_CLTNAME,chr(13),NULL),chr(10),NULL),1,35)))) as CP_CLTNAME,substr(to_char(e.INSTRUMENT_DT,'YYMMDD'),1,6) as INSTRUMENT_DT,substr(to_char(e.INSTRUMENT_DT,'YYYYMMDD'),1,8) as NEW_INSTR_DT,");

			 strcat(chr_l_sel_msg_stmt, "decode(to_char(e.MONEY_SETL_DT, 'YYYYMMDD'), to_char(e.INSTRUMENT_DT,'YYYYMMDD'), NULL, to_char(e.MONEY_SETL_DT, 'YYYYMMDD')) as VALU_DT, ");     
          strcat(chr_l_sel_msg_stmt,"decode(e.dl_class,19,NULL,decode(e.dl_class,1,decode(e.deal_cd,1,12,decode(e.deal_cd,3,12,decode(e.deal_cd,5,12,decode(e.deal_cd,7,12,11)))),");
          strcat(chr_l_sel_msg_stmt,"3,decode(e.deal_cd,1,12,decode(e.deal_cd,3,12,decode(e.deal_cd,5,12,decode(e.deal_cd,7,12,11)))),");
          strcat(chr_l_sel_msg_stmt,"18,decode(e.deal_cd,1,12,decode(e.deal_cd,3,12,decode(e.deal_cd,5,12,decode(e.deal_cd,7,12,11)))),");
          strcat(chr_l_sel_msg_stmt,"20,decode(e.deal_cd,1,12,decode(e.deal_cd,3,12,decode(e.deal_cd,5,12,decode(e.deal_cd,7,12,11)))),");
          strcat(chr_l_sel_msg_stmt," 21,decode(e.deal_cd,1,12,decode(e.deal_cd,3,12,decode(e.deal_cd,5,12,decode(e.deal_cd,7,12,11)))),");
          strcat(chr_l_sel_msg_stmt,"22,decode(e.deal_cd,1,12,decode(e.deal_cd,3,12,decode(e.deal_cd,5,12,decode(e.deal_cd,7,12,11)))),");
          strcat(chr_l_sel_msg_stmt,"25,decode(e.deal_cd,1,12,decode(e.deal_cd,3,12,decode(e.deal_cd,5,12,decode(e.deal_cd,7,12,11)))),");
          strcat(chr_l_sel_msg_stmt,"26,decode(e.deal_cd,1,12,decode(e.deal_cd,3,12,decode(e.deal_cd,5,12,decode(e.deal_cd,7,12,11)))),");
          strcat(chr_l_sel_msg_stmt,"99,decode(e.deal_cd,1,12,decode(e.deal_cd,3,12,decode(e.deal_cd,5,12,decode(e.deal_cd,7,12,11)))),");
          strcat(chr_l_sel_msg_stmt,"2,14,");
          strcat(chr_l_sel_msg_stmt,"10,22,");
          strcat(chr_l_sel_msg_stmt,"decode(e.deal_cd,1,12,decode(e.deal_cd,3,12,decode(e.deal_cd,5,12,decode(e.deal_cd,7,12,11)))))) as NCATYP,");
          strcat(chr_l_sel_msg_stmt,"substr(to_char(e.MONEY_SETL_DT,'YYMMDD'),1,6) as MONEY_SETL_DT,e.PARTIAL_IND_B,substr(to_char(e.deal_date,'YYMMDD'),1,6) as DEAL_DATE,substr(to_char(e.deal_date,'YYYYMMDD'),1,8) as NEW_TRDT,decode(e.failreason_cd,NULL,'0',substr(lpad(e.failreason_cd,2,'0'),1,2)) as FAILREASON_CD,'N' as NIL_MOV_IND,");
          strcat(chr_l_sel_msg_stmt,"concat('/',e.client) as NACCOUNT,g.currency_cd as CCYOPNBAL,g.currency_cd,g.currency_cd as CCYAMOUNT,decode(e.QTY,e.ORIG_QTY,'Y','N') as SAMEQTY , ");
          strcat(chr_l_sel_msg_stmt," f.CLN_TAXABLE_IND  as IND_83C83D ");
          /*03July Vaibhav ISKB:1643*/
          strcat(chr_l_sel_msg_stmt," ,f.CLN_DEAL_SETL_IND as CLN_DEAL_SETL_IND ");
          /*03July Vaibhav ISKB:1643*/
          strcat(chr_l_sel_msg_stmt," ,concat(e.client,concat('||',e.instr_code)) as ACC_INSTR_CODE ");
          strcat(chr_l_sel_msg_stmt," , substr(to_char(to_date('");
          strcat(chr_l_sel_msg_stmt,chr_l_as_of_date);
          strcat(chr_l_sel_msg_stmt,"','RRMMDD'),'YYYYMMDD'),1,8) as NEW_ASOFDATE ");
          strcat(chr_l_sel_msg_stmt,",decode(e.domestic_cpclt,'");
          strcat(chr_l_sel_msg_stmt,chr_h_citibank_acct_code);
          strcat(chr_l_sel_msg_stmt,"','Y','N') as IS_CT_DOMCPAC ");
  if (int_noelem == 7)
     {
          strcat(chr_l_sel_msg_stmt,",");
          strcat(chr_l_sel_msg_stmt,chr_l_param[2]);
          strcat(chr_l_sel_msg_stmt," as CONTACTSEQ  ");
     }

   #ifdef EMU_PROCESSING      

          strcat(chr_l_sel_msg_stmt," ,'");
          strcat(chr_l_sel_msg_stmt,chr_l_emu_effd_t_6);
          strcat(chr_l_sel_msg_stmt,"' as EFFD ");
          strcat(chr_l_sel_msg_stmt," , substr(to_char(to_date('");
          strcat(chr_l_sel_msg_stmt,chr_l_emu_effd_t_6);
          strcat(chr_l_sel_msg_stmt,"','RRMMDD'),'YYYYMMDD'),1,8) as NEW_EFFD ");
  #endif         
          strcat(chr_l_sel_msg_stmt," , CONCAT(e.client,CONCAT('|',CONCAT(e.IDENTIY_NO,CONCAT('|','Y')))) as ACC_REFNO ");
          strcat(chr_l_sel_msg_stmt," ,decode(ltrim(rtrim(substr(e.clientof,1,35))),NULL,NULL,ltrim(rtrim(substr(e.clientof,1,35)))) as NEW_ACCOUNTOF1  ");
          strcat(chr_l_sel_msg_stmt," ,decode(ltrim(rtrim(substr(e.clientof,36,30))),NULL,NULL,ltrim(rtrim(substr(e.clientof,36,30)))) as NEW_ACCOUNTOF2  ");
			 strcat(chr_l_sel_msg_stmt," ,decode(ltrim(rtrim(substr(e.INSTRUCT_PERSONNM,1,35))),NULL,NULL,ltrim(rtrim(substr(e.INSTRUCT_PERSONNM,1,35)))) as INSTPARTYNM1  ");
			strcat(chr_l_sel_msg_stmt," ,decode(ltrim(rtrim(substr(e.INSTRUCT_PERSONNM,36,30))),NULL,NULL,ltrim(rtrim(substr(e.INSTRUCT_PERSONNM,36,30)))) as INSTPARTYNM2  ");
          strcat(chr_l_sel_msg_stmt," , e.ENTRY "); 
          strcat(chr_l_sel_msg_stmt," ,decode(ltrim(rtrim(substr(e.CP_CLTNAME,1,35))),NULL,NULL,ltrim(rtrim(substr(e.CP_CLTNAME,1,35)))) as NEW_COUNTACCNAME ");
          strcat(chr_l_sel_msg_stmt," ,decode(ltrim(rtrim(substr(e.CP_CLTNAME,36,30))),NULL,NULL,ltrim(rtrim(substr(e.CP_CLTNAME,36,30)))) as NEW_COUNTACCNAME1 ");
          strcat(chr_l_sel_msg_stmt," FROM DL_DEALRST e,MT_CLIENT f,MT_INSTRUMENT g, MT_PARTY h,DL_DEAL dbl_i "); 
          strcat(chr_l_sel_msg_stmt," WHERE ");
  if(strlen(l_ms_msgent_structa_a.client) != 0)
    {
          strcat(chr_l_sel_msg_stmt," e.client = '");
          strcat(chr_l_sel_msg_stmt,l_ms_msgent_structa_a.client);
          strcat(chr_l_sel_msg_stmt,"' AND ");
    }
		  	 strcat(chr_l_sel_msg_stmt," e.client = dbl_i.client AND e.IDENTIY_NO=dbl_i.IDENTIY_NO AND "); 
          strcat(chr_l_sel_msg_stmt," f.CLN_BRK_ALL != 'B' and f.STATUS != '");
          strcat(chr_l_sel_msg_stmt,STATUS_CLS_AUTH); 
			if (strcmp(chr_l_week_stm,"Y")!=0)
			{
          	strcat(chr_l_sel_msg_stmt,"'and INSTR(NVL(e.MSG_STAT,' '),'R') = 0");
          	strcat(chr_l_sel_msg_stmt," and INSTR(NVL(e.MSG_STAT,' '),'P') = 0");
			}
         else
         {

            
            strcat(chr_l_sel_msg_stmt,"'  and INSTR(NVL(e.MSG_STAT,' '),'R') = 0 ");
				strcat(chr_l_sel_msg_stmt," AND instr(nvl(e.MSG_STAT,' '),'");
				strcat(chr_l_sel_msg_stmt,RESET_FLG);
				strcat(chr_l_sel_msg_stmt,"') <> 0  ");
            strcat(chr_l_sel_msg_stmt," AND e.RESET_DT<='");
            strcat(chr_l_sel_msg_stmt,chr_as_of_date);
            strcat(chr_l_sel_msg_stmt,"'");
            strcat(chr_l_sel_msg_stmt," and e.RESET_DT>'");
            strcat(chr_l_sel_msg_stmt,chr_l_last_gen_date);
            strcat(chr_l_sel_msg_stmt,"'");
         }


  if ( chr_l_typeofinstr[0] == 'B' )
     {
          strcat( chr_l_sel_msg_stmt, " AND g.INSTR_TYPE in ('BON','FMT')");
     }
  else if ( chr_l_typeofinstr[0] == 'S' )
     {
          strcat( chr_l_sel_msg_stmt, " AND g.INSTR_TYPE in ('SHS','RTS')");
     }
          strcat(chr_l_sel_msg_stmt," AND e.client = f.cln_code  and f.checker is not null ");
          strcat(chr_l_sel_msg_stmt," AND e.domestic_cpclt = h.pty_code  and h.checker is not null ");
          strcat(chr_l_sel_msg_stmt," AND e.instr_code  = g.instr_code ");
          




		if((int_l_next_month!=0) && (strcmp(chr_l_week_stm,"Y")==0))
		{

			strcat(chr_l_sel_msg_stmt," UNION SELECT a.client , a.IDENTIY_NO ,'N' as REVERSE,'");
         strcat(chr_l_sel_msg_stmt,chr_l_week_stm);
         strcat(chr_l_sel_msg_stmt,"' as WEEK_IND ,");
         strcat(chr_l_sel_msg_stmt," 'Y' as HISTORY_TRADE, CONCAT(a.IDENTIY_NO,CONCAT('|','N'))as REFNO_R,' ' as RTYP, a.IDENTIY_NO as PROC_INIT,substr(replace (replace(b.cln_name,chr(13),NULL),chr(10),NULL),1,35 )as CLNT_NAME,b.CLN_SHORTNM as ALPHACODE,");
         strcat(chr_l_sel_msg_stmt,"b.CLN_USE_ISIN_IND as FLGISIN,b.CLN_FMT_RPTIND,b.cln_master,a.instr_code,c.NOMINAL_VALUE,");
     strcat(chr_l_sel_msg_stmt," decode(c.INSTR_TYPE,'BON',decode(b.CLN_FMT_RPTIND,'Y','FMT'");
     strcat(chr_l_sel_msg_stmt,",c.INSTR_TYPE),c.INSTR_TYPE) as FTYPEOFINSTR,decode(c.INSTR_TYPE,'BON',decode(b.CLN_FMT_RPTIND,'Y',to_char(a.QTY*c.NOMINAL_VALUE),a.QTY),a.QTY) as FENT_POS,");
     strcat(chr_l_sel_msg_stmt," decode(c.INSTR_TYPE,'BON',decode(b.CLN_FMT_RPTIND,'Y','Y','N'),'N') as NEW_FMTFLG,");
          strcat(chr_l_sel_msg_stmt,"substr(to_char(a.setl_date,'YYMMDD'),1,6) as SETL_DATE,substr(to_char(a.setl_date,'YYYYMMDD'),1,8) as NEW_SETTLEDT,");
          strcat(chr_l_sel_msg_stmt,"c.INSTR_TYPE,substr(replace(replace(c.instr_name,chr(13),NULL),chr(10),NULL),1,31) as INSTR_NAME,c.currency_cd,c.INSTR_ISIN,decode(a.dl_class,'27','26','29','26',a.dl_class) as TTRD,"); 
			 
          strcat(chr_l_sel_msg_stmt,"a.deal_cd,concat(a.IDENTIY_NO,'//') as ORIG_REFNO,'SE'||a.UNIQ_IDENT_NO as UNIQ_IDENT_NO,a.ORIG_REFNO as NEW_ORIGREFNO,a.lcl_identno as NEW_LOCREFNO,a.domestic_cpclt as NEW_DOMCPAC,decode(rtrim(ltrim(a.cp_clt)),NULL,NULL,rtrim(ltrim(a.cp_clt))) as NEW_COUNTACC,decode(ltrim(a.CP_CLTNAME),NULL,upper(substr(replace(replace(d.pty_name,chr(13),NULL),chr(10),NULL),1,35)),upper(decode(substr(replace(replace(a.CP_CLTNAME,chr(13),NULL),chr(10),NULL),1,1),'/',substr(replace(replace(a.CP_CLTNAME,chr(13),NULL),chr(10),NULL),2,34),substr(replace(replace(a.CP_CLTNAME,chr(13),NULL),chr(10),NULL),1,35)))) as CP_CLTNAME,substr(to_char(a.INSTRUMENT_DT,'YYMMDD'),1,6) as INSTRUMENT_DT,substr(to_char(a.INSTRUMENT_DT,'YYYYMMDD'),1,8) as NEW_INSTR_DT,");

			 strcat(chr_l_sel_msg_stmt, "decode(to_char(a.MONEY_SETL_DT, 'YYYYMMDD'), to_char(a.INSTRUMENT_DT,'YYYYMMDD'), NULL, to_char(a.MONEY_SETL_DT, 'YYYYMMDD')) as VALU_DT, ");     
          strcat(chr_l_sel_msg_stmt,"decode(a.dl_class,19,NULL,decode(a.dl_class,1,decode(a.deal_cd,1,12,decode(a.deal_cd,3,12,decode(a.deal_cd,5,12,decode(a.deal_cd,7,12,11)))),");
          strcat(chr_l_sel_msg_stmt,"3,decode(a.deal_cd,1,12,decode(a.deal_cd,3,12,decode(a.deal_cd,5,12,decode(a.deal_cd,7,12,11)))),");
          strcat(chr_l_sel_msg_stmt,"18,decode(a.deal_cd,1,12,decode(a.deal_cd,3,12,decode(a.deal_cd,5,12,decode(a.deal_cd,7,12,11)))),");
          strcat(chr_l_sel_msg_stmt,"20,decode(a.deal_cd,1,12,decode(a.deal_cd,3,12,decode(a.deal_cd,5,12,decode(a.deal_cd,7,12,11)))),");
          strcat(chr_l_sel_msg_stmt," 21,decode(a.deal_cd,1,12,decode(a.deal_cd,3,12,decode(a.deal_cd,5,12,decode(a.deal_cd,7,12,11)))),");
          strcat(chr_l_sel_msg_stmt,"22,decode(a.deal_cd,1,12,decode(a.deal_cd,3,12,decode(a.deal_cd,5,12,decode(a.deal_cd,7,12,11)))),");
          strcat(chr_l_sel_msg_stmt,"25,decode(a.deal_cd,1,12,decode(a.deal_cd,3,12,decode(a.deal_cd,5,12,decode(a.deal_cd,7,12,11)))),");
          strcat(chr_l_sel_msg_stmt,"26,decode(a.deal_cd,1,12,decode(a.deal_cd,3,12,decode(a.deal_cd,5,12,decode(a.deal_cd,7,12,11)))),");
          strcat(chr_l_sel_msg_stmt,"99,decode(a.deal_cd,1,12,decode(a.deal_cd,3,12,decode(a.deal_cd,5,12,decode(a.deal_cd,7,12,11)))),");
          strcat(chr_l_sel_msg_stmt,"2,14,");
          strcat(chr_l_sel_msg_stmt,"10,22,");
          strcat(chr_l_sel_msg_stmt,"decode(a.deal_cd,1,12,decode(a.deal_cd,3,12,decode(a.deal_cd,5,12,decode(a.deal_cd,7,12,11)))))) as NCATYP,");
          strcat(chr_l_sel_msg_stmt,"substr(to_char(a.MONEY_SETL_DT,'YYMMDD'),1,6) as MONEY_SETL_DT,a.PARTIAL_IND_B,substr(to_char(a.deal_date,'YYYYMMDD'),1,8) as DEAL_DATE,substr(to_char(a.deal_date,'YYYYMMDD'),1,8) as NEW_TRDT,decode(a.failreason_cd,NULL,'0',substr(lpad(a.failreason_cd,2,'0'),1,2)) as FAILREASON_CD,'N' as NIL_MOV_IND,");
          strcat(chr_l_sel_msg_stmt,"concat('/',a.client) as NACCOUNT,c.currency_cd as CCYOPNBAL,c.currency_cd,c.currency_cd as CCYAMOUNT,decode(a.QTY,a.ORIG_QTY,'Y','N') as SAMEQTY , ");
         strcat(chr_l_sel_msg_stmt," b.CLN_TAXABLE_IND  as IND_83C83D ");
         /*03July Vaibhav ISKB:1643*/
          strcat(chr_l_sel_msg_stmt," ,b.CLN_DEAL_SETL_IND as CLN_DEAL_SETL_IND "); 
         /*03July Vaibhav ISKB:1643*/
         strcat(chr_l_sel_msg_stmt," ,concat(a.client,concat('||',a.instr_code)) as ACC_INSTR_CODE ");
         strcat(chr_l_sel_msg_stmt," , substr(to_char(to_date('");
         strcat(chr_l_sel_msg_stmt,chr_l_as_of_date);
         strcat(chr_l_sel_msg_stmt,"','RRMMDD'),'YYYYMMDD'),1,8) as NEW_ASOFDATE ");
         strcat(chr_l_sel_msg_stmt,",decode(a.domestic_cpclt,'");
         strcat(chr_l_sel_msg_stmt,chr_h_citibank_acct_code);
         strcat(chr_l_sel_msg_stmt,"','Y','N') as IS_CT_DOMCPAC ");

         if (int_noelem == 7)
         {
               strcat(chr_l_sel_msg_stmt,",");
               strcat(chr_l_sel_msg_stmt,chr_l_param[2]);
               strcat(chr_l_sel_msg_stmt," as CONTACTSEQ  ");
         }

         #ifdef EMU_PROCESSING
            strcat(chr_l_sel_msg_stmt," ,'");
            strcat(chr_l_sel_msg_stmt,chr_l_emu_effd_t_6);
            strcat(chr_l_sel_msg_stmt,"' as EFFD ");
            strcat(chr_l_sel_msg_stmt," , substr(to_char(to_date('");
            strcat(chr_l_sel_msg_stmt,chr_l_emu_effd_t_6);
            strcat(chr_l_sel_msg_stmt,"','RRMMDD'),'YYYYMMDD'),1,8) as NEW_EFFD ");

         #endif

         strcat(chr_l_sel_msg_stmt," , CONCAT(a.client,CONCAT('|',CONCAT (a.IDENTIY_NO,CONCAT('|','N'))))as ACC_REFNO ");
         strcat(chr_l_sel_msg_stmt," ,decode(ltrim(rtrim(substr(a.clientof,1,35))),NULL,NULL,ltrim(rtrim(substr(a.clientof,1,35)))) as NEW_ACCOUNTOF1  ");
         strcat(chr_l_sel_msg_stmt," ,decode(ltrim(rtrim(substr(a.clientof,36,30))),NULL,NULL,ltrim(rtrim(substr(a.clientof,36,30)))) as NEW_ACCOUNTOF2  ");
         strcat(chr_l_sel_msg_stmt," ,decode(ltrim(rtrim(substr(a.INSTRUCT_PERSONNM,1,35))),NULL,NULL,ltrim(rtrim(substr(a.INSTRUCT_PERSONNM,1,35)))) as INSTPARTYNM1  ");
         strcat(chr_l_sel_msg_stmt," ,decode(ltrim(rtrim(substr(a.INSTRUCT_PERSONNM,36,30))),NULL,NULL,ltrim(rtrim(substr(a.INSTRUCT_PERSONNM,36,30)))) as INSTPARTYNM2  "); 
         strcat(chr_l_sel_msg_stmt," , a.ENTRY "); 
         strcat(chr_l_sel_msg_stmt," ,decode(ltrim(rtrim(substr(a.CP_CLTNAME,1,35))),NULL,NULL,ltrim(rtrim(substr(a.CP_CLTNAME,1,35)))) as NEW_COUNTACCNAME ");
         strcat(chr_l_sel_msg_stmt," ,decode(ltrim(rtrim(substr(a.CP_CLTNAME,36,30))),NULL,NULL,ltrim(rtrim(substr(a.CP_CLTNAME,36,30)))) as NEW_COUNTACCNAME1 ");
          strcat(chr_l_sel_msg_stmt," FROM DL_COPYHISTORY a,MT_CLIENT b,MT_INSTRUMENT c, MT_PARTY d ");
          strcat(chr_l_sel_msg_stmt," WHERE ");
          if(strlen(l_ms_msgent_structa_a.client) != 0)
          {
            strcat(chr_l_sel_msg_stmt," a.client = '");
         strcat(chr_l_sel_msg_stmt,l_ms_msgent_structa_a.client);
            strcat(chr_l_sel_msg_stmt,"' AND ");
           }
          strcat(chr_l_sel_msg_stmt," b.CLN_BRK_ALL != 'B' and b.STATUS != '");
          strcat(chr_l_sel_msg_stmt,STATUS_CLS_AUTH);

         if(strcmp(chr_l_week_stm,"Y") !=0)
         {
            strcat(chr_l_sel_msg_stmt,"' AND instr(nvl(a.MSG_STAT,' '),'");
            strcat(chr_l_sel_msg_stmt,MSG_FLG_572);
            strcat(chr_l_sel_msg_stmt,"') = 0 AND ");

           strcat(chr_l_sel_msg_stmt," a.INSTRUMENT_DT is not null and a.INSTRUMENT_DT <= '");
          strcat(chr_l_sel_msg_stmt,chr_as_of_date);
          strcat(chr_l_sel_msg_stmt,"'");
         }
         else
         {
            strcat(chr_l_sel_msg_stmt,"' AND instr(nvl(a.MSG_STAT,' '),'");
            strcat(chr_l_sel_msg_stmt,MSG_FLG_WEEKLY_STM);
            strcat(chr_l_sel_msg_stmt,"') = 0  ");
            strcat(chr_l_sel_msg_stmt," AND a.INSTRUMENT_DT is not null and ((a.INSTRUMENT_DT<='");
            strcat(chr_l_sel_msg_stmt,chr_as_of_date);
            strcat(chr_l_sel_msg_stmt,"'");
            strcat(chr_l_sel_msg_stmt," and a.INSTRUMENT_DT>'");
            strcat(chr_l_sel_msg_stmt,chr_l_last_gen_date);
            strcat(chr_l_sel_msg_stmt,"')");
            strcat(chr_l_sel_msg_stmt," or (a.MOD_HISPOS_DATE>'");
            strcat(chr_l_sel_msg_stmt,chr_l_last_gen_date);
            strcat(chr_l_sel_msg_stmt,"'");
            strcat(chr_l_sel_msg_stmt," and a.MOD_HISPOS_DATE<='");
            strcat(chr_l_sel_msg_stmt,chr_as_of_date);
            strcat(chr_l_sel_msg_stmt,"')");
            strcat(chr_l_sel_msg_stmt," )");
         }

         if ( chr_l_typeofinstr[0] == 'B' )
         {
            strcat( chr_l_sel_msg_stmt, " AND c.INSTR_TYPE in ('BON','FMT')");
         }
         else if ( chr_l_typeofinstr[0] == 'S' )
         {
            strcat( chr_l_sel_msg_stmt, " AND c.INSTR_TYPE in ('SHS','RTS')");
         }

          strcat(chr_l_sel_msg_stmt," AND a.client = b.cln_code  and b.checker is not null ");
          strcat(chr_l_sel_msg_stmt," AND a.domestic_cpclt = d.pty_code  and d.checker is not null ");
          strcat(chr_l_sel_msg_stmt," AND a.instr_code  = c.instr_code ");
          
		 }
          strcat(chr_l_sel_msg_stmt," order by client,instr_code,IDENTIY_NO ");


       } 


        
        if(strcmp(p_msg_no,"571A") == 0 || strcmp(p_msg_no,"571C")==0)
        {
          l_msgaddr = MHOLDINGSMSGNO;

			
			l_nohold_rus = 0;

			if(APL_FAILURE == CO_Chk_CntryEnabled("MSG_HOLD","NO_HOLD_CONSMSG",&l_nohold_rus,l_debug_info_ptr))
			{
				APL_GOBACK_FAIL
			}


          *p_STAT_VAL = realloc(*p_STAT_VAL,sizeof(MS_STATIC_VAL)*16); 

          *p_SEL_VAL = realloc(*p_SEL_VAL,sizeof(MS_STATIC_VAL)*5); 

          strcpy((*p_STAT_VAL)[0].link_val,"DUMMY");
          strcpy((*p_STAT_VAL)[0].link_tag,"DUMMY");
          strcpy((*p_STAT_VAL)[1].link_val,"DOMSEC");
          strcpy((*p_STAT_VAL)[1].link_tag,chr_h_dom_instr);

          if(strlen(l_ms_msgent_structa_a.proc_data) != 0)
          {
				
            
				strcpy(chr_p_as_of_date,strtok_r(l_ms_msgent_structa_a.proc_data,";",&chr_temp));
            strcpy(chr_as_of_date,chr_p_as_of_date);
            
				strcpy(chr_l_dd,strtok_r(chr_p_as_of_date,"/",&chr_dtemp));
            
				strcpy(chr_l_mm,strtok_r(NULL,"/",&chr_dtemp));
            
				strcpy(chr_p_yy,strtok_r(NULL," ",&chr_dtemp));
            chr_l_yy[0] = chr_p_yy[2];
            chr_l_yy[1] = chr_p_yy[3];
            chr_l_yy[2] = '\0';
            strcpy(chr_l_as_of_date,chr_l_yy);
            strcat(chr_l_as_of_date,chr_l_mm);
            strcat(chr_l_as_of_date,chr_l_dd);

            CO_SplitStr((*p_imsgent_struct).proc_data,
                          ';', &int_noelem, &chr_l_param);

            strcpy(chr_l_historical,chr_l_param[1]);
            strcpy(chr_l_zero_bal,chr_l_param[2]);
            strcpy(chr_l_last_update,chr_l_param[3]);
            strcpy(chr_l_loc_stat,chr_l_param[4]);
				
            if (int_noelem == 11)
				{
             strcpy(chr_l_last_gen_date,chr_l_param[7]);
             strcpy(chr_l_week_stm,chr_l_param[8]);
             strcpy(chr_l_consmsg,chr_l_param[9]);
				}
            else if (int_noelem == 10)
				{
             strcpy(chr_l_consmsg,chr_l_param[6]);
             strcpy(chr_l_last_gen_date,chr_l_param[7]);
             strcpy(chr_l_week_stm,chr_l_param[8]);
				}
            else
             strcpy(chr_l_consmsg,chr_l_param[5]);
          }

          if(strlen(chr_as_of_date)==0)
          {
                APL_DATA_MISSING("AS OF DATE", APL_NULL_STRING, APL_NULL_STRING)
                APL_GOBACK_FAIL
          }
          if(strlen(chr_l_historical)==0)
          {
                APL_DATA_MISSING("HISTORICAL", APL_NULL_STRING, APL_NULL_STRING)
                APL_GOBACK_FAIL
          }
          if(strlen(chr_l_zero_bal)==0)
          {
                APL_DATA_MISSING("ZERO BALANCES", APL_NULL_STRING, APL_NULL_STRING)
                APL_GOBACK_FAIL
          }
          exec sql select substr(to_char(to_date(:chr_as_of_date),'MM/DD/YYYY'),1,100)
                  into :chr_t_as_of_date
                   from dual;
          IS_ANY_ORA_ERROR


          EXEC SQL SELECT SUBSTR(TO_CHAR(TO_DATE(:chr_as_of_date),'YYYYMMDD'),1,100)
                  INTO :chr_h_pasofdate_new:i_pasofdate_new
                   FROM DUAL;
          
			 IS_ANY_ORA_ERROR


          strcpy((*p_STAT_VAL)[2].link_val,"ASOFDATE");
          strcpy((*p_STAT_VAL)[2].link_tag,chr_as_of_date);

          strcpy((*p_STAT_VAL)[3].link_val,"ZEROBAL");
          strcpy((*p_STAT_VAL)[3].link_tag,chr_l_zero_bal);


          strcpy((*p_STAT_VAL)[4].link_val,"LOCSTAT");
          strcpy((*p_STAT_VAL)[4].link_tag,chr_l_loc_stat);

          strcpy((*p_STAT_VAL)[5].link_val,"DATE");
          strcpy((*p_STAT_VAL)[5].link_tag,h_sys_dt);

          strcpy((*p_STAT_VAL)[6].link_val,"HISTORICAL");
          strcpy((*p_STAT_VAL)[6].link_tag,chr_l_historical);

          strcpy((*p_STAT_VAL)[7].link_val,"PASOFDATE");
          strcpy((*p_STAT_VAL)[7].link_tag,chr_l_as_of_date);

          strcpy((*p_STAT_VAL)[8].link_val,"DOMCCY");
          strcpy((*p_STAT_VAL)[8].link_tag,chr_h_dom_ccycode);

          strcpy((*p_STAT_VAL)[9].link_val,"CA_NAME");
          strcpy((*p_STAT_VAL)[9].link_tag,chr_h_corporate_name);

          strcpy((*p_STAT_VAL)[10].link_val,"TASOFDATE");
          strcpy((*p_STAT_VAL)[10].link_tag,chr_t_as_of_date);

          strcpy((*p_STAT_VAL)[11].link_val,"COMB_MSG");
          strcpy((*p_STAT_VAL)[11].link_tag,chr_l_consmsg);

          strcpy((*p_STAT_VAL)[12].link_val,"SUBACCT");
          strcpy((*p_STAT_VAL)[12].link_tag,chr_h_sub_acct_processing);



          
			 strcpy((*p_STAT_VAL)[13].link_val,"NEW_PASOFDATE");
          strcpy((*p_STAT_VAL)[13].link_tag,chr_h_pasofdate_new); 
          
			 strcpy((*p_STAT_VAL)[14].link_val,"NEW_MNTH");
			 if(int_noelem == 11)
          	strcpy((*p_STAT_VAL)[14].link_tag,chr_l_param[6]); 
			 else
          	strcpy((*p_STAT_VAL)[14].link_tag,"N"); 
          
			 strcpy((*p_STAT_VAL)[15].link_val,"");
          strcpy((*p_STAT_VAL)[15].link_tag,""); 



          strcpy((*p_SEL_VAL)[0].link_val,"DUMMY");
          strcpy((*p_SEL_VAL)[1].link_val,"DUMMY");
          strcpy((*p_SEL_VAL)[2].link_val,"CLN_MASTER");
			 
			 strcpy((*p_SEL_VAL)[3].link_val,"CLIENT");
          strcpy((*p_SEL_VAL)[4].link_val,"");
          strcpy((*p_SEL_VAL)[4].link_tag,"");

         if (strcmp(p_msg_no,"571A")==0)
         {
          
		    if((l_nohold_rus == 0 ) || ((l_nohold_rus >0)&& (strcmp(chr_l_consmsg,"Y"))))
	     		strcpy(chr_l_sel_msg_stmt,"SELECT a.cln_master as client,");
          
          else
	     		strcpy(chr_l_sel_msg_stmt,"SELECT a.cln_code as client,");
          strcat(chr_l_sel_msg_stmt,"a.cln_master,'DUMMY' as PROC_INIT,a.CLN_ISCC_IND,a.cln_code as SUBACCOUNT,substr(replace(replace(a.cln_name,chr(13),NULL),chr(10),NULL),1,35) as CLNT_NAME,");
	  strcat(chr_l_sel_msg_stmt,"'Y' as NOHOLDGS,a.CLN_INTERNAL as SCHEDULE,");
			 
          strcat(chr_l_sel_msg_stmt," a.CLN_TAXABLE_IND  as IND_83C83D ");
			
          strcat(chr_l_sel_msg_stmt,",decode(a.CLN_REG_BCL_IND,'Y',a.CLN_REG_BCL_IND,'N')  as BHPREFIX ");
               strcat(chr_l_sel_msg_stmt,",'");
               strcat(chr_l_sel_msg_stmt,chr_l_week_stm);
               strcat(chr_l_sel_msg_stmt,"'");
               strcat(chr_l_sel_msg_stmt," as WEEKLY_STM,x.CLN_DEAL_SETL_IND  "); 
          

			
         if (int_noelem == 11)
         {
               strcat(chr_l_sel_msg_stmt,",");
               strcat(chr_l_sel_msg_stmt,chr_l_param[5]);
               strcat(chr_l_sel_msg_stmt," as CONTACTSEQ  ");
         }
			 
          strcat(chr_l_sel_msg_stmt,"  FROM MT_CLIENT a , MT_CLIENT x ");
          strcat(chr_l_sel_msg_stmt,"  where a.cln_master =x.cln_code and ");
          if(strcmp(chr_l_consmsg,"Y") == 0)
          {

          strcat(chr_l_sel_msg_stmt,"   EXISTS ( select 1 from MT_MSGADDRESS where MT_MSGADDRESS.cln_code = a.cln_master and MSG_IDENT_NO = '4' and COMB_MSG = 'Y') and ");
          }
          else
          {

          strcat(chr_l_sel_msg_stmt,"   EXISTS( select 1 from MT_MSGADDRESS where MT_MSGADDRESS.cln_code = a.cln_master and MSG_IDENT_NO = '4' and COMB_MSG = 'N') and ");
         
          strcat(chr_l_sel_msg_stmt,"    not exists (select 1 from MT_MSGADDRESS where MT_MSGADDRESS.cln_code=a.cln_code and a.cln_code!=a.cln_master and MSG_IDENT_NO='4' and COMB_MSG='N') and ");

          }
			
          if(chr_l_historical[0] == 'Y')
          {
            if((l_nohold_rus == 0 ) || ((l_nohold_rus >0)&& (strcmp(chr_l_consmsg,"Y"))))
            strcat(chr_l_sel_msg_stmt," a.checker is not null and (a.cln_code NOT IN (select distinct(client) from DL_HISSAFEK where POSIT_DATE = '");
            else
      strcat(chr_l_sel_msg_stmt," a.checker is not null and ( not exists ( select 1  from DL_HISSAFEK where client in ( select cln_code from MT_CLIENT where cln_master = a.cln_master and POSIT_DATE = '");

            strcat(chr_l_sel_msg_stmt,chr_as_of_date) ;
            strcat(chr_l_sel_msg_stmt,"'");
            
            
            if((l_nohold_rus == 0 ) || ((l_nohold_rus >0)&& (strcmp(chr_l_consmsg,"Y"))))
            {
               strcat(chr_l_sel_msg_stmt,") or (");
               strcat(chr_l_sel_msg_stmt," a.cln_code IN (select distinct(client) from DL_HISSAFEK where POSIT_DATE = '");
            }
            else
            {
  strcat(chr_l_sel_msg_stmt,"))  or exists ( select 1 from DL_HISSAFEK where client in (select cln_code from MT_CLIENT where cln_master = a.cln_master ) and POSIT_DATE ='");
            }
            strcat(chr_l_sel_msg_stmt,chr_as_of_date) ;
            strcat(chr_l_sel_msg_stmt,"'");
            if((l_nohold_rus == 0 ) || ((l_nohold_rus >0)&& (strcmp(chr_l_consmsg,"Y"))))
				{
            strcat(chr_l_sel_msg_stmt,"group by client having (sum(safekeep_pos) + decode(a.CLN_DEAL_SETL_IND,'Y',(select sum(c.VAL_REC+c.VAL_DEL+c.NVALRECEIVE+c.NVALDELIVER) from DL_HISSAFEK c where client =a.cln_code and c.location_cd in (select location_cd from MT_LOCATION where AVAIL_IND='AVAI') and c.POSIT_DATE = '");
				strcat(chr_l_sel_msg_stmt,chr_as_of_date) ;
				strcat(chr_l_sel_msg_stmt,"'");
				strcat(chr_l_sel_msg_stmt,"),0)) = 0)))");
				}
            else
				{
            strcat(chr_l_sel_msg_stmt,"group by client having (sum(safekeep_pos)+ decode(x.CLN_DEAL_SETL_IND,'Y',(select sum(c.VAL_REC+c.VAL_DEL+c.NVALRECEIVE+c.NVALDELIVER) from DL_HISSAFEK c where c.client in (select cln_code from MT_CLIENT where cln_master=a.cln_master) and c.location_cd in (select location_cd from MT_LOCATION where AVAIL_IND='AVAI') and c.POSIT_DATE ='");
				strcat(chr_l_sel_msg_stmt,chr_as_of_date) ;
				strcat(chr_l_sel_msg_stmt,"'");
				strcat(chr_l_sel_msg_stmt," ),0)) = 0))");
				}
            }
          else
          {
            if((l_nohold_rus == 0 ) || ((l_nohold_rus >0)&& (strcmp(chr_l_consmsg,"Y"))))
				{
            strcat(chr_l_sel_msg_stmt," a.checker is not null and (a.cln_code NOT IN (select distinct(client) from DL_SAFEK) OR a.cln_code IN (select distinct(client) from DL_SAFEK group by client having (sum(safekeep_pos) +decode(a.CLN_DEAL_SETL_IND,'Y',(select sum(c.VAL_REC+c.VAL_DEL+c.NVALRECEIVE+c.NVALDELIVER) from DL_SAFEK c where c.client =a.cln_code and c.location_cd in (select location_cd from MT_LOCATION where AVAIL_IND='AVAI') ),0)) = 0))");
				}
            else
				{
            strcat(chr_l_sel_msg_stmt," a.checker is not null and (not exists (select 1 from DL_SAFEK where client in( select cln_code from MT_CLIENT where cln_master = a.cln_master )) OR exists (select 1 from DL_SAFEK  where client  in (select cln_code from MT_CLIENT where cln_master = a.cln_master ) group by client having (sum(safekeep_pos)+ decode(x.CLN_DEAL_SETL_IND,'Y',(select sum(NVALRECEIVE+NVALDELIVER+VAL_REC+VAL_DEL) from DL_SAFEK c where location_cd in (select location_cd from MT_LOCATION where AVAIL_IND='AVAI') and client in (select cln_code from MT_CLIENT where cln_master=a.cln_master)),0)) = 0 ))");
				}
          }

          

          strcat(chr_l_sel_msg_stmt," and a.STATUS != '");
          strcat(chr_l_sel_msg_stmt,STATUS_CLS_AUTH);
          strcat(chr_l_sel_msg_stmt,"'");
			if((l_nohold_rus >0)&& (strcmp(chr_l_consmsg,"Y") == 0))
			  strcat(chr_l_sel_msg_stmt," and a.cln_code = a.cln_master");
          if(strlen(l_ms_msgent_structa_a.client) != 0)
          {
            if(strcmp(chr_l_consmsg,"Y") == 0)
	    {
              strcat(chr_l_sel_msg_stmt," and a.cln_master = '");
	    }
	    else
            {
              strcat(chr_l_sel_msg_stmt," and a.cln_master = '");
            }
            strcat(chr_l_sel_msg_stmt,l_ms_msgent_structa_a.client);
            strcat(chr_l_sel_msg_stmt,"' ");
	    
          }
          strcat(chr_l_sel_msg_stmt," ORDER BY a.cln_master,a.CLN_CODE");

        } 
        
        if (strcmp(p_msg_no,"571C")==0)
        {

   strcpy(chr_l_sel_msg_stmt,"SELECT a.cln_code as client,");
       strcat(chr_l_sel_msg_stmt,"a.cln_master,'DUMMY' as PROC_INIT,a.CLN_ISCC_IND,a.cln_code as SUBACCOUNT,substr(replace(replace(a.cln_name,chr(13),NULL),chr(10),NULL),1,35) as CLNT_NAME,");
     strcat(chr_l_sel_msg_stmt,"'Y' as NOHOLDGS,a.CLN_INTERNAL as SCHEDULE,");
          strcat(chr_l_sel_msg_stmt," a.CLN_TAXABLE_IND  as IND_83C83D ");
          strcat(chr_l_sel_msg_stmt,",decode(a.CLN_REG_BCL_IND,'Y',a.CLN_REG_BCL_IND,'N')  as BHPREFIX ");
               strcat(chr_l_sel_msg_stmt,",'");
               strcat(chr_l_sel_msg_stmt,chr_l_week_stm);
               strcat(chr_l_sel_msg_stmt,"'");
               strcat(chr_l_sel_msg_stmt," as WEEKLY_STM, a.CLN_DEAL_SETL_IND   "); 
         if (int_noelem == 11)
         {
               strcat(chr_l_sel_msg_stmt,",");
               strcat(chr_l_sel_msg_stmt,chr_l_param[5]);
               strcat(chr_l_sel_msg_stmt," as CONTACTSEQ  ");
         }
          strcat(chr_l_sel_msg_stmt,"  FROM MT_CLIENT a ");
          strcat(chr_l_sel_msg_stmt,"  where  ");

        strcat(chr_l_sel_msg_stmt,"   EXISTS( select 1 from MT_MSGADDRESS where MT_MSGADDRESS.cln_code= a.cln_code and MSG_IDENT_NO = '4' and COMB_MSG = 'N')  ");
   strcat(chr_l_sel_msg_stmt,"  AND NOT EXISTS ( select 1 from MT_MSGADDRESS where MT_MSGADDRESS.cln_code =a.cln_code and a.cln_code=a.cln_master AND MSG_IDENT_NO = '4' and COMB_MSG !='Y' ");

			 if(chr_l_historical[0] == 'Y')
          {
               strcat(chr_l_sel_msg_stmt,") and  a.checker is not null and (a.cln_code NOT IN (select distinct(client) from DL_HISSAFEK where POSIT_DATE = '");
               strcat(chr_l_sel_msg_stmt,chr_as_of_date) ;
               strcat(chr_l_sel_msg_stmt,"'");
               strcat(chr_l_sel_msg_stmt,") or (");
               strcat(chr_l_sel_msg_stmt," a.cln_code IN (select distinct(client) from DL_HISSAFEK where POSIT_DATE = '");
            strcat(chr_l_sel_msg_stmt,chr_as_of_date) ;
            strcat(chr_l_sel_msg_stmt,"'");
            strcat(chr_l_sel_msg_stmt,"group by client having (sum(safekeep_pos) + decode(a.CLN_DEAL_SETL_IND,'Y',(select sum(c.VAL_REC+c.VAL_DEL+c.NVALRECEIVE+c.NVALDELIVER) from DL_HISSAFEK c where client =a.cln_code and c.location_cd in (select location_cd from MT_LOCATION where AVAIL_IND='AVAI') and c.POSIT_DATE = '");
            strcat(chr_l_sel_msg_stmt,chr_as_of_date) ;
            strcat(chr_l_sel_msg_stmt,"'");
            strcat(chr_l_sel_msg_stmt,"),0))  = 0)))");
            }
          else
          {
          strcat(chr_l_sel_msg_stmt,") and a.checker is not null and (a.cln_code NOT IN (select distinct(client) from DL_SAFEK) OR a.cln_code IN (select distinct(client) from DL_SAFEK group by client having (sum(safekeep_pos)+ decode(a.CLN_DEAL_SETL_IND,'Y',(select sum(c.VAL_REC+c.VAL_DEL+c.NVALRECEIVE+c.NVALDELIVER) from DL_SAFEK c where c.client =a.cln_code and c.location_cd in (select location_cd from MT_LOCATION where AVAIL_IND='AVAI')),0)) = 0))");
          }	

          strcat(chr_l_sel_msg_stmt," and a.STATUS != '");
          strcat(chr_l_sel_msg_stmt,STATUS_CLS_AUTH);
          strcat(chr_l_sel_msg_stmt,"'");
          if(strlen(l_ms_msgent_structa_a.client) != 0)
          {
              strcat(chr_l_sel_msg_stmt," and a.cln_code = '");
            strcat(chr_l_sel_msg_stmt,l_ms_msgent_structa_a.client);
            strcat(chr_l_sel_msg_stmt,"' ");
          }
          strcat(chr_l_sel_msg_stmt," ORDER BY a.cln_code");

          }
      }
       
        if(strcmp(p_msg_no,"571") == 0 || strcmp(p_msg_no,"535B") == 0 || strcmp(p_msg_no,"535C") == 0)
        {

			  printf("HERE inside 571 again!!!!!\n");
          l_msgaddr = MHOLDINGSMSGNO;       



          *p_STAT_VAL = realloc(*p_STAT_VAL,sizeof(MS_STATIC_VAL)*23); 

			//Commented by Sana *p_SEL_VAL = realloc(*p_SEL_VAL,sizeof(MS_STATIC_VAL)*13); 
          *p_SEL_VAL = realloc(*p_SEL_VAL,sizeof(MS_STATIC_VAL)*24);      /* Retro from scotia */

          strcpy((*p_STAT_VAL)[0].link_val,"DUMMY");
          strcpy((*p_STAT_VAL)[0].link_tag,"DUMMY");
          strcpy((*p_STAT_VAL)[1].link_val,"DOMSEC");
          strcpy((*p_STAT_VAL)[1].link_tag,chr_h_dom_instr);

          if(strlen(l_ms_msgent_structa_a.proc_data) != 0)
          {
				 
             
				 strcpy(chr_p_as_of_date,strtok_r(l_ms_msgent_structa_a.proc_data,";",&chr_temp));
             strcpy(chr_as_of_date,chr_p_as_of_date);
             
				 strcpy(chr_l_dd,strtok_r(chr_p_as_of_date,"/",&chr_dtemp));
             
				 strcpy(chr_l_mm,strtok_r(NULL,"/",&chr_dtemp));
             
				 strcpy(chr_p_yy,strtok_r(NULL," ",&chr_dtemp));
             chr_l_yy[0] = chr_p_yy[2];
             chr_l_yy[1] = chr_p_yy[3];
             chr_l_yy[2] = '\0';
             strcpy(chr_l_as_of_date,chr_l_yy);
             strcat(chr_l_as_of_date,chr_l_mm);
             strcat(chr_l_as_of_date,chr_l_dd);

             CO_SplitStr((*p_imsgent_struct).proc_data,
                          ';', &int_noelem, &chr_l_param);

             strcpy(chr_l_historical,chr_l_param[1]); 
             strcpy(chr_l_zero_bal,chr_l_param[2]);
             strcpy(chr_l_last_update,chr_l_param[3]);
             strcpy(chr_l_loc_stat,chr_l_param[4]);
				 
            if (int_noelem==11)
            {
				 strcpy(chr_l_week_stm,chr_l_param[8]);
				 strcpy(chr_l_last_gen_date,chr_l_param[7]);
             strcpy(chr_l_consmsg,chr_l_param[9]);
             strcpy(chr_l_swftlx,chr_l_param[10]);
            }
            else if (int_noelem==10) 
            {
             strcpy(chr_l_consmsg,chr_l_param[6]);
				 strcpy(chr_l_week_stm,chr_l_param[8]);
				 strcpy(chr_l_last_gen_date,chr_l_param[7]);
             strcpy(chr_l_swftlx,chr_l_param[9]);
            }
            
            else if (int_noelem==9) 
            {
             strcpy(chr_l_consmsg,chr_l_param[6]);
             strcpy(chr_l_swftlx,chr_l_param[7]);
            }
            
            else
            {
             strcpy(chr_l_consmsg,chr_l_param[5]);
             strcpy(chr_l_swftlx,chr_l_param[6]);
            }

          }

          if(strlen(chr_as_of_date)==0)
          {
		APL_DATA_MISSING("AS OF DATE", APL_NULL_STRING, APL_NULL_STRING)
                APL_GOBACK_FAIL
          }
          if(strlen(chr_l_historical)==0)
          {
		APL_DATA_MISSING("HISTORICAL", APL_NULL_STRING, APL_NULL_STRING)
                APL_GOBACK_FAIL
          }
          if(strlen(chr_l_zero_bal)==0)
          {
		APL_DATA_MISSING("ZERO BALANCES", APL_NULL_STRING, APL_NULL_STRING)
                APL_GOBACK_FAIL
          }

          exec sql select substr(to_char(to_date(:chr_as_of_date),'MM/DD/YYYY'),1,100) 
                  into :chr_t_as_of_date
                   from dual;
          IS_ANY_ORA_ERROR


          EXEC SQL SELECT SUBSTR(TO_CHAR(TO_DATE(:chr_as_of_date),'YYYYMMDD'),1,100)
                  INTO :chr_h_pasofdate_new:i_pasofdate_new
                   FROM DUAL;
          
			 IS_ANY_ORA_ERROR


          strcpy((*p_STAT_VAL)[2].link_val,"ASOFDATE");
          strcpy((*p_STAT_VAL)[2].link_tag,chr_as_of_date);

          strcpy((*p_STAT_VAL)[3].link_val,"ZEROBAL");
          strcpy((*p_STAT_VAL)[3].link_tag,chr_l_zero_bal);
          

          strcpy((*p_STAT_VAL)[4].link_val,"LOCSTAT");
          strcpy((*p_STAT_VAL)[4].link_tag,chr_l_loc_stat);

          strcpy((*p_STAT_VAL)[5].link_val,"DATE");
          strcpy((*p_STAT_VAL)[5].link_tag,h_sys_dt);

          strcpy((*p_STAT_VAL)[6].link_val,"HISTORICAL");
          strcpy((*p_STAT_VAL)[6].link_tag,chr_l_historical);

          strcpy((*p_STAT_VAL)[7].link_val,"PASOFDATE");
          strcpy((*p_STAT_VAL)[7].link_tag,chr_l_as_of_date);

          strcpy((*p_STAT_VAL)[8].link_val,"DOMCCY");
          strcpy((*p_STAT_VAL)[8].link_tag,chr_h_dom_ccycode);

          strcpy((*p_STAT_VAL)[9].link_val,"CA_NAME");
          strcpy((*p_STAT_VAL)[9].link_tag,chr_h_corporate_name);

          strcpy((*p_STAT_VAL)[10].link_val,"TASOFDATE");
          strcpy((*p_STAT_VAL)[10].link_tag,chr_t_as_of_date);

          strcpy((*p_STAT_VAL)[11].link_val,"COMB_MSG");
          strcpy((*p_STAT_VAL)[11].link_tag,chr_l_consmsg);

          strcpy((*p_STAT_VAL)[12].link_val,"SUBACCT");
          strcpy((*p_STAT_VAL)[12].link_tag,chr_h_sub_acct_processing);

          if (strcmp(chr_l_swftlx,"Q") == 0)
             strcpy(chr_l_swftlx,"S");
          if (strcmp(chr_l_swftlx,"M") == 0)
             strcpy(chr_l_swftlx,"C");
          strcpy((*p_STAT_VAL)[13].link_val,"SWIFT_TLX_GCN");
          strcpy((*p_STAT_VAL)[13].link_tag,chr_l_swftlx);

		
          strcpy((*p_STAT_VAL)[14].link_val,"NATION");
			 strcpy((*p_STAT_VAL)[14].link_tag,g_mt_commonsys_params_struct_h.nation_code);
		
	 
			 strcpy((*p_STAT_VAL)[15].link_val,"NEW_TOTPORTFOLIO");
          strcpy((*p_STAT_VAL)[15].link_tag,"");
          
			 strcpy((*p_STAT_VAL)[16].link_val,"NEW_PASOFDATE");
          strcpy((*p_STAT_VAL)[16].link_tag,chr_h_pasofdate_new);
          
			 strcpy((*p_STAT_VAL)[17].link_val,"NEW_MNTH");
			 if(int_noelem==11)
          	strcpy((*p_STAT_VAL)[17].link_tag,chr_l_param[6]);
			 else
          	strcpy((*p_STAT_VAL)[17].link_tag,"N");
          strcpy((*p_STAT_VAL)[18].link_val,"NEW_MSTACCCCYCODE");
          strcpy((*p_STAT_VAL)[18].link_tag,"");
          strcpy((*p_STAT_VAL)[19].link_val,"NEW_FXQUOTE_IND");
          strcpy((*p_STAT_VAL)[19].link_tag,chr_h_fx_quote);
          strcpy((*p_STAT_VAL)[20].link_val,"CNTRY_BIC");
          strcpy((*p_STAT_VAL)[20].link_tag,l_mt_message_sys_params_struct_h.swift_cd);
          strcpy((*p_STAT_VAL)[21].link_val,"NEGPOSITION"); 
          strcpy((*p_STAT_VAL)[21].link_tag,"");
          strcpy((*p_STAT_VAL)[22].link_val,"");
          strcpy((*p_STAT_VAL)[22].link_tag,"");

          strcpy((*p_SEL_VAL)[0].link_val,"INSTR_TYPE");
          strcpy((*p_SEL_VAL)[1].link_val,"INSTR_CODE");
          strcpy((*p_SEL_VAL)[2].link_val,"SAFEKEEP_POS");
          strcpy((*p_SEL_VAL)[3].link_val,"ASOFDATE");
          strcpy((*p_SEL_VAL)[3].link_tag,chr_as_of_date);
          strcpy((*p_SEL_VAL)[4].link_val,"SCCYCODE");
          strcpy((*p_SEL_VAL)[5].link_val,"CCYAPORTFOLIO");
          strcpy((*p_SEL_VAL)[6].link_val,"CLIENT");
          strcpy((*p_SEL_VAL)[7].link_val,"FMT_RPTIND");
          strcpy((*p_SEL_VAL)[8].link_val,"NOMINAL_VALUE");
          strcpy((*p_SEL_VAL)[9].link_val,"SUBACCOUNT");
             strcpy((*p_SEL_VAL)[10].link_val,"LOCATION_CD");
            strcpy((*p_SEL_VAL)[11].link_val,"CLN_DEAL_SETL_IND"); 
          strcpy((*p_SEL_VAL)[12].link_val,"");
       

         if((strcmp(p_msg_no,"571") == 0) || (strcmp(p_msg_no,"535B") == 0))
         {
          if(strcmp(chr_l_consmsg,"Y") == 0)
	    strcpy(chr_l_sel_msg_stmt,"SELECT a.cln_master as client,'DUMMY' as PROC_INIT, a.CLN_SHORTNM as ALPHACODE,");
          else
	    strcpy(chr_l_sel_msg_stmt,"SELECT a.cln_master  as client,'DUMMY' as PROC_INIT, a.CLN_SHORTNM as ALPHACODE,");
          if(strcmp(chr_l_consmsg,"Y") == 0)
	     strcat(chr_l_sel_msg_stmt,"a.cln_code as subaccount");
          else
	     strcat(chr_l_sel_msg_stmt,"e.client as subaccount");

          strcat(chr_l_sel_msg_stmt,",a.CLN_INTERNAL as SCHEDULE,b.currency_cd as SCCYCODE,e.instr_code,a.CLN_ISCC_IND,");
          if(chr_l_loc_stat[0] == 'L')
             strcat(chr_l_sel_msg_stmt,"e.location_cd,'DUMMY' as STATUS,");
          else if(chr_l_loc_stat[0] == 'S')
             strcat(chr_l_sel_msg_stmt,"e.STATUS,");
	  else
             strcat(chr_l_sel_msg_stmt,"'DUMMY' as STATUS,");
				 
		

     strcat(chr_l_sel_msg_stmt,"substr(replace(replace(b.instr_name,chr(13),NULL),chr(10),NULL),1,30) as instr_name ,b.currency_cd as instrccy,");
          
				 
          strcat(chr_l_sel_msg_stmt,"b.INSTR_ISIN,");
  		    if(strcmp(chr_l_consmsg,"Y") != 0)
     		     strcat(chr_l_sel_msg_stmt,"a.CLN_USE_ISIN_IND as FLGISIN,");
          if(chr_l_loc_stat[0] == 'L')
             strcat(chr_l_sel_msg_stmt,"d.LOCATION_DESC,");
          else if(chr_l_loc_stat[0] == 'S')
             strcat(chr_l_sel_msg_stmt,"c.map_desc as statdesc,");
          strcat(chr_l_sel_msg_stmt,"b.INSTR_TYPE,");
          strcat(chr_l_sel_msg_stmt,"b.NOMINAL_VALUE,a.CLN_FMT_RPTIND AS FMT_RPTIND, ");



			 strcat(chr_l_sel_msg_stmt,"decode(b.INSTR_TYPE,'BON',decode(a.CLN_FMT_RPTIND,'Y','FMT',b.INSTR_TYPE),b.INSTR_TYPE) as NEW_FTYPEOFINSTR ,");

          strcat(chr_l_sel_msg_stmt,"decode(sum(e.safekeep_pos),ABS(sum(e.safekeep_pos)),decode(b.INSTR_TYPE,'BON',decode(a.CLN_FMT_RPTIND,'Y','FMT',b.INSTR_TYPE),b.INSTR_TYPE),decode(b.INSTR_TYPE,'BON',decode(a.CLN_FMT_RPTIND,'Y','NFMT',CONCAT('N',b.INSTR_TYPE)),concat('N',b.INSTR_TYPE))) as NTYPEOFINSTR,");
          strcat(chr_l_sel_msg_stmt,"decode(b.INSTR_TYPE,'BON',");

          strcat(chr_l_sel_msg_stmt,"decode(a.CLN_FMT_RPTIND,'Y',to_char(ABS(sum(e.safekeep_pos)*b.NOMINAL_VALUE)),");
          strcat(chr_l_sel_msg_stmt,"to_char(ABS(sum(e.safekeep_pos)))),to_char(ABS(sum(e.safekeep_pos)))) as NSAFEK ,");
	
          strcat(chr_l_sel_msg_stmt,"ltrim(to_char(sum(e.safekeep_pos),'999,999,999,999,999,999,999')) as RUTXSAFEK,to_char(sum(e.safekeep_pos),'999,999,999,999,999,999,999.9999') as TXSAFEK,to_char(sum(e.safekeep_pos)) as SAFEKEEP_POS,a.cln_currency as CCYAPORTFOLIO, 'N' as NOHOLDGS,");
			 
          strcat(chr_l_sel_msg_stmt," a.CLN_TAXABLE_IND  as IND_83C83D ,");
			
          strcat(chr_l_sel_msg_stmt,"decode(a.CLN_REG_BCL_IND,'Y',a.CLN_REG_BCL_IND,'N')  as BHPREFIX, ");
          

			

            if (int_noelem == 11)
         {
               strcat(chr_l_sel_msg_stmt,chr_l_param[5]);
               strcat(chr_l_sel_msg_stmt," as CONTACTSEQ  ,");
         }
               strcat(chr_l_sel_msg_stmt,"'");
               strcat(chr_l_sel_msg_stmt,chr_l_week_stm);
			if(strcmp(chr_l_consmsg,"Y") == 0)
               strcat(chr_l_sel_msg_stmt,"' as WEEKLY_STM  ,x.CLN_DEAL_SETL_IND, "); 
			else
               strcat(chr_l_sel_msg_stmt,"' as WEEKLY_STM  ,a.CLN_DEAL_SETL_IND, "); 


          strcat(chr_l_sel_msg_stmt," substr(replace(replace(a.cln_name,chr(13),NULL),chr(10),NULL),1,35)  as CLNT_NAME ");
			 
			 #ifdef EMU_PROCESSING
				strcat(chr_l_sel_msg_stmt," ,'");
				strcat(chr_l_sel_msg_stmt,chr_l_emu_effd_t_6);
				strcat(chr_l_sel_msg_stmt,"' as EFFD ");

			 #endif
			 
			 
          	
/*			if(strcmp(p_msg_no,"535B") ==0)
					strcat(chr_l_sel_msg_stmt,",CONCAT(a.cln_code,CONCAT('|',e.instr_code)) as ACC_INSTR_CODE_NEW ");
*/			
/* ISKB 634 Start */
			if(strcmp(chr_l_consmsg,"Y") == 0)
          {
				printf("\n amit5\n");
				if(strcmp(p_msg_no,"571")==0)
//              strcat(chr_l_sel_msg_stmt," group by a.cln_master,e.INSTR_CODE");
				strcat(chr_l_sel_msg_stmt,",CONCAT(a.cln_code,CONCAT('|',e.instr_code)) as ACC_INSTR_CODE_NEW ");
				else
				strcat(chr_l_sel_msg_stmt,",CONCAT(a.cln_code,CONCAT('|',e.instr_code)) as ACC_INSTR_CODE_NEW ");
//              strcat(chr_l_sel_msg_stmt," group by a.cln_master,a.cln_code,e.INSTR_CODE");
					
          }
          else
          {	
			  printf("\n amit6\n");
//              strcat(chr_l_sel_msg_stmt," group by a.cln_master,e.client,e.INSTR_CODE");
				strcat(chr_l_sel_msg_stmt,",CONCAT(e.client,CONCAT('|',e.instr_code)) as ACC_INSTR_CODE_NEW ");
          }
/* ISKB 634 End */
				
          strcat(chr_l_sel_msg_stmt," FROM ");
          if(chr_l_historical[0] == 'Y')
             strcat(chr_l_sel_msg_stmt," DL_HISSAFEK e");
          else
             strcat(chr_l_sel_msg_stmt," DL_SAFEK e");
		
			if(strcmp(chr_l_consmsg,"Y") != 0)
          strcat(chr_l_sel_msg_stmt," ,MT_CLIENT a,MT_INSTRUMENT b");
			else
          strcat(chr_l_sel_msg_stmt," ,MT_CLIENT a,MT_INSTRUMENT b, MT_CLIENT x");
          
             strcat(chr_l_sel_msg_stmt," ,MT_LOCATION d");
           
				if(chr_l_loc_stat[0] == 'S')
             strcat(chr_l_sel_msg_stmt," ,PRO_SGENSTAT c");
          strcat(chr_l_sel_msg_stmt," WHERE ");
          if(strlen(l_ms_msgent_structa_a.client) != 0)
          {
            strcat(chr_l_sel_msg_stmt,"a.cln_master = '");
            strcat(chr_l_sel_msg_stmt,l_ms_msgent_structa_a.client);
            strcat(chr_l_sel_msg_stmt,"' AND");
	    
          }
          strcat(chr_l_sel_msg_stmt," e.client = a.cln_code ");
			if(strcmp(chr_l_consmsg,"Y") == 0)
          strcat(chr_l_sel_msg_stmt," and a.cln_master = x.cln_code ");
          if(strcmp(chr_l_consmsg,"Y") != 0)
          {
            strcat(chr_l_sel_msg_stmt," and a.checker is not null and a.CLN_BRK_ALL != 'B' and ");
            strcat(chr_l_sel_msg_stmt," a.STATUS != '");
            strcat(chr_l_sel_msg_stmt,STATUS_CLS_AUTH);
            strcat(chr_l_sel_msg_stmt,"' and ");
          }
          else
          {
            strcat(chr_l_sel_msg_stmt," and a.cln_master in (select cln_code from MT_CLIENT where  cln_code = a.cln_master and checker is not null and CLN_BRK_ALL != 'B' and  ");
            strcat(chr_l_sel_msg_stmt," a.STATUS != '");
            strcat(chr_l_sel_msg_stmt,STATUS_CLS_AUTH);
            strcat(chr_l_sel_msg_stmt,"') and ");
          }
          strcat(chr_l_sel_msg_stmt," e.instr_code = b.instr_code and ");
          
          if(strlen(chr_l_last_update) != 0)
          {
                 strcat(chr_l_sel_msg_stmt,"  a.CLN_POS_DT = '");
                 strcat(chr_l_sel_msg_stmt,chr_l_last_update);
                 strcat(chr_l_sel_msg_stmt,"' and ");
          }
          if(chr_l_historical[0] == 'Y')
          {
              strcat(chr_l_sel_msg_stmt," e.POSIT_DATE = '");
              strcat(chr_l_sel_msg_stmt,chr_as_of_date);
              strcat(chr_l_sel_msg_stmt,"' and ");
          }
	      
          
              
				
              strcat(chr_l_sel_msg_stmt,"  e.location_cd = d.location_cd(+)  and ");
          if(chr_l_loc_stat[0] == 'S')
          {
              strcat(chr_l_sel_msg_stmt," (e.STATUS is null or ");
              strcat(chr_l_sel_msg_stmt," (c.map_type = 'POSN_STATUS' and c.MAP_VAL");
              strcat(chr_l_sel_msg_stmt,"  = e.STATUS)) and ");
          }
          if(strcmp(chr_l_consmsg,"Y") == 0)
          {
           if(strcmp(chr_l_swftlx,"S") == 0)
           {

          	strcat(chr_l_sel_msg_stmt,"  EXISTS ( select 1 from MT_MSGADDRESS where    MT_MSGADDRESS.cln_code=a.cln_master AND MSG_IDENT_NO = '");
            strcat(chr_l_sel_msg_stmt,ltoa(l_msgaddr));
            strcat(chr_l_sel_msg_stmt,"' AND COMB_MSG = 'Y' and (swift_tlx_gcn = 'Q' or swift_tlx_gcn = 'S' or swift_tlx_gcn = 'C' or swift_tlx_gcn = 'M' )) "); 
           }
           else
           {

          	strcat(chr_l_sel_msg_stmt,"  EXISTS ( select 1 from MT_MSGADDRESS where   MT_MSGADDRESS.cln_code=a.cln_master AND MSG_IDENT_NO = '");
            strcat(chr_l_sel_msg_stmt,ltoa(l_msgaddr));
            strcat(chr_l_sel_msg_stmt,"' AND COMB_MSG = 'Y' and swift_tlx_gcn = 'T') "); 
           }
          }
          else
          {
            

          	strcat(chr_l_sel_msg_stmt,"  EXISTS ( select 1 from MT_MSGADDRESS where   MT_MSGADDRESS.cln_code=a.cln_master AND MSG_IDENT_NO = '");
            strcat(chr_l_sel_msg_stmt,ltoa(l_msgaddr));
            strcat(chr_l_sel_msg_stmt,"' AND COMB_MSG != 'Y' ) "); 
            
            strcat(chr_l_sel_msg_stmt,"  AND NOT EXISTS ( select 1 from MT_MSGADDRESS where MT_MSGADDRESS.cln_code =a.cln_code and a.cln_code!=a.cln_master AND MSG_IDENT_NO = '");
            strcat(chr_l_sel_msg_stmt,ltoa(l_msgaddr));
            strcat(chr_l_sel_msg_stmt,"' AND COMB_MSG != 'Y' ) ");
          }
          if(strcmp(chr_l_consmsg,"Y") == 0)
          {
				
				if(strcmp(p_msg_no,"571")==0)
              strcat(chr_l_sel_msg_stmt," group by a.cln_master,e.INSTR_CODE");
				else
              strcat(chr_l_sel_msg_stmt," group by a.cln_master,a.cln_code,e.INSTR_CODE");
					
          }
          else
          {
              strcat(chr_l_sel_msg_stmt," group by a.cln_master,e.client,e.INSTR_CODE");
          }
          if(chr_l_loc_stat[0] == 'L')
          {
             if(strcmp(chr_l_consmsg,"Y") == 0)
					if(strcmp(p_msg_no,"571")==0)
               	strcat(chr_l_sel_msg_stmt,",e.location_cd,d.LOCATION_DESC,a.cln_code");
					else
               	strcat(chr_l_sel_msg_stmt,",e.location_cd,d.LOCATION_DESC");
			  	 else
               strcat(chr_l_sel_msg_stmt,",e.location_cd,d.LOCATION_DESC");
          }
          else if(chr_l_loc_stat[0] == 'S')
          {
             if(strcmp(chr_l_consmsg,"Y") == 0)
					if(strcmp(p_msg_no,"571")==0)
               	strcat(chr_l_sel_msg_stmt,",e.STATUS,c.map_desc,a.cln_code");
					else
               	strcat(chr_l_sel_msg_stmt,",e.STATUS,c.MAP_DESC");
				 else
               strcat(chr_l_sel_msg_stmt,",e.STATUS,c.MAP_DESC");
          }
	  		 else
          {
          	if(strcmp(chr_l_consmsg,"Y") == 0)
          	{
					if(strcmp(p_msg_no,"571")==0)
                   strcat(chr_l_sel_msg_stmt,",a.cln_code");
				}
	  		 }
          
			 strcat(chr_l_sel_msg_stmt,",a.CLN_ISCC_IND,a.CLN_INTERNAL,b.currency_cd,b.INSTR_ISIN,b.INSTR_TYPE,");
			
			if(chr_l_loc_stat[0] == 'L')
			{
          if(strcmp(chr_l_consmsg,"Y") == 0)
        strcat(chr_l_sel_msg_stmt,"b.NOMINAL_VALUE,a.CLN_USE_ISIN_IND,a.CLN_FMT_RPTIND,b.instr_name,a.cln_currency,a.CLN_SHORTNM,a.CLN_TAXABLE_IND,a.CLN_REG_BCL_IND,a.cln_name,x.CLN_DEAL_SETL_IND,d.LOCATION_CD");
			else
        strcat(chr_l_sel_msg_stmt,"b.NOMINAL_VALUE,a.CLN_USE_ISIN_IND,a.CLN_FMT_RPTIND,b.instr_name,a.cln_currency,a.CLN_SHORTNM,a.CLN_TAXABLE_IND,a.CLN_REG_BCL_IND,a.cln_name,a.CLN_DEAL_SETL_IND,d.LOCATION_CD");
				}
				else
				{
          if(strcmp(chr_l_consmsg,"Y") == 0)
        strcat(chr_l_sel_msg_stmt,"b.NOMINAL_VALUE,a.CLN_USE_ISIN_IND,a.CLN_FMT_RPTIND,b.instr_name,a.cln_currency,a.CLN_SHORTNM,a.CLN_TAXABLE_IND,a.CLN_REG_BCL_IND,a.cln_name,x.CLN_DEAL_SETL_IND");
		else
        strcat(chr_l_sel_msg_stmt,"b.NOMINAL_VALUE,a.CLN_USE_ISIN_IND,a.CLN_FMT_RPTIND,b.instr_name,a.cln_currency,a.CLN_SHORTNM,a.CLN_TAXABLE_IND,a.CLN_REG_BCL_IND,a.cln_name,a.CLN_DEAL_SETL_IND");
				}
          if(strcmp(chr_l_consmsg,"Y") == 0)
          {
          strcat(chr_l_sel_msg_stmt," having decode(x.CLN_DEAL_SETL_IND,'Y',(sum(e.safekeep_pos) - nvl((select sum(QTY) from DL_LOCNCHG where client =a.cln_code and instr_code = e.instr_code and TO_LOCATION in (select location_cd from MT_LOCATION where AVAIL_IND ='AVAI') and  checker_dt <= '");
            strcat(chr_l_sel_msg_stmt, chr_as_of_date);
            strcat(chr_l_sel_msg_stmt,"' and (RF_SETL_DATE is null or RF_SETL_DATE > '");
            strcat(chr_l_sel_msg_stmt,chr_as_of_date);
            strcat(chr_l_sel_msg_stmt,"')),0) - nvl((select sum(QTY) from DL_LOCNCHG where client =a.cln_code and instr_code = e.instr_code and FRM_LOC in (select location_cd from MT_LOCATION where AVAIL_IND ='AVAI') and  checker_dt <= '");
            strcat(chr_l_sel_msg_stmt,chr_as_of_date);
            strcat(chr_l_sel_msg_stmt,"' and (DF_SETLDATE is null or DF_SETLDATE > '");
            strcat(chr_l_sel_msg_stmt, chr_as_of_date);
			if(chr_l_historical[0] == 'Y')
         {
            strcat(chr_l_sel_msg_stmt,"' )),0) + (select nvl(sum(z.VAL_REC+z.VAL_DEL+z.NVALRECEIVE+z.NVALDELIVER),0) from DL_HISSAFEK z, MT_LOCATION y where z.POSIT_DATE = '");
				strcat(chr_l_sel_msg_stmt,chr_as_of_date);
				strcat(chr_l_sel_msg_stmt,"'");
				strcat(chr_l_sel_msg_stmt," and z.location_cd =y.location_cd and z.client =a.cln_code and z.instr_code =e.instr_code  ");
		      if(chr_l_loc_stat[0] == 'L')
         	{
					strcat(chr_l_sel_msg_stmt," and  y.location_cd =d.LOCATION_CD");
				}
			  	strcat(chr_l_sel_msg_stmt," and y.AVAIL_IND='AVAI')),sum(e.safekeep_pos)) != 0 ");
			}		
			else
			{
            strcat(chr_l_sel_msg_stmt,"' )),0) + (select nvl(sum(z.VAL_REC+z.VAL_DEL+z.NVALRECEIVE+z.NVALDELIVER),0) from DL_SAFEK z, MT_LOCATION y where z.location_cd =y.location_cd ");
		      if(chr_l_loc_stat[0] == 'L')
         	{
					strcat(chr_l_sel_msg_stmt," and  y.location_cd =d.LOCATION_CD");
				}
				strcat(chr_l_sel_msg_stmt,"  and z.client =a.cln_code and z.instr_code =e.instr_code and y.AVAIL_IND='AVAI')),sum(e.safekeep_pos)) != 0 ");
				}
				}
				else
				{
          strcat(chr_l_sel_msg_stmt," having decode(a.CLN_DEAL_SETL_IND,'Y',(sum(e.safekeep_pos) - nvl((select sum(QTY) from DL_LOCNCHG where client =e.client and instr_code = e.instr_code and TO_LOCATION in (select location_cd from MT_LOCATION where AVAIL_IND ='AVAI') and  checker_dt <= '");
            strcat(chr_l_sel_msg_stmt, chr_as_of_date);
            strcat(chr_l_sel_msg_stmt,"' and (RF_SETL_DATE is null or RF_SETL_DATE > '");
            strcat(chr_l_sel_msg_stmt,chr_as_of_date);
            strcat(chr_l_sel_msg_stmt,"')),0) - nvl((select sum(QTY) from DL_LOCNCHG where client =e.client and instr_code = e.instr_code and FRM_LOC in (select location_cd from MT_LOCATION where AVAIL_IND ='AVAI') and  checker_dt <= '");
            strcat(chr_l_sel_msg_stmt,chr_as_of_date);
            strcat(chr_l_sel_msg_stmt,"' and (DF_SETLDATE is null or DF_SETLDATE > '");
            strcat(chr_l_sel_msg_stmt, chr_as_of_date);
			if(chr_l_historical[0] == 'Y')
         {
            strcat(chr_l_sel_msg_stmt,"' )),0) + (select nvl(sum(z.VAL_REC+z.VAL_DEL+z.NVALRECEIVE+z.NVALDELIVER),0) from DL_HISSAFEK z, MT_LOCATION y where POSIT_DATE = '");
				strcat(chr_l_sel_msg_stmt,chr_as_of_date);
				strcat(chr_l_sel_msg_stmt,"'");
				strcat(chr_l_sel_msg_stmt," and z.location_cd =y.location_cd ");
		      if(chr_l_loc_stat[0] == 'L')
         	{
					strcat(chr_l_sel_msg_stmt," and  y.location_cd =d.LOCATION_CD");
				}
				strcat(chr_l_sel_msg_stmt," and z.client =e.client and z.instr_code =e.instr_code and y.AVAIL_IND='AVAI')),sum(e.safekeep_pos)) != 0 ");
			}
			else
			{
            strcat(chr_l_sel_msg_stmt,"' )),0) + (select nvl(sum(z.VAL_REC+z.VAL_DEL+z.NVALRECEIVE+z.NVALDELIVER),0) from DL_SAFEK z, MT_LOCATION y where z.location_cd =y.location_cd ");
		      if(chr_l_loc_stat[0] == 'L')
         	{
					strcat(chr_l_sel_msg_stmt," and  y.location_cd =d.LOCATION_CD");
				}
				strcat(chr_l_sel_msg_stmt," and z.client =e.client and z.instr_code =e.instr_code and y.AVAIL_IND='AVAI')),sum(e.safekeep_pos)) != 0 ");
				}
				}
          if(strcmp(chr_l_consmsg,"Y") == 0)
          {
            if(strcmp(chr_l_swftlx,"S") == 0)
					if(strcmp(p_msg_no,"571")==0)
             		strcat(chr_l_sel_msg_stmt," order by a.cln_master,e.instr_code,a.CLN_CODE");
					else
             		strcat(chr_l_sel_msg_stmt," order by a.cln_master,a.CLN_CODE,e.INSTR_CODE");
            else
             strcat(chr_l_sel_msg_stmt," order by a.cln_master,a.CLN_CODE,e.INSTR_CODE");
          }
          else
          {
             strcat(chr_l_sel_msg_stmt," order by a.cln_master,e.client,e.INSTR_CODE");
          }
          if(chr_l_loc_stat[0] == 'L')
              strcat(chr_l_sel_msg_stmt," ,e.LOCATION_CD");
          else if(chr_l_loc_stat[0] == 'S')
              strcat(chr_l_sel_msg_stmt," ,e.STATUS");

		}
      else if (strcmp(p_msg_no,"535C") == 0)
      {
         
         strcpy(chr_l_sel_msg_stmt,"SELECT a.cln_code  as client,'DUMMY' as PROC_INIT, a.CLN_SHORTNM as ALPHACODE,");
        strcat(chr_l_sel_msg_stmt,"e.CLIENT as subaccount");
        strcat(chr_l_sel_msg_stmt,",a.CLN_INTERNAL as SCHEDULE,b.currency_cd as SCCYCODE,e.instr_code,a.CLN_ISCC_IND,");
          if(chr_l_loc_stat[0] == 'L')
             strcat(chr_l_sel_msg_stmt,"e.location_cd,'DUMMY' as STATUS,");
          else if(chr_l_loc_stat[0] == 'S')
             strcat(chr_l_sel_msg_stmt,"e.STATUS,");
          else
             strcat(chr_l_sel_msg_stmt,"'DUMMY' as STATUS,");
          strcat(chr_l_sel_msg_stmt,"substr(replace(replace(b.instr_name,chr(13),NULL),chr(10),NULL),1,30) as instr_name ,b.currency_cd as instrccy,");
          strcat(chr_l_sel_msg_stmt,"b.INSTR_ISIN,");
              strcat(chr_l_sel_msg_stmt,"a.CLN_USE_ISIN_IND as FLGISIN,");
          if(chr_l_loc_stat[0] == 'L')
             strcat(chr_l_sel_msg_stmt,"d.LOCATION_DESC,");
          else if(chr_l_loc_stat[0] == 'S')
             strcat(chr_l_sel_msg_stmt,"c.map_desc as statdesc,");
          strcat(chr_l_sel_msg_stmt,"b.INSTR_TYPE,");
          strcat(chr_l_sel_msg_stmt,"b.NOMINAL_VALUE,a.CLN_FMT_RPTIND, ");
 strcat(chr_l_sel_msg_stmt,"decode(b.INSTR_TYPE,'BON',decode(a.CLN_FMT_RPTIND,'Y','FMT',b.INSTR_TYPE),b.INSTR_TYPE) as NEW_FTYPEOFINSTR ,");
strcat(chr_l_sel_msg_stmt,"decode(sum(e.safekeep_pos),ABS(sum(e.safekeep_pos)),decode(b.INSTR_TYPE,'BON',decode(a.CLN_FMT_RPTIND,'Y','FMT',b.INSTR_TYPE),b.INSTR_TYPE),decode(b.INSTR_TYPE,'BON',decode(a.CLN_FMT_RPTIND,'Y','NFMT',CONCAT('N',b.INSTR_TYPE)),concat('N',b.INSTR_TYPE))) as NTYPEOFINSTR,");
          strcat(chr_l_sel_msg_stmt,"decode(b.INSTR_TYPE,'BON',");

          strcat(chr_l_sel_msg_stmt,"decode(a.CLN_FMT_RPTIND,'Y',to_char(ABS(sum(e.safekeep_pos)*b.NOMINAL_VALUE)),");
          strcat(chr_l_sel_msg_stmt,"to_char(ABS(sum(e.safekeep_pos)))),to_char(ABS(sum(e.safekeep_pos)))) as NSAFEK ,");
          strcat(chr_l_sel_msg_stmt,"ltrim(to_char(sum(e.safekeep_pos),'999,999,999,999,999,999,999')) as RUTXSAFEK,to_char(sum(e.safekeep_pos),'999,999,999,999,999,999,999.9999') as TXSAFEK,to_char(sum(e.safekeep_pos)) as SAFEKEEP_POS,a.cln_currency as CCYAPORTFOLIO, 'N' as NOHOLDGS,");
          strcat(chr_l_sel_msg_stmt," a.CLN_TAXABLE_IND  as IND_83C83D ,");
          strcat(chr_l_sel_msg_stmt,"decode(a.CLN_REG_BCL_IND,'Y',a.CLN_REG_BCL_IND,'N')  as BHPREFIX, ");
            if (int_noelem == 11)
            {
               strcat(chr_l_sel_msg_stmt,chr_l_param[5]);
               strcat(chr_l_sel_msg_stmt," as CONTACTSEQ  ,");
            }
               strcat(chr_l_sel_msg_stmt,"'");
               strcat(chr_l_sel_msg_stmt,chr_l_week_stm);
               strcat(chr_l_sel_msg_stmt,"' as WEEKLY_STM  ,a.CLN_DEAL_SETL_IND, ");

           strcat(chr_l_sel_msg_stmt," substr(replace(replace(a.cln_name,chr(13),NULL),chr(10),NULL),1,35) as CLNT_NAME ");

          #ifdef EMU_PROCESSING
            strcat(chr_l_sel_msg_stmt," ,'");
            strcat(chr_l_sel_msg_stmt,chr_l_emu_effd_t_6);
            strcat(chr_l_sel_msg_stmt,"' as EFFD ");
          #endif
//Amit start -- ISKB 634
		 if(strcmp(chr_l_consmsg,"Y") == 0)
          {
				printf("\n amit51\n");
				strcat(chr_l_sel_msg_stmt,",CONCAT(a.cln_code,CONCAT('|',e.instr_code)) as ACC_INSTR_CODE_NEW ");
					
          }
          else
          {	
			  printf("\n amit61\n");
				strcat(chr_l_sel_msg_stmt,",CONCAT(e.client,CONCAT('|',e.instr_code)) as ACC_INSTR_CODE_NEW ");
          }


//Amit End -- ISKB 634
          strcat(chr_l_sel_msg_stmt," FROM ");
          if(chr_l_historical[0] == 'Y')
             strcat(chr_l_sel_msg_stmt," DL_HISSAFEK e");
          else
             strcat(chr_l_sel_msg_stmt," DL_SAFEK e");
          strcat(chr_l_sel_msg_stmt," ,MT_CLIENT a,MT_INSTRUMENT b  ");
          
             strcat(chr_l_sel_msg_stmt," ,MT_LOCATION d");
          
			 if(chr_l_loc_stat[0] == 'S')
             strcat(chr_l_sel_msg_stmt," ,PRO_SGENSTAT c");
          strcat(chr_l_sel_msg_stmt," WHERE ");
          if(strlen(l_ms_msgent_structa_a.client) != 0)
          {
            strcat(chr_l_sel_msg_stmt,"a.cln_code = '");
            strcat(chr_l_sel_msg_stmt,l_ms_msgent_structa_a.client);
            strcat(chr_l_sel_msg_stmt,"' AND");

          }
          strcat(chr_l_sel_msg_stmt," e.client = a.cln_code ");
          strcat(chr_l_sel_msg_stmt," and a.checker is not null and a.CLN_BRK_ALL != 'B' and ");
          strcat(chr_l_sel_msg_stmt," a.STATUS != '");
          strcat(chr_l_sel_msg_stmt,STATUS_CLS_AUTH);
          strcat(chr_l_sel_msg_stmt,"' and ");
          strcat(chr_l_sel_msg_stmt," e.instr_code = b.instr_code and ");
          if(strlen(chr_l_last_update) != 0)
          {
                 strcat(chr_l_sel_msg_stmt,"  a.CLN_POS_DT = '");
                 strcat(chr_l_sel_msg_stmt,chr_l_last_update);
                 strcat(chr_l_sel_msg_stmt,"' and ");
          }
          if(chr_l_historical[0] == 'Y')
          {
              strcat(chr_l_sel_msg_stmt," e.POSIT_DATE = '");
              strcat(chr_l_sel_msg_stmt,chr_as_of_date);
              strcat(chr_l_sel_msg_stmt,"' and ");
          }
          
             strcat(chr_l_sel_msg_stmt,"  e.location_cd = d.location_cd(+)  and ");
          if(chr_l_loc_stat[0] == 'S')
          {
              strcat(chr_l_sel_msg_stmt," (e.STATUS is null or ");
              strcat(chr_l_sel_msg_stmt," (c.map_type = 'POSN_STATUS' and c.MAP_VAL");
              strcat(chr_l_sel_msg_stmt,"  = e.STATUS)) and ");
          }
          strcat(chr_l_sel_msg_stmt,"  EXISTS ( select 1 from MT_MSGADDRESS where MT_MSGADDRESS.cln_code=a.cln_code AND MSG_IDENT_NO = '");
          strcat(chr_l_sel_msg_stmt,ltoa(l_msgaddr));
          strcat(chr_l_sel_msg_stmt,"' AND COMB_MSG != 'Y' ) ");
          strcat(chr_l_sel_msg_stmt,"  AND NOT EXISTS ( select 1 from MT_MSGADDRESS where MT_MSGADDRESS.cln_code =a.cln_code and a.cln_code=a.cln_master AND MSG_IDENT_NO = '");
            strcat(chr_l_sel_msg_stmt,ltoa(l_msgaddr));
            strcat(chr_l_sel_msg_stmt,"' AND COMB_MSG != 'Y' ) ");
          strcat(chr_l_sel_msg_stmt," group by a.cln_code,e.client,e.INSTR_CODE");
          if(chr_l_loc_stat[0] == 'L')
          {
               strcat(chr_l_sel_msg_stmt,",e.location_cd,d.LOCATION_DESC,d.LOCATION_CD");
          }
          else if(chr_l_loc_stat[0] == 'S')
          {
               strcat(chr_l_sel_msg_stmt,",e.STATUS,c.MAP_DESC");
          }
          strcat(chr_l_sel_msg_stmt,",a.CLN_ISCC_IND,a.CLN_INTERNAL,b.currency_cd,b.INSTR_ISIN,b.INSTR_TYPE,");
			if(chr_l_loc_stat[0] == 'L')
			{
          strcat(chr_l_sel_msg_stmt,"b.NOMINAL_VALUE,a.CLN_USE_ISIN_IND,a.CLN_FMT_RPTIND,b.instr_name,a.cln_currency,a.cln_shortnm ,a.CLN_TAXABLE_IND,a.CLN_REG_BCL_IND,a.cln_name,a.CLN_DEAL_SETL_IND,d.AVAIL_IND ");
			}
			else
			{
          strcat(chr_l_sel_msg_stmt,"b.NOMINAL_VALUE,a.CLN_USE_ISIN_IND,a.CLN_FMT_RPTIND,b.instr_name,a.cln_currency,a.cln_shortnm ,a.CLN_TAXABLE_IND,a.CLN_REG_BCL_IND,a.cln_name,a.CLN_DEAL_SETL_IND ");
			}
          strcat(chr_l_sel_msg_stmt," having decode(a.CLN_DEAL_SETL_IND,'Y',(sum(e.safekeep_pos) - nvl((select sum(QTY) from DL_LOCNCHG where client =a.cln_code and instr_code = e.instr_code and TO_LOCATION  in (select location_cd from MT_LOCATION where AVAIL_IND='AVAI') and  checker_dt <= '");
            strcat(chr_l_sel_msg_stmt, chr_as_of_date);
            strcat(chr_l_sel_msg_stmt,"' and (RF_SETL_DATE is null or RF_SETL_DATE > '");
            strcat(chr_l_sel_msg_stmt,chr_as_of_date);
            strcat(chr_l_sel_msg_stmt,"')),0) - nvl((select sum(QTY) from DL_LOCNCHG where client =a.cln_code and instr_code = e.instr_code and FRM_LOC in (select location_cd from MT_LOCATION where AVAIL_IND ='AVAI') and  checker_dt <= '");
            strcat(chr_l_sel_msg_stmt,chr_as_of_date);
            strcat(chr_l_sel_msg_stmt,"' and (DF_SETLDATE is null or DF_SETLDATE > '");
            strcat(chr_l_sel_msg_stmt, chr_as_of_date);
          if(chr_l_historical[0] == 'Y')
			 {
            strcat(chr_l_sel_msg_stmt,"' )),0) + (select nvl(sum(z.VAL_REC+z.VAL_DEL+z.NVALRECEIVE+z.NVALDELIVER),0) from DL_HISSAFEK z, MT_LOCATION y where POSIT_DATE = '");
				strcat(chr_l_sel_msg_stmt,chr_as_of_date);
				strcat(chr_l_sel_msg_stmt,"'");
				strcat(chr_l_sel_msg_stmt," and z.location_cd =y.location_cd ");
		      if(chr_l_loc_stat[0] == 'L')
         	{
					strcat(chr_l_sel_msg_stmt," and  y.location_cd =d.LOCATION_CD");
				}
				strcat(chr_l_sel_msg_stmt, " and z.client =a.cln_code and z.instr_code =e.instr_code and y.AVAIL_IND='AVAI')),sum(e.safekeep_pos)) != 0 ");
			  }
			 else
			 {
            strcat(chr_l_sel_msg_stmt,"' )),0) + (select nvl(sum(z.VAL_REC+z.VAL_DEL+z.NVALRECEIVE+z.NVALDELIVER),0) from DL_SAFEK z, MT_LOCATION y where z.location_cd =y.location_cd ");
		      if(chr_l_loc_stat[0] == 'L')
         	{
					strcat(chr_l_sel_msg_stmt," and  y.location_cd =d.LOCATION_CD");
				}
				strcat(chr_l_sel_msg_stmt, " and z.client =a.cln_code and z.instr_code =e.instr_code and y.AVAIL_IND='AVAI')),sum(e.safekeep_pos)) != 0 ");
				}

          strcat(chr_l_sel_msg_stmt," order by a.cln_code,e.client,e.INSTR_CODE");
          if(chr_l_loc_stat[0] == 'L')
              strcat(chr_l_sel_msg_stmt," ,e.LOCATION_CD");
          else if(chr_l_loc_stat[0] == 'S')
              strcat(chr_l_sel_msg_stmt," ,e.STATUS");

         
      }

   }


        if(strcmp(p_msg_no,"573") == 0)
        {
          l_msgaddr = MSTMTPENDINGMSGNO;       

          memset(chr_temp,APL_NULL_CHAR,201);
          if(strlen(l_ms_msgent_structa_a.proc_data) != 0)
          {
            CO_SplitStr((*p_imsgent_struct).proc_data,';', &int_noelem, &chr_l_param);
				printf("param |%s|int_noelem|%d|\n",(*p_imsgent_struct).proc_data,int_noelem);
             strcpy(chr_p_choice,chr_l_param[0]);
             strcpy(chr_p_nopendgs,chr_l_param[1]);
            if (int_noelem == 7)
             strcpy(chr_l_week_stm,chr_l_param[5]);
				if(int_noelem >= 5) 
             strcpy(chr_l_last_gen_date,chr_l_param[4]); 

            if (int_noelem == 7)
             strcpy(chr_selpendgs,chr_l_param[6]);
            else if (int_noelem == 5)
             strcpy(chr_selpendgs,chr_l_param[4]);
            else
             strcpy(chr_selpendgs,chr_l_param[2]);
         
          }

          if(strlen(chr_p_choice)==0)
          {
		APL_DATA_MISSING("CHOICE", APL_NULL_STRING, APL_NULL_STRING)
                APL_GOBACK_FAIL
          }
          if(strlen(chr_p_nopendgs)==0)
          {
		APL_DATA_MISSING("NO PENDINGS", APL_NULL_STRING, APL_NULL_STRING)
                APL_GOBACK_FAIL
          }

           
          *p_STAT_VAL = realloc(*p_STAT_VAL,sizeof(MS_STATIC_VAL)*14); 
          
			 
	
			 
		
			 
			 *p_SEL_VAL = realloc(*p_SEL_VAL,sizeof(MS_STATIC_VAL)*22); 
			
          strcpy((*p_STAT_VAL)[0].link_val,"DUMMY");
          strcpy((*p_STAT_VAL)[0].link_tag,"DUMMY");
          strcpy((*p_STAT_VAL)[1].link_val,"DOMSEC");
          strcpy((*p_STAT_VAL)[1].link_tag,chr_h_dom_instr);
          strcpy((*p_STAT_VAL)[2].link_val,"DATE");
          strcpy((*p_STAT_VAL)[2].link_tag,h_sys_dt);
          strcpy((*p_STAT_VAL)[3].link_val,"DUMMY");
          strcpy((*p_STAT_VAL)[3].link_tag,"DUMMY");
          strcpy((*p_STAT_VAL)[4].link_val,"CA_NAME");
          strcpy((*p_STAT_VAL)[4].link_tag,chr_h_corporate_name);
          strcpy((*p_STAT_VAL)[5].link_val,"DOMCCY");
          strcpy((*p_STAT_VAL)[5].link_tag,chr_h_dom_ccycode);
          strcpy((*p_STAT_VAL)[6].link_val,"PCHOICE");
          strcpy((*p_STAT_VAL)[6].link_tag,chr_p_choice);
          strcpy((*p_STAT_VAL)[7].link_val,"SUBACCT");
          strcpy((*p_STAT_VAL)[7].link_tag,chr_h_sub_acct_processing);
          strcpy((*p_STAT_VAL)[8].link_val,"TITLE");
	  if(strcmp(chr_p_choice,"P") == 0)
	  {
          	strcpy((*p_STAT_VAL)[8].link_tag,"STATUS_IND REPORT OF TRANSACTIONS NOT YET PRE-MATCHED AS OF ");
          	strcat((*p_STAT_VAL)[8].link_tag,chr_h_msys_date);
	  }
	  else if(strcmp(chr_p_choice,"F") == 0)
	  {
          	strcpy((*p_STAT_VAL)[8].link_tag,"STATUS_IND REPORT OF TRANSACTIONS NOT YET PRE-MATCHED AS OF ");
          	strcat((*p_STAT_VAL)[8].link_tag,chr_h_msys_date);
	  }
	  else if(strcmp(chr_p_choice,"C") == 0)
	  {
          	strcpy((*p_STAT_VAL)[8].link_tag,"UPDATE LIST OF PRE-MATCHED TRANSACTIONS ");
	  }
	  else if(strcmp(chr_p_choice,"S") == 0)
	  {
          	strcpy((*p_STAT_VAL)[8].link_tag,"UPDATE LIST OF TRANSACTIONS PENDING INSTRUMENT");
	  }
	  else if(strcmp(chr_p_choice,"M") == 0)
	  {
          	strcpy((*p_STAT_VAL)[8].link_tag,"UPDATE LIST OF TRANSACTIONS PENDING FUNDS");
	  }
	  else if(strcmp(chr_p_choice,"A") == 0)
	  {
          	strcpy((*p_STAT_VAL)[8].link_tag,"UPDATE LIST OF PENDING TRANSACTIONS");
	  }
		
          strcpy((*p_STAT_VAL)[9].link_val,"TDATE");
          strcpy((*p_STAT_VAL)[9].link_tag,chr_h_msys_date);
			 
			 strcpy((*p_STAT_VAL)[10].link_val,"NATION");
			 strcpy((*p_STAT_VAL)[10].link_tag,g_mt_commonsys_params_struct_h.nation_code);
		
		
          
			 strcpy((*p_STAT_VAL)[11].link_val,"NEW_MNTH");
       	 if (int_noelem == 7)
          		strcpy((*p_STAT_VAL)[11].link_tag,chr_l_param[3]);
       	 else
          strcpy((*p_STAT_VAL)[11].link_tag,"N");
			 strcpy((*p_STAT_VAL)[12].link_val,"CNTRY_BIC"); 
			 strcpy((*p_STAT_VAL)[12].link_tag,l_mt_message_sys_params_struct_h.swift_cd);
			 strcpy((*p_STAT_VAL)[13].link_val,"");
          strcpy((*p_STAT_VAL)[13].link_tag,"");
			 

	   if(strcmp(chr_selpendgs,"Y") == 0 && 
		  strcmp(chr_p_nopendgs,"Y") == 0)
		{
          strcpy((*p_SEL_VAL)[0].link_val,"DUMMY");
          strcpy((*p_SEL_VAL)[1].link_val,"DUMMY");
          strcpy((*p_SEL_VAL)[2].link_val,"cln_master");
          strcpy((*p_SEL_VAL)[3].link_val,"DUMMY");
          strcpy((*p_SEL_VAL)[4].link_val,"DUMMY");
          strcpy((*p_SEL_VAL)[5].link_val,"DUMMY");
          strcpy((*p_SEL_VAL)[6].link_val,"DUMMY");
          strcpy((*p_SEL_VAL)[7].link_val,"DUMMY");
          strcpy((*p_SEL_VAL)[8].link_val,"DUMMY");
          strcpy((*p_SEL_VAL)[9].link_val,"DUMMY");
          strcpy((*p_SEL_VAL)[10].link_val,"DUMMY");
          strcpy((*p_SEL_VAL)[11].link_val,"DUMMY");
          strcpy((*p_SEL_VAL)[12].link_val,"DUMMY");
          strcpy((*p_SEL_VAL)[13].link_val,"CLIENT");
			 strcpy((*p_SEL_VAL)[14].link_val,"UNIQ_IDENT_NO");
			 strcpy((*p_SEL_VAL)[15].link_val,"");
		}
	   else 
	   {
          strcpy((*p_SEL_VAL)[0].link_val,"FAILREASON_CD");
          strcpy((*p_SEL_VAL)[1].link_val,"SCUSTNOTE");
          strcpy((*p_SEL_VAL)[2].link_val,"cln_master");
          strcpy((*p_SEL_VAL)[3].link_val,"SINSTR_DT");
          strcpy((*p_SEL_VAL)[4].link_val,"DL_CLASS");
          strcpy((*p_SEL_VAL)[5].link_val,"SCONFDT");
          strcpy((*p_SEL_VAL)[6].link_val,"SPC49");
          strcpy((*p_SEL_VAL)[7].link_val,"TINSTR_DT");
          strcpy((*p_SEL_VAL)[8].link_val,"TMONEYDT");
          strcpy((*p_SEL_VAL)[9].link_val,"DEAL_CD");
          strcpy((*p_SEL_VAL)[10].link_val,"SMONEYDT");
          strcpy((*p_SEL_VAL)[11].link_val,"TR3TOT");
          strcpy((*p_SEL_VAL)[12].link_val,"TR4TOT");
			 strcpy((*p_SEL_VAL)[13].link_val,"CLIENT");
          strcpy((*p_SEL_VAL)[14].link_val,"INSTR_CODE");
          strcpy((*p_SEL_VAL)[15].link_val,"IDENTIY_NO");
          strcpy((*p_SEL_VAL)[16].link_val,"SUB_FAIL_CD");
		
          strcpy((*p_SEL_VAL)[17].link_val,"NEW_DOMCPAC");
          strcpy((*p_SEL_VAL)[18].link_val,"ENTRY");
          strcpy((*p_SEL_VAL)[19].link_val,"MULT_548");
          strcpy((*p_SEL_VAL)[20].link_val,"UNIQ_IDENT_NO");    
          strcpy((*p_SEL_VAL)[21].link_val,"");
          strcpy((*p_SEL_VAL)[21].link_tag,"");

			 
			 
		}


	  if(strcmp(chr_selpendgs,"N") == 0)
	  {
		
		
			 strcpy(chr_l_sel_msg_stmt,"SELECT a.cln_code");
          strcat(chr_l_sel_msg_stmt,",concat('/',a.cln_code) as NACCOUNT,b.INSTR_ISIN,c.IDENTIY_NO as PROC_INIT,substr(c.clientof,1,30) as OFACCOUNT,to_char(decode(c.deal_cd,3,c.AMOUNT,0)) as TR3TOT,to_char(decode(c.deal_cd,4,c.AMOUNT,0)) as TR4TOT,"); 
          strcat(chr_l_sel_msg_stmt,"c.IDENTIY_NO,'SE'||c.UNIQ_IDENT_NO as UNIQ_IDENT_NO,decode(c.failreason_cd,NULL,'0',substr(lpad(c.failreason_cd,2,'0'),1,2)) as FAILREASON_CD,a.CLN_USE_ISIN_IND as FLGISIN,a.CLN_SINGLE548_SUPPORT_IND as MULT_548,nvl(a.CLN_STAT_DL_IND,'N') as STAT_DL_IND,substr(to_char(c.deal_date,'YYMMDD'),1,6) as YYTRDT, substr(to_char(c.deal_date,'YYYYMMDD'),1,8) as DEAL_DATE, 'N' as NOPENDGS,");
			 
          strcat(chr_l_sel_msg_stmt,"c.VAL_FDT as SCONFDT,a.cln_master,a.cln_code as client ,substr(replace(replace(a.cln_name,chr(13),NULL),chr(10),NULL),1,35) as CLN_NAME,a.CLN_ISCC_IND as ISCC,decode(c.QTY,c.ORIG_QTY,'Y','N') as SAMEQTY,");
			 
          strcat(chr_l_sel_msg_stmt," decode(c.deal_cd,1,'522',decode(c.deal_cd,2,'520',");
			 
          strcat(chr_l_sel_msg_stmt,"decode(c.deal_cd,3,'523',decode(c.deal_cd,5,'522',decode(c.deal_cd,6,'520',decode(c.deal_cd,7,'523','521')))))) as NTRCODE,c.QTY,c.ORIG_QTY,c.PARTIAL_IND_B,c.deal_cd,a.CLN_SHORTNM as ALPHACODE,c.ORIG_REFNO,c.lcl_identno,"); 
          strcat(chr_l_sel_msg_stmt," decode(c.deal_cd,1,'DF ',decode(c.deal_cd,2,'RF ',");
          strcat(chr_l_sel_msg_stmt,"decode(c.deal_cd,3,'DVP ',decode(c.deal_cd,5,'DF ',decode(c.deal_cd,6,'RF ',decode(c.deal_cd,7,'DVP ','RVP ')))))) as TTRCODE,");
	  strcat(chr_l_sel_msg_stmt," decode(b.INSTR_TYPE,'BON',decode(a.CLN_FMT_RPTIND,'Y','FMT'");
	  strcat(chr_l_sel_msg_stmt,",b.INSTR_TYPE),b.INSTR_TYPE) as FTYPEOFINSTR,decode(b.INSTR_TYPE,'BON',decode(a.CLN_FMT_RPTIND,'Y',to_char(c.QTY*b.NOMINAL_VALUE),c.QTY),c.QTY) as FENT_POS,B.NOMINAL_VALUE AS NOMINAL_VALUE,"); /*TUX */
          strcat(chr_l_sel_msg_stmt,"substr(to_char(c.setl_date,'YYMMDD'),1,6) as SETL_DATE,");
			 
		
		

			 strcat(chr_l_sel_msg_stmt,"substr(to_char(c.setl_date,'YYYYMMDD'),1,8) as NEW_SETTLEDT,");
			 strcat(chr_l_sel_msg_stmt,"'");
			 strcat(chr_l_sel_msg_stmt,chr_l_week_stm);
			 strcat(chr_l_sel_msg_stmt,"' as WEEKLY_STM, "); 
          strcat(chr_l_sel_msg_stmt,"concat(b.currency_cd,' ') as CURRENCY_CD,c.AMOUNT,c.net_amt,b.currency_cd as CCYNET_AMT, b.currency_cd as CCYAMOUNT,b.currency_cd as REF_CCY,b.currency_cd as CCYTOTNET,b.currency_cd as CCYTRCOD3TOT,b.currency_cd as CCYTRCOD4TOT,");
			 

			 
			 strcat(chr_l_sel_msg_stmt,"c.domestic_cpclt as NEW_DOMCPAC,decode(rtrim(ltrim(c.cp_clt)),NULL,NULL,rtrim(ltrim(c.cp_clt))) as NEW_COUNTACC,");
          strcat(chr_l_sel_msg_stmt,"decode(ltrim(c.CP_CLTNAME),NULL,upper(substr(replace(replace(d.pty_name,chr(13),NULL),chr(10),NULL),1,35)),upper(decode(substr(replace(replace(c.CP_CLTNAME,chr(13),NULL),chr(10),NULL),1,1),'/',substr(replace(replace(c.CP_CLTNAME,chr(13),NULL),chr(10),NULL),2,34),substr(replace(replace(c.CP_CLTNAME,chr(13),NULL),chr(10),NULL),1,35)))) as CP_CLTNAME,");
			 
			 strcat(chr_l_sel_msg_stmt,"decode(c.dl_class,'27','26','29','26',c.dl_class) as DL_CLASS,substr(replace(replace(b.instr_name,chr(13),NULL),chr(10),NULL),1,31)as SINSTR_NAME,b.currency_cd as SSECCCY,");
			 
          strcat(chr_l_sel_msg_stmt,"substr(replace(replace(b.instr_name,chr(13),NULL),chr(10),NULL),1,51) as INSTR_NAME,c.failreason_cd,replace(replace(c.client_note,chr(13),NULL),chr(10),NULL) as SCUSTNOTE,substr(to_char(c.setl_date,'MM/DD/YYYY'),1,10) as TSETTLEDT,substr(to_char(c.INSTRUMENT_DT,'MM/DD/YYYY'),1,10) as TINSTR_DT,substr(to_char(c.MONEY_SETL_DT,'MM/DD/YYYY'),1,10) as TMONEYDT,");
          strcat(chr_l_sel_msg_stmt,"b.instr_code,c.INSTRUMENT_DT as SINSTR_DT,c.MONEY_SETL_DT as SMONEYDT ");
          strcat(chr_l_sel_msg_stmt,",decode(c.dl_class,19,'B','A') as TRDORD,");
			 
			 strcat(chr_l_sel_msg_stmt," a.CLN_TAXABLE_IND  as IND_83C83D ");
			 

           strcat(chr_l_sel_msg_stmt," ,substr(to_char(to_date('");
            strcat(chr_l_sel_msg_stmt,h_sys_dt);
      
            strcat(chr_l_sel_msg_stmt,"','RRMMDD'),'YYYYMMDD'),1,8) as NEW_DT ");
           strcat(chr_l_sel_msg_stmt,",decode(c.domestic_cpclt,'");
           strcat(chr_l_sel_msg_stmt,chr_h_citibank_acct_code);
           strcat(chr_l_sel_msg_stmt,"','Y','N') as IS_CT_DOMCPAC ,c.sub_fail_cd ");


           strcat(chr_l_sel_msg_stmt,",decode(c.DATEOF_MARKFAIL,NULL,'Y',decode(greatest(c.setl_date,to_date((trunc(c.DATEOF_MARKFAIL)+0.5),'DD/MM/YYYY hh:mi:ss')),c.setl_date,'Y','N')) as PENDIND_NEW ");
            strcat(chr_l_sel_msg_stmt,",CONCAT(c.client,CONCAT('|',c.IDENTIY_NO)) as ACC_REFNO ");


	
            strcat(chr_l_sel_msg_stmt,",decode(c.failreason_cd,NULL,decode(c.VAL_FDT,NULL,'N','Y'),'90','Y','98','N','Z') as IS_FAIL_90_98 ");
			
			strcat(chr_l_sel_msg_stmt," ,decode(ltrim(rtrim(substr(c.clientof,1,35))),NULL,NULL,ltrim(rtrim(substr(c.clientof,1,35)))) as NEW_ACCOUNTOF1  ");
			strcat(chr_l_sel_msg_stmt," ,decode(ltrim(rtrim(substr(c.clientof,36,30))),NULL,NULL,ltrim(rtrim(substr(c.clientof,36,30)))) as NEW_ACCOUNTOF2  ");
			strcat(chr_l_sel_msg_stmt," ,decode(ltrim(rtrim(substr(c.INSTRUCT_PERSONNM,1,35))),NULL,NULL,ltrim(rtrim(substr(c.INSTRUCT_PERSONNM,1,35)))) as INSTPARTYNM1  ");
			strcat(chr_l_sel_msg_stmt," ,decode(ltrim(rtrim(substr(c.INSTRUCT_PERSONNM,36,30))),NULL,NULL,ltrim(rtrim(substr(c.INSTRUCT_PERSONNM,36,30)))) as INSTPARTYNM2  "); 

      
          if (int_noelem == 7)
         {
               strcat(chr_l_sel_msg_stmt,",");
               strcat(chr_l_sel_msg_stmt,chr_l_param[2]);
               strcat(chr_l_sel_msg_stmt," as CONTACTSEQ  ");
         }
          strcat(chr_l_sel_msg_stmt," , c.ENTRY "); 
			 
			 strcat(chr_l_sel_msg_stmt," ,decode(ltrim(rtrim(substr(c.CP_CLTNAME,1,35))),NULL,NULL,ltrim(rtrim(substr(c.CP_CLTNAME,1,35)))) as NEW_COUNTACCNAME ");
			 strcat(chr_l_sel_msg_stmt," ,decode(ltrim(rtrim(substr(c.CP_CLTNAME,36,30))),NULL,NULL,ltrim(rtrim(substr(c.CP_CLTNAME,36,30)))) as NEW_COUNTACCNAME1 ");

          strcat(chr_l_sel_msg_stmt," from MT_CLIENT a,MT_INSTRUMENT b,dl_deal c,MT_PARTY d");
			 strcat(chr_l_sel_msg_stmt," where c.client = a.cln_code and c.instr_code = b.instr_code ");
			 strcat(chr_l_sel_msg_stmt," and c.domestic_cpclt = d.pty_code ");
          if(strlen(l_ms_msgent_structa_a.client) != 0)
          {
             strcat(chr_l_sel_msg_stmt," AND c.client = '");
             strcat(chr_l_sel_msg_stmt,l_ms_msgent_structa_a.client);
             strcat(chr_l_sel_msg_stmt,"' ");
          }
          strcat(chr_l_sel_msg_stmt," and a.CLN_BRK_ALL != 'B' and a.checker is not null and ");
          strcat(chr_l_sel_msg_stmt," a.STATUS != '");
          strcat(chr_l_sel_msg_stmt,STATUS_CLS_AUTH);

          strcat(chr_l_sel_msg_stmt,"' ");

          strcpy(chr_mainfuncarea_h,"MSG_PEND");
          strcpy(chr_condid_h,"MSG_ISCC");
          Cond_exists_h = 0;

          if(CO_Chk_CntryEnabled(chr_mainfuncarea_h, chr_condid_h, &Cond_exists_h, l_debug_info_ptr)==APL_FAILURE)
                        APL_GOBACK_FAIL

			
          printf("TRACE STATEMENT : The chr_value of int_cond_exists is (%d)\n",Cond_exists_h);
          if(chr_p_choice[0] == 'P')
             strcat(chr_l_sel_msg_stmt," AND c.VAL_FDT is null AND c.checker is not null AND (to_number(c.failreason_cd) < 98 OR c.failreason_cd is null) AND a.CLN_ISCC_IND = 'Y'");
			 /* Chnges By YOG -- On Line no. 3215 Condition a.CLN_ISCC_IND != 'Y' changed to a.CLN_ISCC_IND = 'Y' on 03/11/2006  and same chnges are done on Line no. 3218, 3220, 3222, 3224 */ 
          else if(chr_p_choice[0] == 'F')
             strcat(chr_l_sel_msg_stmt," AND c.VAL_FDT is null AND c.checker is not null AND to_number(c.failreason_cd) > 0 AND to_number(c.failreason_cd) < 98 AND a.CLN_ISCC_IND = 'Y'");
          else if(chr_p_choice[0] == 'C')
             strcat(chr_l_sel_msg_stmt," AND c.VAL_FDT is not null AND c.checker is not null AND (c.INSTRUMENT_DT is null OR (c.MONEY_SETL_DT is null AND c.deal_cd > 2)) AND a.CLN_ISCC_IND = 'Y'");
          else if(chr_p_choice[0] == 'M')
             strcat(chr_l_sel_msg_stmt," AND c.VAL_FDT is not null AND c.MONEY_SETL_DT is null AND c.INSTRUMENT_DT is not null AND c.deal_cd > 2 AND a.CLN_ISCC_IND = 'Y'");
          else if(chr_p_choice[0] == 'S')
             strcat(chr_l_sel_msg_stmt," AND c.VAL_FDT is not null AND c.MONEY_SETL_DT is not null AND c.INSTRUMENT_DT is null AND a.CLN_ISCC_IND = 'Y'");
          else if(chr_p_choice[0] == 'A')
          {
             if(Cond_exists_h > 0)
             	strcat(chr_l_sel_msg_stmt," AND c.checker is not null AND (c.INSTRUMENT_DT is null OR (c.MONEY_SETL_DT is null AND c.deal_cd > 2))");
             else
             	strcat(chr_l_sel_msg_stmt," AND c.checker is not null AND (c.INSTRUMENT_DT is null OR (c.MONEY_SETL_DT is null AND c.deal_cd > 2)) AND a.CLN_ISCC_IND = 'Y'");
          }

          

      
strcat(chr_l_sel_msg_stmt," and c.failreason_cd||'*'||c.sub_fail_cd not in (select failreason_cd||'*'||sub_fail_cd from PRO_FAILCODES where status_qual_ind in ('CPRC')) ");

          strcat(chr_l_sel_msg_stmt," order by c.client,TRDORD asc,to_number(c.failreason_cd),c.sub_fail_cd,c.instr_code,c.deal_cd,c.SETL_DATE");
	  } 
	  else if(strcmp(chr_selpendgs,"Y") == 0 && strcmp(chr_p_nopendgs,"Y") == 0)
	  {
          strcpy(chr_l_sel_msg_stmt,"SELECT distinct(b.cln_code),'Y' as NOPENDGS,'DUMMY' as PROC_INIT, concat('/',b.cln_code) as NACCOUNT,nvl(b.CLN_STAT_DL_IND,'N') as STAT_DL_IND,b.CLN_SHORTNM as ALPHACODE,b.cln_master,substr(replace(replace(b.cln_name,chr(13),NULL),chr(10),NULL),1,35) as CLNT_NAME , ");
			 
			 strcat(chr_l_sel_msg_stmt," b.CLN_TAXABLE_IND  as IND_83C83D ");
			 strcat(chr_l_sel_msg_stmt,", '");
			 strcat(chr_l_sel_msg_stmt,chr_l_week_stm);
			 strcat(chr_l_sel_msg_stmt,"' as WEEKLY_STM,'SE'||'"); 
			 strcat(chr_l_sel_msg_stmt,chr_new_unique_ref_num);    
			 
   
         strcat(chr_l_sel_msg_stmt,"' as UNIQ_IDENT_NO ,substr(to_char(to_date('");
         strcat(chr_l_sel_msg_stmt,h_sys_dt);

     
         strcat(chr_l_sel_msg_stmt,"','RRMMDD'),'YYYYMMDD'),1,8) as NEW_DT ");
      
          if (int_noelem == 7)
         {
               strcat(chr_l_sel_msg_stmt,",");
               strcat(chr_l_sel_msg_stmt,chr_l_param[2]);
               strcat(chr_l_sel_msg_stmt," as CONTACTSEQ ");
         }
          strcat(chr_l_sel_msg_stmt," from MT_CLIENT b ");
          strcat(chr_l_sel_msg_stmt," where ");
          strcat(chr_l_sel_msg_stmt," b.CLN_BRK_ALL != 'B' and b.checker is not null and ");
          strcat(chr_l_sel_msg_stmt," b.STATUS != '");
          strcat(chr_l_sel_msg_stmt,STATUS_CLS_AUTH);
          strcat(chr_l_sel_msg_stmt,"'");
          if(strlen(l_ms_msgent_structa_a.client) != 0)
          {
             strcat(chr_l_sel_msg_stmt," AND b.cln_code = '");
             strcat(chr_l_sel_msg_stmt,l_ms_msgent_structa_a.client);
             strcat(chr_l_sel_msg_stmt,"' ");
          }


	  strcat(chr_l_sel_msg_stmt," and b.cln_code NOT IN (select c.client from dl_deal c, MT_CLIENT a where c.client = a.cln_code  ");

          strcpy(chr_mainfuncarea_h,"MSG_PEND");
          strcpy(chr_condid_h,"MSG_ISCC");
          Cond_exists_h = 0;

          if(CO_Chk_CntryEnabled(chr_mainfuncarea_h, chr_condid_h, &Cond_exists_h, l_debug_info_ptr)==APL_FAILURE)
                        APL_GOBACK_FAIL

          if(chr_p_choice[0] == 'P')
             strcat(chr_l_sel_msg_stmt,"  and c.VAL_FDT is null AND c.checker is not null AND (to_number(c.failreason_cd) < 98 OR c.failreason_cd is null) AND a.CLN_ISCC_IND = 'Y'"); 
			 /* -- CHANGES BY YOG -- On line no. 3287 Condition a.CLN_ISCC_IND != 'Y' changed to a.CLN_ISCC_IND = 'Y' on 03/11/2006  and same chnges are done on Line no. 3288, 3290, 3292, 3294 */
          else if(chr_p_choice[0] == 'F')
             strcat(chr_l_sel_msg_stmt,"  and c.VAL_FDT is null AND c.checker is not null AND to_number(c.failreason_cd) > 0 AND to_number(c.failreason_cd) < 98 AND a.CLN_ISCC_IND = 'Y'");
          else if(chr_p_choice[0] == 'C')
             strcat(chr_l_sel_msg_stmt," and  c.VAL_FDT is not null AND c.checker is not null AND (c.INSTRUMENT_DT is null OR (c.MONEY_SETL_DT is null AND c.deal_cd > 2)) AND a.CLN_ISCC_IND = 'Y'");
          else if(chr_p_choice[0] == 'M')
             strcat(chr_l_sel_msg_stmt," and  c.VAL_FDT is not null AND c.MONEY_SETL_DT is null AND c.INSTRUMENT_DT is not null AND c.deal_cd > 2 AND a.CLN_ISCC_IND = 'Y'");
          else if(chr_p_choice[0] == 'S')
             strcat(chr_l_sel_msg_stmt," and  c.VAL_FDT is not null AND c.MONEY_SETL_DT is not null AND c.INSTRUMENT_DT is null AND a.CLN_ISCC_IND = 'Y'");
          else if(chr_p_choice[0] == 'A')
          {
             if(Cond_exists_h > 0)
             	strcat(chr_l_sel_msg_stmt," and c.checker is not null AND (c.INSTRUMENT_DT is null OR (c.MONEY_SETL_DT is null AND c.deal_cd > 2))");
             else
             	strcat(chr_l_sel_msg_stmt," and c.checker is not null AND (c.INSTRUMENT_DT is null OR (c.MONEY_SETL_DT is null AND c.deal_cd > 2)) AND a.CLN_ISCC_IND = 'Y'");
          }
         
          strcat(chr_l_sel_msg_stmt," and c.failreason_cd||'*'||c.sub_fail_cd not in (select failreason_cd||'*'||sub_fail_cd from PRO_FAILCODES where status_qual_ind in ('CPRC')) ");     
          strcat(chr_l_sel_msg_stmt,")  order by b.cln_code ");
	  } 
            

        }
		  
        if((strcmp(p_msg_no,MS_MSGNO_52X) == 0) || (strcmp(p_msg_no, MS_SWIFT_BOG_NO)==0))
        {
          l_msgaddr = MVTBMESSAGENO;       
			 i_vtb_cltt_name=0;
			 i_vtb_cltt_code=0;
			 i_vtbrefer=0;
			 i_citibank_cltt_code=0;
          EXEC SQL SELECT substr(vtb_clt_name,1,35),vtb_clt_code,
                          substr(vtb_identity,1,25),custody_clt_cd
                   INTO :chr_h_vtb_acct_name:i_vtb_cltt_name,
								:chr_h_vtb_acct_code:i_vtb_cltt_code,
								:chr_h_vtbrefer:i_vtbrefer,
                        :chr_h_citibank_acct_code:i_citibank_cltt_code
                   FROM MT_CORE_SYS_PARAMS;

 	  IS_ANY_ORA_ERROR         

          if(sqlca.sqlcode == 1403 || i_vtbrefer == -1)
		strcpy(chr_h_vtbrefer," ");

			

			if (APL_FAILURE == CO_Chk_CntryEnabled(	"MSG_52X",
																"GEN_52X_FOR_BOG",
																&chr_l_cond,
																l_debug_info_ptr ))
			{
				APL_GOBACK_FAIL
			}
          

          *p_STAT_VAL = realloc(*p_STAT_VAL,sizeof(MS_STATIC_VAL)*9);
			 APL_MALLOC_FAIL(*p_STAT_VAL)
          *p_SEL_VAL = realloc(*p_SEL_VAL,sizeof(MS_STATIC_VAL)*7); 
			 
			 APL_MALLOC_FAIL(*p_SEL_VAL)

          strcpy((*p_STAT_VAL)[1].link_val,"DOMSEC");
          strcpy((*p_STAT_VAL)[1].link_tag,chr_h_dom_instr);
          strcpy((*p_STAT_VAL)[2].link_val,"VTBACCTCODE");
          strcpy((*p_STAT_VAL)[2].link_tag,chr_h_vtb_acct_code);
          strcpy((*p_STAT_VAL)[3].link_val,"VTBREFER");
          strcpy((*p_STAT_VAL)[3].link_tag,chr_h_vtbrefer);
          strcpy((*p_STAT_VAL)[4].link_val,"VTBNAME");
          strcpy((*p_STAT_VAL)[4].link_tag,chr_h_vtb_acct_name);
          strcpy((*p_STAT_VAL)[5].link_val,"CITIBANK");
          strcpy((*p_STAT_VAL)[5].link_tag,chr_h_citibank_acct_code);
          strcpy((*p_STAT_VAL)[6].link_val,"NATION");
          strcpy((*p_STAT_VAL)[6].link_tag,g_mt_commonsys_params_struct_h.nation_code);
          strcpy((*p_STAT_VAL)[7].link_val,"DATE");
          strcpy((*p_STAT_VAL)[7].link_tag,h_sys_dt);
          strcpy((*p_STAT_VAL)[8].link_val,"");
          strcpy((*p_STAT_VAL)[8].link_tag,"");

          strcpy((*p_SEL_VAL)[0].link_val,"CP_CLT");
          strcpy((*p_SEL_VAL)[1].link_val,"DOMESTIC_CPCLT");
			 
          strcpy((*p_SEL_VAL)[2].link_val,"CLIENT");
          strcpy((*p_SEL_VAL)[3].link_val,"IDENTIY_NO");
          strcpy((*p_SEL_VAL)[4].link_val,"DEAL_CD");
          strcpy((*p_SEL_VAL)[5].link_val,"UNIQREFNO");
          strcpy((*p_SEL_VAL)[6].link_val,"");

			

          strcpy(chr_l_sel_msg_stmt,"SELECT c.client,c.deal_cd,to_char(c.setl_date,'YYMMDD') as setl_date,to_char(c.deal_date,'YYMMDD') as deal_date,c.IDENTIY_NO,c.UNIQ_IDENT_NO as UNIQREFNO,c.IDENTIY_NO as PROC_INIT,c.instr_code,"); 
          strcat(chr_l_sel_msg_stmt,"c.domestic_cpclt,decode(c.INFO1,NULL,NULL,substr(c.INFO1,130,35)) as NOTE13,");
          strcat(chr_l_sel_msg_stmt,"decode(c.INFO1,NULL,NULL,substr(c.INFO1,166,30)) as NOTE23,");
          strcat(chr_l_sel_msg_stmt,"decode(c.INFO1,NULL,NULL,substr(c.INFO1,197,35)) as NOTE14,");
          strcat(chr_l_sel_msg_stmt,"decode(c.INFO1,NULL,NULL,substr(c.INFO1,233,30)) as NOTE24,");
			 
			 strcat(chr_l_sel_msg_stmt,"c.lcl_identno,c.currency_cd,c.currency_cd as CCYAMOUNT,c.AMOUNT,c.net_amt as NET_AMT,c.currency_cd as CCYNET_AMT,ROWIDTOCHAR(c.rowid) as TRDROWID, a.CLN_CLASS as CLT_CLASS,");
			 
			 



		
          strcat(chr_l_sel_msg_stmt,"b.INSTR_ISIN,substr(replace(replace(b.instr_name,chr(13),NULL),chr(10),NULL),1,31) as INSTR_NAME ,b.currency_cd as SECCCY,concat('/',a.cln_vtb_client) as VTB_CLIENT,a.cln_vtb_client as NEW_VTB,c.cp_clt,"); 
		
	  		 strcat(chr_l_sel_msg_stmt," decode(b.INSTR_TYPE,'BON',decode(a.CLN_FMT_RPTIND,'Y','FMT'");
	  		 strcat(chr_l_sel_msg_stmt,",b.INSTR_TYPE),b.INSTR_TYPE) as INSTR_TYPE, decode(b.INSTR_TYPE,'BON',decode(a.CLN_FMT_RPTIND,'Y',to_char(c.QTY*b.NOMINAL_VALUE),c.QTY),c.QTY) as QTY,");
          strcat(chr_l_sel_msg_stmt," a.CLN_USE_ISIN_IND  as FLGISIN, ");
          strcat(chr_l_sel_msg_stmt," decode(c.domestic_cpclt,d.custody_clt_cd,'Y','N') as ISDOMCITI, ");

          strcat(chr_l_sel_msg_stmt," to_char(c.setl_date,'YYYYMMDD') as NEW_SETTLEDT, to_char(c.deal_date,'YYYYMMDD') as NEW_TRDT, ");

          strcat(chr_l_sel_msg_stmt," a.EXT_CLH_CLIENT ");
          
          strcat(chr_l_sel_msg_stmt,",decode(c.dl_class,'27','26','29','26',c.dl_class) as DL_CLASS  ");
          
          strcat(chr_l_sel_msg_stmt,", decode(c.LRNDS_DATE, NULL, to_char(e.SYS_DATE, 'YYYYMMDD'), to_char(c.LRNDS_DATE, 'YYYYMMDD'))  as NEW_FWDVALDT ");
          strcat(chr_l_sel_msg_stmt," FROM MT_CLIENT a,MT_INSTRUMENT b,dl_deal c,MT_CORE_SYS_PARAMS d , pro_sys_date e ");
          strcat(chr_l_sel_msg_stmt," WHERE c.client = a.cln_code and ");
          strcat(chr_l_sel_msg_stmt," a.CLN_BRK_ALL != 'B' and a.checker is not null and ");
          strcat(chr_l_sel_msg_stmt," a.STATUS != '");
          strcat(chr_l_sel_msg_stmt,STATUS_CLS_AUTH);
          strcat(chr_l_sel_msg_stmt,"' and  c.instr_code = b.instr_code and ");
          strcat(chr_l_sel_msg_stmt," c.VAL_FDT is not null and ");

			 if (chr_l_cond) 
			 {
				strcat(chr_l_sel_msg_stmt, "c.lcl_identno is not null and ");
				strcat(chr_l_sel_msg_stmt, "c.TRANS_DATE is null and ");
				
				strcat(chr_l_sel_msg_stmt, " c.domestic_cpclt not in (select FIELD_VAL from PRO_GSSPLVAL where MAIN_FUN = 'FE_BOG_INSTRUCTIONS' and SUB_PROCESS = 'DOMCPAC' and NATION = 'GR') and ");
				
			 }
			 else 
			 {
           
			        

			  if (APL_FAILURE == CO_Chk_CntryEnabled(  "MSG_52X",
															  "GEN_52X_FOR_VTB",
															  &l_cond_vtb,
															  l_debug_info_ptr ))
			  {	
				  APL_GOBACK_FAIL
			  }

          	strcat(chr_l_sel_msg_stmt," b.CLASSCD = 'MIN' and ");
          	strcat(chr_l_sel_msg_stmt," ((c.domestic_cpclt != '");
          	strcat(chr_l_sel_msg_stmt,chr_h_citibank_acct_code);
          	strcat(chr_l_sel_msg_stmt,"') or ");
          	strcat(chr_l_sel_msg_stmt," (c.domestic_cpclt = '");
          	strcat(chr_l_sel_msg_stmt,chr_h_citibank_acct_code);
          	strcat(chr_l_sel_msg_stmt,"' and c.deal_cd = 1)) and ");
				strcat(chr_l_sel_msg_stmt, "c.TRANS_DATE is null and ");  
			 }
          strcat(chr_l_sel_msg_stmt," c.rowid NOT IN (SELECT a.rowid FROM ");
          strcat(chr_l_sel_msg_stmt," MS_MSGSTAT f where f.swift_msg_rep = '");
          strcat(chr_l_sel_msg_stmt,p_msg_no);
          strcat(chr_l_sel_msg_stmt,"' AND  c.client = f.client AND ");
          strcat(chr_l_sel_msg_stmt," c.IDENTIY_NO = f.proc_init)");

			 

			 

          if(strlen(l_ms_msgent_structa_a.client) != 0)
          {
             strcat(chr_l_sel_msg_stmt," AND c.client = '");
             strcat(chr_l_sel_msg_stmt,l_ms_msgent_structa_a.client);
             strcat(chr_l_sel_msg_stmt,"' ");
          }

			 
          
          if(l_cond_vtb)
          {
            strcat(chr_l_sel_msg_stmt," ORDER BY c.DEAL_CD");
          }
			 if (chr_l_cond)
			 {
				strcat(chr_l_sel_msg_stmt, " for update ");
			 }
        }
		  
		  
        if(strcmp(p_msg_no, MS_MSGNO_52XN01) == 0)
        {
          l_msgaddr = MBROKERMSGNO;       

			 if(strlen(l_ms_msgent_structa_a.proc_data) != 0)    
			 {
					CO_SplitStr(l_ms_msgent_structa_a.proc_data,';', &int_noelem, &chr_l_param);
					strcpy(chr_l_broker,chr_l_param[0]);
			 }

          *p_STAT_VAL = realloc(*p_STAT_VAL,sizeof(MS_STATIC_VAL)*4); 
			 APL_MALLOC_FAIL(*p_STAT_VAL)
          *p_SEL_VAL = realloc(*p_SEL_VAL,sizeof(MS_STATIC_VAL)*10);
			 
			 APL_MALLOC_FAIL(*p_SEL_VAL)

          strcpy((*p_STAT_VAL)[1].link_val,"NATION");
          strcpy((*p_STAT_VAL)[1].link_tag,g_mt_commonsys_params_struct_h.nation_code);
          strcpy((*p_STAT_VAL)[2].link_val,"DATE");
          strcpy((*p_STAT_VAL)[2].link_tag,h_sys_dt);
          strcpy((*p_STAT_VAL)[3].link_val,"");
          strcpy((*p_STAT_VAL)[3].link_tag,"");

          strcpy((*p_SEL_VAL)[0].link_val,"DOMESTIC_CPCLT");
          strcpy((*p_SEL_VAL)[1].link_val,"CLIENT"); 
          strcpy((*p_SEL_VAL)[2].link_val,"DEAL_CD");
          strcpy((*p_SEL_VAL)[3].link_val,"IDENTIY_NO"); 
	  strcpy((*p_SEL_VAL)[4].link_val,"NCOUNTACC");
	  strcpy((*p_SEL_VAL)[5].link_val,"CLIENTOF_CD");
	  strcpy((*p_SEL_VAL)[6].link_val,"CP_CLTNAME");
	  strcpy((*p_SEL_VAL)[7].link_val,"NEW_ACCOUNTOF1");
	  strcpy((*p_SEL_VAL)[8].link_val,"UNIQREFNO"); 
          strcpy((*p_SEL_VAL)[9].link_val,"");


          strcpy(chr_l_sel_msg_stmt,"SELECT c.client,c.IDENTIY_NO,c.deal_cd,to_char(c.setl_date,'YYMMDD') as setl_date,to_char(c.deal_date,'YYMMDD') as deal_date,c.IDENTIY_NO as PROC_INIT,c.domestic_cpclt,c.instr_code,");
          strcat(chr_l_sel_msg_stmt,"to_char(c.setl_date,'YYYYMMDD') as new_settledt,to_char(c.deal_date,'YYYYMMDD') as new_trdate,");
          strcat(chr_l_sel_msg_stmt," decode(c.INFO1,NULL,NULL,substr(c.INFO1,130,35)) as NOTE13,");
          strcat(chr_l_sel_msg_stmt,"decode(c.INFO1,NULL,NULL,substr(c.INFO1,166,30)) as NOTE23,");
          strcat(chr_l_sel_msg_stmt,"decode(c.INFO1,NULL,NULL,substr(c.INFO1,197,35)) as NOTE14,");
          strcat(chr_l_sel_msg_stmt,"decode(c.INFO1,NULL,NULL,substr(c.INFO1,233,30)) as NOTE24,");
			 strcat(chr_l_sel_msg_stmt,"c.lcl_identno,c.currency_cd,c.currency_cd as CCYAMOUNT,c.AMOUNT,c.net_amt,c.currency_cd as CCYNET_AMT, c.rowid,a.CLT_CLAS as CLT_CLASS,");
          strcat(chr_l_sel_msg_stmt,"c.UNIQ_IDENT_NO as UNIQREFNO,b.INSTR_ISIN,substr(replace(replace(b.instr_name,chr(13),NULL),chr(10),NULL),1,31) as INSTR_NAME ,b.currency_cd as SECCCY,concat('/',a.cln_vtb_client) as VTB_CLIENT,c.cp_clt,c.cp_clt as NCOUNTACC, c.domestic_cpclt,");
	  		 strcat(chr_l_sel_msg_stmt," decode(b.INSTR_TYPE,'BON',decode(a.CLN_FMT_RPTIND,'Y','FMT'");
	  		 strcat(chr_l_sel_msg_stmt,",b.INSTR_TYPE),b.INSTR_TYPE) as INSTR_TYPE, decode(b.INSTR_TYPE,'BON',decode(a.CLN_FMT_RPTIND,'Y',to_char(c.QTY*b.NOMINAL_VALUE),c.QTY),c.QTY) as QTY,");
	  		 strcat(chr_l_sel_msg_stmt," decode(b.INSTR_TYPE,'BON',decode(a.CLN_FMT_RPTIND,'Y','FMT'");
	  		 strcat(chr_l_sel_msg_stmt,",b.INSTR_TYPE),b.INSTR_TYPE) as FTYPEOFINSTR,");
          strcat(chr_l_sel_msg_stmt," a.CLN_USE_ISIN_IND  as FLGISIN, ");
          strcat(chr_l_sel_msg_stmt," decode(c.domestic_cpclt,d.custody_clt_cd,'Y','N') as ISDOMCITI, ");

          strcat(chr_l_sel_msg_stmt," a.CLN_EXT_CLH, ");
          strcat(chr_l_sel_msg_stmt," c.COST,decode(c.dl_class,'27','26','29','26',c.dl_class) as DL_CLASS, "); 
			 strcat(chr_l_sel_msg_stmt,"decode(b.INSTR_TYPE,'BON',decode(a.CLN_FMT_RPTIND,'Y',to_char(c.QTY*b.NOMINAL_VALUE),c.QTY),c.QTY) as FENT_POS");
	 		 strcat(chr_l_sel_msg_stmt,",upper(decode(substr(replace(replace(c.CP_CLTNAME,chr(13),NULL),chr(10),NULL),1,1),'/',substr(replace(replace(c.CP_CLTNAME,chr(13),NULL),chr(10),NULL),2,34),");
			 strcat(chr_l_sel_msg_stmt,"substr(replace(replace(c.CP_CLTNAME,chr(13),NULL),chr(10),NULL),1,35))) as CP_CLTNAME ");

			 strcat(chr_l_sel_msg_stmt," ,decode(ltrim(rtrim(substr(c.clientof,1,35))),NULL,NULL,ltrim(rtrim(substr(c.clientof,1,35)))) as NEW_ACCOUNTOF1  ");
			 strcat(chr_l_sel_msg_stmt," ,decode(ltrim(rtrim(substr(c.clientof,36,30))),NULL,NULL,ltrim(rtrim(substr(c.clientof,36,30)))) as NEW_ACCOUNTOF2  ");
          strcat(chr_l_sel_msg_stmt," ,decode(ltrim(rtrim(substr(c.INSTRUCT_PERSONNM,1,35))),NULL,NULL,ltrim(rtrim(substr(c.INSTRUCT_PERSONNM,1,35)))) as INSTPARTYNM1  ");
          strcat(chr_l_sel_msg_stmt," ,decode(ltrim(rtrim(substr(c.INSTRUCT_PERSONNM,36,30))),NULL,NULL,ltrim(rtrim(substr(c.INSTRUCT_PERSONNM,36,30)))) as INSTPARTYNM2  ");
			 strcat(chr_l_sel_msg_stmt,",b.currency_cd as CCYCOST ");
         
          strcat(chr_l_sel_msg_stmt,",decode(c.domestic_cpclt,'");
	  strcat(chr_l_sel_msg_stmt,chr_h_citibank_acct_code);
	  strcat(chr_l_sel_msg_stmt,"','Y','N') as IS_CT_DOMCPAC ");
	  strcat(chr_l_sel_msg_stmt,", c.CLIENTOF_CD, c.INSTRUCT_PERSON AS INSTPRTY, c.INTER_MED_PERSON, c.ENTRY "); 
	  strcat(chr_l_sel_msg_stmt," ,decode(ltrim(rtrim(substr(c.INTER_MED_PERSONNM,1,35))),NULL,NULL,ltrim(rtrim(substr(c.INTER_MED_PERSONNM,1,35)))) as INTER_MED_PERSONNM1 ");
	  strcat(chr_l_sel_msg_stmt," ,decode(ltrim(rtrim(substr(c.INTER_MED_PERSONNM,36,60))),NULL,NULL,ltrim(rtrim(substr(c.INTER_MED_PERSONNM,36,60)))) as INTER_MED_PERSONNM2 ");
	  
          strcat(chr_l_sel_msg_stmt," FROM MT_CLIENT a,MT_INSTRUMENT b,dl_deal c,MT_CORE_SYS_PARAMS d");
          strcat(chr_l_sel_msg_stmt," WHERE c.client = a.cln_code and ");
          strcat(chr_l_sel_msg_stmt," a.CLN_BRK_ALL != 'B' and a.checker is not null and ");
          strcat(chr_l_sel_msg_stmt," a.STATUS != '");
          strcat(chr_l_sel_msg_stmt,STATUS_CLS_AUTH);
          strcat(chr_l_sel_msg_stmt,"' and  c.instr_code = b.instr_code and ");
          strcat(chr_l_sel_msg_stmt," c.VAL_FDT is not null and ");

			 strcat(chr_l_sel_msg_stmt," c.domestic_cpclt = '");
			 strcat(chr_l_sel_msg_stmt,chr_l_broker);
			 strcat(chr_l_sel_msg_stmt,"' and ");
          strcat(chr_l_sel_msg_stmt," instr(nvl(c.MSG_STAT,' '),'");
          strcat(chr_l_sel_msg_stmt,MSG_FLG_52X_EURO);
          strcat(chr_l_sel_msg_stmt,"') = 0  ");

        }


        if(strcmp(p_msg_no,"534") == 0)
       {		printf("\n **** 534 ****** msg \n");
          l_msgaddr = MSETLPROBMSGNO;       

     		 if(strlen(l_ms_msgent_structa_a.proc_data) != 0)
          {
             CO_SplitStr((*p_imsgent_struct).proc_data,
                          ';', &int_noelem, &chr_l_param);

             strcpy(chr_l_mult_548,chr_l_param[0]);
			 }
			 else
				strcpy(chr_l_mult_548,APL_NULL_STRING);

          
          *p_STAT_VAL = realloc(*p_STAT_VAL,sizeof(MS_STATIC_VAL)*7); 

          
			 
			 
			   
			     *p_SEL_VAL = realloc(*p_SEL_VAL,sizeof(MS_STATIC_VAL)*11); 
			
          strcpy((*p_STAT_VAL)[1].link_val,"DOMSEC");
          strcpy((*p_STAT_VAL)[1].link_tag,chr_h_dom_instr);
          strcpy((*p_STAT_VAL)[2].link_val,"DATE");
          strcpy((*p_STAT_VAL)[2].link_tag,h_sys_dt);
			
          strcpy((*p_STAT_VAL)[3].link_val,"ORDER_PROC");
          strcpy((*p_STAT_VAL)[3].link_tag,chr_h_order_proc);
			 
			 strcpy((*p_STAT_VAL)[4].link_val,"NATION");
			 strcpy((*p_STAT_VAL)[4].link_tag,g_mt_commonsys_params_struct_h.nation_code);
          strcpy((*p_STAT_VAL)[5].link_val,"MULT_548");
          strcpy((*p_STAT_VAL)[5].link_tag,chr_l_mult_548);
          strcpy((*p_STAT_VAL)[6].link_val,"");
          strcpy((*p_STAT_VAL)[6].link_tag,"");
			 
			


          strcpy((*p_SEL_VAL)[0].link_val,"FAILREASON_CD");
          strcpy((*p_SEL_VAL)[1].link_val,"SUB_FAIL_CD");
          strcpy((*p_SEL_VAL)[2].link_val,"CLIENT");
          strcpy((*p_SEL_VAL)[3].link_val,"IDENTIY_NO");
          strcpy((*p_SEL_VAL)[4].link_val,"NEW_DOMCPAC");
	  
	   strcpy((*p_SEL_VAL)[5].link_val,"NCOUNTACC"); 
	  strcpy((*p_SEL_VAL)[6].link_val,"CLIENTOF_CD");
	  strcpy((*p_SEL_VAL)[7].link_val,"CP_CLTNAME");
	  strcpy((*p_SEL_VAL)[8].link_val,"NEW_ACCOUNTOF1");
	  strcpy((*p_SEL_VAL)[9].link_val,"UNIQREFNO");
     strcpy((*p_SEL_VAL)[10].link_val,"");
     strcpy((*p_SEL_VAL)[10].link_tag,"");

		
        strcpy(chr_l_sel_msg_stmt,"SELECT c.client,c.IDENTIY_NO,concat('/',c.client) as NACCOUNT,"); 
          strcat(chr_l_sel_msg_stmt,"c.lcl_identno,");
          strcat(chr_l_sel_msg_stmt,"c.ORIG_REFNO,substr(to_char(c.setl_date,'YYMMDD'),1,6) as setl_date,");




          strcat(chr_l_sel_msg_stmt,"c.sub_fail_cd,c.UNIQ_IDENT_NO||lpad(to_char(decode(c.cnt_548,99,0,(nvl(c.cnt_548,0)+1))),2,'0')  as UNIQREFNO,decode(c.dl_class,'27','26','29','26',c.dl_class) as DL_CLASS,substr(to_char(c.setl_date,'YYYYMMDD'),1,8) as NEW_SETTLEDT,");    

			 
			
          strcat(chr_l_sel_msg_stmt,"to_char(c.exp_setldate,'YYYYMMDD') as EXP_SETLDATE,c.failreason_cd,b.INSTR_ISIN,b.instr_code,substr(replace(replace(b.instr_name,chr(13),NULL),chr(10),NULL),1,35) as INSTR_NAME ,b.currency_cd as SECCCY,c.deal_cd, '");
          strcat(chr_l_sel_msg_stmt,l_new_date);
          strcat(chr_l_sel_msg_stmt,"' as NEW_DT,");
           
			 
          strcat(chr_l_sel_msg_stmt," decode(c.deal_cd,1,'522',decode(c.deal_cd,2,'520',");
          strcat(chr_l_sel_msg_stmt,"decode(c.deal_cd,3,'523',decode(c.deal_cd,5,'522',decode(c.deal_cd,6,'520',decode(c.deal_cd,7,'523','521')))))) as NTRCODE,to_char(c.deal_date,'YYMMDD') as DEAL_DATE,");
			 strcat(chr_l_sel_msg_stmt,"to_char(c.deal_date,'YYYYMMDD') as NEW_TRDT,");
	  strcat(chr_l_sel_msg_stmt," decode(b.INSTR_TYPE,'BON',decode(a.CLN_FMT_RPTIND,'Y','FMT'");
	  strcat(chr_l_sel_msg_stmt,",b.INSTR_TYPE),b.INSTR_TYPE) as FTYPEOFINSTR,decode(b.INSTR_TYPE,'BON',decode(a.CLN_FMT_RPTIND,'Y',to_char(c.QTY*b.NOMINAL_VALUE),c.QTY),c.QTY) as FENT_POS,");
          strcat(chr_l_sel_msg_stmt,"upper(decode(substr(replace(replace(c.CP_CLTNAME,chr(13),NULL),chr(10),NULL),1,1),'/',substr(replace(replace(c.CP_CLTNAME,chr(13),NULL),chr(10),NULL),2,34),");
          strcat(chr_l_sel_msg_stmt,"substr(replace(replace(c.CP_CLTNAME,chr(13),NULL),chr(10),NULL),1,35))) as CP_CLTNAME,");
          strcat(chr_l_sel_msg_stmt,"decode(replace(replace(c.client_note,chr(13),NULL),chr(10),NULL),NULL,' ',");
          strcat(chr_l_sel_msg_stmt,"substr(replace(replace(c.client_note,chr(13),NULL),chr(10),NULL),1,31)) as CLIENT_NOTE,"); 

          strcat(chr_l_sel_msg_stmt,"decode(replace(replace(c.client_note,chr(13),NULL),chr(10),NULL),NULL,' ',substr(replace(replace(c.client_note,chr(13),NULL),chr(10),NULL),32,34))"); 
          strcat(chr_l_sel_msg_stmt,"as CUSTNOTE1,");
			
        strcat(chr_l_sel_msg_stmt," b.currency_cd as CCYAMOUNT,c.AMOUNT as AMOUNT,c.net_amt as NET_AMT,b.currency_cd as CCYNET_AMT,decode(to_char(sign(c.AMOUNT)),'-1','Y','N')as NCCYAMOUNT_IND,");

          strcat(chr_l_sel_msg_stmt," a.CLN_USE_ISIN_IND  as FLGISIN ,c.exch_code, c.mkt_type, c.clh_flg,c.contract_cd, c.interfii_flg, ");
   		  /*Vaibhavk 10Dec2007 ISKB:361  (ORIG_QTY and ORIG_AMOUNT Tag added)Start */	 
          strcat(chr_l_sel_msg_stmt," c.ORIG_QTY as ORIG_QTY,c.ORIG_AMOUNT as ORIG_AMOUNT,a.CLN_TAXABLE_IND  as IND_83C83D, "); 
		  /*Vaibhavk 10Dec2007 ISKB:361 End */
          strcat(chr_l_sel_msg_stmt," substr(replace(replace(a.cln_name,chr(13),NULL),chr(10),NULL),1,35)  as CLNT_NAME ");
			 

         strcat(chr_l_sel_msg_stmt,",decode(c.domestic_cpclt,'");
         strcat(chr_l_sel_msg_stmt,chr_h_citibank_acct_code);
         strcat(chr_l_sel_msg_stmt,"','Y','N') as IS_CT_DOMCPAC,c.domestic_cpclt as NEW_DOMCPAC,decode(rtrim(ltrim(c.cp_clt)),NULL,NULL,rtrim(ltrim(c.cp_clt))) as NCOUNTACC,b.nominal_value  ");

         strcat(chr_l_sel_msg_stmt,",decode(c.DATEOF_MARKFAIL,NULL,'Y',decode(greatest(c.setl_date,to_date((trunc(c.DATEOF_MARKFAIL)+0.5),'DD/MM/YYYY hh:mi:ss')),c.setl_date,'Y','N')) as PENDIND_NEW ");
	 
	 
	  strcat(chr_l_sel_msg_stmt,",ltrim(rtrim(c.CLIENTOF_CD)) as CLIENTOF_CD, c.INTER_MED_PERSON, c.INSTRUCT_PERSON AS INSTPRTY, c.ENTRY ");
          strcat(chr_l_sel_msg_stmt," ,decode(ltrim(rtrim(substr(c.INTER_MED_PERSONNM,1,35))),NULL,NULL,ltrim(rtrim(substr(c.INTER_MED_PERSONNM,1,35)))) as INTER_MED_PERSONNM1 ");
          strcat(chr_l_sel_msg_stmt," ,decode(ltrim(rtrim(substr(c.INTER_MED_PERSONNM,36,60))),NULL,NULL,ltrim(rtrim(substr(c.INTER_MED_PERSONNM,36,60)))) as INTER_MED_PERSONNM2 ");
	  strcat(chr_l_sel_msg_stmt," ,decode(ltrim(rtrim(substr(c.clientof,1,35))),NULL,'',ltrim(rtrim(substr(c.clientof,1,35)))) as NEW_ACCOUNTOF1 ");
 	  strcat(chr_l_sel_msg_stmt," ,decode(ltrim(rtrim(substr(c.clientof,36,30))),NULL,NULL,ltrim(rtrim(substr(c.clientof,36,30)))) as NEW_ACCOUNTOF2  ");
	  strcat(chr_l_sel_msg_stmt," ,decode(ltrim(rtrim(substr(c.INSTRUCT_PERSONNM,1,35))),NULL,NULL,ltrim(rtrim(substr(c.INSTRUCT_PERSONNM,1,35)))) as INSTPARTYNM1 ");
 	  strcat(chr_l_sel_msg_stmt," ,decode(ltrim(rtrim(substr(c.INSTRUCT_PERSONNM,36,30))),NULL,NULL,ltrim(rtrim(substr(c.INSTRUCT_PERSONNM,36,30)))) as INSTPARTYNM2 "); 
	 
          
	  strcat(chr_l_sel_msg_stmt," FROM MT_CLIENT a,MT_INSTRUMENT b,dl_deal c");
          strcat(chr_l_sel_msg_stmt," WHERE c.client = '");
          strcat(chr_l_sel_msg_stmt,l_ms_msgent_structa_a.client);
          strcat(chr_l_sel_msg_stmt,"' AND c.IDENTIY_NO = '");
          strcat(chr_l_sel_msg_stmt,l_ms_msgent_structa_a.proc_init);
			 strcat(chr_l_sel_msg_stmt,"' AND c.failreason_cd != '20' "); 
          strcat(chr_l_sel_msg_stmt," AND ");
          strcat(chr_l_sel_msg_stmt," a.CLN_BRK_ALL != 'B' and a.checker is not null and ");
	  strcat(chr_l_sel_msg_stmt," a.STATUS != '");
          strcat(chr_l_sel_msg_stmt,STATUS_CLS_AUTH);
          strcat(chr_l_sel_msg_stmt,"' and  c.client = a.cln_code and ");

          strcat(chr_l_sel_msg_stmt," c.instr_code = b.instr_code ");

			 
           
        }

        if(strcmp(p_msg_no,"548N04") == 0)
        {
           printf("after if inside 548N04 \n");
           *p_STAT_VAL = realloc(*p_STAT_VAL,sizeof(MS_STATIC_VAL)*14);	/* Changed by Sana from 5 to 14 */
           *p_SEL_VAL = realloc(*p_SEL_VAL,sizeof(MS_STATIC_VAL)*14);	/* Changed by Sana from 7 to 14 **/

           if(strlen(l_ms_msgent_structa_a.proc_data) != 0)
           {
               CO_SplitStr((*p_imsgent_struct).proc_data,';', &int_noelem, &chr_l_param);
               printf("param |%s|int_noelem|%d|\n",(*p_imsgent_struct).proc_data,int_noelem);
		memset(chr_contract_cd,APL_NULL_CHAR,sizeof(chr_contract_cd));
		memset(chr_broker_cd,APL_NULL_CHAR,sizeof(chr_broker_cd));
		memset(chr_deal_dt,APL_NULL_CHAR,sizeof(chr_deal_dt));
               strcpy(chr_contract_cd,chr_l_param[0]);  /**contract_code**/
               strcpy(chr_broker_cd,chr_l_param[1]);/***broker_cd**/
               strcpy(chr_deal_dt,chr_l_param[2]);/**deal_dt **/
           }


           strcpy((*p_STAT_VAL)[1].link_val,"NATION");
           strcpy((*p_STAT_VAL)[1].link_tag,g_mt_commonsys_params_struct_h.nation_code);
           //strcpy((*p_STAT_VAL)[2].link_val,APL_NULL_STRING);// Commented by Gouse for ISKB_6013 
	   /* Added by Gouse for ISKB_6013 - Junk Chars in DAT File - Start */
	   strcpy((*p_STAT_VAL)[2].link_val,"");
	   strcpy((*p_STAT_VAL)[2].link_tag,"");
	   /* Added by Gouse for ISKB_6013 - Junk Chars in DAT File - End */

           strcpy((*p_SEL_VAL)[0].link_val,"BROKER_CD");
           strcpy((*p_SEL_VAL)[1].link_val,"COUNTER_PTY");
           strcpy((*p_SEL_VAL)[2].link_val,"FAILREASON_CD");
           strcpy((*p_SEL_VAL)[3].link_val,"SUB_FAIL_CD");
           strcpy((*p_SEL_VAL)[4].link_val,"EXCH_CD");
           strcpy((*p_SEL_VAL)[5].link_val,"CLIENT");
           strcpy((*p_SEL_VAL)[6].link_val,"COUNTACCNM");     /*Vaibhav Karnik KOTAK-UAT I-SolveID:361 11-July-2007 Start*/
           strcpy((*p_SEL_VAL)[7].link_val,"");
           strcpy((*p_SEL_VAL)[7].link_tag,"");               /*Vaibhav Karnik KOTAK-UAT I-SolveID:361 11-July-2007 End*/

      /*********** Vedavati ***********/

           printf("\n **** 548N04 ****** msg \n");
           l_msgaddr = MSETLPROBMSGNO;
		memset(chr_l_sel_msg_stmt,APL_NULL_CHAR,sizeof(chr_l_sel_msg_stmt));	/* Added By Sana for AIX migration */
           strcpy(chr_l_sel_msg_stmt,"select instr_isin as ISIN,a.client_cd AS CLIENT,a.instr_cd as INSTR_CODE,a.settlment_amt as AMOUNT,c.currency_cd as CCYAMOUNT,a.inter_fii_flg,substr(to_char(a.sett_dt,'YYYYMMDD'),1,8) AS SETT_DT,a.narrative,c.nominal_value,c.currency_cd,c.currency_cd as CCYAMOUNT,substr(replace(replace(c.instr_name,chr(13),NULL),chr(10),NULL),1,35) as INSTR_NAME, c.instr_isin, ");
           strcat(chr_l_sel_msg_stmt,"a.deal_cd,a.counter_pty AS COUNTACCNM,a.failreason_cd,a.sub_fail_cd,a.contract_cd,a.dl_date,a.broker_cd,a.exch_cd,a.clh_flg, ");
           strcat(chr_l_sel_msg_stmt,"decode(c.INSTR_TYPE,'BON',decode(b.CLN_FMT_RPTIND,'Y','FMT' ,c.INSTR_TYPE),c.INSTR_TYPE) as FTYPEOFINSTR, '");
           strcat(chr_l_sel_msg_stmt,l_new_date);
           strcat(chr_l_sel_msg_stmt,"' as NEW_DT,");
           strcat(chr_l_sel_msg_stmt,"decode(c.INSTR_TYPE,'BON',decode(b.CLN_FMT_RPTIND,'Y',to_char(a.QTY*c.NOMINAL_VALUE),a.QTY),a.QTY) as FENT_POS, ADDR_FRM,ADDR_TO,");
            strcat(chr_l_sel_msg_stmt,"d.cln_sebi_reg_no,d.cln_ucc_code,e.cln_exch_code,f.pty_name AS DOMCPDESC");  /* Changed by Mangesh for ISKB_4212 */
            strcat(chr_l_sel_msg_stmt," FROM DL_BCN a, MT_CLIENT b , MT_INSTRUMENT c , MT_REGDETAILS d , MT_PARTY f,MT_CLI_EXCH_MAP e");  /* Changed by Mangesh for ISKB_4212 */
            strcat(chr_l_sel_msg_stmt," WHERE a.client_cd=b.cln_code ");
            strcat(chr_l_sel_msg_stmt," AND d.cln_code (+)=a.client_cd "); /*Changed by Mangesh for ISKB_4212 */
	    strcat(chr_l_sel_msg_stmt," AND e.cln_code (+)=a.client_cd "); /*Changed by Mangesh for ISKB_4212 */
	    strcat(chr_l_sel_msg_stmt," AND e.cln_exch_code(+)=a.exch_cd "); /*Changed by Mangesh for ISKB_4212 */
            strcat(chr_l_sel_msg_stmt," AND a.instr_cd=c.instr_code ");
            strcat(chr_l_sel_msg_stmt," AND a.broker_cd = f.pty_code ");
            strcat(chr_l_sel_msg_stmt," AND a.FAILREASON_CD IS NOT NULL ");

           if(strlen(l_ms_msgent_structa_a.client)!=0)
           {
             strcat(chr_l_sel_msg_stmt," and a.broker_cd = '");
              strcat(chr_l_sel_msg_stmt,l_ms_msgent_structa_a.client);
              strcat(chr_l_sel_msg_stmt,"'");
           }
           strcat(chr_l_sel_msg_stmt," and a.dl_date = '");
           strcat(chr_l_sel_msg_stmt,chr_deal_dt);
           strcat(chr_l_sel_msg_stmt,"'");
           strcat(chr_l_sel_msg_stmt," and a.contract_cd = '");
           strcat(chr_l_sel_msg_stmt,chr_contract_cd);
           strcat(chr_l_sel_msg_stmt,"' ");
           strcat(chr_l_sel_msg_stmt,"  order by a.broker_cd");

        }


        if((strcmp(p_msg_no,"534N01") == 0) || ( strcmp(p_msg_no,"578N02")==0) ) 
        {
			  printf("\n msg no is ************** |%s|************* \n", p_msg_no);
          l_msgaddr = MSETLPROBMSGNO;       

          memset(chr_temp,APL_NULL_CHAR,201);
          if(strlen(l_ms_msgent_structa_a.proc_init) != 0)
          {
		strcpy(chr_l_refno,l_ms_msgent_structa_a.proc_init);
          }
          else
          {
		APL_DATA_MISSING("Trd Ref.no", APL_NULL_STRING, APL_NULL_STRING)
                APL_GOBACK_FAIL
          }
          *p_STAT_VAL = realloc(*p_STAT_VAL,sizeof(MS_STATIC_VAL)*6); 
          *p_SEL_VAL = realloc(*p_SEL_VAL,sizeof(MS_STATIC_VAL)*6);  

          strcpy((*p_STAT_VAL)[1].link_val,"DOMSEC");
          strcpy((*p_STAT_VAL)[1].link_tag,chr_h_dom_instr);
          strcpy((*p_STAT_VAL)[2].link_val,"DATE");
          strcpy((*p_STAT_VAL)[2].link_tag,h_sys_dt);
          strcpy((*p_STAT_VAL)[3].link_val,"CBCODE");
          strcpy((*p_STAT_VAL)[3].link_tag,chr_h_citibank_acct_code);
			 
			 strcpy((*p_STAT_VAL)[4].link_val,"NATION");
			 strcpy((*p_STAT_VAL)[4].link_tag,g_mt_commonsys_params_struct_h.nation_code);
          strcpy((*p_STAT_VAL)[5].link_val,"");
          strcpy((*p_STAT_VAL)[5].link_tag,"");
			 

          strcpy((*p_SEL_VAL)[0].link_val,"DOMESTIC_CPCLT");
          strcpy((*p_SEL_VAL)[1].link_val,"CP_CLT");
          strcpy((*p_SEL_VAL)[2].link_val,"IDENTIY_NO");
   	    strcpy((*p_SEL_VAL)[3].link_val,"CLIENT");
   	    strcpy((*p_SEL_VAL)[4].link_val,"UNIQREFNO"); 
			 strcpy((*p_SEL_VAL)[5].link_val,"");
	
          strcpy(chr_l_sel_msg_stmt,"SELECT c.IDENTIY_NO,c.client,");
          strcat(chr_l_sel_msg_stmt,"substr(to_char(c.setl_date,'YYMMDD'),1,6) as setl_date,");
	  strcat(chr_l_sel_msg_stmt,"c.deal_cd,b.INSTR_ISIN,b.instr_code,");
	  
          strcat(chr_l_sel_msg_stmt,"substr(replace(replace(b.instr_name,chr(13),NULL),chr(10),NULL),1,35) as INSTR_NAME,ltrim(rtrim((nvl(c.domestic_cpclt,'')))) as DOMESTIC_CPCLT,c.cp_clt,");
	  
	  strcat(chr_l_sel_msg_stmt," decode(b.INSTR_TYPE,'BON',decode(a.CLN_FMT_RPTIND,'Y','FMT'");
	  strcat(chr_l_sel_msg_stmt,",b.INSTR_TYPE),b.INSTR_TYPE) as FTYPEOFINSTR,decode(b.INSTR_TYPE,'BON',decode(a.CLN_FMT_RPTIND,'Y',to_char(c.QTY*b.NOMINAL_VALUE),c.QTY),c.QTY) as FENT_POS,");
          strcat(chr_l_sel_msg_stmt," b.currency_cd,c.AMOUNT,b.currency_cd as CCYAMOUNT,c.net_amt,b.currency_cd as CCYNET_AMT,c.UNIQ_IDENT_NO as UNIQREFNO,"); 
			  
          strcat(chr_l_sel_msg_stmt," substr(translate(c.info,chr(10)||chr(13)||chr(9)||chr(24),' '),1,35) as NEW_NOTE1, ");
          strcat(chr_l_sel_msg_stmt," substr(translate(c.info,chr(10)||chr(13)||chr(9)||chr(24),' '),36,35) as NEW_NOTE2, ");
          strcat(chr_l_sel_msg_stmt," substr(translate(c.info,chr(10)||chr(13)||chr(9)||chr(24),' '),71,35) as NEW_NOTE3, ");
          strcat(chr_l_sel_msg_stmt," substr(translate(c.info,chr(10)||chr(13)||chr(9)||chr(24),' '),106,35) as NEW_NOTE4, ");
          strcat(chr_l_sel_msg_stmt," substr(translate(c.info,chr(10)||chr(13)||chr(9)||chr(24),' '),141,35) as NEW_NOTE5, ");
          strcat(chr_l_sel_msg_stmt," substr(translate(c.info,chr(10)||chr(13)||chr(9)||chr(24),' '),176,35) as NEW_NOTE6, ");
          strcat(chr_l_sel_msg_stmt," substr(translate(c.info,chr(10)||chr(13)||chr(9)||chr(24),' '),211,35) as NEW_NOTE7, ");
          strcat(chr_l_sel_msg_stmt," substr(translate(c.info,chr(10)||chr(13)||chr(9)||chr(24),' '),246,35) as NEW_NOTE8, ");
          strcat(chr_l_sel_msg_stmt," substr(translate(c.info,chr(10)||chr(13)||chr(9)||chr(24),' '),281,35) as NEW_NOTE9, ");
          strcat(chr_l_sel_msg_stmt," substr(translate(c.info,chr(10)||chr(13)||chr(9)||chr(24),' '),316,35) as NEW_NOTE10, ");

          strcat(chr_l_sel_msg_stmt," substr(translate(c.PARTY_CON,chr(10)||chr(13)||chr(9)||chr(24),' '),1,35) as PRTYCON1, ");
          strcat(chr_l_sel_msg_stmt," substr(translate(c.PARTY_CON,chr(10)||chr(13)||chr(9)||chr(24),' '),36,35) as PRTYCON2, ");
          strcat(chr_l_sel_msg_stmt," substr(translate(c.PARTY_CON,chr(10)||chr(13)||chr(9)||chr(24),' '),71,35) as PRTYCON3, ");
          strcat(chr_l_sel_msg_stmt," substr(translate(c.PARTY_CON,chr(10)||chr(13)||chr(9)||chr(24),' '),106,35) as PRTYCON4, ");
          


			
			strcat(chr_l_sel_msg_stmt," c.PLACEOF_DEAL as PL_OF_TRADE,");
			strcat(chr_l_sel_msg_stmt," c.MRKT_IND, c.NARRATIVE,");
			strcat(chr_l_sel_msg_stmt," substr(to_char(c.access_stamp,'YYYYMMDDHH24MISS'),1,14) as NEW_PREP_DT,");
			strcat(chr_l_sel_msg_stmt," substr(to_char(c.setl_date,'YYYYMMDD'),1,8) as NEW_SETTLE_DT,");
			strcat(chr_l_sel_msg_stmt," substr(c.CP_CLTNAME,1,27) as NEW_COUNTACCNM,");
			
			
         strcat(chr_l_sel_msg_stmt," substr(to_char(c.dealdt,'YYYYMMDD'),1,8) as DEAL_DATE,");
			 
			 strcat(chr_l_sel_msg_stmt," a.CLN_USE_ISIN_IND  as FLGISIN ,");

			 
          strcat(chr_l_sel_msg_stmt," a.CLN_TAXABLE_IND as IND_83C83D,");
			 strcat(chr_l_sel_msg_stmt," substr(replace(replace(a.cln_name,chr(13),NULL),chr(10),NULL),1,35)  as CLNT_NAME ");
			 

			
		   strcat(chr_l_sel_msg_stmt," ,decode(ltrim(rtrim(substr(c.clientof,1,35))),NULL,NULL,ltrim(rtrim(substr(c.clientof,1,35)))) as NEW_ACCOUNTOF1 ,decode(ltrim(rtrim(substr(c.clientof,36,30))),NULL,NULL,ltrim(rtrim(substr(c.clientof,36,30)))) as NEW_ACCOUNTOF2 ,decode(ltrim(rtrim(substr(c.INSTRUCT_PERSONNM,1,35))),NULL,NULL,ltrim(rtrim(substr(c.INSTRUCT_PERSONNM,1,35)))) as INSTPARTYNM1 ,decode(ltrim(rtrim(substr(c.INSTRUCT_PERSONNM,36,30))),NULL,NULL,ltrim(rtrim(substr(c.INSTRUCT_PERSONNM,36,30)))) as INSTPARTYNM2 ,c.DEAL_CLS as DEAL_CLS, c.DEAL_RF_IDENT as DEAL_RF_IDENT, c.COMMIDENT as COMMIDENT , c.POOL_REF as POOL_REF,c.DSN_REFCD as DSN_REFCD ");
         
			
			

	  strcat(chr_l_sel_msg_stmt," from MT_CLIENT a,MT_INSTRUMENT b,DL_MISDEAL c ");
	  strcat(chr_l_sel_msg_stmt," where a.cln_code = c.client and ");
	  strcat(chr_l_sel_msg_stmt," b.instr_code = c.instr_code ");
          
     strcat(chr_l_sel_msg_stmt," and c.SEND_MSG_IND = 'Y'  ");
          

          if(strlen(l_ms_msgent_structa_a.client)!=0)
          {
		strcat(chr_l_sel_msg_stmt," and a.cln_code = '");
                strcat(chr_l_sel_msg_stmt,l_ms_msgent_structa_a.client);
                strcat(chr_l_sel_msg_stmt,"' ");
          }
	  strcat(chr_l_sel_msg_stmt," and c.IDENTIY_NO = '");
	  strcat(chr_l_sel_msg_stmt,chr_l_refno);

          strcat(chr_l_sel_msg_stmt,"' ");
          strcat(chr_l_sel_msg_stmt," and a.CLN_BRK_ALL != 'B' and a.STATUS != '");
	  strcat(chr_l_sel_msg_stmt,STATUS_CLS_AUTH);
	  strcat(chr_l_sel_msg_stmt,"' ");
	  }
		
		
       if(strcmp(p_msg_no,"586") == 0)
       {
          l_msgaddr = MALLGDETMSG;
     if(strlen(l_ms_msgent_structa_a.proc_data) != 0)
          {
             CO_SplitStr((*p_imsgent_struct).proc_data,
                          ';', &int_noelem, &chr_l_param);

             strcpy(chr_as_of_date,chr_l_param[0]);
             strcpy(chr_l_no_alleg,chr_l_param[1]);
             if (int_noelem == 7)
             {
               strcpy(chr_l_week_stm,chr_l_param[6]);
               strcpy(chr_l_last_gen_date,chr_l_param[5]);
				 }

             if ( int_noelem > 2 && (int_noelem != 7))
             {
               strcpy(chr_l_typeofinstr, chr_l_param[2]);
             }
        }

          if(strlen(chr_as_of_date)== 0)
          {
      APL_DATA_MISSING("AS OF DATE", APL_NULL_STRING, APL_NULL_STRING)
                APL_GOBACK_FAIL
          }
          if(strlen(chr_l_no_alleg)== 0)
          {
      APL_DATA_MISSING("NO ALEGEMENTS", APL_NULL_STRING, APL_NULL_STRING)
                APL_GOBACK_FAIL
          }

   *p_STAT_VAL = realloc(*p_STAT_VAL,sizeof(MS_STATIC_VAL)*11);
   *p_SEL_VAL = realloc(*p_SEL_VAL,sizeof(MS_STATIC_VAL)*6); 

          exec sql select substr(to_char(to_date(:chr_as_of_date),'YYYYMMDD'),1,8)
                   into :chr_l_as_of_date_586
                   from dual;
          IS_ANY_ORA_ERROR

			 if(strcmp(chr_l_week_stm,"Y")==0)
			 {
           exec sql select substr(to_char(to_date(:chr_l_last_gen_date),'YYYYMMDD'),1,8)
                   into :chr_last_gen_date
                   from dual;
           IS_ANY_ORA_ERROR
			 }
          strcpy((*p_STAT_VAL)[0].link_val,"DUMMY");
          strcpy((*p_STAT_VAL)[0].link_tag,"DUMMY");
          strcpy((*p_STAT_VAL)[1].link_val,"POSIT_DATE");
          strcpy((*p_STAT_VAL)[1].link_tag,chr_as_of_date);

          strcpy((*p_STAT_VAL)[2].link_val,"DOMSEC");
          strcpy((*p_STAT_VAL)[2].link_tag,chr_h_dom_instr);
          strcpy((*p_STAT_VAL)[3].link_val,"CBCODE");
          strcpy((*p_STAT_VAL)[3].link_tag,chr_h_citibank_acct_code);
          strcpy((*p_STAT_VAL)[4].link_val,"REPNOALLEG");
          strcpy((*p_STAT_VAL)[4].link_tag,chr_l_no_alleg);
          if(strlen(l_ms_msgent_structa_a.client) != 0)
          {
             strcpy((*p_STAT_VAL)[5].link_val,"PACCOUNT");
             strcpy((*p_STAT_VAL)[5].link_tag,l_ms_msgent_structa_a.client);
             if (int_noelem == 7)
            {
               strcpy((*p_STAT_VAL)[6].link_val,"CONTACTSEQ");
               strcpy((*p_STAT_VAL)[6].link_tag,chr_l_param[2]);
               strcpy((*p_STAT_VAL)[7].link_val,"NATION");
               strcpy((*p_STAT_VAL)[7].link_tag,g_mt_commonsys_params_struct_h.nation_code);
               strcpy((*p_STAT_VAL)[8].link_val,"WEEKLY_STM");
               strcpy((*p_STAT_VAL)[8].link_tag,chr_l_week_stm);
               strcpy((*p_STAT_VAL)[9].link_val,"LAST_GEN_DATE");
               strcpy((*p_STAT_VAL)[9].link_tag,chr_last_gen_date);
               strcpy((*p_STAT_VAL)[10].link_val,"");
               strcpy((*p_STAT_VAL)[10].link_tag,"");
            }
            else {
               strcpy((*p_STAT_VAL)[6].link_val,"NATION");
               strcpy((*p_STAT_VAL)[6].link_tag,g_mt_commonsys_params_struct_h.nation_code);
               strcpy((*p_STAT_VAL)[7].link_val,"");
               strcpy((*p_STAT_VAL)[7].link_tag,"");
               }
          }
          else
          {
             if (int_noelem == 7)
            {
             strcpy((*p_STAT_VAL)[5].link_val,"CONTACTSEQ");
             strcpy((*p_STAT_VAL)[5].link_tag,chr_l_param[2]);
             strcpy((*p_STAT_VAL)[6].link_val,"NATION");
             strcpy((*p_STAT_VAL)[6].link_tag,g_mt_commonsys_params_struct_h.nation_code);
             strcpy((*p_STAT_VAL)[7].link_val,"WEEKLY_STM");
             strcpy((*p_STAT_VAL)[7].link_tag,chr_l_week_stm);
             strcpy((*p_STAT_VAL)[8].link_val,"LAST_GEN_DATE");
             strcpy((*p_STAT_VAL)[8].link_tag,chr_last_gen_date);
             strcpy((*p_STAT_VAL)[9].link_val,"");
             strcpy((*p_STAT_VAL)[9].link_tag,"");
            }
            else {
            strcpy((*p_STAT_VAL)[5].link_val,"NATION");
            strcpy((*p_STAT_VAL)[5].link_tag,g_mt_commonsys_params_struct_h.nation_code);
            strcpy((*p_STAT_VAL)[6].link_val,"");
				strcpy((*p_STAT_VAL)[6].link_tag,"");
                  }
          }

          strcpy((*p_SEL_VAL)[0].link_val,"DOMESTIC_CPCLT");
          strcpy((*p_SEL_VAL)[1].link_val,"CP_CLT");
          strcpy((*p_SEL_VAL)[2].link_val,"IDENTIY_NO");
          strcpy((*p_SEL_VAL)[3].link_val,"CLIENT");
          strcpy((*p_SEL_VAL)[4].link_val,"UNIQ_IDENT_NO");
          strcpy((*p_SEL_VAL)[5].link_val,"");
          strcpy((*p_SEL_VAL)[5].link_tag,"");

   strcpy(chr_l_sel_msg_stmt,"SELECT c.IDENTIY_NO as PROC_INIT,c.IDENTIY_NO,c.client,concat(c.client,concat('||',c.IDENTIY_NO)) as ACC_REFNO,");
   strcat(chr_l_sel_msg_stmt,"substr(to_char(c.setl_date,'YYMMDD'),1,6) as setl_date,");
   strcat(chr_l_sel_msg_stmt,"c.deal_cd,b.INSTR_ISIN,b.instr_code,c.UNIQ_IDENT_NO as UNIQ_IDENT_NO,");
   strcat(chr_l_sel_msg_stmt,"substr(replace(replace(b.instr_name,chr(13),NULL),chr(10),NULL),1,35) as INSTR_NAME,ltrim(rtrim(nvl(c.domestic_cpclt,''))) AS DOMESTIC_CPCLT,c.cp_clt,");
   strcat(chr_l_sel_msg_stmt," decode(b.INSTR_TYPE,'BON',decode(a.CLN_FMT_RPTIND,'Y','FMT'");
   strcat(chr_l_sel_msg_stmt,",b.INSTR_TYPE),b.INSTR_TYPE) as FTYPEOFINSTR,decode(b.INSTR_TYPE,'BON',decode(a.FMT_RPTIND,'Y',to_char(c.QTY*b.NOMINAL_VALUE),c.QTY),c.QTY) as FENT_POS, c.COST,");
   strcat(chr_l_sel_msg_stmt," b.currency_cd,c.AMOUNT,b.currency_cd as CCYAMOUNT,c.net_amt, b.currency_cd as CCYNET_AMT,");

          strcat(chr_l_sel_msg_stmt," substr(translate(c.info,chr(10)||chr(13)||chr(9)||chr(24),' '),1,35) as NEW_NOTE1, ");
          strcat(chr_l_sel_msg_stmt," substr(translate(c.info,chr(10)||chr(13)||chr(9)||chr(24),' '),36,35) as NEW_NOTE2, ");
          strcat(chr_l_sel_msg_stmt," substr(translate(c.info,chr(10)||chr(13)||chr(9)||chr(24),' '),71,35) as NEW_NOTE3, ");
          strcat(chr_l_sel_msg_stmt," substr(translate(c.info,chr(10)||chr(13)||chr(9)||chr(24),' '),106,35) as NEW_NOTE4, ");
          strcat(chr_l_sel_msg_stmt," substr(translate(c.info,chr(10)||chr(13)||chr(9)||chr(24),' '),141,35) as NEW_NOTE5, ");
          strcat(chr_l_sel_msg_stmt," substr(translate(c.info,chr(10)||chr(13)||chr(9)||chr(24),' '),176,35) as NEW_NOTE6, ");
          strcat(chr_l_sel_msg_stmt," substr(translate(c.info,chr(10)||chr(13)||chr(9)||chr(24),' '),211,35) as NEW_NOTE7, ");
          strcat(chr_l_sel_msg_stmt," substr(translate(c.info,chr(10)||chr(13)||chr(9)||chr(24),' '),246,35) as NEW_NOTE8, ");
          strcat(chr_l_sel_msg_stmt," substr(translate(c.info,chr(10)||chr(13)||chr(9)||chr(24),' '),281,35) as NEW_NOTE9, ");
          strcat(chr_l_sel_msg_stmt," substr(translate(c.info,chr(10)||chr(13)||chr(9)||chr(24),' '),316,35) as NEW_NOTE10, ");

          strcat(chr_l_sel_msg_stmt," substr(translate(c.PARTY_CON,chr(10)||chr(13)||chr(9)||chr(24),' '),1,35) as PRTYCON1, ");
          strcat(chr_l_sel_msg_stmt," substr(translate(c.PARTY_CON,chr(10)||chr(13)||chr(9)||chr(24),' '),36,35) as PRTYCON2, ");
          strcat(chr_l_sel_msg_stmt," substr(translate(c.PARTY_CON,chr(10)||chr(13)||chr(9)||chr(24),' '),71,35) as PRTYCON3, ");
          strcat(chr_l_sel_msg_stmt," substr(translate(c.PARTY_CON,chr(10)||chr(13)||chr(9)||chr(24),' '),106,35) as PRTYCON4, ");
          

   strcat(chr_l_sel_msg_stmt," c.PLACEOF_DEAL as PL_OF_TRADE,");
   strcat(chr_l_sel_msg_stmt," c.MRKT_IND, c.description,");
   strcat(chr_l_sel_msg_stmt," c.DEAL_CLS," ); 
   strcat(chr_l_sel_msg_stmt," substr(to_char(c.access_stamp,'YYYYMMDDHH24MISS'),1,14) as NEW_PREP_DT,");
   strcat(chr_l_sel_msg_stmt," substr(to_char(c.setl_date,'YYYYMMDD'),1,8) as NEW_SETTLE_DT,");
   strcat(chr_l_sel_msg_stmt," substr(c.CP_CLTNAME,1,27) as NEW_COUNTACCNM,");
   strcat(chr_l_sel_msg_stmt," substr(to_char(c.proc_dt,'YYYYMMDD'),1,8) as DEAL_DATE,");
   strcat(chr_l_sel_msg_stmt," a.CLN_USE_ISIN_IND  as FLGISIN ,");
   strcat(chr_l_sel_msg_stmt," a.CLN_TAXABLE_IND as IND_83C83D,");
   strcat(chr_l_sel_msg_stmt," substr(replace(replace(a.cln_name,chr(13),NULL),chr(10),NULL),1,35)  as CLNT_NAME, 'N' as NOALLEG ,");
	strcat(chr_l_sel_msg_stmt,chr_l_as_of_date_586);
	strcat(chr_l_sel_msg_stmt," as ASOFDATE,");
	
	strcat(chr_l_sel_msg_stmt," c.DEAL_RF_IDENT as DEAL_RF_IDENT , c.COMMIDENT as COMMIDENT, c.POOL_REF as POOL_REF, c.DSN_REFCD AS DSN_REFCD" ); 

   strcat(chr_l_sel_msg_stmt," from MT_CLIENT a,MT_INSTRUMENT b,DL_MISDEAL c ");
   strcat(chr_l_sel_msg_stmt," where a.cln_code = c.client and ");
   strcat(chr_l_sel_msg_stmt," b.instr_code = c.instr_code ");
      if(strlen(l_ms_msgent_structa_a.client)!=0)
      {
         strcat(chr_l_sel_msg_stmt," and a.cln_code = '");
         strcat(chr_l_sel_msg_stmt,l_ms_msgent_structa_a.client);
         strcat(chr_l_sel_msg_stmt,"' ");
      }
   strcat(chr_l_sel_msg_stmt," and a.CLN_BRK_ALL != 'B' and a.STATUS != '");
   strcat(chr_l_sel_msg_stmt,STATUS_CLS_AUTH);
   strcat(chr_l_sel_msg_stmt,"' ");
   strcat(chr_l_sel_msg_stmt," and  c.CHECKER_DT is not null and to_date(to_char(c.CHECKER_DT,'DD/MM/YYYY')) = ");
   strcat(chr_l_sel_msg_stmt,"to_date(to_char(to_date('");
  strcat(chr_l_sel_msg_stmt,chr_as_of_date);
  strcat(chr_l_sel_msg_stmt,"'),'DD/MM/YYYY'))");
   strcat(chr_l_sel_msg_stmt," order by c.client,c.IDENTIY_NO");
   } 



			if(strcmp(p_msg_no,"538") == 0)
			{
				l_msgaddr = MINTRAPOSADV;
				if(strlen(l_ms_msgent_structa_a.proc_data) != 0)
				{
             	CO_SplitStr((*p_imsgent_struct).proc_data,
               	           ';', &int_noelem, &chr_l_param);

 	            strcpy(chr_as_of_date,chr_l_param[0]);
   	         strcpy(chr_l_no_locnchg,chr_l_param[1]);
				
					if(int_noelem >= 3)
						strcpy(chr_l_sellocnchg,chr_l_param[2]);
					if(int_noelem==7)
					{
					 strcpy(chr_l_week_stm,chr_l_param[6]);
					 strcpy(chr_l_last_gen_date,chr_l_param[5]);
					 strcat(chr_l_last_gen_date," 12:00:00");
					}
        		}
          	if(strlen(chr_as_of_date)== 0)
          	{
      			 APL_DATA_MISSING("AS OF DATE", APL_NULL_STRING, APL_NULL_STRING)
                APL_GOBACK_FAIL
          	}
          	if(strlen(chr_l_no_locnchg)== 0)
          	{
      			 APL_DATA_MISSING("NO LOC CHANGE", APL_NULL_STRING, APL_NULL_STRING)
                APL_GOBACK_FAIL
          	}

	          exec sql select substr(to_char(to_date(:chr_as_of_date),'YYMMDD'),1,6)
   	                into :chr_l_as_of_date
      	             from dual;
         	 IS_ANY_ORA_ERROR

				if (strcmp(chr_l_week_stm,"Y")==0)
				{
	           exec sql select substr(to_char(to_date(:chr_l_last_gen_date),'YYYYMMDD'),1,8)
   	                into :chr_last_gen_date
      	             from dual;
         	  IS_ANY_ORA_ERROR
				}
				*p_STAT_VAL = realloc(*p_STAT_VAL,sizeof(MS_STATIC_VAL)*9);
				*p_SEL_VAL = realloc(*p_SEL_VAL,sizeof(MS_STATIC_VAL)*4); 
          	
				strcpy((*p_STAT_VAL)[0].link_val,"DUMMY");
				strcpy((*p_STAT_VAL)[0].link_tag,"DUMMY");
				strcpy((*p_STAT_VAL)[1].link_val,"NOLOCCHG");
          	strcpy((*p_STAT_VAL)[1].link_tag,chr_l_no_locnchg);
          	strcpy((*p_STAT_VAL)[2].link_val,"ASOFDATE");
          	strcpy((*p_STAT_VAL)[2].link_tag,chr_l_as_of_date);
				if(strlen(l_ms_msgent_structa_a.client) != 0)
				{
          		strcpy((*p_STAT_VAL)[3].link_val,"PACCOUNT");
          		strcpy((*p_STAT_VAL)[3].link_tag,l_ms_msgent_structa_a.client);

             	if (int_noelem == 7)
            	{
               	strcpy((*p_STAT_VAL)[4].link_val,"CONTACTSEQ");
               	strcpy((*p_STAT_VAL)[4].link_tag,chr_l_param[2]);
               	strcpy((*p_STAT_VAL)[5].link_val,"NATION");
               	strcpy((*p_STAT_VAL)[5].link_tag,g_mt_commonsys_params_struct_h.nation_code);

               	strcpy((*p_STAT_VAL)[6].link_val,"WEEKLY_STM");
               	strcpy((*p_STAT_VAL)[6].link_tag,chr_l_week_stm);
               	strcpy((*p_STAT_VAL)[7].link_val,"LAST_GEN_DATE");
               	strcpy((*p_STAT_VAL)[7].link_tag,chr_last_gen_date);
               	strcpy((*p_STAT_VAL)[8].link_val,"");
               	strcpy((*p_STAT_VAL)[8].link_tag,"");
            	}
            	else 
					{
               	strcpy((*p_STAT_VAL)[4].link_val,"NATION");
               	strcpy((*p_STAT_VAL)[4].link_tag,g_mt_commonsys_params_struct_h.nation_code);
               	strcpy((*p_STAT_VAL)[5].link_val,"");
               	strcpy((*p_STAT_VAL)[5].link_tag,"");
               }
				}
          else
          {
             
             	if (int_noelem == 7)
            	{
             		strcpy((*p_STAT_VAL)[3].link_val,"CONTACTSEQ");
             		strcpy((*p_STAT_VAL)[3].link_tag,chr_l_param[2]);
             		strcpy((*p_STAT_VAL)[4].link_val,"NATION");
             		strcpy((*p_STAT_VAL)[4].link_tag,g_mt_commonsys_params_struct_h.nation_code);
             		strcpy((*p_STAT_VAL)[5].link_val,"WEEKLY_STM");
             		strcpy((*p_STAT_VAL)[5].link_tag,chr_l_week_stm);
             		strcpy((*p_STAT_VAL)[6].link_val,"LAST_GEN_DATE");
             		strcpy((*p_STAT_VAL)[6].link_tag,chr_last_gen_date);
             		strcpy((*p_STAT_VAL)[7].link_val,"");
             		strcpy((*p_STAT_VAL)[7].link_tag,"");
            	}
            	else 
					{
            		strcpy((*p_STAT_VAL)[3].link_val,"NATION");
            		strcpy((*p_STAT_VAL)[3].link_tag,g_mt_commonsys_params_struct_h.nation_code);
            		strcpy((*p_STAT_VAL)[4].link_val,"");
            		strcpy((*p_STAT_VAL)[4].link_tag,"");
                }
          }


         	strcpy((*p_SEL_VAL)[0].link_val,"CLIENT");
         	strcpy((*p_SEL_VAL)[1].link_val,"IDEN_NO");
         	strcpy((*p_SEL_VAL)[2].link_val,"UNIQ_IDENT_NO");
         	strcpy((*p_SEL_VAL)[3].link_val,"");
         	strcpy((*p_SEL_VAL)[3].link_tag,"");
				
           	strcpy(chr_l_sel_msg_stmt,"select a.client, a.iden_no,'Y' as LOCCHG,a.iden_no as PROC_INIT,b.CLN_USE_ISIN_IND as FLGISIN,");
           	strcat(chr_l_sel_msg_stmt,"decode(c.INSTR_TYPE,'BON',decode(b.CLN_FMT_RPTIND,'Y','FMT',");
           	strcat(chr_l_sel_msg_stmt,"c.INSTR_TYPE),c.INSTR_TYPE) as FTYPEOFINSTR,a.UNIQ_IDENT_NO as UNIQ_IDENT_NO,");
           	strcat(chr_l_sel_msg_stmt,"decode(c.INSTR_TYPE,'BON',decode(b.CLN_FMT_RPTIND,'Y',to_char(a.QTY*c.NOMINAL_VALUE),a.QTY),a.QTY) as FENT_POS,");
           	strcat(chr_l_sel_msg_stmt,"c.INSTR_ISIN, a.instr_code, substr(replace(replace(c.instr_name,chr(13),NULL),chr(10),NULL),1,31) as INSTR_NAME,");
           	strcat(chr_l_sel_msg_stmt,"concat('/',a.client) as NACCOUNT, substr(replace(replace(b.cln_name,chr(13) ,NULL),chr(10),NULL),1,35) as CLNT_NAME, substr(replace(replace(b.cln_name,chr(13),NULL),chr(10),NULL),36,20) as CNAME1,");
           	strcat(chr_l_sel_msg_stmt,"c.currency_cd as SECCCY,");
			
           	strcat(chr_l_sel_msg_stmt,"substr(to_char(a.setl_date,'YYYYMMDD'),1,8) as NEW_SETTLEDT");
           	strcat(chr_l_sel_msg_stmt,",d.ISO_LOCNCD as FROM_ISO_LOCNCODE");
           	strcat(chr_l_sel_msg_stmt," , substr(to_char(to_date('");
         	strcat(chr_l_sel_msg_stmt,chr_l_as_of_date);
         	strcat(chr_l_sel_msg_stmt,"','RRMMDD'),'YYYYMMDD'),1,8) as NEW_ASOFDATE ");
            strcat(chr_l_sel_msg_stmt,",e.ISO_LOCNCD as TO_ISO_LOCNCODE");
				strcat(chr_l_sel_msg_stmt,",CONCAT(a.client,CONCAT('|',a.iden_no)) as F_T_LOCN ");
				strcat(chr_l_sel_msg_stmt,",CONCAT(a.instr_code,CONCAT('|',d.ISO_LOCNCD)) as INSTR_CODE_FLOC ");
            strcat(chr_l_sel_msg_stmt," from DL_LOCNCHG a, MT_CLIENT b, MT_INSTRUMENT c,MT_LOCATION d, MT_LOCATION e");
            strcat(chr_l_sel_msg_stmt," where a.client = b.cln_code and a.instr_code = c.INSTR_CODE");
            strcat(chr_l_sel_msg_stmt,"  and a.FRM_LOC = d.location_cd(+) and a.TO_LOCATION = e.LOCATION_CD");
				strcat(chr_l_sel_msg_stmt,"  and d.ISO_LOCNCD <> e.ISO_LOCNCD");

          if(strlen(l_ms_msgent_structa_a.client) != 0)
          {
            strcat(chr_l_sel_msg_stmt," and a.client = '");
         	strcat(chr_l_sel_msg_stmt,l_ms_msgent_structa_a.client);
            strcat(chr_l_sel_msg_stmt,"'");
          }
            strcat(chr_l_sel_msg_stmt," and a.checker_dt is not null ");
            strcat(chr_l_sel_msg_stmt," and b.STATUS != '");
                        strcat(chr_l_sel_msg_stmt,STATUS_CLS_AUTH);
         	strcat(chr_l_sel_msg_stmt,"'");
				if(strcmp(chr_l_week_stm,"Y") != 0)
				{
					strcat(chr_l_sel_msg_stmt," and a.LOC_CHNG_STAT IN ('");
            	strcat(chr_l_sel_msg_stmt,STATUS_LOCCHNG);
            	strcat(chr_l_sel_msg_stmt,"','");
					strcat(chr_l_sel_msg_stmt,INTLOC_CHNG_STAT);
					strcat(chr_l_sel_msg_stmt,"')");
				}
				if(strcmp(chr_l_week_stm,"Y")==0)
				{
					strcat(chr_l_sel_msg_stmt," and a.checker_dt <='");
					strcat(chr_l_sel_msg_stmt,chr_as_of_date);
					strcat(chr_l_sel_msg_stmt,"'");
					strcat(chr_l_sel_msg_stmt," and a.checker_dt > '");
					strcat(chr_l_sel_msg_stmt,chr_l_last_gen_date );
					strcat(chr_l_sel_msg_stmt,"'" );
				}
            strcat(chr_l_sel_msg_stmt,"  order by a.client,a.instr_code,a.setl_date,a.FRM_LOC");
		}
        if(strcmp(p_msg_no,"539") == 0)
        {
          l_msgaddr = MADVRECDELMSGNO;       
          if(strlen(l_ms_msgent_structa_a.proc_data) != 0)
          {
             CO_SplitStr(l_ms_msgent_structa_a.proc_data,
                          ';', &int_noelem, &chr_l_param);
             strcpy(chr_as_of_date,chr_l_param[0]);
          }

          *p_STAT_VAL = realloc(*p_STAT_VAL,sizeof(MS_STATIC_VAL)*6); 
          *p_SEL_VAL = realloc(*p_SEL_VAL,sizeof(MS_STATIC_VAL)*19); /* VaibhavK I-Solve:361 10-Dec-2007 */

          strcpy((*p_STAT_VAL)[0].link_val,"DUMMY");
          strcpy((*p_STAT_VAL)[0].link_tag,"DUMMY");
          strcpy((*p_STAT_VAL)[1].link_val,"DOMSEC");
          strcpy((*p_STAT_VAL)[1].link_tag,chr_h_dom_instr);
          strcpy((*p_STAT_VAL)[2].link_val,"DATE");
          strcpy((*p_STAT_VAL)[2].link_tag,chr_as_of_date);
          strcpy((*p_STAT_VAL)[3].link_val,"NATION");
          strcpy((*p_STAT_VAL)[3].link_tag,h_nation_code);
			 strcpy((*p_STAT_VAL)[4].link_val,"CNTRY_BIC");
			 strcpy((*p_STAT_VAL)[4].link_tag,l_mt_message_sys_params_struct_h.swift_cd);
          strcpy((*p_STAT_VAL)[5].link_val,"");
          strcpy((*p_STAT_VAL)[5].link_tag,"");

          strcpy((*p_SEL_VAL)[0].link_val,"DOMESTIC_CPCLT");
          strcpy((*p_SEL_VAL)[1].link_val,"DEAL_CD");
          strcpy((*p_SEL_VAL)[2].link_val,"cln_master");
          strcpy((*p_SEL_VAL)[3].link_val,"INSTRUMENT_DT");

			 

          strcpy((*p_SEL_VAL)[4].link_val,"FAILREASON_CD");
   		 
			 strcpy((*p_SEL_VAL)[5].link_val,"CLIENT");
			 strcpy((*p_SEL_VAL)[6].link_val,"PROC_INIT");
			 strcpy((*p_SEL_VAL)[7].link_val,"PARTIAL_IND_B"); /* VaibhavK I-Solve:361 10-Dec-2007 */
			 strcpy((*p_SEL_VAL)[8].link_val,"SUB_FAIL_CD"); 
			 strcpy((*p_SEL_VAL)[9].link_val,"NCOUNTACC");
			 strcpy((*p_SEL_VAL)[10].link_val,"CLIENTOF_CD");
			 strcpy((*p_SEL_VAL)[11].link_val,"CP_CLTNAME");
			 strcpy((*p_SEL_VAL)[12].link_val,"NEW_ACCOUNTOF1");
			 strcpy((*p_SEL_VAL)[13].link_val,"UNIQREFNO");
			 strcpy((*p_SEL_VAL)[14].link_val,"NCOUNTACC");
			 strcpy((*p_SEL_VAL)[15].link_val,"EXCH_CODE");
			 strcpy((*p_SEL_VAL)[16].link_val,"FTYPEOFINSTR"); /* VaibhavK I-Solve:361 10-Dec-2007 Start*/
			 strcpy((*p_SEL_VAL)[17].link_val,"NEW_NOMVAL");

			 strcpy((*p_SEL_VAL)[18].link_val,"");
			 strcpy((*p_SEL_VAL)[18].link_tag,""); /* VaibhavK I-Solve:361 10-Dec-2007 Start*/


          strcat(chr_l_sel_msg_stmt,"SELECT c.client,c.IDENTIY_NO,concat('/',a.cln_master) as cln_master,a.cln_master,");
          strcat(chr_l_sel_msg_stmt,"c.deal_cd,c.IDENTIY_NO as PROC_INIT,c.ORIG_REFNO,");
/* ISKB 660 Chirag 26022008 */
          /*commented by Chirag strcat(chr_l_sel_msg_stmt,"c.INSTRUMENT_DT,substr(to_char(c.MONEY_SETL_DT,'YYMMDD'),1,6) as MONEY_SETL_DT,b.INSTR_ISIN,c.instr_code,decode(c.lcl_identno,NULL,NULL,c.lcl_identno) as LCL_IDENTNO,c.UNIQ_IDENT_NO as UNIQREFNO,");*/
          strcat(chr_l_sel_msg_stmt,"c.INSTRUMENT_DT,substr(to_char(c.MONEY_SETL_DT,'YYMMDD'),1,6) as MONEY_SETL_DT,b.INSTR_ISIN,c.instr_code,decode(c.lcl_identno,NULL,NULL,c.lcl_identno) as LCL_IDENTNO,");
	  strcat(chr_l_sel_msg_stmt,"c.UNIQ_IDENT_NO||lpad(to_char(decode(c.cnt_548,99,0,(nvl(c.cnt_548,0)+1))),2,'0') as UNIQREFNO,");
/* ISKB 660 Chirag 26022008 */
	  strcat(chr_l_sel_msg_stmt," decode(b.INSTR_TYPE,'BON',decode(a.CLN_FMT_RPTIND,'Y','FMT'");
	  strcat(chr_l_sel_msg_stmt,",b.INSTR_TYPE),b.INSTR_TYPE) as FTYPEOFINSTR,decode(b.INSTR_TYPE,'BON',decode(a.CLN_FMT_RPTIND,'Y',to_char(c.QTY*b.NOMINAL_VALUE),c.QTY),c.QTY) as FENT_POS,b.NOMINAL_VALUE as NEW_NOMVAL,b.NOMINAL_VALUE as NOMINAL_VALUE,");
          strcat(chr_l_sel_msg_stmt," b.currency_cd,c.AMOUNT,b.currency_cd as CCYAMOUNT,c.net_amt, b.currency_cd as CCYNET_AMT,");
          strcat(chr_l_sel_msg_stmt," a.CLN_USE_ISIN_IND  as FLGISIN, ");

			 
			 

          strcat(chr_l_sel_msg_stmt," c.failreason_cd as FAILREASON_CD, c.cp_clt as CP_CLT, c.sub_fail_cd, ");
			 
          strcat(chr_l_sel_msg_stmt,"substr(replace(replace(b.instr_name,chr(13),NULL),chr(10),NULL),1,31) as INSTR_NAME,c.domestic_cpclt,");
			 
			 
			 strcat(chr_l_sel_msg_stmt," a.CLN_TAXABLE_IND as IND_83C83D");
			 
         
			strcat(chr_l_sel_msg_stmt,",decode(c.QTY,c.ORIG_QTY,NULL,'COMPLETE') as COMPLETE");
			strcat(chr_l_sel_msg_stmt,",b.currency_cd as SECCCY,c.PARTIAL_IND_B,decode(c.domestic_cpclt,'");
			strcat(chr_l_sel_msg_stmt,chr_h_citibank_acct_code);
			strcat(chr_l_sel_msg_stmt,"','Y','N') as IS_CT_DOMCPAC");
			strcat(chr_l_sel_msg_stmt,",c.COST");
			strcat(chr_l_sel_msg_stmt,",b.currency_cd as CCYCOST");
			strcat(chr_l_sel_msg_stmt,",c.CP_CLT");
			strcat(chr_l_sel_msg_stmt,",c.cp_clt as NCOUNTACC,c.exch_code, c.mkt_type, c.clh_flg,c.contract_cd,c.interfii_flg  ");
			strcat(chr_l_sel_msg_stmt,",substr(to_char(c.INSTRUMENT_DT,'YYYYMMDD'),1,8) as NEW_AINSTR_DT");
			strcat(chr_l_sel_msg_stmt,",substr(to_char(c.MONEY_SETL_DT,'YYYYMMDD'),1,8) as NEW_MONEYDT");
			strcat(chr_l_sel_msg_stmt,",substr(to_char(c.setl_date,'YYYYMMDD'),1,8) as NEW_SETTLEDT");
			strcat(chr_l_sel_msg_stmt,",substr(to_char(c.deal_date,'YYYYMMDD'),1,8) as NEW_TRDATE");
			
			strcat(chr_l_sel_msg_stmt,",upper(decode(substr(replace(replace(c.CP_CLTNAME,chr(13),NULL),chr(10),NULL),1,1),'/',substr(replace(replace(c.CP_CLTNAME,chr(13),NULL),chr(10),NULL),2,34),");


			strcat(chr_l_sel_msg_stmt,"substr(replace(replace(c.CP_CLTNAME,chr(13),NULL),chr(10),NULL),1,35))) as CP_CLTNAME ");
			
			strcat(chr_l_sel_msg_stmt," ,decode(ltrim(rtrim(substr(c.clientof,1,35))),NULL,NULL,ltrim(rtrim(substr(c.clientof,1,35)))) as NEW_ACCOUNTOF1  ");
			strcat(chr_l_sel_msg_stmt," ,decode(ltrim(rtrim(substr(c.clientof,36,30))),NULL,NULL,ltrim(rtrim(substr(c.clientof,36,30)))) as NEW_ACCOUNTOF2  ");
			strcat(chr_l_sel_msg_stmt," ,decode(ltrim(rtrim(substr(c.INSTRUCT_PERSONNM,1,35))),NULL,NULL,ltrim(rtrim(substr(c.INSTRUCT_PERSONNM,1,35)))) as INSTPARTYNM1  ");
			strcat(chr_l_sel_msg_stmt," ,decode(ltrim(rtrim(substr(c.INSTRUCT_PERSONNM,36,30))),NULL,NULL,ltrim(rtrim(substr(c.INSTRUCT_PERSONNM,36,30)))) as INSTPARTYNM2  ");
			
			
			strcat(chr_l_sel_msg_stmt," ,decode(c.dl_class,'27','26','29','26',c.dl_class) as DL_CLASS ");
								  
                        strcat(chr_l_sel_msg_stmt," ,c.CLIENTOF_CD, c.INTER_MED_PERSON, c.INSTRUCT_PERSON as INSTPRTY, c.ENTRY ");
		        strcat(chr_l_sel_msg_stmt," ,decode(ltrim(rtrim(substr(c.INTER_MED_PERSONNM,1,35))),NULL,NULL,ltrim(rtrim(substr(c.INTER_MED_PERSONNM,1,35)))) as INTER_MED_PERSONNM1 ");
		        strcat(chr_l_sel_msg_stmt," ,decode(ltrim(rtrim(substr(c.INTER_MED_PERSONNM,36,60))),NULL,NULL,ltrim(rtrim(substr(c.INTER_MED_PERSONNM,36,60)))) as INTER_MED_PERSONNM2 ");
			
          strcat(chr_l_sel_msg_stmt," FROM MT_CLIENT a,MT_INSTRUMENT b,dl_deal c");
          strcat(chr_l_sel_msg_stmt," WHERE c.client = a.cln_code and ");
			 		
			 if (strlen(l_ms_msgent_structa_a.client) != 0)
			 {
			 strcat(chr_l_sel_msg_stmt,"a.cln_code = '");
			 strcat(chr_l_sel_msg_stmt,l_ms_msgent_structa_a.client);
			 strcat(chr_l_sel_msg_stmt,"' and ");
			 }
			 if (strlen(l_ms_msgent_structa_a.proc_init)!=0)
			 {
				 strcat(chr_l_sel_msg_stmt,"c.identiy_no ='");
			 		strcat(chr_l_sel_msg_stmt,l_ms_msgent_structa_a.proc_init);
					strcat(chr_l_sel_msg_stmt,"' and ");
			 }		
          strcat(chr_l_sel_msg_stmt," a.CLN_BRK_ALL != 'B' and a.checker is not null ");
          strcat(chr_l_sel_msg_stmt," and a.STATUS != '");
          strcat(chr_l_sel_msg_stmt,STATUS_CLS_AUTH);

          strcat(chr_l_sel_msg_stmt,"' and c.instr_code = b.instr_code and ");

			strcat(chr_l_sel_msg_stmt," instr(nvl(c.MSG_STAT,' '),'");
			strcat(chr_l_sel_msg_stmt,MSG_FLG_539);
			strcat(chr_l_sel_msg_stmt,"') = 0  ");


			
          strcat(chr_l_sel_msg_stmt," and (c.deal_cd = 3 or c.deal_cd = 4 or c.deal_cd = 7 or c.deal_cd = 8)  and ");
          strcat(chr_l_sel_msg_stmt,"  ((c.INSTRUMENT_DT <= to_date('");
          strcat(chr_l_sel_msg_stmt,(*p_STAT_VAL)[2].link_tag);
          strcat(chr_l_sel_msg_stmt,"') and c.MONEY_SETL_DT is null) or (c.MONEY_SETL_DT <= to_date('");
          strcat(chr_l_sel_msg_stmt,(*p_STAT_VAL)[2].link_tag);
          strcat(chr_l_sel_msg_stmt,"') and c.INSTRUMENT_DT is null) or (c.MONEY_SETL_DT <= to_date('");
          strcat(chr_l_sel_msg_stmt,(*p_STAT_VAL)[2].link_tag);
          strcat(chr_l_sel_msg_stmt,"') and c.INSTRUMENT_DT > to_date('");
          strcat(chr_l_sel_msg_stmt,(*p_STAT_VAL)[2].link_tag);
          strcat(chr_l_sel_msg_stmt,"')) or (c.INSTRUMENT_DT <= to_date('");
          strcat(chr_l_sel_msg_stmt, (*p_STAT_VAL)[2].link_tag);
          strcat(chr_l_sel_msg_stmt,"') and c.MONEY_SETL_DT > to_date('");
          strcat(chr_l_sel_msg_stmt,(*p_STAT_VAL)[2].link_tag);
          strcat(chr_l_sel_msg_stmt,"')))");
        }
        if(strcmp(p_msg_no,"599PFR") == 0)
        {
          l_msgaddr = MPORTFOLRATIOMSGNO;       
          if(strlen(l_ms_msgent_structa_a.proc_data) != 0)
          {
             CO_SplitStr(l_ms_msgent_structa_a.proc_data,
                          ';', &int_noelem, &chr_l_param);
             strcpy(chr_as_of_date,chr_l_param[0]);
             strcpy(chr_l_rep_ccy,chr_l_param[1]);
             strcpy(chr_l_mast_sub_rep,chr_l_param[2]);
             strcpy(chr_l_send,chr_l_param[3]);
          }
          if(strlen(chr_as_of_date)==0)
          {
		APL_DATA_MISSING("AS OF DATE", APL_NULL_STRING, APL_NULL_STRING)
                APL_GOBACK_FAIL
          }
          if(strlen(chr_l_rep_ccy)==0)
          {
		APL_DATA_MISSING("REPORTING MT_CURRENCY", APL_NULL_STRING, APL_NULL_STRING)
                APL_GOBACK_FAIL
          }
          if(strlen(chr_l_mast_sub_rep)==0)
          {
		APL_DATA_MISSING("MASTER/SUB A/C REPORTING", APL_NULL_STRING, APL_NULL_STRING)
                APL_GOBACK_FAIL
          }
          if(strlen(chr_l_send)==0)
          {
		APL_DATA_MISSING("SEND TO F/L/B", APL_NULL_STRING, APL_NULL_STRING)
                APL_GOBACK_FAIL
          }

          *p_STAT_VAL = realloc(*p_STAT_VAL,sizeof(MS_STATIC_VAL)*8); 
          *p_SEL_VAL = realloc(*p_SEL_VAL,sizeof(MS_STATIC_VAL)*5); 

          exec sql select substr(to_char(to_date(:chr_as_of_date),'DD/MM/YYYY'),1,6) 
                   into :chr_l_as_of_date
                   from dual;
          IS_ANY_ORA_ERROR


          strcpy((*p_STAT_VAL)[0].link_val,"DUMMY");
          strcpy((*p_STAT_VAL)[0].link_tag,"DUMMY");
          strcpy((*p_STAT_VAL)[1].link_val,"ASOFDATE");
          strcpy((*p_STAT_VAL)[1].link_tag,chr_as_of_date);
          strcpy((*p_STAT_VAL)[2].link_val,"REP_CCY");
          strcpy((*p_STAT_VAL)[2].link_tag,chr_l_rep_ccy);
          strcpy((*p_STAT_VAL)[3].link_val,"DOMCCY");
          strcpy((*p_STAT_VAL)[3].link_tag,chr_h_dom_ccycode);
          strcpy((*p_STAT_VAL)[4].link_val,"MSUBREP");
          strcpy((*p_STAT_VAL)[4].link_tag,chr_l_mast_sub_rep);
          strcpy((*p_STAT_VAL)[5].link_val,"CA_NAME");
          strcpy((*p_STAT_VAL)[5].link_tag,chr_h_corporate_name);
          strcpy((*p_STAT_VAL)[6].link_val,"SASOFDATE");
          strcpy((*p_STAT_VAL)[6].link_tag,chr_l_as_of_date);
          strcpy((*p_STAT_VAL)[7].link_val,"");
          strcpy((*p_STAT_VAL)[7].link_tag,"");

          strcpy((*p_SEL_VAL)[0].link_val,"PMSTACC");
          strcpy((*p_SEL_VAL)[1].link_val,"DUMMY");
          strcpy((*p_SEL_VAL)[2].link_val,"cln_master");
          strcpy((*p_SEL_VAL)[3].link_val,"UNIQREFNO");
          strcpy((*p_SEL_VAL)[4].link_val,"");
          strcpy((*p_SEL_VAL)[4].link_tag,"");

          strcpy(chr_l_sel_msg_stmt,"select c.cln_master  as cln_master, 'DUMMY' as PROC_INIT , c.CLN_SHORTNM as ALPHACODE,'");
			 strcat(chr_l_sel_msg_stmt,chr_new_unique_ref_num);  
			 strcat(chr_l_sel_msg_stmt,"' as UNIQREFNO from MT_CLIENT c where c.cln_code = ");
          strcat(chr_l_sel_msg_stmt,"ANY(select distinct(b.cln_master)  from ");
          strcat(chr_l_sel_msg_stmt," DL_SAFEK a, MT_CLIENT b where a.client = b.cln_code and a.safekeep_pos > 0  and b.checker is not null ");
	  strcat(chr_l_sel_msg_stmt," and b.STATUS != '");
          strcat(chr_l_sel_msg_stmt,STATUS_CLS_AUTH);
          strcat(chr_l_sel_msg_stmt,"' ");
          if(strcmp(chr_l_send,"F")==0)
          	strcat(chr_l_sel_msg_stmt," and b.CLN_DOMICILE = 2 and b.CLN_BRK_ALL != 'B' ");
          else if(strcmp(chr_l_send,"L")==0)
          	strcat(chr_l_sel_msg_stmt," and b.CLN_DOMICILE = 1 and b.CLN_BRK_ALL != 'B' and b.CLN_ORD_CLT != 'B' ");
          else
          	strcat(chr_l_sel_msg_stmt," and (b.CLN_ORD_CLT != 'B' or (b.CLN_ORD_CLT = 'B' and b.CLN_DOMICILE = 2)) and b.CLN_BRK_ALL != 'B' ");
          if(strlen(l_ms_msgent_structa_a.client)!=0)
          {
		strcat(chr_l_sel_msg_stmt," and b.cln_master = '");
                strcat(chr_l_sel_msg_stmt,l_ms_msgent_structa_a.client);
                strcat(chr_l_sel_msg_stmt,"' ");
          }

          strcat(chr_l_sel_msg_stmt," and EXISTS ");
          strcat(chr_l_sel_msg_stmt," (SELECT 1 ");
          strcat(chr_l_sel_msg_stmt," FROM MT_MSGADDRESS c where c.cln_code = b.cln_master AND ");
          strcat(chr_l_sel_msg_stmt," c.MSG_IDENT_NO = '");
          strcat(chr_l_sel_msg_stmt,ltoa(l_msgaddr));
          strcat(chr_l_sel_msg_stmt,"'  ))");
        }
        
        if(strcmp(p_msg_no,"599CPJ") == 0)
        {
          l_msgaddr = MCASHPROJMSGNO;       
          if(strlen(l_ms_msgent_structa_a.proc_data) != 0)
          {
             CO_SplitStr(l_ms_msgent_structa_a.proc_data,
                          ';', &int_noelem, &chr_l_param);
             strcpy(chr_as_of_date,chr_l_param[0]);
          }

          if(strlen(chr_as_of_date)==0)
          {
		APL_DATA_MISSING("AS OF DATE", APL_NULL_STRING, APL_NULL_STRING)
                APL_GOBACK_FAIL
          }
              
          *p_STAT_VAL = realloc(*p_STAT_VAL,sizeof(MS_STATIC_VAL)*7); 
          *p_SEL_VAL = realloc(*p_SEL_VAL,sizeof(MS_STATIC_VAL)*11);
				

          strcpy((*p_STAT_VAL)[0].link_val,"DUMMY");
          strcpy((*p_STAT_VAL)[0].link_tag,"DUMMY");
          strcpy((*p_STAT_VAL)[1].link_val,"DOMCCY");
          strcpy((*p_STAT_VAL)[1].link_tag,chr_h_dom_ccycode);
          strcpy((*p_STAT_VAL)[2].link_val,"ASOFDATE");
          strcpy((*p_STAT_VAL)[2].link_tag,chr_as_of_date);
          strcpy((*p_STAT_VAL)[3].link_val,"DATE");
          strcpy((*p_STAT_VAL)[3].link_tag,chr_h_msys_date);
          strcpy((*p_STAT_VAL)[4].link_val,"CA_NAME");
          strcpy((*p_STAT_VAL)[4].link_tag,chr_h_corporate_name);
          strcpy((*p_STAT_VAL)[5].link_val,"SUBACCT");
          strcpy((*p_STAT_VAL)[5].link_tag,chr_h_sub_acct_processing);
          strcpy((*p_STAT_VAL)[6].link_val,"");
          strcpy((*p_STAT_VAL)[6].link_tag,"");

          strcpy((*p_SEL_VAL)[0].link_val,"C3TOT");
          strcpy((*p_SEL_VAL)[1].link_val,"C4TOT");
          strcpy((*p_SEL_VAL)[2].link_val,"cln_master");
          strcpy((*p_SEL_VAL)[3].link_val,"P3TOT");
          strcpy((*p_SEL_VAL)[4].link_val,"P4TOT");
          strcpy((*p_SEL_VAL)[5].link_val,"S3TOT");
          strcpy((*p_SEL_VAL)[6].link_val,"S4TOT");
          strcpy((*p_SEL_VAL)[7].link_val,"CURRENCY_CD");
          strcpy((*p_SEL_VAL)[8].link_val,"DOTTEDLINE");
          strcpy((*p_SEL_VAL)[9].link_val,"UNIQREFNO"); 
          strcpy((*p_SEL_VAL)[10].link_val,"");
          strcpy((*p_SEL_VAL)[10].link_tag,"");

	  strcpy(chr_l_sel_msg_stmt,"select a.client,to_char(sum(decode(a.VAL_FDT,NULL,decode(a.deal_cd,3,a.AMOUNT,0),0))) as P3TOT,'DUMMY' as PROC_INIT,'3' as DECP3TOT,");
	  strcat(chr_l_sel_msg_stmt,"to_char(sum(decode(a.VAL_FDT,NULL,decode(a.deal_cd,4,a.AMOUNT,0),0))) as P4TOT,'3' as DECP4TOT,");
	  strcat(chr_l_sel_msg_stmt,"to_char(sum(decode(a.VAL_FDT,NULL,0,decode(a.INSTRUMENT_DT,NULL,decode(a.deal_cd,3,a.AMOUNT,0),0)))) as C3TOT,'3' as DECC3TOT,");
	  strcat(chr_l_sel_msg_stmt,"to_char(sum(decode(a.VAL_FDT,NULL,0,decode(a.INSTRUMENT_DT,NULL,decode(a.deal_cd,4,a.AMOUNT,0),0)))) as C4TOT,'3' as DECC4TOT,");
	  strcat(chr_l_sel_msg_stmt,"to_char(sum(decode(a.VAL_FDT,NULL,0,decode(a.INSTRUMENT_DT,NULL,0,decode(a.deal_cd,3,a.AMOUNT,0))))) as S3TOT,'3' as DECS3TOT,");
	  strcat(chr_l_sel_msg_stmt,"to_char(sum(decode(a.VAL_FDT,NULL,0,decode(a.INSTRUMENT_DT,NULL,0,decode(a.deal_cd,4,a.AMOUNT,0))))) as S4TOT,b.currency_cd,'3' as DECS4TOT , ");
          strcat(chr_l_sel_msg_stmt," concat(concat(substr(replace(replace(c.cln_name,chr(13),NULL),chr(10),NULL),1,35),' '),substr(replace(replace(c.cln_name,chr(13),NULL),chr(10),NULL),36,20)) as CLNT_NAME,c.cln_master as cln_master,c.CLN_SHORTNM as ALPHACODE,a.UNIQ_IDENT_NO as UNIQREFNO "); 
	  strcat(chr_l_sel_msg_stmt," from dl_deal a,MT_INSTRUMENT b,MT_CLIENT c ");
	  strcat(chr_l_sel_msg_stmt," where a.checker is not null and a.MONEY_SETL_DT is null and");
      	  strcat(chr_l_sel_msg_stmt," a.setl_date = '");
          strcat(chr_l_sel_msg_stmt,chr_as_of_date);
      	  strcat(chr_l_sel_msg_stmt,"' and a.instr_code = b.instr_code and b.INSTR_TYPE != 'BON' and a.client = c.cln_code and ");
          strcat(chr_l_sel_msg_stmt," c.CLN_BRK_ALL != 'B' and c.checker is not null ");
	  strcat(chr_l_sel_msg_stmt," and c.STATUS != '");
	  strcat(chr_l_sel_msg_stmt,STATUS_CLS_AUTH);
      	  strcat(chr_l_sel_msg_stmt,"' and a.deal_cd in (3,4,7,8)");
          if(strlen(l_ms_msgent_structa_a.client)!=0)
          {
		strcat(chr_l_sel_msg_stmt," and a.client = '");
                strcat(chr_l_sel_msg_stmt,l_ms_msgent_structa_a.client);
                strcat(chr_l_sel_msg_stmt,"' ");
          }

	  strcat(chr_l_sel_msg_stmt," group by a.client,c.cln_master,b.currency_cd,c.cln_name,c.CLN_SHORTNM,a.UNIQ_IDENT_NO");
        }

        if(strcmp(p_msg_no,"599CBT") == 0)
        {
          l_msgaddr = MCANBLOCKTRDMSGNO;       
          *p_STAT_VAL = realloc(*p_STAT_VAL,sizeof(MS_STATIC_VAL)*6); 
          *p_SEL_VAL = realloc(*p_SEL_VAL,sizeof(MS_STATIC_VAL)*5); 
		

          strcpy((*p_STAT_VAL)[0].link_val,"DUMMY");
          strcpy((*p_STAT_VAL)[0].link_tag,"DUMMY");
          strcpy((*p_STAT_VAL)[1].link_val,"DATE");
          strcpy((*p_STAT_VAL)[1].link_tag,h_sys_dt);
          strcpy((*p_STAT_VAL)[2].link_val,"DOMSEC");
          strcpy((*p_STAT_VAL)[2].link_tag,chr_h_dom_instr);
          strcpy((*p_STAT_VAL)[3].link_val,"DOMCCY");
          strcpy((*p_STAT_VAL)[3].link_tag,chr_h_dom_ccycode);
          strcpy((*p_STAT_VAL)[4].link_val,"CA_NAME");
          strcpy((*p_STAT_VAL)[4].link_tag,chr_h_corporate_name);
          strcpy((*p_STAT_VAL)[5].link_val,"");
          strcpy((*p_STAT_VAL)[5].link_tag,"");

          strcpy((*p_SEL_VAL)[0].link_val,"DOMESTIC_CPCLT");
          strcpy((*p_SEL_VAL)[1].link_val,"cln_master");
          strcpy((*p_SEL_VAL)[2].link_val,"UNIQREFNO");
          strcpy((*p_SEL_VAL)[3].link_val,"");
          strcpy((*p_SEL_VAL)[3].link_tag,"");
          strcpy((*p_SEL_VAL)[4].link_val,"");
          strcpy((*p_SEL_VAL)[4].link_tag,"");

	  strcpy(chr_l_sel_msg_stmt,"select a.client,substr(replace(replace(b.cln_name,chr(13),NULL),chr(10),NULL),1,49) as CLNT_NAME, 'DUMMY' as PROC_INIT,a.UNIQ_IDENT_NO as UNIQREFNO,");
	  strcat(chr_l_sel_msg_stmt,"substr(replace(replace(b.cln_name,chr(13),NULL),chr(10),NULL),36,35) as TCNAME1, a.IDENTIY_NO,a.domestic_cpclt,");
	  strcat(chr_l_sel_msg_stmt,"decode(a.deal_cd,1,'DF   ',decode(a.deal_cd,2,'RF   ',decode(a.deal_cd,3,'DVP  ',decode(a.deal_cd,5,'DF   ',decode(a.deal_cd,6,'RF   ',decode(a.deal_cd,7,'DVP  ','RVP  ')))))) as trcodedesc,");
	  strcat(chr_l_sel_msg_stmt,"b.CLN_USE_ISIN_IND as FLGISIN, c.INSTR_ISIN, a.instr_code, substr(replace(replace(c.instr_name,chr(13),NULL),chr(10),NULL),1,30) as INSTR_NAME, substr(to_char(a.deal_date,'yymmdd'),1,6) as deal_date,");
	  strcat(chr_l_sel_msg_stmt,"substr(to_char(a.setl_date,'yymmdd'),1,6) as setl_date, a.QTY, a.AMOUNT,c.currency_cd as CCYAMOUNT,c.currency_cd as SECCCY,");
	  strcat(chr_l_sel_msg_stmt,"b.cln_master from dl_deal a,MT_CLIENT b,MT_INSTRUMENT c where a.client = b.cln_code and a.instr_code = c.instr_code and a.dl_class = 99 and");
	  strcat(chr_l_sel_msg_stmt," a.failreason_cd = 13 ");
          if(strlen(l_ms_msgent_structa_a.client)!=0)
          {
		strcat(chr_l_sel_msg_stmt," and a.client = '");
                strcat(chr_l_sel_msg_stmt,l_ms_msgent_structa_a.client);
                strcat(chr_l_sel_msg_stmt,"' ");
          }
          strcat(chr_l_sel_msg_stmt," and b.CLN_BRK_ALL != 'B' and b.checker is not null ");
	  strcat(chr_l_sel_msg_stmt," and b.STATUS != '");
	  strcat(chr_l_sel_msg_stmt,STATUS_CLS_AUTH);

          strcat(chr_l_sel_msg_stmt,"' ");
        }

        if(strcmp(p_msg_no,"DRT") == 0)
        {
          l_msgaddr = MDATERANGEMSGNO;       
          *p_STAT_VAL = realloc(*p_STAT_VAL,sizeof(MS_STATIC_VAL)*9); 
          *p_SEL_VAL = realloc(*p_SEL_VAL,sizeof(MS_STATIC_VAL)*7); 
          if(strlen(l_ms_msgent_structa_a.proc_data) != 0)
          {
             CO_SplitStr(l_ms_msgent_structa_a.proc_data,
                          ';', &int_noelem, &chr_l_param);
             strcpy(chr_l_from_date,chr_l_param[0]);
             strcpy(chr_l_to_date,chr_l_param[1]);
          }
          if(strlen(chr_l_from_date) == 0)
          {
		APL_DATA_MISSING("FROM DATE", APL_NULL_STRING, APL_NULL_STRING)
                APL_GOBACK_FAIL
          }
          if(strlen(chr_l_to_date) == 0)
          {
		APL_DATA_MISSING("TO DATE", APL_NULL_STRING, APL_NULL_STRING)
                APL_GOBACK_FAIL
          }

          exec sql select substr(to_char(to_date(:chr_l_from_date),'DD/MM/YYYY'),1,10) into :chr_l_fdate from dual;
          IS_ANY_ORA_ERROR
          exec sql select substr(to_char(to_date(:chr_l_to_date),'DD/MM/YYYY'),1,10) into :chr_l_tdate from dual;
          IS_ANY_ORA_ERROR

          strcpy((*p_STAT_VAL)[0].link_val,"DUMMY");
          strcpy((*p_STAT_VAL)[0].link_tag,"DUMMY");
          strcpy((*p_STAT_VAL)[1].link_val,"SUBACCT");
          strcpy((*p_STAT_VAL)[1].link_tag,chr_h_sub_acct_processing);
          strcpy((*p_STAT_VAL)[2].link_val,"POSIT_DATE");
          strcpy((*p_STAT_VAL)[2].link_tag,chr_l_from_date);
          strcpy((*p_STAT_VAL)[3].link_val,"CA_NAME");
          strcpy((*p_STAT_VAL)[3].link_tag,chr_h_corporate_name);
          strcpy((*p_STAT_VAL)[4].link_val,"FROMDT");
          strcpy((*p_STAT_VAL)[4].link_tag,chr_l_fdate);
          strcpy((*p_STAT_VAL)[5].link_val,"TO_DATE");
          strcpy((*p_STAT_VAL)[5].link_tag,chr_l_tdate);
          strcpy((*p_STAT_VAL)[6].link_val,"DATE");
          strcpy((*p_STAT_VAL)[6].link_tag,chr_h_sysdrt_date);
          strcpy((*p_STAT_VAL)[7].link_val,"TO_DATE");
          strcpy((*p_STAT_VAL)[7].link_tag,chr_l_to_date);
          strcpy((*p_STAT_VAL)[8].link_val,"");
          strcpy((*p_STAT_VAL)[8].link_tag,"");

          strcpy((*p_SEL_VAL)[0].link_val,"OPNBAL");
          strcpy((*p_SEL_VAL)[1].link_val,"TAMT");
          strcpy((*p_SEL_VAL)[2].link_val,"cln_master");
          strcpy((*p_SEL_VAL)[3].link_val,"DUMMY");
          strcpy((*p_SEL_VAL)[4].link_val,"INSTR_CODE");
          strcpy((*p_SEL_VAL)[5].link_val,"CLIENT");
          strcpy((*p_SEL_VAL)[6].link_val,"");

	  strcpy(chr_l_sel_msg_stmt,"select ");
	  strcat(chr_l_sel_msg_stmt," 'DUMMY' as PROC_INIT, a.client, a.IDENTIY_NO, a.deal_cd, a.instr_code, substr(to_char(a.setl_date,'DD/MM/YYYY'),1,10) as SETL_DATE, substr(to_char(a.deal_date,'DD/MM/YYYY'),1,10) as deal_date,");
	  strcat(chr_l_sel_msg_stmt,"substr(to_char(a.INSTRUMENT_DT,'DD/MM/YYYY'),1,10) as INSTRUMENT_DT, a.QTY, to_char(decode(a.deal_cd,4,a.AMOUNT*(-1),a.AMOUNT)) as AMOUNT, concat(concat(substr(replace(replace(b.cln_name,chr(13),NULL),chr(10),NULL),1,35),' '),substr(replace(replace(b.cln_name,chr(13),NULL),chr(10),NULL),36,29)) as CLNT_NAME, b.cln_master,substr(replace(replace(b.cln_name,chr(13),NULL),chr(10),NULL),1,35) as CNAME1,");
	  strcat(chr_l_sel_msg_stmt,"decode(a.deal_cd,1,'DF',decode(a.deal_cd,2,'RF',decode(a.deal_cd,3,'DVP',decode(a.deal_cd,5,'DF',decode(a.deal_cd,6,'RF',decode(a.deal_cd,7,'DVP','RVP')))))) ");
	  strcat(chr_l_sel_msg_stmt,"as trcodedesc,a.AMOUNT,c.currency_cd as CCYTOTAMT,c.currency_cd as CCYAMOUNT,");
	  strcat(chr_l_sel_msg_stmt,"substr(replace(replace(c.instr_name,chr(13),NULL),chr(10),NULL),1,38) as instr_name, b.CLN_SHORTNM as ALPHACODE");
	  strcat(chr_l_sel_msg_stmt," from dl_deal a,MT_CLIENT b,MT_INSTRUMENT c  where a.client = b.cln_code and");
	  strcat(chr_l_sel_msg_stmt," a.instr_code = c.instr_code and   a.INSTRUMENT_DT >= '");
          strcat(chr_l_sel_msg_stmt,chr_l_from_date);
          strcat(chr_l_sel_msg_stmt,"' and a.INSTRUMENT_DT <= '"); 
          strcat(chr_l_sel_msg_stmt,chr_l_to_date);
          strcat(chr_l_sel_msg_stmt,"' and b.CLN_BRK_ALL != 'B' and b.checker is not null ");
	  strcat(chr_l_sel_msg_stmt," and b.STATUS != '");
	  strcat(chr_l_sel_msg_stmt,STATUS_CLS_AUTH);
          strcat(chr_l_sel_msg_stmt,"' ");
          if(strlen(l_ms_msgent_structa_a.client)!=0)
          {
		strcat(chr_l_sel_msg_stmt," and a.client = '");
                strcat(chr_l_sel_msg_stmt,l_ms_msgent_structa_a.client);
                strcat(chr_l_sel_msg_stmt,"' ");
          }

          strcat(chr_l_sel_msg_stmt," UNION ");
	  strcat(chr_l_sel_msg_stmt,"select ");
	  strcat(chr_l_sel_msg_stmt," 'DUMMY' as PROC_INIT, a.client, a.IDENTIY_NO, a.deal_cd, a.instr_code, substr(to_char(a.setl_date,'DD/MM/YYYY'),1,10) as SETL_DATE, substr(to_char(a.deal_date,'DD/MM/YYYY'),1,10) as deal_date,");
	  strcat(chr_l_sel_msg_stmt,"substr(to_char(a.INSTRUMENT_DT,'DD/MM/YYYY'),1,10) as INSTRUMENT_DT, a.QTY, to_char(decode(a.deal_cd,4,a.AMOUNT*(-1),a.AMOUNT)) as AMOUNT, concat(concat(substr(replace(replace(b.cln_name,chr(13),NULL),chr(10),NULL),1,35),' '),substr(replace(replace(b.cln_name,chr(13),NULL),chr(10),NULL),36,29)) as CLNT_NAME, b.cln_master,substr(replace(replace(b.cln_name,chr(13),NULL),chr(10),NULL),1,35) as CNAME1,");
	  strcat(chr_l_sel_msg_stmt,"decode(a.deal_cd,1,'DF',decode(a.deal_cd,2,'RF',decode(a.deal_cd,3,'DVP',decode(a.deal_cd,5,'DF',decode(a.deal_cd,6,'RF',decode(a.deal_cd,7,'DVP','RVP')))))) ");
	  strcat(chr_l_sel_msg_stmt,"as trcodedesc,a.AMOUNT,c.currency_cd as CCYOPNBAL,c.currency_cd as CCYAMOUNT,");
	  strcat(chr_l_sel_msg_stmt,"substr(replace(replace(c.instr_name,chr(13),NULL),chr(10),NULL),1,38) as instr_name, b.CLN_SHORTNM as ALPHACODE");
	  strcat(chr_l_sel_msg_stmt," from DL_HISDEAL a,MT_CLIENT b,MT_INSTRUMENT c  where a.client = b.cln_code and");
	  strcat(chr_l_sel_msg_stmt," a.instr_code = c.instr_code and   a.INSTRUMENT_DT >= '");
          strcat(chr_l_sel_msg_stmt,chr_l_from_date);
          strcat(chr_l_sel_msg_stmt,"' and a.INSTRUMENT_DT <= '"); 
          strcat(chr_l_sel_msg_stmt,chr_l_to_date);
          strcat(chr_l_sel_msg_stmt,"' and b.CLN_BRK_ALL != 'B' and b.checker is not null ");
	  strcat(chr_l_sel_msg_stmt," and b.STATUS != '");
          strcat(chr_l_sel_msg_stmt,STATUS_CLS_AUTH);
          strcat(chr_l_sel_msg_stmt,"' ");
          if(strlen(l_ms_msgent_structa_a.client)!=0)
          {
		strcat(chr_l_sel_msg_stmt," and a.client = '");
                strcat(chr_l_sel_msg_stmt,l_ms_msgent_structa_a.client);
                strcat(chr_l_sel_msg_stmt,"' ");
          }

          strcat(chr_l_sel_msg_stmt," order by 2,5,8,4");
        }

        if(strcmp(p_msg_no,"596N01") == 0)
        {
          l_msgaddr = MCANCELMSGNO;
          if(strlen(l_ms_msgent_structa_a.proc_init) != 0)
          {
              strcpy(chr_l_refno,l_ms_msgent_structa_a.proc_init);
          }

          if(strlen(l_ms_msgent_structa_a.proc_data) != 0)
          {
             CO_SplitStr(l_ms_msgent_structa_a.proc_data,
                          ';', &int_noelem, &chr_l_param);
             strcpy(chr_l_txndt,chr_l_param[0]);
             strcpy(chr_l_trdt,chr_l_param[1]);

	     memset(chr_buffer,APL_NULL_CHAR,KEY_LENGTH);
	     memset(chr_temp_part,APL_NULL_CHAR,20);
        
		  strncpy(chr_buffer,chr_l_param[2],19);

		  
		  
		  strncpy(chr_temp_part,chr_l_param[2],19);
	     strcpy(chr_l_isin,chr_temp_part);
	     memset(chr_temp_part,APL_NULL_CHAR,20);
             strcpy(chr_l_instrdesc,chr_l_param[3]);

				

           
            strncpy(chr_l_ftypeofinstr, chr_l_param[4], 3);
            chr_l_ftypeofinstr[3] = APL_NULL_CHAR;

			

				strncpy(chr_l_qty, chr_l_param[4] + 3, 35); 

			  

             strcpy(chr_l_domcpac,chr_l_param[5]);
             strcpy(chr_l_domcpdesc,chr_l_param[6]);

				
 
           
            strncpy(chr_l_ccycode, chr_l_param[7], 3);
            chr_l_ccycode[3] = APL_NULL_CHAR;

			

				strncpy(chr_l_amount, chr_l_param[7] + 3, 35); 
				printf(" <<*******>>The AMOUNT is : %s\n", chr_l_param[7]);
				printf(" <<*******>>The L_Amount is : %s\n", chr_l_amount);

				


             strcpy(chr_l_msgno,chr_l_param[8]);

           
		  		
            if ( ( strcmp(chr_l_msgno, MS_MSGNO_540) == 0 ) || ( strcmp(chr_l_msgno, "520") == 0 ) )
            {
               strcpy(chr_l_trcode, "2");
            }

            if ( ( strcmp(chr_l_msgno, MS_MSGNO_541) == 0 ) || ( strcmp(chr_l_msgno, "521") == 0) )
            {
                 strcpy(chr_l_trcode, "4");
            }

            if ( ( strcmp(chr_l_msgno, MS_MSGNO_542) == 0 ) || ( strcmp(chr_l_msgno, "522") == 0) )
            {
               strcpy(chr_l_trcode, "1");
            }

            if ( ( strcmp(chr_l_msgno, MS_MSGNO_543) == 0 ) || ( strcmp(chr_l_msgno, "523") == 0) )
            {
               strcpy(chr_l_trcode, "3");
            }

            strcpy(chr_l_countacc, chr_l_param[9]);

            strncpy(chr_l_countaccnm, chr_l_param[10],35);
            chr_l_countaccnm[35] = APL_NULL_CHAR;
				strcpy(chr_l_typeoftrd,chr_l_param[11]);
            strcpy(chr_l_failcode, chr_l_param[12]);
            

				strcpy(chr_l_increfno, chr_l_param[13]); 
          }
          *p_STAT_VAL = realloc(*p_STAT_VAL,sizeof(MS_STATIC_VAL)*19);
			

          *p_SEL_VAL = realloc(*p_SEL_VAL,sizeof(MS_STATIC_VAL)*4); 

          strcpy((*p_STAT_VAL)[0].link_val,"DUMMY");
          strcpy((*p_STAT_VAL)[0].link_tag,"DUMMY");
          strcpy((*p_STAT_VAL)[1].link_val,"MSG_IDENT_NO");
          strcpy((*p_STAT_VAL)[1].link_tag,chr_l_msgno);
          strcpy((*p_STAT_VAL)[2].link_val,"DEAL_DT");
          strcpy((*p_STAT_VAL)[2].link_tag,chr_l_txndt);
          strcpy((*p_STAT_VAL)[3].link_val,"DEAL_DATE");
          strcpy((*p_STAT_VAL)[3].link_tag,chr_l_trdt);
          strcpy((*p_STAT_VAL)[4].link_val,"INSTR_ISIN");
          strcpy((*p_STAT_VAL)[4].link_tag,chr_l_isin);
          strcpy((*p_STAT_VAL)[5].link_val,"INSTR_NAME");
          strcpy((*p_STAT_VAL)[5].link_tag,chr_l_instrdesc);

			

       
         strcpy((*p_STAT_VAL)[6].link_val, "FTYPEOFINSTR");
         strcpy((*p_STAT_VAL)[6].link_tag, chr_l_ftypeofinstr);
         strcpy((*p_STAT_VAL)[7].link_val, "FENT_POS");
         strcpy((*p_STAT_VAL)[7].link_tag, chr_l_qty);
         strcpy((*p_STAT_VAL)[8].link_val,"DOMESTIC_CPCLT");
         strcpy((*p_STAT_VAL)[8].link_tag,chr_l_domcpac);
         strcpy((*p_STAT_VAL)[9].link_val,"DOMCPDESC");
         strcpy((*p_STAT_VAL)[9].link_tag,chr_l_domcpdesc);
         strcpy((*p_STAT_VAL)[10].link_val, "CURRENCY_CD");
         strcpy((*p_STAT_VAL)[10].link_tag, chr_l_ccycode);
         strcpy((*p_STAT_VAL)[11].link_val, "AMOUNT");
         strcpy((*p_STAT_VAL)[11].link_tag, chr_l_amount);
         strcpy((*p_STAT_VAL)[12].link_val, "DEAL_CD");
         strcpy((*p_STAT_VAL)[12].link_tag, chr_l_trcode);
         strcpy((*p_STAT_VAL)[13].link_val,"IDENTIY_NO");
         strcpy((*p_STAT_VAL)[13].link_tag, chr_l_refno);
         strcpy((*p_STAT_VAL)[14].link_val, "CP_CLT");
         strcpy((*p_STAT_VAL)[14].link_tag, chr_l_countacc);
         strcpy((*p_STAT_VAL)[15].link_val, "CP_CLTNAME");
         strcpy((*p_STAT_VAL)[15].link_tag, chr_l_countaccnm);
         strcpy((*p_STAT_VAL)[16].link_val, "FAILREASON_CD");
         strcpy((*p_STAT_VAL)[16].link_tag, chr_l_failcode);
			

         
         strcpy((*p_STAT_VAL)[17].link_val,"INCREFNO");
         strcpy((*p_STAT_VAL)[17].link_tag, chr_l_increfno);
         strcpy((*p_STAT_VAL)[18].link_val,"");
         strcpy((*p_STAT_VAL)[18].link_tag,"");
         


         strcpy((*p_SEL_VAL)[0].link_val,"CLIENT");
         strcpy((*p_SEL_VAL)[1].link_val,"IDENTIY_NO");
         strcpy((*p_SEL_VAL)[2].link_val,"UNIQREFNO");
         strcpy((*p_SEL_VAL)[3].link_val,"");
         strcpy((*p_SEL_VAL)[3].link_tag,"");
         

          strcpy(chr_l_sel_msg_stmt,"select cln_code,substr(replace(replace(cln_name,chr(13),NULL),chr(10),NULL),1,35) as CLNT_NAME,'");
          strcat(chr_l_sel_msg_stmt,chr_l_refno);
          strcat(chr_l_sel_msg_stmt,"' as PROC_INIT,CLN_USE_ISIN_IND as FLGISIN ,'"); 
			 strcat(chr_l_sel_msg_stmt,chr_new_unique_ref_num); 
			 strcat(chr_l_sel_msg_stmt,"' as UNIQREFNO,cin_code as client,");
			 
			 strcat(chr_l_sel_msg_stmt," CLN_TAXABLE_IND  as IND_83C83D ");
			 

       
         strcat(chr_l_sel_msg_stmt," , to_char(to_date('");
         strcat(chr_l_sel_msg_stmt, chr_l_txndt );
      
         strcat(chr_l_sel_msg_stmt,"','RRMMDD'),'YYYYMMDD') as NEW_TXNDT,");  

			
			strcat(chr_l_sel_msg_stmt," to_char(to_date('");
			strcat(chr_l_sel_msg_stmt, chr_l_txndt );
			strcat(chr_l_sel_msg_stmt,"','RRMMDD'),'YYYYMMDD') as NEW_TRDT,");
			

         
         
         
         
         strcat(chr_l_sel_msg_stmt,"'");
          strcat(chr_l_sel_msg_stmt,chr_l_typeoftrd);
          strcat(chr_l_sel_msg_stmt,"' as DL_CLASS ");
          

          

          strcat(chr_l_sel_msg_stmt,", '");
          strcat(chr_l_sel_msg_stmt,chr_g_trad_val);
          strcat(chr_l_sel_msg_stmt,"' as PL_OF_ORIG_TRADE ");
          strcat(chr_l_sel_msg_stmt,", '");
          strcat(chr_l_sel_msg_stmt,chr_g_safe_val);
          strcat(chr_l_sel_msg_stmt,"' as PL_OF_TRADE ");
          strcat(chr_l_sel_msg_stmt,", '");
          strcat(chr_l_sel_msg_stmt,chr_g_secb_flg);
          strcat(chr_l_sel_msg_stmt,"' as SECB_IND ");
          strcat(chr_l_sel_msg_stmt,", '");
          strcat(chr_l_sel_msg_stmt,chr_g_setr_val);
          strcat(chr_l_sel_msg_stmt,"' as SETR_VAL "); 
	  
	  strcat(chr_l_sel_msg_stmt, ",'" );
	  strcat(chr_l_sel_msg_stmt,chr_g_stco_array[0]);
	  strcat(chr_l_sel_msg_stmt,"' as STCO_QUAL1");
	  strcat(chr_l_sel_msg_stmt,",'");
	  strcat(chr_l_sel_msg_stmt,chr_g_stco_array[1]);
	  strcat(chr_l_sel_msg_stmt,"' as STCO_QUAL2");
	  strcat(chr_l_sel_msg_stmt,",'");
	  strcat(chr_l_sel_msg_stmt,chr_g_stco_array[2]);
          strcat(chr_l_sel_msg_stmt,"' as STCO_QUAL3");
	  
          
          strcat(chr_l_sel_msg_stmt," from MT_CLIENT ");
          strcat(chr_l_sel_msg_stmt," where cln_code = '");
          strcat(chr_l_sel_msg_stmt,l_ms_msgent_structa_a.client);

          strcat(chr_l_sel_msg_stmt,"' ");
          strcat(chr_l_sel_msg_stmt," and CLN_BRK_ALL != 'B' and checker is not null ");
	  strcat(chr_l_sel_msg_stmt," and STATUS != '");
          strcat(chr_l_sel_msg_stmt,STATUS_CLS_AUTH);
          strcat(chr_l_sel_msg_stmt,"' ");
        }

        if(strcmp(p_msg_no,"596N02") == 0)
        {
          l_msgaddr = MCANCELMSGNO;
          if(strlen(l_ms_msgent_structa_a.proc_init) != 0)
          {
              strcpy(chr_l_refno,l_ms_msgent_structa_a.proc_init);
          }
          if(strlen(l_ms_msgent_structa_a.proc_data) != 0)
          {
             CO_SplitStr(l_ms_msgent_structa_a.proc_data,
                          ';', &int_noelem, &chr_l_param);
             strcpy(chr_l_msgno,chr_l_param[0]);
				 strcpy(chr_l_failcode, chr_l_param[1]); 
				 strcpy(chr_l_increfno, chr_l_param[2]); 
          }

          *p_STAT_VAL = realloc(*p_STAT_VAL,sizeof(MS_STATIC_VAL)*7); 
          *p_SEL_VAL = realloc(*p_SEL_VAL,sizeof(MS_STATIC_VAL)*13); 
			
			

          strcpy((*p_STAT_VAL)[0].link_val,"DUMMY");
          strcpy((*p_STAT_VAL)[0].link_tag,"DUMMY");
          strcpy((*p_STAT_VAL)[1].link_val,"DOMSEC");
          strcpy((*p_STAT_VAL)[1].link_tag,chr_h_dom_instr);
          strcpy((*p_STAT_VAL)[2].link_val,"MSG_IDENT_NO");
          strcpy((*p_STAT_VAL)[2].link_tag,chr_l_msgno);
          strcpy((*p_STAT_VAL)[3].link_val,"IDENTIY_NO");
          strcpy((*p_STAT_VAL)[3].link_tag,chr_l_refno);

			
       
			
         strcpy((*p_STAT_VAL)[4].link_val, "FAILREASON_CD");
         strcpy((*p_STAT_VAL)[4].link_tag, chr_l_failcode);
			
         

         
         strcpy((*p_STAT_VAL)[5].link_val,"INCREFNO");
         strcpy((*p_STAT_VAL)[5].link_tag, chr_l_increfno);
         strcpy((*p_STAT_VAL)[6].link_val,"");
         strcpy((*p_STAT_VAL)[6].link_tag,"");
         
	 
         
	 strcpy((*p_SEL_VAL)[0].link_val,"DOMESTIC_CPCLT");
          strcpy((*p_SEL_VAL)[1].link_val,"PARTIAL_IND");
          strcpy((*p_SEL_VAL)[2].link_val,"ORIG_REFNO");
          strcpy((*p_SEL_VAL)[3].link_val,"CLIENT");
          strcpy((*p_SEL_VAL)[4].link_val,"AMOUNT");

			

        
         strcpy((*p_SEL_VAL)[5].link_val,"IDENTIY_NO");
         
	 strcpy((*p_SEL_VAL)[6].link_val,"NCOUNTACC");	
	 strcpy((*p_SEL_VAL)[7].link_val,"CLIENTOF_CD");
	 strcpy((*p_SEL_VAL)[8].link_val,"CP_CLTNAME");
	 strcpy((*p_SEL_VAL)[9].link_val,"NEW_ACCOUNTOF1");
	 strcpy((*p_SEL_VAL)[10].link_val,"DEAL_DT");
	 strcpy((*p_SEL_VAL)[11].link_val,"UNIQREFNO");
         strcpy((*p_SEL_VAL)[12].link_val,"");
         strcpy((*p_SEL_VAL)[12].link_tag,"");
		
	  strcpy(chr_l_sel_msg_stmt,"select a.client,a.IDENTIY_NO as PROC_INIT,substr(to_char(a.deal_date,'YYMMDD'),1,6) as DEAL_DATE,");
	  strcat(chr_l_sel_msg_stmt,"to_char(a.deal_date,'YYYYMMDD') as NEW_TRDT,");
	  strcat(chr_l_sel_msg_stmt,"substr(to_char(a.DATEOF_INPUT,'YYMMDD'),1,6) as DEAL_DT,a.UNIQ_IDENT_NO||lpad(to_char(decode(a.cnt_548,99,0,(nvl(a.cnt_548,0)+1))),2,'0') as UNIQREFNO,"); 
	  strcat(chr_l_sel_msg_stmt,"a.domestic_cpclt as DOMESTIC_CPCLT,a.PARTIAL_IND_B,a.ORIG_REFNO,to_char(a.AMOUNT) as AMOUNT,a.net_amt,");
	  strcat(chr_l_sel_msg_stmt," decode(b.INSTR_TYPE,'BON',decode(c.CLN_FMT_RPTIND,'Y','FMT'");

	  strcat(chr_l_sel_msg_stmt,",b.INSTR_TYPE),b.INSTR_TYPE) as FTYPEOFINSTR,decode(b.INSTR_TYPE,'BON',decode(c.CLN_FMT_RPTIND,'Y',to_char(a.ORIG_QTY*b.NOMINAL_VALUE),to_char(a.ORIG_QTY)),to_char(a.ORIG_QTY)) as FENT_POS,");
	  strcat(chr_l_sel_msg_stmt,"b.INSTR_ISIN,b.INSTR_TYPE,b.instr_code,substr(replace(replace(b.instr_name,chr(13),NULL),chr(10),NULL),1,35) as INSTR_NAME,b.currency_cd,b.currency_cd as CCYAMOUNT,b.currency_cd as CCYNET_AMT,");
	  
		strcat(chr_l_sel_msg_stmt,"substr(replace(replace(c.cln_name,chr(13),NULL),chr(10),NULL),1,35) as CLNT_NAME,c.CLN_FMT_RPTIND,c.CLN_USE_ISIN_IND as FLGISIN,");
	  
	  strcat(chr_l_sel_msg_stmt," c.CLN_TAXABLE_IND  as IND_83C83D ");
	  

     
	  
      strcat(chr_l_sel_msg_stmt, ", decode(a.dl_class,'27','26','29','26',a.dl_class) as DL_CLASS, a.deal_cd, substr(to_char(a.setl_date,'YYYYMMDD'),1,8) as NEW_TXNDT, ");
      
		strcat(chr_l_sel_msg_stmt, " a.cp_clt,a.cp_clt as NCOUNTACC, substr(a.CP_CLTNAME,1,35) as CP_CLTNAME ");
      

    	
   	 strcat(chr_l_sel_msg_stmt,",a.CLIENTOF_CD as CLIENTOF_CD, a.INTER_MED_PERSON, a.INSTRUCT_PERSON as INSTPRTY, a.ENTRY ");
    	strcat(chr_l_sel_msg_stmt," ,decode(ltrim(rtrim(substr(a.INTER_MED_PERSONNM,1,35))),NULL,NULL,ltrim(rtrim(substr(a.INTER_MED_PERSONNM,1,35)))) as INTER_MED_PERSONNM1 ");
    	strcat(chr_l_sel_msg_stmt," ,decode(ltrim(rtrim(substr(a.INTER_MED_PERSONNM,36,60))),NULL,NULL,ltrim(rtrim(substr(a.INTER_MED_PERSONNM,36,60)))) as INTER_MED_PERSONNM2 ");
    	strcat(chr_l_sel_msg_stmt," ,decode(ltrim(rtrim(substr(a.clientof,1,35))),NULL,NULL,ltrim(rtrim(substr(a.clientof,1,35)))) as NEW_ACCOUNTOF1  ");
    	strcat(chr_l_sel_msg_stmt," ,decode(ltrim(rtrim(substr(a.clientof,36,30))),NULL,NULL,ltrim(rtrim(substr(a.clientof,36,30)))) as NEW_ACCOUNTOF2  ");
    	strcat(chr_l_sel_msg_stmt," ,decode(ltrim(rtrim(substr(a.INSTRUCT_PERSONNM,1,35))),NULL,NULL,ltrim(rtrim(substr(a.INSTRUCT_PERSONNM,1,35)))) as INSTPARTYNM1  ");
    	strcat(chr_l_sel_msg_stmt," ,decode(ltrim(rtrim(substr(a.INSTRUCT_PERSONNM,36,30))),NULL,NULL,ltrim(rtrim(substr(a.INSTRUCT_PERSONNM,36,30)))) as INSTPARTYNM2  ");
    	

	  strcat(chr_l_sel_msg_stmt," from dl_deal a,MT_INSTRUMENT b,MT_CLIENT c");
	  strcat(chr_l_sel_msg_stmt," where a.client = c.cln_code and");
          strcat(chr_l_sel_msg_stmt," a.client = '");
          strcat(chr_l_sel_msg_stmt,l_ms_msgent_structa_a.client);
          strcat(chr_l_sel_msg_stmt,"' and a.IDENTIY_NO = '");
          strcat(chr_l_sel_msg_stmt,chr_l_refno);
          strcat(chr_l_sel_msg_stmt,"' and a.instr_code = b.INSTR_CODE");
          strcat(chr_l_sel_msg_stmt," and c.CLN_BRK_ALL != 'B' and c.checker is not null ");
	  strcat(chr_l_sel_msg_stmt," and c.STATUS != '");
          strcat(chr_l_sel_msg_stmt,STATUS_CLS_AUTH);

          strcat(chr_l_sel_msg_stmt,"' ");
          strcat(chr_l_sel_msg_stmt,"UNION ");
	  strcat(chr_l_sel_msg_stmt,"select a.client,a.IDENTIY_NO as PROC_INIT,substr(to_char(a.deal_date,'YYMMDD'),1,6) as DEAL_DATE,");
	  strcat(chr_l_sel_msg_stmt,"to_char(a.deal_date,'YYYYMMDD') as NEW_TRDT,");
	  strcat(chr_l_sel_msg_stmt,"substr(to_char(a.DATEOF_INPUT,'YYMMDD'),1,6) as DEAL_DT,a.UNIQ_IDENT_NO as UNIQREFNO,");
	  strcat(chr_l_sel_msg_stmt,"a.domestic_cpclt as DOMESTIC_CPCLT,'N' as PARTIAL_IND_B,a.IDENTIY_NO as ORIG_REFNO,to_char(a.AMOUNT) as AMOUNT,a.net_amt, ");
	  strcat(chr_l_sel_msg_stmt," decode(b.INSTR_TYPE,'BON',decode(c.CLN_FMT_RPTIND,'Y','FMT'");

	  strcat(chr_l_sel_msg_stmt,",b.INSTR_TYPE),b.INSTR_TYPE) as FTYPEOFINSTR,decode(b.INSTR_TYPE,'BON',decode(c.CLN_FMT_RPTIND,'Y',to_char(a.QTY*b.NOMINAL_VALUE),to_char(a.QTY)),to_char(a.QTY)) as FENT_POS,");
	  strcat(chr_l_sel_msg_stmt,"b.INSTR_ISIN,b.INSTR_TYPE,b.instr_code,substr(replace(replace(b.instr_name,chr(13),NULL),chr(10),NULL),1,35) as INSTR_NAME,b.currency_cd,b.currency_cd as CCYAMOUNT,b.currency_cd as CCYNET_AMT, ");
	  
		strcat(chr_l_sel_msg_stmt,"substr(replace(replace(c.cln_name,chr(13),NULL),chr(10),NULL),1,35) as CLNT_NAME,c.CLN_FMT_RPTIND,c.CLN_USE_ISIN_IND as FLGISIN,");
	  
	  strcat(chr_l_sel_msg_stmt," c.CLN_TAXABLE_IND  as IND_83C83D ");
	  

   
   strcat(chr_l_sel_msg_stmt, ", decode(a.dl_class,'27','26','29','26',a.dl_class) as DL_CLASS, a.deal_cd,decode(a.SETL_DATE,null,substr(to_char(a.DATEOF_INPUT,'YYYYMMDD'),1,8),substr(to_char(a.SETL_DATE,'YYYYMMDD'),1,8)) as NEW_TXNDT, ");
   
	strcat(chr_l_sel_msg_stmt, " a.cp_clt,a.cp_clt as NCOUNTACC, substr(a.CP_CLTNAME,1,35) as CP_CLTNAME ");
   
    
    
    strcat(chr_l_sel_msg_stmt,",a.CLIENTOF_CD as CLIENTOF_CD, a.INTER_MED_PERSON, a.INSTRUCT_PERSON as INSTPRTY,a.ENTRY ");
    strcat(chr_l_sel_msg_stmt," ,decode(ltrim(rtrim(substr(a.INTER_MED_PERSONNM,1,35))),NULL,NULL,ltrim(rtrim(substr(a.INTER_MED_PERSONNM,1,35)))) as INTER_MED_PERSONNM1 ");
    strcat(chr_l_sel_msg_stmt," ,decode(ltrim(rtrim(substr(a.INTER_MED_PERSONNM,36,60))),NULL,NULL,ltrim(rtrim(substr(a.INTER_MED_PERSONNM,36,60)))) as INTER_MED_PERSONNM2 ");
    strcat(chr_l_sel_msg_stmt," ,decode(ltrim(rtrim(substr(a.clientof,1,35))),NULL,NULL,ltrim(rtrim(substr(a.clientof,1,35)))) as NEW_ACCOUNTOF1  ");
    strcat(chr_l_sel_msg_stmt," ,decode(ltrim(rtrim(substr(a.clientof,36,30))),NULL,NULL,ltrim(rtrim(substr(a.clientof,36,30)))) as NEW_ACCOUNTOF2  ");
    strcat(chr_l_sel_msg_stmt," ,decode(ltrim(rtrim(substr(a.CLT_NAME,1,35))),NULL,NULL,ltrim(rtrim(substr(a.CLT_NAME,1,35)))) as INSTPARTYNM1  ");
    strcat(chr_l_sel_msg_stmt," ,decode(ltrim(rtrim(substr(a.CLT_NAME,36,30))),NULL,NULL,ltrim(rtrim(substr(a.CLT_NAME,36,30)))) as INSTPARTYNM2  ");
    

	  strcat(chr_l_sel_msg_stmt," from DL_DEALREPAIR a,MT_INSTRUMENT b,MT_CLIENT c");
	  strcat(chr_l_sel_msg_stmt," where a.client = c.cln_code and");
          strcat(chr_l_sel_msg_stmt," a.client = '");
          strcat(chr_l_sel_msg_stmt,l_ms_msgent_structa_a.client);
          strcat(chr_l_sel_msg_stmt,"' and a.IDENTIY_NO = '");
          strcat(chr_l_sel_msg_stmt,chr_l_refno);
          strcat(chr_l_sel_msg_stmt,"' and a.instr_code = b.INSTR_CODE");
          strcat(chr_l_sel_msg_stmt," and c.CLN_BRK_ALL != 'B' and c.checker is not null ");
	  strcat(chr_l_sel_msg_stmt," and c.STATUS != '");
          strcat(chr_l_sel_msg_stmt,STATUS_CLS_AUTH);

          strcat(chr_l_sel_msg_stmt,"' ");

      
       strcat(chr_l_sel_msg_stmt,"UNION ");
         strcat(chr_l_sel_msg_stmt,"select a.client,a.IDENTIY_NO as PROC_INIT,substr(to_char(a.deal_date,'YYMMDD'),1,6) as DEAL_DATE,");
			strcat(chr_l_sel_msg_stmt,"to_char(a.deal_date,'YYYYMMDD') as NEW_TRDT,");
         strcat(chr_l_sel_msg_stmt,"substr(to_char(a.DATEOF_INPUT,'YYMMDD'),1,6) as DEAL_DT,a.UNIQ_IDENT_NO as UNIQREFNO,");
			
  
         strcat(chr_l_sel_msg_stmt,"a.domestic_cpclt as DOMESTIC_CPCLT,a.PARTIAL_IND_B,a.ORIG_REFNO,to_char(a.AMOUNT) as AMOUNT,a.net_amt,");
         strcat(chr_l_sel_msg_stmt," decode(b.INSTR_TYPE,'BON',decode(c.CLN_FMT_RPTIND,'Y','FMT'");
 
         strcat(chr_l_sel_msg_stmt,",b.INSTR_TYPE),b.INSTR_TYPE) as FTYPEOFINSTR,decode(b.INSTR_TYPE,'BON',decode(c.CLN_FMT_RPTIND,'Y',to_char(a.ORIG_QTY*b.NOMINAL_VALUE),to_char(a.ORIG_QTY)),to_char(a.ORIG_QTY)) as FENT_POS,");
         strcat(chr_l_sel_msg_stmt,"b.INSTR_ISIN,b.INSTR_TYPE,b.instr_code,substr(replace(replace(b.instr_name,chr(13),NULL),chr(10),NULL),1,35) as INSTR_NAME,b.currency_cd,b.currency_cd as CCYAMOUNT,b.currency_cd as CCYNET_AMT,");
         
			strcat(chr_l_sel_msg_stmt,"substr(replace(replace(c.cln_name,chr(13),NULL),chr(10),NULL),1,35) as CLNT_NAME,c.CLN_FMT_RPTIND,c.CLN_USE_ISIN_IND as FLGISIN,");
         strcat(chr_l_sel_msg_stmt," c.CLN_TAXABLE_IND  as IND_83C83D ");
	  
         strcat(chr_l_sel_msg_stmt, ", decode(a.dl_class,'27','26','29','26',a.dl_class) as DL_CLASS, a.deal_cd, substr(to_char(a.setl_date,'YYYYMMDD'),1,8) as NEW_TXNDT, ");
         
			strcat(chr_l_sel_msg_stmt, " a.cp_clt,a.cp_clt as NCOUNTACC, substr(a.CP_CLTNAME,1,35) as CP_CLTNAME ");
   	 
	strcat(chr_l_sel_msg_stmt,",a.CLIENTOF_CD as CLIENTOF_CD, a.INTER_MED_PERSON, a.INSTRUCT_PERSON as INSTPRTY, a.ENTRY ");
    	strcat(chr_l_sel_msg_stmt," ,decode(ltrim(rtrim(substr(a.INTER_MED_PERSONNM,1,35))),NULL,NULL,ltrim(rtrim(substr(a.INTER_MED_PERSONNM,1,35)))) as INTER_MED_PERSONNM1 ");
	strcat(chr_l_sel_msg_stmt," ,decode(ltrim(rtrim(substr(a.INTER_MED_PERSONNM,36,60))),NULL,NULL,ltrim(rtrim(substr(a.INTER_MED_PERSONNM,36,60)))) as INTER_MED_PERSONNM2 ");
        strcat(chr_l_sel_msg_stmt," ,decode(ltrim(rtrim(substr(a.clientof,1,35))),NULL,NULL,ltrim(rtrim(substr(a.clientof,1,35)))) as NEW_ACCOUNTOF1  ");
	strcat(chr_l_sel_msg_stmt," ,decode(ltrim(rtrim(substr(a.clientof,36,30))),NULL,NULL,ltrim(rtrim(substr(a.clientof,36,30)))) as NEW_ACCOUNTOF2  ");
        strcat(chr_l_sel_msg_stmt," ,decode(ltrim(rtrim(substr(a.INSTRUCT_PERSONNM,1,35))),NULL,NULL,ltrim(rtrim(substr(a.INSTRUCT_PERSONNM,1,35)))) as INSTPARTYNM1  ");
	strcat(chr_l_sel_msg_stmt," ,decode(ltrim(rtrim(substr(a.INSTRUCT_PERSONNM,36,30))),NULL,NULL,ltrim(rtrim(substr(a.INSTRUCT_PERSONNM,36,30)))) as INSTPARTYNM2  ");
        
         strcat(chr_l_sel_msg_stmt," from DL_HISDEAL a,MT_INSTRUMENT b,MT_CLIENT c");
         strcat(chr_l_sel_msg_stmt," where a.client = c.cln_code and");
         strcat(chr_l_sel_msg_stmt," a.client = '");
         strcat(chr_l_sel_msg_stmt,l_ms_msgent_structa_a.client);
         strcat(chr_l_sel_msg_stmt,"' and a.IDENTIY_NO = '");
         strcat(chr_l_sel_msg_stmt,chr_l_refno);
         strcat(chr_l_sel_msg_stmt,"' and a.instr_code = b.INSTR_CODE");
         strcat(chr_l_sel_msg_stmt," and c.CLN_BRK_ALL != 'B' and c.checker is not null ");
         strcat(chr_l_sel_msg_stmt," and c.STATUS != '");
         strcat(chr_l_sel_msg_stmt,STATUS_CLS_AUTH);
         strcat(chr_l_sel_msg_stmt,"' ");
       

        }

        if(strcmp(p_msg_no,"596P") == 0)
        {
          l_msgaddr = MCANCELMSGNO;
          if(strlen(l_ms_msgent_structa_a.proc_init) != 0)
          {
              strcpy(chr_l_refno,l_ms_msgent_structa_a.proc_init);
          }
            
				

				EXEC SQL SELECT deal_cd
				INTO :chr_l_trcode
				FROM
						DL_DEAL
				WHERE
						CLIENT =:l_ms_msgent_structa_a.client and
						IDENTIY_NO	  = :l_ms_msgent_structa_a.proc_init;
				
		
				int_l_rprflag=0;
				if( sqlca.sqlcode == 1403 )
				{
					EXEC SQL SELECT deal_cd
            	INTO :chr_l_trcode
            	FROM
              	    	DL_DEALREPAIR
            	WHERE
                  	CLIENT =:l_ms_msgent_structa_a.client and
                  	IDENTIY_NO   = :l_ms_msgent_structa_a.proc_init;
				int_l_rprflag=1;
				}	
				
				IS_ANY_ORA_ERROR 
				if ( chr_l_trcode[0] == DEALCD_DF )
				{
					strcpy(chr_l_msgno,I_MSGNO_522);
				} 
				else if ( chr_l_trcode[0] == DEALCD_RF )
				{
					strcpy(chr_l_msgno,I_MSGNO_520);
				} 
				else if ( chr_l_trcode[0] == DEALCD_DVP )
				{
					strcpy(chr_l_msgno,I_MSGNO_523);
				} 
				else if ( chr_l_trcode[0] == DEALCD_RVP )
				{
					strcpy(chr_l_msgno,I_MSGNO_521);
				} 
            else if ( chr_l_trcode[0] == DEALCD_CD )
            {
               strcpy(chr_l_msgno,I_MSGNO_521);
            }
            else if ( chr_l_trcode[0] == DEALCD_CR )
            {
               strcpy(chr_l_msgno,I_MSGNO_523);
            }
            else if ( chr_l_trcode[0] == DEALCD_DCD )
            {
               strcpy(chr_l_msgno,I_MSGNO_523);
            }
            else if ( chr_l_trcode[0] == DEALCD_RCR )
            {
               strcpy(chr_l_msgno,I_MSGNO_521);
            }
				else
				{
					APL_INSERT_ERROR_DATA_INTG("Trd Code","Value Unknown",APL_NULL_STRING)
				}	
				



          *p_STAT_VAL = realloc(*p_STAT_VAL,sizeof(MS_STATIC_VAL)*5); 
          *p_SEL_VAL = realloc(*p_SEL_VAL,sizeof(MS_STATIC_VAL)*10); 
									


          strcpy((*p_STAT_VAL)[0].link_val,"DUMMY");
          strcpy((*p_STAT_VAL)[0].link_tag,"DUMMY");
          strcpy((*p_STAT_VAL)[1].link_val,"DOMSEC");
          strcpy((*p_STAT_VAL)[1].link_tag,chr_h_dom_instr);
          strcpy((*p_STAT_VAL)[2].link_val,"IDENTIY_NO");
          strcpy((*p_STAT_VAL)[2].link_tag,chr_l_refno);
          strcpy((*p_STAT_VAL)[3].link_val,"MSG_IDENT_NO");
          strcpy((*p_STAT_VAL)[3].link_tag,chr_l_msgno);
          strcpy((*p_STAT_VAL)[4].link_val,"");
          strcpy((*p_STAT_VAL)[4].link_tag,"");

          strcpy((*p_SEL_VAL)[0].link_val,"DOMESTIC_CPCLT");
			 

         
          strcpy((*p_SEL_VAL)[1].link_val,"CLIENT");
          strcpy((*p_SEL_VAL)[2].link_val,"IDENTIY_NO");
			 
          

          
          strcpy((*p_SEL_VAL)[3].link_val,"NEW_CUSTNOTE");
	  strcpy((*p_SEL_VAL)[4].link_val,"NCOUNTACC");
	  strcpy((*p_SEL_VAL)[5].link_val,"CP_CLTNAME");
	  strcpy((*p_SEL_VAL)[6].link_val,"CLIENTOF_CD");
	  strcpy((*p_SEL_VAL)[7].link_val,"NEW_ACCOUNTOF1");
	  strcpy((*p_SEL_VAL)[8].link_val,"UNIQREFNO");
          strcpy((*p_SEL_VAL)[9].link_val,"");
          strcpy((*p_SEL_VAL)[9].link_tag,"");

		if ( int_l_rprflag==0 )
		{
	  strcpy(chr_l_sel_msg_stmt,"select a.client,a.IDENTIY_NO as PROC_INIT,substr(to_char(a.deal_date,'YYMMDD'),1,6) as DEAL_DATE,");
	  strcat(chr_l_sel_msg_stmt,"to_char(a.deal_date,'YYYYMMDD') as NEW_TRDT,");
	  strcat(chr_l_sel_msg_stmt,"substr(to_char(a.DATEOF_INPUT,'YYMMDD'),1,6) as DEAL_DT,a.UNIQ_IDENT_NO||lpad(to_char(decode(a.cnt_548,99,0,(nvl(a.cnt_548,0)+1))),2,'0') as UNIQREFNO,");
	  strcat(chr_l_sel_msg_stmt,"a.domestic_cpclt as DOMESTIC_CPCLT,a.PARTIAL_IND_B,a.ORIG_REFNO,");
	  strcat(chr_l_sel_msg_stmt," decode(b.INSTR_TYPE,'BON',decode(c.CLN_FMT_RPTIND,'Y','FMT'");
	  strcat(chr_l_sel_msg_stmt,",b.INSTR_TYPE),b.INSTR_TYPE) as FTYPEOFINSTR,decode(b.INSTR_TYPE,'BON',decode(c.CLN_FMT_RPTIND,'Y',to_char(a.QTY*b.NOMINAL_VALUE),a.QTY),a.QTY) as FENT_POS,");
	  strcat(chr_l_sel_msg_stmt,"b.INSTR_ISIN,b.INSTR_TYPE,b.instr_code,a.AMOUNT,a.net_amt,substr(replace(replace(b.instr_name,chr(13),NULL),chr(10),NULL),1,35) as INSTR_NAME,b.currency_cd,b.currency_cd as CCYAMOUNT,b.currency_cd as CCYNET_AMT, ");
	  strcat(chr_l_sel_msg_stmt,"substr(replace(replace(c.cln_name,chr(13),NULL),chr(10),NULL),1,35) as CLNT_NAME,c.CLN_FMT_RPTIND,c.CLN_USE_ISIN_IND as FLGISIN,");
	  strcat(chr_l_sel_msg_stmt," c.CLN_TAXABLE_IND  as IND_83C83D ");
   strcat(chr_l_sel_msg_stmt, ", decode(a.dl_class,'27','26','29','26',a.dl_class) as DL_CLASS, a.deal_cd, substr(to_char(a.setl_date,'YYYYMMDD'),1,8) as NEW_TXNDT, ");
	strcat(chr_l_sel_msg_stmt, " a.cp_clt,a.cp_clt as NCOUNTACC, substr(a.CP_CLTNAME,1,35) as CP_CLTNAME ");
   strcat(chr_l_sel_msg_stmt, ", replace(replace(a.client_note,chr(13),NULL),chr(10),NULL) as NEW_CUSTNOTE, ");
   strcat(chr_l_sel_msg_stmt, " decode(a.maker,'SYSTEM','Y','N') as INCMSG ");
	 strcat(chr_l_sel_msg_stmt,",a.CLIENTOF_CD as CLIENTOF_CD, a.INTER_MED_PERSON, a.INSTRUCT_PERSON as INSTPRTY, a.ENTRY ");
	 strcat(chr_l_sel_msg_stmt," ,decode(ltrim(rtrim(substr(a.INTER_MED_PERSONNM,1,35))),NULL,NULL,ltrim(rtrim(substr(a.INTER_MED_PERSONNM,1,35)))) as INTER_MED_PERSONNM1 ");
	 strcat(chr_l_sel_msg_stmt," ,decode(ltrim(rtrim(substr(a.INTER_MED_PERSONNM,36,60))),NULL,NULL,ltrim(rtrim(substr(a.INTER_MED_PERSONNM,36,60)))) as INTER_MED_PERSONNM2 ");
	 strcat(chr_l_sel_msg_stmt," ,decode(ltrim(rtrim(substr(a.clientof,1,35))),NULL,NULL,ltrim(rtrim(substr(a.clientof,1,35)))) as NEW_ACCOUNTOF1  ");
	 strcat(chr_l_sel_msg_stmt," ,decode(ltrim(rtrim(substr(a.clientof,36,30))),NULL,NULL,ltrim(rtrim(substr(a.clientof,36,30)))) as NEW_ACCOUNTOF2  ");
	 strcat(chr_l_sel_msg_stmt," ,decode(ltrim(rtrim(substr(a.INSTRUCT_PERSONNM,1,35))),NULL,NULL,ltrim(rtrim(substr(a.INSTRUCT_PERSONNM,1,35)))) as INSTPARTYNM1  ");
	 strcat(chr_l_sel_msg_stmt," ,decode(ltrim(rtrim(substr(a.INSTRUCT_PERSONNM,36,30))),NULL,NULL,ltrim(rtrim(substr(a.INSTRUCT_PERSONNM,36,30)))) as INSTPARTYNM2 , a.failreason_cd ,a.exch_code, a.mkt_type, a.clh_flg,a.interfii_flg, a.contract_cd  ");
	  strcat(chr_l_sel_msg_stmt," from dl_deal a,MT_INSTRUMENT b,MT_CLIENT c");
	  strcat(chr_l_sel_msg_stmt," where a.client = c.cln_code and");
          strcat(chr_l_sel_msg_stmt," a.client = '");
          strcat(chr_l_sel_msg_stmt,l_ms_msgent_structa_a.client);
          strcat(chr_l_sel_msg_stmt,"' and a.IDENTIY_NO = '");
          strcat(chr_l_sel_msg_stmt,chr_l_refno);
          strcat(chr_l_sel_msg_stmt,"' and a.instr_code = b.INSTR_CODE");
          strcat(chr_l_sel_msg_stmt," and c.CLN_BRK_ALL != 'B' and c.checker is not null ");
	  strcat(chr_l_sel_msg_stmt," and c.STATUS != '");
	  strcat(chr_l_sel_msg_stmt,STATUS_CLS_AUTH);

          strcat(chr_l_sel_msg_stmt,"' ");
    	}
	else if ( int_l_rprflag == 1 ) 
		{
	     strcpy(chr_l_sel_msg_stmt,"select a.client,a.IDENTIY_NO as PROC_INIT,substr(to_char(a.deal_date,'YYMMDD'),1,6) as DEAL_DATE,");
        strcat(chr_l_sel_msg_stmt,"to_char(a.deal_date,'YYYYMMDD') as NEW_TRDT,");
        strcat(chr_l_sel_msg_stmt,"substr(to_char(a.DATEOF_INPUT,'YYMMDD'),1,6) as DEAL_DT,a.UNIQ_IDENT_NO as UNIQREFNO,");
			strcat(chr_l_sel_msg_stmt,"a.domestic_cpclt as DOMESTIC_CPCLT,");
        strcat(chr_l_sel_msg_stmt," decode(b.INSTR_TYPE,'BON',decode(c.CLN_FMT_RPTIND,'Y','FMT'");
        strcat(chr_l_sel_msg_stmt,",b.INSTR_TYPE),b.INSTR_TYPE) as FTYPEOFINSTR,decode(b.INSTR_TYPE,'BON',decode(c.CLN_FMT_RPTIND,'Y',to_char(a.QTY*b.NOMINAL_VALUE),a.QTY),a.QTY) as FENT_POS, decode(b.INSTR_ISIN,NULL,'");
		  strcat(chr_l_sel_msg_stmt,chr_g_isin1);	
	     strcat(chr_l_sel_msg_stmt,"',b.INSTR_ISIN) as instr_isin,b.INSTR_TYPE,b.instr_code,a.AMOUNT,a.net_amt,substr(replace(replace(b.instr_name,chr(13),NULL),chr(10),NULL),1,35) as INSTR_NAME,b.currency_cd,b.currency_cd as CCYAMOUNT,b.currency_cd as CCYNET_AMT, ");
        strcat(chr_l_sel_msg_stmt,"substr(replace(replace(c.cln_name,chr(13),NULL),chr(10),NULL),1,35) as CLNT_NAME,c.CLN_FMT_RPTIND,c.CLN_USE_ISIN_IND as FLGISIN,");
        strcat(chr_l_sel_msg_stmt," c.CLN_TAXABLE_IND  as IND_83C83D ");
        strcat(chr_l_sel_msg_stmt, ", decode(a.dl_class,'27','26','29','26',a.dl_class) as DL_CLASS, a.deal_cd, substr(to_char(a.setl_date,'YYYYMMDD'),1,8) as NEW_TXNDT, ");
			strcat(chr_l_sel_msg_stmt," a.cp_clt, a.cp_clt as NCOUNTACC, substr(a.CP_CLTNAME,1,35) as CP_CLTNAME ");
        strcat(chr_l_sel_msg_stmt,", decode(a.maker,'SYSTEM','Y','N') as INCMSG ");
        strcat(chr_l_sel_msg_stmt,",a.CLIENTOF_CD as CLIENTOF_CD, a.INTER_MED_PERSON,  a.INSTRUCT_PERSON as INSTPRTY, a.ENTRY ");
        strcat(chr_l_sel_msg_stmt," ,decode(ltrim(rtrim(substr(a.INTER_MED_PERSONNM,1,35))),NULL,NULL,ltrim(rtrim(substr(a.INTER_MED_PERSONNM,1,35)) )) as INTER_MED_PERSONNM1 ");
        strcat(chr_l_sel_msg_stmt,",decode(ltrim(rtrim(substr(a.INTER_MED_PERSONNM,36,60))),NULL,NULL,ltrim(rtrim(substr(a.INTER_MED_PERSONNM,36,60) ))) as INTER_MED_PERSONNM2 ");
        strcat(chr_l_sel_msg_stmt," ,decode(ltrim(rtrim(substr(a.clientof,1,35))),NULL,NULL,ltrim(rtrim(substr(a.clientof,1,35)))) as NEW_ACCOUNTOF1  ");
        strcat(chr_l_sel_msg_stmt," ,decode(ltrim(rtrim(substr(a.clientof,36,30))),NULL,NULL,ltrim(rtrim(substr(a.clientof,36,30)))) as NEW_ACCOUNTOF2  "); 
		  strcat(chr_l_sel_msg_stmt,",a.IDENTIY_NO as ORIG_REFNO,'");
		  strcat(chr_l_sel_msg_stmt,chr_g_seme_prev);
        strcat(chr_l_sel_msg_stmt,"' as NEW_CUSTNOTE1 ");
		  strcat(chr_l_sel_msg_stmt," from DL_DEALREPAIR a,MT_INSTRUMENT b,MT_CLIENT c");
		  strcat(chr_l_sel_msg_stmt," where a.client = c.cln_code and");
	  	  strcat(chr_l_sel_msg_stmt," a.client ='");
		  strcat(chr_l_sel_msg_stmt,l_ms_msgent_structa_a.client);
        strcat(chr_l_sel_msg_stmt,"' and a.IDENTIY_NO ='");
        strcat(chr_l_sel_msg_stmt,chr_l_refno);
        strcat(chr_l_sel_msg_stmt,"' and a.instr_code = b.instr_code(+) ");
        strcat(chr_l_sel_msg_stmt," and c.CLN_BRK_ALL != 'B' and c.checker is not null ");
        strcat(chr_l_sel_msg_stmt," and c.STATUS != '");
        strcat(chr_l_sel_msg_stmt,STATUS_CLS_AUTH);	
		  strcat(chr_l_sel_msg_stmt,"'and a.DEAL_STAT='DD'"); 
		}
	} 

		if (APL_FAILURE == CO_Chk_CntryEnabled("ENTL_GEN_RSLTINSTR", "KEEP_FRACTION", &l_keep_fract_exists, l_debug_info_ptr))
      {
      	APL_GOBACK_FAIL
      }  
	
		memset(chr_l_keep_fract_temp, APL_NULL_CHAR, 2);	
		sprintf(chr_l_keep_fract_temp, "%d", l_keep_fract_exists);
		chr_l_keep_fract_temp[1] = APL_NULL_CHAR;

  	
        if(strncmp(p_msg_no,"550",3) == 0)
        {
          l_msgaddr = MCORPACTIONSMSGNO;       
          if(strlen(l_ms_msgent_structa_a.proc_init) != 0)
          {
             strcpy(chr_l_ca_id,l_ms_msgent_structa_a.proc_init);
          }
          *p_STAT_VAL = realloc(*p_STAT_VAL,sizeof(MS_STATIC_VAL)*8); 
          *p_SEL_VAL = realloc(*p_SEL_VAL,sizeof(MS_STATIC_VAL)*23); 
					

				memset(*p_SEL_VAL,NULL,sizeof(MS_STATIC_VAL)*22);
	  memset((*p_STAT_VAL)[1].link_val,APL_NULL_CHAR,201);

          strcpy((*p_STAT_VAL)[1].link_val,"DOMSEC");
          strcpy((*p_STAT_VAL)[1].link_tag,chr_h_dom_instr);
          strcpy((*p_STAT_VAL)[2].link_val,"ENT_INC");
          strcpy((*p_STAT_VAL)[2].link_tag,"T");
          strcpy((*p_STAT_VAL)[3].link_val,"TITLE");
          strcpy((*p_STAT_VAL)[4].link_val,"TTITLE");
			 
			 strcpy((*p_STAT_VAL)[5].link_val,"NATION");
			 strcpy((*p_STAT_VAL)[5].link_tag,g_mt_commonsys_params_struct_h.nation_code);
			 
          if(strcmp(p_msg_no,"550N01")==0)
	  {            
          	strcpy((*p_STAT_VAL)[3].link_tag,"ENTITLEMENT");
          	strcpy((*p_STAT_VAL)[4].link_tag,"CORPORATE EVENT ENTITLEMENT TELEX");
          }
          if(strcmp(p_msg_no,"550C01")==0)
	  {            
          	strcpy((*p_STAT_VAL)[3].link_tag,"ENTITLEMENT CHANGE");
          	strcpy((*p_STAT_VAL)[4].link_tag,"CORPORATE EVENT ENTITLEMENT CHANGE TELEX");
          }
          if(strcmp(p_msg_no,"550R01")==0)
	  {            
          	strcpy((*p_STAT_VAL)[3].link_tag,"ENTITLEMENT REVERSAL");
          	strcpy((*p_STAT_VAL)[4].link_tag,"CORPORATE EVENT ENTITLEMENT REVERSAL TELEX");
          }
			 
          strcpy((*p_STAT_VAL)[6].link_val,"CNTRY_BIC");
          strcpy((*p_STAT_VAL)[6].link_tag,l_mt_message_sys_params_struct_h.swift_cd);
			 

			 
          strcpy((*p_STAT_VAL)[7].link_val,"");
          strcpy((*p_STAT_VAL)[7].link_tag,"");
			 
	
          strcpy((*p_SEL_VAL)[0].link_val,"RES_INSTR_CODE");
          strcpy((*p_SEL_VAL)[1].link_val,"DISP_OF_FRACT");
          strcpy((*p_SEL_VAL)[2].link_val,"CLIENT");
          strcpy((*p_SEL_VAL)[3].link_val,"CA_EVENT");
          strcpy((*p_SEL_VAL)[4].link_val,"INSTR_CODE");
          strcpy((*p_SEL_VAL)[5].link_val,"TEVENTID"); 
          strcpy((*p_SEL_VAL)[6].link_val,"LENTNOTE_NO"); 
          strcpy((*p_SEL_VAL)[7].link_val,"NPOS");
          strcpy((*p_SEL_VAL)[8].link_val,"INSTR_TYPE");
          strcpy((*p_SEL_VAL)[9].link_val,"SUB_BASE_QUANTITY");
          strcpy((*p_SEL_VAL)[10].link_val,"SUB_NEW_QUANTITY");
          strcpy((*p_SEL_VAL)[11].link_val,"NEGPOSN"); 
          strcpy((*p_SEL_VAL)[12].link_val,"CCCYCODE"); 
          strcpy((*p_SEL_VAL)[13].link_val,"SUB_PR"); 

         

          strcpy((*p_SEL_VAL)[14].link_val,"CORP_ID");

         
			 strcpy((*p_SEL_VAL)[15].link_val,"OLD_STK_QTY");
			 strcpy((*p_SEL_VAL)[16].link_val,"NEW_SAFEK_QTY");
			

          strcpy((*p_SEL_VAL)[17].link_val,"P_SUBS_AMT"); 
			 strcpy((*p_SEL_VAL)[18].link_val,"NEW_RESPONS_DT");  
          strcpy((*p_SEL_VAL)[19].link_val,"NEW_BUYRESP_DT");  
          strcpy((*p_SEL_VAL)[20].link_val,"NEW_SELLRESP_DT"); 
          strcpy((*p_SEL_VAL)[21].link_val,"TR_SUBS_AMT");	
          strcpy((*p_SEL_VAL)[22].link_val,"");
          strcpy((*p_SEL_VAL)[22].link_tag,"");          

	  strcpy(chr_l_sel_msg_stmt,"select a.instr_code,substr(to_char(a.DECLARE_DT,'YYMMDD'),1,6) as DECLARE_DT,");
	  strcat(chr_l_sel_msg_stmt,"substr(to_char(a.DECLARE_DT,'DD-MM-YYYY'),1,10) as EM_DECLARE_DT,");
	  strcat(chr_l_sel_msg_stmt,"a.CA_EVENT,a.EVNT_INDNT,concat('/',b.cln_code) as NACCOUNT,b.cln_code,substr(replace(replace(b.cln_name,chr(13),NULL),chr(10),NULL),1,35)");
	  strcat(chr_l_sel_msg_stmt," as CLNT_NAME,b.cln_code as client,decode(c.INSTR_TYPE,'BON',decode(b.CLN_FMT_RPTIND,'Y','FMT'");
	  	/*Added by Anjaneyulu on 21/09/2015 for ISKB_1621 FENT_POS=0-starts*/
	  strcat(chr_l_sel_msg_stmt,",c.INSTR_TYPE),c.INSTR_TYPE) as FTYPEOFINSTR,c.INSTR_ISIN,c.INSTR_TYPE");

			if(strcmp(p_msg_no,"550C01") == 0)
			{
				EXEC SQL SELECT NVL(ELIG_ENTITL_POS,0) INTO :l_elig_pos FROM CAENTITLEMENT WHERE CORP_ID = :chr_l_ca_id 
					AND CLIENT = :l_ms_msgent_structa_a.client;		
				IS_ANY_ORA_ERROR
			}
			if((APL_DOUBLE_EQUAL(l_elig_pos,0)) && (strcmp(p_msg_no,"550C01") == 0))
			{
				strcat(chr_l_sel_msg_stmt,",(SELECT decode(c.INSTR_TYPE,'BON',decode(b.CLN_FMT_RPTIND,'Y',to_char((d.PREV_ELIG_HOLD)*c.NOMINAL_VALUE),to_char((d.PREV_ELIG_HOLD))),to_char((d.PREV_ELIG_HOLD))) FROM CAEVENT A, MT_CLIENT B, MT_INSTRUMENT C, CA_REV_ENTITLE d WHERE A.CORP_ID = D.CORP_ID AND A.INSTR_CODE = C.INSTR_CODE AND B.CLN_CODE = D.CLIENT AND d.CORP_ID = '");
				strcat(chr_l_sel_msg_stmt,chr_l_ca_id);
				strcat(chr_l_sel_msg_stmt,"' AND d.CLIENT ='");
		
				strcat(chr_l_sel_msg_stmt,l_ms_msgent_structa_a.client);
				strcat(chr_l_sel_msg_stmt,"') as FENT_POS,");
			}
			else
			{				
				strcat(chr_l_sel_msg_stmt,",decode(c.INSTR_TYPE,'BON',decode(b.CLN_FMT_RPTIND,'Y',to_char((elig_entitl_pos)*c.NOMINAL_VALUE),to_char((elig_entitl_pos))),to_char((elig_entitl_pos))) as FENT_POS,");
			}
			/*Added by Anjaneyulu on 21/09/2015 for ISKB_1621 FENT_POS=0-ends*/

		  strcat(chr_l_sel_msg_stmt,"concat('/',concat(concat(c.currency_cd,'/'),c.REG_BR_IND)) as RGCCYCODE,substr(replace(replace(c.instr_name,chr(13),NULL),chr(10),NULL),1,35) as INSTR_NAME,");
		  strcat(chr_l_sel_msg_stmt,"substr(to_char(a.EXPIRY_DATE,'YYMMDD'),1,6) as EXPIRY_DATE,substr(to_char(a.EX_DATE,'YYMMDD'),1,6) as EX_DATE,");
		  strcat(chr_l_sel_msg_stmt,"substr(to_char(a.EX_DATE,'DD-MM-YYYY'),1,10) as EM_EX_DATE,");
		  strcat(chr_l_sel_msg_stmt,"substr(to_char(a.RESPONSE_DATE,'YYMMDD'),1,6) as RESPONSE_DATE,");
		  strcat(chr_l_sel_msg_stmt,"substr(to_char(a.dateof_payment,'YYMMDD'),1,6) as dateof_payment,substr(to_char(a.REC_DATE,'YYMMDD'),1,6) as REC_DATE,");
		  strcat(chr_l_sel_msg_stmt,"substr(to_char(a.REC_DATE,'DD-MM-YYYY'),1,10) as EM_REC_DATE,");
		   strcat(chr_l_sel_msg_stmt,"substr(to_char(a.dateof_payment,'DD-MM-YYYY'),1,10) as EM_DATEOF_PAYMENT,substr(to_char(a.BC_FROM_DATE,'YYMMDD'),1,6) as BC_DATE,");
		  strcat(chr_l_sel_msg_stmt," to_char(abs(d.QUANTITY_BAL)) as QUANTITY_BAL,");
		  strcat(chr_l_sel_msg_stmt,"a.RES_INSTR_CODE,a.SUB_PR,decode(a.RHTS_CLASS,'Y','SALABLE','NONSALE') as RHTS_CLASS,");
		  strcat(chr_l_sel_msg_stmt,"decode(a.PART_PYMT_DT,NULL,NULL,substr(to_char(a.PART_PYMT_DT,'YYMMDD'),1,6)) as PARIPASSU_DT,");
		  strcat(chr_l_sel_msg_stmt,"a.DISP_OF_FRACT,c.currency_cd as CCYINSTR_INC_BAL,c.currency_cd as CCYSUB_PRICE,c.currency_cd as CCYRATE,");

		  strcat(chr_l_sel_msg_stmt, " b.CLN_FRACT_IND as FRACT_IND, '");  
		  strcat(chr_l_sel_msg_stmt, chr_l_keep_fract_temp);
		  strcat(chr_l_sel_msg_stmt, "' as FRACT_COND,");			
		  strcat(chr_l_sel_msg_stmt,"substr(concat(decode(a.NEW_SAFEK_QTY,NULL,'0',a.NEW_SAFEK_QTY),concat(':',decode(a.OLD_STK_QTY,NULL,'0',a.OLD_STK_QTY))),1,15) as RATIO,a.NEW_SAFEK_RT as AE_RATE,c.currency_cd,to_char(abs(d.INSTR_INC_BAL)) as INSTR_INC_BAL,");
		  strcat(chr_l_sel_msg_stmt,"substr(concat(a.instr_code,concat(concat(concat(to_char(to_date(a.DECLARE_DT),'YY'),lpad(((to_date(a.DECLARE_DT) - to_date(concat(concat('01/01/',to_char(a.DECLARE_DT,'YYYY')),' 12:00:00')))+1),3,'0')),lpad(substr(to_char(a.EVNT_INDNT),1,2),2,'0')),'D')),1,16) as EVENT_ID,");
        strcat(chr_l_sel_msg_stmt,"substr(concat(a.instr_code,concat(concat(to_char(to_date(a.DECLARE_DT),'YY'),lpad(((to_date(a.DECLARE_DT) - to_date(concat(concat('01/01/',to_char(a.DECLARE_DT,'YYYY')),' 12:00:00')))+1),3,'0')),lpad(substr(to_char(a.EVNT_INDNT),1,2),2,'0'))),1,16) as TEVENTID,");
		  strcat(chr_l_sel_msg_stmt,"a.EARNINGS_RATE, a.EARNINGS_RATE as R_EARNINGS, b.CLN_USE_ISIN_IND as FLGISIN,to_char(abs(d.ELIG_ENTITL_POS))  as ELIG_ENTITL_POS,a.SUB_NEW_QUANTITY,a.SUB_BASE_QUANTITY,");
		  strcat(chr_l_sel_msg_stmt,"concat('/',concat(concat(c.currency_cd,'/'),c.REG_BR_IND)) as SECCCY ");
		  
		  strcat(chr_l_sel_msg_stmt,", decode(d.ELIG_ENTITL_POS,abs(d.ELIG_ENTITL_POS),'N','Y') as NEGPOSN ,");
		 
		 strcat(chr_l_sel_msg_stmt," d.CCY_FOR_ENTITL as CCCYCODE,'EUR' as CCYCSUB_PRICE, ");
		 
		  
		  strcat(chr_l_sel_msg_stmt," b.CLN_TAXABLE_IND  as IND_83C83D,c.nominal_value ");
		  
		  strcat(chr_l_sel_msg_stmt, ", a.corp_id as CORP_ID "); 
		  
		  strcat(chr_l_sel_msg_stmt,",a.NEW_SAFEK_QTY,a.OLD_STK_QTY");
		  strcat(chr_l_sel_msg_stmt,",substr(to_char(a.DECLARE_DT,'YYYYMMDD'),1,8) as NEW_DECL_DT");
		  strcat(chr_l_sel_msg_stmt,",substr(to_char(a.DECLARE_DT,'DD-MM-YYYY'),1,10) as EM_DECL_DT");
		  strcat(chr_l_sel_msg_stmt,",substr(to_char(a.REC_DATE,'YYYYMMDD'),1,8) as NEW_REC_DT");
		  strcat(chr_l_sel_msg_stmt,",substr(to_char(a.BC_FROM_DATE,'YYYYMMDD'),1,8) as NEW_BC_DT");
		  strcat(chr_l_sel_msg_stmt,",substr(to_char(a.BC_FROM_DATE,'DD-MM-YYYY'),1,10) as EM_BC_DT");
		  strcat(chr_l_sel_msg_stmt,",substr(to_char(a.EX_DATE,'YYYYMMDD'),1,8) as NEW_EX_DT");
		  strcat(chr_l_sel_msg_stmt,",substr(to_char(a.dateof_payment,'YYYYMMDD'),1,8) as NEW_PAY_DT");
		  strcat(chr_l_sel_msg_stmt,",substr(to_char(a.EXPIRY_DATE,'YYYYMMDD'),1,8) as NEW_EXPIRE_DT");
              
        strcat(chr_l_sel_msg_stmt,",substr(to_char(a.RESPONSE_DATE,'YYYYMMDDhh24miss'),1,14) as NEW_RESPONS_DT");
        strcat(chr_l_sel_msg_stmt,",substr(to_char(a.RESPONSE_DATE,'DD-MM-YYYY hh24:mi:ss'),1,19) as EM_RESPONS_DT");
        strcat(chr_l_sel_msg_stmt,",substr(to_char(a.RESPONSEDT_BUY,'YYYYMMDDhh24miss'),1,14) as NEW_BUYRESP_DT");
        strcat(chr_l_sel_msg_stmt,",substr(to_char(a.SELL_RESP_DATE,'YYYYMMDDhh24miss'),1,14) as NEW_SELLRESP_DT");
             
		  strcat(chr_l_sel_msg_stmt,",substr(to_char(a.PART_PYMT_DT,'YYYYMMDD'),1,8) as NEW_PARIPASSU_DT");
		  strcat(chr_l_sel_msg_stmt,",substr(to_char(d.access_stamp,'YYYYMMDDHH24MISS'),1,14) as ACC_STMP");
		  
		  
		  strcat(chr_l_sel_msg_stmt,",decode(a.EARNINGS_RATE,NULL,'0',0,'0',a.EARNINGS_RATE) as STOCK_RATE ");
		  strcat(chr_l_sel_msg_stmt,",c.currency_cd as CCYSTOCK_RATE , '12' as DECSTOCK_RATE ");
		  strcat(chr_l_sel_msg_stmt,",substr(to_char(a.DEAL_FRM_DATE,'YYYYMMDD'),1,8) as NEW_TRADEFROM_DT");
		  strcat(chr_l_sel_msg_stmt,",substr(to_char(a.DEAL_FRM_DATE,'DD-MM-YYYY'),1,10) as EM_TRADEFROM_DT");
		  strcat(chr_l_sel_msg_stmt,",substr(to_char(a.DEAL_TO_DATE,'YYYYMMDD'),1,8) as NEW_TRADETO_DT");
		  strcat(chr_l_sel_msg_stmt,",substr(to_char(a.DEAL_TO_DATE,'DD-MM-YYYY'),1,10) as EM_TRADETO_DT");
		  strcat(chr_l_sel_msg_stmt,",substr(to_char(a.POST_DATE,'YYYYMMDD'),1,8) as NEW_POSTING_DT");	
		  strcat(chr_l_sel_msg_stmt,",substr(to_char(a.SUBSCR_DATE,'YYYYMMDD'),1,8) as NEW_SUBS_DT ");  
		  strcat(chr_l_sel_msg_stmt,",substr(to_char(a.SUBSCR_DATE,'DD-MM-YYYY'),1,10) as EM_SUBS_DT ");  
		  strcat(chr_l_sel_msg_stmt,",a.OVER_SUBSCRP ");
		  
		  
		  strcat(chr_l_sel_msg_stmt," ,to_char(abs(d.QUANTITY_BAL) * (a.sub_new_quantity/a.SUB_BASE_QUANTITY)) as P_SUBS_QTY");
		  strcat(chr_l_sel_msg_stmt," ,to_char(trunc(abs(d.QUANTITY_BAL) * (a.sub_new_quantity/a.SUB_BASE_QUANTITY),3)) as TR_SUBS_QTY");	
		  strcat(chr_l_sel_msg_stmt," ,to_char(trunc(abs(d.QUANTITY_BAL) * (a.sub_new_quantity/a.SUB_BASE_QUANTITY)) * a.SUB_PR) as P_SUBS_AMT");
		  strcat(chr_l_sel_msg_stmt," ,d.CCY_FOR_ENTITL as CCYP_SUBS_AMT,'EUR' as CCYCP_SUBS_AMT ");
		  strcat(chr_l_sel_msg_stmt," ,to_char(trunc(((d.QUANTITY_BAL) * (a.sub_new_quantity/a.SUB_BASE_QUANTITY)) * a.SUB_PR,5)) as TR_SUBS_AMT");	
		  strcat(chr_l_sel_msg_stmt," ,d.CCY_FOR_ENTITL as CCYTR_SUBS_AMT,'EUR' as CCYCTR_SUBS_AMT ");
		
		  strcat(chr_l_sel_msg_stmt,",a.DIVIDEND_TYPE as NEW_DEF_OPT "); 
     	  strcat(chr_l_sel_msg_stmt,",a.INFO_SEQ as LENTNOTE_NO "); 

        
        strcat(chr_l_sel_msg_stmt," ,decode(a.WWWADDR,NULL,NULL,substr(a.WWWADDR,1,35)) as WEBB_ADD1");
        strcat(chr_l_sel_msg_stmt," ,decode(a.WWWADDR,NULL,NULL,substr(a.WWWADDR,36,35)) as WEBB_ADD2");
        strcat(chr_l_sel_msg_stmt," ,decode(a.WWWADDR,NULL,NULL,substr(a.WWWADDR,71,35)) as WEBB_ADD3");
        

		  
		  strcat(chr_l_sel_msg_stmt," ,a.FRACT_PR as FRACT_PR, a.CA_CURRENCY as CCYF_PRICE");
		  	
			strcat(chr_l_sel_msg_stmt," ,a.REQD_CERTIFY as REQD_CERTIFY ");
		 
		 
		 strcat(chr_l_sel_msg_stmt,", substr(to_char(a.start_date,'YYYYMMDD'),1,8) as NEW_START_DT");
		 strcat(chr_l_sel_msg_stmt,", substr(to_char(a.EFFECTIVE_DATE,'YYYYMMDD'),1,8) as NEW_EFFECT_DT");
		 

		 strcat(chr_l_sel_msg_stmt," from CAEVENT a,MT_CLIENT b,MT_INSTRUMENT c,CAENTITLEMENT d ");
		  strcat(chr_l_sel_msg_stmt,"where a.instr_code = c.instr_code and a.corp_id = d.corp_id and a.corp_id = '");
		  strcat(chr_l_sel_msg_stmt,chr_l_ca_id);
				 strcat(chr_l_sel_msg_stmt,"' ");
		  strcat(chr_l_sel_msg_stmt,"and d.client = b.cln_code ");
				 if((strlen(l_ms_msgent_structa_a.client))!=0)
				 {
					strcat(chr_l_sel_msg_stmt,"and d.client = '");
						 strcat(chr_l_sel_msg_stmt,l_ms_msgent_structa_a.client);
					strcat(chr_l_sel_msg_stmt,"'");
				 }
	
				 strcat(chr_l_sel_msg_stmt," and b.STATUS != '");
				 strcat(chr_l_sel_msg_stmt,STATUS_CLS_AUTH);
				 strcat(chr_l_sel_msg_stmt,"' ");
				  
				 if(strcmp(p_msg_no,"550R01") == 0)
				 {
               strcat(chr_l_sel_msg_stmt," and b.cln_code IN (select client from MS_MSGSTAT where proc_init = '");
               strcat(chr_l_sel_msg_stmt,chr_l_ca_id);
               strcat(chr_l_sel_msg_stmt,"' and swift_msg_rep IN ('550N01','564N01','550C01','564C01'))");
             }
			  }

		
			  if ( (strncmp(p_msg_no,"551",3) == 0) || (strcmp(p_msg_no,"564N91") == 0) || (strcmp(p_msg_no,"564R91") == 0))
				{
				 l_msgaddr = MCORPACTIONSMSGNO;       
				 if(strlen(l_ms_msgent_structa_a.proc_init) != 0)
				 {
					 strcpy(chr_l_ca_id,l_ms_msgent_structa_a.proc_init);
				 }
				 *p_STAT_VAL = realloc(*p_STAT_VAL,sizeof(MS_STATIC_VAL)*12);
			   
			 
			   *p_SEL_VAL = realloc(*p_SEL_VAL,sizeof(MS_STATIC_VAL)*29); 
			


				 strcpy((*p_STAT_VAL)[1].link_val,"DOMSEC");
				 strcpy((*p_STAT_VAL)[1].link_tag,chr_h_dom_instr);
				 strcpy((*p_STAT_VAL)[2].link_val,"ENT_INC");
				 strcpy((*p_STAT_VAL)[3].link_val,"TITLE");
				 strcpy((*p_STAT_VAL)[4].link_val,"TEXT");
				 strcpy((*p_STAT_VAL)[8].link_val,"NATION");
				 strcpy((*p_STAT_VAL)[8].link_tag,g_mt_commonsys_params_struct_h.nation_code);
				 if( (strcmp(p_msg_no,"551N01")==0) || (strcmp(p_msg_no,"564N91") == 0) )
				 {
					strcpy((*p_STAT_VAL)[3].link_tag,"EVENT INTIMATION");
					strcpy((*p_STAT_VAL)[4].link_tag,APL_NULL_STRING);
					
					strcpy((*p_STAT_VAL)[5].link_val,p_msg_no);
					strcpy((*p_STAT_VAL)[5].link_tag,"T");
					strcpy((*p_STAT_VAL)[6].link_val,"EVE_INC");
					strcpy((*p_STAT_VAL)[6].link_tag,"T");
					strcpy((*p_STAT_VAL)[2].link_tag,"F");
				 }
				 if(strcmp(p_msg_no,"551N02")==0)
				 {
					strcpy((*p_STAT_VAL)[3].link_tag,"ENTITLEMENT");
					strcpy((*p_STAT_VAL)[4].link_tag,APL_NULL_STRING);
					strcpy((*p_STAT_VAL)[5].link_val,"551N02");
					strcpy((*p_STAT_VAL)[5].link_tag,"T");
					strcpy((*p_STAT_VAL)[6].link_val,"EVE_INC");
					strcpy((*p_STAT_VAL)[6].link_tag,"F");
					strcpy((*p_STAT_VAL)[2].link_tag,"T");
				 }
				 if(strcmp(p_msg_no,"551C01")==0)
				 {
					strcpy((*p_STAT_VAL)[3].link_tag,"EVENT CHANGE");
					strcpy((*p_STAT_VAL)[4].link_tag,APL_NULL_STRING);
					strcpy((*p_STAT_VAL)[5].link_val,"551C01");
					strcpy((*p_STAT_VAL)[5].link_tag,"T");
					strcpy((*p_STAT_VAL)[6].link_val,"EVE_INC");
					strcpy((*p_STAT_VAL)[6].link_tag,"T");
					strcpy((*p_STAT_VAL)[2].link_tag,"F");
				 }
				 if(strcmp(p_msg_no,"551C02")==0)
				 {
					strcpy((*p_STAT_VAL)[3].link_tag,"EVENT CHANGE");
					strcpy((*p_STAT_VAL)[4].link_tag,APL_NULL_STRING);
					strcpy((*p_STAT_VAL)[5].link_val,"551C02");
					strcpy((*p_STAT_VAL)[5].link_tag,"T");
					strcpy((*p_STAT_VAL)[6].link_val,"EVE_INC");
					strcpy((*p_STAT_VAL)[6].link_tag,"F");
					strcpy((*p_STAT_VAL)[2].link_tag,"T");
				 }
				 if(strcmp(p_msg_no,"551C03")==0)
				 {
					strcpy((*p_STAT_VAL)[3].link_tag,"EVENT CHANGE");
					strcpy((*p_STAT_VAL)[4].link_tag,"The entitlement is changed");
					strcpy((*p_STAT_VAL)[5].link_val,"551C03");
					strcpy((*p_STAT_VAL)[5].link_tag,"T");
					strcpy((*p_STAT_VAL)[6].link_val,"EVE_INC");
					strcpy((*p_STAT_VAL)[6].link_tag,"F");
					strcpy((*p_STAT_VAL)[2].link_tag,"T");
				 }
				 if(strcmp(p_msg_no,"551C04")==0)
				 {
					strcpy((*p_STAT_VAL)[3].link_tag,"EVENT CHANGE");
					strcpy((*p_STAT_VAL)[4].link_tag,"The entitlement is reversed");
					strcpy((*p_STAT_VAL)[5].link_val,"551C04");
					strcpy((*p_STAT_VAL)[5].link_tag,"T");
					strcpy((*p_STAT_VAL)[6].link_val,"EVE_INC");
					strcpy((*p_STAT_VAL)[6].link_tag,"F");
					strcpy((*p_STAT_VAL)[2].link_tag,"T");
				 }
				 if(strcmp(p_msg_no,"551C05")==0)
				 {
					strcpy((*p_STAT_VAL)[3].link_tag,"ENTITLEMENT CHANGE");
					strcpy((*p_STAT_VAL)[4].link_tag,APL_NULL_STRING);
					strcpy((*p_STAT_VAL)[5].link_val,"551C05");
					strcpy((*p_STAT_VAL)[5].link_tag,"T");
					strcpy((*p_STAT_VAL)[6].link_val,"EVE_INC");
					strcpy((*p_STAT_VAL)[6].link_tag,"F");
					strcpy((*p_STAT_VAL)[2].link_tag,"T");
				 }
			if ( (strcmp(p_msg_no,"551R01")==0) || (strcmp(p_msg_no, "564R91") == 0) )
		  {            
					strcpy((*p_STAT_VAL)[3].link_tag,"EVENT REVERSAL");
					strcpy((*p_STAT_VAL)[4].link_tag,APL_NULL_STRING);
					
					strcpy((*p_STAT_VAL)[5].link_val,p_msg_no);
					strcpy((*p_STAT_VAL)[5].link_tag,"T");
					strcpy((*p_STAT_VAL)[6].link_val,"EVE_INC");
					strcpy((*p_STAT_VAL)[6].link_tag,"T");
					strcpy((*p_STAT_VAL)[2].link_tag,"F");
				
					CO_SplitStr(l_ms_msgent_structa_a.proc_data,
							';', &int_noelem, &chr_l_param);  

					strcpy((*p_STAT_VAL)[9].link_val,"FUNCTION");
					if (strcmp(chr_l_param[1],APL_NULL_STRING)==0)
						strcpy((*p_STAT_VAL)[9].link_tag,"CANC");
					else if (strcmp(chr_l_param[1],"1")==0)
						strcpy((*p_STAT_VAL)[9].link_tag,"WITH");
				
				 }
				 if(strcmp(p_msg_no,"551R02")==0)
		  {            
					strcpy((*p_STAT_VAL)[3].link_tag,"EVENT ENTITLEMENT REVERSAL");
					strcpy((*p_STAT_VAL)[4].link_tag,APL_NULL_STRING);
					strcpy((*p_STAT_VAL)[5].link_val,"551R02");
					strcpy((*p_STAT_VAL)[5].link_tag,"T");
					strcpy((*p_STAT_VAL)[6].link_val,"EVE_INC");
					strcpy((*p_STAT_VAL)[6].link_tag,"F");
					strcpy((*p_STAT_VAL)[2].link_tag,"T");
				 }
				 if(strcmp(p_msg_no,"551R03")==0)
		  {            
					strcpy((*p_STAT_VAL)[3].link_tag,"ENTITLEMENT REVERSAL");
					strcpy((*p_STAT_VAL)[4].link_tag,APL_NULL_STRING);
					strcpy((*p_STAT_VAL)[5].link_val,"551R03");
					strcpy((*p_STAT_VAL)[5].link_tag,"T");
					strcpy((*p_STAT_VAL)[6].link_val,"EVE_INC");
					strcpy((*p_STAT_VAL)[6].link_tag,"F");
					strcpy((*p_STAT_VAL)[2].link_tag,"T");
				 }
				 strcpy((*p_STAT_VAL)[7].link_val,"SSREG");
				 strcpy((*p_STAT_VAL)[7].link_tag,chr_h_process_reg_flg);

				 
				 if ( (strcmp(p_msg_no,"551R01")!=0) && (strcmp(p_msg_no, "564R91") != 0) )
				 {
				 strcpy((*p_STAT_VAL)[9].link_val,"CNTRY_BIC");
				 strcpy((*p_STAT_VAL)[9].link_tag,l_mt_message_sys_params_struct_h.swift_cd);
				 strcpy((*p_STAT_VAL)[10].link_val,"");
				 strcpy((*p_STAT_VAL)[10].link_tag,"");
				 }
				 else
				 {
				 strcpy((*p_STAT_VAL)[10].link_val,"CNTRY_BIC");
				 strcpy((*p_STAT_VAL)[10].link_tag,l_mt_message_sys_params_struct_h.swift_cd);
				 strcpy((*p_STAT_VAL)[11].link_val,"");
				 strcpy((*p_STAT_VAL)[11].link_tag,"");
				 }
				 

		
				 strcpy((*p_SEL_VAL)[0].link_val,"RES_INSTR_CODE");
				 strcpy((*p_SEL_VAL)[1].link_val,"STPOS");
				 strcpy((*p_SEL_VAL)[2].link_val,"CLN_CODE");
				 strcpy((*p_SEL_VAL)[3].link_val,"CA_EVENT");
				 strcpy((*p_SEL_VAL)[4].link_val,"INSTR_CODE");
				 strcpy((*p_SEL_VAL)[5].link_val,"TEVENTID");
				 if(strcmp(p_msg_no,"551N01") == 0 ||
					strcmp(p_msg_no,"551C01") == 0 ||
					strcmp(p_msg_no,"551R01") == 0 ||
					strcmp(p_msg_no,"564N91") == 0 || 
					strcmp(p_msg_no,"564R91") == 0 )
					strcpy((*p_SEL_VAL)[6].link_val,"LNOTE_NBR");
				 else
					strcpy((*p_SEL_VAL)[6].link_val,"LENTNOTE_NO");
				 strcpy((*p_SEL_VAL)[7].link_val,"NPOS");
				 strcpy((*p_SEL_VAL)[8].link_val,"INSTR_TYPE");
				 strcpy((*p_SEL_VAL)[9].link_val,"NEGPOSN"); 
			
				 if(strcmp(p_msg_no,"551N02") == 0 ||
					 strcmp(p_msg_no,"551R03") == 0 ||
					 strcmp(p_msg_no,"551C05") == 0 ) 
					               
				 {
					strcpy((*p_SEL_VAL)[10].link_val,"INSTR_INC_BAL");
					strcpy((*p_SEL_VAL)[11].link_val,"CCCYCODE");
					strcpy((*p_SEL_VAL)[12].link_val,"EARNINGS");
					strcpy((*p_SEL_VAL)[13].link_val,"RATE_INC");
					strcpy((*p_SEL_VAL)[14].link_val,"CORP_ID");
			                strcpy((*p_SEL_VAL)[15].link_val,"EARNINGS_RATE");	
                                        strcpy((*p_SEL_VAL)[16].link_val,"OP_EVT_CLASS"); /*Vaibhav KOTAK-UAT I-Solve:332*/ 
					strcpy((*p_SEL_VAL)[17].link_val,"");
					strcpy((*p_SEL_VAL)[17].link_tag,"");
				 }
				 
				 
				 else if ((strcmp(p_msg_no,"551N01") == 0) || (strcmp(p_msg_no,"551R01") == 0) || (strcmp(p_msg_no,"564N91") == 0 ) || (strcmp(p_msg_no,"564R91") == 0) )
				 {
					strcpy((*p_SEL_VAL)[10].link_val,"NEW_SAFEK_QTY");
					strcpy((*p_SEL_VAL)[11].link_val,"OLD_STK_QTY");
					strcpy((*p_SEL_VAL)[12].link_val,"SUB_NEW_QUANTITY");
					(*p_SEL_VAL)[12].NUM_VAL = 0.0;  
					strcpy((*p_SEL_VAL)[13].link_val,"SUB_BASE_QUANTITY");
					(*p_SEL_VAL)[13].NUM_VAL = 0.0; 
					
					strcpy((*p_SEL_VAL)[14].link_val,"CORP_ID");
					strcpy((*p_SEL_VAL)[15].link_val,"PRELIM"); 
					
					strcpy((*p_SEL_VAL)[16].link_val,"STOCK_RATE");
					strcpy((*p_SEL_VAL)[17].link_val,"DISP_OF_FRACT");
					
					strcpy((*p_SEL_VAL)[18].link_val,"NOMINAL_VALUE");
					strcpy((*p_SEL_VAL)[19].link_val,"ELIG_ENTITL_POS");
					strcpy((*p_SEL_VAL)[20].link_val,"EARNINGS_RATE");
					/***(*p_SEL_VAL)[20].NUM_VAL = 0.0; **/
					strcpy((*p_SEL_VAL)[21].link_val,"EARNINGS");
					/***(*p_SEL_VAL)[21].NUM_VAL = 0.0;***/
					if ( (strcmp(p_msg_no,"564N91")==0) || (strcmp(p_msg_no,"564R91") == 0) )
					{
						strcpy((*p_SEL_VAL)[22].link_val,"EVENT_IND");
                  strcpy((*p_SEL_VAL)[23].link_val,"");
                  strcpy((*p_SEL_VAL)[24].link_val,"");
				   }
					else
					{
                  strcpy((*p_SEL_VAL)[22].link_val,"NEW_RESPONS_DT");  
                  strcpy((*p_SEL_VAL)[23].link_val,"NEW_BUYRESP_DT");
                  strcpy((*p_SEL_VAL)[24].link_val,"NEW_SELLRESP_DT"); 
					}		
				 
					/* Vedavati for Email Messages*/
				  
					EXEC SQL SELECT INT_TYP into :chr_l_int FROM MT_INSTRUMENT a , CAEVENT b
				  	WHERE  a.INSTR_CODE =  b.INSTR_CODE;
					
				 	strcpy((*p_SEL_VAL)[25].link_val,"INTEREST_TYPE"); /* Vedavati*/
					strcpy((*p_SEL_VAL)[25].link_tag,chr_l_int);
					strcpy((*p_SEL_VAL)[26].link_val,"PART_REDEM");
					strcpy((*p_SEL_VAL)[27].link_val,"OP_EVT_CLASS");
					strcpy((*p_SEL_VAL)[28].link_val,"");
					strcpy((*p_SEL_VAL)[28].link_tag,"");
				 }
				 
				 else
				 {
					
					strcpy((*p_SEL_VAL)[10].link_val,"CORP_ID");
					strcpy((*p_SEL_VAL)[11].link_val,"PART_REDEM");
					strcpy((*p_SEL_VAL)[12].link_val,"OP_EVT_CLASS");
					strcpy((*p_SEL_VAL)[13].link_val,"");
					strcpy((*p_SEL_VAL)[13].link_tag,"");
				 }
			
		  strcpy(chr_l_sel_msg_stmt,"select a.instr_code,substr(to_char(a.DECLARE_DT,'YYMMDD'),1,6) as DECLARE_DT,");
		  strcat(chr_l_sel_msg_stmt,"substr(to_char(a.DECLARE_DT,'DD-MM-YYYY'),1,10) as EM_DECLARE_DT,");
				strcat(chr_l_sel_msg_stmt,"a.CA_EVENT,a.EVNT_INDNT,decode(c.INSTR_TYPE,'FMT','PCT',a.CA_CURRENCY) as IRTTYPE,");
		  strcat(chr_l_sel_msg_stmt,"decode(a.EXPIRY_DATE,NULL,NULL,substr(to_char(a.EXPIRY_DATE,'YYMMDD'),1,6)) as EXPIRY_DATE,decode(a.EX_DATE,NULL,NULL,substr(to_char(a.EX_DATE,'YYMMDD'),1,6)) as EX_DATE,");
		  strcat(chr_l_sel_msg_stmt,"decode(a.EX_DATE,NULL,NULL,substr(to_char(a.EX_DATE,'DD-MM-YYYY'),1,10)) as EM_EX_DATE,");
		  strcat(chr_l_sel_msg_stmt,"decode(a.RESPONSE_DATE,NULL,NULL,substr(to_char(a.RESPONSE_DATE,'YYMMDD'),1,6)) as RESPONSE_DATE,");
		  strcat(chr_l_sel_msg_stmt,"decode(a.REC_DATE,NULL,NULL,substr(to_char(a.REC_DATE,'YYMMDD'),1,6)) as REC_DATE,");
		  strcat(chr_l_sel_msg_stmt,"decode(a.REC_DATE,NULL,NULL,substr(to_char(a.REC_DATE,'DD-MM-YYYY'),1,10)) as EM_REC_DATE,");
		  strcat(chr_l_sel_msg_stmt,"decode(a.BC_FROM_DATE,NULL,NULL,substr(to_char(a.BC_FROM_DATE,'YYMMDD'),1,6)) as BC_DATE,");
		  strcat(chr_l_sel_msg_stmt,"decode(a.dateof_payment,NULL,NULL,substr(to_char(a.dateof_payment,'YYMMDD'),1,6)) as dateof_payment,");
		  strcat(chr_l_sel_msg_stmt,"decode(a.dateof_payment,NULL,NULL,substr(to_char(a.dateof_payment,'DD-MM-YYYY'),1,10)) as EM_DATEOF_PAYMENT,");
		  strcat(chr_l_sel_msg_stmt,"decode(a.PART_PYMT_DT,NULL,NULL,substr(to_char(a.PART_PYMT_DT,'YYMMDD'),1,6)) as PART_PYMT_DT,");
		  strcat(chr_l_sel_msg_stmt,"decode(a.PART_PYMT_DT,NULL,NULL,substr(to_char(a.PART_PYMT_DT,'DD-MM-YYYY'),1,10)) as EM_PART_PYMT_DT,");
	//Modified by Anjaneyulu on 01/10/2015 for ISKB_1621: Swift Message Upgradation - Start
		if(strcmp(p_msg_no,"551C05") == 0)
		{
			IF_COND_EXISTS("CA_RATE_INC_X_FACE","CA_RATE_INC_X_FACE")
			{
				Alert("Gone inside if country condition");
				strcat(chr_l_sel_msg_stmt,"a.INFO_SEQ as LNOTE_NBR,a.ENTITL_INFONO as LENTNOTE_NO,a.RES_INSTR_CODE,to_char(decode(a.EARNINGS,NULL,'0',0,'0',a.EARNINGS),'9999999999999990.99999999') as EARNINGS, to_char(decode(a.EARNINGS,NULL,'0',0,'0',a.EARNINGS),'9999999999999990.99999999') as TEARNINGS,decode(a.RHTS_CLASS,'Y','SALABLE','N','NONSALE','UNKNOWN') as RHTS_CLASS,decode(a.EARNINGS_RATE,NULL,'0',0,'0',(a.EARNINGS_RATE * C.NOMINAL_VALUE)) as RATE_INC,");			///change is in the last value where earnings rate is multipled with nominal/face value
			}
			else
			{
				Alert("Gone inside else of country condition");
				strcat(chr_l_sel_msg_stmt,"a.INFO_SEQ as LNOTE_NBR,a.ENTITL_INFONO as LENTNOTE_NO,a.RES_INSTR_CODE,to_char(decode(a.EARNINGS,NULL,'0',0,'0',a.EARNINGS),'9999999999999990.99999999') as EARNINGS, to_char(decode(a.EARNINGS,NULL,'0',0,'0',a.EARNINGS),'9999999999999990.99999999') as TEARNINGS,decode(a.RHTS_CLASS,'Y','SALABLE','N','NONSALE','UNKNOWN') as RHTS_CLASS,decode(a.EARNINGS_RATE,NULL,'0',0,'0',a.EARNINGS_RATE) as RATE_INC,");
			}
		}
		else
		{
			Alert("Gone inside else");
		  strcat(chr_l_sel_msg_stmt,"a.INFO_SEQ as LNOTE_NBR,a.ENTITL_INFONO as LENTNOTE_NO,a.RES_INSTR_CODE,to_char(decode(a.EARNINGS,NULL,'0',0,'0',a.EARNINGS),'9999999999999990.99999999') as EARNINGS, to_char(decode(a.EARNINGS,NULL,'0',0,'0',a.EARNINGS),'9999999999999990.99999999') as TEARNINGS,decode(a.RHTS_CLASS,'Y','SALABLE','N','NONSALE','UNKNOWN') as RHTS_CLASS,decode(a.EARNINGS_RATE,NULL,'0',0,'0',a.EARNINGS_RATE) as RATE_INC,");
		}
		//Modified by Anjaneyulu on 01/10/2015 for ISKB_1621: Swift Message Upgradation - End
		  strcat(chr_l_sel_msg_stmt,"substr(concat(decode(a.NEW_SAFEK_QTY,NULL,'0',0,'0',a.NEW_SAFEK_QTY),concat(':',decode(a.OLD_STK_QTY,NULL,'0',0,'0',a.OLD_STK_QTY))),1,15) as RATIO,");
		
			

	

	strcat(chr_l_sel_msg_stmt,"decode(a.SUB_PR,0,'0',NULL,'0',a.SUB_PR) as SUB_PR,substr(concat(decode(SUB_BASE_QUANTITY,NULL,'0',0,'0',a.SUB_BASE_QUANTITY),concat(':',decode(a.SUB_NEW_QUANTITY,NULL,'0',0,'0',a.SUB_NEW_QUANTITY))),1,14) as SUB_RATIO,substr(concat(decode(a.SUB_NEW_QUANTITY,NULL,'0',0,'0',a.SUB_NEW_QUANTITY),concat(':',decode(a.SUB_BASE_QUANTITY,NULL,'0',0,'0',a.SUB_BASE_QUANTITY))),1,14)as REV_SUB_RATIO,");

		  strcat(chr_l_sel_msg_stmt,"a.DISP_OF_FRACT,a.PRELIMINARY_FLAG as PRELIM,decode(a.NEW_SAFEK_RT,NULL,'0',0,'0',a.NEW_SAFEK_RT) as STOCK_RATE,");

		  strcat(chr_l_sel_msg_stmt, " b.CLN_FRACT_IND as FRACT_IND, '");  	
        strcat(chr_l_sel_msg_stmt, chr_l_keep_fract_temp);
        strcat(chr_l_sel_msg_stmt, "' as FRACT_COND,");
		  strcat(chr_l_sel_msg_stmt,"substr(concat(a.instr_code,concat(concat(to_char(to_date(a.DECLARE_DT),'YY'),lpad(((to_date(a.DECLARE_DT) - to_date(concat(concat('01/01/',to_char(a.DECLARE_DT,'YYYY')),' 12:00:00')))+1),3,'0')),lpad(substr(to_char(a.EVNT_INDNT),1,2),2,'0'))),1,16) as TEVENTID,");
		  strcat(chr_l_sel_msg_stmt,"b.CLN_USE_ISIN_IND as FLGISIN,b.CLN_ALLOW_REGIND as CANREG,");
		  strcat(chr_l_sel_msg_stmt,"decode(c.INSTR_TYPE,'BON',decode(b.CLN_FMT_RPTIND,'Y','FMT'");
		  strcat(chr_l_sel_msg_stmt,",c.INSTR_TYPE),c.INSTR_TYPE) as FTYPEOFINSTR,c.INSTR_ISIN,c.INSTR_TYPE,decode(a.EARNINGS_RATE,NULL,'0',0,'0',a.EARNINGS_RATE) as EARNINGS_RATE,decode(a.EARNINGS_RATE,NULL,'0',0,'0',a.EARNINGS_RATE) as R_EARNINGS, ");
				 if( strcmp(p_msg_no,"551N01") != 0  &&
					  strcmp(p_msg_no,"551C01") != 0  &&
					  strcmp(p_msg_no,"551R01") != 0  &&
					  strcmp(p_msg_no,"564N91") != 0  &&
					  strcmp(p_msg_no,"564R91") != 0)
				 {
	  	/*Added by anjaneyulu on 21/09/2015 for ISKB_1621 starts */
		if(strcmp(p_msg_no,"551C05") == 0)
		{
			EXEC SQL SELECT NVL(ELIG_ENTITL_POS,0) INTO :l_elig_qty FROM CAENTITLEMENT WHERE CORP_ID=:chr_l_ca_id 
				AND CLIENT=:l_ms_msgent_structa_a.client;
			IS_ANY_ORA_ERROR
		}
		if((APL_DOUBLE_EQUAL(l_elig_qty,0)) && (strcmp(p_msg_no,"551C05") == 0))
		{
				strcat(chr_l_sel_msg_stmt,"(SELECT decode(c.INSTR_TYPE,'BON',decode(b.CLN_FMT_RPTIND,'Y',to_char((d.PREV_ELIG_HOLD)*c.NOMINAL_VALUE),to_char((d.PREV_ELIG_HOLD))),to_char((d.PREV_ELIG_HOLD))) FROM CAEVENT A, MT_CLIENT B, MT_INSTRUMENT C, CA_REV_ENTITLE d WHERE A.CORP_ID = D.CORP_ID AND A.INSTR_CODE = C.INSTR_CODE AND B.CLN_CODE = D.CLIENT AND d.CORP_ID = '");
				strcat(chr_l_sel_msg_stmt,chr_l_ca_id);
				strcat(chr_l_sel_msg_stmt,"' AND d.CLIENT ='");
				
				strcat(chr_l_sel_msg_stmt,l_ms_msgent_structa_a.client);
				strcat(chr_l_sel_msg_stmt,"') as FENT_POS,");
		}
		else
		{
	  	strcat(chr_l_sel_msg_stmt,"decode(c.INSTR_TYPE,'BON',decode(b.CLN_FMT_RPTIND,'Y',to_char((d.ELIG_ENTITL_POS)*c.NOMINAL_VALUE),to_char((d.ELIG_ENTITL_POS))),to_char((d.ELIG_ENTITL_POS))) as FENT_POS,");
		}
       /*Added by anjaneyulu on 21/09/2015 for ISKB_1621 - Ends */
		
      strcat(chr_l_sel_msg_stmt,"to_char(decode(a.EARNINGS,0,(decode(a.EARNINGS_RATE,0,0,to_char((d.ELIG_ENTITL_POS)*c.NOMINAL_VALUE))),to_char((d.ELIG_ENTITL_POS)))) as FENT_POSBI, ");
          }
			 
	  strcat(chr_l_sel_msg_stmt,"concat('/',b.cln_code) as NACCOUNT,b.cln_code,b.cln_code as CLIENT,substr(replace(replace(b.cln_name,chr(13),NULL),chr(10),NULL),1,35) as CLNT_NAME,b.CLN_FMT_RPTIND,");
			 
	  strcat(chr_l_sel_msg_stmt,"c.INSTR_ISIN,c.REG_BR_IND,");
	  strcat(chr_l_sel_msg_stmt,"concat('/',concat(concat(c.currency_cd,'/'),c.REG_BR_IND)) as SECCCY,substr(replace(replace(c.instr_name,chr(13),NULL),chr(10),NULL),1,35) as INSTR_NAME,");
     
	  #ifdef EMU_PROCESSING
     	strcat(chr_l_sel_msg_stmt,"c.INSTR_TYPE,c.NOMINAL_VALUE,a.CA_CURRENCY as CCYINSTR_INC_BAL,a.CA_CURRENCY as CURRENCY_CD,");
	  #else
     	strcat(chr_l_sel_msg_stmt,"c.INSTR_TYPE,c.NOMINAL_VALUE,c.currency_cd ,");
	  #endif
     
	  strcat(chr_l_sel_msg_stmt,"c.currency_cd as CCYTEARNINGS,");
 
     strcat(chr_l_sel_msg_stmt,"c.currency_cd as CCYR_EARNINGS, " );

     if( strcmp(g_mt_commonsys_params_struct_h.nation_code,"TR") == 0  ) 
         strcat(chr_l_sel_msg_stmt," '12' as DECTEARNINGS , '12' as DECR_EARNINGS,");
     else
         strcat(chr_l_sel_msg_stmt," '12' as DECTEARNINGS , '12' as DECR_EARNINGS,");

	  strcat(chr_l_sel_msg_stmt,"c.currency_cd as CCYRATE_INC,");
	  strcat(chr_l_sel_msg_stmt,"c.currency_cd as CCYSTOCK_RATE,");
	  strcat(chr_l_sel_msg_stmt,"c.currency_cd as CCYSUB_PRICE,");
	  strcat(chr_l_sel_msg_stmt,"c.currency_cd as CCYINSTR_INC_BAL,");
	  #ifdef EMU_PROCESSING
	  strcat(chr_l_sel_msg_stmt,"'2' as DECCINCOME,'12' as DECTEARNINGS,  '2' as DECCINCOME_RT, '12' as DECR_EARNINGS, ");
		#else
		strcat(chr_l_sel_msg_stmt,"'12' as DECTEARNINGS, '2' as DECCINCOME_RT, '12' as DECR_EARNINGS, ");
		
	  #endif
	  strcat(chr_l_sel_msg_stmt,"'12' as DECRATE_INC,");
	  strcat(chr_l_sel_msg_stmt,"'12' as DECSTOCK_RATE,");
	  
	  strcat(chr_l_sel_msg_stmt," b.CLN_TAXABLE_IND  as IND_83C83D");
	  
          if( strcmp(p_msg_no,"551N01") != 0  &&
              strcmp(p_msg_no,"551C01") != 0  &&
              strcmp(p_msg_no,"551R01") != 0  &&
				  strcmp(p_msg_no,"564N91") != 0  &&
				  strcmp(p_msg_no,"564R91") != 0 )
          {
	  	strcat(chr_l_sel_msg_stmt,",decode(abs(d.INSTR_INC_BAL),NULL,'0',0,'0',to_char(abs(d.INSTR_INC_BAL))) as INSTR_INC_BAL,");
	  	strcat(chr_l_sel_msg_stmt,"to_char(abs(d.QUANTITY_BAL)) as QUANTITY_BAL,to_char(abs(d.ELIG_ENTITL_POS)) as ELIG_ENTITL_POS ");
	  
	  	strcat(chr_l_sel_msg_stmt,",decode(d.ELIG_ENTITL_POS,abs(d.ELIG_ENTITL_POS),'N','Y') as NEGPOSN ");
		 
		strcat(chr_l_sel_msg_stmt,",d.CCY_FOR_ENTITL as CCCYCODE ");
		 
          }
          else
			 
			 {
                strcat(chr_l_sel_msg_stmt,",'0' as INSTR_INC_BAL ");
					 #ifdef EMU_PROCESSING
						if( strcmp(p_msg_no,"551N01") == 0)
						{
							strcat(chr_l_sel_msg_stmt," ,decode(a.CA_EVENT,'RN','");
							strcat(chr_l_sel_msg_stmt,chr_l_emu_effd_8);
							strcat(chr_l_sel_msg_stmt,"',NULL)  as EFFD,");
							strcat(chr_l_sel_msg_stmt," decode(a.CA_EVENT,'RN','");
							strcat(chr_l_sel_msg_stmt,chr_l_emu_mnva);
							strcat(chr_l_sel_msg_stmt,"',NULL)  as MNVA ");
						}
					#endif
			}	
			
	 

	       
			
			 strcat(chr_l_sel_msg_stmt,",substr(to_char(a.DECLARE_DT,'YYYYMMDD'),1,8) as NEW_DECL_DT, ");
			 strcat(chr_l_sel_msg_stmt,"substr(to_char(a.DECLARE_DT,'DD-MM-YYYY'),1,10) as EM_DECL_DT, ");
			 strcat(chr_l_sel_msg_stmt,"substr(to_char(a.REC_DATE,'YYYYMMDD'),1,8) as NEW_REC_DT, ");
			 strcat(chr_l_sel_msg_stmt,"substr(to_char(a.BC_FROM_DATE,'YYYYMMDD'),1,8) as NEW_BC_DT, ");
			 strcat(chr_l_sel_msg_stmt,"substr(to_char(a.BC_FROM_DATE,'DD-MM-YYYY'),1,10) as EM_BC_DT, ");
			 strcat(chr_l_sel_msg_stmt,"substr(to_char(a.BC_TO_DATE,'DD-MM-YYYY'),1,10) as EM_BC_TO_DT, ");//Added by Gouse for Intimation mail for OT Event 
			 strcat(chr_l_sel_msg_stmt,"substr(to_char(a.EX_DATE,'YYYYMMDD'),1,8) as NEW_EX_DT, ");
               
          strcat(chr_l_sel_msg_stmt,"substr(to_char(a.RESPONSE_DATE,'YYYYMMDDhh24miss'),1,14) as NEW_RESPONS_DT, ");
          strcat(chr_l_sel_msg_stmt,"substr(to_char(a.RESPONSE_DATE,'DD-MM-YYYY hh24:mi:ss'),1,19) as EM_RESPONS_DT, ");
          strcat(chr_l_sel_msg_stmt,"substr(to_char(a.RESPONSEDT_BUY,'YYYYMMDDhh24miss'),1,14) as NEW_BUYRESP_DT,");
          strcat(chr_l_sel_msg_stmt,"substr(to_char(a.SELL_RESP_DATE,'YYYYMMDDhh24miss'),1,14) as NEW_SELLRESP_DT,");
              
			 strcat(chr_l_sel_msg_stmt,"substr(to_char(a.dateof_payment,'YYYYMMDD'),1,8) as NEW_PAY_DT, ");
			 strcat(chr_l_sel_msg_stmt,"substr(to_char(a.EXPIRY_DATE,'YYYYMMDD'),1,8) as NEW_EXPIRE_DT, ");
			 strcat(chr_l_sel_msg_stmt,"substr(to_char(a.PART_PYMT_DT,'YYYYMMDD'),1,8) as NEW_PP_DT, ");
			 strcat(chr_l_sel_msg_stmt,"substr(to_char(a.EFFECTIVE_DATE,'YYYYMMDD'),1,8) as NEW_EFFD_DT, ");
			 strcat(chr_l_sel_msg_stmt,"substr(to_char(a.EFFECTIVE_DATE,'DD-MM-YYYY'),1,10) as EM_EFFD_DT, ");
			 strcat(chr_l_sel_msg_stmt,"a.NEW_SAFEK_QTY, a.OLD_STK_QTY, ");
			 strcat(chr_l_sel_msg_stmt,"a.SUB_NEW_QUANTITY, a.SUB_BASE_QUANTITY, ");  
			 strcat(chr_l_sel_msg_stmt,"substr(concat(concat(decode(a.OLD_STK_QTY,NULL,'0',0,'0',a.OLD_STK_QTY),':'),decode(a.NEW_SAFEK_QTY,NULL,'0',0,'0',a.NEW_SAFEK_QTY)),1,15) as TRATIO ");
			

         
         strcat(chr_l_sel_msg_stmt,", substr(to_char(a.DEAL_FRM_DATE,'YYYYMMDD'),1,8) as NEW_TRADEFROM_DT, ");
         strcat(chr_l_sel_msg_stmt," substr(to_char(a.DEAL_FRM_DATE,'DD-MM-YYYY'),1,10) as EM_TRADEFROM_DT, ");
         strcat(chr_l_sel_msg_stmt,"substr(to_char(a.DEAL_TO_DATE,'YYYYMMDD'),1,8) as NEW_TRADETO_DT, ");
         strcat(chr_l_sel_msg_stmt,"substr(to_char(a.DEAL_TO_DATE,'DD-MM-YYYY'),1,10) as EM_TRADETO_DT, ");
         strcat(chr_l_sel_msg_stmt,"substr(to_char(a.SUBSCR_DATE,'YYYYMMDD'),1,8) as NEW_SUBS_DT, ");
         strcat(chr_l_sel_msg_stmt,"substr(to_char(a.SUBSCR_DATE,'DD-MM-YYYY'),1,10) as EM_SUBS_DT, ");
         strcat(chr_l_sel_msg_stmt,"substr(to_char(a.POST_DATE,'YYYYMMDD'),1,8) as NEW_POSTING_DT, ");
         strcat(chr_l_sel_msg_stmt,"a.OVER_SUBSCRP, a.DIVIDEND_TYPE ");
         strcat(chr_l_sel_msg_stmt,",DECODE(a.OVER_SUBSCRP,'V','VOLUNTARY','M','MANDATORY',a.OVER_SUBSCRP) as OVER_SUBSCRP1 ");//Commented and deocde added by Gouse - 19/10/2013 - Intimation mail for OT Event
         

			 strcat(chr_l_sel_msg_stmt, ", a.corp_id as CORP_ID ");  
			
 			 
			
			if( strcmp(p_msg_no,"551N01") != 0 && strcmp(p_msg_no,"551C01") != 0 && strcmp(p_msg_no,"551R01") != 0  
					&& (strcmp(p_msg_no,"564N91") != 0) &&  (strcmp(p_msg_no,"564R91") != 0)) 
				strcat(chr_l_sel_msg_stmt,",substr(to_char(d.access_stamp,'YYYYMMDDHH24MISS'),1,14) as ACC_STMP");
				

          
             strcat(chr_l_sel_msg_stmt,",a.FRACT_PR as FRACT_PR, a.CA_CURRENCY as CCYF_PRICE");
				 strcat(chr_l_sel_msg_stmt,",a.DIVIDEND_TYPE as NEW_DEF_OPT "); 
				 strcat(chr_l_sel_msg_stmt,",a.OP_EVT_CLASS as OP_EVT_CLASS "); 
                                /* VaibhavK INCUS107 Kotak_Uat 31Oct2007 */ 
				 strcat(chr_l_sel_msg_stmt,",decode(a.OP_EVT_CLASS,'AC','ACTV','DL','DLST','DV','DECR','IV','INCR','NM','CHAN','SS','SUSP','AI','OTHR','OT','OTHR') as EVENT_IND ");  /*** OTHR added ***/
				 strcat(chr_l_sel_msg_stmt,",decode(a.OP_EVT_CLASS,'AC','ACTIVATE TRADING','DL','STOCK DELIST','DV','VALUE DECREASE','IV','VALUE INCREASE','NM','NAME CHANGE','SS','SUSPEND TRADING','AI','INTEREST RATE ADJUSTMENT','OT','OTHER ANNOUNCEMENT') as EVENT_IND1,a.exch_code as EXCH_CD_OT ");  /*** Added by Gouse for Intimation mail for OT Event ***/
         
   	/* Vedavati- fields added for events - RTS, NIS, BB */ 
		if((strcmp(p_msg_no, "551N01") ==0) || (strcmp(p_msg_no, "551C01") ==0) || (strcmp(p_msg_no, "551R01") ==0))
	{
      strcat(chr_l_sel_msg_stmt,",a.QIB_MARGIN as QIB_MARGIN ,a.issue_size as ISSUE_SIZE,a.face_value as FACE_VALUE ");
      strcat(chr_l_sel_msg_stmt,",c.currency_cd as CCYQIB_MARGIN , '12' as DECQIB_MARGIN ");
      strcat(chr_l_sel_msg_stmt,",c.currency_cd as CCYFACE_VALUE , '12' as DECFACE_VALUE ");
          strcat(chr_l_sel_msg_stmt,", a.REDEM_RT as REDEM_RATE, c.currency_cd as CCYREDEM_RATE, decode(a.redem_rt ,c.nominal_value,'N','Y') as PART_REDEM,  ");
	  strcat(chr_l_sel_msg_stmt,"'12' as DECREDEM_RATE , decode(a.EARNINGS, '0','PCT',NULL,'PCT',a.CA_CURRENCY)as RDIRTTYPE ");
		  strcat(chr_l_sel_msg_stmt,",substr(to_char(a.BC_TO_DATE,'YYYYMMDD'),1,8) as RTS_SUBS_CLS");
		  strcat(chr_l_sel_msg_stmt,",substr(to_char(a.BC_TO_DATE,'DD-MM-YYYY'),1,10) as EM_RTS_SUBS_CLS");
		  strcat(chr_l_sel_msg_stmt,", c.INT_TYP as INTEREST_TYPE");
		  strcat(chr_l_sel_msg_stmt,", decode(c.NOMINAL_VALUE,a.REDEM_RT,'FULL REDEMPTION','PART REDEMPTION')as REDEMPTION_TYPE");
		
		  strcat(chr_l_sel_msg_stmt,", a.LWR_LIMIT as LOWER_LIMIT");
		  strcat(chr_l_sel_msg_stmt,", a.UPR_LIMIT as UPPER_LIMIT");
		  strcat(chr_l_sel_msg_stmt,", a.BK_BUILD_IND as FIXED_PRICE");
		  strcat(chr_l_sel_msg_stmt,", a.TICK_SIZE as TICK_SIZE");
		  strcat(chr_l_sel_msg_stmt,", a.MARKET_LOT as MARKET_LOT");
		  strcat(chr_l_sel_msg_stmt,", a.MAX_RTL_QTY as MAX_RTL_QTY");
		  strcat(chr_l_sel_msg_stmt,", c.currency_cd as CCYLOWER_LIMIT , '12' as DECLOWER_LIMIT");
		  strcat(chr_l_sel_msg_stmt,", c.currency_cd as CCYUPPER_LIMIT , '12' as DECUPPER_LIMIT");
		  strcat(chr_l_sel_msg_stmt,", c.currency_cd as CCYTICK_SIZE , '12' as DECTICK_SIZE");	
	  		/* strcat(chr_l_sel_msg_stmt,", substr(concat(a.instr_code,concat(concat(to_char(to_date(a.DECLARE_DT),'YY'),lpad(((to_date(a.DECLARE_DT) - to_date(concat(concat('01/01/',to_char(a.DECLARE_DT,'YYYY')),' 12:00:00')))+1),3,'0')),lpad(substr(to_char(a.EVNT_INDNT),1,2),2,'0'))),1,16) as EVENTID"); PJ  Event Id getting printed twice */
      }
		  
          if( strcmp(p_msg_no,"551N01") != 0 &&
              strcmp(p_msg_no,"551C01") != 0 &&
              strcmp(p_msg_no,"551R01") != 0  &&
					strcmp(p_msg_no,"564N91") != 0  &&
					strcmp(p_msg_no,"564R91") != 0 ) 
					{
			        /*strcat(chr_l_sel_msg_stmt,", round(d.CUSTODYTAX_RATE,2) as WHTAX_RT "); 210207 for Entil Taxrt issue*/
				strcat(chr_l_sel_msg_stmt,", d.CUSTODYTAX_RATE as WHTAX_RT ");

			        strcat(chr_l_sel_msg_stmt,", '12' as DECWHTAX_RT ");
               }

	  

          
          strcat(chr_l_sel_msg_stmt," ,decode(a.WWWADDR,NULL,NULL,substr(a.WWWADDR,1,35)) as WEBB_ADD1");
          strcat(chr_l_sel_msg_stmt," ,decode(a.WWWADDR,NULL,NULL,substr(a.WWWADDR,36,35)) as WEBB_ADD2");
          strcat(chr_l_sel_msg_stmt," ,decode(a.WWWADDR,NULL,NULL,substr(a.WWWADDR,71,35)) as WEBB_ADD3");
          
		strcat(chr_l_sel_msg_stmt," ,a.REQD_CERTIFY as REQD_CERTIFY,nvl(b.CLN_GENERATE_IND,'N') as CLN_GENERATE_IND ");	

			/**** OT Event ****/     
		if (strcmp (p_msg_no,"564R91")== 0 || strcmp(p_msg_no,"564N91")==0)
		{
			strcat(chr_l_sel_msg_stmt,", decode(a.op_evt_class,'");
			strcat(chr_l_sel_msg_stmt,EVT_OTH);
			strcat(chr_l_sel_msg_stmt,"', ltrim(rtrim(nvl(a.proc_oth,''))),'') As CORP_WITH ");
		}
				 	
			 strcat(chr_l_sel_msg_stmt," from CAEVENT a,MT_CLIENT b,MT_INSTRUMENT c ");
          if( strcmp(p_msg_no,"551N01") != 0 &&
              strcmp(p_msg_no,"551C01") != 0 &&
              strcmp(p_msg_no,"551R01") != 0  &&
					strcmp(p_msg_no,"564N91") != 0  &&
					strcmp(p_msg_no,"564R91") != 0 ) 
                 strcat(chr_l_sel_msg_stmt,",CAENTITLEMENT d ");
	  strcat(chr_l_sel_msg_stmt," where a.instr_code = c.instr_code and a.corp_id = '");
          strcat(chr_l_sel_msg_stmt,chr_l_ca_id);
          strcat(chr_l_sel_msg_stmt,"' ");
          if(strlen(l_ms_msgent_structa_a.client)!=0)
          {
          	strcat(chr_l_sel_msg_stmt," and b.cln_code = '");
          	strcat(chr_l_sel_msg_stmt,l_ms_msgent_structa_a.client);
          	strcat(chr_l_sel_msg_stmt,"' ");
          }
			else 
	  		{
				
				if ( (strcmp(p_msg_no,"564R91") != 0) && (strcmp(p_msg_no,"564N91") != 0)  )
				{ /* Vaibhavk 05Oct2007 Message No: 552N01 and 564N21 are added below for BB Cancellation Messages. */
				strcat(chr_l_sel_msg_stmt," and b.cln_code in (select distinct client from MS_MSGSTAT where proc_init=a.corp_id and swift_msg_rep in ('564N11','551N01','552N01','564N21'))");
				}
	  		}
          if( strcmp(p_msg_no,"551N01") != 0 &&
              strcmp(p_msg_no,"551C01") != 0 &&
              strcmp(p_msg_no,"551R01") != 0 &&
				  strcmp(p_msg_no,"564N91") != 0 &&
				  strcmp(p_msg_no,"564R91") != 0 ) 
          {
	  	strcat(chr_l_sel_msg_stmt," and a.corp_id = d.corp_id and d.client = b.cln_code ");
          }
	  if(strcmp(p_msg_no,"551R01") == 0)
	  {
               /* Vaibhavk 05Oct2007 Message No: 552N01 and 564N21 are added below for BB Cancellation Messages. */ 
		strcat(chr_l_sel_msg_stmt," and b.cln_code IN (select client from MS_MSGSTAT where proc_init = '");
		strcat(chr_l_sel_msg_stmt,chr_l_ca_id);
		strcat(chr_l_sel_msg_stmt,"' and swift_msg_rep IN ('551N01','564N11','552N01','564N21'))");
	  }
	  if(strcmp(p_msg_no,"564R91") == 0)
	  {
		strcat(chr_l_sel_msg_stmt," and b.cln_code IN (select client from MS_MSGSTAT where proc_init = '");
		strcat(chr_l_sel_msg_stmt,chr_l_ca_id);
		strcat(chr_l_sel_msg_stmt,"' and swift_msg_rep IN ('564N91'))");
	  }
	 
	  if(strcmp(p_msg_no,"551R03") == 0)
	  {
		strcat(chr_l_sel_msg_stmt," and b.cln_code IN (select client from MS_MSGSTAT where proc_init = '");
		strcat(chr_l_sel_msg_stmt,chr_l_ca_id);
		strcat(chr_l_sel_msg_stmt,"' and swift_msg_rep IN ('551N02','564N12','551C05','564C15'))");
	  }

          strcat(chr_l_sel_msg_stmt," and b.STATUS != '");
          strcat(chr_l_sel_msg_stmt,STATUS_CLS_AUTH);
          strcat(chr_l_sel_msg_stmt,"' ");
        }

        if(strncmp(p_msg_no,"554",3) == 0)
        {
          l_msgaddr = MCORPACTIONSMSGNO;       
          if(strlen(l_ms_msgent_structa_a.proc_init) != 0)
          {
             strcpy(chr_l_ca_id,l_ms_msgent_structa_a.proc_init);
          }
          else
          {
		APL_DATA_MISSING("CA ID", APL_NULL_STRING, APL_NULL_STRING)
                APL_GOBACK_FAIL
          }
      
          if(strlen(l_ms_msgent_structa_a.proc_data) != 0)
          {
             CO_SplitStr(l_ms_msgent_structa_a.proc_data,
                          ';', &int_noelem, &chr_l_param);
             strcpy(chr_l_refno,chr_l_param[0]);
          }
          else
          {
          if(strcmp(p_msg_no,"554N01")==0 || strcmp(p_msg_no,"554R01")==0)
          {
		APL_DATA_MISSING("Payment Srl Nbr", APL_NULL_STRING, APL_NULL_STRING)
                APL_GOBACK_FAIL
          }
          }
			
          *p_STAT_VAL = realloc(*p_STAT_VAL,sizeof(MS_STATIC_VAL)*9); 
          
			 
			 	
				
				*p_SEL_VAL = realloc(*p_SEL_VAL,sizeof(MS_STATIC_VAL)*25);
			 	
				
			 

          strcpy((*p_STAT_VAL)[0].link_val,"DUMMY");
          /*strcpy((*p_STAT_VAL)[0].link_tag,"DUMMY");*/
          strcpy((*p_STAT_VAL)[0].link_tag,chr_l_ca_id); /*VaibhavK {SP/BI} KOTAK-UAT I-SolveID:341*/
          strcpy((*p_STAT_VAL)[1].link_val,"DOMSEC");
          strcpy((*p_STAT_VAL)[1].link_tag,chr_h_dom_instr);
          strcpy((*p_STAT_VAL)[2].link_val,"DBCR");
          strcpy((*p_STAT_VAL)[3].link_val,"TITLE");
          strcpy((*p_STAT_VAL)[4].link_val,"TEXT");
          if(strcmp(p_msg_no,"554N01")==0)
          {
          	strcpy((*p_STAT_VAL)[2].link_tag,"C");
          	strcpy((*p_STAT_VAL)[3].link_tag,"PAYMENT");
          	strcpy((*p_STAT_VAL)[4].link_tag,APL_NULL_STRING);
          }
          if(strcmp(p_msg_no,"554N02")==0)
          {
          	strcpy((*p_STAT_VAL)[2].link_tag,APL_NULL_STRING);
          	strcpy((*p_STAT_VAL)[3].link_tag,"/ENTITLEMENT NOTICE/");
          	strcpy((*p_STAT_VAL)[4].link_tag,APL_NULL_STRING);
          }
          if(strcmp(p_msg_no,"554C02")==0)
          {
          	strcpy((*p_STAT_VAL)[2].link_tag,APL_NULL_STRING);
          	strcpy((*p_STAT_VAL)[3].link_tag,"/ENTITLEMENT REVISED/");
          	strcpy((*p_STAT_VAL)[4].link_tag,APL_NULL_STRING);
          }
          if(strcmp(p_msg_no,"554R01")==0)
          {
          	strcpy((*p_STAT_VAL)[2].link_tag,"D");
          	strcpy((*p_STAT_VAL)[3].link_tag,"PAYMENT REVERSAL");
          	strcpy((*p_STAT_VAL)[4].link_tag,APL_NULL_STRING);
          }
          if(strcmp(p_msg_no,"554R02")==0)
	  		 {            
          	strcpy((*p_STAT_VAL)[2].link_tag,APL_NULL_STRING);
          	strcpy((*p_STAT_VAL)[3].link_tag,"/ENTITLEMENT REVERSED/");
          	strcpy((*p_STAT_VAL)[4].link_tag,APL_NULL_STRING);
          }
          strcpy((*p_STAT_VAL)[5].link_val,"NATION");
          strcpy((*p_STAT_VAL)[5].link_tag,h_nation_code);
			
			strcpy((*p_STAT_VAL)[6].link_val,"SEQNUM_PAY");
			strcpy((*p_STAT_VAL)[6].link_tag,chr_l_refno);
			
			 
          strcpy((*p_STAT_VAL)[7].link_val,"CNTRY_BIC");
          strcpy((*p_STAT_VAL)[7].link_tag,l_mt_message_sys_params_struct_h.swift_cd);
			 

          strcpy((*p_STAT_VAL)[8].link_val,"");
          strcpy((*p_STAT_VAL)[8].link_tag,"");
	
          strcpy((*p_SEL_VAL)[0].link_val,"CORP_ID");
          strcpy((*p_SEL_VAL)[1].link_val,"INSTR_CODE");
          strcpy((*p_SEL_VAL)[2].link_val,"CLIENT");
          strcpy((*p_SEL_VAL)[3].link_val,"CA_EVENT");
          strcpy((*p_SEL_VAL)[4].link_val,"SEQNUM_PAY");
          strcpy((*p_SEL_VAL)[5].link_val,"TEVENTID");
			 if((strcmp(p_msg_no,"554N02")==0) || (strcmp(p_msg_no,"554C02")==0) || (strcmp(p_msg_no,"554R02")==0))
          strcpy((*p_SEL_VAL)[6].link_val,"ENTITL_INFONO");
			 else
          strcpy((*p_SEL_VAL)[6].link_val,"LNOTE_NBR");

          strcpy((*p_SEL_VAL)[7].link_val,"FMT_RPTIND");
          strcpy((*p_SEL_VAL)[8].link_val,"INSTR_TYPE");
          strcpy((*p_SEL_VAL)[9].link_val,"NEGPOSN"); 
          strcpy((*p_SEL_VAL)[10].link_val,"NOMINAL_VALUE"); 
          strcpy((*p_SEL_VAL)[11].link_val,"TAX_RATE"); 
          strcpy((*p_SEL_VAL)[12].link_val,"EARNINGS_RATE"); 
			
          #ifdef EMU_PROCESSING 
				if(strcmp(p_msg_no,"554N01")==0)
				{
					strcpy((*p_SEL_VAL)[13].link_val,"INETPROC");
					strcpy((*p_SEL_VAL)[14].link_val,"NETPROC");
					strcpy((*p_SEL_VAL)[15].link_val,"ITAX");
					strcpy((*p_SEL_VAL)[16].link_val,"TAX");
					strcpy((*p_SEL_VAL)[17].link_val,"CCCYCODE");
					strcpy((*p_SEL_VAL)[18].link_val,"OTHER_CHRGS");
               
               strcpy((*p_SEL_VAL)[19].link_val,"EARNINGS");
               strcpy((*p_SEL_VAL)[20].link_val,"NEW_FMTFLG");
               strcpy((*p_SEL_VAL)[21].link_val,"NEW_NOMVAL");
	       
	       strcpy((*p_SEL_VAL)[22].link_val,"EARNINGS_RATE");
	       strcpy((*p_SEL_VAL)[23].link_val,"QTY");
               strcpy((*p_SEL_VAL)[24].link_val,"");
               strcpy((*p_SEL_VAL)[24].link_tag,"");
               
				}	
				else
				if(strcmp(p_msg_no,"554N02")==0)	
				{
					strcpy((*p_SEL_VAL)[13].link_val,"CCCYCODE");
					strcpy((*p_SEL_VAL)[14].link_val,"INSTR_INC_BAL");
					strcpy((*p_SEL_VAL)[15].link_val,"EARNINGS");
               				strcpy((*p_SEL_VAL)[16].link_val,"NEW_FMTFLG");
               				strcpy((*p_SEL_VAL)[17].link_val,"NEW_NOMVAL");
					
	       				strcpy((*p_SEL_VAL)[18].link_val,"EARNINGS_RATE");
          				strcpy((*p_SEL_VAL)[19].link_tag,""); 
          				strcpy((*p_SEL_VAL)[19].link_val,""); 
				}
				else
				{
            	strcpy((*p_SEL_VAL)[13].link_val,"NEW_FMTFLG");
            	strcpy((*p_SEL_VAL)[14].link_val,"NEW_NOMVAL");
               strcpy((*p_SEL_VAL)[15].link_val,"CCCYCODE");
                strcpy((*p_SEL_VAL)[16].link_val,"EARNINGS");
					
	       				strcpy((*p_SEL_VAL)[17].link_val,"EARNINGS_RATE");
			 		strcpy((*p_SEL_VAL)[18].link_val,"");
			 		strcpy((*p_SEL_VAL)[18].link_tag,"");
				}
			 #else
			 	strcpy((*p_SEL_VAL)[13].link_val,"CURRENCY_CD"); 
			        strcpy((*p_SEL_VAL)[14].link_val,"NEW_FMTFLG");
            			strcpy((*p_SEL_VAL)[15].link_val,"NEW_NOMVAL");
					
			 	strcpy((*p_SEL_VAL)[16].link_val,"EARNINGS");
			 	/*strcpy((*p_SEL_VAL)[17].link_val,"EARNINGS_RATE"); 23-01-07 Changes for BI TRAD*/
			 	strcpy((*p_SEL_VAL)[17].link_val,"R_EARNINGS");
				 strcpy((*p_SEL_VAL)[18].link_val,"");
				 strcpy((*p_SEL_VAL)[18].link_tag,"");
			 #endif
				
				

          strcpy(chr_l_sel_msg_stmt,"select ");
          if(strcmp(p_msg_no,"554N01")==0 || strcmp(p_msg_no,"554R01")==0)
          {
			/*COMMENTED BY ASP - 07JUL06 */
       /* 
			 strcat(chr_l_sel_msg_stmt,"to_char(d.curr_pymt - trunc( (trunc(d.curr_pymt)*(d.tax_rate/100)))-d.OTHER_CHRGS) as INETPROC,");
			**/
		          //Changes done by Sunny for MT_566 swift message for Payment Information on Benefit Generation	
                          // strcat(chr_l_sel_msg_stmt,"to_char(d.curr_pymt - round((d.curr_pymt * d.TAX_RATE)/100,2) - round(d.OTHER_CHRGS,2)) as NETPROC,");
			 strcat(chr_l_sel_msg_stmt,"to_char(round(d.NET_AMOUNT,2) - round(d.OTHER_CHRGS,2)) as NETPROC,");
                        //Changes done by Sunny for MT_566 swift message for Payment Information on Benefit Generation
					
			 
          if (APL_FAILURE == CO_Chk_CntryEnabled(  "ENTMSG_TAX","TAX_ROUND_DOWN",&l_cond_tax,l_debug_info_ptr))
          {
                APL_GOBACK_FAIL
          }

 

         if (APL_FAILURE == CO_Chk_CntryEnabled(  "PAYMSG_TAX","TAXABLE_DIVIDEND",&l_cond_taxable_div,l_debug_info_ptr))
         {
            APL_GOBACK_FAIL
         }
         EXEC SQL SELECT CA_EVENT INTO :chr_l_ce_typ
         FROM CAEVENT WHERE CORP_ID = :chr_l_ca_id;

         IS_ANY_ORA_ERROR;

         if((l_cond_tax)&&(strcmp(chr_l_ce_typ,EVT_BOND)==0))
         {
				/*COMMENTED BY ASP 0 07JUL06*/
				/*

            strcat(chr_l_sel_msg_stmt, "to_char(round((NVL(NVL(curr_pymt,0) -trunc((NVL(CURR_PYMT,0)/nvl(QUANTITY_PAID,0))*(NVL(TAX_RATE,0)/100)) * nvl(quantity_paid,0),0) - d.OTHER_CHRGS),2)) as NETPROC, d.curr_pymt, ");
         **/
				 strcat(chr_l_sel_msg_stmt,"to_char( round(nvl(d.curr_pymt,0) - round(( (nvl(d.curr_pymt,0)/nvl(QUANTITY_PAID,0)) * nvl(d.TAX_RATE,0))/100,2)*nvl(QUANTITY_PAID,0) - round(d.OTHER_CHRGS,2),2)    ) as NETPROC, d.curr_pymt, ");
				}
         else if((l_cond_taxable_div)&&
				(strcmp(chr_l_ce_typ,EVT_CASH_DIV)==0 || strcmp(chr_l_ce_typ,EVT_DECR_VAL)==0) )   
         {


				strcat(chr_l_sel_msg_stmt, "decode(a.EARNINGS_RATE, NULL, to_char(round((NVL(d.quantity_paid,0)*NVL(a.EARNINGS,0)- trunc(NVL(d.quantity_paid,0)*NVL(d.TAXABLE_DIVIDEND,0)*NVL(d.TAX_RATE,0)/100) - d.OTHER_CHRGS),2)), to_char(round((NVL(d.quantity_paid,0)*NVL(c.NOMINAL_VALUE,0)/100*NVL(a.EARNINGS_RATE,0) - trunc(NVL(d.quantity_paid,0)*NVL(c.NOMINAL_VALUE,0)/100*NVL(d.TAXABLE_DIVIDEND,0)*NVL(d.TAX_RATE,0)/100 ) - d.OTHER_CHRGS),2))) as NETPROC, d.curr_pymt, ");


         }
         else
         {
				/*COMMENTED BY ASP - O7JUL06*/
				/*
            strcat(chr_l_sel_msg_stmt,"to_char(round(((d.curr_pymt * (100-d.TAX_RATE)/100)-d.OTHER_CHRGS),2)) as NETPROC,d.curr_pymt,");
  **/      
			  	strcat(chr_l_sel_msg_stmt,"to_char(d.curr_pymt - round((d.curr_pymt * d.TAX_RATE)/100,2) - round(d.OTHER_CHRGS,2)) as NETPROC,d.curr_pymt,");
				}

         strcat(chr_l_sel_msg_stmt,"d.OTHER_CHRGS,to_char((trunc(trunc(d.curr_pymt)*(d.tax_rate/100)))) as ITAX,");

         if((l_cond_tax) && (strcmp(chr_l_ce_typ,EVT_BOND)==0))
         {
            strcat(chr_l_sel_msg_stmt, "to_char(round((trunc((NVL(CURR_PYMT,0)/QTY_PAID)*(NVL(TAX_RATE,0)/100)) *  nvl(quantity_paid,0)),2)) as TAX, ");
         }
         else if((l_cond_taxable_div)&&
				(strcmp(chr_l_ce_typ,EVT_CASH_DIV)==0 || strcmp(chr_l_ce_typ,EVT_DECR_VAL)==0) )  
         {
            strcat(chr_l_sel_msg_stmt, "decode(a.EARNINGS_RATE, NULL, to_char(trunc(NVL(NVL(d.quantity_paid,0)*NVL(NVL(d.TAXABLE_DIVIDEND,0)*NVL(d.TAX_RATE,0)/100, 0),0))),  to_char(trunc(NVL(NVL(NVL(d.quantity_paid,0)*NVL(c.NOMINAL_VALUE,0)/100, 0)* NVL(NVL(d.TAXABLE_DIVIDEND,0)*NVL(d.TAX_RATE,0)/100,0),0)))) as TAX, ");
         }
         else
         {
            strcat(chr_l_sel_msg_stmt,"to_char(round((d.curr_pymt * d.tax_rate/100),2)) as TAX,");
         }

         

				
			 
          strcat(chr_l_sel_msg_stmt,"to_char(NVL(d.TAX_RATE,0)) as TAX_RATE,");
	       strcat(chr_l_sel_msg_stmt,"'12' as DECTAX_RATE, ");	/* Added for TAXR fix*/
	       strcat(chr_l_sel_msg_stmt,"'06' as DECTAX_RT, ");/* ISolve ID:182 Issue of WithHolding Tax Rate - Rahulc*/	
           
			 strcat(chr_l_sel_msg_stmt,"d.SEQNUM_PAY as SEQNUM_PAY,");
			 strcat(chr_l_sel_msg_stmt,"a.EARNINGS_RATE as EARNINGS_RATE,");
			 strcat(chr_l_sel_msg_stmt,"a.EARNINGS_RATE as R_EARNINGS,");
			 printf("\n\n\n******************Nikhil *******************\n\n\n");
				
          strcat(chr_l_sel_msg_stmt,"substr(to_char(d.dateof_payment,'YYMMDD'),1,6) as PAYMENT_DT,");
          strcat(chr_l_sel_msg_stmt,"substr(replace(replace(d.PAYMENT_INFO,chr(13),NULL),chr(10),NULL),1,35) as PAYMENT_INFO,");
          strcat(chr_l_sel_msg_stmt,"substr(concat(d.corp_id,d.SEQNUM_PAY),1,22)  as PROC_INIT,");
          strcat(chr_l_sel_msg_stmt,"c.currency_cd as CCYINETPROC,");
          strcat(chr_l_sel_msg_stmt,"c.currency_cd as CCYNETPROC,");
          strcat(chr_l_sel_msg_stmt,"c.currency_cd as CCYOTH_CHR,");
          strcat(chr_l_sel_msg_stmt,"c.currency_cd as CCYITAX,");
          strcat(chr_l_sel_msg_stmt,"c.currency_cd as CCYTAX,");
			 
          strcat(chr_l_sel_msg_stmt,"c.currency_cd as CCYNET_NETPROC,");
          strcat(chr_l_sel_msg_stmt,"c.currency_cd as CCYNET_INETPROC,");
          strcat(chr_l_sel_msg_stmt,"c.currency_cd as CCYPAID_NET,");
          strcat(chr_l_sel_msg_stmt,"c.currency_cd as CCYIPAID_NET,");
			 
			 
			 if ( CO_Chk_EMU_Period(APL_NULL_STRING,&int_period_flg,l_debug_info_ptr) == APL_FAILURE )
			 {
					 APL_GOBACK_FAIL
			 }

			  if ( (int_period_flg == 2) || (int_period_flg == 3) )
				  
			  {
				 strcat(chr_l_sel_msg_stmt,"'EUR' as CCYCURRENT_AMOUNT,");
			  }
			  else
			  {
          	strcat(chr_l_sel_msg_stmt,"d.PAYMENT_CCY as CCYCURRENT_AMOUNT,");
			  }
			 
			 
				
          strcat(chr_l_sel_msg_stmt,"b.CLN_FMT_RPTIND as FMT_RPTIND,");
          strcat(chr_l_sel_msg_stmt,"c.NOMINAL_VALUE as NOMINAL_VALUE,");
				
          }
          else
			 {
		      strcat(chr_l_sel_msg_stmt,"'");  
		      strcat(chr_l_sel_msg_stmt,chr_l_ca_id);
		      strcat(chr_l_sel_msg_stmt,"' as PROC_INIT,");
          } 

          strcat(chr_l_sel_msg_stmt,"concat('/',b.CLN_GL_ACCOUNT) as GL_ACCOUNT,concat('/',b.cln_code) as NACCOUNT,b.cln_code,b.cln_code as CLIENT,c.INSTR_TYPE,");
          strcat(chr_l_sel_msg_stmt,"substr(replace(replace(b.cln_name,chr(13),NULL),chr(10),NULL),1,35) as CLNT_NAME,");
	  		strcat(chr_l_sel_msg_stmt,"substr(concat(a.instr_code,concat(concat(to_char(to_date(a.DECLARE_DT),'YY'),lpad(((to_date(a.DECLARE_DT) - to_date(concat(concat('01/01/',to_char(a.DECLARE_DT,'YYYY')),' 12:00:00')))+1),3,'0')),lpad(substr(to_char(a.EVNT_INDNT),1,2),2,'0'))),1,16) as TEVENTID,");
	  		strcat(chr_l_sel_msg_stmt,"decode(c.INSTR_TYPE,'BON',decode(b.CLN_FMT_RPTIND,'Y','FMT'");
	  		strcat(chr_l_sel_msg_stmt,",c.INSTR_TYPE),c.INSTR_TYPE) as FTYPEOFINSTR,");
	  		/*Added by Anjaneyulu on 21/09/2015 for ISKB_1621 FENT_POS=0-BI event - starts*/
			if(strcmp(p_msg_no,"554C02") == 0)
			{
				EXEC SQL SELECT NVL(ELIG_ENTITL_POS,0) INTO :l_elig_pos FROM CAENTITLEMENT WHERE CORP_ID = :chr_l_ca_id 
					AND CLIENT = :l_ms_msgent_structa_a.client;
				IS_ANY_ORA_ERROR
			}
			
			if((APL_DOUBLE_EQUAL(l_elig_pos,0)) && (strcmp(p_msg_no,"554C02") == 0))
			{
				strcat(chr_l_sel_msg_stmt,"(SELECT to_char(NVL(PREV_ELIG_HOLD,0)) FROM CA_REV_ENTITLE WHERE CORP_ID ='");
				strcat(chr_l_sel_msg_stmt,chr_l_ca_id);
				strcat(chr_l_sel_msg_stmt,"' AND CLIENT ='");
				strcat(chr_l_sel_msg_stmt,l_ms_msgent_structa_a.client);
				strcat(chr_l_sel_msg_stmt,"') as FENT_POS,");
					
				strcat(chr_l_sel_msg_stmt,"(SELECT TO_CHAR(DECODE(a.EARNINGS,0,(DECODE(a.EARNINGS_RATE,0,0,TO_CHAR((r.PREV_ELIG_HOLD)*c.NOMINAL_VALUE))),TO_CHAR((r.PREV_ELIG_HOLD)))) FROM CA_REV_ENTITLE r,  CAENTITLEMENT e,mt_instrument c,caevent a  WHERE e.corp_id=r.corp_id and e.client=r.client   and a.corp_id=r.corp_id and a.instr_code =c.instr_code  and r.CORP_ID ='");
				strcat(chr_l_sel_msg_stmt,chr_l_ca_id);
				strcat(chr_l_sel_msg_stmt,"' AND r.CLIENT ='");
				strcat(chr_l_sel_msg_stmt,l_ms_msgent_structa_a.client);
				strcat(chr_l_sel_msg_stmt,"') as FENT_POSBI,");
			}
			else
			{
	  		strcat(chr_l_sel_msg_stmt,"decode(c.INSTR_TYPE,'BON',decode(b.CLN_FMT_RPTIND,'Y',to_char((e.ELIG_ENTITL_POS)*c.NOMINAL_VALUE),to_char((e.ELIG_ENTITL_POS))),to_char((e.ELIG_ENTITL_POS))) as FENT_POS,");
	  		
	  		
   		strcat(chr_l_sel_msg_stmt,"to_char(decode(a.EARNINGS,0,(decode(a.EARNINGS_RATE,0,0,to_char((e.ELIG_ENTITL_POS)*c.NOMINAL_VALUE))),to_char((e.ELIG_ENTITL_POS)))) as FENT_POSBI,");
	  		}
		/*Added by Anjaneyulu on 21/09/2015 for ISKB_1621 FENT_POS=0-BI event - Ends*/
   		if(strcmp(p_msg_no,"554N01")==0 || strcmp(p_msg_no,"554R01")==0)		
   		{
     			strcat(chr_l_sel_msg_stmt,"decode(c.INSTR_TYPE,'BON',decode(b.CLN_FMT_RPTIND,'Y',to_char(abs(d.quantity_paid)*c.NOMINAL_VALUE),to_char(abs(d.quantity_paid))),to_char(abs(d.quantity_paid))) as NEW_QTY_PAID,");     
   			strcat(chr_l_sel_msg_stmt,"to_char(decode(a.EARNINGS,0,(decode(a.EARNINGS_RATE,0,0,to_char(abs(d.quantity_paid)*c.NOMINAL_VALUE))),to_char(abs(d.quantity_paid)))) as NEW_QTY_PAID_BI,");     
   		}
          strcat(chr_l_sel_msg_stmt,"b.CLN_USE_ISIN_IND as FLGISIN,c.INSTR_ISIN,c.instr_code,substr(replace(replace(c.instr_name,chr(13),NULL),chr(10),NULL),1,35) as INSTR_NAME,");
          strcat(chr_l_sel_msg_stmt,"concat('/',concat(concat(c.currency_cd,'/'),c.REG_BR_IND)) as SECCCY,");
			 

		
			 if(strcmp(h_nation_code,"RU")==0) 
			 {
          	strcat(chr_l_sel_msg_stmt,"a.CA_EVENT, c.FREQ_CODE, a.EARNINGS, a.EARNINGS_RATE, '12' as DECTEARNINGS,c.currency_cd,a.CORP_ID,"); 
			 }
          else if(strcmp(h_nation_code,"TR")==0) 
          {
            strcat(chr_l_sel_msg_stmt,"a.CA_EVENT, c.FREQ_CODE, a.EARNINGS, a.EARNINGS_RATE, '12' as DECTEARNINGS,c.currency_cd,a.CORP_ID,");
          }
			 else
			 {
         	
	     
		strcat(chr_l_sel_msg_stmt,"a.CA_EVENT, c.FREQ_CODE, a.EARNINGS,a.EARNINGS as TEARNINGS, decode(a.EARNINGS_RATE,NULL,'0',0,'0',a.EARNINGS_RATE) as EARNINGS_RATE,decode(a.EARNINGS_RATE,NULL,'0',0,'0',a.EARNINGS_RATE) as R_EARNINGS, '12' as DECTEARNINGS,c.currency_cd,a.CORP_ID,");
			 }

          strcat(chr_l_sel_msg_stmt,"substr(to_char(a.EX_DATE,'YYMMDD'),1,6) as EX_DATE,");
          strcat(chr_l_sel_msg_stmt,"substr(to_char(a.EX_DATE,'DD-MM-YYYY'),1,10) as EM_EX_DATE,");
          strcat(chr_l_sel_msg_stmt,"substr(to_char(a.DECLARE_DT,'YYMMDD'),1,6) as declare_dt,");
          strcat(chr_l_sel_msg_stmt,"substr(to_char(a.DECLARE_DT,'DD-MM-YYYY'),1,10) as EM_DECLARE_DT,");
          strcat(chr_l_sel_msg_stmt,"substr(to_char(a.REC_DATE,'YYMMDD'),1,6) as REC_DATE,");
          strcat(chr_l_sel_msg_stmt,"substr(to_char(a.REC_DATE,'DD-MM-YYYY'),1,10) as EM_REC_DATE,");
          strcat(chr_l_sel_msg_stmt,"substr(to_char(a.BC_FROM_DATE,'YYMMDD'),1,6) as BC_DATE,");
          strcat(chr_l_sel_msg_stmt,"substr(to_char(a.dateof_payment,'YYMMDD'),1,6) as dateof_payment,to_char(abs(e.INSTR_INC_BAL)) as INSTR_INC_BAL,");
          strcat(chr_l_sel_msg_stmt,"substr(to_char(a.DATEOF_PAYMENT,'DD-MM-YYYY'),1,10) as EM_DATEOF_PAYMENT,");
          strcat(chr_l_sel_msg_stmt,"c.currency_cd as CCYTEARNINGS,");
          strcat(chr_l_sel_msg_stmt,"c.currency_cd as CCYINSTR_INC_BAL,");
			 strcat(chr_l_sel_msg_stmt,"c.currency_cd as CCYR_EARNINGS, '12' as DECR_EARNINGS,");
			 
          strcat(chr_l_sel_msg_stmt,"e.CCY_FOR_ENTITL as CCYNET_INETPROC,");
          strcat(chr_l_sel_msg_stmt,"e.CCY_FOR_ENTITL as CCYNET_NETPROC,");
			 
	  
			
           strcat(chr_l_sel_msg_stmt,"decode(c.INSTR_TYPE,'FMT','PCT',c.currency_cd) as IRTTYPE "); 
	  		
			
          strcat(chr_l_sel_msg_stmt,",decode(e.ELIG_ENTITL_POS,abs(e.ELIG_ENTITL_POS),'N','Y') as NEGPOSN , e.ELIG_ENTITL_POS as QTY , ");
			 
			 strcat(chr_l_sel_msg_stmt," b.CLN_TAXABLE_IND  as IND_83C83D ");
	
			 
			 #ifdef EMU_PROCESSING
				if(strcmp(p_msg_no,"554N01") == 0)
				{
					strcat(chr_l_sel_msg_stmt," , d.PAYMENT_CCY  as CCCYCODE ");
					strcat(chr_l_sel_msg_stmt," ,'EUR' as CCYCINCOME, "); 
					strcat(chr_l_sel_msg_stmt," 'EUR' as CCYCINETPROC,");
					strcat(chr_l_sel_msg_stmt," 'EUR' as CCYCNETPROC,");
					strcat(chr_l_sel_msg_stmt," 'EUR' as CCYCOTH_CHR,");
					strcat(chr_l_sel_msg_stmt," 'EUR' as CCYCITAX,");
					strcat(chr_l_sel_msg_stmt," 'EUR' as CCYCTAX,"); 
					strcat(chr_l_sel_msg_stmt," '3' as DECCINCOME,");
					strcat(chr_l_sel_msg_stmt," 'EUR' as CCYEXCH ");
				}
				else if(strcmp(p_msg_no,"554N02") == 0)
				{
				strcat(chr_l_sel_msg_stmt," , e.CCY_FOR_ENTITL as CCCYCODE, ");
				strcat(chr_l_sel_msg_stmt,"'3' as DECCINCOME,");
				strcat(chr_l_sel_msg_stmt,"   'EUR' as CCYCINCOME, ");
				strcat(chr_l_sel_msg_stmt,"  'EUR' as CCYCINSTR_INC_BAL, ");
				strcat(chr_l_sel_msg_stmt,"  'EUR' as CCYEXCH ");
				}
            else if (strcmp(p_msg_no,"554R01") == 0)
            {
                 strcat(chr_l_sel_msg_stmt," , d.PAYMENT_CCY  as CCCYCODE ");
            }
            else if(strcmp(p_msg_no,"554R02") == 0)
            {
					
            	strcat(chr_l_sel_msg_stmt," , e.CCY_FOR_ENTITL as CCCYCODE ");
            }
			#endif
			 
			
 		   
			strcat(chr_l_sel_msg_stmt,",substr(to_char(a.DECLARE_DT,'YYYYMMDD'),1,8) as NEW_DECL_DT");
			strcat(chr_l_sel_msg_stmt,",substr(to_char(a.DECLARE_DT,'DD-MM-YYYY'),1,10) as EM_DECL_DT");
     		strcat(chr_l_sel_msg_stmt,",substr(to_char(a.REC_DATE,'YYYYMMDD'),1,8) as NEW_REC_DT");
     		strcat(chr_l_sel_msg_stmt,",substr(to_char(a.BC_FROM_DATE,'YYYYMMDD'),1,8) as NEW_BC_DT");
     		strcat(chr_l_sel_msg_stmt,",substr(to_char(a.BC_FROM_DATE,'DD-MM-YYYY'),1,10) as EM_BC_DT");
     		strcat(chr_l_sel_msg_stmt,",substr(to_char(a.EX_DATE,'YYYYMMDD'),1,8) as NEW_EX_DT");
     		strcat(chr_l_sel_msg_stmt,",substr(to_char(a.dateof_payment,'YYYYMMDD'),1,8) as NEW_PAY_DT");
     		strcat(chr_l_sel_msg_stmt,",substr(to_char(e.access_stamp,'YYYYMMDDHH24MISS'),1,14) as ACC_STMP");

			
         
         if(strcmp(p_msg_no,"554N01")==0 || strcmp(p_msg_no,"554R01")==0)
			{
            strcat(chr_l_sel_msg_stmt,",substr(to_char(d.dateof_payment,'YYYYMMDD'),1,8) as NEW_PAYMENT_DT");
            strcat(chr_l_sel_msg_stmt,",substr(to_char(d.CHECKER_DT,'YYYYMMDD'),1,8) as NEW_PAY_AUTH_DT");
			}
         
         
			 

			
	       strcat(chr_l_sel_msg_stmt,",decode(c.INSTR_TYPE,'BON',decode(b.CLN_FMT_RPTIND,'Y','Y'");
			 strcat(chr_l_sel_msg_stmt,",'N'),'N') as NEW_FMTFLG,");
			 strcat(chr_l_sel_msg_stmt,"c.NOMINAL_VALUE as NEW_NOMVAL ");
          strcat(chr_l_sel_msg_stmt,",a.INFO_SEQ as LNOTE_NBR,a.ENTITL_INFONO as ENTITL_INFONO "); 
		  	

			 
			 strcat(chr_l_sel_msg_stmt,",e.CUSTODYTAX_RATE as TAX_RT,e.CUSTODYTAX_RATE as WHTAX_RT ");
			/*210207 for Entil Taxrt issue*/
			 strcat(chr_l_sel_msg_stmt,", '12' as DECTAX_RT ");
			 strcat(chr_l_sel_msg_stmt,", '12' as DECWHTAX_RT ");
			 

        
        strcat(chr_l_sel_msg_stmt," ,decode(a.WWWADDR,NULL,NULL,substr(a.WWWADDR,1,35)) as WEBB_ADD1");
        strcat(chr_l_sel_msg_stmt," ,decode(a.WWWADDR,NULL,NULL,substr(a.WWWADDR,36,35)) as WEBB_ADD2");
        strcat(chr_l_sel_msg_stmt," ,decode(a.WWWADDR,NULL,NULL,substr(a.WWWADDR,71,35)) as WEBB_ADD3");
        

        

         strcat(chr_l_sel_msg_stmt,", substr(to_char(a.DEAL_FRM_DATE,'YYYYMMDD'),1,8) as NEW_TRADEFROM_DT");
         strcat(chr_l_sel_msg_stmt,", substr(to_char(a.DEAL_FRM_DATE,'DD-MM-YYYY'),1,10) as EM_TRADEFROM_DT");
         strcat(chr_l_sel_msg_stmt,", substr(to_char(a.DEAL_TO_DATE,'YYYYMMDD'),1,8) as NEW_TRADETO_DT ");
         strcat(chr_l_sel_msg_stmt,", substr(to_char(a.DEAL_TO_DATE,'DD-MM-YYYY'),1,10) as EM_TRADETO_DT ");
        
		
				
      		strcat(chr_l_sel_msg_stmt,", a.REQD_CERTIFY as REQD_CERTIFY ");  
//Chirag to show DIVI tag in 566 msg 05-02-2008
      		strcat(chr_l_sel_msg_stmt,", a.DIVIDEND_TYPE as DIVIDEND_TYPE");  
			  
			strcat(chr_l_sel_msg_stmt," from CAEVENT a,MT_CLIENT b,MT_INSTRUMENT c,CAENTITLEMENT e ");
          if(strcmp(p_msg_no,"554N01")==0 || strcmp(p_msg_no,"554R01")==0)
          	strcat(chr_l_sel_msg_stmt,",CACHEQUE d ");

          strcat(chr_l_sel_msg_stmt,"where a.instr_code = c.instr_code and a.corp_id = '");
	  strcat(chr_l_sel_msg_stmt,chr_l_ca_id);
          strcat(chr_l_sel_msg_stmt,"' ");
          strcat(chr_l_sel_msg_stmt,"and a.corp_id = e.corp_id ");
			 		
          if(strcmp(p_msg_no,"554N01")==0 || strcmp(p_msg_no,"554R01")==0)
			 strcat(chr_l_sel_msg_stmt," and d.corp_id = e.corp_id ");
			 		
          strcat(chr_l_sel_msg_stmt,"and e.client = b.cln_code ");
          if(strcmp(p_msg_no,"554N01")==0 || strcmp(p_msg_no,"554R01")==0)
          {
              strcat(chr_l_sel_msg_stmt,"and a.corp_id = d.corp_id and d.client = e.client  and d.SEQNUM_PAY = '");
              strcat(chr_l_sel_msg_stmt,chr_l_refno);
              strcat(chr_l_sel_msg_stmt,"' and d.rowid NOT IN (select d.rowid from MS_MSGSTAT where client = d.client and proc_init = ");
              strcat(chr_l_sel_msg_stmt,"d.corp_id || d.SEQNUM_PAY");
              
              
             if(strcmp(p_msg_no,"554N01")==0 )
              {
                  strcat(chr_l_sel_msg_stmt," AND swift_msg_rep in ('554N01','566N07') )");
              }
              if(strcmp(p_msg_no,"554R01")==0 )
              {
                 strcat(chr_l_sel_msg_stmt," AND swift_msg_rep in ('554R01','566R07') )");
              }
              
          }

          if((strlen(l_ms_msgent_structa_a.client))!=0)
          {
          	strcat(chr_l_sel_msg_stmt,"and b.cln_code = '");
                strcat(chr_l_sel_msg_stmt,l_ms_msgent_structa_a.client);
          	strcat(chr_l_sel_msg_stmt,"'");
          }
          else 
          {
          if(strcmp(p_msg_no,"554N01")==0 || strcmp(p_msg_no,"554R01")==0)
          {
		APL_DATA_MISSING("CLIENT", APL_NULL_STRING, APL_NULL_STRING)
                APL_GOBACK_FAIL
          }
          }

          strcat(chr_l_sel_msg_stmt," and b.STATUS != '");
          strcat(chr_l_sel_msg_stmt,STATUS_CLS_AUTH);
          strcat(chr_l_sel_msg_stmt,"' ");

	 
	       if(strcmp(p_msg_no,"554R02") == 0)
	       {
		     strcat(chr_l_sel_msg_stmt," and b.cln_code IN (select client from MS_MSGSTAT where proc_init = '");
		     strcat(chr_l_sel_msg_stmt,chr_l_ca_id);
		     strcat(chr_l_sel_msg_stmt,"' and swift_msg_rep IN ('554N02','564N42','554C02','564C42'))");
	       }

        }
   
        
        if(strncmp(p_msg_no,"555",3) == 0)
        {
          l_msgaddr = MCORPACTIONSMSGNO;
          if(strlen(l_ms_msgent_structa_a.proc_init) != 0)
          {
             strcpy(chr_l_ca_id,l_ms_msgent_structa_a.proc_init);
          }
          else
          {
		APL_DATA_MISSING("CA ID", APL_NULL_STRING, APL_NULL_STRING)
                APL_GOBACK_FAIL
          }
          if(strlen(l_ms_msgent_structa_a.proc_data) != 0)
          {
             CO_SplitStr(l_ms_msgent_structa_a.proc_data,
                          ';', &int_noelem, &chr_l_param);
             strcpy(chr_l_refno,chr_l_param[0]);
          }
          else
          {
		APL_DATA_MISSING("Payment Srl Nbr", APL_NULL_STRING, APL_NULL_STRING)
                APL_GOBACK_FAIL
          }
			
          *p_STAT_VAL = realloc(*p_STAT_VAL,sizeof(MS_STATIC_VAL)*9); 

			 
          

			 
          *p_SEL_VAL = realloc(*p_SEL_VAL,sizeof(MS_STATIC_VAL)*17); 
			 

          strcpy((*p_STAT_VAL)[0].link_val,"DUMMY");
          strcpy((*p_STAT_VAL)[0].link_tag,"DUMMY");
          strcpy((*p_STAT_VAL)[1].link_val,"DOMSEC");
          strcpy((*p_STAT_VAL)[1].link_tag,chr_h_dom_instr);
          strcpy((*p_STAT_VAL)[2].link_val,"DBCR");
          strcpy((*p_STAT_VAL)[3].link_val,"TITLE");
          strcpy((*p_STAT_VAL)[4].link_val,"TEXT");
          if(strcmp(p_msg_no,"555N01")==0)
          {
          	strcpy((*p_STAT_VAL)[2].link_tag,"C");
          	strcpy((*p_STAT_VAL)[3].link_tag,"PAYMENT ");
          	strcpy((*p_STAT_VAL)[4].link_tag,APL_NULL_STRING);
          }
          if(strcmp(p_msg_no,"555R01")==0)
          {
          	strcpy((*p_STAT_VAL)[2].link_tag,"D");
          	strcpy((*p_STAT_VAL)[3].link_tag,"PAYMENT REVERSAL ");
          	strcpy((*p_STAT_VAL)[4].link_tag,APL_NULL_STRING);
          }
          strcpy((*p_STAT_VAL)[5].link_val,"NATION");
          strcpy((*p_STAT_VAL)[5].link_tag,h_nation_code);
			
			strcpy((*p_STAT_VAL)[6].link_val,"SEQNUM_PAY");
			strcpy((*p_STAT_VAL)[6].link_tag,chr_l_refno);
			
          strcpy((*p_STAT_VAL)[7].link_val,"CNTRY_BIC");		
          strcpy((*p_STAT_VAL)[7].link_tag,l_mt_message_sys_params_struct_h.swift_cd);
          strcpy((*p_STAT_VAL)[8].link_val,"");
          strcpy((*p_STAT_VAL)[8].link_tag,"");
	
          strcpy((*p_SEL_VAL)[0].link_val,"RES_INSTR_CODE");
          strcpy((*p_SEL_VAL)[1].link_val,"DUMMY");
          strcpy((*p_SEL_VAL)[2].link_val,"DUMMY");
          strcpy((*p_SEL_VAL)[3].link_val,"CA_EVENT");
          strcpy((*p_SEL_VAL)[4].link_val,"INSTR_CODE");
          strcpy((*p_SEL_VAL)[5].link_val,"TEVENTID");
          strcpy((*p_SEL_VAL)[6].link_val,"LENTNOTE_NO");
          strcpy((*p_SEL_VAL)[7].link_val,"DUMMY");
          strcpy((*p_SEL_VAL)[8].link_val,"INSTR_TYPE");

			 

          strcpy((*p_SEL_VAL)[9].link_val,"CLIENT");
          strcpy((*p_SEL_VAL)[9].link_tag,"");
          strcpy((*p_SEL_VAL)[10].link_val,"CORP_ID");
			 
          strcpy((*p_SEL_VAL)[11].link_val,"OP_EVT_CLASS");
          strcpy((*p_SEL_VAL)[12].link_val,"SUB_NEW_QUANTITY"); 
          strcpy((*p_SEL_VAL)[13].link_val,"SUB_BASE_QUANTITY"); 
	 /* Changes done by Hardik for ISKB_8203 on 29/02/2016 Start */
	 /* For MT566 DAT creation of a BO event, exe's is getting abruptly killed because garbage values are assigned to below variable,to handle this variables are Intialized by 0.0 */
	  (*p_SEL_VAL)[12].NUM_VAL = 0.0;
	  (*p_SEL_VAL)[13].NUM_VAL = 0.0;
          (*p_SEL_VAL)[9].NUM_VAL = 0.0;
          (*p_SEL_VAL)[10].NUM_VAL = 0.0;
          (*p_SEL_VAL)[14].NUM_VAL = 0.0;
          (*p_SEL_VAL)[15].NUM_VAL = 0.0;
          (*p_SEL_VAL)[16].NUM_VAL = 0.0;
	  /* Changes done by Hardik for ISKB_8203 on 29/02/2016 End */
          strcpy((*p_SEL_VAL)[14].link_val,"PROC_OTH"); 
          strcpy((*p_SEL_VAL)[15].link_val,"QUANTITY_RECEIVED");
          strcpy((*p_SEL_VAL)[16].link_val,"");
          strcpy((*p_SEL_VAL)[16].link_tag,"");
			 
	  printf("\n After intializing values");
	  fflush(stdout);
          EXEC SQL SELECT OP_EVT_CLASS,EXPIRY_DATE INTO :chr_l_op_event_type:i_op_evt_class,:chr_l_expire_dt:i_expire_date FROM CAEVENT WHERE CORP_ID = :chr_l_ca_id;
          IS_ANY_ORA_ERROR
          if (i_op_evt_class == -1)
             strcpy(chr_l_op_event_type," ");

	  if (i_expire_date == -1)
	     strcpy(chr_l_expire_dt,APL_NULL_STRING);

	  strcpy(chr_l_sel_msg_stmt,"select ");
	  strcat(chr_l_sel_msg_stmt,"a.instr_code,");
	  strcat(chr_l_sel_msg_stmt,"substr(to_char(a.DECLARE_DT,'YYMMDD'),1,6) as DECLARE_DT,");
	  strcat(chr_l_sel_msg_stmt,"substr(to_char(a.DECLARE_DT,'DD-MM-YYYY'),1,10) as EM_DECLARE_DT,");
	  strcat(chr_l_sel_msg_stmt,"a.CA_EVENT ,");
	  strcat(chr_l_sel_msg_stmt,"a.EVNT_INDNT,");
	  strcat(chr_l_sel_msg_stmt,"c.INSTR_ISIN,");
	  strcat(chr_l_sel_msg_stmt,"concat('/',b.cln_code) as NACCOUNT,b.cln_code,b.cln_code as CLIENT,");
	  strcat(chr_l_sel_msg_stmt,"substr(replace(replace(b.cln_name,chr(13),NULL),chr(10),NULL),1,35) as CLNT_NAME,");
	  strcat(chr_l_sel_msg_stmt,"concat('/',concat(concat(c.currency_cd,'/ '),c.REG_BR_IND)) as SECCCY,");
	  strcat(chr_l_sel_msg_stmt,"substr(replace(replace(c.instr_name,chr(13),NULL),chr(10),NULL),1,35) as INSTR_NAME,");
	  strcat(chr_l_sel_msg_stmt,"substr(to_char(a.EX_DATE,'YYMMDD'),1,6) as EX_DATE,");
	  strcat(chr_l_sel_msg_stmt,"substr(to_char(a.EX_DATE,'DD-MM-YYYY'),1,10) as EM_EX_DATE,");
	  strcat(chr_l_sel_msg_stmt,"substr(to_char(a.REC_DATE,'YYMMDD'),1,6) as REC_DATE,");
	  strcat(chr_l_sel_msg_stmt,"substr(to_char(a.REC_DATE,'DD-MM-YYYY'),1,10) as EM_REC_DATE,");
	  strcat(chr_l_sel_msg_stmt,"substr(to_char(a.BC_FROM_DATE,'YYMMDD'),1,6) as BC_DATE,");
	  strcat(chr_l_sel_msg_stmt,"substr(to_char(a.dateof_payment,'YYMMDD'),1,6) as dateof_payment,");
	  strcat(chr_l_sel_msg_stmt,"substr(to_char(a.dateof_payment,'DD-MM-YYYY'),1,10) as EM_DATEOF_PAYMENT,");
	  strcat(chr_l_sel_msg_stmt,"substr(to_char(d.dateof_payment,'YYMMDD'),1,6) as PAYMENT_DT,");
	  strcat(chr_l_sel_msg_stmt,"decode(d.curr_pymt,0,NULL,d.curr_pymt) as CURR_PYMT,");
	  strcat(chr_l_sel_msg_stmt,"substr(concat(a.instr_code,concat(concat(to_char(to_date(a.DECLARE_DT),'YY'),lpad(((to_date(a.DECLARE_DT) - to_date(concat(concat('01/01/',to_char(a.DECLARE_DT,'YYYY')),' 12:00:00')))+1),3,'0')),lpad(substr(to_char(a.EVNT_INDNT),1,2),2,'0'))),1,16) as TEVENTID,");
	  strcat(chr_l_sel_msg_stmt,"decode(c.INSTR_TYPE,'BON',decode(b.CLN_FMT_RPTIND,'Y','FMT'");
	  strcat(chr_l_sel_msg_stmt,",c.INSTR_TYPE),c.INSTR_TYPE) as FTYPEOFINSTR,");
	  
	  if (strcmp(chr_l_op_event_type, "TO") == 0)  
          {
		if (i_expire_date == -1)
               		 strcat(chr_l_sel_msg_stmt,"decode(c.INSTR_TYPE,'BON',decode(b.CLN_FMT_RPTIND,'Y',(select to_char(sum(safekeep_pos)*c.NOMINAL_VALUE) from DL_SAFEK where client = d.client and instr_code = a.instr_code),(select sum(safekeep_pos) from DL_SAFEK where client = d.client and instr_code = a.instr_code)) ,(select sum(safekeep_pos) from DL_SAFEK where client = d.client and instr_code = a.instr_code)) as FENT_POS,");
		else
			 strcat(chr_l_sel_msg_stmt,"decode(c.INSTR_TYPE,'BON',decode(b.CLN_FMT_RPTIND,'Y',(select to_char(sum(safekeep_pos)*c.NOMINAL_VALUE) from DL_HISSAFEK where client = d.client and instr_code = a.instr_code and POSIT_DATE = a.EXPIRY_DATE),(select sum(safekeep_pos) from DL_HISSAFEK where client = d.client and instr_code = a.instr_code and POSIT_DATE = a.EXPIRY_DATE)) ,(select sum(safekeep_pos) from DL_HISSAFEK where client = d.client and instr_code = a.instr_code and positdt = a.EXPIRY_DATE)) as FENT_POS,");

		strcat(chr_l_sel_msg_stmt,"decode(c.INSTR_TYPE,'BON',decode(b.CLN_FMT_RPTIND,'Y',to_char(round(d.quantity_paid*c.NOMINAL_VALUE)),round(d.quantity_paid)),round(d.quantity_paid)) as NEW_QTY_PAID,");     



          }
	  else
	  {
	  strcat(chr_l_sel_msg_stmt,"decode(c.INSTR_TYPE,'BON',decode(b.CLN_FMT_RPTIND,'Y',to_char(e.ELIG_ENTITL_POS*c.NOMINAL_VALUE),e.ELIG_ENTITL_POS),e.ELIG_ENTITL_POS) as FENT_POS,");

     strcat(chr_l_sel_msg_stmt,"decode(c.INSTR_TYPE,'BON',decode(b.CLN_FMT_RPTIND,'Y',to_char(d.quantity_paid*c.NOMINAL_VALUE),d.quantity_paid),d.quantity_paid) as NEW_QTY_PAID,");     
	  }
		if(strcmp(chr_l_op_event_type,"TO")!=0)
		{
	  strcat(chr_l_sel_msg_stmt,"e.QUANTITY_BAL,");
	  strcat(chr_l_sel_msg_stmt,"c.currency_cd,c.INSTR_TYPE,");
	  strcat(chr_l_sel_msg_stmt,"e.INSTR_INC_BAL,");
		}
		else
	  strcat(chr_l_sel_msg_stmt,"c.currency_cd,c.INSTR_TYPE,");
	  strcat(chr_l_sel_msg_stmt,"d.quantity_received,");
	  strcat(chr_l_sel_msg_stmt,"to_char(round((trunc(trunc(d.curr_pymt)*(d.tax_rate/100))),2)) as RTAX_AMT,");
	  strcat(chr_l_sel_msg_stmt,"to_char(round((d.curr_pymt * d.tax_rate/100),2)) as TAX_AMOUNT,");
	  strcat(chr_l_sel_msg_stmt,"to_char(round((d.curr_pymt - trunc(trunc(d.curr_pymt)*(d.tax_rate/100))),2)) as RNET_AMT,");
	  strcat(chr_l_sel_msg_stmt,"to_char(round((d.curr_pymt * (100-d.TAX_RATE)/100),2)) as NET_AMT,");
	  strcat(chr_l_sel_msg_stmt,"c.INSTR_ISIN,c.currency_cd,");
	  strcat(chr_l_sel_msg_stmt,"c.currency_cd as CCYCUR_PMT,");
	  strcat(chr_l_sel_msg_stmt,"c.currency_cd as CCYRNET_AMT,");
	  strcat(chr_l_sel_msg_stmt,"c.currency_cd as CCYNET_AMT,");
	  strcat(chr_l_sel_msg_stmt,"c.currency_cd as CCYRTAX_AMT,");
	  strcat(chr_l_sel_msg_stmt,"c.currency_cd as CCYTAX_AMT,");
	  strcat(chr_l_sel_msg_stmt,"substr(replace(replace(d.PAYMENT_INFO,chr(13),NULL),chr(10),NULL),1,35) as PAYMENT_INFO,");
	  strcat(chr_l_sel_msg_stmt,"b.CLN_USE_ISIN_IND as FLGISIN,");
	  strcat(chr_l_sel_msg_stmt,"a.RES_INSTR_CODE,a.INFO_SEQ as LENTNOTE_NO,");
	  strcat(chr_l_sel_msg_stmt,"concat('/',b.CLN_GL_ACCOUNT) as GL_ACCOUNT,");
	  strcat(chr_l_sel_msg_stmt,"substr(concat(decode(a.NEW_SAFEK_QTY,NULL,'0',a.NEW_SAFEK_QTY),concat(':',decode(a.OLD_STK_QTY,NULL,'0',a.OLD_STK_QTY))),1,15) as RATIO,");
	  strcat(chr_l_sel_msg_stmt,"to_char(a.NEW_SAFEK_RT) as AE_RATE, ");
          strcat(chr_l_sel_msg_stmt,"substr(concat(d.corp_id,d.SEQNUM_PAY),1,22) as PROC_INIT ,");
			 
			 strcat(chr_l_sel_msg_stmt," b.CLN_TAXABLE_IND  as IND_83C83D ");
			 
      

         strcat(chr_l_sel_msg_stmt,",a.OLD_STK_QTY,a.NEW_SAFEK_QTY");
         strcat(chr_l_sel_msg_stmt,",substr(to_char(a.DECLARE_DT,'YYYYMMDD'),1,8) as NEW_DECL_DT");
         strcat(chr_l_sel_msg_stmt,",substr(to_char(a.DECLARE_DT,'DD-MM-YYYY'),1,10) as EM_DECL_DT");
         strcat(chr_l_sel_msg_stmt,",substr(to_char(a.REC_DATE,'YYYYMMDD'),1,8) as NEW_REC_DT");
         strcat(chr_l_sel_msg_stmt,",substr(to_char(a.BC_FROM_DATE,'YYYYMMDD'),1,8) as NEW_BC_DT");
         strcat(chr_l_sel_msg_stmt,",substr(to_char(a.BC_FROM_DATE,'DD-MM-YYYY'),1,10) as EM_BC_DT");
         strcat(chr_l_sel_msg_stmt,",substr(to_char(a.EX_DATE,'YYYYMMDD'),1,8) as NEW_EX_DT");
         strcat(chr_l_sel_msg_stmt,",substr(to_char(a.dateof_payment,'YYYYMMDD'),1,8) as NEW_PAY_DT");
         strcat(chr_l_sel_msg_stmt,",substr(to_char(d.dateof_payment,'YYYYMMDD'),1,8) as NEW_PAYMENT_DT");
         strcat(chr_l_sel_msg_stmt,",substr(to_char(d.CHECKER_DT,'YYYYMMDD'),1,8) as NEW_PAY_AUTH_DT");
         strcat(chr_l_sel_msg_stmt,",'12' as DECRATE"); 
         
         if(strcmp(p_msg_no,"555R01")==0 )
         {
	    

            strcat(chr_l_sel_msg_stmt,",a.OP_EVT_CLASS,replace(replace(a.PROC_OTH,chr(13),NULL),chr(10),NULL) as PROC_OTH  ");
				strcat(chr_l_sel_msg_stmt,",substr(to_char(a.SUBSCR_DATE,'YYYYMMDD'),1,8) as NEW_SUBS_DT ");
				strcat(chr_l_sel_msg_stmt,",substr(to_char(a.SUBSCR_DATE,'DD-MM-YYYY'),1,10) as EM_SUBS_DT ");
            strcat(chr_l_sel_msg_stmt,",substr(to_char(a.RESPONSE_DATE,'YYYYMMDD'),1,8) as NEW_RESP_DT");
            strcat(chr_l_sel_msg_stmt,",a.RESP_DT_OPND");
            strcat(chr_l_sel_msg_stmt,",substr(to_char(a.EFFECTIVE_DATE,'YYYYMMDD'),1,8) as NEW_EFFCT_DT");
            strcat(chr_l_sel_msg_stmt,",substr(to_char(a.PART_PYMT_DT,'YYYYMMDD'),1,8) as NEW_PP_DT");
            strcat(chr_l_sel_msg_stmt,",decode(a.SUB_PR,0,'0',NULL,'0',a.SUB_PR) as SUB_PR");
            strcat(chr_l_sel_msg_stmt,",b.CLN_FMT_RPTIND,a.DISP_OF_FRACT");
				
				strcat(chr_l_sel_msg_stmt,",a.CA_CURRENCY as CCYSUB_PRICE");
				if (strcmp(chr_l_op_event_type,"TO") == 0)  
				{
					if (i_expire_date == -1)
                                       		 strcat(chr_l_sel_msg_stmt,",decode(a.OP_EVT_CLASS,'TO',(select sum(safekeep_pos) from DL_SAFEK where client = d.client and instr_code = a.instr_code),0) as ELIG_ENTITL_POS");
					else
						 strcat(chr_l_sel_msg_stmt,",decode(a.OP_EVT_CLASS,'TO',(select sum(safekeep_pos) from DL_HISSAFEK where client = d.client and instr_code = a.instr_code and POSIT_DATE = a.EXPIRY_DATE),0) as ELIG_ENTITL_POS");
 				}
                                else
					strcat(chr_l_sel_msg_stmt,",e.ELIG_ENTITL_POS");
				strcat(chr_l_sel_msg_stmt,",decode(c.INSTR_TYPE,'FMT','PCT',c.currency_cd) as IRTTYPE"); 
				strcat(chr_l_sel_msg_stmt,",a.SUB_NEW_QUANTITY, a.SUB_BASE_QUANTITY "); 
         }
      

		strcat(chr_l_sel_msg_stmt, ", b.CLN_FRACT_IND as FRACT_IND, '");  	
		strcat(chr_l_sel_msg_stmt, chr_l_keep_fract_temp);
     	strcat(chr_l_sel_msg_stmt, "' as FRACT_COND");

		strcat(chr_l_sel_msg_stmt, ", a.corp_id as CORP_ID "); 
     
     
     strcat(chr_l_sel_msg_stmt, ", a.FRACT_PR ,a.OP_EVT_CLASS, a.DISP_OF_FRACT ");

	  
      strcat(chr_l_sel_msg_stmt," ,a.REQD_CERTIFY as REQD_CERTIFY,c.nominal_value  "); 

	  
	  if (strcmp(chr_l_op_event_type,"WC") == 0)
	  {
		strcat(chr_l_sel_msg_stmt,", substr(to_char(a.start_date,'YYYYMMDD'),1,8) as NEW_START_DT");
		strcat(chr_l_sel_msg_stmt,", substr(to_char(a.EXPIRY_DATE,'YYYYMMDD'),1,8) as NEW_EXPIRE_DT");
	  }
	  if (strcmp(chr_l_op_event_type,"MG") == 0)
	  {
		strcat(chr_l_sel_msg_stmt,", substr(to_char(a.MEETING_DATE,'YYYYMMDD'),1,8) as NEW_DEAL_DT");
	  }
       	  

	  
          if (strcmp(chr_l_op_event_type,"TO") == 0)
                strcat(chr_l_sel_msg_stmt," from CAEVENT a,MT_CLIENT b,MT_INSTRUMENT c,CACHEQUE d ");
          else

	 	 strcat(chr_l_sel_msg_stmt," from CAEVENT a,MT_CLIENT b,MT_INSTRUMENT c,CACHEQUE d,CAENTITLEMENT e");
	  strcat(chr_l_sel_msg_stmt," where a.instr_code = c.instr_code and a.corp_id = '");
	  strcat(chr_l_sel_msg_stmt,chr_l_ca_id);
          strcat(chr_l_sel_msg_stmt,"' ");
          strcat(chr_l_sel_msg_stmt," and d.SEQNUM_PAY = '");
          strcat(chr_l_sel_msg_stmt,chr_l_refno);

	  
          if (strcmp(chr_l_op_event_type,"TO") == 0)
                
		strcat(chr_l_sel_msg_stmt,"' and (a.corp_id = d.corp_id and d.client = b.cln_code) "); 

          else
	 	 strcat(chr_l_sel_msg_stmt,"' and a.corp_id = d.corp_id and a.corp_id = e.corp_id and d.client = e.client and d.client = b.cln_code ");
          if((strlen(l_ms_msgent_structa_a.client))!=0)
          {
          	strcat(chr_l_sel_msg_stmt,"and b.cln_code = '");
                strcat(chr_l_sel_msg_stmt,l_ms_msgent_structa_a.client);
          	strcat(chr_l_sel_msg_stmt,"'");
          }
          else
          {
		APL_DATA_MISSING("CLIENT", APL_NULL_STRING, APL_NULL_STRING)
                APL_GOBACK_FAIL
          }

         
         
       strcat(chr_l_sel_msg_stmt," and d.rowid NOT IN (select d.rowid from MS_MSGSTAT where client = d.client and proc_init = concat(d.corp_id,d.SEQNUM_PAY) ");
         if(strcmp(p_msg_no,"555N01")==0 )
         {
            strcat(chr_l_sel_msg_stmt," AND swift_msg_rep in ('555N01','566N06') )");
         }
         if(strcmp(p_msg_no,"555R01")==0 )
         {
            strcat(chr_l_sel_msg_stmt," AND swift_msg_rep in ('555R01','566R01') )");
         }
         
          strcat(chr_l_sel_msg_stmt," and b.STATUS != '");
          strcat(chr_l_sel_msg_stmt,STATUS_CLS_AUTH);
          strcat(chr_l_sel_msg_stmt,"' ");
 
        }

         
        if(strncmp(p_msg_no,"552",3) == 0)
        {
          l_msgaddr = MCORPACTIONSMSGNO;
          if(strlen(l_ms_msgent_structa_a.proc_init) != 0)
          {
             strcpy(chr_l_ca_id,l_ms_msgent_structa_a.proc_init);
          }
          *p_STAT_VAL = realloc(*p_STAT_VAL,sizeof(MS_STATIC_VAL)*12); 

			 

          *p_SEL_VAL = realloc(*p_SEL_VAL,sizeof(MS_STATIC_VAL)*19); 

          strcpy((*p_STAT_VAL)[1].link_val,"DOMSEC");
          strcpy((*p_STAT_VAL)[1].link_tag,chr_h_dom_instr);
          strcpy((*p_STAT_VAL)[2].link_val,"ENT_INC");
          strcpy((*p_STAT_VAL)[3].link_val,"TITLE");
          strcpy((*p_STAT_VAL)[4].link_val,"TEXT");
          if(strcmp(p_msg_no,"552N01")==0)
          {
          	strcpy((*p_STAT_VAL)[3].link_tag,"EVENT INTIMATION");
          	strcpy((*p_STAT_VAL)[4].link_tag,APL_NULL_STRING);
          	strcpy((*p_STAT_VAL)[5].link_val,"552N01");
          	strcpy((*p_STAT_VAL)[5].link_tag,"T");
          	strcpy((*p_STAT_VAL)[6].link_val,"EVE_INC");
          	strcpy((*p_STAT_VAL)[6].link_tag,"T");
          	strcpy((*p_STAT_VAL)[2].link_tag,"F");
          }
          if(strcmp(p_msg_no,"552N02")==0)
          {
          	strcpy((*p_STAT_VAL)[3].link_tag,"ENTITLEMENT");
          	strcpy((*p_STAT_VAL)[4].link_tag,APL_NULL_STRING);
          	strcpy((*p_STAT_VAL)[5].link_val,"552N02");
          	strcpy((*p_STAT_VAL)[5].link_tag,"T");
          	strcpy((*p_STAT_VAL)[6].link_val,"EVE_INC");
          	strcpy((*p_STAT_VAL)[6].link_tag,"F");
          	strcpy((*p_STAT_VAL)[2].link_tag,"T");
          }
          if(strcmp(p_msg_no,"552C01")==0)
          {
          	strcpy((*p_STAT_VAL)[3].link_tag,"EVENT CHANGE");
          	strcpy((*p_STAT_VAL)[4].link_tag,APL_NULL_STRING);
          	strcpy((*p_STAT_VAL)[5].link_val,"552C01");
          	strcpy((*p_STAT_VAL)[5].link_tag,"T");
          	strcpy((*p_STAT_VAL)[6].link_val,"EVE_INC");
          	strcpy((*p_STAT_VAL)[6].link_tag,"T");
          	strcpy((*p_STAT_VAL)[2].link_tag,"F");
          }
          if(strcmp(p_msg_no,"552C02")==0)
          {
          	strcpy((*p_STAT_VAL)[3].link_tag,"ENTITLEMENT CHANGE");
          	strcpy((*p_STAT_VAL)[4].link_tag,APL_NULL_STRING);
          	strcpy((*p_STAT_VAL)[5].link_val,"552C02");
          	strcpy((*p_STAT_VAL)[5].link_tag,"T");
          	strcpy((*p_STAT_VAL)[6].link_val,"EVE_INC");
          	strcpy((*p_STAT_VAL)[6].link_tag,"F");
          	strcpy((*p_STAT_VAL)[2].link_tag,"T");
          }
          if(strcmp(p_msg_no,"552R01")==0)
	  {            
          	strcpy((*p_STAT_VAL)[3].link_tag,"EVENT REVERSAL");
          	strcpy((*p_STAT_VAL)[4].link_tag,APL_NULL_STRING);
          	strcpy((*p_STAT_VAL)[5].link_val,"552R01");
          	strcpy((*p_STAT_VAL)[5].link_tag,"T");
          	strcpy((*p_STAT_VAL)[6].link_val,"EVE_INC");
          	strcpy((*p_STAT_VAL)[6].link_tag,"T");
          	strcpy((*p_STAT_VAL)[2].link_tag,"F");
         
            CO_SplitStr(l_ms_msgent_structa_a.proc_data,
							';', &int_noelem, &chr_l_param); 
				strcpy((*p_STAT_VAL)[9].link_val,"FUNCTION");
            if (strcmp(chr_l_param[1],APL_NULL_STRING)==0)
               strcpy((*p_STAT_VAL)[9].link_tag,"CANC");
            else if (strcmp(chr_l_param[1],"1")==0)
               strcpy((*p_STAT_VAL)[9].link_tag,"WITH");
          strcpy((*p_STAT_VAL)[10].link_val,"CNTRY_BIC");
          strcpy((*p_STAT_VAL)[10].link_tag,l_mt_message_sys_params_struct_h.swift_cd);
          strcpy((*p_STAT_VAL)[11].link_val,"");
          strcpy((*p_STAT_VAL)[11].link_tag,"");
         
          }
          if(strcmp(p_msg_no,"552R02")==0)
	  {            
          	strcpy((*p_STAT_VAL)[3].link_tag,"EVENT ENTITLEMENT REVERSAL");
          	strcpy((*p_STAT_VAL)[4].link_tag,APL_NULL_STRING);
          	strcpy((*p_STAT_VAL)[5].link_val,"552R02");
          	strcpy((*p_STAT_VAL)[5].link_tag,"T");
          	strcpy((*p_STAT_VAL)[6].link_val,"EVE_INC");
          	strcpy((*p_STAT_VAL)[6].link_tag,"F");
          	strcpy((*p_STAT_VAL)[2].link_tag,"T");
          }
          if(strcmp(p_msg_no,"552R03")==0)
	  {            
          	strcpy((*p_STAT_VAL)[3].link_tag,"ENTITLEMENT REVERSAL");
          	strcpy((*p_STAT_VAL)[4].link_tag,APL_NULL_STRING);
          	strcpy((*p_STAT_VAL)[5].link_val,"552R03");
          	strcpy((*p_STAT_VAL)[5].link_tag,"T");
          	strcpy((*p_STAT_VAL)[6].link_val,"EVE_INC");
          	strcpy((*p_STAT_VAL)[6].link_tag,"F");
          	strcpy((*p_STAT_VAL)[2].link_tag,"T");
          }
          strcpy((*p_STAT_VAL)[7].link_val,"SSREG");
          strcpy((*p_STAT_VAL)[7].link_tag,chr_h_process_reg_flg);
			 
			 strcpy((*p_STAT_VAL)[8].link_val,"NATION");
			 strcpy((*p_STAT_VAL)[8].link_tag,g_mt_commonsys_params_struct_h.nation_code);
         if(strcmp(p_msg_no,"552R01")!=0)
         {
			
          strcpy((*p_STAT_VAL)[9].link_val,"CNTRY_BIC");
          strcpy((*p_STAT_VAL)[9].link_tag,l_mt_message_sys_params_struct_h.swift_cd);
			 

          strcpy((*p_STAT_VAL)[10].link_val,"");
          strcpy((*p_STAT_VAL)[10].link_tag,"");
   
          strcpy((*p_STAT_VAL)[11].link_val,"");
          strcpy((*p_STAT_VAL)[11].link_tag,"");

         }
			 
	
          strcpy((*p_SEL_VAL)[0].link_val,"RES_INSTR_CODE");
          strcpy((*p_SEL_VAL)[1].link_val,"DISP_OF_FRACT");
          strcpy((*p_SEL_VAL)[2].link_val,"CLIENT");
          strcpy((*p_SEL_VAL)[3].link_val,"CA_EVENT");
          strcpy((*p_SEL_VAL)[4].link_val,"INSTR_CODE");
          strcpy((*p_SEL_VAL)[5].link_val,"TEVENTID");
          if(strcmp(p_msg_no,"552N01") == 0 ||
            strcmp(p_msg_no,"552C01") == 0 ||
            strcmp(p_msg_no,"552R01") == 0)
          	strcpy((*p_SEL_VAL)[6].link_val,"LNOTE_NBR");
          else
          	strcpy((*p_SEL_VAL)[6].link_val,"LENTNOTE_NO");
          strcpy((*p_SEL_VAL)[7].link_val,"NPOS");
          strcpy((*p_SEL_VAL)[8].link_val,"INSTR_TYPE");
          strcpy((*p_SEL_VAL)[9].link_val,"NEW_SAFEK_RT");
          strcpy((*p_SEL_VAL)[10].link_val,"OP_EVT_CLASS");
          strcpy((*p_SEL_VAL)[11].link_val,"OLD_STOCK_QTY_RATE");
          strcpy((*p_SEL_VAL)[12].link_val,"PROC_OTH");
          if( strcmp(p_msg_no,"552N01") != 0  &&
              strcmp(p_msg_no,"552C01") != 0  &&
              strcmp(p_msg_no,"552R01") != 0)
          {
          	strcpy((*p_SEL_VAL)[13].link_val,"QUANTITY_BAL");
          	strcpy((*p_SEL_VAL)[14].link_val,"NEGPOSN"); 

				

            strcpy((*p_SEL_VAL)[15].link_val,"CORP_ID");
            strcpy((*p_SEL_VAL)[16].link_val,"");
            strcpy((*p_SEL_VAL)[16].link_tag,"");
          }
			 
			 else
			 {
		
			 	strcpy((*p_SEL_VAL)[13].link_val,"NEW_SAFEK_QTY");
			 	strcpy((*p_SEL_VAL)[14].link_val,"OLD_STK_QTY");
				strcpy((*p_SEL_VAL)[15].link_val,"SUB_NEW_QUANTITY");
				strcpy((*p_SEL_VAL)[16].link_val,"SUB_BASE_QUANTITY");
	  

            strcpy((*p_SEL_VAL)[16].link_val,"CORP_ID");
            strcpy((*p_SEL_VAL)[17].link_val,"PRELIM"); 
            strcpy((*p_SEL_VAL)[17].link_tag,"");
				strcpy((*p_SEL_VAL)[18].link_val,"");
				strcpy((*p_SEL_VAL)[18].link_tag,"");
			 }
			 

	  strcpy(chr_l_sel_msg_stmt,"select a.instr_code,substr(to_char(a.DECLARE_DT,'YYMMDD'),1,6) as DECLARE_DT,");
	  strcat(chr_l_sel_msg_stmt,"substr(to_char(a.DECLARE_DT,'DD-MM-YYYY'),1,10) as EM_DECLARE_DT,");
	  strcat(chr_l_sel_msg_stmt,"a.CA_EVENT,a.EVNT_INDNT,");
	  strcat(chr_l_sel_msg_stmt,"substr(to_char(a.EXPIRY_DATE,'YYMMDD'),1,6) as EXPIRY_DATE,substr(to_char(a.EX_DATE,'YYMMDD'),1,6) as EX_DATE,");
	  strcat(chr_l_sel_msg_stmt,"substr(to_char(a.EX_DATE,'DD-MM-YYYY'),1,10) as EM_EX_DATE,");
	  strcat(chr_l_sel_msg_stmt,"substr(to_char(a.RESPONSE_DATE,'YYMMDD'),1,6) as RESPONSE_DATE,");
	  strcat(chr_l_sel_msg_stmt,"substr(to_char(a.start_date,'YYMMDD'),1,6) as START_DATE,");
	  strcat(chr_l_sel_msg_stmt,"substr(to_char(a.dateof_payment,'YYMMDD'),1,6) as dateof_payment,substr(to_char(a.REC_DATE,'YYMMDD'),1,6) as REC_DATE,");
	  strcat(chr_l_sel_msg_stmt,"substr(to_char(a.REC_DATE,'DD-MM-YYYY'),1,10) as EM_REC_DATE,");
	  strcat(chr_l_sel_msg_stmt,"substr(to_char(a.dateof_payment,'DD-MM-YYYY'),1,10) as EM_DATEOF_PAYMENT,substr(to_char(a.BC_FROM_DATE,'YYMMDD'),1,6) as BC_DATE,");
	  strcat(chr_l_sel_msg_stmt,"a.RES_INSTR_CODE,decode(a.SUB_PR,0,'0',NULL,'0',a.SUB_PR) as SUB_PR,decode(a.RHTS_CLASS,'Y','SALABLE','NONSALE') as RHTS_CLASS,");
	  strcat(chr_l_sel_msg_stmt,"decode(a.PART_PYMT_DT,NULL,NULL,substr(to_char(a.PART_PYMT_DT,'YYMMDD'),1,6)) as PART_PYMT_DT,");
	  strcat(chr_l_sel_msg_stmt,"decode(a.PART_PYMT_DT,NULL,NULL,substr(to_char(a.PART_PYMT_DT,'DD-MM-YYYY'),1,10)) as EM_PART_PYMT_DT,");
	  strcat(chr_l_sel_msg_stmt,"a.DISP_OF_FRACT,a.EXP_DT_OPEN_IND,a.RESP_DT_OPND,");
	  strcat(chr_l_sel_msg_stmt, " b.CLN_FRACT_IND as FRACT_IND, '");  	
     strcat(chr_l_sel_msg_stmt, chr_l_keep_fract_temp);
     strcat(chr_l_sel_msg_stmt, "' as FRACT_COND,");
	  strcat(chr_l_sel_msg_stmt,"substr(concat(concat(concat(concat(decode(a.OLD_STK_QTY,NULL,'0',0,'0',a.OLD_STK_QTY),',/'),c.INSTR_TYPE),decode(a.NEW_SAFEK_QTY,NULL,'0',0,'0',a.NEW_SAFEK_QTY)),','),1,15) as RATIO,");
	  strcat(chr_l_sel_msg_stmt,"substr(concat(concat(decode(a.OLD_STK_QTY,NULL,'0',0,'0',a.OLD_STK_QTY),':'),decode(a.NEW_SAFEK_QTY,NULL,'0',0,'0',a.NEW_SAFEK_QTY)),1,15) as TRATIO,");
	  strcat(chr_l_sel_msg_stmt,"a.OLD_STK_QTY,a.NEW_SAFEK_QTY,");
	  strcat(chr_l_sel_msg_stmt,"substr(concat(a.instr_code,concat(concat(to_char(to_date(a.DECLARE_DT),'YY'),lpad(((to_date(a.DECLARE_DT) - to_date(concat(concat('01/01/',to_char(a.DECLARE_DT,'YYYY')),' 12:00:00')))+1),3,'0')),lpad(substr(to_char(a.EVNT_INDNT),1,2),2,'0'))),1,16) as TEVENTID,");
   	 /*Nikhil Buy Back intimation to play back email earning ratio/rate */
        /* VaibhavK changes are done for BB Event -Cancellation Msg. KOTAK 30 Oct 2007 */
      if(strcmp(p_msg_no,"552N01") == 0 || strcmp(p_msg_no,"552R01") == 0)
		{
			strcat(chr_l_sel_msg_stmt," a.LWR_LIMIT as LOWER_LIMIT,");
			strcat(chr_l_sel_msg_stmt," a.UPR_LIMIT as UPPER_LIMIT,");
			strcat(chr_l_sel_msg_stmt," a.BK_BUILD_IND as FIXED_PRICE,");
			strcat(chr_l_sel_msg_stmt," to_char(decode(a.EARNINGS,NULL,'0',0,'0',a.EARNINGS),'9999999999999990.99999999' ) as EARNINGS," );
			strcat(chr_l_sel_msg_stmt," to_char(decode(a.EARNINGS,NULL,'0',0,'0',a.EARNINGS),'9999999999999990.99999999') as TEARNINGS," );
			strcat(chr_l_sel_msg_stmt," substr(to_char(a.DEAL_FRM_DATE,'YYYYMMDD'),1,8) as NEW_TRADEFROM_DT,");
			strcat(chr_l_sel_msg_stmt," substr(to_char(a.DEAL_FRM_DATE,'DD-MM-YYYY'),1,10) as EM_TRADEFROM_DT,");
			strcat(chr_l_sel_msg_stmt,"substr(to_char(a.DEAL_TO_DATE,'YYYYMMDD'),1,8) as NEW_TRADETO_DT, ");
			strcat(chr_l_sel_msg_stmt,"substr(to_char(a.DEAL_TO_DATE,'DD-MM-YYYY'),1,10) as EM_TRADETO_DT, ");
			strcat(chr_l_sel_msg_stmt,"c.currency_cd as CCYTEARNINGS , '12' as DECTEARNINGS, ");
			strcat(chr_l_sel_msg_stmt,"c.currency_cd as CCYLOWER_LIMIT , '12' as DECLOWER_LIMIT, ");
			strcat(chr_l_sel_msg_stmt,"c.currency_cd as CCYUPPER_LIMIT , '12' as DECUPPER_LIMIT, ");
		}		 
	  strcat(chr_l_sel_msg_stmt,"decode(a.EARNINGS_RATE,0,'0',NULL,'0',a.EARNINGS_RATE) as EARNINGS_RATE, decode(a.EARNINGS_RATE,0,'0',NULL,'0',a.EARNINGS_RATE) as R_EARNINGS,decode(a.EARNINGS_RATE,0,'0',NULL,'0',a.EARNINGS_RATE) as R_EARNINGS, a.PRELIMINARY_FLAG as PRELIM,a.OP_EVT_CLASS,"); 
	  strcat(chr_l_sel_msg_stmt,"decode(a.SUB_BASE_QUANTITY,NULL,'0',0,'0',to_char(a.SUB_BASE_QUANTITY)) as SUB_BASE_QUANTITY,decode(a.SUB_NEW_QUANTITY,NULL,'0',0,'0',to_char(a.SUB_NEW_QUANTITY)) as SUB_NEW_QUANTITY,");
	  strcat(chr_l_sel_msg_stmt,"replace(replace(a.PROC_OTH,chr(13),NULL),chr(10),NULL) as PROC_OTH,a.INFO_SEQ as LNOTE_NBR,a.INFO_SEQ as LENTNOTE_NO,");
	  strcat(chr_l_sel_msg_stmt,"b.CLN_USE_ISIN_IND as FLGISIN,");
	  strcat(chr_l_sel_msg_stmt,"concat('/',b.cln_code) as NACCOUNT,b.cln_code,b.cln_code as CLIENT,substr(replace(replace(b.cln_name,chr(13),NULL),chr(10),NULL),1,35) as CLNT_NAME,");
	  strcat(chr_l_sel_msg_stmt,"c.INSTR_ISIN,c.INSTR_TYPE,");
	  strcat(chr_l_sel_msg_stmt,"concat('/',concat(concat(c.currency_cd,'/'),c.REG_BR_IND)) as SCCYCODE,substr(replace(replace(c.instr_name,chr(13),NULL),chr(10),NULL),1,35) as INSTR_NAME,c.NOMINAL_VALUE,");
	  strcat(chr_l_sel_msg_stmt,"c.currency_cd,");
	  strcat(chr_l_sel_msg_stmt,"c.currency_cd as CCYSUB_PRICE,");
	  strcat(chr_l_sel_msg_stmt,"c.currency_cd as CCYR_EARNINGS,b.CLN_FMT_RPTIND,");
	  strcat(chr_l_sel_msg_stmt,"decode(c.INSTR_TYPE,'BON',decode(b.CLN_FMT_RPTIND,'Y','FMT'");
	  strcat(chr_l_sel_msg_stmt,",c.INSTR_TYPE),c.INSTR_TYPE) as FTYPEOFINSTR ,");

      

      strcat(chr_l_sel_msg_stmt," a.OVER_SUBSCRP,");

      

	  
		strcat(chr_l_sel_msg_stmt," b.CLN_TAXABLE_IND  as IND_83C83D "); 
	 

          if( strcmp(p_msg_no,"552N01") != 0  &&
              strcmp(p_msg_no,"552C01") != 0  &&
              strcmp(p_msg_no,"552R01") != 0)
          {
		  /*Added by Anjaneyulu on 21/09/2015 for ISKB_1621 FENT_POS=0 - Starts*/
			if(strcmp(p_msg_no,"552C02") == 0)
			{
				EXEC SQL SELECT NVL(ELIG_ENTITL_POS,0) INTO :l_elig_pos FROM CAENTITLEMENT WHERE CORP_ID = :chr_l_ca_id 
					AND CLIENT = :l_ms_msgent_structa_a.client;
			IS_ANY_ORA_ERROR
			}
			if((APL_DOUBLE_EQUAL(l_elig_pos,0)) && (strcmp(p_msg_no,"552C02") == 0))
			{
				strcat(chr_l_sel_msg_stmt,",(SELECT decode(c.INSTR_TYPE,'BON',decode(b.CLN_FMT_RPTIND,'Y',to_char(abs(d.PREV_ELIG_HOLD)*c.NOMINAL_VALUE),to_char(abs(d.PREV_ELIG_HOLD))),to_char(abs(d.PREV_ELIG_HOLD))) FROM CAEVENT A, MT_CLIENT B, MT_INSTRUMENT C, CA_REV_ENTITLE d WHERE A.CORP_ID = D.CORP_ID AND A.INSTR_CODE = C.INSTR_CODE AND B.CLN_CODE = D.CLIENT AND d.CORP_ID ='");
				strcat(chr_l_sel_msg_stmt,chr_l_ca_id);
				strcat(chr_l_sel_msg_stmt,"' AND d.CLIENT ='");
			
				strcat(chr_l_sel_msg_stmt,l_ms_msgent_structa_a.client);
				strcat(chr_l_sel_msg_stmt,"') as FENT_POS");
				
				strcat(chr_l_sel_msg_stmt,",to_char(abs(d.INSTR_INC_BAL)) as INSTR_INC_BAL,to_char(abs(d.QUANTITY_BAL)) as QUANTITY_BAL");
			
				strcat(chr_l_sel_msg_stmt,",c.currency_cd as CCYINSTR_INC_BAL ");
	  	
				strcat(chr_l_sel_msg_stmt,", decode(d.ELIG_ENTITL_POS,abs(d.ELIG_ENTITL_POS),'N','Y') as NEGPOSN ");
			}
			/*Added by Anjaneyulu on 21/09/2015 for ISKB_1621 FENT_POS=0 - Ends*/
			else
			{
	  	strcat(chr_l_sel_msg_stmt,",decode(c.INSTR_TYPE,'BON',decode(b.CLN_FMT_RPTIND,'Y',to_char(abs(d.ELIG_ENTITL_POS)*c.NOMINAL_VALUE),to_char(abs(d.ELIG_ENTITL_POS))),to_char(abs(d.ELIG_ENTITL_POS))) as FENT_POS,to_char(abs(d.INSTR_INC_BAL)) as INSTR_INC_BAL,to_char(abs(d.QUANTITY_BAL)) as QUANTITY_BAL,");
	  	strcat(chr_l_sel_msg_stmt,"c.currency_cd as CCYINSTR_INC_BAL ");
	  	
	  	strcat(chr_l_sel_msg_stmt,", decode(d.ELIG_ENTITL_POS,abs(d.ELIG_ENTITL_POS),'N','Y') as NEGPOSN ");
          }
          }
	       
			
			 strcat(chr_l_sel_msg_stmt,",substr(to_char(a.DECLARE_DT,'YYYYMMDD'),1,8) as NEW_DECL_DT, ");
			 strcat(chr_l_sel_msg_stmt,"substr(to_char(a.DECLARE_DT,'DD-MM-YYYY'),1,10) as EM_DECL_DT, ");
			 strcat(chr_l_sel_msg_stmt,"substr(to_char(a.REC_DATE,'YYYYMMDD'),1,8) as NEW_REC_DT, ");
			 strcat(chr_l_sel_msg_stmt,"substr(to_char(a.BC_FROM_DATE,'YYYYMMDD'),1,8) as NEW_BC_DT, ");
			 strcat(chr_l_sel_msg_stmt,"substr(to_char(a.BC_FROM_DATE,'DD-MM-YYYY'),1,10) as EM_BC_DT, ");
			 strcat(chr_l_sel_msg_stmt,"substr(to_char(a.EX_DATE,'YYYYMMDD'),1,8) as NEW_EX_DT, ");
			 
			 strcat(chr_l_sel_msg_stmt,"substr(to_char(a.RESPONSE_DATE,'YYYYMMDDhh24miss'),1,14) as NEW_RESPONS_DT, ");
			 strcat(chr_l_sel_msg_stmt,"substr(to_char(a.RESPONSE_DATE,'DD-MM-YYYY hh24:mi:ss'),1,19) as EM_RESPONS_DT, ");
			 strcat(chr_l_sel_msg_stmt,"substr(to_char(a.dateof_payment,'YYYYMMDD'),1,8) as NEW_PAY_DT, ");
			 strcat(chr_l_sel_msg_stmt,"substr(to_char(a.EXPIRY_DATE,'YYYYMMDD'),1,8) as NEW_EXPIRE_DT, ");
			 strcat(chr_l_sel_msg_stmt,"substr(to_char(a.PART_PYMT_DT,'YYYYMMDD'),1,8) as NEW_PP_DT ");
			
		strcat(chr_l_sel_msg_stmt, ", a.corp_id as CORP_ID "); 
			
			strcat(chr_l_sel_msg_stmt,",substr(to_char(a.EFFECTIVE_DATE,'YYYYMMDD'),1,8) as NEW_EFFECT_DT");
			strcat(chr_l_sel_msg_stmt,",decode(c.INSTR_TYPE,'FMT','PCT',c.currency_cd) as IRTTYPE");

		if( strcmp(p_msg_no,"552N01") != 0 && strcmp(p_msg_no,"552C01") != 0 && strcmp(p_msg_no,"552R01") != 0 )
				strcat(chr_l_sel_msg_stmt,",substr(to_char(d.access_stamp,'YYYYMMDDHH24MISS'),1,14) as ACC_STMP");
			
	  
	  strcat(chr_l_sel_msg_stmt,",decode(a.NEW_SAFEK_RT,NULL,'0',0,'0',a.NEW_SAFEK_RT) as STOCK_RATE ");
	  strcat(chr_l_sel_msg_stmt,",c.currency_cd as CCYSTOCK_RATE , '12' as DECSTOCK_RATE ");

	  
	  strcat(chr_l_sel_msg_stmt,", substr(to_char(a.start_date,'YYYYMMDD'),1,8) as NEW_START_DT");

	
      if( strcmp(p_msg_no,"552N01") != 0 &&
         strcmp(p_msg_no,"552C01") != 0 &&
         strcmp(p_msg_no,"552R01") != 0 )
      {
         strcat(chr_l_sel_msg_stmt," ,decode(c.INSTR_TYPE,'BON',decode(b.CLN_FMT_RPTIND,'Y',to_char(abs(d.ELIG_ENTITL_POS)*c.NOMINAL_VALUE*a.SUB_PR),to_char(abs(d.ELIG_ENTITL_POS)*a.SUB_PR)),to_char(abs(d.ELIG_ENTITL_POS)*a.SUB_PR)) as CASH_PROC");
         strcat(chr_l_sel_msg_stmt," ,decode(c.INSTR_TYPE,'BON',decode(b.CLN_FMT_RPTIND,'Y',to_char(abs(d.QUANTITY_BAL)*c.NOMINAL_VALUE*a.SUB_PR),to_char(abs(d.QUANTITY_BAL)*a.SUB_PR)),to_char(abs(d.QUANTITY_BAL)*a.SUB_PR)) as CV_CASH_PROC");
         strcat(chr_l_sel_msg_stmt," ,d.CCY_FOR_ENTITL as CCYCASH_PROC ");
      }
      

		strcat(chr_l_sel_msg_stmt,",a.DIVIDEND_TYPE as NEW_DEF_OPT "); 	

     
     strcat(chr_l_sel_msg_stmt," ,decode(a.WWWADDR,NULL,NULL,substr(a.WWWADDR,1,35)) as WEBB_ADD1");
     strcat(chr_l_sel_msg_stmt," ,decode(a.WWWADDR,NULL,NULL,substr(a.WWWADDR,36,35)) as WEBB_ADD2");
     strcat(chr_l_sel_msg_stmt," ,decode(a.WWWADDR,NULL,NULL,substr(a.WWWADDR,71,35)) as WEBB_ADD3");
     

     
     strcat(chr_l_sel_msg_stmt," ,a.FRACT_PR as FRACT_PR, a.CA_CURRENCY as CCYF_PRICE");
		
		
		strcat(chr_l_sel_msg_stmt," ,a.REQD_CERTIFY as REQD_CERTIFY,nvl(b.CLN_GENERATE_IND,'N')  as CLN_GENERATE_IND ");   
		 	
		
		strcat(chr_l_sel_msg_stmt,", substr(to_char(a.start_date,'YYYYMMDD'),1,8) as NEW_START_DT");
		strcat(chr_l_sel_msg_stmt,", substr(to_char(a.EXPIRY_DATE,'YYYYMMDD'),1,8) as NEW_EXPIRE_DT");
		strcat(chr_l_sel_msg_stmt,", substr(to_char(a.MEETING_DATE,'YYYYMMDD'),1,8) as NEW_DEAL_DT");
		
	  strcat(chr_l_sel_msg_stmt," from CAEVENT a,MT_CLIENT b,MT_INSTRUMENT c");
          if( strcmp(p_msg_no,"552N01") != 0 &&
              strcmp(p_msg_no,"552C01") != 0 &&
              strcmp(p_msg_no,"552R01") != 0 ) 
                 strcat(chr_l_sel_msg_stmt,",CAENTITLEMENT d ");
	  strcat(chr_l_sel_msg_stmt," where a.instr_code = c.instr_code and  a.corp_id = '");
	  strcat(chr_l_sel_msg_stmt,chr_l_ca_id);
          strcat(chr_l_sel_msg_stmt,"' ");
			 		
          if( strcmp(p_msg_no,"552N01") == 0 ||
              strcmp(p_msg_no,"552C01") == 0 ||
              strcmp(p_msg_no,"552R01") == 0 )
				  	{
          		}
			 		
				if( strcmp(p_msg_no,"552N01") != 0 &&
              strcmp(p_msg_no,"552C01") != 0 &&
              strcmp(p_msg_no,"552R01") != 0 )
          {
	  	strcat(chr_l_sel_msg_stmt," and a.corp_id = d.corp_id and d.client = b.cln_code ");
          }
          if(strlen(l_ms_msgent_structa_a.client)!=0)
	  {
          	strcat(chr_l_sel_msg_stmt,"and b.cln_code = '");
          	strcat(chr_l_sel_msg_stmt,l_ms_msgent_structa_a.client);
          	strcat(chr_l_sel_msg_stmt,"'");
	  }
	  if(strcmp(p_msg_no,"552R01") == 0)
	  {
		strcat(chr_l_sel_msg_stmt," and b.cln_code IN (select client from MS_MSGSTAT where proc_init = '");
		strcat(chr_l_sel_msg_stmt,chr_l_ca_id);
		strcat(chr_l_sel_msg_stmt,"' and swift_msg_rep IN ('552N01','564N21'))");
	  }
	 
	  if(strcmp(p_msg_no,"552R03") == 0)
	  {
		strcat(chr_l_sel_msg_stmt," and b.cln_code IN (select client from MS_MSGSTAT where proc_init = '");
		strcat(chr_l_sel_msg_stmt,chr_l_ca_id);
		strcat(chr_l_sel_msg_stmt,"' and swift_msg_rep IN ('552N02','564N22','552C02','564C22'))");
	  }

          strcat(chr_l_sel_msg_stmt," and b.STATUS != '");
          strcat(chr_l_sel_msg_stmt,STATUS_CLS_AUTH);
          strcat(chr_l_sel_msg_stmt,"' ");
        } 
         
        if((strncmp(p_msg_no,"563",3) == 0) || (strcmp(p_msg_no,"566R03") == 0))
        {
          l_msgaddr = MCORPACTIONSMSGNO;
          if((strcmp(p_msg_no,"563N03")==0 ) || (strcmp(p_msg_no,"566R03")==0 )) 
	  {
          if(strlen(l_ms_msgent_structa_a.proc_init) != 0)
          {
             strcpy(chr_l_ca_id,l_ms_msgent_structa_a.proc_init);
          }
	  else
          {
	     APL_DATA_MISSING("CA ID", APL_NULL_STRING, APL_NULL_STRING)
             APL_GOBACK_FAIL
          }

			Alert("l_ms_msgent_structa_a proc_data |%d| |%s|",strlen(l_ms_msgent_structa_a.proc_data),l_ms_msgent_structa_a.proc_data);
			fflush(stdout);

          if(strlen(l_ms_msgent_structa_a.proc_data) != 0)
          {
             CO_SplitStr(l_ms_msgent_structa_a.proc_data,';', &int_noelem, &chr_l_param);
					Alert("|%s| |%s| |%s|",chr_l_param[0],chr_l_param[1],chr_l_param[2]);
					fflush(stdout);
             strcpy(chr_l_refno,chr_l_param[0]);
				Alert("chr_l_refno = |%s|",chr_l_refno);
				fflush(stdout);
             strcpy(chr_l_qty_recd,chr_l_param[1]);
             strcpy(chr_l_ce_typ,chr_l_param[2]);
					/** SGS if( !strcmp(chr_l_ce_typ,"SP") )  **/
				 if(int_noelem==4)
             		strcpy(chr_l_qty_del,chr_l_param[3]); 
          }
          }

     if(strcmp(p_msg_no,"563N04")==0 )
	  {
          if(strlen(l_ms_msgent_structa_a.proc_init) != 0)
          {
             strcpy(chr_l_refno,l_ms_msgent_structa_a.proc_init);
          }
	  else
          {
	          APL_DATA_MISSING("Txn Ref no.", APL_NULL_STRING, APL_NULL_STRING)
             APL_GOBACK_FAIL
          }
          if(strlen(l_ms_msgent_structa_a.proc_data) != 0)
          {
             CO_SplitStr(l_ms_msgent_structa_a.proc_data,';', &int_noelem, &chr_l_param);
             strcpy(chr_l_instrcode,chr_l_param[0]);
             
             strcpy(chr_l_sc_eventid,chr_l_param[1]);
             strcpy(chr_l_sc_mode,chr_l_param[2]);
             
	       }
	       if((strlen(chr_l_instrcode) == 0) && (!strcmp(chr_l_sc_mode,"B")))
          {
	          APL_DATA_MISSING("Old INSTRUMENT Code", APL_NULL_STRING, APL_NULL_STRING)
             APL_GOBACK_FAIL
          }
     }

		
          if(strcmp(p_msg_no,"563N05")==0 )
	  {
          if(strlen(l_ms_msgent_structa_a.proc_init) != 0)
          {
             strcpy(chr_l_refno,l_ms_msgent_structa_a.proc_init);
          }
	  else
          {
	     APL_DATA_MISSING("Txn Ref no.", APL_NULL_STRING, APL_NULL_STRING)
             APL_GOBACK_FAIL
          }
          if(!strlen(l_ms_msgent_structa_a.client) )
	       { 
					APL_DATA_MISSING("CLIENT", APL_NULL_STRING, APL_NULL_STRING)
            	 APL_GOBACK_FAIL
          }
          if(strlen(l_ms_msgent_structa_a.proc_data) != 0)
          {
             CO_SplitStr(l_ms_msgent_structa_a.proc_data,';', &int_noelem, &chr_l_param);
             strcpy(chr_l_instrcode,chr_l_param[0]);
             
             strcpy(chr_l_eventid,chr_l_param[1]);
             strcpy(chr_l_prevseme,chr_l_param[2]);
             strcpy(chr_l_566reverse,chr_l_param[3]);
             memset(chr_l_tmp_instr_dt,APL_NULL_CHAR,APL_DATE_LEN);
             memset(chr_l_tmp_moneydt,APL_NULL_CHAR,APL_DATE_LEN);
             memset(chr_l_postdt,APL_NULL_CHAR,APL_DATE_LEN);
             memset(chr_l_new_postdt,APL_NULL_CHAR,APL_DATE_LEN);
             if (!strcmp(chr_l_566reverse,"R"))
                {
                 strcpy(chr_l_tmp_instr_dt,chr_l_param[4]);
                 strcpy(chr_l_tmp_moneydt,chr_l_param[5]);
                 EXEC SQL SELECT TO_CHAR(SYS_DATE,'YYMMDD'),TO_CHAR(SYS_DATE,'YYYYMMDD')
                          INTO :chr_l_postdt:i_postdt,:chr_l_new_postdt:i_new_postdt
                          FROM PRO_SYS_DATE;

                 IS_ANY_ORA_ERROR
                }
	       }
	  if(strlen(chr_l_instrcode) == 0)
          {
	     APL_DATA_MISSING("Old INSTRUMENT Code", APL_NULL_STRING, APL_NULL_STRING)
             APL_GOBACK_FAIL
          }
          }
		

          if(strcmp(p_msg_no,"563N01")==0 ||
	    strcmp(p_msg_no,"563N02") == 0 )
	  {
          if(strlen(l_ms_msgent_structa_a.proc_data) != 0)
          {
             CO_SplitStr(l_ms_msgent_structa_a.proc_data,';', &int_noelem, &chr_l_param);
             strcpy(chr_l_instrcode,chr_l_param[0]);
             strcpy(chr_l_ce_typ,chr_l_param[1]);
             strcpy(chr_l_decl_date,chr_l_param[2]);
             strcpy(chr_l_event_srl_nbr,chr_l_param[3]);
             strcpy(chr_l_refno,chr_l_param[4]);
	  }
	  if(strlen(chr_l_refno) == 0)
          {
	     APL_DATA_MISSING("Txn Ref no.", APL_NULL_STRING, APL_NULL_STRING)
             APL_GOBACK_FAIL
          }
	  if(strlen(chr_l_instrcode) == 0)
          {
	     APL_DATA_MISSING("INSTRUMENT Code", APL_NULL_STRING, APL_NULL_STRING)
             APL_GOBACK_FAIL
          }
	  if(strlen(chr_l_ce_typ) == 0)
          {
	     APL_DATA_MISSING("Event CLASS", APL_NULL_STRING, APL_NULL_STRING)
             APL_GOBACK_FAIL
          }
	  if(strlen(chr_l_decl_date) == 0)
          {
	     APL_DATA_MISSING("Event Decl. Date", APL_NULL_STRING, APL_NULL_STRING)
             APL_GOBACK_FAIL
          }
	  if(strlen(chr_l_event_srl_nbr) == 0)
          {
	     APL_DATA_MISSING("Event Srl No.", APL_NULL_STRING, APL_NULL_STRING)
             APL_GOBACK_FAIL
          }
          }  
          if((strcmp(p_msg_no,"563N03")==0 ) || (strcmp(p_msg_no,"566R03")==0 ))
	  {
	    if(strlen(chr_l_refno) == 0)
            {
	     APL_DATA_MISSING("Pay Srl Nbr", APL_NULL_STRING, APL_NULL_STRING)
             APL_GOBACK_FAIL
	    }
	    if(strlen(chr_l_ce_typ) == 0)
	    {
	     APL_DATA_MISSING("Event CLASS", APL_NULL_STRING, APL_NULL_STRING)
             APL_GOBACK_FAIL
	    }
	    if(strlen(chr_l_qty_recd) == 0 && strcmp(chr_l_ce_typ,"SP") == 0)
	    {
	     APL_DATA_MISSING("Payment QTY", APL_NULL_STRING, APL_NULL_STRING)
             APL_GOBACK_FAIL
	    }
	  }
  
          *p_STAT_VAL = realloc(*p_STAT_VAL,sizeof(MS_STATIC_VAL)*10); 
			  
          *p_SEL_VAL = realloc(*p_SEL_VAL,sizeof(MS_STATIC_VAL)*20);
			
	/* Changes done by Hardik for ISKB_8748 on 22/09/2016 Start */
	 /* For MT566 DAT creation of a CV-BO and SP event, exe's(CA_Trans_Settle) is getting abruptly killed because garbage values are assigned to below variable,to handle this variables are Intialized by 0.0 */
	  (*p_SEL_VAL)[12].NUM_VAL = 0.0;
	  (*p_SEL_VAL)[13].NUM_VAL = 0.0;
          (*p_SEL_VAL)[9].NUM_VAL = 0.0;
          (*p_SEL_VAL)[10].NUM_VAL = 0.0;
          (*p_SEL_VAL)[14].NUM_VAL = 0.0;
          (*p_SEL_VAL)[15].NUM_VAL = 0.0;
          (*p_SEL_VAL)[16].NUM_VAL = 0.0;	
	/* Changes done by Hardik for ISKB_8748 on 22/09/2016 End */
	
          strcpy((*p_STAT_VAL)[0].link_val,"DUMMY");
          strcpy((*p_STAT_VAL)[0].link_tag,"DUMMY");
          strcpy((*p_STAT_VAL)[1].link_val,"DOMSEC");
          strcpy((*p_STAT_VAL)[1].link_tag,chr_h_dom_instr);

    
      
      EXEC SQL SELECT substr(to_char(to_date(:h_sys_dt,'rrmmdd'),'yyyymmdd'),1,8) into :chr_h_date_new from dual;
      IS_ANY_ORA_ERROR
	
          if(strcmp(p_msg_no,"563N01")==0)
          {
            strcpy((*p_STAT_VAL)[2].link_val,"IDENTIY_NO");
            strcpy((*p_STAT_VAL)[2].link_tag,chr_l_refno);
            strcpy((*p_STAT_VAL)[3].link_val,"DATE");
            strcpy((*p_STAT_VAL)[3].link_tag,h_sys_dt);
				
				strcpy((*p_STAT_VAL)[4].link_val,"NATION");
				strcpy((*p_STAT_VAL)[4].link_tag,g_mt_commonsys_params_struct_h.nation_code);

				
				 strcpy((*p_STAT_VAL)[5].link_val,"SEQNUM_PAY");
				strcpy((*p_STAT_VAL)[5].link_tag,chr_l_refno);
				

            strcpy((*p_STAT_VAL)[6].link_val,"CNTRY_BIC");			
            strcpy((*p_STAT_VAL)[6].link_tag,l_mt_message_sys_params_struct_h.swift_cd);
            strcpy((*p_STAT_VAL)[7].link_val,"");
            strcpy((*p_STAT_VAL)[7].link_tag,"");
				

            strcpy((*p_SEL_VAL)[0].link_val,"DUMMY");
            strcpy((*p_SEL_VAL)[1].link_val,"INSTR_PARENT");
            strcpy((*p_SEL_VAL)[2].link_val,"DUMMY");
            strcpy((*p_SEL_VAL)[3].link_val,"DUMMY");
            strcpy((*p_SEL_VAL)[4].link_val,"DUMMY");
            strcpy((*p_SEL_VAL)[5].link_val,"DUMMY");
            strcpy((*p_SEL_VAL)[6].link_val,"INFO_SEQ");
            strcpy((*p_SEL_VAL)[7].link_val,"DUMMY"); 
            strcpy((*p_SEL_VAL)[8].link_val,"DUMMY"); 
            strcpy((*p_SEL_VAL)[9].link_val,"CORP_ID");
				
				#ifdef EMU_PROCESSING
            	strcpy((*p_SEL_VAL)[10].link_val,"IDENTIY_NO");
            	strcpy((*p_SEL_VAL)[11].link_val,"CA_EVENT");
            	strcpy((*p_SEL_VAL)[12].link_val,"CLIENT");
					strcpy((*p_SEL_VAL)[13].link_val,"LOCATION_CD");
					
               strcpy((*p_SEL_VAL)[14].link_val,"CCYSUB_PRICE");
               strcpy((*p_SEL_VAL)[15].link_val,"SUB_PR");
               
               strcpy((*p_SEL_VAL)[16].link_val,"INSTR_CODE"); 
               strcpy((*p_SEL_VAL)[17].link_val,"FENT_POS");
               strcpy((*p_SEL_VAL)[18].link_val,"CURRMSGREFNO");
               strcpy((*p_SEL_VAL)[19].link_val,"");
               strcpy((*p_SEL_VAL)[19].link_tag,"");
				#else
					strcpy((*p_SEL_VAL)[10].link_val,"CLIENT");
            	strcpy((*p_SEL_VAL)[11].link_val,"INSTR_CODE"); 
            	strcpy((*p_SEL_VAL)[12].link_val,"FENT_POS");
            	strcpy((*p_SEL_VAL)[13].link_val,"FENT_POS");
            	strcpy((*p_SEL_VAL)[14].link_val,"CURRMSGREFNO");
            	strcpy((*p_SEL_VAL)[15].link_val,"");
            	strcpy((*p_SEL_VAL)[15].link_tag,"");
				#endif
            
          }
          if(strcmp(p_msg_no,"563N02")==0)
          {
            strcpy((*p_STAT_VAL)[2].link_val,"DL_DEAL");
            strcpy((*p_STAT_VAL)[2].link_tag,"DF");
            strcpy((*p_STAT_VAL)[3].link_val,"DATE");
            strcpy((*p_STAT_VAL)[3].link_tag,h_sys_dt);
            strcpy((*p_STAT_VAL)[4].link_val,"IDENTIY_NO");
            strcpy((*p_STAT_VAL)[4].link_tag,chr_l_refno);
            strcpy((*p_STAT_VAL)[5].link_val,"CA_EVENT");

            strcpy((*p_STAT_VAL)[5].link_tag,"RT");
				
				strcpy((*p_STAT_VAL)[6].link_val,"NATION");
				strcpy((*p_STAT_VAL)[6].link_tag,g_mt_commonsys_params_struct_h.nation_code);
            strcpy((*p_STAT_VAL)[7].link_val,"CNTRY_BIC");  
            strcpy((*p_STAT_VAL)[7].link_tag,l_mt_message_sys_params_struct_h.swift_cd);
            strcpy((*p_STAT_VAL)[8].link_val,"");
            strcpy((*p_STAT_VAL)[8].link_tag,"");
				

            strcpy((*p_SEL_VAL)[0].link_val,"DUMMY");
            strcpy((*p_SEL_VAL)[1].link_val,"INSTR_PARENT");
            strcpy((*p_SEL_VAL)[2].link_val,"DUMMY");
            strcpy((*p_SEL_VAL)[3].link_val,"CA_EVENT");
            strcpy((*p_SEL_VAL)[3].link_tag,"RT");
            strcpy((*p_SEL_VAL)[4].link_val,"DECLARE_DT");
            strcpy((*p_SEL_VAL)[5].link_val,"EVNT_INDNT");
            strcpy((*p_SEL_VAL)[6].link_val,"CLIENT");
            strcpy((*p_SEL_VAL)[7].link_val,"DUMMY");
            strcpy((*p_SEL_VAL)[8].link_val,"INSTR_TYPE");
            strcpy((*p_SEL_VAL)[9].link_val,"CORP_ID");
            strcpy((*p_SEL_VAL)[10].link_val,"DUMMY");   
            strcpy((*p_SEL_VAL)[11].link_val,"INFO_SEQ");
            strcpy((*p_SEL_VAL)[12].link_val,"FENT_POS");
            strcpy((*p_SEL_VAL)[13].link_val,"INSTR_CODE");  
            strcpy((*p_SEL_VAL)[14].link_val,"CURRMSGREFNO");  
            strcpy((*p_SEL_VAL)[15].link_val,"");			
            strcpy((*p_SEL_VAL)[15].link_tag,"");			
          }
	        
          if((strcmp(p_msg_no,"563N03")==0) || (strcmp(p_msg_no,"566R03")==0))
          {
		  
		  printf("\n Inside 563N03 \n");
		  fflush(stdout);
            strcpy((*p_STAT_VAL)[2].link_val,"DATE");
            strcpy((*p_STAT_VAL)[2].link_tag,h_sys_dt);
				
				strcpy((*p_STAT_VAL)[3].link_val,"NATION");
				 strcpy((*p_STAT_VAL)[3].link_tag,g_mt_commonsys_params_struct_h.nation_code);

				
				strcpy((*p_STAT_VAL)[4].link_val,"SEQNUM_PAY");
				strcpy((*p_STAT_VAL)[4].link_tag,chr_l_refno);

				Alert("SEQNUM_PAY = |%s|",chr_l_refno);
				fflush(stdout);
				

            strcpy((*p_STAT_VAL)[5].link_val,"CNTRY_BIC");		
            strcpy((*p_STAT_VAL)[5].link_tag,l_mt_message_sys_params_struct_h.swift_cd);
            strcpy((*p_STAT_VAL)[6].link_val,"");
            strcpy((*p_STAT_VAL)[6].link_tag,"");
				

            strcpy((*p_SEL_VAL)[0].link_val,"RES_INSTR_CODE");
            strcpy((*p_SEL_VAL)[1].link_val,"DUMMY");
            strcpy((*p_SEL_VAL)[1].link_tag,"DUMMY");
            strcpy((*p_SEL_VAL)[2].link_val,"ENTL_SEND_MSG_IND");
            strcpy((*p_SEL_VAL)[3].link_val,"CA_EVENT");
            strcpy((*p_SEL_VAL)[4].link_val,"INSTR_CODE");
            strcpy((*p_SEL_VAL)[5].link_val,"TEVENTID");

		
            strcpy((*p_SEL_VAL)[6].link_val,"LNOTE_NBR");
            strcpy((*p_SEL_VAL)[7].link_val,"CLIENT");
            strcpy((*p_SEL_VAL)[8].link_val,"INSTR_TYPE");
            strcpy((*p_SEL_VAL)[9].link_val,"CORP_ID");
            strcpy((*p_SEL_VAL)[10].link_val,"OP_EVT_CLASS");
            strcpy((*p_SEL_VAL)[11].link_val,"DUMMY");
            strcpy((*p_SEL_VAL)[12].link_val,"PROC_OTH");
            strcpy((*p_SEL_VAL)[13].link_val,"QUANTITY_RECEIVED");
            strcpy((*p_SEL_VAL)[14].link_val,"SUB_PR"); 
				strcpy((*p_SEL_VAL)[15].link_val,"SUB_NEW_QUANTITY"); 
				strcpy((*p_SEL_VAL)[16].link_val,"SUB_BASE_QUANTITY"); 
				strcpy((*p_SEL_VAL)[17].link_val,"CURRMSGREFNO"); 
				strcpy((*p_SEL_VAL)[18].link_val,"");
				strcpy((*p_SEL_VAL)[18].link_tag,"");

         }
	        
          if(strcmp(p_msg_no,"563N04")==0)
          {
            strcpy((*p_STAT_VAL)[2].link_val,"DATE");
            strcpy((*p_STAT_VAL)[2].link_tag,h_sys_dt);
            strcpy((*p_STAT_VAL)[3].link_val,"OINSTR_CODE");
            strcpy((*p_STAT_VAL)[3].link_tag,chr_l_instrcode);
				
				strcpy((*p_STAT_VAL)[4].link_val,"NATION");
				strcpy((*p_STAT_VAL)[4].link_tag,g_mt_commonsys_params_struct_h.nation_code);
				
            strcpy((*p_STAT_VAL)[5].link_val,"NEW_DT");
            strcpy((*p_STAT_VAL)[5].link_tag,chr_h_date_new);
            
            
            if (chr_l_sc_eventid[0]==' ')
            {
            strcpy((*p_STAT_VAL)[6].link_val,"CORPREFNO");
            strcpy((*p_STAT_VAL)[6].link_tag,"NONREF");
            }
            else
            {
            strcpy((*p_STAT_VAL)[6].link_val,"CORPREFNO");
            strcpy((*p_STAT_VAL)[6].link_tag,chr_l_sc_eventid);
            }
            strcpy((*p_STAT_VAL)[7].link_val,"SCMODE");
            strcpy((*p_STAT_VAL)[7].link_tag,chr_l_sc_mode);
            strcpy((*p_STAT_VAL)[8].link_val,"CNTRY_BIC");		
            strcpy((*p_STAT_VAL)[8].link_tag,l_mt_message_sys_params_struct_h.swift_cd);
            strcpy((*p_STAT_VAL)[9].link_val,"");
            strcpy((*p_STAT_VAL)[9].link_tag,"");
            
				

            strcpy((*p_SEL_VAL)[0].link_val,"OINSTR_CODE");
            strcpy((*p_SEL_VAL)[1].link_val,"CLIENT");
            strcpy((*p_SEL_VAL)[2].link_val,"QTY");
            strcpy((*p_SEL_VAL)[3].link_val,"DUMMY");
            strcpy((*p_SEL_VAL)[4].link_val,"DUMMY");
            strcpy((*p_SEL_VAL)[5].link_val,"INSTR_CODE");
            strcpy((*p_SEL_VAL)[6].link_val,"LNOTE_NBR");
            strcpy((*p_SEL_VAL)[6].link_tag,"");
            strcpy((*p_SEL_VAL)[7].link_val,"CURRMSGREFNO"); 
            strcpy((*p_SEL_VAL)[8].link_val,"");
            strcpy((*p_SEL_VAL)[8].link_tag,"");
	  		}
	
		
          if(strcmp(p_msg_no,"563N05")==0)
          {
            strcpy((*p_STAT_VAL)[2].link_val,"DATE");
            strcpy((*p_STAT_VAL)[2].link_tag,h_sys_dt);
            strcpy((*p_STAT_VAL)[3].link_val,"INSTR_CODE");
            strcpy((*p_STAT_VAL)[3].link_tag,chr_l_instrcode);
				
				strcpy((*p_STAT_VAL)[4].link_val,"NATION");
				strcpy((*p_STAT_VAL)[4].link_tag,g_mt_commonsys_params_struct_h.nation_code);
             
            if (strlen(chr_l_eventid) == 0)
             {
              strcpy((*p_STAT_VAL)[5].link_val,"CORPREFNO");
              strcpy((*p_STAT_VAL)[5].link_tag,"NONREF");
             }
            else
             {
               strcpy((*p_STAT_VAL)[5].link_val,"CORPREFNO");
               strcpy((*p_STAT_VAL)[5].link_tag,chr_l_eventid);
             }

            strcpy((*p_STAT_VAL)[6].link_val,"PREVSEME");
            strcpy((*p_STAT_VAL)[6].link_tag,chr_l_prevseme);

            if (!strcmp(chr_l_566reverse,"R"))
               {
                strcpy((*p_STAT_VAL)[7].link_val,"REVERSE");
                strcpy((*p_STAT_VAL)[7].link_tag,"Y");
               }
            else
               {
                strcpy((*p_STAT_VAL)[7].link_val,"REVERSE");
                strcpy((*p_STAT_VAL)[7].link_tag,"N");
               }

            strcpy((*p_STAT_VAL)[8].link_val,"CNTRY_BIC");			
            strcpy((*p_STAT_VAL)[8].link_tag,l_mt_message_sys_params_struct_h.swift_cd);
            strcpy((*p_STAT_VAL)[9].link_val,"");
            strcpy((*p_STAT_VAL)[9].link_tag,"");
            
				

            strcpy((*p_SEL_VAL)[0].link_val,"INSTR_CODE");
            strcpy((*p_SEL_VAL)[1].link_val,"CLIENT");
            strcpy((*p_SEL_VAL)[2].link_val,"QTY");
            strcpy((*p_SEL_VAL)[3].link_val,"DATEOF_INPUT");
            strcpy((*p_SEL_VAL)[4].link_val,"MONEY_SETL_DT");
            strcpy((*p_SEL_VAL)[5].link_val,"CURRENCY_CD");
            strcpy((*p_SEL_VAL)[6].link_val,"LNOTE_NBR"); 
            strcpy((*p_SEL_VAL)[7].link_val,"GL_ACCOUNT");
            strcpy((*p_SEL_VAL)[8].link_val,"INSTR_NAME");
            strcpy((*p_SEL_VAL)[9].link_val,"CLNT_NAME");
            strcpy((*p_SEL_VAL)[10].link_val,"IDENTIY_NO");
            strcpy((*p_SEL_VAL)[11].link_val,"AMOUNT");
            strcpy((*p_SEL_VAL)[12].link_val,"CURRMSGREFNO"); 
            strcpy((*p_SEL_VAL)[13].link_val,"TMP_INSTR_DT"); 
            strcpy((*p_SEL_VAL)[14].link_val,"TMP_MONEYDT"); 
            strcpy((*p_SEL_VAL)[15].link_val,""); 
            strcpy((*p_SEL_VAL)[15].link_tag,""); 
	  		}
		
        
			 if(strcmp(p_msg_no,"563N01")==0 ||
            strcmp(p_msg_no,"563N02")==0)
         {
	
			if((!strcmp(chr_l_ce_typ,"RN")) && (!strcmp(p_msg_no,"563N01"))) 
			{
        
        #ifdef EMU_PROCESSING
           strcpy(chr_l_sel_msg_stmt,"select c.client,'DUMMY' as PROC_INIT,");
           strcat(chr_l_sel_msg_stmt,"a.instr_code,substr(to_char(a.DECLARE_DT,'YYMMDD'),1,6) as DECLARE_DT,");
           strcat(chr_l_sel_msg_stmt,"a.instr_code,substr(to_char(a.DECLARE_DT,'DD-MM-YYYY'),1,10) as EM_DECLARE_DT,");
           strcat(chr_l_sel_msg_stmt,"a.EVNT_INDNT,");
           strcat(chr_l_sel_msg_stmt,"c.QTY, c.location_cd, c.IDENTIY_NO,c.UNIQ_IDENT_NO as CURRMSGREFNO,");
	   	  strcat(chr_l_sel_msg_stmt,"decode(b.INSTR_TYPE,'BON',decode(d.CLN_FMT_RPTIND,'Y','FMT'");
	   	  strcat(chr_l_sel_msg_stmt,",b.INSTR_TYPE),b.INSTR_TYPE) as FTYPEOFINSTR, ");
	  		  strcat(chr_l_sel_msg_stmt," b.INSTR_ISIN,b.NOMINAL_VALUE,");
	 		  strcat(chr_l_sel_msg_stmt," concat(concat(concat('/',b.currency_cd),'/'),b.REG_BR_IND) as SCCYCODE,");
	 		  strcat(chr_l_sel_msg_stmt," substr(replace(replace(b.instr_name,chr(13),NULL),chr(10),NULL),1,35) as INSTR_NAME,b.currency_cd,");
			 
	 		  strcat(chr_l_sel_msg_stmt," d.CLN_USE_ISIN_IND as FLGISIN,d.CLN_FMT_RPTIND,substr(replace(replace(d.cln_name,chr(13),NULL),chr(10),NULL),1,35) as CLNT_NAME,concat('/',d.cln_code) as NACCOUNT,a.instr_code as INSTR_PARENT,");
			 
				  
				  strcat(chr_l_sel_msg_stmt," d.CLN_TAXABLE_IND  as IND_83C83D ");
				  
              strcat(chr_l_sel_msg_stmt,",c.AMOUNT,b.currency_cd as CCYAMOUNT,a.CA_EVENT,");
	     		  strcat(chr_l_sel_msg_stmt,"substr(to_char(a.dateof_payment,'YYMMDD'),1,6) as DATEOF_PAYMENT,");
	     		  strcat(chr_l_sel_msg_stmt,"substr(to_char(a.dateof_payment,'DD-MM-YYYY'),1,10) as EM_DATEOF_PAYMENT,");
              strcat(chr_l_sel_msg_stmt,"concat('/',d.CLN_GL_ACCOUNT) as GL_ACCOUNT,a.CORP_ID"); 
				  strcat(chr_l_sel_msg_stmt,", substr(to_char(c.setl_date,'YYMMDD'),1,6) AS SETLDT");
					strcat(chr_l_sel_msg_stmt,",decode(a.CA_EVENT,'RN','");
					strcat(chr_l_sel_msg_stmt,chr_l_emu_effd_8);
					strcat(chr_l_sel_msg_stmt,"',NULL)   as EFFD, ");
					strcat(chr_l_sel_msg_stmt,"decode(a.CA_EVENT,'RN','");
					strcat(chr_l_sel_msg_stmt,chr_l_emu_mnva);
					strcat(chr_l_sel_msg_stmt,"',NULL)   as MNVA ");
					strcat(chr_l_sel_msg_stmt," ,c.currency_cd as CCCYCODE "); 
				
					strcat(chr_l_sel_msg_stmt," ,a.REQD_CERTIFY as REQD_CERTIFY ");
	   			strcat(chr_l_sel_msg_stmt," from MT_INSTRUMENT b,MT_CLIENT d ");
	   			strcat(chr_l_sel_msg_stmt,", CAEVENT a,dl_deal c");
           		strcat(chr_l_sel_msg_stmt," where a.instr_code = b.instr_code and");
            #endif
            
		  } 
		else
		  {
           strcpy(chr_l_sel_msg_stmt,"select a.client,'DUMMY' as PROC_INIT,");
           strcat(chr_l_sel_msg_stmt,"a.instr_code,substr(to_char(a.DECLARE_DT,'YYMMDD'),1,6) as DECLARE_DT,");
           strcat(chr_l_sel_msg_stmt,"a.instr_code,substr(to_char(a.DECLARE_DT,'DD-MM-YYYY'),1,10) as EM_DECLARE_DT,");
           strcat(chr_l_sel_msg_stmt,"a.EVNT_INDNT,");
           strcat(chr_l_sel_msg_stmt,"c.QTY,");
	  		  strcat(chr_l_sel_msg_stmt,"decode(b.INSTR_TYPE,'BON',decode(d.CLN_FMT_RPTIND,'Y','FMT'");
	 		  strcat(chr_l_sel_msg_stmt,",b.INSTR_TYPE),b.INSTR_TYPE) as FTYPEOFINSTR,c.UNIQ_IDENT_NO as CURRMSGREFNO, ");
	 		  strcat(chr_l_sel_msg_stmt," b.INSTR_ISIN,b.NOMINAL_VALUE,");
	 		  strcat(chr_l_sel_msg_stmt," concat(concat(concat('/',b.currency_cd),'/'),b.REG_BR_IND) as SCCYCODE,");
	 		  strcat(chr_l_sel_msg_stmt," substr(replace(replace(b.instr_name,chr(13),NULL),chr(10),NULL),1,35) as INSTR_NAME,b.currency_cd,");
			 
	 		  strcat(chr_l_sel_msg_stmt," d.CLN_USE_ISIN_IND as FLGISIN,d.CLN_FMT_RPTIND,substr(replace(replace(d.cln_name,chr(13),NULL),chr(10),NULL),1,35) as CLNT_NAME,concat('/',d.cln_code) as NACCOUNT,a.INSTR_PARENT ,");
			 
				  
				  strcat(chr_l_sel_msg_stmt," d.CLN_TAXABLE_IND  as IND_83C83D ");
				  
				
               strcat(chr_l_sel_msg_stmt," ,e.REQD_CERTIFY as REQD_CERTIFY ");	

           if(strcmp(p_msg_no,"563N01")==0)
           {
				
              strcat(chr_l_sel_msg_stmt,",decode(a.SUB_PR,0,'0',a.SUB_PR) as SUB_PR,a.SUB_CURRENCY as CCYSUB_PRICE,c.AMOUNT,b.currency_cd as CCYAMOUNT,a.CA_EVENT,");
	
	      strcat(chr_l_sel_msg_stmt,"substr(to_char(a.dateof_payment,'YYMMDD'),1,6) as DATEOF_PAYMENT,substr(to_char(a.dateof_payment,'DD-MM-YYYY'),1,10) as EM_DATEOF_PAYMENT,decode(b.INSTR_TYPE,'BON',decode(d.CLN_FMT_RPTIND,'Y',to_char(a.TAKEUP_QUANTITY*b.NOMINAL_VALUE),a.TAKEUP_QUANTITY),a.TAKEUP_QUANTITY) as FENT_POS,decode(b.INSTR_TYPE,'BON',decode(d.CLN_FMT_RPTIND,'Y',to_char(a.TOTAL_QUANTITY*b.NOMINAL_VALUE),a.TOTAL_QUANTITY),a.TOTAL_QUANTITY) as ORGFENT_POS,");
				  strcat(chr_l_sel_msg_stmt,"decode(b.INSTR_TYPE,'BON',decode(d.CLN_FMT_RPTIND,'Y',to_char(a.TAKEUP_QUANTITY*b.NOMINAL_VALUE),a.TAKEUP_QUANTITY),a.TAKEUP_QUANTITY)*decode(e.OLD_STK_QTY,null,1,e.OLD_STK_QTY)/decode(e.NEW_SAFEK_QTY,null,1,e.NEW_SAFEK_QTY) as NEW_QTY_PAID,");       
              strcat(chr_l_sel_msg_stmt,"concat('/',d.CLN_GL_ACCOUNT) as GL_ACCOUNT,a.INFO_SEQ,a.CORP_ID"); 
				  strcat(chr_l_sel_msg_stmt,", substr(to_char(c.setl_date,'YYMMDD'),1,6) AS SETLDT");
              
              strcat(chr_l_sel_msg_stmt,",substr(to_char(c.setl_date,'YYYYMMDD'),1,8) as NEW_SETLDT");
              
           }
           else
           {
	
	      strcat(chr_l_sel_msg_stmt,",decode(b.INSTR_TYPE,'BON',decode(d.CLN_FMT_RPTIND,'Y',to_char(a.LAPSE_QTY*b.NOMINAL_VALUE),a.LAPSE_QTY),a.LAPSE_QTY) as FENT_POS,decode(b.INSTR_TYPE,'BON',decode(d.CLN_FMT_RPTIND,'Y',to_char(a.TOTAL_QUANTITY*b.NOMINAL_VALUE),a.TOTAL_QUANTITY),a.TOTAL_QUANTITY) as ORGFENT_POS,");
				  strcat(chr_l_sel_msg_stmt,"decode(b.INSTR_TYPE,'BON',decode(d.CLN_FMT_RPTIND,'Y',to_char(a.LAPSE_QTY*b.NOMINAL_VALUE),a.LAPSE_QTY),a.LAPSE_QTY)*decode(e.OLD_STK_QTY,null,1,e.OLD_STK_QTY)/decode(e.NEW_SAFEK_QTY,null,1,e.NEW_SAFEK_QTY) as NEW_QTY_PAID,");       
              strcat(chr_l_sel_msg_stmt,"a.EVNT_INDNT,a.DECLARE_DT,b.INSTR_TYPE,a.CORP_ID");
				  strcat(chr_l_sel_msg_stmt,",a.INFO_SEQ"); 
              
              strcat(chr_l_sel_msg_stmt,",substr(to_char(c.setl_date,'YYYYMMDD'),1,8) as NEW_SETLDT");
              
           }
	   
		
               strcat(chr_l_sel_msg_stmt," ,e.REQD_CERTIFY as REQD_CERTIFY ");	
			strcat(chr_l_sel_msg_stmt," from MT_INSTRUMENT b,MT_CLIENT d ");
	   	strcat(chr_l_sel_msg_stmt,", CARTSPROC a,dl_deal c, CAEVENT e");    
	   	strcat(chr_l_sel_msg_stmt," where a.client = d.cln_code ");
         strcat(chr_l_sel_msg_stmt," and a.instr_code = b.instr_code and");
         strcat(chr_l_sel_msg_stmt," a.client = c.client and");
			strcat(chr_l_sel_msg_stmt," a.corp_id = e.corp_id(+) and");	

	  }
	  
           strcat(chr_l_sel_msg_stmt," c.IDENTIY_NO = '");
           strcat(chr_l_sel_msg_stmt,chr_l_refno);
           strcat(chr_l_sel_msg_stmt,"' ");
		     strcat(chr_l_sel_msg_stmt," and a.instr_code = '");
	  		  strcat(chr_l_sel_msg_stmt,chr_l_instrcode);
	 		  strcat(chr_l_sel_msg_stmt,"' and a.CA_EVENT = '");
	 		  strcat(chr_l_sel_msg_stmt,chr_l_ce_typ);
	 		  strcat(chr_l_sel_msg_stmt,"' and a.DECLARE_DT = '");
	 		  strcat(chr_l_sel_msg_stmt,chr_l_decl_date);
	 		  strcat(chr_l_sel_msg_stmt,"' and a.EVNT_INDNT = to_number('");
	 		  strcat(chr_l_sel_msg_stmt,chr_l_event_srl_nbr);
	 		  strcat(chr_l_sel_msg_stmt,"') ");
           if(strlen(l_ms_msgent_structa_a.client) != 0)
           {
              strcat(chr_l_sel_msg_stmt," and d.cln_code = '");
              strcat(chr_l_sel_msg_stmt,l_ms_msgent_structa_a.client);
              strcat(chr_l_sel_msg_stmt,"'");
           }
           else
           {
		APL_DATA_MISSING("CLIENT", APL_NULL_STRING, APL_NULL_STRING)
                APL_GOBACK_FAIL
           }

          strcat(chr_l_sel_msg_stmt," and d.STATUS != '");
          strcat(chr_l_sel_msg_stmt,STATUS_CLS_AUTH);
          strcat(chr_l_sel_msg_stmt,"' ");
         }


         if((strcmp(p_msg_no,"563N03")==0) || (strcmp(p_msg_no,"566R03")==0))
         {
	   EXEC SQL SELECT NVL(OP_EVT_CLASS,' '),EXPIRY_DATE INTO :chr_l_op_event_type:i_op_evt_class,:chr_l_expire_dt:i_expire_date 		    FROM CAEVENT   
                    WHERE CORP_ID = :chr_l_ca_id;

           IS_ANY_ORA_ERROR

           if (i_op_evt_class == -1)
                strcpy(chr_l_op_event_type," ");

	   if (i_expire_date == -1)
		strcpy(chr_l_expire_dt,APL_NULL_STRING);
	   
	   
	
		
	


           strcpy(chr_l_sel_msg_stmt,"select e.instr_code,e.CA_EVENT,substr(to_char(e.DECLARE_DT,'YYMMDD'),1,6) as DECLARE_DT,");
           strcat(chr_l_sel_msg_stmt,"e.CA_EVENT,substr(to_char(e.DECLARE_DT,'DD-MM-YYYY'),1,10) as EM_DECLARE_DT,");

		
	   strcat(chr_l_sel_msg_stmt,"e.EVNT_INDNT,decode(e.CA_EVENT,'SP',e.ENTITL_INFONO,e.INFO_SEQ) as LNOTE_NBR,e.OP_EVT_CLASS,e.RES_INSTR_CODE,");
	   strcat(chr_l_sel_msg_stmt,"replace(replace(e.PROC_OTH,chr(13),NULL),chr(10),NULL) as PROC_OTH,e.ENTL_SEND_MSG_IND,decode(e.SUB_PR,0,'0',NULL,'0',e.SUB_PR) as SUB_PR,'");
	   if((strcmp(chr_l_ce_typ,"SP")== 0) || (strcmp(chr_l_ce_typ,"CR")== 0) || (strcmp(chr_l_ce_typ,"CV")== 0)) /* SGS */
		{
			EXEC SQL SELECT UNIQ_IDENT_NO
						INTO :chr_l_ca_unique_ref_num
						FROM DL_DEAL
						WHERE IDENTIY_NO=:chr_l_refno
						AND ROWNUM < 2;
	   	strcat(chr_l_sel_msg_stmt,chr_l_ca_unique_ref_num);   
		}
		else
		{
	   	strcat(chr_l_sel_msg_stmt,chr_new_ca_unique_ref_num);   
		}
	   strcat(chr_l_sel_msg_stmt,"' as CURRMSGREFNO,");
	   if((strcmp(chr_l_ce_typ,"SP")== 0) || (strcmp(chr_l_ce_typ,"CR")== 0) || (strcmp(chr_l_ce_typ,"CV")== 0))
	   {
	   strcat(chr_l_sel_msg_stmt," c.corp_id,c.client,'");
	   strcat(chr_l_sel_msg_stmt,chr_l_refno);
	   strcat(chr_l_sel_msg_stmt,"' as PROC_INIT,'");
	   strcat(chr_l_sel_msg_stmt,chr_l_refno);
	   strcat(chr_l_sel_msg_stmt,"' as DEAL_IDENTITY_NO,to_number('");
	   strcat(chr_l_sel_msg_stmt,chr_l_qty_recd);
	   strcat(chr_l_sel_msg_stmt,"') as QUANTITY_RECEIVED,concat('/',c.client) as NACCOUNT,to_number('");
	   strcat(chr_l_sel_msg_stmt,chr_l_qty_del);
	   strcat(chr_l_sel_msg_stmt,"') as QUANTITY_DEL,");
      strcat(chr_l_sel_msg_stmt,"to_char(round((nvl(e.sub_pr,0)*");
		strcat(chr_l_sel_msg_stmt,chr_l_qty_recd);
		strcat(chr_l_sel_msg_stmt,"),2)) as CV_CASH_PROC,"); 

	   }
	   else
	   {
	   strcat(chr_l_sel_msg_stmt," a.corp_id,a.client,concat('/',a.client) as NACCOUNT,");
	   strcat(chr_l_sel_msg_stmt," a.DEAL_IDENTITY_NO,a.quantity_received as QUANTITY_RECEIVED,");
	   } 
	   if (strcmp(chr_l_op_event_type,"TA") == 0)   /* SGS chg from TO to TA*/
           {
               if (i_expire_date == -1)
	      		 strcat(chr_l_sel_msg_stmt,"decode(e.OP_EVT_CLASS,'TO',(select sum(safekeep_pos) from DL_SAFEK where client = a.client and instr_code = e.instr_code),0) as elig_entitl_pos,");
	       else
			 strcat(chr_l_sel_msg_stmt,"decode(e.OP_EVT_CLASS,'TO',(select sum(safekeep_pos) from DL_HISSAFEK where client = a.client and instr_code = e.instr_code and POSIT_DATE = e.EXPIRY_DATE),0) as elig_entitl_pos,");
           }
           else
           {
	  	 strcat(chr_l_sel_msg_stmt," c.ELIG_ENTITL_POS,");
	   }
	   strcat(chr_l_sel_msg_stmt,"substr(concat(e.instr_code,concat(concat(to_char(to_date(e.DECLARE_DT),'YY'),lpad(((to_date(e.DECLARE_DT) - to_date(concat(concat('01/01/',to_char(e.DECLARE_DT,'YYYY')),' 12:00:00')))+1),3,'0')),lpad(substr(to_char(e.EVNT_INDNT),1,2),2,'0'))),1,16) as TEVENTID,");
	   strcat(chr_l_sel_msg_stmt,"decode(b.INSTR_TYPE,'BON',decode(d.CLN_FMT_RPTIND,'Y','FMT'");
	   strcat(chr_l_sel_msg_stmt,",b.INSTR_TYPE),b.INSTR_TYPE) as FTYPEOFINSTR ");
	   if (strcmp(chr_l_op_event_type,"TA") == 0) /* SGS chg from TO to TA */
           {
		if (i_expire_date == -1)
               		 strcat(chr_l_sel_msg_stmt,",decode(b.INSTR_TYPE,'BON',decode(d.CLN_FMT_RPTIND,'Y',(select to_char(sum(safekeep_pos) * b.NOMINAL_VALUE) from DL_SAFEK where client = a.client and instr_code = e.instr_code),(select sum(safekeep_pos) from DL_SAFEK where client = a.client and instr_code = e.instr_code)),(select sum(safekeep_pos) from DL_SAFEK where client = a.client and instr_code = e.instr_code)) as FENT_POS,b.INSTR_TYPE as STYPEOFINSTR,");
		else
			strcat(chr_l_sel_msg_stmt,",decode(b.INSTR_TYPE,'BON',decode(d.CLN_FMT_RPTIND,'Y',(select to_char(sum(safekeep_pos) *b.NOMINAL_VALUE) from DL_HISSAFEK where client = a.client and instr_code = e.instr_code and POSIT_DATE = e.EXPIRY_DATE),(select sum(safekeep_pos) from DL_HISSAFEK where client = a.client and instr_code = e.instr_code and POSIT_DATE = e.EXPIRY_DATE)),(select sum(safekeep_pos) from DL_HISSAFEK where client = a.client and instr_code = e.instr_code and positdt = e.EXPIRY_DATE)) as FENT_POS,b.INSTR_TYPE as STYPEOFINSTR,");



           }
           else
           {
	  	 strcat(chr_l_sel_msg_stmt,",decode(b.INSTR_TYPE,'BON',decode(d.CLN_FMT_RPTIND,'Y',to_char(c.ELIG_ENTITL_POS*b.NOMINAL_VALUE),c.ELIG_ENTITL_POS),c.ELIG_ENTITL_POS) as FENT_POS,b.INSTR_TYPE as STYPEOFINSTR,");
	   }
      if((strcmp(chr_l_ce_typ,"SP")!= 0)  && (strcmp(chr_l_ce_typ,"CR")!= 0) && (strcmp(chr_l_ce_typ,"CV")!= 0) )
      {
	 if (strcmp(chr_l_op_event_type,"TO") == 0) 
	 {
		strcat(chr_l_sel_msg_stmt,"decode(b.INSTR_TYPE,'BON',decode(d.CLN_FMT_RPTIND,'Y',to_char(round(a.quantity_paid*b.NOMINAL_VALUE)),round(a.quantity_paid)),round(a.quantity_paid)) as NEW_QTY_PAID,");
	 }
	 else
	 {
                strcat(chr_l_sel_msg_stmt,"decode(b.INSTR_TYPE,'BON',decode(d.CLN_FMT_RPTIND,'Y',to_char(a.quantity_paid*b.NOMINAL_VALUE),a.quantity_paid),a.quantity_paid) as NEW_QTY_PAID,");
	 }
      }
      else
      {
         strcat(chr_l_sel_msg_stmt,"decode(b.INSTR_TYPE,'BON',decode(d.CLN_FMT_RPTIND,'Y',to_char(c.ELIG_ENTITL_POS*b.NOMINAL_VALUE),c.ELIG_ENTITL_POS),c.ELIG_ENTITL_POS) as NEW_QTY_PAID,");    
      }
	   strcat(chr_l_sel_msg_stmt," b.INSTR_ISIN,b.NOMINAL_VALUE,b.currency_cd,b.currency_cd as CCYSUB_PRICE,b.INSTR_TYPE,");
	   strcat(chr_l_sel_msg_stmt," concat(concat(concat('/',b.currency_cd),'/'),b.REG_BR_IND) as SCCYCODE,");
	   strcat(chr_l_sel_msg_stmt," substr(replace(replace(b.instr_name,chr(13),NULL),chr(10),NULL),1,35) as INSTR_NAME,b.currency_cd,");
	   if((strcmp(chr_l_ce_typ,"SP")!= 0) && (strcmp(chr_l_ce_typ,"CV")!= 0) && (strcmp(chr_l_ce_typ,"CR")!= 0) )
	   {
           strcat(chr_l_sel_msg_stmt,"substr(concat(concat(a.corp_id,a.client),a.SEQNUM_PAY),1,33) as PROC_INIT,");
	   }
			 
	   strcat(chr_l_sel_msg_stmt," d.CLN_USE_ISIN_IND as FLGISIN,d.CLN_FMT_RPTIND,substr(replace(replace(d.cln_name,chr(13),NULL),chr(10),NULL),1,35) as CLNT_NAME,concat('/',d.cln_code) as NACCOUNT ,");
			 
		
			  strcat(chr_l_sel_msg_stmt," d.CLN_TAXABLE_IND  as IND_83C83D ");
		
     
      strcat(chr_l_sel_msg_stmt,",substr(to_char(e.DECLARE_DT,'YYYYMMDD'),1,8) as NEW_DECL_DT");
      strcat(chr_l_sel_msg_stmt,",substr(to_char(e.DECLARE_DT,'DD-MM-YYYY'),1,10) as EM_DECL_DT");
      strcat(chr_l_sel_msg_stmt,",substr(to_char(e.REC_DATE,'YYYYMMDD'),1,8) as NEW_REC_DT");
      strcat(chr_l_sel_msg_stmt,",substr(to_char(e.BC_FROM_DATE,'YYYYMMDD'),1,8) as NEW_BC_DT");
      strcat(chr_l_sel_msg_stmt,",substr(to_char(e.BC_FROM_DATE,'DD-MM-YYYY'),1,10) as EM_BC_DT");
      strcat(chr_l_sel_msg_stmt,",substr(to_char(e.EX_DATE,'YYYYMMDD'),1,8) as NEW_EX_DT");
      /* VaibhavK 16Feb2008 Adding Expiry Date and Response DeadLine Date........ I-Solve:662,664 Start */ 
      strcat(chr_l_sel_msg_stmt,",substr(to_char(e.EXPIRY_DATE,'YYYYMMDD'),1,8) as NEW_EXPIRE_DT");
      strcat(chr_l_sel_msg_stmt,",substr(to_char(e.RESPONSE_DATE,'YYYYMMDDhh24miss'),1,14) as NEW_RESPONS_DT");
      /* VaibhavK 16Feb2008 Adding Expiry Date and Response DeadLine Date........I-Solve:662,664 End */
      strcat(chr_l_sel_msg_stmt,",substr(to_char(e.dateof_payment,'YYYYMMDD'),1,8) as NEW_PAY_DT");
      strcat(chr_l_sel_msg_stmt,",substr(to_char(e.RESPONSE_DATE,'YYYYMMDD'),1,8) as NEW_RESP_DT");
      strcat(chr_l_sel_msg_stmt,",e.RESP_DT_OPND");
      strcat(chr_l_sel_msg_stmt,",substr(to_char(e.EFFECTIVE_DATE,'YYYYMMDD'),1,8) as NEW_EFFCT_DT");
      strcat(chr_l_sel_msg_stmt,",substr(to_char(e.PART_PYMT_DT,'YYYYMMDD'),1,8) as NEW_PP_DT");
      strcat(chr_l_sel_msg_stmt,",decode(e.CA_EVENT,'SP',e.ENTITL_INFONO,e.INFO_SEQ) as SNOTE_NBR");
      
      strcat(chr_l_sel_msg_stmt,",substr(to_char(e.SUBSCR_DATE,'YYYYMMDD'),1,8) as NEW_SUBS_DT");
      strcat(chr_l_sel_msg_stmt,",substr(to_char(e.SUBSCR_DATE,'DD-MM-YYYY'),1,10) as EM_SUBS_DT");
      
  
      strcat(chr_l_sel_msg_stmt,",e.FRACT_PR ");

      if((strcmp(chr_l_ce_typ,"SP")!= 0) && (strcmp(chr_l_ce_typ,"CR")!= 0) && (strcmp(chr_l_ce_typ,"CV")!= 0))
      {
         strcat(chr_l_sel_msg_stmt,",decode(a.curr_pymt,0,NULL,a.curr_pymt) as CURR_PYMT,e.CA_CURRENCY as CCYCUR_PMT,");
         strcat(chr_l_sel_msg_stmt,"substr(to_char(a.dateof_payment,'YYYYMMDD'),1,8) as NEW_PAYMENT_DT,");
         strcat(chr_l_sel_msg_stmt,"substr(to_char(a.CHECKER_DT,'YYYYMMDD'),1,8) as NEW_PAY_AUTH_DT,");
         strcat(chr_l_sel_msg_stmt,"to_char(round((trunc(trunc(a.curr_pymt)*(a.tax_rate/100))),2)) as RTAX_AMT,e.CA_CURRENCY as CCYRTAX_AMT,");
         strcat(chr_l_sel_msg_stmt,"to_char(round((a.curr_pymt * a.tax_rate/100),2)) as TAX_AMOUNT,e.CA_CURRENCY as CCYTAX_AMT,");
         strcat(chr_l_sel_msg_stmt,"to_char(round((a.curr_pymt - trunc(trunc(a.curr_pymt)*(a.tax_rate/100))),2)) as RNET_AMT,e.CA_CURRENCY as CCYRNET_AMT,");
         strcat(chr_l_sel_msg_stmt,"to_char(round((a.curr_pymt * (100-a.TAX_RATE)/100),2)) as NET_AMT,e.CA_CURRENCY as CCYNET_AMT, ");
	  		strcat(chr_l_sel_msg_stmt,"substr(replace(replace(a.PAYMENT_INFO,chr(13),NULL),chr(10),NULL),1,35) as PAYMENT_INFO,");
         strcat(chr_l_sel_msg_stmt,"e.DISP_OF_FRACT, ");
			strcat(chr_l_sel_msg_stmt, " d.CLN_FRACT_IND as FRACT_IND, '");  	
			strcat(chr_l_sel_msg_stmt, chr_l_keep_fract_temp);
         strcat(chr_l_sel_msg_stmt, "' as FRACT_COND");
      }
		else
		{
         strcat(chr_l_sel_msg_stmt,",'");
			strcat(chr_l_sel_msg_stmt,chr_h_date_new);
			strcat(chr_l_sel_msg_stmt,"' as NEW_PAYMENT_DT ");
		}
      

      

      strcat(chr_l_sel_msg_stmt,",decode(e.NEW_SAFEK_RT,NULL,'0',0,'0',e.NEW_SAFEK_RT) as STOCK_RATE ");
		strcat(chr_l_sel_msg_stmt,", '12' as DECSTOCK_RATE ");

      strcat(chr_l_sel_msg_stmt,",e.NEW_SAFEK_QTY, e.OLD_STK_QTY ");

      if(strcmp(chr_l_ce_typ,"RT")==0)
      {
         strcat(chr_l_sel_msg_stmt,",e.SUB_NEW_QUANTITY, e.SUB_BASE_QUANTITY ");
      }

      if(strcmp(chr_l_ce_typ,"OP")== 0)
      {
      strcat(chr_l_sel_msg_stmt,",decode(b.INSTR_TYPE,'FMT','PCT',b.currency_cd) as IRTTYPE"); 
      }
	
	if(strcmp(chr_l_ce_typ,"RT")==0)
	{
		strcat(chr_l_sel_msg_stmt,", substr(to_char(e.start_date,'YYYYMMDD'),1,8) as NEW_START_DT");
		strcat(chr_l_sel_msg_stmt,", substr(to_char(e.EFFECTIVE_DATE,'YYYYMMDD'),1,8) as NEW_EFFECT_DT");
	}
	if(strcmp(chr_l_ce_typ,"OP")== 0)
	{
		if (strcmp(chr_l_op_event_type,"WC") == 0)
		{
		strcat(chr_l_sel_msg_stmt,", substr(to_char(e.start_date,'YYYYMMDD'),1,8) as NEW_START_DT");
		strcat(chr_l_sel_msg_stmt,", substr(to_char(e.EXPIRY_DATE,'YYYYMMDD'),1,8) as NEW_EXPIRE_DT");
		}
		if (strcmp(chr_l_op_event_type,"MG") == 0)
		{
		strcat(chr_l_sel_msg_stmt,", substr(to_char(e.MEETING_DATE,'YYYYMMDD'),1,8) as NEW_DEAL_DT");
		}
	}
	
      
		
               strcat(chr_l_sel_msg_stmt," ,e.REQD_CERTIFY as REQD_CERTIFY ");

	   strcat(chr_l_sel_msg_stmt," from MT_INSTRUMENT b,MT_CLIENT d ");
	   if((strcmp(chr_l_ce_typ,"SP")!= 0) && (strcmp(chr_l_ce_typ,"CR")!= 0) && (strcmp(chr_l_ce_typ,"CV")!= 0) )
	   {
		if (strcmp(chr_l_op_event_type,"TO") == 0)  
			strcat(chr_l_sel_msg_stmt," ,CACHEQUE a,DL_SAFEK c,CAEVENT e ");
		else
	  	        strcat(chr_l_sel_msg_stmt," ,CACHEQUE a,CAENTITLEMENT c,CAEVENT e ");
	   }
	   else
	   {
	   strcat(chr_l_sel_msg_stmt," ,CAENTITLEMENT c,CAEVENT e ");
	   }
	   if (strcmp(chr_l_op_event_type,"TA") == 0)  /* SGS chg from TO to TA */
                strcat(chr_l_sel_msg_stmt," where d.cln_code = a.client and");
           else	
	  	 strcat(chr_l_sel_msg_stmt," where c.client = d.cln_code and");
	   if((strcmp(chr_l_ce_typ,"SP")!= 0) && (strcmp(chr_l_ce_typ,"CR")!= 0) && (strcmp(chr_l_ce_typ,"CV")!= 0) )
	   {
      	   strcat(chr_l_sel_msg_stmt," a.corp_id = e.corp_id and");
	   }
	   if (strcmp(chr_l_op_event_type,"TA") == 0)  /* SGS chg TO to TA */
           {
		
		 strcat(chr_l_sel_msg_stmt," c.client = a.client and c.instr_code = e.instr_code and c.location_cd = a.location_cd and");
                 strcat(chr_l_sel_msg_stmt," e.corp_id = '");
                 strcat(chr_l_sel_msg_stmt,chr_l_ca_id);
                 strcat(chr_l_sel_msg_stmt,"' ");
           }
           else
           {	
      	  	 strcat(chr_l_sel_msg_stmt," c.corp_id = e.corp_id and");
	  	 strcat(chr_l_sel_msg_stmt," c.corp_id = '");
	  	 strcat(chr_l_sel_msg_stmt,chr_l_ca_id);
          	 strcat(chr_l_sel_msg_stmt,"' ");
	   }
      	   strcat(chr_l_sel_msg_stmt," and e.instr_code = b.instr_code ");
	   if((strcmp(chr_l_ce_typ,"SP")!= 0) && (strcmp(chr_l_ce_typ,"CR")!= 0) && (strcmp(chr_l_ce_typ,"CV")!= 0) )
	   {
	   if (strcmp(chr_l_op_event_type,"TO") != 0)  
           {
      	  	 strcat(chr_l_sel_msg_stmt," and c.client = a.CLIENT");
	   }
			/* Vaibhav and  AmitB Changes required for Rights Trade Settlement Issue */
	   /* Kalyan  -- Added the "OR" condition in the following query... This issue is when 563N03 is fired 
	   from Benifit Generation , chr_l_refno contains the payment serial no. but when fired from Deal 
	   server it contains deal refno. So upon discussion with dnyanesh add this condition coz.. both can't b
	   true  at the same time  and our purpose is also solved
	   */
				strcat(chr_l_sel_msg_stmt," and ( a.DEAL_IDENTITY_NO = '");
           strcat(chr_l_sel_msg_stmt,chr_l_refno);
				
           strcat(chr_l_sel_msg_stmt,"' OR to_char(a.SEQNUM_PAY) = '");
           strcat(chr_l_sel_msg_stmt,chr_l_refno);
				strcat(chr_l_sel_msg_stmt,"') ");
           /* strcat(chr_l_sel_msg_stmt,"' "); */
				Alert("after query SEQNUM_PAY |%s|",chr_l_refno);
				fflush(stdout);
	   }
           if(strlen(l_ms_msgent_structa_a.client) != 0)
           {
              strcat(chr_l_sel_msg_stmt," and d.cln_code = '");
              strcat(chr_l_sel_msg_stmt,l_ms_msgent_structa_a.client);
              strcat(chr_l_sel_msg_stmt,"'");
           }
           else
           {
		APL_DATA_MISSING("CLIENT", APL_NULL_STRING, APL_NULL_STRING)
                APL_GOBACK_FAIL
           }

          strcat(chr_l_sel_msg_stmt," and d.STATUS != '");
          strcat(chr_l_sel_msg_stmt,STATUS_CLS_AUTH);
          strcat(chr_l_sel_msg_stmt,"' ");


         }
        
		 if(strcmp(p_msg_no,"563N04")==0) 
         {
           strcpy(chr_l_sel_msg_stmt,"select a.client,a.IDENTIY_NO,a.IDENTIY_NO as PROC_INIT,concat('/',a.client) as NACCOUNT,a.instr_code,c.CLN_USE_ISIN_IND as FLGISIN,");
			  
           strcat(chr_l_sel_msg_stmt,"a.QTY,a.UNIQ_IDENT_NO as CURRMSGREFNO,"); 
	   strcat(chr_l_sel_msg_stmt,"decode(b.INSTR_TYPE,'BON',decode(c.CLN_FMT_RPTIND,'Y','FMT'");
	   strcat(chr_l_sel_msg_stmt,",b.INSTR_TYPE),b.INSTR_TYPE) as FTYPEOFINSTR ");
	   strcat(chr_l_sel_msg_stmt,",decode(b.INSTR_TYPE,'BON',decode(c.CLN_FMT_RPTIND,'Y',to_char(a.QTY*b.NOMINAL_VALUE),a.QTY),a.QTY) as FENT_POS,b.INSTR_ISIN,");
	   strcat(chr_l_sel_msg_stmt,"substr(replace(replace(b.instr_name,chr(13),NULL),chr(10),NULL),1,35) as INSTR_NAME,concat(concat(concat('/',b.currency_cd),'/'),b.REG_BR_IND) as RGCCYCODE,a.instr_code ,");
		
		strcat(chr_l_sel_msg_stmt," c.CLN_TAXABLE_IND  as IND_83C83D ,");
	   strcat(chr_l_sel_msg_stmt," substr(replace(replace(c.cln_name,chr(13),NULL),chr(10),NULL),1,35)  as CLNT_NAME ");
	  

	   strcat(chr_l_sel_msg_stmt," from dl_deal a,MT_INSTRUMENT b,MT_CLIENT c ");
	   strcat(chr_l_sel_msg_stmt," where a.client = c.cln_code and a.instr_code = b.instr_code ");
           if(strlen(l_ms_msgent_structa_a.client) != 0)
           {
              strcat(chr_l_sel_msg_stmt," and a.client = '");
              strcat(chr_l_sel_msg_stmt,l_ms_msgent_structa_a.client);
              strcat(chr_l_sel_msg_stmt,"'");
           }
           else
           {
		APL_DATA_MISSING("CLIENT", APL_NULL_STRING, APL_NULL_STRING)
                APL_GOBACK_FAIL
           }
	   strcat(chr_l_sel_msg_stmt," and a.IDENTIY_NO = '");
	   strcat(chr_l_sel_msg_stmt,chr_l_refno);

           strcat(chr_l_sel_msg_stmt,"' ");
	 }
  
	     
		 if(strcmp(p_msg_no,"563N05")==0) 
         {
           strcpy(chr_l_sel_msg_stmt,"select a.client,a.IDENTIY_NO,a.IDENTIY_NO as PROC_INIT,concat('/',a.client) as NACCOUNT,a.instr_code,c.CLN_USE_ISIN_IND as FLGISIN,");
			  
           strcat(chr_l_sel_msg_stmt,"a.QTY,a.UNIQ_IDENT_NO as CURRMSGREFNO,");
      strcat(chr_l_sel_msg_stmt,"a.deal_cd as DEAL_CD,a.ENTRY as ENTRY_TYPE,"); 
	   strcat(chr_l_sel_msg_stmt,"b.INSTR_TYPE as FTYPEOFINSTR ");
	   strcat(chr_l_sel_msg_stmt,",a.QTY as FENT_POS,b.INSTR_ISIN,");
	   strcat(chr_l_sel_msg_stmt,"substr(replace(replace(b.instr_name,chr(13),NULL),chr(10),NULL),1,35) as INSTR_NAME,concat(concat(concat('/',b.currency_cd),'/'),b.REG_BR_IND) as RGCCYCODE,a.currency_cd as CURRENCY_CD,a.instr_code, ");
		strcat(chr_l_sel_msg_stmt,"substr(replace(replace(c.cln_name,chr(13),NULL),chr(10),NULL),1,35) as CLNT_NAME,substr(to_char(a.DATEOF_INPUT,'YYMMDD'),1,6) as DATEOF_INPUT,");
		
      if(!strcmp(chr_l_566reverse,"R"))
      {
      	if (strlen(chr_l_tmp_moneydt)!=0)
         {
         	strcat(chr_l_sel_msg_stmt,"'");
            strcat(chr_l_sel_msg_stmt,chr_l_postdt);
            strcat(chr_l_sel_msg_stmt,"' as MONEY_SETL_DT");
       	}
         else
         {
				strcat(chr_l_sel_msg_stmt,"substr(to_char(a.MONEY_SETL_DT,'YYMMDD'),1,6) as MONEY_SETL_DT ");
		 	}
    	}
      else
      {
      	strcat(chr_l_sel_msg_stmt,"substr(to_char(a.MONEY_SETL_DT,'YYMMDD'),1,6) as MONEY_SETL_DT ");
     	}
		strcat(chr_l_sel_msg_stmt,",a.AMOUNT,a.currency_cd as CCYAMOUNT ");
		strcat(chr_l_sel_msg_stmt,",concat('/',c.CLN_GL_ACCOUNT) as GL_ACCOUNT ,");
		
		strcat(chr_l_sel_msg_stmt," c.CLN_TAXABLE_IND  as IND_83C83D ");
	  
      
      
      if(!strcmp(chr_l_566reverse,"R"))
      {
       if (strlen(chr_l_tmp_instr_dt)!=0)
          {
            strcat(chr_l_sel_msg_stmt,",'");
            strcat(chr_l_sel_msg_stmt,chr_l_new_postdt);
            strcat(chr_l_sel_msg_stmt,"' as NEW_INSTR_DT");
          }
        else
          {
           strcat(chr_l_sel_msg_stmt,",substr(to_char(a.INSTRUMENT_DT,'YYYYMMDD'),1,8) as NEW_INSTR_DT");
          }
       
       if((strlen(chr_l_tmp_moneydt)!=0))
          {
           strcat(chr_l_sel_msg_stmt,",'");
           strcat(chr_l_sel_msg_stmt,chr_l_new_postdt);
           strcat(chr_l_sel_msg_stmt,"' as NEW_MONEYDT");
          }
        else
          {
           strcat(chr_l_sel_msg_stmt,",substr(to_char(a.MONEY_SETL_DT,'YYYYMMDD'),1,8) as NEW_MONEYDT");
          }

     }
     else
     {
       strcat(chr_l_sel_msg_stmt,",a.INSTRUMENT_DT as TMP_INSTR_DT,substr(to_char(a.INSTRUMENT_DT,'YYYYMMDD'),1,8) as NEW_INSTR_DT");
       strcat(chr_l_sel_msg_stmt,",a.MONEY_SETL_DT as TMP_MONEYDT,substr(to_char(a.MONEY_SETL_DT,'YYYYMMDD'),1,8) as NEW_MONEYDT");
     }

      
	   strcat(chr_l_sel_msg_stmt," from dl_deal a,MT_INSTRUMENT b,MT_CLIENT c ");
	   strcat(chr_l_sel_msg_stmt," where a.client = c.cln_code and a.instr_code = b.instr_code ");
              strcat(chr_l_sel_msg_stmt," and a.client = '");
              strcat(chr_l_sel_msg_stmt,l_ms_msgent_structa_a.client);
              strcat(chr_l_sel_msg_stmt,"'");
	   strcat(chr_l_sel_msg_stmt," and a.IDENTIY_NO = '");
	   strcat(chr_l_sel_msg_stmt,chr_l_refno);

           strcat(chr_l_sel_msg_stmt,"' ");
	 }
	     
        }
       
        /* VaibhavK  Reminder Message for Event= { 'SM' / 'BB' / 'PO' / 'RT' }  Start*/
        if(strncmp(p_msg_no,"562",3) == 0)
        {
          l_msgaddr = MCORPACTIONSMSGNO;
          if(strlen(l_ms_msgent_structa_a.proc_init) != 0)
          {
             strcpy(chr_l_ca_id,l_ms_msgent_structa_a.proc_init);
          }

          if(strlen(l_ms_msgent_structa_a.proc_data) != 0)
          {
             CO_SplitStr(l_ms_msgent_structa_a.proc_data,
                          ';', &int_noelem, &chr_l_param);
             
          }
	  
	  EXEC SQL SELECT NVL(NEW_SAFEK_RT,0),NVL(NEW_SAFEK_QTY,0),NVL(OLD_STK_QTY,0),NVL(OP_EVT_CLASS,' ') INTO :l_new_safek_rt,:chr_l_new_stock_qty,:chr_l_old_stock_qty,:chr_l_op_event_type FROM CAEVENT WHERE corp_id = :chr_l_ca_id;
	  sprintf(chr_conv_rate_str,"CONV AE_RATE = %s",chr_l_op_event_type);
          CO_ProcMonitor(APL_OUT_FILE,chr_conv_rate_str,NULL,NULL);	

         EXEC SQL SELECT CA_EVENT INTO :chr_l_ce_typ
         FROM CAEVENT WHERE CORP_ID = :chr_l_ca_id;

         IS_ANY_ORA_ERROR;

	  if  (strcmp(chr_l_op_event_type,"TO") == 0) 
	  {
		conv_ae_rate = 0;
		if (l_new_safek_rt > 0)
			conv_ae_rate = l_new_safek_rt/100;
		if (chr_l_old_stock_qty > 0)
			conv_ae_rate = chr_l_new_stock_qty/chr_l_old_stock_qty;
		
		sprintf(chr_conv_rate_str,"%f",conv_ae_rate);
		
	  }
	  else if ((strcmp(chr_l_ce_typ,"BB")==0) || (strcmp(chr_l_ce_typ,"SM")==0) || (strcmp(chr_l_op_event_type,"PO")==0) )
		sprintf(chr_conv_rate_str,"%d",1);
	  else
		sprintf(chr_conv_rate_str,"%d",0);
			 
           
			 *p_STAT_VAL = realloc(*p_STAT_VAL,sizeof(MS_STATIC_VAL)*10);

          /* VaibhavK Kotak: ISKB: 671 10March2008........ */   
          *p_SEL_VAL = realloc(*p_SEL_VAL,sizeof(MS_STATIC_VAL)*28);  /*vaibhavk 11Sept INCUS070 before 26*/
			 
			   

          strcpy((*p_STAT_VAL)[1].link_val,"DOMSEC");
          strcpy((*p_STAT_VAL)[1].link_tag,chr_h_dom_instr);
          strcpy((*p_STAT_VAL)[2].link_val,"ENT_INC");
          strcpy((*p_STAT_VAL)[3].link_val,"TITLE");
          strcpy((*p_STAT_VAL)[4].link_val,"TEXT");

          printf("\n\n Message Number is [%s]",p_msg_no);
          if(strcmp(p_msg_no,"562N01")==0)
	  {   
			strcpy((*p_STAT_VAL)[0].link_val,"DUMMY");
	        strcpy((*p_STAT_VAL)[0].link_tag,"DUMMY");			  
          	strcpy((*p_STAT_VAL)[2].link_tag,"F");
          	strcpy((*p_STAT_VAL)[3].link_tag,"SEE72");
				Alert("Chirag here ......PLEASE NOTE RESPONSE DATE \n");
          	strcpy((*p_STAT_VAL)[4].link_tag,"PLEASE NOTE RESPONSE DATE");
             /*   strcpy((*p_STAT_VAL)[5].link_val,""); */
		strcpy((*p_STAT_VAL)[6].link_val,"DUMMY");/** Added on 16/05/2012  **/ 
		strcpy((*p_STAT_VAL)[6].link_tag,"DUMMY");
            strcpy((*p_STAT_VAL)[7].link_val,"CNTRY_BIC");
            strcpy((*p_STAT_VAL)[7].link_tag,l_mt_message_sys_params_struct_h.swift_cd); 
			strcpy((*p_STAT_VAL)[8].link_val,"DUMMY");
		    strcpy((*p_STAT_VAL)[8].link_tag,"DUMMY");
              
          }
          if(strcmp(p_msg_no,"562N02")==0)
	  {            
          	strcpy((*p_STAT_VAL)[2].link_tag,"F");
          	strcpy((*p_STAT_VAL)[3].link_tag,"PROCE");
          	strcpy((*p_STAT_VAL)[4].link_tag,APL_NULL_STRING);
				strcpy((*p_STAT_VAL)[5].link_val,"");
				strcpy((*p_STAT_VAL)[6].link_val,"INST_TYPE");  
				strcpy((*p_STAT_VAL)[6].link_tag,chr_l_param[0]);
                                strcpy((*p_STAT_VAL)[7].link_val,"CNTRY_BIC");
                                strcpy((*p_STAT_VAL)[7].link_tag,l_mt_message_sys_params_struct_h.swift_cd);   
            
            if(int_noelem != 1)
            {
               strcpy((*p_STAT_VAL)[8].link_val,"SRL_NUM");
               strcpy((*p_STAT_VAL)[8].link_tag,chr_l_param[1]);
            }
            else
            {
               strcpy((*p_STAT_VAL)[8].link_val,"");
               strcpy((*p_STAT_VAL)[8].link_tag,"");
            }
            
          }
               printf("\n\n Message Number is [%s]",p_msg_no);
               printf("\n\n &&&&&VaibhavKarnik**********CNTRY_BIC =[%s]",l_mt_message_sys_params_struct_h.swift_cd);
				
				strcpy((*p_STAT_VAL)[5].link_val,"NATION");
				strcpy((*p_STAT_VAL)[5].link_tag,g_mt_commonsys_params_struct_h.nation_code);
				/*strcpy((*p_STAT_VAL)[7].link_val,"CNTRY_BIC");  
				strcpy((*p_STAT_VAL)[7].link_tag,l_mt_message_sys_params_struct_h.swift_cd); */
				strcpy((*p_STAT_VAL)[9].link_val,"");
            strcpy((*p_STAT_VAL)[9].link_tag,"");
          
          strcpy((*p_SEL_VAL)[0].link_val,"RES_INSTR_CODE");
          strcpy((*p_SEL_VAL)[1].link_val,"DUMMY");
          strcpy((*p_SEL_VAL)[2].link_val,"DUMMY");
          strcpy((*p_SEL_VAL)[3].link_val,"CA_EVENT");
          strcpy((*p_SEL_VAL)[4].link_val,"CORP_ID");
          strcpy((*p_SEL_VAL)[5].link_val,"TEVENTID");
          strcpy((*p_SEL_VAL)[6].link_val,"INFO_SEQ");
          strcpy((*p_SEL_VAL)[7].link_val,"CLIENT");
		Alert("\n p_SEL_VAL)[7].link_val is |%s|\n",(*p_SEL_VAL)[7].link_val);
          strcpy((*p_SEL_VAL)[8].link_val,"INSTR_TYPE");
          strcpy((*p_SEL_VAL)[9].link_val,"CORP_ID");
          strcpy((*p_SEL_VAL)[10].link_val,"OP_EVT_CLASS");
          strcpy((*p_SEL_VAL)[11].link_val,"DUMMY");
          strcpy((*p_SEL_VAL)[12].link_val,"DUMMY");
          strcpy((*p_SEL_VAL)[13].link_val,"QUANTITY_BAL");
         
	    strcpy((*p_SEL_VAL)[14].link_val,"SUB_NEW_QUANTITY");
		 /*Also Done changes for the DL_SAFEK table with column name STATUS_POS to STATUS where ever necessary */
		/***** PRODUCTION ISSUE BOD_PROCESS ISKB_2436 for SUB_BASE_QUANTITY - Start******/
	    Alert("Inside Msg_no 562 SUB_NEW_QUANTITY =[%s]  : ",(*p_SEL_VAL)[14].link_val);
	    (*p_SEL_VAL)[14].NUM_VAL = 0.0;
	    strcpy((*p_SEL_VAL)[15].link_val,"SUB_BASE_QUANTITY");
	    Alert("Inside Msg_no 562 SUB_BASE_QUANTITY =[%s]  : ",(*p_SEL_VAL)[15].link_val);
	    (*p_SEL_VAL)[15].NUM_VAL = 0.0;	
            /***** PRODUCTION ISSUE BOD_PROCESS ISKB_2436 for SUB_BASE_QUANTITY - End******/
            strcpy((*p_SEL_VAL)[16].link_val,"INSTR_CODE"); 
            strcpy((*p_SEL_VAL)[17].link_val,"CURRMSGREFNO"); 
            strcpy((*p_SEL_VAL)[18].link_val,"NEW_RESPONS_DT");    
            strcpy((*p_SEL_VAL)[19].link_val,"NEW_BUYRESP_DT");
            strcpy((*p_SEL_VAL)[20].link_val,"NEW_SELLRESP_DT");
            strcpy((*p_SEL_VAL)[21].link_val,"NOMINAL_VALUE");  
            strcpy((*p_SEL_VAL)[22].link_val,"FTYPEOFINSTR");  
            strcpy((*p_SEL_VAL)[23].link_val,"FENT_POS");
            strcpy((*p_SEL_VAL)[24].link_val,"EVENT_IND");  
            strcpy((*p_SEL_VAL)[25].link_val,"PART_REDEM"); /*Vaibhav I-Solve ID:159 KOTAK-UAT ----START*/
            strcpy((*p_SEL_VAL)[26].link_val,"CONTACT_DETAILS"); /* Vaibhav 11Sept2007 INCUS070 */
            strcpy((*p_SEL_VAL)[27].link_val,"");
            strcpy((*p_SEL_VAL)[27].link_tag,"");           /*Vaibhav I-Solve ID:159 KOTAK-UAT ----END*/ 
				

	  if ( (strcmp(chr_l_op_event_type,"TO") == 0) || (strcmp(chr_l_ce_typ,"SM")==0) || (strcmp(chr_l_ce_typ,"BB")==0)
			  || (strcmp(chr_l_op_event_type,"PO") == 0) )
		strcpy(chr_l_sel_msg_stmt,"select unique (e.client),a.instr_code,a.CA_EVENT,");
	  else	
         	 strcpy(chr_l_sel_msg_stmt,"select b.client,a.instr_code,a.CA_EVENT,");
          strcat(chr_l_sel_msg_stmt,"substr(TO_CHAR(a.DECLARE_DT,'YYMMDD'),1,6) as DECLARE_DT,");
          strcat(chr_l_sel_msg_stmt,"substr(TO_CHAR(a.DECLARE_DT,'DD-MM-YYYY'),1,10) as EM_DECLARE_DT,");
          strcat(chr_l_sel_msg_stmt,"substr(TO_CHAR(a.RESPONSE_DATE,'dd.mm.yyyy'),1,10) as RESPONSE_DATE,");
          strcat(chr_l_sel_msg_stmt,"a.EVNT_INDNT,a.OP_EVT_CLASS,a.corp_id,replace(replace(a.contact_details,chr(13),NULL),chr(10),NULL) as CONTACT_DETAILS,");
          strcat(chr_l_sel_msg_stmt,"a.ENTL_SEND_MSG_IND,a.RES_INSTR_CODE,");


	  
	  if ( (strcmp(chr_l_op_event_type,"TO") == 0) || (strcmp(chr_l_ce_typ,"SM")==0)|| (strcmp(chr_l_ce_typ,"BB")==0)
			  || (strcmp(chr_l_op_event_type,"PO") == 0))
	  {
          /* VaibhavK Kotak ISKB: 671  "to_char" is used in below query...... 10March2008 */
          strcat(chr_l_sel_msg_stmt,"(select to_char(sum(safekeep_pos- val_del-dp_del-nvaldeliver)) from DL_SAFEK where client = d.cln_code and instr_code = a.instr_code) as elig_entitl_pos, (select to_char(sum(safekeep_pos- val_del-dp_del-nvaldeliver) * ");

			strcat(chr_l_sel_msg_stmt,chr_conv_rate_str);
			strcat(chr_l_sel_msg_stmt,") from DL_SAFEK where client = d.cln_code and instr_code = a.instr_code) as quantity_bal,'");
	  }
	  /* Changes by AmitB 23/08/2006 For Reminder Messages of Rights **/
	  else if(strcmp(chr_l_ce_typ,"RT")==0)
	  {
         /* VaibhavK Kotak ISKB: 671  "to_char" is used in below query...... 10March2008 */ 
	  	strcat(chr_l_sel_msg_stmt,"to_char(b.ELIG_ENTITL_POS) as elig_entitl_pos,(SELECT to_char(nvl((SUM(SAFEKEEP_POS - NVL(NVALDELIVER,0)-NVL(VAL_DEL,0)-NVL(DP_DEL,0))),0)) FROM DL_SAFEK x WHERE x.client = d.cln_code AND x.INSTR_CODE =(SELECT RES_INSTR_CODE FROM CAEVENT y where y.CORP_ID =a.corp_id)) as quantity_bal,'");
	  }
	  else
	  {
			strcat(chr_l_sel_msg_stmt,"b.ELIG_ENTITL_POS as elig_entitl_pos, b.QUANTITY_BAL as quantity_bal,'");
	  }

          strcat(chr_l_sel_msg_stmt,chr_new_ca_unique_ref_num);   
          strcat(chr_l_sel_msg_stmt,"' as CURRMSGREFNO,a.INFO_SEQ,decode(a.RHTS_CLASS,'Y','SALABLE','NONSALE') as RHTS_CLASS,  "); 
          strcat(chr_l_sel_msg_stmt,"c.NOMINAL_VALUE,c.INSTR_ISIN,c.INSTR_TYPE,c.currency_cd,");
	  strcat(chr_l_sel_msg_stmt,"substr(concat(a.instr_code,concat(concat(to_char(to_date(a.DECLARE_DT),'YY'),lpad(((to_date(a.DECLARE_DT) - to_date(concat(concat('01/01/',to_char(a.DECLARE_DT,'YYYY')),' 12:00:00')))+1),3,'0')),lpad(substr(to_char(a.EVNT_INDNT),1,2),2,'0'))),1,16) as TEVENTID,");
	  strcat(chr_l_sel_msg_stmt,"decode(c.INSTR_TYPE,'BON',decode(d.CLN_FMT_RPTIND,'Y','FMT'");
	  strcat(chr_l_sel_msg_stmt,",c.INSTR_TYPE),c.INSTR_TYPE) as FTYPEOFINSTR,");
     
	  		
   	if (strlen(l_ms_msgent_structa_a.proc_data) != 0 && (strcmp(chr_l_param[0],"INST")==0 || strcmp(chr_l_param[0],"CAST")==0))
		{
			strcat(chr_l_sel_msg_stmt,"to_char(r.INSTR_HOLD) as FENT_POS, r.INSTR_HOLD,");
		}
		else
		{

	  		if ( (strcmp(chr_l_op_event_type,"TO") == 0) || (strcmp(chr_l_ce_typ,"SM")==0) || (strcmp(chr_l_ce_typ,"BB")==0) || (strcmp(chr_l_op_event_type,"PO") == 0))
			{
				strcat(chr_l_sel_msg_stmt,"to_char((select sum(safekeep_pos) from DL_SAFEK where instr_code = a.instr_code and client = d.cln_code) * ");
				strcat(chr_l_sel_msg_stmt," decode(c.INSTR_TYPE,'BON',decode(d.CLN_FMT_RPTIND,'Y',c.NOMINAL_VALUE,1),1)) as FENT_POS, ");
			}
			else
				strcat(chr_l_sel_msg_stmt,"decode(c.INSTR_TYPE,'BON',decode(d.CLN_FMT_RPTIND,'Y',to_char(b.ELIG_ENTITL_POS*c.NOMINAL_VALUE),b.ELIG_ENTITL_POS),b.ELIG_ENTITL_POS) as FENT_POS,");
		}
          strcat(chr_l_sel_msg_stmt,"concat(concat(concat('/',c.currency_cd),'/'),c.REG_BR_IND) as RCCYCODE,");
          strcat(chr_l_sel_msg_stmt,"concat(concat(concat('/',c.currency_cd),'/'),c.REG_BR_IND) as SCCYCODE,");
	  strcat(chr_l_sel_msg_stmt,"substr(replace(replace(c.instr_name,chr(13),NULL),chr(10),NULL),1,35) as INSTR_NAME,");
         strcat(chr_l_sel_msg_stmt,"d.CLN_USE_ISIN_IND as FLGISIN,d.CLN_FMT_RPTIND,concat('/',d.cln_code) as NACCOUNT ,");
	Alert("\n p_SEL_VAL)[7].link_val is at 8388 |%s|\n",(*p_SEL_VAL)[7].link_val);
			
			 strcat(chr_l_sel_msg_stmt," d.CLN_TAXABLE_IND  as IND_83C83D ,");
			 strcat(chr_l_sel_msg_stmt," substr(replace(replace(d.cln_name,chr(13),NULL),chr(10),NULL),1,35)  as CLNT_NAME ");
	               /* VaibhavK Changes for BB Reminder Message 30/10/2007 Start*/	
                       Alert("Vaibhav.... Im here before Event Chk");
                       if(strcmp(chr_l_ce_typ,"BB")==0)
                       {	
                        Alert("Vaibhav.... 100000000000000001");
                        strcat(chr_l_sel_msg_stmt,", a.LWR_LIMIT as LOWER_LIMIT,");     
                        Alert("Vaibhav.... 200000000000000001");
                        strcat(chr_l_sel_msg_stmt," a.UPR_LIMIT as UPPER_LIMIT,"); 
                        strcat(chr_l_sel_msg_stmt," a.BK_BUILD_IND as FIXED_PRICE,");
                        strcat(chr_l_sel_msg_stmt," to_char(decode(a.EARNINGS,NULL,'0',0,'0',a.EARNINGS),'9999999999999990.99999999' ) as EARNINGS," );
                        strcat(chr_l_sel_msg_stmt," to_char(decode(a.EARNINGS,NULL,'0',0,'0',a.EARNINGS),'9999999999999990.99999999') as TEARNINGS," );
                        strcat(chr_l_sel_msg_stmt," substr(to_char(a.DEAL_FRM_DATE,'YYYYMMDD'),1,8) as NEW_TRADEFROM_DT,");
                        strcat(chr_l_sel_msg_stmt," substr(to_char(a.DEAL_FRM_DATE,'DD-MM-YYYY'),1,10) as EM_TRADEFROM_DT,");  
                        strcat(chr_l_sel_msg_stmt,"substr(to_char(a.DEAL_TO_DATE,'YYYYMMDD'),1,8) as NEW_TRADETO_DT, ");
                        strcat(chr_l_sel_msg_stmt,"substr(to_char(a.DEAL_TO_DATE,'DD-MM-YYYY'),1,10) as EM_TRADETO_DT ");
                       }
                       /* VaibhavK Changes for BB Reminder Message 30/10/2007 End*/ 
			 
			 strcat(chr_l_sel_msg_stmt,", substr(to_char(a.DECLARE_DT,'YYYYMMDD'),1,8) as NEW_DECL_DT, ");
			 strcat(chr_l_sel_msg_stmt," substr(to_char(a.DECLARE_DT,'DD-MM-YYYY'),1,10) as EM_DECL_DT, ");
			 strcat(chr_l_sel_msg_stmt,"substr(to_char(a.REC_DATE,'YYYYMMDD'),1,8) as NEW_REC_DT, ");
			 strcat(chr_l_sel_msg_stmt,"substr(to_char(a.BC_FROM_DATE,'YYYYMMDD'),1,8) as NEW_BC_DT, ");
			 strcat(chr_l_sel_msg_stmt,"substr(to_char(a.BC_FROM_DATE,'DD-MM-YYYY'),1,10) as EM_BC_DT, ");
			 strcat(chr_l_sel_msg_stmt,"substr(to_char(a.EX_DATE,'YYYYMMDD'),1,8) as NEW_EX_DT, ");
			 strcat(chr_l_sel_msg_stmt,"substr(to_char(a.PROXY_DATE,'YYYYMMDD'),1,8) as PROXY_DT, ");
			 strcat(chr_l_sel_msg_stmt,"substr(to_char(a.PROXY_DATE,'YYYYMMDDhh24miss'),1,14) as NEW_PROXY_DT, ");
			 strcat(chr_l_sel_msg_stmt,"substr(to_char(a.PROXY_DATE,'DD-MM-YYYY hh24:mi:ss'),1,19) as EM_PROXY_DT, ");
			 strcat(chr_l_sel_msg_stmt,"substr(to_char(a.MEETING_DATE,'YYYYMMDD'),1,8) as NEW_MEET_DT, ");
          
          strcat(chr_l_sel_msg_stmt,"substr(to_char(a.RESPONSE_DATE,'YYYYMMDDhh24miss'),1,14) as NEW_RESPONS_DT,");
          strcat(chr_l_sel_msg_stmt,"substr(to_char(a.RESPONSE_DATE,'DD-MM-YYYY hh24:mi:ss'),1,19) as EM_RESPONS_DT,");
          strcat(chr_l_sel_msg_stmt,"substr(to_char(a.RESPONSEDT_BUY,'YYYYMMDDhh24miss'),1,14) as NEW_BUYRESP_DT,");
          strcat(chr_l_sel_msg_stmt,"substr(to_char(a.SELL_RESP_DATE,'YYYYMMDDhh24miss'),1,14) as NEW_SELLRESP_DT,");
          
			 strcat(chr_l_sel_msg_stmt,"substr(to_char(a.dateof_payment,'YYYYMMDD'),1,8) as NEW_PAY_DT, ");
			 strcat(chr_l_sel_msg_stmt,"substr(to_char(a.EXPIRY_DATE,'YYYYMMDD'),1,8) as NEW_EXPIRE_DT, ");
			 strcat(chr_l_sel_msg_stmt,"substr(to_char(a.PART_PYMT_DT,'YYYYMMDD'),1,8) as NEW_PP_DT, ");
			 strcat(chr_l_sel_msg_stmt,"a.NEW_SAFEK_QTY, a.OLD_STK_QTY, ");
			 strcat(chr_l_sel_msg_stmt,"substr(concat(concat(decode(a.OLD_STK_QTY,NULL,'0',0,'0',a.OLD_STK_QTY),':'),decode(a.NEW_SAFEK_QTY,NULL,'0',0,'0',a.NEW_SAFEK_QTY)),1,15) as TRATIO, ");
			 
           strcat(chr_l_sel_msg_stmt,"decode(a.SUB_PR,0,'0','','0',a.SUB_PR) as SUB_PR, a.CA_CURRENCY as CCYSUB_PRICE, ");
			 strcat(chr_l_sel_msg_stmt,"a.SUB_NEW_QUANTITY, a.SUB_BASE_QUANTITY ");
			 strcat(chr_l_sel_msg_stmt,", a.EXP_DT_OPEN_IND "); 
			 
        
         strcat(chr_l_sel_msg_stmt,", substr(to_char(a.DEAL_FRM_DATE,'YYYYMMDD'),1,8) as NEW_TRADEFROM_DT, ");
         strcat(chr_l_sel_msg_stmt," substr(to_char(a.DEAL_FRM_DATE,'DD-MM-YYYY'),1,10) as EM_TRADEFROM_DT, ");
         strcat(chr_l_sel_msg_stmt,"substr(to_char(a.DEAL_TO_DATE,'YYYYMMDD'),1,8) as NEW_TRADETO_DT, ");
         strcat(chr_l_sel_msg_stmt,"substr(to_char(a.DEAL_TO_DATE,'DD-MM-YYYY'),1,10) as EM_TRADETO_DT, ");
         strcat(chr_l_sel_msg_stmt,"substr(to_char(a.SUBSCR_DATE,'YYYYMMDD'),1,8) as NEW_SUBS_DT, ");
         strcat(chr_l_sel_msg_stmt,"substr(to_char(a.SUBSCR_DATE,'DD-MM-YYYY'),1,10) as EM_SUBS_DT, ");
         strcat(chr_l_sel_msg_stmt,"substr(to_char(a.POST_DATE,'YYYYMMDD'),1,8) as NEW_POSTING_DT, ");
         strcat(chr_l_sel_msg_stmt,"a.OVER_SUBSCRP ");
         
			
         
         strcat(chr_l_sel_msg_stmt,",a.DISP_OF_FRACT, ");

			strcat(chr_l_sel_msg_stmt, " d.CLN_FRACT_IND as FRACT_IND, '");  
         strcat(chr_l_sel_msg_stmt, chr_l_keep_fract_temp);
         strcat(chr_l_sel_msg_stmt, "' as FRACT_COND");

         
         strcat(chr_l_sel_msg_stmt,",a.FRACT_PR ");

			strcat(chr_l_sel_msg_stmt,",a.DIVIDEND_TYPE as NEW_DEF_OPT "); 
        

			strcat(chr_l_sel_msg_stmt,",a.ENTITL_INFONO as EVENT_IND "); 
	Alert("\n p_SEL_VAL)[7].link_val is at 8461 |%s|\n",(*p_SEL_VAL)[7].link_val);
			
         if (strlen(l_ms_msgent_structa_a.proc_data) != 0 && (strcmp(chr_l_param[0],"INST")==0 || strcmp(chr_l_param[0],"CAST")==0))
         {
			if(APL_FAILURE == CO_Chk_CntryEnabled("CACASHACC","IBANACC",&l_cond_ibanacc,l_debug_info_ptr))
            {
                 APL_GOBACK_FAIL
            }
            if(l_cond_ibanacc == 1)
            {
                if(APL_FAILURE == MT_Rtv_CashAcc(l_ms_msgent_structa_a.client,"A",chr_l_cash_acc,l_debug_info_ptr))
                {
                   CO_InsertErr(l_debug_info_ptr,ERR_ACCNOT_FND, chr_l_cash_acc, APL_NULL_STRING,APL_NULL_STRING
,__LINE__,__FILE__);
                }
            }		
		else
		{
				if (APL_FAILURE == MT_Rtv_CashAcc(l_ms_msgent_structa_a.client,"X",chr_l_cash_acc,l_debug_info_ptr))
				{
					CO_InsertErr(l_debug_info_ptr,ERR_ACCNOT_FND, chr_l_cash_acc, APL_NULL_STRING,APL_NULL_STRING, __LINE__, __FILE__);
					APL_GOBACK_FAIL
				}
		}
            strcat(chr_l_sel_msg_stmt,", '");
            strcat(chr_l_sel_msg_stmt,chr_l_param[0]);
            strcat(chr_l_sel_msg_stmt,"' as NEW_MSG_FUNC ");
            strcat(chr_l_sel_msg_stmt,", s.status_qual as NEW_STAT_QUAL ");
            strcat(chr_l_sel_msg_stmt,", s.status_code as NEW_STAT_CODE ");
            strcat(chr_l_sel_msg_stmt,", nvl(s.reas_qual,NULL) as NEW_REAS_QUAL ");
            strcat(chr_l_sel_msg_stmt,", nvl(s.reas_code,NULL) as NEW_REAS_CODE ");
            strcat(chr_l_sel_msg_stmt,", NULL as NEW_STAT_NARR ");
            strcat(chr_l_sel_msg_stmt,", '");
            strcat(chr_l_sel_msg_stmt,chr_l_cash_acc);
            strcat(chr_l_sel_msg_stmt,"' as NEW_CASH_ACC ");
            strcat(chr_l_sel_msg_stmt,", r.INSTR_MSGREFNO as NEW_SEME ");
         }
			
			
         else if (strlen(l_ms_msgent_structa_a.proc_data) != 0 && strcmp(chr_l_param[0],"EVST")==0)
         {
            strcat(chr_l_sel_msg_stmt,", 'EVST' as NEW_MSG_FUNC ");
            strcat(chr_l_sel_msg_stmt,", s.status_qual as NEW_STAT_QUAL ");
            strcat(chr_l_sel_msg_stmt,", s.status_code as NEW_STAT_CODE ");
            strcat(chr_l_sel_msg_stmt,", nvl(s.reas_qual,NULL) as NEW_REAS_QUAL ");
            strcat(chr_l_sel_msg_stmt,", nvl(s.reas_code,NULL) as NEW_REAS_CODE ");
            
          strcat(chr_l_sel_msg_stmt,", substr(translate(r.detail,chr(10)||chr(13)||chr(9)||chr(24),' '),1,35) as NEW_STAT_NARR1 ");
          strcat(chr_l_sel_msg_stmt,", substr(translate(r.detail,chr(10)||chr(13)||chr(9)||chr(24),' '),36,35) as NEW_STAT_NARR2 ");
          strcat(chr_l_sel_msg_stmt,", substr(translate(r.detail,chr(10)||chr(13)||chr(9)||chr(24),' '),71,35) as NEW_STAT_NARR3 ");
          strcat(chr_l_sel_msg_stmt,", substr(translate(r.detail,chr(10)||chr(13)||chr(9)||chr(24),' '),106,35) as NEW_STAT_NARR4 ");
          strcat(chr_l_sel_msg_stmt,", substr(translate(r.detail,chr(10)||chr(13)||chr(9)||chr(24),' '),141,35) as NEW_STAT_NARR5 ");
          strcat(chr_l_sel_msg_stmt,", substr(translate(r.detail,chr(10)||chr(13)||chr(9)||chr(24),' '),176,35) as NEW_STAT_NARR6 ");
            strcat(chr_l_sel_msg_stmt,", NULL as NEW_CASH_ACC ");
				
            
				strcat(chr_l_sel_msg_stmt,", r.INSTR_MSGREFNO as NEW_SEME ");
				strcat(chr_l_sel_msg_stmt,", substr(r.CA_OPTCD,1,3) as NEWOPTNO ");
				strcat(chr_l_sel_msg_stmt,", substr(r.CA_OPTCD,5,8) as NEWOPTCODE ");
				strcat(chr_l_sel_msg_stmt,", r.INSTR_HOLD as STAT_HOLDG ");
				
         }
         
			
			else if (strlen(l_ms_msgent_structa_a.proc_data) != 0 && strcmp(chr_l_param[0],"NPAY")==0)
         {
            strcat(chr_l_sel_msg_stmt,", 'EVST' as NEW_MSG_FUNC ");
            strcat(chr_l_sel_msg_stmt,", 'EPRC' as NEW_STAT_QUAL ");
            strcat(chr_l_sel_msg_stmt,", 'PEND' as NEW_STAT_CODE ");
            strcat(chr_l_sel_msg_stmt,", 'PEND' as NEW_REAS_QUAL ");
            strcat(chr_l_sel_msg_stmt,", 'NPAY' as NEW_REAS_CODE ");
            strcat(chr_l_sel_msg_stmt,", NULL as NEW_STAT_NARR ");
            strcat(chr_l_sel_msg_stmt,", NULL as NEW_CASH_ACC ");
            strcat(chr_l_sel_msg_stmt,", NULL as NEW_SEME ");
         }

			strcat(chr_l_sel_msg_stmt,", a.ENTITL_INFONO as EVENT_IND ");
			
			strcat(chr_l_sel_msg_stmt," ,a.REQD_CERTIFY as REQD_CERTIFY ");
			strcat(chr_l_sel_msg_stmt," ,decode(a.earnings,0,'0',NULL,'0',a.earnings) as TEARNINGS "); /** TUX **/
			strcat(chr_l_sel_msg_stmt," ,'12' as DECTEARNINGS, '12' as DECR_EARNINGS ");
			strcat(chr_l_sel_msg_stmt," ,c.currency_cd as CCYTEARNINGS ");
			strcat(chr_l_sel_msg_stmt," ,a.BK_BUILD_IND as FIXED_PRICE "); /** TUX **/
			strcat(chr_l_sel_msg_stmt," ,decode(a.WWWADDR,NULL,NULL,substr(a.WWWADDR,1,35)) as WEBB_ADD1 ");
			strcat(chr_l_sel_msg_stmt," ,decode(a.WWWADDR,NULL,NULL,substr(a.WWWADDR,36,35)) as WEBB_ADD2 ");
			strcat(chr_l_sel_msg_stmt," ,decode(a.WWWADDR,NULL,NULL,substr(a.WWWADDR,71,35)) as WEBB_ADD3 ");
			strcat(chr_l_sel_msg_stmt," ,a.REDEM_RT as REDEM_RATE, c.currency_cd as CCYREDEM_RATE");
			strcat(chr_l_sel_msg_stmt," ,decode(a.redem_rt ,c.nominal_value,'N','Y') as PART_REDEM  ");
			strcat(chr_l_sel_msg_stmt," ,'12' as DECREDEM_RATE ");
		   strcat(chr_l_sel_msg_stmt," ,decode(a.EARNINGS, '0','PCT',NULL,'PCT',a.CA_CURRENCY)as RDIRTTYPE  ");
			strcat(chr_l_sel_msg_stmt," ,a.EARNINGS_RATE as R_EARNINGS ");
			strcat(chr_l_sel_msg_stmt," ,'12' as DECR_EARNINGS ");
			strcat(chr_l_sel_msg_stmt," ,c.currency_cd as CCYR_EARNINGS " );

			if ( (strcmp(chr_l_op_event_type,"TO") == 0) || (strcmp(chr_l_ce_typ,"SM")==0) || (strcmp(chr_l_ce_typ,"BB")==0) || (strcmp(chr_l_op_event_type,"PO") == 0))
				strcat(chr_l_sel_msg_stmt,"from CAEVENT a,DL_SAFEK e,MT_INSTRUMENT c,MT_CLIENT d");
			else
	  			strcat(chr_l_sel_msg_stmt,"from CAEVENT a,CAENTITLEMENT b,MT_INSTRUMENT c,MT_CLIENT d");
         
Alert("\n p_SEL_VAL)[7].link_val is at 8388 |%s|\n",(*p_SEL_VAL)[7].link_val);			
			if (strlen(l_ms_msgent_structa_a.proc_data) != 0 && (strcmp(chr_l_param[0],"INST")==0 || strcmp(chr_l_param[0],"CAST")==0))
         {
            strcat(chr_l_sel_msg_stmt,", CAREPLY r, ASTAT s ");
         }

			
         else if (strlen(l_ms_msgent_structa_a.proc_data) != 0 && strcmp(chr_l_param[0],"EVST")==0)
         {
            strcat(chr_l_sel_msg_stmt,", CASTATUS r, ASTAT s ");
         }
	  if ( (strcmp(chr_l_op_event_type,"TO") == 0) || (strcmp(chr_l_ce_typ,"SM")==0)|| (strcmp(chr_l_ce_typ,"BB")==0) 
			  || (strcmp(chr_l_op_event_type,"PO") == 0))
		strcat(chr_l_sel_msg_stmt," where e.instr_code = a.instr_code  and ");
	  else
         	 strcat(chr_l_sel_msg_stmt," where a.corp_id = b.corp_id  and ");
          strcat(chr_l_sel_msg_stmt,"a.instr_code = c.instr_code and ");
	  if ( (strcmp(chr_l_op_event_type,"TO") == 0) || (strcmp(chr_l_ce_typ,"SM")==0)|| (strcmp(chr_l_ce_typ,"BB")==0) 
			 || (strcmp(chr_l_op_event_type,"PO") == 0) )
		strcat(chr_l_sel_msg_stmt,"e.client = d.cln_code  ");
	  else
         	 strcat(chr_l_sel_msg_stmt,"b.client = d.cln_code  ");
          strcat(chr_l_sel_msg_stmt," and a.corp_id = '");
	  		 strcat(chr_l_sel_msg_stmt,chr_l_ca_id);
	  		 strcat(chr_l_sel_msg_stmt,"'");
         
				
			 if (strlen(l_ms_msgent_structa_a.proc_data) != 0 && (strcmp(chr_l_param[0],"INST")==0 || strcmp(chr_l_param[0],"CAST")==0 || strcmp(chr_l_param[0],"EVST")==0))
         {
            strcat(chr_l_sel_msg_stmt," and r.corp_id = a.corp_id and r.client = '");
            strcat(chr_l_sel_msg_stmt, l_ms_msgent_structa_a.client);
            strcat(chr_l_sel_msg_stmt,"' and r.stat_cd = s.inst_stat_code ");
         }
          if((strlen(l_ms_msgent_structa_a.client))!=0)
          {
		if ( (strcmp(chr_l_op_event_type,"TO") == 0) || (strcmp(chr_l_ce_typ,"SM")==0)||(strcmp(chr_l_ce_typ,"BB")==0) 
				|| (strcmp(chr_l_op_event_type,"PO") == 0))
			 strcat(chr_l_sel_msg_stmt,"and e.client = '");
		else
          	       	strcat(chr_l_sel_msg_stmt,"and b.client = '");
                strcat(chr_l_sel_msg_stmt,l_ms_msgent_structa_a.client);
          	strcat(chr_l_sel_msg_stmt,"' "); 
          }

          strcat(chr_l_sel_msg_stmt," and d.STATUS != '");
          strcat(chr_l_sel_msg_stmt,STATUS_CLS_AUTH);
          strcat(chr_l_sel_msg_stmt,"' ");
	  CO_ProcMonitor(APL_OUT_FILE,chr_l_sel_msg_stmt,NULL,NULL);

        Alert("\n *****&&&&&  Tag 7 is [%s]:> ",(*p_STAT_VAL)[7].link_val);
        Alert("\n *****&&&&&  Value of Tag 7 is [%s]:> ",l_mt_message_sys_params_struct_h.swift_cd); 
        }
	 
	Alert("\n p_msg_no is |%s| \n ",p_msg_no);
fflush(stdout);
        /* VaibhavK  Reminder Message for Event= { 'SM' / 'BB' / 'PO' / 'RT' }  End*/

        /* VaibhavK  Intimation / Cancellation Message for Event= 'SM' Start*/ 
        if(strcmp(p_msg_no,"560N01") == 0 || strcmp(p_msg_no,"560R01") == 0) /*VaibhavK I-Solve:362*/
        {
          l_msgaddr = MCORPACTIONSMSGNO;
			 l_msgaddr1 = MCORPACTIONSSMMSGNO;
          if(strlen(l_ms_msgent_structa_a.proc_init) != 0)
          {
             strcpy(chr_l_ca_id,l_ms_msgent_structa_a.proc_init);
          }

          /* VaibhavK Kotak INCUS046 2 Nov.2007 SRK...B'day....... Start*/
          *p_STAT_VAL = realloc(*p_STAT_VAL,sizeof(MS_STATIC_VAL)*7); 
          /* VaibhavK Kotak INCUS046 2 Nov.2007 SRK...B'day....... End*/
			 
         /*Increased the Size of MS_STATIC_VAL from 38 to 39 as the varable is used for 38 values ISKB_2496 - CVS */
          *p_SEL_VAL = realloc(*p_SEL_VAL,sizeof(MS_STATIC_VAL)*39);

          strcpy((*p_STAT_VAL)[1].link_val,"DOMSEC");
          strcpy((*p_STAT_VAL)[1].link_tag,chr_h_dom_instr);
          strcpy((*p_STAT_VAL)[2].link_val,"TITLE");
          strcpy((*p_STAT_VAL)[2].link_tag,"BOND OR SHAREHOLDERS MEETING");
          strcpy((*p_STAT_VAL)[3].link_val,"CA_IDENTNAME");
          strcpy((*p_STAT_VAL)[3].link_tag,chr_h_corporate_name);
			 
			 strcpy((*p_STAT_VAL)[4].link_val,"NATION");
			 strcpy((*p_STAT_VAL)[4].link_tag,g_mt_commonsys_params_struct_h.nation_code);
                         /* VaibhavK Kotak INCUS046 2 Nov.2007 SRK...B'day....... Start*/               
                         strcpy((*p_STAT_VAL)[5].link_val,"CNTRY_BIC"); 
                         strcpy((*p_STAT_VAL)[5].link_tag,l_mt_message_sys_params_struct_h.swift_cd);
                         /* VaibhavK Kotak INCUS046 2 Nov.2007 SRK...B'day....... End*/ 
			 strcpy((*p_STAT_VAL)[6].link_val,"");
			 strcpy((*p_STAT_VAL)[6].link_tag,"");
			 

          strcpy((*p_SEL_VAL)[0].link_val,"CLN_CODE");
          strcpy((*p_SEL_VAL)[1].link_val,"CA_ADDRDET");
          strcpy((*p_SEL_VAL)[2].link_val,"CONTACT_DETAILS");
          strcpy((*p_SEL_VAL)[3].link_val,"CA_EVENT");
          strcpy((*p_SEL_VAL)[4].link_val,"INSTR_CODE");
          strcpy((*p_SEL_VAL)[5].link_val,"TEVENTID");
          strcpy((*p_SEL_VAL)[6].link_val,"LNOTE_NBR");
          strcpy((*p_SEL_VAL)[7].link_val,"TNOTE_NBR");
          strcpy((*p_SEL_VAL)[8].link_val,"INSTR_TYPE");
          strcpy((*p_SEL_VAL)[9].link_val,"DUMMY");
          strcpy((*p_SEL_VAL)[10].link_val,"DUMMY");
          strcpy((*p_SEL_VAL)[11].link_val,"FTYPEOFINSTR");
          strcpy((*p_SEL_VAL)[12].link_val,"NOMINAL_VALUE");
			 
          strcpy((*p_SEL_VAL)[13].link_val,"DECLARE_DT");
          strcpy((*p_SEL_VAL)[14].link_val,"EVNT_INDNT");
          strcpy((*p_SEL_VAL)[15].link_val,"PROXY_DATE");
          strcpy((*p_SEL_VAL)[16].link_val,"MEETING_DATE");
          strcpy((*p_SEL_VAL)[17].link_val,"RATIO");
          strcpy((*p_SEL_VAL)[18].link_val,"SUB_PR");
          strcpy((*p_SEL_VAL)[19].link_val,"SUB_RATIO");
          strcpy((*p_SEL_VAL)[20].link_val,"FLGISIN");
          strcpy((*p_SEL_VAL)[21].link_val,"FMT_RPTIND");
          strcpy((*p_SEL_VAL)[22].link_val,"NACCOUNT");
          strcpy((*p_SEL_VAL)[23].link_val,"INSTR_ISIN");
          strcpy((*p_SEL_VAL)[24].link_val,"CA_NAME");
          strcpy((*p_SEL_VAL)[25].link_val,"SECCCY");
          strcpy((*p_SEL_VAL)[26].link_val,"INSTR_NAME");
          strcpy((*p_SEL_VAL)[27].link_val,"CURRENCY_CD");
          strcpy((*p_SEL_VAL)[28].link_val,"IND_83C83D");
          strcpy((*p_SEL_VAL)[29].link_val,"CLNT_NAME");

			 

          strcpy((*p_SEL_VAL)[30].link_val,"CORP_ID");
          strcpy((*p_SEL_VAL)[31].link_val,"EVENT_IND");
          strcpy((*p_SEL_VAL)[32].link_val,"CURRMSGREFNO");
          strcpy((*p_SEL_VAL)[33].link_val,"WEBB_ADD1");
          strcpy((*p_SEL_VAL)[34].link_val,"WEBB_ADD2");
          strcpy((*p_SEL_VAL)[35].link_val,"WEBB_ADD3");
          strcpy((*p_SEL_VAL)[36].link_val,"NEW_REC_DT");  
          strcpy((*p_SEL_VAL)[37].link_val,"NEW_BC_DT");  
	  strcpy((*p_SEL_VAL)[38].link_val,"");
          strcpy((*p_SEL_VAL)[38].link_tag,"");

			 Alert("\n 2 \n ");

	  strcpy(chr_l_sel_msg_stmt,"select a.instr_code,substr(to_char(a.DECLARE_DT,'YYMMDD'),1,6) as DECLARE_DT,");
	  strcat(chr_l_sel_msg_stmt,"substr(to_char(a.DECLARE_DT,'DD-MM-YYYY'),1,10) as EM_DECLARE_DT,");
	  strcat(chr_l_sel_msg_stmt,"a.CA_EVENT,a.EVNT_INDNT,replace(replace(a.contact_details,chr(13),NULL),chr(10),NULL) as CONTACT_DETAILS,");
	  strcat(chr_l_sel_msg_stmt,"substr(to_char(a.PROXY_DATE,'YYMMDD'),1,6) as PROXY_DATE,");
	  strcat(chr_l_sel_msg_stmt,"substr(to_char(a.PROXY_DATE,'YYYYMMDDhh24miss'),1,14) as NEW_PROXY_DATE,");
	  strcat(chr_l_sel_msg_stmt,"substr(to_char(a.MEETING_DATE,'YYMMDD'),1,6) as MEETING_DATE,");
	  strcat(chr_l_sel_msg_stmt,"substr(to_char(a.MEETING_DATE,'DD-MM-YYYY'),1,10) as EM_MEETING_DATE,'");
	  strcat(chr_l_sel_msg_stmt,chr_new_ca_unique_ref_num);   
	  strcat(chr_l_sel_msg_stmt,"' as CURRMSGREFNO,a.INFO_SEQ as LNOTE_NBR,a.INFO_SEQ as TNOTE_NBR,");
	  strcat(chr_l_sel_msg_stmt,"substr(concat(decode(a.NEW_SAFEK_QTY,NULL,'0',a.NEW_SAFEK_QTY),concat(':',decode(a.OLD_STK_QTY,NULL,'0',a.OLD_STK_QTY))),1,15) as RATIO,");
	  strcat(chr_l_sel_msg_stmt,"a.SUB_PR,substr(concat(decode(a.SUB_BASE_QUANTITY,NULL,'0',a.SUB_BASE_QUANTITY),concat(':',decode(a.SUB_NEW_QUANTITY,NULL,'0',a.SUB_NEW_QUANTITY))),1,9) as SUB_RATIO,");
	  strcat(chr_l_sel_msg_stmt,"substr(concat(a.instr_code,concat(concat(to_char(to_date(a.DECLARE_DT),'YY'),lpad(((to_date(a.DECLARE_DT) - to_date(concat(concat('01/01/',to_char(a.DECLARE_DT,'YYYY')),' 12:00:00')))+1),3,'0')),lpad(substr(to_char(a.EVNT_INDNT),1,2),2,'0'))),1,16) as TEVENTID,");
	  strcat(chr_l_sel_msg_stmt,"b.CLN_USE_ISIN_IND as FLGISIN,b.cln_code,b.cln_code as CLIENT,b.CLN_FMT_RPTIND AS FMT_RPTIND,");
	  strcat(chr_l_sel_msg_stmt,"concat('/',b.cln_code) as NACCOUNT,b.CLN_FMT_RPTIND,");
	  strcat(chr_l_sel_msg_stmt,"c.INSTR_ISIN,decode(c.CA_NAME,NULL,NULL,c.CA_NAME) as CA_NAME,");
	  strcat(chr_l_sel_msg_stmt,"decode(c.INSTR_TYPE,'BON',decode(b.CLN_FMT_RPTIND,'Y','FMT'");
	  strcat(chr_l_sel_msg_stmt,",c.INSTR_TYPE),c.INSTR_TYPE) as FTYPEOFINSTR,");
	  strcat(chr_l_sel_msg_stmt,"concat('/',concat(concat(c.currency_cd,'/'),c.REG_BR_IND)) as SECCCY,substr(replace(replace(c.instr_name,chr(13),NULL),chr(10),NULL),1,35) as INSTR_NAME,");
	  strcat(chr_l_sel_msg_stmt,"decode(c.CA_ADDRDET,NULL,NULL,replace(replace(c.CA_ADDRDET,chr(13),NULL),chr(10),NULL)) as CA_ADDRDET,c.INSTR_TYPE,c.NOMINAL_VALUE,");
	  strcat(chr_l_sel_msg_stmt,"c.currency_cd ,");
	  
	  strcat(chr_l_sel_msg_stmt," b.CLN_TAXABLE_IND  as IND_83C83D ,");
	  strcat(chr_l_sel_msg_stmt," substr(replace(replace(b.cln_name,chr(13),NULL),chr(10),NULL),1,35)  as CLNT_NAME ");
	  
	  strcat(chr_l_sel_msg_stmt, ", a.corp_id as CORP_ID "); 

     
      strcat(chr_l_sel_msg_stmt,", a.PRELIMINARY_FLAG as PRELIM, ");
			
      strcat(chr_l_sel_msg_stmt,"substr(to_char(a.DECLARE_DT,'YYYYMMDD'),1,8) as NEW_DECL_DT, ");
      strcat(chr_l_sel_msg_stmt,"substr(to_char(a.DECLARE_DT,'DD-MM-YYYY'),1,10) as EM_DECL_DT, ");
      strcat(chr_l_sel_msg_stmt,"substr(to_char(a.MEETING_DATE,'YYYYMMDD'),1,8) as NEW_MEET_DT, ");
      strcat(chr_l_sel_msg_stmt,"substr(to_char(a.PROXY_DATE,'YYYYMMDD'),1,8) as NEW_PROXY_DT, ");
      strcat(chr_l_sel_msg_stmt,"substr(to_char(a.PROXY_DATE,'DD-MM-YYYY'),1,10) as EM_PROXY_DT, ");
		strcat(chr_l_sel_msg_stmt,"substr(to_char(a.PROXY_DATE,'YYYYMMDDhh24miss'),1,14) as NEW_P_DT2, "); /*Nik*/
		strcat(chr_l_sel_msg_stmt,"substr(to_char(a.PROXY_DATE,'DD-MM-YYYY hh24:mi:ss'),1,19) as EM_P_DT2, "); /*Amit*/
      strcat(chr_l_sel_msg_stmt,"substr(to_char(a.REC_DATE,'YYYYMMDD'),1,8) as NEW_REC_DT, ");  
      strcat(chr_l_sel_msg_stmt,"substr(to_char(a.BC_FROM_DATE,'YYYYMMDD'),1,8) as NEW_BC_DT, ");  
      strcat(chr_l_sel_msg_stmt,"substr(to_char(a.BC_FROM_DATE,'DD-MM-YYYY'),1,10) as EM_BC_DT, ");  
      strcat(chr_l_sel_msg_stmt,"substr('");
      strcat(chr_l_sel_msg_stmt, chr_h_corporate_name);
      strcat(chr_l_sel_msg_stmt,"',1,35) as NEW_CORPORATE_NAME, ");
      strcat(chr_l_sel_msg_stmt,"b.cln_code, ");
      strcat(chr_l_sel_msg_stmt,"substr((decode(c.CA_NAME,NULL,NULL,c.CA_NAME)),1,35) as NEW_CORP_NAME ");
      strcat(chr_l_sel_msg_stmt,", a.ENTITL_INFONO as EVENT_IND ");

      
	Alert("\n 2 \n ");
      
      strcat(chr_l_sel_msg_stmt," ,decode(a.WWWADDR,NULL,NULL,substr(a.WWWADDR,1,35)) as WEBB_ADD1");
      strcat(chr_l_sel_msg_stmt," ,decode(a.WWWADDR,NULL,NULL,substr(a.WWWADDR,36,35)) as WEBB_ADD2");
      strcat(chr_l_sel_msg_stmt," ,decode(a.WWWADDR,NULL,NULL,substr(a.WWWADDR,71,35)) as WEBB_ADD3");
      

      

      strcat(chr_l_sel_msg_stmt,", substr(to_char(a.DEAL_FRM_DATE,'YYYYMMDD'),1,8) as NEW_TRADEFROM_DT");
      strcat(chr_l_sel_msg_stmt,", substr(to_char(a.DEAL_FRM_DATE,'DD-MM-YYYY'),1,10) as EM_TRADEFROM_DT");
      strcat(chr_l_sel_msg_stmt,", substr(to_char(a.DEAL_TO_DATE,'YYYYMMDD'),1,8) as NEW_TRADETO_DT ");
      strcat(chr_l_sel_msg_stmt,", substr(to_char(a.DEAL_TO_DATE,'DD-MM-YYYY'),1,10) as EM_TRADETO_DT ");
      
		
      strcat(chr_l_sel_msg_stmt," ,a.REQD_CERTIFY as REQD_CERTIFY,nvl(b.CLN_GENERATE_IND,'N') as CLN_GENERATE_IND  ");  
	  strcat(chr_l_sel_msg_stmt," from CAEVENT a,MT_CLIENT b,MT_INSTRUMENT c ");
	  strcat(chr_l_sel_msg_stmt," where a.instr_code = c.instr_code and a.corp_id = '");
	  strcat(chr_l_sel_msg_stmt,chr_l_ca_id);
	  strcat(chr_l_sel_msg_stmt,"'");
          if((strlen(l_ms_msgent_structa_a.client))!=0)
          {
          	strcat(chr_l_sel_msg_stmt," and b.cln_code = '");
                strcat(chr_l_sel_msg_stmt,l_ms_msgent_structa_a.client);
          	strcat(chr_l_sel_msg_stmt,"'");
          }

          if(strcmp(p_msg_no,"560R01") == 0) /*Vaibhav KOTAK_UAT I-Solve:362 */
          {
                strcat(chr_l_sel_msg_stmt," and b.cln_code IN (select client from MS_MSGSTAT where proc_init = '");
                strcat(chr_l_sel_msg_stmt,chr_l_ca_id);
                strcat(chr_l_sel_msg_stmt,"' and swift_msg_rep IN ('560N01','564N88'))");
          }


          strcat(chr_l_sel_msg_stmt," and b.STATUS != '");
          strcat(chr_l_sel_msg_stmt,STATUS_CLS_AUTH);
          strcat(chr_l_sel_msg_stmt,"' ");

 
        }
        /* VaibhavK  Intimation / Cancellation Message for Event= 'SM' End*/
	Alert ("\n 1505 01");
	fflush(stdout);
         
        if(strncmp(p_msg_no,"556",3) == 0)
        {
          l_msgaddr = MCORPACTIONSMSGNO;       
          if(strlen(l_ms_msgent_structa_a.proc_init) != 0)
          {
             strcpy(chr_l_ca_id,l_ms_msgent_structa_a.proc_init);
          }
          else
          {
		APL_DATA_MISSING("CA ID", APL_NULL_STRING, APL_NULL_STRING)
                APL_GOBACK_FAIL
          }
          if(strlen(l_ms_msgent_structa_a.proc_data) != 0)
          {
             CO_SplitStr(l_ms_msgent_structa_a.proc_data,
                          ';', &int_noelem, &chr_l_param);
             strcpy(chr_l_refno,chr_l_param[0]);
				 if(int_noelem>1)
				 {
					 strcpy(l_event_class,chr_l_param[1]);
					 strcpy(l_notice_date,chr_l_param[2]);
				 }
          }
          else
          {
          if(strcmp(p_msg_no,"556N02")==0 || strcmp(p_msg_no,"556R02")==0)
          {
		APL_DATA_MISSING("Payment Srl Nbr", APL_NULL_STRING, APL_NULL_STRING)
                APL_GOBACK_FAIL
          }
          }
          *p_STAT_VAL = realloc(*p_STAT_VAL,sizeof(MS_STATIC_VAL)*10); 
 
			 

          *p_SEL_VAL = realloc(*p_SEL_VAL,sizeof(MS_STATIC_VAL)*19);
			
          strcpy((*p_STAT_VAL)[0].link_val,"DUMMY");
          /*strcpy((*p_STAT_VAL)[0].link_tag,"DUMMY");*/
          strcpy((*p_STAT_VAL)[0].link_tag,chr_l_ca_id); /* Vaibhav {RD} KOTAK-UAT I-SolveID:341*/ 
          strcpy((*p_STAT_VAL)[1].link_val,"DOMSEC");
          strcpy((*p_STAT_VAL)[1].link_tag,chr_h_dom_instr);
          strcpy((*p_STAT_VAL)[2].link_val,"DBCR");
          strcpy((*p_STAT_VAL)[3].link_val,"TITLE");
          strcpy((*p_STAT_VAL)[4].link_val,"TEXT");
          if(strcmp(p_msg_no,"556N01")==0)
          {
          	strcpy((*p_STAT_VAL)[2].link_tag,"C");
          	strcpy((*p_STAT_VAL)[3].link_tag,"ENTITLEMENT ");
          	strcpy((*p_STAT_VAL)[4].link_tag,APL_NULL_STRING);
          	strcpy((*p_STAT_VAL)[5].link_val,"ENTPAYIND");
          	strcpy((*p_STAT_VAL)[5].link_tag,"01");
          }
          if(strcmp(p_msg_no,"556N02")==0)
          {
          	strcpy((*p_STAT_VAL)[2].link_tag,"C");
          	strcpy((*p_STAT_VAL)[3].link_tag,"PAYMENT ");
          	strcpy((*p_STAT_VAL)[4].link_tag,APL_NULL_STRING);
          	strcpy((*p_STAT_VAL)[5].link_val,"ENTPAYIND");
          	strcpy((*p_STAT_VAL)[5].link_tag,"02");
          }
          if(strcmp(p_msg_no,"556C01")==0)
          {
          	strcpy((*p_STAT_VAL)[2].link_tag,"C");
          	strcpy((*p_STAT_VAL)[3].link_tag,"ENTITLEMENT CHANGE ");
          	strcpy((*p_STAT_VAL)[4].link_tag,APL_NULL_STRING);
          	strcpy((*p_STAT_VAL)[5].link_val,"ENTPAYIND");
          	strcpy((*p_STAT_VAL)[5].link_tag,"01");
          }
          if(strcmp(p_msg_no,"556R01")==0)
          {
          	strcpy((*p_STAT_VAL)[2].link_tag,"D");
          	strcpy((*p_STAT_VAL)[3].link_tag,"ENTITLEMENT REVERSAL ");
          	strcpy((*p_STAT_VAL)[4].link_tag,APL_NULL_STRING);
          	strcpy((*p_STAT_VAL)[5].link_val,"ENTPAYIND");
          	strcpy((*p_STAT_VAL)[5].link_tag,"01");
          }
          if(strcmp(p_msg_no,"556R02")==0)
          {
          	strcpy((*p_STAT_VAL)[2].link_tag,"D");
          	strcpy((*p_STAT_VAL)[3].link_tag,"PAYMENT REVERSAL ");
          	strcpy((*p_STAT_VAL)[4].link_tag,APL_NULL_STRING);
          	strcpy((*p_STAT_VAL)[5].link_val,"ENTPAYIND");
          	strcpy((*p_STAT_VAL)[5].link_tag,"02");
          }
          strcpy((*p_STAT_VAL)[6].link_val,"NATION");
          strcpy((*p_STAT_VAL)[6].link_tag,h_nation_code);

			
			strcpy((*p_STAT_VAL)[7].link_val,"SEQNUM_PAY");
			strcpy((*p_STAT_VAL)[7].link_tag,chr_l_refno);
			 

			 
          strcpy((*p_STAT_VAL)[8].link_val,"CNTRY_BIC");
          strcpy((*p_STAT_VAL)[8].link_tag,l_mt_message_sys_params_struct_h.swift_cd);
			 

          strcpy((*p_STAT_VAL)[9].link_val,"");
          strcpy((*p_STAT_VAL)[9].link_tag,"");
	
          strcpy((*p_SEL_VAL)[0].link_val,"RES_INSTR_CODE");
          strcpy((*p_SEL_VAL)[1].link_val,"FTYPEOFINSTR");
          strcpy((*p_SEL_VAL)[2].link_val,"NOMINAL_VALUE");
          strcpy((*p_SEL_VAL)[3].link_val,"CA_EVENT");
          strcpy((*p_SEL_VAL)[4].link_val,"CLIENT");
          strcpy((*p_SEL_VAL)[5].link_val,"TEVENTID");
          strcpy((*p_SEL_VAL)[6].link_val,"LENTNOTE_NO"); 
          strcpy((*p_SEL_VAL)[7].link_val,"INSTR_CODE");
          strcpy((*p_SEL_VAL)[8].link_val,"INSTR_TYPE");
          strcpy((*p_SEL_VAL)[9].link_val,"NEGPOSN"); 

			 

          strcpy((*p_SEL_VAL)[10].link_val,"CORP_ID");
          strcpy((*p_SEL_VAL)[11].link_val,"NEW_FMTFLG");
          strcpy((*p_SEL_VAL)[12].link_val,"NEW_NOMVAL");
			 strcpy((*p_SEL_VAL)[13].link_val,"EARNINGS");
               (*p_SEL_VAL)[13].NUM_VAL = 0.0;
          strcpy((*p_SEL_VAL)[14].link_val,"EARNINGS_RATE"); /*Change by VaibhavK Kotak 17Jan2008 INSTR_INC_RATE to
	  EARNINGS_RATE */
               (*p_SEL_VAL)[14].NUM_VAL = 0.0;
          strcpy((*p_SEL_VAL)[15].link_val,"CURRMSGREFNO");   
          strcpy((*p_SEL_VAL)[16].link_val,"PART_REDEM");
          strcpy((*p_SEL_VAL)[17].link_val,"OP_EVT_CLASS");
          strcpy((*p_SEL_VAL)[18].link_val,"");
          strcpy((*p_SEL_VAL)[18].link_tag,""); 

	  strcpy(chr_l_sel_msg_stmt,"select ");
			 if((strcmp(p_msg_no,"556N02")==0 || strcmp(p_msg_no,"556R02")==0) && (strcmp(l_event_class,"PO")==0))
			 {
				strcat(chr_l_sel_msg_stmt,"to_char(round((d.put_call_value),2)) as CURR_PYMT,d.put_call_rate,d.put_call_qty, ");
				strcat(chr_l_sel_msg_stmt,"c.currency_cd as CCYCURR_PYMT,c.currency_cd as CCYPUT_CALL_RATE,");
				strcat(chr_l_sel_msg_stmt,"'12' as DECCURR_PYMT,'12' as DECPUT_CALL_RATE,");
				strcat(chr_l_sel_msg_stmt,"c.currency_cd as CCYPUT_CALL_QTY,");
				strcat(chr_l_sel_msg_stmt,"'12' as DECPUT_CALL_QTY,");

			 }
			 else if((strcmp(p_msg_no,"556N02")==0 || strcmp(p_msg_no,"556R02")==0) && (strcmp(l_event_class,"PO")!=0))
          {
	  		strcat(chr_l_sel_msg_stmt,"to_char(round((d.curr_pymt - trunc(trunc(d.curr_pymt)*(d.tax_rate/100))),2)) as RNET_AMT,");
	  		strcat(chr_l_sel_msg_stmt,"to_char(round((d.curr_pymt * (100-d.TAX_RATE)/100),2)) as NET_AMT,");
	  		strcat(chr_l_sel_msg_stmt,"to_char(round((d.curr_pymt - d.TAX_AMOUNT),2)) as FNET_AMT,");
	  		strcat(chr_l_sel_msg_stmt,"round(d.TAX_AMOUNT,2) as TTAX_AMT,");
	  		strcat(chr_l_sel_msg_stmt,"to_char(trunc(d.TAX_AMOUNT)) as RTTAX_AMT,");
	  		strcat(chr_l_sel_msg_stmt,"d.curr_pymt,");
          strcat(chr_l_sel_msg_stmt,"c.currency_cd as CCYNET_AMT,");
          strcat(chr_l_sel_msg_stmt,"c.currency_cd as CCYRTAX_AMT,");
          strcat(chr_l_sel_msg_stmt,"c.currency_cd as CCYFTAX_AMT,");
          strcat(chr_l_sel_msg_stmt,"c.currency_cd as CCYFRTAX_AMT,");
          strcat(chr_l_sel_msg_stmt,"c.currency_cd as CCYTAX_AMT,");
          strcat(chr_l_sel_msg_stmt,"c.currency_cd as CCYRNET_AMT,");
          strcat(chr_l_sel_msg_stmt,"c.currency_cd as CCYFNET_AMT,");
          }
	  strcat(chr_l_sel_msg_stmt,"substr(concat(a.instr_code,concat(concat(to_char(to_date(a.DECLARE_DT),'YY'),lpad(((to_date(a.DECLARE_DT) - to_date(concat(concat('01/01/',to_char(a.DECLARE_DT,'YYYY')),' 12:00:00')))+1),3,'0')),lpad(substr(to_char(a.EVNT_INDNT),1,2),2,'0'))),1,16) as TEVENTID,");
	  strcat(chr_l_sel_msg_stmt,"b.cln_code,b.cln_code as CLIENT,substr(replace(replace(b.cln_name,chr(13),NULL),chr(10),NULL),1,35) as CLNT_NAME,");
	  strcat(chr_l_sel_msg_stmt,"concat('/',b.cln_code) as NACCOUNT,'");
	  strcat(chr_l_sel_msg_stmt,chr_new_ca_unique_ref_num);    
	  strcat(chr_l_sel_msg_stmt,"' as CURRMSGREFNO,decode(c.INSTR_TYPE,'BON',decode(b.CLN_FMT_RPTIND,'Y','FMT'");
	  strcat(chr_l_sel_msg_stmt,",c.INSTR_TYPE),c.INSTR_TYPE) as FTYPEOFINSTR,");
    /*Nikhil for including OP_EVT_CLASS in Entl Msgs for RD event*/
    strcat(chr_l_sel_msg_stmt,"a.OP_EVT_CLASS as OP_EVT_CLASS,  ");
   	
		  if((strcmp(p_msg_no,"556N02")==0 || strcmp(p_msg_no,"556R02")==0) && (strcmp(l_event_class,"PO")==0))
			{
      strcat(chr_l_sel_msg_stmt,"to_char(decode(nvl(a.EARNINGS,0),0,(decode(nvl(a.EARNINGS_RATE,0),0,0,to_char((d.AVL_QTY)*c.NOMINAL_VALUE))),to_char((d.AVL_QTY)))) as FENT_POS,");
			}
		  else if((strcmp(p_msg_no,"556N02")==0 || strcmp(p_msg_no,"556R02")==0) && (strcmp(l_event_class,"PO")!=0))
      {
       /* Change by VaibhavK Kotak 12Jan2008 Nominal Value replace by (c.NOMINAL_VALUE+a.redem_rt) */
      strcat(chr_l_sel_msg_stmt,"to_char(decode(nvl(a.EARNINGS,0),0,(decode(nvl(a.EARNINGS_RATE,0),0,0,to_char((e.ELIG_ENTITL_POS)*(c.NOMINAL_VALUE+a.redem_rt)))),to_char((e.ELIG_ENTITL_POS)))) as FENT_POS,");
         strcat(chr_l_sel_msg_stmt,"to_char(decode(nvl(a.EARNINGS,0),0,(decode(nvl(a.EARNINGS_RATE,0),0,0,to_char(abs(d.quantity_paid)*(c.NOMINAL_VALUE+a.redem_rt)))),to_char(abs(d.quantity_paid)))) as NEW_QTY_PAID,");      
      }
		  else
		  {
			
			/*Added by Anjaneyulu on 21/09/2015 for ISKB_1621 FENT_POS=0 - Starts*/
			if(strcmp(p_msg_no,"556C01") == 0)
			{
				EXEC SQL SELECT NVL(ELIG_ENTITL_POS,0) INTO :l_elig_pos FROM CAENTITLEMENT WHERE CORP_ID = :chr_l_ca_id 
					AND CLIENT = :l_ms_msgent_structa_a.client;
			IS_ANY_ORA_ERROR
			}
			if((APL_DOUBLE_EQUAL(l_elig_pos,0)) && (strcmp(p_msg_no,"556C01") == 0))
			{
				strcat(chr_l_sel_msg_stmt,"(SELECT TO_CHAR(DECODE(a.EARNINGS,0,(DECODE(a.EARNINGS_RATE,0,0,TO_CHAR((r.PREV_ELIG_HOLD)*c.NOMINAL_VALUE))),TO_CHAR((r.PREV_ELIG_HOLD)))) FROM CA_REV_ENTITLE r,  CAENTITLEMENT e,mt_instrument c,caevent a  WHERE e.corp_id=r.corp_id and e.client=r.client   and a.corp_id=r.corp_id and a.instr_code=c.instr_code  and r.CORP_ID ='");
				strcat(chr_l_sel_msg_stmt,chr_l_ca_id);
				strcat(chr_l_sel_msg_stmt,"' AND r.CLIENT ='");
				
				strcat(chr_l_sel_msg_stmt,l_ms_msgent_structa_a.client);
				strcat(chr_l_sel_msg_stmt,"') as FENT_POS,");
		
			}
		/*Added by Anjaneyulu on 21/09/2015 for ISKB_1621 FENT_POS=0 - Ends*/
			else
			{
      		strcat(chr_l_sel_msg_stmt,"to_char(decode(nvl(a.EARNINGS,0),0,(decode(nvl(a.EARNINGS_RATE,0),0,0,to_char((e.ELIG_ENTITL_POS)*c.NOMINAL_VALUE))),to_char((e.ELIG_ENTITL_POS)))) as FENT_POS,");
		  }
		  }
    /* For Redemption event 35B tag shld show orig nominal val. ie before updated one Chirag 09012008 */ 
	 if(strcmp(p_msg_no,"556N02")==0 && strcmp(l_event_class,"PO")!=0) 
		{
	  strcat(chr_l_sel_msg_stmt,"c.INSTR_TYPE,(c.NOMINAL_VALUE+a.redem_rt) as NOMINAL_VALUE,c.instr_code,a.INFO_SEQ as LENTNOTE_NO, ");
		}
		else
		{
	  strcat(chr_l_sel_msg_stmt,"c.INSTR_TYPE,c.NOMINAL_VALUE,c.instr_code,a.INFO_SEQ as LENTNOTE_NO, ");
		}
    /* For Redemption event 35B tag shld show orig nominal val. ie before updated one Chirag 09012008 */ 
	  strcat(chr_l_sel_msg_stmt,"b.CLN_USE_ISIN_IND as FLGISIN,");
          strcat(chr_l_sel_msg_stmt,"c.currency_cd as CCYTEARNINGS,");
          strcat(chr_l_sel_msg_stmt,"c.currency_cd as CCYINSTR_INC_BAL,");
          if((strcmp(p_msg_no,"556N02")==0 || strcmp(p_msg_no,"556R02")==0) && (strcmp(l_event_class,"PO")!=0))
          {
          strcat(chr_l_sel_msg_stmt,"substr(concat(d.corp_id,d.SEQNUM_PAY),1,22) as PROC_INIT,");
	  strcat(chr_l_sel_msg_stmt,"to_char(round((trunc(trunc(d.curr_pymt)*(d.tax_rate/100))),2)) as RTAX_AMT,");
	  strcat(chr_l_sel_msg_stmt,"to_char(round((d.curr_pymt * d.tax_rate/100),2)) as FTAX_AMT, decode(d.TAX_AMOUNT,0,NULL,decode(d.TAX_AMOUNT,NULL,NULL,d.TAX_AMOUNT)) as TAX_AMOUNT, to_char(trunc(d.TAX_AMOUNT)) as FRTAX_AMT,");
	  strcat(chr_l_sel_msg_stmt,"to_char(round((d.curr_pymt - trunc(trunc(d.curr_pymt)*(d.tax_rate/100))),2)) as RNET_AMT,");
	  strcat(chr_l_sel_msg_stmt,"to_char(round((d.curr_pymt * (100-d.TAX_RATE)/100),2)) as NET_AMT,to_char(round((d.curr_pymt - d.TAX_AMOUNT),2)) as FNET_AMT,");
	  strcat(chr_l_sel_msg_stmt,"b.CLN_GL_ACCOUNT,substr(replace(replace(d.PAYMENT_INFO,chr(13),NULL),chr(10),NULL),1,35) as PAYMENT_INFO, c.TAXONMAT_IND as TAXONMAT_IND,");
	  strcat(chr_l_sel_msg_stmt,"substr(to_char(d.dateof_payment,'yymmdd'),1,6) as PAYMENT_DT, ");
     strcat(chr_l_sel_msg_stmt,"to_char(NVL(d.TAX_RATE,0)) as TAX_RATE, "); 
	  strcat(chr_l_sel_msg_stmt,"'12' as DECTAX_RATE, ");	/*Added for TAXR fix*/
	  strcat(chr_l_sel_msg_stmt,"'12' as DECTAX_RT, ");	
          }
          else
          {
          strcat(chr_l_sel_msg_stmt,"a.corp_id as PROC_INIT,");
          }
	  strcat(chr_l_sel_msg_stmt,"c.INSTR_ISIN, c.currency_cd, concat('/',concat(concat(c.currency_cd,'/'),c.REG_BR_IND)) as SECCCY,");
	  strcat(chr_l_sel_msg_stmt,"substr(replace(replace(c.instr_name,chr(13),NULL),chr(10),NULL),1,35) as INSTR_NAME, substr(to_char(a.dateof_payment,'YYMMDD'),1,6) as dateof_payment,substr(to_char(a.dateof_payment,'DD-MM-YYYY'),1,10) as EM_DATEOF_PAYMENT,");
	  strcat(chr_l_sel_msg_stmt,"decode(c.INSTR_TYPE,'FMT','PCT',c.currency_cd) as IRTTYPE,decode(earnings,0,'0',NULL,'0',earnings) as EARNINGS, decode(earnings,0,'0',NULL,'0',earnings) as TEARNINGS,decode(EARNINGS_RATE,0,'0',NULL,'0',EARNINGS_RATE) as EARNINGS_RATE,decode(EARNINGS_RATE,0,'0',NULL,'0',EARNINGS_RATE) as R_EARNINGS,  "); 

		
		if(strcmp(h_nation_code,"RU")==0) 
		{
			strcat(chr_l_sel_msg_stmt,"'12' as DECTEARNINGS, '12' as DECR_EARNINGS, ");
		}
		else
		{
			strcat(chr_l_sel_msg_stmt,"'12' as DECTEARNINGS, '12' as DECR_EARNINGS, ");
		}
		if((strcmp(p_msg_no,"556N02")==0 || strcmp(p_msg_no,"556R02")==0) && (strcmp(l_event_class,"PO")==0))
		{
	  		strcat(chr_l_sel_msg_stmt,"to_char(abs(d.PUT_CALL_VALUE)) as INSTR_INC_BAL,");
	  		strcat(chr_l_sel_msg_stmt,"to_char(abs(d.AVL_QTY)) as ELIG_ENTITL_POS,");
	  		strcat(chr_l_sel_msg_stmt,"decode(d.AVL_QTY,abs(d.AVL_QTY),'N','Y') as NEGPOSN ,");
		}
		else
		{
	  		strcat(chr_l_sel_msg_stmt,"to_char(abs(e.INSTR_INC_BAL)) as INSTR_INC_BAL,");
	  		strcat(chr_l_sel_msg_stmt,"to_char(abs(e.ELIG_ENTITL_POS)) as ELIG_ENTITL_POS,");
	  		strcat(chr_l_sel_msg_stmt,"decode(e.ELIG_ENTITL_POS,abs(e.ELIG_ENTITL_POS),'N','Y') as NEGPOSN ,");
		}
	  strcat(chr_l_sel_msg_stmt,"substr(to_char(a.DECLARE_DT,'YYMMDD'),1,6) as DECLARE_DT,a.CA_EVENT,");
	  strcat(chr_l_sel_msg_stmt,"substr(to_char(a.DECLARE_DT,'DD-MM-YYYY'),1,10) as EM_DECLARE_DT,a.CA_EVENT,");
	  	
		
	  strcat(chr_l_sel_msg_stmt," b.CLN_TAXABLE_IND  as IND_83C83D ");
	  
	  strcat(chr_l_sel_msg_stmt, ", a.corp_id as CORP_ID "); 
		

 	  strcat(chr_l_sel_msg_stmt,",substr(to_char(a.DECLARE_DT,'YYYYMMDD'),1,8) as NEW_DECL_DT");
 	  strcat(chr_l_sel_msg_stmt,",substr(to_char(a.DECLARE_DT,'DD-MM-YYYY'),1,10) as EM_DECL_DT");
     strcat(chr_l_sel_msg_stmt,",substr(to_char(a.REC_DATE,'YYYYMMDD'),1,8) as NEW_REC_DT");
     strcat(chr_l_sel_msg_stmt,",substr(to_char(a.BC_FROM_DATE,'YYYYMMDD'),1,8) as NEW_BC_DT");
     strcat(chr_l_sel_msg_stmt,",substr(to_char(a.BC_FROM_DATE,'DD-MM-YYYY'),1,10) as EM_BC_DT");
     strcat(chr_l_sel_msg_stmt,",substr(to_char(a.EX_DATE,'YYYYMMDD'),1,8) as NEW_EX_DT");
     strcat(chr_l_sel_msg_stmt,",substr(to_char(a.dateof_payment,'YYYYMMDD'),1,8) as NEW_PAY_DT");
		if((strcmp(p_msg_no,"556N02")==0 || strcmp(p_msg_no,"556R02")==0) && (strcmp(l_event_class,"PO")==0))
		{
     strcat(chr_l_sel_msg_stmt,",substr(to_char(d.access_stamp,'YYYYMMDDHH24MISS'),1,14) as ACC_STMP");
		}
		else
		{
     strcat(chr_l_sel_msg_stmt,",substr(to_char(e.access_stamp,'YYYYMMDDHH24MISS'),1,14) as ACC_STMP");
		}

				
      
		if((strcmp(p_msg_no,"556N02")==0 || strcmp(p_msg_no,"556R02")==0) && (strcmp(l_event_class,"PO")==0))
		{
			strcat(chr_l_sel_msg_stmt,",substr(to_char(d.checker_dt,'YYYYMMDD'),1,8) as NEW_PAY_AUTH_DT");
			strcat(chr_l_sel_msg_stmt,",substr(to_char(d.value_date,'YYYYMMDD'),1,8) as NEW_VALUE_DATE");
			strcat(chr_l_sel_msg_stmt,",substr(to_char(d.notice_date,'YYYYMMDD'),1,8) as NEW_NOTICE_DATE");
		}
		else if((strcmp(p_msg_no,"556N02")==0 || strcmp(p_msg_no,"556R02")==0) && (strcmp(l_event_class,"PO")!=0))
		{
         strcat(chr_l_sel_msg_stmt,",substr(to_char(d.dateof_payment,'YYYYMMDD'),1,8) as NEW_PAYMENT_DT");
         strcat(chr_l_sel_msg_stmt,",substr(to_char(d.CHECKER_DT,'YYYYMMDD'),1,8) as NEW_PAY_AUTH_DT");
		}
			
	       strcat(chr_l_sel_msg_stmt,",decode(c.INSTR_TYPE,'BON',decode(b.CLN_FMT_RPTIND,'Y','Y'");
			 strcat(chr_l_sel_msg_stmt,",'N'),'N') as NEW_FMTFLG,");
			 strcat(chr_l_sel_msg_stmt,"c.NOMINAL_VALUE as NEW_NOMVAL ");
		  	
                
	    if((strcmp(p_msg_no, "556N01") ==0) || (strcmp(p_msg_no, "556N02") ==0) ||
			(strcmp(p_msg_no,"556C01") == 0) ||
 	    (strcmp(p_msg_no,"556R01") == 0) ||  (strcmp(p_msg_no,"556R02") == 0))
	    {
               /* VaibhavK Kotak 03/01/2008 Start */
			   
			   /*commented by Anjaneyulu on 21/09/2015 for ISKB_1621-Start*/
               /*if((strcmp(p_msg_no, "556N02") ==0)) 
               {
	       strcat(chr_l_sel_msg_stmt,", a.REDEM_RT as REDEM_RATE, c.currency_cd as CCYREDEM_RATE, decode(a.redem_rt ,(c.nominal_value+a.redem_rt),'N','Y') as PART_REDEM, ");
               }
               else
               { */
	       strcat(chr_l_sel_msg_stmt,", a.REDEM_RT as REDEM_RATE, c.currency_cd as CCYREDEM_RATE, decode(a.redem_rt ,c.nominal_value,'N','Y') as PART_REDEM, ");
               //}
			   /*commented by Anjaneyulu on 21/09/2015 for ISKB_1621-End*/
			   
               /* VaibhavK Kotak 03/01/2008 End */
	       strcat(chr_l_sel_msg_stmt,"'12' as DECREDEM_RATE,decode(a.EARNINGS, '0','PCT',NULL,'PCT',a.CA_CURRENCY)as RDIRTTYPE ");
	    }
	 

     
     strcat(chr_l_sel_msg_stmt," ,decode(a.WWWADDR,NULL,NULL,substr(WWWADDR,1,35)) as WEBB_ADD1");
     strcat(chr_l_sel_msg_stmt," ,decode(a.WWWADDR,NULL,NULL,substr(WWWADDR,36,35)) as WEBB_ADD2");
     strcat(chr_l_sel_msg_stmt," ,decode(a.WWWADDR,NULL,NULL,substr(WWWADDR,71,35)) as WEBB_ADD3");
     
		
     strcat(chr_l_sel_msg_stmt," ,a.REQD_CERTIFY as REQD_CERTIFY ");
	  strcat(chr_l_sel_msg_stmt," from CAEVENT a,MT_CLIENT b,MT_INSTRUMENT c");
			 if ((strcmp(p_msg_no,"556N02")==0 || strcmp(p_msg_no,"556R02")==0) && (strcmp(l_event_class,"PO")==0))
			 {
             strcat(chr_l_sel_msg_stmt,",ca_putcall_app  d ");
			 }
			 else if ((strcmp(p_msg_no,"556N02")==0 || strcmp(p_msg_no,"556R02")==0) && (strcmp(l_event_class,"PO")!=0))
             strcat(chr_l_sel_msg_stmt,",CAENTITLEMENT e ,CACHEQUE d ");
			 else if ((strcmp(p_msg_no,"556N02")!=0 && strcmp(p_msg_no,"556R02")!=0) )
             strcat(chr_l_sel_msg_stmt,",CAENTITLEMENT e  ");
				 

	  strcat(chr_l_sel_msg_stmt," where a.instr_code = c.instr_code and a.corp_id = '");
	  strcat(chr_l_sel_msg_stmt,chr_l_ca_id);
	  strcat(chr_l_sel_msg_stmt,"' ");

			 if ((strcmp(p_msg_no,"556N02")==0 || strcmp(p_msg_no,"556R02")==0) && (strcmp(l_event_class,"PO")==0))
			 {
				/*strcat(chr_l_sel_msg_stmt," and a.instr_code=d.instr_code and d.cln_code = e.client and d.cln_code = b.cln_code and d.notice_date='"); */
				strcat(chr_l_sel_msg_stmt," and a.instr_code=d.instr_code and d.cln_code = b.cln_code and d.notice_date='");
				strcat(chr_l_sel_msg_stmt,l_notice_date);
				strcat(chr_l_sel_msg_stmt,"' ");
			 }
			 else if ((strcmp(p_msg_no,"556N02")==0 || strcmp(p_msg_no,"556R02")==0) && (strcmp(l_event_class,"PO")!=0))
          {
	  				strcat(chr_l_sel_msg_stmt," and a.corp_id = d.corp_id and d.client = e.client and d.client = b.cln_code and d.SEQNUM_PAY = '");
                strcat(chr_l_sel_msg_stmt,chr_l_refno);
                strcat(chr_l_sel_msg_stmt,"' ");
	  				strcat(chr_l_sel_msg_stmt," and a.corp_id = e.corp_id  and b.cln_code = e.client ");
          }
			 else
			 {
	  				strcat(chr_l_sel_msg_stmt," and a.corp_id = e.corp_id  and b.cln_code = e.client ");
			 } 

          if((strlen(l_ms_msgent_structa_a.client))!=0)
          {
          	strcat(chr_l_sel_msg_stmt," and b.cln_code = '");
                strcat(chr_l_sel_msg_stmt,l_ms_msgent_structa_a.client);
          	strcat(chr_l_sel_msg_stmt,"'");
          }
          else
          {
          if(strcmp(p_msg_no,"556N02")==0 || strcmp(p_msg_no,"556R02")==0)
          {

					APL_DATA_MISSING("CLIENT", APL_NULL_STRING, APL_NULL_STRING)
                APL_GOBACK_FAIL
          }
          }

          strcat(chr_l_sel_msg_stmt," and b.STATUS != '");
          strcat(chr_l_sel_msg_stmt,STATUS_CLS_AUTH);
          strcat(chr_l_sel_msg_stmt,"' ");
          if((strcmp(p_msg_no,"556N02")==0 || strcmp(p_msg_no,"556R02")==0) && (strcmp(l_event_class,"PO")!=0))
			 {
         	strcat(chr_l_sel_msg_stmt," and d.rowid NOT IN (select d.rowid from MS_MSGSTAT where client = d.client and proc_init = concat(d.corp_id,d.SEQNUM_PAY) ");

         	if(strcmp(p_msg_no,"556N02")==0 )
         	{
            	strcat(chr_l_sel_msg_stmt," AND swift_msg_rep in ('556N02','566N08') )");
         	}
         	if(strcmp(p_msg_no,"556R02")==0 )
         	{
            	strcat(chr_l_sel_msg_stmt," AND swift_msg_rep in ('556R02','566R08') )");
         	}
         
			 }
	 
	  if(strcmp(p_msg_no,"556R01") == 0)
	  {
		strcat(chr_l_sel_msg_stmt," and b.cln_code IN (select client from MS_MSGSTAT where proc_init = '");
		strcat(chr_l_sel_msg_stmt,chr_l_ca_id);
		strcat(chr_l_sel_msg_stmt,"' and swift_msg_rep IN ('556N01','564N61','556C01','564C61'))");
	  }

        }
        
        if(strcmp(p_msg_no,"566N09") == 0)
        {
          l_msgaddr = MCORPACTIONSMSGNO;
          if(strlen(l_ms_msgent_structa_a.proc_init) != 0)
          {
             strcpy(chr_l_ca_id,l_ms_msgent_structa_a.proc_init);
          }
          else
          {
		APL_DATA_MISSING("CA ID", APL_NULL_STRING, APL_NULL_STRING)
                APL_GOBACK_FAIL
          }
          if(strlen(l_ms_msgent_structa_a.proc_data) != 0)
          {
             CO_SplitStr(l_ms_msgent_structa_a.proc_data,
                          ';', &int_noelem, &chr_l_param);
             strcpy(chr_l_refno,chr_l_param[0]);
          }
          else
          {
		APL_DATA_MISSING("Payment Srl Nbr", APL_NULL_STRING, APL_NULL_STRING)
                APL_GOBACK_FAIL
          }
			
          *p_STAT_VAL = realloc(*p_STAT_VAL,sizeof(MS_STATIC_VAL)*9); 

			 
          

			 
          *p_SEL_VAL = realloc(*p_SEL_VAL,sizeof(MS_STATIC_VAL)*18); 
			 

          strcpy((*p_STAT_VAL)[0].link_val,"DUMMY");
          strcpy((*p_STAT_VAL)[0].link_tag,"DUMMY");
          strcpy((*p_STAT_VAL)[1].link_val,"DOMSEC");
          strcpy((*p_STAT_VAL)[1].link_tag,chr_h_dom_instr);
          strcpy((*p_STAT_VAL)[2].link_val,"DBCR");
          strcpy((*p_STAT_VAL)[3].link_val,"TITLE");
          strcpy((*p_STAT_VAL)[4].link_val,"TEXT");
         	strcpy((*p_STAT_VAL)[2].link_tag,"D");
         	strcpy((*p_STAT_VAL)[3].link_tag,"PAYMENT NEW ");
         	strcpy((*p_STAT_VAL)[4].link_tag,APL_NULL_STRING);
          strcpy((*p_STAT_VAL)[5].link_val,"NATION");
          strcpy((*p_STAT_VAL)[5].link_tag,h_nation_code);
				strcpy((*p_STAT_VAL)[6].link_val,"SEQNUM_PAY");
				strcpy((*p_STAT_VAL)[6].link_tag,chr_l_refno);
			
          strcpy((*p_STAT_VAL)[7].link_val,"CNTRY_BIC");		
          strcpy((*p_STAT_VAL)[7].link_tag,l_mt_message_sys_params_struct_h.swift_cd);
          strcpy((*p_STAT_VAL)[8].link_val,"");
          strcpy((*p_STAT_VAL)[8].link_tag,"");
	
          strcpy((*p_SEL_VAL)[0].link_val,"RES_INSTR_CODE");
          strcpy((*p_SEL_VAL)[1].link_val,"DUMMY");
          strcpy((*p_SEL_VAL)[2].link_val,"DUMMY");
          strcpy((*p_SEL_VAL)[3].link_val,"CA_EVENT");
          strcpy((*p_SEL_VAL)[4].link_val,"INSTR_CODE");
          strcpy((*p_SEL_VAL)[5].link_val,"TEVENTID");
          strcpy((*p_SEL_VAL)[6].link_val,"LENTNOTE_NO");
          strcpy((*p_SEL_VAL)[7].link_val,"DUMMY");
          strcpy((*p_SEL_VAL)[8].link_val,"INSTR_TYPE");

			 

          strcpy((*p_SEL_VAL)[9].link_val,"CLIENT");
          strcpy((*p_SEL_VAL)[9].link_tag,"");
          strcpy((*p_SEL_VAL)[10].link_val,"CORP_ID");
			 
          strcpy((*p_SEL_VAL)[11].link_val,"OP_EVT_CLASS");
          strcpy((*p_SEL_VAL)[12].link_val,"SUB_NEW_QUANTITY"); 
          strcpy((*p_SEL_VAL)[13].link_val,"SUB_BASE_QUANTITY"); 
          strcpy((*p_SEL_VAL)[14].link_val,"PROC_OTH"); 
          strcpy((*p_SEL_VAL)[15].link_val,"QUANTITY_RECEIVED");
          strcpy((*p_SEL_VAL)[16].link_val,"CURRMSGREFNO");
          strcpy((*p_SEL_VAL)[17].link_val,"");
          strcpy((*p_SEL_VAL)[17].link_tag,"");
			 
          EXEC SQL SELECT OP_EVT_CLASS,EXPIRY_DATE INTO :chr_l_op_event_type:i_op_evt_class,:chr_l_expire_dt:i_expire_date FROM CAEVENT WHERE CORP_ID = :chr_l_ca_id;
          IS_ANY_ORA_ERROR
          if (i_op_evt_class == -1)
             strcpy(chr_l_op_event_type," ");

	  if (i_expire_date == -1)
	     strcpy(chr_l_expire_dt,APL_NULL_STRING);

	  strcpy(chr_l_sel_msg_stmt,"select ");
	  strcat(chr_l_sel_msg_stmt,"a.instr_code,");
	  strcat(chr_l_sel_msg_stmt,"substr(to_char(a.DECLARE_DT,'YYMMDD'),1,6) as DECLARE_DT,");
	  strcat(chr_l_sel_msg_stmt,"substr(to_char(a.DECLARE_DT,'DD-MM-YYYY'),1,10) as EM_DECLARE_DT,");
	  strcat(chr_l_sel_msg_stmt,"a.CA_EVENT ,");
	  strcat(chr_l_sel_msg_stmt,"a.EVNT_INDNT,");
	  strcat(chr_l_sel_msg_stmt,"c.INSTR_ISIN,");
	  strcat(chr_l_sel_msg_stmt,"concat('/',b.cln_code) as NACCOUNT,b.cln_code,b.cln_code as CLIENT,");
	  strcat(chr_l_sel_msg_stmt,"substr(replace(replace(b.cln_name,chr(13),NULL),chr(10),NULL),1,35) as CLNT_NAME,");
	  strcat(chr_l_sel_msg_stmt,"concat('/',concat(concat(c.currency_cd,'/ '),c.REG_BR_IND)) as SECCCY,");
	  strcat(chr_l_sel_msg_stmt,"substr(replace(replace(c.instr_name,chr(13),NULL),chr(10),NULL),1,35) as INSTR_NAME,");
	  strcat(chr_l_sel_msg_stmt,"substr(to_char(a.EX_DATE,'YYMMDD'),1,6) as EX_DATE,");
	  strcat(chr_l_sel_msg_stmt,"substr(to_char(a.EX_DATE,'DD-MM-YYYY'),1,10) as EM_EX_DATE,");
	  strcat(chr_l_sel_msg_stmt,"substr(to_char(a.REC_DATE,'YYMMDD'),1,6) as REC_DATE,");
	  strcat(chr_l_sel_msg_stmt,"substr(to_char(a.REC_DATE,'DD-MM-YYYY'),1,10) as EM_REC_DATE,");
	  strcat(chr_l_sel_msg_stmt,"substr(to_char(a.BC_FROM_DATE,'YYMMDD'),1,6) as BC_DATE,");
          /* VaibhavK 16Feb2008 Adding Expiry Date and Response DeadLine Date........ I-Solve:662,664 Start */  
          strcat(chr_l_sel_msg_stmt,"substr(to_char(a.EXPIRY_DATE,'YYYYMMDD'),1,8) as NEW_EXPIRE_DT,");
          strcat(chr_l_sel_msg_stmt,"substr(to_char(a.RESPONSE_DATE,'YYYYMMDDhh24miss'),1,14) as NEW_RESPONS_DT,");
          /* VaibhavK 16Feb2008 Adding Expiry Date and Response DeadLine Date........I-Solve:662,664 End */
	  strcat(chr_l_sel_msg_stmt,"substr(to_char(a.dateof_payment,'YYMMDD'),1,6) as dateof_payment,");
	  strcat(chr_l_sel_msg_stmt,"substr(to_char(a.dateof_payment,'DD-MM-YYYY'),1,10) as EM_DATEOF_PAYMENT,");
	  strcat(chr_l_sel_msg_stmt,"substr(to_char(d.checker_dt,'YYMMDD'),1,6) as PAYMENT_DT,");
	  strcat(chr_l_sel_msg_stmt,"decode(d.amt_payable,0,NULL,d.amt_payable) as AMT_PAYABLE,");
	  strcat(chr_l_sel_msg_stmt,"substr(concat(a.instr_code,concat(concat(to_char(to_date(a.DECLARE_DT),'YY'),lpad(((to_date(a.DECLARE_DT) - to_date(concat(concat('01/01/',to_char(a.DECLARE_DT,'YYYY')),' 12:00:00')))+1),3,'0')),lpad(substr(to_char(a.EVNT_INDNT),1,2),2,'0'))),1,16) as TEVENTID,");
	  strcat(chr_l_sel_msg_stmt,"decode(c.INSTR_TYPE,'BON',decode(b.CLN_FMT_RPTIND,'Y','FMT'");
	  strcat(chr_l_sel_msg_stmt,",c.INSTR_TYPE),c.INSTR_TYPE) as FTYPEOFINSTR,");
	  
	  strcat(chr_l_sel_msg_stmt,"decode(c.INSTR_TYPE,'BON',decode(b.CLN_FMT_RPTIND,'Y',to_char(d.AVL_QTY*c.NOMINAL_VALUE),d.AVL_QTY),d.AVL_QTY) as FENT_POS,");
   strcat(chr_l_sel_msg_stmt,"decode(c.INSTR_TYPE,'BON',decode(b.CLN_FMT_RPTIND,'Y',to_char(d.applied_qty*c.NOMINAL_VALUE),d.applied_qty),d.applied_qty) as NEW_QTY_PAID,");     
	  strcat(chr_l_sel_msg_stmt,"c.currency_cd,c.INSTR_TYPE,");
	  strcat(chr_l_sel_msg_stmt,"d.applied_qty,");
/*
	  strcat(chr_l_sel_msg_stmt,"to_char(round((trunc(trunc(d.amt_payable)*(d.tax_rate/100))),2)) as RTAX_AMT,");
	  strcat(chr_l_sel_msg_stmt,"to_char(round((d.amt_payable * d.tax_rate/100),2)) as TAX_AMOUNT,");
	  strcat(chr_l_sel_msg_stmt,"to_char(round((d.amt_payable - trunc(trunc(d.amt_payable)*(d.tax_rate/100))),2)) as RNET_AMT,");
	  strcat(chr_l_sel_msg_stmt,"to_char(round((d.amt_payable * (100-d.TAX_RATE)/100),2)) as NET_AMT,");
*/
	  strcat(chr_l_sel_msg_stmt,"c.INSTR_ISIN,c.currency_cd,");
	  strcat(chr_l_sel_msg_stmt,"a.SUB_NEW_QUANTITY, a.SUB_BASE_QUANTITY,");
	  strcat(chr_l_sel_msg_stmt,"decode(a.SUB_PR,0,'0',NULL,'0',a.SUB_PR) as SUB_PR,");
/*
	  strcat(chr_l_sel_msg_stmt,"c.currency_cd as CCYCUR_PMT,");
	  strcat(chr_l_sel_msg_stmt,"c.currency_cd as CCYRNET_AMT,");
	  strcat(chr_l_sel_msg_stmt,"c.currency_cd as CCYNET_AMT,");
	  strcat(chr_l_sel_msg_stmt,"c.currency_cd as CCYRTAX_AMT,");
	  strcat(chr_l_sel_msg_stmt,"c.currency_cd as CCYTAX_AMT,");
	  strcat(chr_l_sel_msg_stmt,"substr(replace(replace(d.PAYMENT_INFO,chr(13),NULL),chr(10),NULL),1,35) as PAYMENT_INFO,");
*/
	  strcat(chr_l_sel_msg_stmt,"b.CLN_USE_ISIN_IND as FLGISIN,");
	  strcat(chr_l_sel_msg_stmt,"a.RES_INSTR_CODE,a.INFO_SEQ as LENTNOTE_NO,");
	  strcat(chr_l_sel_msg_stmt,"concat('/',b.CLN_GL_ACCOUNT) as GL_ACCOUNT,");
	  strcat(chr_l_sel_msg_stmt,"substr(concat(decode(a.NEW_SAFEK_QTY,NULL,'0',a.NEW_SAFEK_QTY),concat(':',decode(a.OLD_STK_QTY,NULL,'0',a.OLD_STK_QTY))),1,15) as RATIO,");
	  strcat(chr_l_sel_msg_stmt,"to_char(a.NEW_SAFEK_RT) as AE_RATE, ");
   strcat(chr_l_sel_msg_stmt,"substr(concat(d.corp_id,d.CLN_SRNO),1,22) as PROC_INIT ,");
			 
			 strcat(chr_l_sel_msg_stmt," b.CLN_TAXABLE_IND  as IND_83C83D ");
			 
      

         strcat(chr_l_sel_msg_stmt,",a.OLD_STK_QTY,a.NEW_SAFEK_QTY");
         strcat(chr_l_sel_msg_stmt,",substr(to_char(a.DECLARE_DT,'YYYYMMDD'),1,8) as NEW_DECL_DT");
         strcat(chr_l_sel_msg_stmt,",substr(to_char(a.DECLARE_DT,'DD-MM-YYYY'),1,10) as EM_DECL_DT");
         strcat(chr_l_sel_msg_stmt,",substr(to_char(a.REC_DATE,'YYYYMMDD'),1,8) as NEW_REC_DT");
         strcat(chr_l_sel_msg_stmt,",substr(to_char(a.BC_FROM_DATE,'YYYYMMDD'),1,8) as NEW_BC_DT");
         strcat(chr_l_sel_msg_stmt,",substr(to_char(a.BC_FROM_DATE,'DD-MM-YYYY'),1,10) as EM_BC_DT");
         strcat(chr_l_sel_msg_stmt,",substr(to_char(a.EX_DATE,'YYYYMMDD'),1,8) as NEW_EX_DT");
         strcat(chr_l_sel_msg_stmt,",substr(to_char(a.dateof_payment,'YYYYMMDD'),1,8) as NEW_PAY_DT");
         strcat(chr_l_sel_msg_stmt,",substr(to_char(d.checker_dt,'YYYYMMDD'),1,8) as NEW_PAYMENT_DT");
         strcat(chr_l_sel_msg_stmt,",substr(to_char(d.access_stamp,'YYYYMMDD'),1,8) as NEW_PAY_AUTH_DT");
         strcat(chr_l_sel_msg_stmt,",'12' as DECRATE"); 
         strcat(chr_l_sel_msg_stmt,",substr(to_char(d.access_stamp,'YYYYMMDDHH24MISS'),1,14) as PREPDATE");
         strcat(chr_l_sel_msg_stmt,",substr(to_char(d.access_stamp,'YYYYMMDD'),1,8) as NEW_PAY_AUTH_DT");
         
		strcat(chr_l_sel_msg_stmt, ", b.CLN_FRACT_IND as FRACT_IND, '");  	
		strcat(chr_l_sel_msg_stmt, chr_l_keep_fract_temp);
     	strcat(chr_l_sel_msg_stmt, "' as FRACT_COND");

		strcat(chr_l_sel_msg_stmt, ", a.corp_id as CORP_ID "); 
     
     
     strcat(chr_l_sel_msg_stmt, ", a.FRACT_PR ,a.OP_EVT_CLASS, a.DISP_OF_FRACT ");

	  
      strcat(chr_l_sel_msg_stmt," ,a.REQD_CERTIFY as REQD_CERTIFY,c.nominal_value  "); 

	 	 strcat(chr_l_sel_msg_stmt," from CAEVENT a,MT_CLIENT b,MT_INSTRUMENT c,CA_APPLICATION d");
	  strcat(chr_l_sel_msg_stmt," where a.instr_code = c.instr_code and a.corp_id = '");
	  strcat(chr_l_sel_msg_stmt,chr_l_ca_id);
          strcat(chr_l_sel_msg_stmt,"' ");
          strcat(chr_l_sel_msg_stmt," and d.CLN_SRNO = '");
          strcat(chr_l_sel_msg_stmt,chr_l_refno);

	  
	 	 strcat(chr_l_sel_msg_stmt,"' and a.corp_id = d.corp_id and d.cln_code = b.cln_code ");
          if((strlen(l_ms_msgent_structa_a.client))!=0)
          {
          	strcat(chr_l_sel_msg_stmt,"and b.cln_code = '");
                strcat(chr_l_sel_msg_stmt,l_ms_msgent_structa_a.client);
          	strcat(chr_l_sel_msg_stmt,"'");
          }
          else
          {
		APL_DATA_MISSING("CLIENT", APL_NULL_STRING, APL_NULL_STRING)
                APL_GOBACK_FAIL
          }

         
         
       strcat(chr_l_sel_msg_stmt," and d.rowid NOT IN (select d.rowid from MS_MSGSTAT where client = d.cln_code and proc_init = concat(d.corp_id,d.CLN_SRNO) ");
            strcat(chr_l_sel_msg_stmt," AND swift_msg_rep in ('563N01','566N09') )");
         
          strcat(chr_l_sel_msg_stmt," and b.STATUS != '");
          strcat(chr_l_sel_msg_stmt,STATUS_CLS_AUTH);
          strcat(chr_l_sel_msg_stmt,"' ");
 
        }

        if(strcmp(p_msg_no,"566N19") == 0)
        {
          l_msgaddr = MCORPACTIONSMSGNO;
          if(strlen(l_ms_msgent_structa_a.proc_init) != 0)
          {
             strcpy(chr_l_ca_id,l_ms_msgent_structa_a.proc_init);
          }
          else
          {
		APL_DATA_MISSING("CA ID", APL_NULL_STRING, APL_NULL_STRING)
                APL_GOBACK_FAIL
          }
          if(strlen(l_ms_msgent_structa_a.proc_data) != 0)
          {
             CO_SplitStr(l_ms_msgent_structa_a.proc_data,
                          ';', &int_noelem, &chr_l_param);
             strcpy(chr_l_refno,chr_l_param[0]);
          }
          else
          {
		APL_DATA_MISSING("Payment Srl Nbr", APL_NULL_STRING, APL_NULL_STRING)
                APL_GOBACK_FAIL
          }
			
          *p_STAT_VAL = realloc(*p_STAT_VAL,sizeof(MS_STATIC_VAL)*9); 

			 
          

			 
          *p_SEL_VAL = realloc(*p_SEL_VAL,sizeof(MS_STATIC_VAL)*18); 
			 

          strcpy((*p_STAT_VAL)[0].link_val,"DUMMY");
          strcpy((*p_STAT_VAL)[0].link_tag,"DUMMY");
          strcpy((*p_STAT_VAL)[1].link_val,"DOMSEC");
          strcpy((*p_STAT_VAL)[1].link_tag,chr_h_dom_instr);
          strcpy((*p_STAT_VAL)[2].link_val,"DBCR");
          strcpy((*p_STAT_VAL)[3].link_val,"TITLE");
          strcpy((*p_STAT_VAL)[4].link_val,"TEXT");
         	strcpy((*p_STAT_VAL)[2].link_tag,"C");
         	strcpy((*p_STAT_VAL)[3].link_tag,"PAYMENT NEW ");
         	strcpy((*p_STAT_VAL)[4].link_tag,APL_NULL_STRING);
          strcpy((*p_STAT_VAL)[5].link_val,"NATION");
          strcpy((*p_STAT_VAL)[5].link_tag,h_nation_code);
				strcpy((*p_STAT_VAL)[6].link_val,"SEQNUM_PAY");
				strcpy((*p_STAT_VAL)[6].link_tag,chr_l_refno);
			
          strcpy((*p_STAT_VAL)[7].link_val,"CNTRY_BIC");		
          strcpy((*p_STAT_VAL)[7].link_tag,l_mt_message_sys_params_struct_h.swift_cd);
          strcpy((*p_STAT_VAL)[8].link_val,"");
          strcpy((*p_STAT_VAL)[8].link_tag,"");
	
          strcpy((*p_SEL_VAL)[0].link_val,"RES_INSTR_CODE");
          strcpy((*p_SEL_VAL)[1].link_val,"DUMMY");
          strcpy((*p_SEL_VAL)[2].link_val,"DUMMY");
          strcpy((*p_SEL_VAL)[3].link_val,"CA_EVENT");
          strcpy((*p_SEL_VAL)[4].link_val,"INSTR_CODE");
          strcpy((*p_SEL_VAL)[5].link_val,"TEVENTID");
          strcpy((*p_SEL_VAL)[6].link_val,"LENTNOTE_NO");
          strcpy((*p_SEL_VAL)[7].link_val,"DUMMY");
          strcpy((*p_SEL_VAL)[8].link_val,"INSTR_TYPE");

			 

          strcpy((*p_SEL_VAL)[9].link_val,"CLIENT");
          strcpy((*p_SEL_VAL)[9].link_tag,"");
          strcpy((*p_SEL_VAL)[10].link_val,"CORP_ID");
			 
          strcpy((*p_SEL_VAL)[11].link_val,"OP_EVT_CLASS");
          strcpy((*p_SEL_VAL)[12].link_val,"SUB_NEW_QUANTITY"); 
          strcpy((*p_SEL_VAL)[13].link_val,"SUB_BASE_QUANTITY"); 
          strcpy((*p_SEL_VAL)[14].link_val,"PROC_OTH"); 
          strcpy((*p_SEL_VAL)[15].link_val,"QUANTITY_RECEIVED");
          strcpy((*p_SEL_VAL)[16].link_val,"CURRMSGREFNO");
          strcpy((*p_SEL_VAL)[17].link_val,"");
          strcpy((*p_SEL_VAL)[17].link_tag,"");
			 
          EXEC SQL SELECT OP_EVT_CLASS,EXPIRY_DATE INTO :chr_l_op_event_type:i_op_evt_class,:chr_l_expire_dt:i_expire_date FROM CAEVENT WHERE CORP_ID = :chr_l_ca_id;
          IS_ANY_ORA_ERROR
          if (i_op_evt_class == -1)
             strcpy(chr_l_op_event_type," ");

	  if (i_expire_date == -1)
	     strcpy(chr_l_expire_dt,APL_NULL_STRING);

	  strcpy(chr_l_sel_msg_stmt,"select ");
	  strcat(chr_l_sel_msg_stmt,"a.instr_code,");
	  strcat(chr_l_sel_msg_stmt,"substr(to_char(a.DECLARE_DT,'YYMMDD'),1,6) as DECLARE_DT,");
	  strcat(chr_l_sel_msg_stmt,"substr(to_char(a.DECLARE_DT,'DD-MM-YYYY'),1,10) as EM_DECLARE_DT,");
	  strcat(chr_l_sel_msg_stmt,"a.CA_EVENT ,");
	  strcat(chr_l_sel_msg_stmt,"a.EVNT_INDNT,");
	  strcat(chr_l_sel_msg_stmt,"c.INSTR_ISIN,");
	  strcat(chr_l_sel_msg_stmt,"concat('/',b.cln_code) as NACCOUNT,b.cln_code,b.cln_code as CLIENT,");
	  strcat(chr_l_sel_msg_stmt,"substr(replace(replace(b.cln_name,chr(13),NULL),chr(10),NULL),1,35) as CLNT_NAME,");
	  strcat(chr_l_sel_msg_stmt,"concat('/',concat(concat(c.currency_cd,'/ '),c.REG_BR_IND)) as SECCCY,");
	  strcat(chr_l_sel_msg_stmt,"substr(replace(replace(c.instr_name,chr(13),NULL),chr(10),NULL),1,35) as INSTR_NAME,");
	  strcat(chr_l_sel_msg_stmt,"substr(to_char(a.EX_DATE,'YYMMDD'),1,6) as EX_DATE,");
	  strcat(chr_l_sel_msg_stmt,"substr(to_char(a.EX_DATE,'DD-MM-YYYY'),1,10) as EM_EX_DATE,");
	  strcat(chr_l_sel_msg_stmt,"substr(to_char(a.REC_DATE,'YYMMDD'),1,6) as REC_DATE,");
	  strcat(chr_l_sel_msg_stmt,"substr(to_char(a.REC_DATE,'DD-MM-YYYY'),1,6) as EM_REC_DATE,");
	  strcat(chr_l_sel_msg_stmt,"substr(to_char(a.BC_FROM_DATE,'YYMMDD'),1,6) as BC_DATE,");
	  strcat(chr_l_sel_msg_stmt,"substr(to_char(a.dateof_payment,'YYMMDD'),1,6) as dateof_payment,");
	  strcat(chr_l_sel_msg_stmt,"substr(to_char(a.dateof_payment,'DD-MM-YYYY'),1,10) as EM_DATEOF_PAYMENT,");
	  strcat(chr_l_sel_msg_stmt,"substr(to_char(d.checker_dt,'YYMMDD'),1,6) as PAYMENT_DT,");
	  strcat(chr_l_sel_msg_stmt,"decode(d.amt_rec,0,NULL,d.amt_rec) as AMT_REC,");
	  strcat(chr_l_sel_msg_stmt,"substr(concat(a.instr_code,concat(concat(to_char(to_date(a.DECLARE_DT),'YY'),lpad(((to_date(a.DECLARE_DT) - to_date(concat(concat('01/01/',to_char(a.DECLARE_DT,'YYYY')),' 12:00:00')))+1),3,'0')),lpad(substr(to_char(a.EVNT_INDNT),1,2),2,'0'))),1,16) as TEVENTID,");
	  strcat(chr_l_sel_msg_stmt,"decode(c.INSTR_TYPE,'BON',decode(b.CLN_FMT_RPTIND,'Y','FMT'");
	  strcat(chr_l_sel_msg_stmt,",c.INSTR_TYPE),c.INSTR_TYPE) as FTYPEOFINSTR,");
	  
	  /*strcat(chr_l_sel_msg_stmt,"decode(c.INSTR_TYPE,'BON',decode(b.CLN_FMT_RPTIND,'Y',to_char(e.ELIG_ENTITL_POS*c.NOMINAL_VALUE),e.ELIG_ENTITL_POS),e.ELIG_ENTITL_POS) as FENT_POS,");*/
	 /* strcat(chr_l_sel_msg_stmt,"decode(c.INSTR_TYPE,'BON',decode(b.CLN_FMT_RPTIND,'Y',to_char(max(e.AVL_QTY)*c.NOMINAL_VALUE),max(e.AVL_QTY)),max(e.AVL_QTY)) as FENT_POS,");*/
   strcat(chr_l_sel_msg_stmt,"decode(c.INSTR_TYPE,'BON',decode(b.CLN_FMT_RPTIND,'Y',to_char((d.alloted_qty + d.add_allot_qty)*c.NOMINAL_VALUE),(d.alloted_qty + d.add_allot_qty)),(d.alloted_qty + d.add_allot_qty)) as NEW_QTY_PAID,");     
	  strcat(chr_l_sel_msg_stmt,"c.currency_cd,c.INSTR_TYPE,");
	  strcat(chr_l_sel_msg_stmt,"d.alloted_qty as ALLOTED_QTY,");
	  strcat(chr_l_sel_msg_stmt,"d.add_allot_qty as ADD_ALLOT_QTY,");
	  strcat(chr_l_sel_msg_stmt,"(d.alloted_qty + d.add_allot_qty) as TOT_ALLOT_QTY,");
/*
	  strcat(chr_l_sel_msg_stmt,"to_char(round((trunc(trunc(d.amt_payable)*(d.tax_rate/100))),2)) as RTAX_AMT,");
	  strcat(chr_l_sel_msg_stmt,"to_char(round((d.amt_payable * d.tax_rate/100),2)) as TAX_AMOUNT,");
	  strcat(chr_l_sel_msg_stmt,"to_char(round((d.amt_payable - trunc(trunc(d.amt_payable)*(d.tax_rate/100))),2)) as RNET_AMT,");
	  strcat(chr_l_sel_msg_stmt,"to_char(round((d.amt_payable * (100-d.TAX_RATE)/100),2)) as NET_AMT,");
*/
	  strcat(chr_l_sel_msg_stmt,"c.INSTR_ISIN,c.currency_cd,");
/*
	  strcat(chr_l_sel_msg_stmt,"c.currency_cd as CCYCUR_PMT,");
	  strcat(chr_l_sel_msg_stmt,"c.currency_cd as CCYRNET_AMT,");
	  strcat(chr_l_sel_msg_stmt,"c.currency_cd as CCYNET_AMT,");
	  strcat(chr_l_sel_msg_stmt,"c.currency_cd as CCYRTAX_AMT,");
	  strcat(chr_l_sel_msg_stmt,"c.currency_cd as CCYTAX_AMT,");
	  strcat(chr_l_sel_msg_stmt,"substr(replace(replace(d.PAYMENT_INFO,chr(13),NULL),chr(10),NULL),1,35) as PAYMENT_INFO,");
*/
	  strcat(chr_l_sel_msg_stmt,"b.CLN_USE_ISIN_IND as FLGISIN,");
	  /*strcat(chr_l_sel_msg_stmt,"decode(a.RES_INSTR_CODE,NULL,a.RES_INSTR_CODE_2,a.RES_INSTR_CODE) as RES_INSTR_CODE,a.INFO_SEQ as LENTNOTE_NO,");*/
	  /*strcat(chr_l_sel_msg_stmt,"nvl(c.INSTR_PARENT,' ') as RES_INSTR_CODE,a.INFO_SEQ as LENTNOTE_NO,");*/
	  strcat(chr_l_sel_msg_stmt,"concat('/',b.CLN_GL_ACCOUNT) as GL_ACCOUNT,");
	  strcat(chr_l_sel_msg_stmt,"substr(concat(decode(a.NEW_SAFEK_QTY,NULL,'0',a.NEW_SAFEK_QTY),concat(':',decode(a.OLD_STK_QTY,NULL,'0',a.OLD_STK_QTY))),1,15) as RATIO,");
	  strcat(chr_l_sel_msg_stmt,"to_char(a.NEW_SAFEK_RT) as AE_RATE, ");
   strcat(chr_l_sel_msg_stmt,"substr(concat(d.corp_id,'");
   strcat(chr_l_sel_msg_stmt,l_ms_msgent_structa_a.proc_data);
   strcat(chr_l_sel_msg_stmt,"'),1,22) as PROC_INIT ,");
			 
			 strcat(chr_l_sel_msg_stmt," b.CLN_TAXABLE_IND  as IND_83C83D ");
			 
      

         strcat(chr_l_sel_msg_stmt,",a.OLD_STK_QTY,a.NEW_SAFEK_QTY");
         strcat(chr_l_sel_msg_stmt,",substr(to_char(a.DECLARE_DT,'YYYYMMDD'),1,8) as NEW_DECL_DT");
         strcat(chr_l_sel_msg_stmt,",substr(to_char(a.DECLARE_DT,'DD-MM-YYYY'),1,10) as EM_DECL_DT");
         strcat(chr_l_sel_msg_stmt,",substr(to_char(a.REC_DATE,'YYYYMMDD'),1,8) as NEW_REC_DT");
         strcat(chr_l_sel_msg_stmt,",substr(to_char(a.BC_FROM_DATE,'YYYYMMDD'),1,8) as NEW_BC_DT");
         strcat(chr_l_sel_msg_stmt,",substr(to_char(a.BC_FROM_DATE,'DD-MM-YYYY'),1,10) as EM_BC_DT");
         strcat(chr_l_sel_msg_stmt,",substr(to_char(a.EX_DATE,'YYYYMMDD'),1,8) as NEW_EX_DT");
         strcat(chr_l_sel_msg_stmt,",substr(to_char(a.dateof_payment,'YYYYMMDD'),1,8) as NEW_PAY_DT");
         strcat(chr_l_sel_msg_stmt,",substr(to_char(d.checker_dt,'YYYYMMDD'),1,8) as NEW_PAYMENT_DT");
         strcat(chr_l_sel_msg_stmt,",substr(to_char(d.access_stamp,'YYYYMMDD'),1,8) as NEW_PAY_AUTH_DT");
         strcat(chr_l_sel_msg_stmt,",'12' as DECRATE"); 
         strcat(chr_l_sel_msg_stmt,",substr(to_char(d.access_stamp,'YYYYMMDDHH24MISS'),1,14) as PREPDATE");
         strcat(chr_l_sel_msg_stmt,",substr(to_char(d.access_stamp,'YYYYMMDD'),1,8) as NEW_PAY_AUTH_DT");
	  		strcat(chr_l_sel_msg_stmt,",a.SUB_NEW_QUANTITY, a.SUB_BASE_QUANTITY");
			strcat(chr_l_sel_msg_stmt,",decode(a.SUB_PR,0,'0',NULL,'0',a.SUB_PR) as SUB_PR");
         
		strcat(chr_l_sel_msg_stmt, ", b.CLN_FRACT_IND as FRACT_IND, '");  	
		strcat(chr_l_sel_msg_stmt, chr_l_keep_fract_temp);
     	strcat(chr_l_sel_msg_stmt, "' as FRACT_COND");

		strcat(chr_l_sel_msg_stmt, ", a.corp_id as CORP_ID "); 
     
     
     strcat(chr_l_sel_msg_stmt, ", a.FRACT_PR ,a.OP_EVT_CLASS, a.DISP_OF_FRACT ");

	  
      strcat(chr_l_sel_msg_stmt," ,a.REQD_CERTIFY as REQD_CERTIFY,c.nominal_value  "); 

	 	 strcat(chr_l_sel_msg_stmt," from CAEVENT a,MT_CLIENT b,MT_INSTRUMENT c,CA_RTBB_ALLOTMENT d");
	  strcat(chr_l_sel_msg_stmt," where a.instr_code = c.instr_code and a.corp_id = '");
	  strcat(chr_l_sel_msg_stmt,chr_l_ca_id);
          strcat(chr_l_sel_msg_stmt,"' ");
          /*strcat(chr_l_sel_msg_stmt," and d.CLN_SRNO = '");
          strcat(chr_l_sel_msg_stmt,chr_l_refno);*/

	  
	 	 strcat(chr_l_sel_msg_stmt," and a.corp_id = d.corp_id and d.cln_code = b.cln_code ");
          if((strlen(l_ms_msgent_structa_a.client))!=0)
          {
          	strcat(chr_l_sel_msg_stmt,"and b.cln_code = '");
                strcat(chr_l_sel_msg_stmt,l_ms_msgent_structa_a.client);
          	strcat(chr_l_sel_msg_stmt,"'");
          }
          else
          {
		APL_DATA_MISSING("CLIENT", APL_NULL_STRING, APL_NULL_STRING)
                APL_GOBACK_FAIL
          }

         
        /* 
       strcat(chr_l_sel_msg_stmt," and d.rowid NOT IN (select d.rowid from MS_MSGSTAT where client = d.cln_code and proc_init = concat(d.corp_id,d.CLN_SRNO) ");
            strcat(chr_l_sel_msg_stmt," AND swift_msg_rep in ('566N19') )");
         */
          strcat(chr_l_sel_msg_stmt," and b.STATUS != '");
          strcat(chr_l_sel_msg_stmt,STATUS_CLS_AUTH);
          strcat(chr_l_sel_msg_stmt,"' ");
 
        }

        if(strcmp(p_msg_no,"566N29") == 0)
        {
          l_msgaddr = MCORPACTIONSMSGNO;
          if(strlen(l_ms_msgent_structa_a.proc_init) != 0)
          {
             strcpy(chr_l_ca_id,l_ms_msgent_structa_a.proc_init);
          }
          else
          {
		APL_DATA_MISSING("CA ID", APL_NULL_STRING, APL_NULL_STRING)
                APL_GOBACK_FAIL
          }
          if(strlen(l_ms_msgent_structa_a.proc_data) != 0)
          {
             CO_SplitStr(l_ms_msgent_structa_a.proc_data,
                          ';', &int_noelem, &chr_l_param);
             strcpy(chr_l_refno,chr_l_param[0]);
          }
          else
          {
		APL_DATA_MISSING("Payment Srl Nbr", APL_NULL_STRING, APL_NULL_STRING)
                APL_GOBACK_FAIL
          }
			
          *p_STAT_VAL = realloc(*p_STAT_VAL,sizeof(MS_STATIC_VAL)*9); 

			 
          

			 
          *p_SEL_VAL = realloc(*p_SEL_VAL,sizeof(MS_STATIC_VAL)*18); 
			 

          strcpy((*p_STAT_VAL)[0].link_val,"DUMMY");
          strcpy((*p_STAT_VAL)[0].link_tag,"DUMMY");
          strcpy((*p_STAT_VAL)[1].link_val,"DOMSEC");
          strcpy((*p_STAT_VAL)[1].link_tag,chr_h_dom_instr);
          strcpy((*p_STAT_VAL)[2].link_val,"DBCR");
          strcpy((*p_STAT_VAL)[3].link_val,"TITLE");
          strcpy((*p_STAT_VAL)[4].link_val,"TEXT");
         	strcpy((*p_STAT_VAL)[2].link_tag,"D");
         	strcpy((*p_STAT_VAL)[3].link_tag,"PAYMENT NEW ");
         	strcpy((*p_STAT_VAL)[4].link_tag,APL_NULL_STRING);
          strcpy((*p_STAT_VAL)[5].link_val,"NATION");
          strcpy((*p_STAT_VAL)[5].link_tag,h_nation_code);
				strcpy((*p_STAT_VAL)[6].link_val,"SEQNUM_PAY");
				strcpy((*p_STAT_VAL)[6].link_tag,chr_l_refno);
			
          strcpy((*p_STAT_VAL)[7].link_val,"CNTRY_BIC");		
          strcpy((*p_STAT_VAL)[7].link_tag,l_mt_message_sys_params_struct_h.swift_cd);
          strcpy((*p_STAT_VAL)[8].link_val,"");
          strcpy((*p_STAT_VAL)[8].link_tag,"");
	
          strcpy((*p_SEL_VAL)[0].link_val,"RES_INSTR_CODE");
          strcpy((*p_SEL_VAL)[1].link_val,"DUMMY");
          strcpy((*p_SEL_VAL)[2].link_val,"DUMMY");
          strcpy((*p_SEL_VAL)[3].link_val,"CA_EVENT");
          strcpy((*p_SEL_VAL)[4].link_val,"INSTR_CODE");
          strcpy((*p_SEL_VAL)[5].link_val,"TEVENTID");
          strcpy((*p_SEL_VAL)[6].link_val,"LENTNOTE_NO");
          strcpy((*p_SEL_VAL)[7].link_val,"DUMMY");
          strcpy((*p_SEL_VAL)[8].link_val,"INSTR_TYPE");

			 

          strcpy((*p_SEL_VAL)[9].link_val,"CLIENT");
          strcpy((*p_SEL_VAL)[9].link_tag,"");
          strcpy((*p_SEL_VAL)[10].link_val,"CORP_ID");
			 
          strcpy((*p_SEL_VAL)[11].link_val,"OP_EVT_CLASS");
          strcpy((*p_SEL_VAL)[12].link_val,"SUB_NEW_QUANTITY"); 
          strcpy((*p_SEL_VAL)[13].link_val,"SUB_BASE_QUANTITY"); 
          strcpy((*p_SEL_VAL)[14].link_val,"PROC_OTH"); 
          strcpy((*p_SEL_VAL)[15].link_val,"QUANTITY_RECEIVED");
          strcpy((*p_SEL_VAL)[16].link_val,"CURRMSGREFNO");
          strcpy((*p_SEL_VAL)[17].link_val,"");
          strcpy((*p_SEL_VAL)[17].link_tag,"");
			 
          EXEC SQL SELECT OP_EVT_CLASS,EXPIRY_DATE INTO :chr_l_op_event_type:i_op_evt_class,:chr_l_expire_dt:i_expire_date FROM CAEVENT WHERE CORP_ID = :chr_l_ca_id;
          IS_ANY_ORA_ERROR
          if (i_op_evt_class == -1)
             strcpy(chr_l_op_event_type," ");

	  if (i_expire_date == -1)
	     strcpy(chr_l_expire_dt,APL_NULL_STRING);

	  strcpy(chr_l_sel_msg_stmt,"select ");
	  strcat(chr_l_sel_msg_stmt,"a.instr_code,");
	  strcat(chr_l_sel_msg_stmt,"substr(to_char(a.DECLARE_DT,'YYMMDD'),1,6) as DECLARE_DT,");
	  strcat(chr_l_sel_msg_stmt,"substr(to_char(a.DECLARE_DT,'DD-MM-YYYY'),1,10) as EM_DECLARE_DT,");
	  strcat(chr_l_sel_msg_stmt,"a.CA_EVENT ,");
	  strcat(chr_l_sel_msg_stmt,"a.EVNT_INDNT,");
	  strcat(chr_l_sel_msg_stmt,"c.INSTR_ISIN,");
	  strcat(chr_l_sel_msg_stmt,"concat('/',b.cln_code) as NACCOUNT,b.cln_code,b.cln_code as CLIENT,");
	  strcat(chr_l_sel_msg_stmt,"substr(replace(replace(b.cln_name,chr(13),NULL),chr(10),NULL),1,35) as CLNT_NAME,");
	  strcat(chr_l_sel_msg_stmt,"concat('/',concat(concat(c.currency_cd,'/ '),c.REG_BR_IND)) as SECCCY,");
	  strcat(chr_l_sel_msg_stmt,"substr(replace(replace(c.instr_name,chr(13),NULL),chr(10),NULL),1,35) as INSTR_NAME,");
	  strcat(chr_l_sel_msg_stmt,"substr(to_char(a.EX_DATE,'YYMMDD'),1,6) as EX_DATE,");
	  strcat(chr_l_sel_msg_stmt,"substr(to_char(a.EX_DATE,'DD-MM-YYYY'),1,10) as EM_EX_DATE,");
	  strcat(chr_l_sel_msg_stmt,"substr(to_char(a.REC_DATE,'YYMMDD'),1,6) as REC_DATE,");
	  strcat(chr_l_sel_msg_stmt,"substr(to_char(a.REC_DATE,'DD-MM-YYYY'),1,10) as EM_REC_DATE,");
	  strcat(chr_l_sel_msg_stmt,"substr(to_char(a.BC_FROM_DATE,'YYMMDD'),1,6) as BC_DATE,");
	  strcat(chr_l_sel_msg_stmt,"substr(to_char(a.dateof_payment,'YYMMDD'),1,6) as dateof_payment,");
	  strcat(chr_l_sel_msg_stmt,"substr(to_char(a.dateof_payment,'DD-MM-YYYY'),1,10) as EM_DATEOF_PAYMENT,");
	  strcat(chr_l_sel_msg_stmt,"substr(to_char(d.checker_dt,'YYMMDD'),1,6) as PAYMENT_DT,");
	  strcat(chr_l_sel_msg_stmt,"decode(d.amt_rec,0,NULL,d.amt_rec) as AMT_REC,");
	  strcat(chr_l_sel_msg_stmt,"substr(concat(a.instr_code,concat(concat(to_char(to_date(a.DECLARE_DT),'YY'),lpad(((to_date(a.DECLARE_DT) - to_date(concat(concat('01/01/',to_char(a.DECLARE_DT,'YYYY')),' 12:00:00')))+1),3,'0')),lpad(substr(to_char(a.EVNT_INDNT),1,2),2,'0'))),1,16) as TEVENTID,");
	  strcat(chr_l_sel_msg_stmt,"decode(c.INSTR_TYPE,'BON',decode(b.CLN_FMT_RPTIND,'Y','FMT'");
	  strcat(chr_l_sel_msg_stmt,",c.INSTR_TYPE),c.INSTR_TYPE) as FTYPEOFINSTR,");
	  
	  /*strcat(chr_l_sel_msg_stmt,"decode(c.INSTR_TYPE,'BON',decode(b.CLN_FMT_RPTIND,'Y',to_char(e.ELIG_ENTITL_POS*c.NOMINAL_VALUE),e.ELIG_ENTITL_POS),e.ELIG_ENTITL_POS) as FENT_POS,");*/
	 /* strcat(chr_l_sel_msg_stmt,"decode(c.INSTR_TYPE,'BON',decode(b.CLN_FMT_RPTIND,'Y',to_char(max(e.AVL_QTY)*c.NOMINAL_VALUE),max(e.AVL_QTY)),max(e.AVL_QTY)) as FENT_POS,");*/
   strcat(chr_l_sel_msg_stmt,"decode(c.INSTR_TYPE,'BON',decode(b.CLN_FMT_RPTIND,'Y',to_char((d.alloted_qty + d.add_allot_qty)*c.NOMINAL_VALUE),(d.alloted_qty + d.add_allot_qty)),(d.alloted_qty + d.add_allot_qty)) as NEW_QTY_PAID,");     
	  strcat(chr_l_sel_msg_stmt,"c.currency_cd,c.INSTR_TYPE,");
	  strcat(chr_l_sel_msg_stmt,"d.alloted_qty as ALLOTED_QTY,");
	  strcat(chr_l_sel_msg_stmt,"d.add_allot_qty as ADD_ALLOT_QTY,");
	  strcat(chr_l_sel_msg_stmt,"(d.alloted_qty + d.add_allot_qty) as TOT_ALLOT_QTY,");
/*
	  strcat(chr_l_sel_msg_stmt,"to_char(round((trunc(trunc(d.amt_payable)*(d.tax_rate/100))),2)) as RTAX_AMT,");
	  strcat(chr_l_sel_msg_stmt,"to_char(round((d.amt_payable * d.tax_rate/100),2)) as TAX_AMOUNT,");
	  strcat(chr_l_sel_msg_stmt,"to_char(round((d.amt_payable - trunc(trunc(d.amt_payable)*(d.tax_rate/100))),2)) as RNET_AMT,");
	  strcat(chr_l_sel_msg_stmt,"to_char(round((d.amt_payable * (100-d.TAX_RATE)/100),2)) as NET_AMT,");
*/
	  strcat(chr_l_sel_msg_stmt,"c.INSTR_ISIN,c.currency_cd,");
/*
	  strcat(chr_l_sel_msg_stmt,"c.currency_cd as CCYCUR_PMT,");
	  strcat(chr_l_sel_msg_stmt,"c.currency_cd as CCYRNET_AMT,");
	  strcat(chr_l_sel_msg_stmt,"c.currency_cd as CCYNET_AMT,");
	  strcat(chr_l_sel_msg_stmt,"c.currency_cd as CCYRTAX_AMT,");
	  strcat(chr_l_sel_msg_stmt,"c.currency_cd as CCYTAX_AMT,");
	  strcat(chr_l_sel_msg_stmt,"substr(replace(replace(d.PAYMENT_INFO,chr(13),NULL),chr(10),NULL),1,35) as PAYMENT_INFO,");
*/
	  strcat(chr_l_sel_msg_stmt,"b.CLN_USE_ISIN_IND as FLGISIN,");
	  /*strcat(chr_l_sel_msg_stmt,"decode(a.RES_INSTR_CODE,NULL,a.RES_INSTR_CODE_2,a.RES_INSTR_CODE) as RES_INSTR_CODE,a.INFO_SEQ as LENTNOTE_NO,");*/
	  /*strcat(chr_l_sel_msg_stmt,"nvl(c.INSTR_PARENT,' ') as RES_INSTR_CODE,a.INFO_SEQ as LENTNOTE_NO,");*/
	  strcat(chr_l_sel_msg_stmt,"concat('/',b.CLN_GL_ACCOUNT) as GL_ACCOUNT,");
	  strcat(chr_l_sel_msg_stmt,"substr(concat(decode(a.NEW_SAFEK_QTY,NULL,'0',a.NEW_SAFEK_QTY),concat(':',decode(a.OLD_STK_QTY,NULL,'0',a.OLD_STK_QTY))),1,15) as RATIO,");
	  strcat(chr_l_sel_msg_stmt,"to_char(a.NEW_SAFEK_RT) as AE_RATE, ");
   strcat(chr_l_sel_msg_stmt,"substr(concat(d.corp_id,'");
   strcat(chr_l_sel_msg_stmt,l_ms_msgent_structa_a.proc_data);
   strcat(chr_l_sel_msg_stmt,"'),1,22) as PROC_INIT ,");
			 
			 strcat(chr_l_sel_msg_stmt," b.CLN_TAXABLE_IND  as IND_83C83D ");
			 
      

         strcat(chr_l_sel_msg_stmt,",a.OLD_STK_QTY,a.NEW_SAFEK_QTY");
         /* Vaibhavk  Kotak Changes to Display PriceBAND(Event BB) in Payment Msgs also. Start */ 
         strcat(chr_l_sel_msg_stmt,",a.BK_BUILD_IND as FIXED_PRICE "); 
         strcat(chr_l_sel_msg_stmt,",a.LWR_LIMIT as LOWER_LIMIT "); 
         strcat(chr_l_sel_msg_stmt,",a.UPR_LIMIT as UPPER_LIMIT ");
         /* Vaibhavk  Kotak Changes to Display PriceBAND(Event BB) in Payment Msgs also. End */
         strcat(chr_l_sel_msg_stmt,",substr(to_char(a.DECLARE_DT,'YYYYMMDD'),1,8) as NEW_DECL_DT");
         strcat(chr_l_sel_msg_stmt,",substr(to_char(a.DECLARE_DT,'DD-MM-YYYY'),1,10) as EM_DECL_DT");
         strcat(chr_l_sel_msg_stmt,",substr(to_char(a.REC_DATE,'YYYYMMDD'),1,8) as NEW_REC_DT");
         strcat(chr_l_sel_msg_stmt,",substr(to_char(a.BC_FROM_DATE,'YYYYMMDD'),1,8) as NEW_BC_DT");
         strcat(chr_l_sel_msg_stmt,",substr(to_char(a.BC_FROM_DATE,'DD-MM-YYYY'),1,10) as EM_BC_DT");
         strcat(chr_l_sel_msg_stmt,",substr(to_char(a.EX_DATE,'YYYYMMDD'),1,8) as NEW_EX_DT");
         strcat(chr_l_sel_msg_stmt,",substr(to_char(a.dateof_payment,'YYYYMMDD'),1,8) as NEW_PAY_DT");
         strcat(chr_l_sel_msg_stmt,",substr(to_char(d.checker_dt,'YYYYMMDD'),1,8) as NEW_PAYMENT_DT");
         strcat(chr_l_sel_msg_stmt,",substr(to_char(d.access_stamp,'YYYYMMDD'),1,8) as NEW_PAY_AUTH_DT");
         strcat(chr_l_sel_msg_stmt,",'12' as DECRATE"); 
         strcat(chr_l_sel_msg_stmt,",substr(to_char(d.access_stamp,'YYYYMMDDHH24MISS'),1,14) as PREPDATE");
         strcat(chr_l_sel_msg_stmt,",substr(to_char(d.access_stamp,'YYYYMMDD'),1,8) as NEW_PAY_AUTH_DT");
		  strcat(chr_l_sel_msg_stmt,",substr(to_char(a.DEAL_FRM_DATE,'YYYYMMDD'),1,8) as NEW_TRADEFROM_DT");
		  strcat(chr_l_sel_msg_stmt,",substr(to_char(a.DEAL_FRM_DATE,'DD-MM-YYYY'),1,10) as EM_TRADEFROM_DT");
		  strcat(chr_l_sel_msg_stmt,",substr(to_char(a.DEAL_TO_DATE,'YYYYMMDD'),1,8) as NEW_TRADETO_DT,");
		  strcat(chr_l_sel_msg_stmt,"substr(to_char(a.DEAL_TO_DATE,'DD-MM-YYYY'),1,10) as EM_TRADETO_DT,");
        strcat(chr_l_sel_msg_stmt,"to_char(decode(a.EARNINGS,NULL,'0',0,'0',a.EARNINGS),'9999999999999990.99999999') as TEARNINGS, ");
        strcat(chr_l_sel_msg_stmt,"to_char(decode(a.EARNINGS_RATE,NULL,'0',0,'0',a.EARNINGS_RATE),'9999999999999990.99999999') as R_EARNINGS, ");
	  strcat(chr_l_sel_msg_stmt,"c.currency_cd as CCYTEARNINGS,");
 
     strcat(chr_l_sel_msg_stmt,"c.currency_cd as CCYR_EARNINGS, " );

         strcat(chr_l_sel_msg_stmt," '12' as DECTEARNINGS , '12' as DECR_EARNINGS");
		strcat(chr_l_sel_msg_stmt, ", b.CLN_FRACT_IND as FRACT_IND, '");  	
		strcat(chr_l_sel_msg_stmt, chr_l_keep_fract_temp);
     	strcat(chr_l_sel_msg_stmt, "' as FRACT_COND");

		strcat(chr_l_sel_msg_stmt, ", a.corp_id as CORP_ID "); 
     
     
     strcat(chr_l_sel_msg_stmt, ", a.FRACT_PR ,a.OP_EVT_CLASS, a.DISP_OF_FRACT ");

	  
      strcat(chr_l_sel_msg_stmt," ,a.REQD_CERTIFY as REQD_CERTIFY,c.nominal_value  "); 

	 	 strcat(chr_l_sel_msg_stmt," from CAEVENT a,MT_CLIENT b,MT_INSTRUMENT c,CA_RTBB_ALLOTMENT d");
	  strcat(chr_l_sel_msg_stmt," where a.instr_code = c.instr_code and a.corp_id = '");
	  strcat(chr_l_sel_msg_stmt,chr_l_ca_id);
          strcat(chr_l_sel_msg_stmt,"' ");
          /*strcat(chr_l_sel_msg_stmt," and d.CLN_SRNO = '");
          strcat(chr_l_sel_msg_stmt,chr_l_refno);*/

	  
	 	 strcat(chr_l_sel_msg_stmt," and a.corp_id = d.corp_id and d.cln_code = b.cln_code ");
          if((strlen(l_ms_msgent_structa_a.client))!=0)
          {
          	strcat(chr_l_sel_msg_stmt,"and b.cln_code = '");
                strcat(chr_l_sel_msg_stmt,l_ms_msgent_structa_a.client);
          	strcat(chr_l_sel_msg_stmt,"'");
          }
          else
          {
		APL_DATA_MISSING("CLIENT", APL_NULL_STRING, APL_NULL_STRING)
                APL_GOBACK_FAIL
          }

         
        /* 
       strcat(chr_l_sel_msg_stmt," and d.rowid NOT IN (select d.rowid from MS_MSGSTAT where client = d.cln_code and proc_init = concat(d.corp_id,d.CLN_SRNO) ");
            strcat(chr_l_sel_msg_stmt," AND swift_msg_rep in ('566N29') )");
         */
          strcat(chr_l_sel_msg_stmt," and b.STATUS != '");
          strcat(chr_l_sel_msg_stmt,STATUS_CLS_AUTH);
          strcat(chr_l_sel_msg_stmt,"' ");
 
        }

        if(strncmp(p_msg_no,"53x",3) == 0)
        {

          l_msgaddr = MSTMTCONFMSGNO;       
          if(strlen(l_ms_msgent_structa_a.proc_data) != 0) 	
          {
             CO_SplitStr(l_ms_msgent_structa_a.proc_data,
                          ';', &int_noelem, &chr_l_param);
             strcpy(chr_as_of_date,chr_l_param[0]);

				 

				 memset(chr_l_typeofinstr, NULL, 2);
				 if (int_noelem>1)
				 {
					strcpy(chr_l_typeofinstr, chr_l_param[1]);
				 }
				
				 memset(chr_l_tipotrade, NULL, 2);
				 if (int_noelem>2)
				 {
					
               strcpy(chr_l_tipotrade, chr_l_param[2]);
				 }
             	
             if (int_noelem > 3)
             {
               strcpy(chr_l_reverse,chr_l_param[3]);
               strcpy(chr_as_of_date,chr_l_param[0]);
             }
          }
          if(strlen(chr_as_of_date)==0)
             strcpy(chr_as_of_date,chr_h_system_date);

	  EXEC SQL SELECT substr(to_char(to_date(:chr_h_system_date),'MM/DD/YYYY'),1,10) into :chr_tlx_date from dual;

	  IS_ANY_ORA_ERROR
		
          *p_STAT_VAL = realloc(*p_STAT_VAL,sizeof(MS_STATIC_VAL)*10); 
			 

          
          
	   
           *p_SEL_VAL = realloc(*p_SEL_VAL,sizeof(MS_STATIC_VAL)*20);
          strcpy((*p_STAT_VAL)[0].link_val,"DUMMY");
          strcpy((*p_STAT_VAL)[0].link_tag,"DUMMY");
          strcpy((*p_STAT_VAL)[1].link_val,"DOMSEC");
          strcpy((*p_STAT_VAL)[1].link_tag,chr_h_dom_instr);
          strcpy((*p_STAT_VAL)[2].link_val,"NATION");
          strcpy((*p_STAT_VAL)[2].link_tag,h_nation_code);
          strcpy((*p_STAT_VAL)[3].link_val,"SUBACCP");
          strcpy((*p_STAT_VAL)[3].link_tag,chr_h_sub_acct_processing);
          strcpy((*p_STAT_VAL)[4].link_val,"CA_NAME");
          strcpy((*p_STAT_VAL)[4].link_tag,chr_h_corporate_name);
          strcpy((*p_STAT_VAL)[5].link_val,"DOMCCY");
          strcpy((*p_STAT_VAL)[5].link_tag,chr_h_dom_ccycode);
          strcpy((*p_STAT_VAL)[6].link_val,"DATE");
          strcpy((*p_STAT_VAL)[6].link_tag,h_sys_dt);
          strcpy((*p_STAT_VAL)[7].link_val,"TLXDATE");
          strcpy((*p_STAT_VAL)[7].link_tag,chr_tlx_date);
			 strcpy((*p_STAT_VAL)[8].link_val,"CNTRY_BIC");
			 strcpy((*p_STAT_VAL)[8].link_tag,l_mt_message_sys_params_struct_h.swift_cd);
          strcpy((*p_STAT_VAL)[9].link_val,"");
          strcpy((*p_STAT_VAL)[9].link_tag,"");

          strcpy((*p_SEL_VAL)[0].link_val,"DOMESTIC_CPCLT");
          strcpy((*p_SEL_VAL)[1].link_val,"PROC_INIT");
          strcpy((*p_SEL_VAL)[2].link_val,"CLNT_NAME");
          strcpy((*p_SEL_VAL)[3].link_val,"SPC40");
          strcpy((*p_SEL_VAL)[4].link_val,"DL_CLASS");
          strcpy((*p_SEL_VAL)[5].link_val,"SPC22");
          strcpy((*p_SEL_VAL)[6].link_val,"AMOUNT");
          strcpy((*p_SEL_VAL)[7].link_val,"CLIENT");
          strcpy((*p_SEL_VAL)[8].link_val,"AS_OF_DATE");
          strcpy((*p_SEL_VAL)[8].link_tag,chr_as_of_date);
          strcpy((*p_SEL_VAL)[9].link_val,"PARTIAL_IND_B"); /*Vaibhav Karnik 26June2007 KOTAK-UAT I-SolveID:361 54x Messages*/
			 strcpy((*p_SEL_VAL)[10].link_val,"NEW_FMTFLG");
			 strcpy((*p_SEL_VAL)[11].link_val,"NEW_NOMVAL"); 
			          
			 strcpy((*p_SEL_VAL)[12].link_val,"DEAL_CD");
         
         strcpy((*p_SEL_VAL)[13].link_val,"NCOUNTACC");  
         strcpy((*p_SEL_VAL)[14].link_val,"CLIENTOF_CD"); 
         strcpy((*p_SEL_VAL)[15].link_val,"CP_CLTNAME");
	 strcpy((*p_SEL_VAL)[16].link_val,"NEW_ACCOUNTOF1");
	 strcpy((*p_SEL_VAL)[17].link_val,"UNIQREFNO");
         strcpy((*p_SEL_VAL)[18].link_val,"EXCH_CODE");
         strcpy((*p_SEL_VAL)[19].link_val,"FTYPEOFINSTR"); /*Vaibhav Karnik I-SolveID:361 KOTAK-UAT 54x Messages*/ 
	 strcpy((*p_SEL_VAL)[20].link_val,"");
	 strcpy((*p_SEL_VAL)[20].link_tag,"");
       




		
	  strcpy(chr_l_sel_msg_stmt,"select a.client ,a.IDENTIY_NO ,decode(a.lcl_identno,NULL,NULL,a.lcl_identno) as lcl_identno, a.IDENTIY_NO as PROC_INIT,a.ORIG_REFNO, substr(to_char(INSTRUMENT_DT,'YYMMDD'),1,6) as INSTRUMENT_DT,substr(to_char(a.INSTRUMENT_DT,'MM/DD/YYYY'),1,10) as TINSTR_DT, b.CLN_USE_ISIN_IND as FLGISIN,");


	  strcat(chr_l_sel_msg_stmt,"a.UNIQ_IDENT_NO as UNIQREFNO,c.INSTR_ISIN, a.instr_code, substr(replace(replace(c.instr_name,chr(13),NULL),chr(10),NULL),1,31) as INSTR_NAME, a.INSTRUCT_PERSON as INSTPRTY , a.deal_cd,a.QTY, decode(a.dl_class,'27','26','29','26',a.dl_class) as DL_CLASS ,c.nominal_value as NEW_NOMVAL, a.exch_code, c.nominal_value as NOMINAL_VALUE, a.mkt_type, a.clh_flg,a.contract_cd,a.interfii_flg, ");
	  
     
		strcat(chr_l_sel_msg_stmt,"decode(substr(a.INSTRUCT_PERSON,1,1),'/',substr(a.INSTRUCT_PERSON,2,10),NULL) as instparty1,");
     
	  strcat(chr_l_sel_msg_stmt,"decode(c.INSTR_TYPE,'BON',decode(b.CLN_FMT_RPTIND,'Y','FMT'");
	  strcat(chr_l_sel_msg_stmt,",c.INSTR_TYPE),c.INSTR_TYPE) as FTYPEOFINSTR,");
	  
	  strcat(chr_l_sel_msg_stmt,"decode(c.INSTR_TYPE,'BON',decode(b.CLN_FMT_RPTIND,'Y',to_char(a.QTY*c.NOMINAL_VALUE),a.QTY),a.QTY) as FENT_POS,");
	 
     strcat(chr_l_sel_msg_stmt,"a.client,a.client as NACCOUNT, substr(replace(replace(b.cln_name,chr(13),NULL),chr(10),NULL),1,35) as CLNT_NAME, substr(replace(replace(b.cln_name,chr(13),NULL),chr(10),NULL),36,20) as CNAME1,a.domestic_cpclt,b.CLN_MASTER ,");



	  strcat(chr_l_sel_msg_stmt,"substr(replace(replace(ltrim(rtrim(a.clientof)),chr(13),NULL),chr(10),NULL),1,35) as taccountof,");
		
	  strcat(chr_l_sel_msg_stmt,"substr(replace(replace(ltrim(rtrim(a.clientof)),chr(13),NULL),chr(10),NULL),decode(substr(replace(replace(ltrim(rtrim(a.clientof)),chr(10), NULL),chr(13),NULL),1,1),'/',2,36),decode(substr(replace(replace(ltrim(rtrim(a.clientof)),chr(10),NULL),chr(13),NULL),1,1),'/',35,30)) as taccountof1,concat('/',b.CLN_GL_ACCOUNT) as GL_ACCOUNT, ' '||nvl(replace(replace(substr(a.INFO1,(instr(a.INFO1,chr(10),1,2)),34),chr(13),' '),chr(10),NULL),' ') as INFO1 , ");
	 strcat(chr_l_sel_msg_stmt,"c.currency_cd as SECCCY, a.AMOUNT, decode(a.MONEY_SETL_DT,a.INSTRUMENT_DT,'Y','N') as MONEYSAME, a.PARTIAL_IND_B,c.currency_cd as CCYAMOUNT,c.currency_cd as  CCYTOTALDRAMT,c.currency_cd as CCYTOTALCRAMT,c.currency_cd as CCYNETAMT,");
	  strcat(chr_l_sel_msg_stmt,"decode(a.QTY,a.ORIG_QTY,NULL,'COMPLETE') as COMPLETE, decode(a.QTY,a.ORIG_QTY,NULL,'C') as TCOMPLETE,substr(to_char(a.MONEY_SETL_DT,'YYMMDD'),1,6) as MONEY_SETL_DT,");
	  strcat(chr_l_sel_msg_stmt,"decode(a.deal_cd,1,'DFP',decode(a.deal_cd,2,'RFP',decode(a.deal_cd,3,'DVP',decode(a.deal_cd,5,'DFP',decode(a.deal_cd,6,'RFP',decode(a.deal_cd,7,'DVP','RVP')))))) as trcodedesc,concat(concat(substr(replace(replace(b.cln_name,chr(13),NULL),chr(10),NULL),1,35),' '),substr(replace(replace(b.cln_name,chr(13),NULL),chr(10),NULL),36,29)) as TCNAME,b.CLN_SHORTNM as alphacode ,");
	 
	 strcat(chr_l_sel_msg_stmt," b.CLN_TAXABLE_IND  as IND_83C83D ");
	 
	
    strcat(chr_l_sel_msg_stmt,",decode(b.CLN_REG_BCL_IND,'Y',b.CLN_REG_BCL_IND,'N')  as BHPREFIX ");
    

  
	 strcat(chr_l_sel_msg_stmt,",decode(a.domestic_cpclt,'");
	 strcat(chr_l_sel_msg_stmt,chr_h_citibank_acct_code);
	 strcat(chr_l_sel_msg_stmt,"','Y','N') as IS_CT_DOMCPAC");
	 strcat(chr_l_sel_msg_stmt,",a.COST");
	 strcat(chr_l_sel_msg_stmt,",c.currency_cd as CCYCOST");
	 strcat(chr_l_sel_msg_stmt,",a.CP_CLT");
	 strcat(chr_l_sel_msg_stmt,",a.cp_clt as NCOUNTACC");
	 strcat(chr_l_sel_msg_stmt,",substr(to_char(a.INSTRUMENT_DT,'YYYYMMDD'),1,8) as NEW_AINSTR_DT");
	 strcat(chr_l_sel_msg_stmt,",substr(to_char(a.MONEY_SETL_DT,'YYYYMMDD'),1,8) as NEW_MONEYDT");
	 strcat(chr_l_sel_msg_stmt,",substr(to_char(a.setl_date,'YYYYMMDD'),1,8) as NEW_SETTLEDT");
	 strcat(chr_l_sel_msg_stmt,",substr(to_char(a.deal_date,'YYYYMMDD'),1,8) as NEW_TRDATE");
	 
	 strcat(chr_l_sel_msg_stmt,",upper(decode(substr(replace(replace(a.CP_CLTNAME,chr(13),NULL),chr(10),NULL),1,1),'/',substr(replace(replace(a.CP_CLTNAME,chr(13),NULL),chr(10),NULL),2,34),");
	strcat(chr_l_sel_msg_stmt,"substr(replace(replace(a.CP_CLTNAME,chr(13),NULL),chr(10),NULL),1,35))) as CP_CLTNAME ");

 /* ISKB-361 : ASHISH 10-01-2008 */
	 /* strcat(chr_l_sel_msg_stmt,",c.currency_cd as CCYPAMOUNT,round(a.net_amt,2) as NET_AMT,round(a.net_amt,2) as NET_AMOUNT,c.currency_cd as CCYNET_AMT ");*/
	 	 strcat(chr_l_sel_msg_stmt,",c.currency_cd as CCYPAMOUNT,a.net_amt as NET_AMT,a.net_amt as NET_AMOUNT,c.currency_cd as CCYNET_AMT ");
	 strcat(chr_l_sel_msg_stmt,",c.currency_cd as CCYRAMOUNT");
  

			
			strcat(chr_l_sel_msg_stmt," ,decode(ltrim(rtrim(substr(a.clientof,1,35))),NULL,NULL,ltrim(rtrim(substr(a.clientof,1,35)))) as NEW_ACCOUNTOF1  ");
			strcat(chr_l_sel_msg_stmt," ,decode(ltrim(rtrim(substr(a.clientof,36,30))),NULL,NULL,ltrim(rtrim(substr(a.clientof,36,30)))) as NEW_ACCOUNTOF2  ");
			strcat(chr_l_sel_msg_stmt," ,decode(ltrim(rtrim(substr(a.INSTRUCT_PERSONNM,1,35))),NULL,NULL,ltrim(rtrim(substr(a.INSTRUCT_PERSONNM,1,35)))) as INSTPARTYNM1  ");
			strcat(chr_l_sel_msg_stmt," ,decode(ltrim(rtrim(substr(a.INSTRUCT_PERSONNM,36,30))),NULL,NULL,ltrim(rtrim(substr(a.INSTRUCT_PERSONNM,36,30)))) as INSTPARTYNM2  ");
      
     
    if (strcmp(chr_l_reverse,"R")== 0)
       {
        strcat(chr_l_sel_msg_stmt,",'Y' as REVERSE,to_char(to_date('");
        strcat(chr_l_sel_msg_stmt,chr_as_of_date);
        strcat(chr_l_sel_msg_stmt,"'),'YYMMDD') as ASOFDATE");
        strcat(chr_l_sel_msg_stmt,",to_char(to_date('");
		  strcat(chr_l_sel_msg_stmt,chr_as_of_date);
        strcat(chr_l_sel_msg_stmt,"'),'YYYYMMDD') as NEW_ASOFDATE");
       }

	
        strcat(chr_l_sel_msg_stmt,",a.CLIENTOF_CD as CLIENTOF_CD, a.INTER_MED_PERSON, a.ENTRY ");
        strcat(chr_l_sel_msg_stmt," ,decode(ltrim(rtrim(substr(a.INTER_MED_PERSONNM,1,35))),NULL,NULL,ltrim(rtrim(substr(a.INTER_MED_PERSONNM,1,35)))) as INTER_MED_PERSONNM1 ");
        strcat(chr_l_sel_msg_stmt," ,decode(ltrim(rtrim(substr(a.INTER_MED_PERSONNM,36,60))),NULL,NULL,ltrim(rtrim(substr(a.INTER_MED_PERSONNM,36,60)))) as INTER_MED_PERSONNM2 ");
       

	  strcat(chr_l_sel_msg_stmt," from dl_deal a,MT_CLIENT b,MT_INSTRUMENT c");
    if (strcmp(chr_l_reverse,"R")== 0)
          {
           strcat(chr_l_sel_msg_stmt," where a.client = b.cln_code and a.instr_code = c.instr_code and (((a.deal_cd = 3 or a.deal_cd = 4 or a.deal_cd = 7 or a.deal_cd = 8) and a.INSTRUMENT_DT IS NULL ");
		   /*shailesh 28-03-2008 ISKB 997 Issue Log 94 commenting the below line*/
        //   strcat(chr_l_sel_msg_stmt," and a.MONEY_SETL_DT IS NULL");
           strcat(chr_l_sel_msg_stmt,") or ((a.deal_cd = 1 or a.deal_cd = 2 or a.deal_cd = 5 or a.deal_cd = 6) and a.INSTRUMENT_DT IS NULL ))");
          }
        else
          {
        /*shailesh ISKB 1001 21-03-2008 start*/
          strcat(chr_l_sel_msg_stmt," where a.client = b.cln_code and a.instr_code = c.instr_code and (((a.deal_cd = 3 or a.deal_cd = 4 or a.deal_cd = 7 or a.deal_cd = 8) and TRUNC(a.INSTRUMENT_DT) <= TO_DATE(SUBSTR('"); 
          strcat(chr_l_sel_msg_stmt,chr_as_of_date);
          strcat(chr_l_sel_msg_stmt,"',0,10),'DD/MM/YYYY') and TRUNC(a.MONEY_SETL_DT) <= TO_DATE(SUBSTR('");
          strcat(chr_l_sel_msg_stmt,chr_as_of_date);
          strcat(chr_l_sel_msg_stmt,"',0,10),'DD/MM/YYYY')) or ((a.deal_cd = 1 or a.deal_cd = 2 or a.deal_cd = 5 or a.deal_cd = 6) and TRUNC(a.INSTRUMENT_DT) <= TO_DATE(SUBSTR('");
          strcat(chr_l_sel_msg_stmt,chr_as_of_date);
          strcat(chr_l_sel_msg_stmt,"',0,10),'DD/MM/YYYY'))) ");
       /*shailesh ISKB 1001 21-03-2008 end*/
          }      
 

       if((strlen(l_ms_msgent_structa_a.client))!=0)
          {
                strcat(chr_l_sel_msg_stmt," and b.cln_code = '");
                strcat(chr_l_sel_msg_stmt,l_ms_msgent_structa_a.client);
                strcat(chr_l_sel_msg_stmt,"'");
          }

          if((strlen(l_ms_msgent_structa_a.proc_init))!=0)
          {
                strcat(chr_l_sel_msg_stmt," and a.IDENTIY_NO ='");
                strcat(chr_l_sel_msg_stmt,l_ms_msgent_structa_a.proc_init);
                strcat(chr_l_sel_msg_stmt,"'");
                
          }

           
			  
	        
           if (strcmp(chr_l_reverse,"R")== 0)
           {
           strcat(chr_l_sel_msg_stmt," AND(( instr(nvl(a.MSG_STAT,' '),'");
           strcat(chr_l_sel_msg_stmt,MSG_FLG_53X);
           strcat(chr_l_sel_msg_stmt,"') > 0) OR (instr(nvl(a.MSG_STAT,' '),'C')>0))"); /*shailesh 28-03-2008 ISKB 997 Issue log 94*/		  
           }
           else
           {
           strcat(chr_l_sel_msg_stmt," AND instr(nvl(a.MSG_STAT,' '),'");
			  strcat(chr_l_sel_msg_stmt,MSG_FLG_53X);
			  strcat(chr_l_sel_msg_stmt,"') = 0");
           }

           strcat(chr_l_sel_msg_stmt," and b.CLN_BRK_ALL != 'B' and b.checker is not null ");
	   strcat(chr_l_sel_msg_stmt," and b.STATUS != '");
	   strcat(chr_l_sel_msg_stmt,STATUS_CLS_AUTH);
	   strcat(chr_l_sel_msg_stmt,"'");

			

				if ( chr_l_typeofinstr[0] == 'B' )
				{
					strcat( chr_l_sel_msg_stmt, " AND c.INSTR_TYPE in ('BON','FMT')");
				}
				else if ( chr_l_typeofinstr[0] == 'S' )
				{
					strcat( chr_l_sel_msg_stmt, " AND c.INSTR_TYPE in ('SHS','RTS')");
				}
				
         

			
 			if(APL_FAILURE == CO_Chk_CntryEnabled(  "MSG_53X",
															  "TRD_CODE_OPT",
																&int_l_condexists,
																l_debug_info_ptr))

			{
				APL_GOBACK_FAIL
			}
	
			if (int_l_condexists > 0)
			{
			
         

            if ( chr_l_tipotrade[0] == '1' )
            {
               strcat( chr_l_sel_msg_stmt, " AND a.deal_cd = '1' ");
            }
            else if (chr_l_tipotrade[0] == '2' )
            {
               strcat( chr_l_sel_msg_stmt, " AND a.deal_cd = '2' ");
            }
            else if (chr_l_tipotrade[0] == '3' )
            {
               strcat( chr_l_sel_msg_stmt, " AND a.deal_cd = '3' ");
            }
            else if  (chr_l_tipotrade[0] == '4' )
            {
               strcat( chr_l_sel_msg_stmt, " AND a.deal_cd = '4' ");
            }
				
			}

           strcat(chr_l_sel_msg_stmt," order by a.client,a.instr_code,a.setl_date,a.deal_cd ");
        }          
 
   if (strcmp(p_msg_no,"508") == 0)
   {
      l_msgaddr = MSTMTCONFMSGNO;
      *p_STAT_VAL = realloc(*p_STAT_VAL,sizeof(MS_STATIC_VAL)*5);
      *p_SEL_VAL = realloc(*p_SEL_VAL,sizeof(MS_STATIC_VAL)*4);   
         strcpy((*p_STAT_VAL)[0].link_val,"DUMMY");
                        strcpy((*p_STAT_VAL)[0].link_tag,"DUMMY");
                        strcpy((*p_STAT_VAL)[1].link_val,"DOMSEC");
                        strcpy((*p_STAT_VAL)[1].link_tag,chr_h_dom_instr);
                        strcpy((*p_STAT_VAL)[2].link_val,"NATION");
                        strcpy((*p_STAT_VAL)[2].link_tag,h_nation_code);
                        strcpy((*p_STAT_VAL)[3].link_val,"DOMCCY");
                        strcpy((*p_STAT_VAL)[3].link_tag,chr_h_dom_ccycode);
                        strcpy((*p_STAT_VAL)[4].link_val,"");
                        strcpy((*p_STAT_VAL)[4].link_tag,"");

         strcpy((*p_SEL_VAL)[0].link_val,"CLIENT");
			strcpy((*p_SEL_VAL)[1].link_val,"IDEN_NO");
			strcpy((*p_SEL_VAL)[2].link_val,"UNIQREFNO");
			strcpy((*p_SEL_VAL)[3].link_val,"");
                        strcpy((*p_SEL_VAL)[2].link_tag,"");
                        strcpy(chr_l_sel_msg_stmt,"select a.client,a.iden_no , a.iden_no as PROC_INIT,b.CLN_USE_ISIN_IND as FLGISIN,");
                        strcat(chr_l_sel_msg_stmt,"decode(c.INSTR_TYPE,'BON',decode(b.CLN_FMT_RPTIND,'Y','FMT',");
								
                        strcat(chr_l_sel_msg_stmt,"c.INSTR_TYPE),c.INSTR_TYPE) as FTYPEOFINSTR,a.UNIQ_IDENT_NO as UNIQREFNO,");
                        strcat(chr_l_sel_msg_stmt,"decode(c.INSTR_TYPE,'BON',decode(b.CLN_FMT_RPTIND,'Y',to_char(a.QTY*c.NOMINAL_VALUE),a.QTY),a.QTY) as FENT_POS,");
                        strcat(chr_l_sel_msg_stmt,"c.INSTR_ISIN, a.instr_code, substr(replace(replace(c.instr_name,chr(13),NULL),chr(10),NULL),1,31) as INSTR_NAME,");
                        strcat(chr_l_sel_msg_stmt,"concat('/',a.client) as NACCOUNT, substr(replace(replace(b.cln_name,chr(13) ,NULL),chr(10),NULL),1,35) as CLNT_NAME, substr(replace(replace(b.cln_name,chr(13),NULL),chr(10),NULL),36,20) as CNAME1,");
                        strcat(chr_l_sel_msg_stmt,"c.currency_cd as SECCCY,");
                        strcat(chr_l_sel_msg_stmt,"substr(to_char(a.setl_date,'YYYYMMDD'),1,8) as NEW_SETTLEDT");
                        strcat(chr_l_sel_msg_stmt,",substr(to_char(a.access_stamp,'YYYYMMDDHH24MISS'),1,14) as NEW_PREPDATE");
                        strcat(chr_l_sel_msg_stmt,",d.ISO_LOCNCD as FROM_ISO_LOCNCODE");
                        strcat(chr_l_sel_msg_stmt,",e.ISO_LOCNCD as TO_ISO_LOCNCODE");
                        strcat(chr_l_sel_msg_stmt," from DL_LOCNCHG a, MT_CLIENT b, MT_INSTRUMENT c,MT_LOCATION d, MT_LOCATION e");
                        strcat(chr_l_sel_msg_stmt," where a.client = b.cln_code and a.instr_code = c.INSTR_CODE");
                        
							
                        strcat(chr_l_sel_msg_stmt,"  and a.FRM_LOC = d.location_cd(+) and a.TO_LOCATION = e.LOCATION_CD");
                        strcat(chr_l_sel_msg_stmt," and a.client =  '");
                        strcat(chr_l_sel_msg_stmt,l_ms_msgent_structa_a.client);
                        strcat(chr_l_sel_msg_stmt,"'");
                        strcat(chr_l_sel_msg_stmt," and a.iden_no = '");
                        strcat(chr_l_sel_msg_stmt,l_ms_msgent_structa_a.proc_init);
                        strcat(chr_l_sel_msg_stmt,"'");
                        strcat(chr_l_sel_msg_stmt," and a.checker_dt is not null ");
                        strcat(chr_l_sel_msg_stmt," and b.STATUS != '");
                        strcat(chr_l_sel_msg_stmt,STATUS_CLS_AUTH);
         strcat(chr_l_sel_msg_stmt,"'");
                        strcat(chr_l_sel_msg_stmt," order by a.client,a.instr_code,a.SETL_DATE");
   }
         
        if(strcmp(p_msg_no,"599FX") == 0)
        {
          l_msgaddr = MCASHPROJMSGNO;       
          if(strlen(l_ms_msgent_structa_a.proc_data) != 0)
          {
             CO_SplitStr(l_ms_msgent_structa_a.proc_data,
                          ';', &int_noelem, &chr_l_param);
             strcpy(chr_as_of_date,chr_l_param[0]);
             strcpy(chr_l_rep_ccy,chr_l_param[1]);
          }

          if(strlen(chr_as_of_date)== 0)
          {
		APL_DATA_MISSING("AS OF DATE", APL_NULL_STRING, APL_NULL_STRING)
                APL_GOBACK_FAIL
          }
          if(strlen(chr_l_rep_ccy)== 0)
          {
		APL_DATA_MISSING("REP. MT_CURRENCY", APL_NULL_STRING, APL_NULL_STRING)
                APL_GOBACK_FAIL
          }

          exec sql select map_desc into :chr_h_domccy_desc
                   from PRO_SGENSTAT
                   where map_type = 'ISOCURRENCY'
                         and map_val = :chr_h_dom_ccycode;

          IS_ANY_ORA_ERROR


		
          *p_STAT_VAL = realloc(*p_STAT_VAL,sizeof(MS_STATIC_VAL)*8);
          *p_SEL_VAL = realloc(*p_SEL_VAL,sizeof(MS_STATIC_VAL)*3); 
          strcpy((*p_STAT_VAL)[0].link_val,"DUMMY");
          strcpy((*p_STAT_VAL)[0].link_tag,"DUMMY");
          strcpy((*p_STAT_VAL)[1].link_val,"DATE");
          strcpy((*p_STAT_VAL)[1].link_tag,h_sys_dt);
          strcpy((*p_STAT_VAL)[2].link_val,"NYAC");
          strcpy((*p_STAT_VAL)[2].link_tag,chr_h_ny_branch_usd_acct);
          strcpy((*p_STAT_VAL)[3].link_val,"DOMCCY");
          strcpy((*p_STAT_VAL)[3].link_tag,chr_h_dom_ccycode);
          strcpy((*p_STAT_VAL)[4].link_val,"CA_NAME");
          strcpy((*p_STAT_VAL)[4].link_tag,chr_h_corporate_name);
          strcpy((*p_STAT_VAL)[5].link_val,"DOMCCYDESC");
          strcpy((*p_STAT_VAL)[5].link_tag,chr_h_domccy_desc);
          strcpy((*p_STAT_VAL)[6].link_val,"SSFX");
          strcpy((*p_STAT_VAL)[6].link_tag,chr_h_fx_quote);
          strcpy((*p_STAT_VAL)[7].link_val,"REP_CCY");
          strcpy((*p_STAT_VAL)[7].link_tag,chr_l_rep_ccy);
          strcpy((*p_STAT_VAL)[7].link_val,"");
          strcpy((*p_STAT_VAL)[7].link_tag,"");

          strcpy((*p_SEL_VAL)[0].link_val,"DUMMY");
          strcpy((*p_SEL_VAL)[0].link_tag,"DUMMY");
          strcpy((*p_SEL_VAL)[1].link_tag,"UNIQREFNO");
          strcpy((*p_SEL_VAL)[2].link_val,"");
          strcpy((*p_SEL_VAL)[2].link_tag,"");

          strcpy(chr_l_sel_msg_stmt,"select a.client ,b.CLN_GL_ACCOUNT,substr(concat(a.client,a.deal_cd),1,11) as TRACC,");
          strcat(chr_l_sel_msg_stmt,"concat(concat(substr(replace(replace(b.cln_name,chr(13),NULL),chr(10),NULL),1,35),' '),substr(replace(replace(b.cln_name,chr(13),NULL),chr(10),NULL),36,29)) as CLNT_NAME,");
          strcat(chr_l_sel_msg_stmt,"decode(a.deal_cd,4,'T','F') as BUY,b.CLN_CHORTNM as ALPHACODE,");
          strcat(chr_l_sel_msg_stmt,"a.IDENTIY_NO,a.IDENTIY_NO as PROC_INIT,a.instr_code,a.QTY,a.AMOUNT,e.CURRENCY_DESC,a.UNIQ_IDENT_NO as UNIQREFNO,");    
          strcat(chr_l_sel_msg_stmt,"decode(a.deal_cd,4,a.AMOUNT*c.RATE_BUY,a.AMOUNT*c.SELL_RT) as IDELRECAMT,decode(a.deal_cd,4,c.RATE_BUY,c.SELL_RT) as AE_RATE,");
          strcat(chr_l_sel_msg_stmt,"decode(a.deal_cd,4,a.amount/c.RATE_BUY,a.amount/c.SELL_RT) as DDELRECAMT ");
          strcat(chr_l_sel_msg_stmt," from dl_deal a,MT_CLIENT b,MT_EXCHRATE c,DL_CURRENCY e  ");
          strcat(chr_l_sel_msg_stmt," where a.client = b.cln_code and  c.currency_cd = '");
          strcat(chr_l_sel_msg_stmt,chr_l_rep_ccy); 
          strcat(chr_l_sel_msg_stmt,"' and a.FX_REQD = 'Y' and a.VAL_FDT is null and ");
          strcat(chr_l_sel_msg_stmt," e.currency_cd = '");
          strcat(chr_l_sel_msg_stmt,chr_l_rep_ccy); 
          strcat(chr_l_sel_msg_stmt,"' and c.RATE_DATE = (select MAX(RATE_DATE) from MT_EXCHRATE d where d.RATE_DATE <= '");
          strcat(chr_l_sel_msg_stmt,chr_as_of_date);
          strcat(chr_l_sel_msg_stmt,"' and d.currency_cd = '");
          strcat(chr_l_sel_msg_stmt,chr_l_rep_ccy);
          strcat(chr_l_sel_msg_stmt,"')  and a.checker is not null and a.deal_cd in (3,4,7,8) and a.setl_date = '");
          strcat(chr_l_sel_msg_stmt,chr_as_of_date);
          strcat(chr_l_sel_msg_stmt,"' ");
          if((strlen(l_ms_msgent_structa_a.client))!=0)
          {
                strcat(chr_l_sel_msg_stmt," and a.client='");
                strcat(chr_l_sel_msg_stmt,l_ms_msgent_structa_a.client);
                strcat(chr_l_sel_msg_stmt,"'");

          }

           strcat(chr_l_sel_msg_stmt," and a.rowid NOT IN (SELECT a.rowid FROM ");
           strcat(chr_l_sel_msg_stmt," MS_MSGSTAT f where f.swift_msg_rep = '");
           strcat(chr_l_sel_msg_stmt,p_msg_no);
           strcat(chr_l_sel_msg_stmt,"' AND  a.client = f.client AND ");
           strcat(chr_l_sel_msg_stmt," a.IDENTIY_NO = f.proc_init)");
           strcat(chr_l_sel_msg_stmt," and b.CLT_BRK_ALL != 'B' and b.checker is not null ");
	   strcat(chr_l_sel_msg_stmt," and b.STATUS != '");
	   strcat(chr_l_sel_msg_stmt,STATUS_CLS_AUTH);
          strcat(chr_l_sel_msg_stmt,"' ");
           strcat(chr_l_sel_msg_stmt,"' order by a.client asc,a.deal_cd detail ");

 
        }

		
        if( !strcmp(p_msg_no,"512_E") || !strcmp(p_msg_no,"512_C") )
        { 
          l_msgaddr = MORDEXECANMSGNO;       
			
			
			 if ( strlen(l_ms_msgent_structa_a.proc_data) == 0 )
			 {
				APL_DATA_MISSING("FROM DATE", APL_NULL_STRING, APL_NULL_STRING)
                APL_GOBACK_FAIL
			 }
			else
			{	
             CO_SplitStr((*p_imsgent_struct).proc_data,
                          ';', &int_noelem, &chr_l_param);

             strcpy(chr_from_date,chr_l_param[0]);
			}

			

      *p_STAT_VAL = realloc(*p_STAT_VAL,sizeof(MS_STATIC_VAL)*7);
      *p_SEL_VAL = realloc(*p_SEL_VAL,sizeof(MS_STATIC_VAL)*6); 
     
		 strcpy((*p_STAT_VAL)[0].link_val,"DUMMY");
      strcpy((*p_STAT_VAL)[0].link_tag,"DUMMY");
      strcpy((*p_STAT_VAL)[1].link_val,"DOMSEC");
      strcpy((*p_STAT_VAL)[1].link_tag,chr_h_dom_instr);
      strcpy((*p_STAT_VAL)[2].link_val,"NATION");
      strcpy((*p_STAT_VAL)[2].link_tag,h_nation_code);
      strcpy((*p_STAT_VAL)[3].link_val,"MESSAGE_CLASS");
		if ( !strcmp(p_msg_no,"512_E") )
		{
    	  strcpy((*p_STAT_VAL)[3].link_tag,"NEW/");
		}
		else
		{
    	  strcpy((*p_STAT_VAL)[3].link_tag,"CANCEL/");
		}
      strcpy((*p_STAT_VAL)[4].link_val,"CA_NAME");
      strcpy((*p_STAT_VAL)[4].link_tag,chr_h_corporate_name);
      strcpy((*p_STAT_VAL)[5].link_val,"SUBACCT");
      strcpy((*p_STAT_VAL)[5].link_tag,chr_h_sub_acct_processing);
      strcpy((*p_STAT_VAL)[6].link_val,"");
      strcpy((*p_STAT_VAL)[6].link_tag,"");

      strcpy((*p_SEL_VAL)[0].link_val,"DUMMY");
      strcpy((*p_SEL_VAL)[0].link_tag,"DUMMY");
      strcpy((*p_SEL_VAL)[1].link_val,"DATEOF_INPUT");
      strcpy((*p_SEL_VAL)[2].link_val,"ORIG_REFNO");
      strcpy((*p_SEL_VAL)[3].link_val,"CLIENT");
      strcpy((*p_SEL_VAL)[4].link_val,"UNIQREFNO");
      strcpy((*p_SEL_VAL)[5].link_val,"");
      strcpy((*p_SEL_VAL)[5].link_tag,"");


	if ( !strcmp(p_msg_no,"512_E") )
	{

		
		strcpy(chr_l_sel_msg_stmt,"select a.client,a.IDENTIY_NO as PROC_INIT,a.DATEOF_INPUT as DATEOF_INPUT,a.ORIG_REFNO as ORIG_REFNO,a.domestic_cpclt,substr(to_char(a.deal_date,'YYMMDD'),1,6) as DEAL_DATE,substr(to_char(a.deal_date,'DD/MM/YYYY'),1,10) as TXNTRDT,substr(to_char(a.setl_date,'YYMMDD'),1,6) as SETL_DATE,substr(to_char(a.deal_date,'DD/MM/YYYY'),1,10) as TXNSETTLEDT,a.QTY,to_char(decode(int_b.INSTR_TYPE,'FMT',a.COST*100,a.COST),'9999999999.99999999') as COST, 3 AS DECPRICE, a.AMOUNT,a.currency_cd as CCYAMOUNT,a.brokercomm,a.currency_cd as CCYBRKCOMM,a.deal_cd,DECODE(a.deal_cd,'3','SOLD','BOUGHT') as BUY_SELL_IND,DECODE(c.CLN_FMT_RPTIND,'Y',DECODE(b.INSTR_TYPE,'BON',a.QTY*b.NOMINAL_VALUE,a.QTY),int_a.QTY) as MSGQTY,a.STX_COMM,a.OTH_COMM,");
		strcat(chr_l_sel_msg_stmt,"b.NOMINAL_VALUE,b.INSTR_TYPE,b.INSTR_ISIN,b.instr_code,b.currency_cd,b.INSTR_TYPE, substr(replace(replace(b.instr_name,chr(13),NULL),chr(10),NULL),1,35 ) as INSTR_NAME,a.UNIQ_IDENT_NO as UNIQREFNO,");
		strcat(chr_l_sel_msg_stmt,"c.CLN_FMT_RPTIND,c.CLN_USE_ISIN_IND,c.CLN_SHORTNM as ALPHACODE ,");
		strcat(chr_l_sel_msg_stmt,"substr(replace(replace(d.cln_name,chr(13),NULL),chr(10),NULL),1,35 ) as CLNT_NAME,substr(d.CLN_ADD_1,1,35) as CONTACT_DETAILS1,substr(d.CLN_ADD_1,36,35) as ADDRESS2,substr(d.CLN_ADD_2,1,35) as ADDRESS3, ");
		strcat(chr_l_sel_msg_stmt,"substr(replace(replace(e.cln_name,chr(13),NULL),chr(10), NULL),1,35 ) as MSTACC_CNAME");
	strcat(chr_l_sel_msg_stmt," from dl_deal a,MT_INSTRUMENT b, MT_CLIENT c, MT_CLIENT d,MT_CLIENT e ");
	strcat(chr_l_sel_msg_stmt," where  a.client='");
   strcat(chr_l_sel_msg_stmt,l_ms_msgent_structa_a.client);
   strcat(chr_l_sel_msg_stmt,"'");
	
	strcat(chr_l_sel_msg_stmt," and  a.deal_date <= '");
	strcat(chr_l_sel_msg_stmt,chr_from_date);
	strcat(chr_l_sel_msg_stmt,"' ");
	strcat(chr_l_sel_msg_stmt," and DEAL_FRM_ORD ='Y' ");
	strcat(chr_l_sel_msg_stmt," and  b.instr_code = a.instr_code ");
	strcat(chr_l_sel_msg_stmt," and  c.cln_code = a.client ");
	strcat(chr_l_sel_msg_stmt," and  d.cln_code = a.domestic_cpclt ");
	strcat(chr_l_sel_msg_stmt," and  e.cln_code = c.cln_master ");

   strcat(chr_l_sel_msg_stmt," and c.STATUS != '");
   strcat(chr_l_sel_msg_stmt,STATUS_CLS_AUTH);
   strcat(chr_l_sel_msg_stmt,"' ");
	strcat(chr_l_sel_msg_stmt," AND   NOT EXISTS ( select client from MS_MSGSTAT where client=a.client AND proc_init=a.IDENTIY_NO  AND swift_msg_rep = '512_E') ");
	strcat(chr_l_sel_msg_stmt," ORDER BY a.ORIG_REFNO,a.DATEOF_INPUT");
	
	}
	else if ( !strcmp(p_msg_no,"512_C") )
	{
		
		strcpy(chr_l_sel_msg_stmt,"select a.client,a.IDENTIY_NO as PROC_INIT,a.DATEOF_INPUT as DATEOF_INPUT,a.ORIG_REFNO as ORIG_REFNO,a.domestic_cpclt,substr(to_char(a.deal_date,'YYMMDD'),1,6) as DEAL_DATE,substr(to_char(a.setl_date,'YYMMDD'),1,6) as SETL_DATE,a.QTY,to_char(decode(b.INSTR_TYPE,'FMT',a.COST*100,a.COST),'9999999999.99999999') as COST, 3 AS DECPRICE, a.AMOUNT,a.currency_cd as CCYAMOUNT,a.brokercomm,a.currency_cd as CCYBRKCOMM,a.deal_cd,DECODE(a.deal_cd,'3','SOLD','BOUGHT') as BUY_SELL_IND,DECODE(c.CLN_FMT_RPTIND,'Y',DECODE(b.INSTR_TYPE,'BON',a.QTY*b.NOMINAL_VALUE,a.QTY),a.QTY) as MSGQTY,a.STX_COMM,a.OTH_COMM,");
		strcat(chr_l_sel_msg_stmt,"b.NOMINAL_VALUE,b.INSTR_TYPE,b.INSTR_ISIN,b.instr_code,b.currency_cd,b.INSTR_TYPE, substr(replace(replace(b.instr_name,chr(13),NULL),chr(10),NULL),1,35 ) as INSTR_NAME,a.UNIQ_IDENT_NO as UNIQREFNO,");  
		strcat(chr_l_sel_msg_stmt,"c.CLN_FMT_RPTIND,c.CLN_USE_ISIN_IND,c.CLN_SHORTNM as ALPHACODE ,");
		strcat(chr_l_sel_msg_stmt,"substr(replace(replace(d.cln_name,chr(13),NULL),chr(10),NULL),1,35 ) as CLNT_NAME,substr(d.CLN_ADD_1,1,35) as CONTACT_DETAILS1,substr(d.CLN_ADD_1contact_details,36,35) as ADDRESS2,substr(d.CLN_ADD_2,1,35) as ADDRESS3, ");
		strcat(chr_l_sel_msg_stmt,"substr(replace(replace(e.cln_name,chr(13),NULL),chr(10), NULL),1,35 ) as MSTACC_CNAME");
	strcat(chr_l_sel_msg_stmt," from DL_HISDEAL a,MT_INSTRUMENT b, MT_CLIENT c, MT_CLIENT d ,MT_CLIENT e");
	strcat(chr_l_sel_msg_stmt," where  a.client='");
   strcat(chr_l_sel_msg_stmt,l_ms_msgent_structa_a.client);
   strcat(chr_l_sel_msg_stmt,"'");
	
	strcat(chr_l_sel_msg_stmt," and  a.deal_date <= '");
	strcat(chr_l_sel_msg_stmt,chr_from_date);
	strcat(chr_l_sel_msg_stmt,"' ");
	strcat(chr_l_sel_msg_stmt," and DEAL_FRM_ORD ='Y' ");
	strcat(chr_l_sel_msg_stmt," and  b.instr_code = a.instr_code ");
	strcat(chr_l_sel_msg_stmt," and  c.cln_code = a.client ");
	strcat(chr_l_sel_msg_stmt," and  d.cln_code = a.domestic_cpclt ");
	strcat(chr_l_sel_msg_stmt," and  e.cln_code = c.cln_master ");

   strcat(chr_l_sel_msg_stmt," and c.STATUS != '");
   strcat(chr_l_sel_msg_stmt,STATUS_CLS_AUTH);
   strcat(chr_l_sel_msg_stmt,"' ");
	
	strcat(chr_l_sel_msg_stmt,"AND EXISTS ( select ORD_REFNO from OR_ORDERDETAILS where ORD_REFNO=a.ORIG_REFNO ) " );
	strcat(chr_l_sel_msg_stmt,"AND NOT EXISTS ( select client from MS_MSGSTAT where client=a.client AND proc_init=a.IDENTIY_NO  AND swift_msg_rep = '512_C') " );
	strcat(chr_l_sel_msg_stmt,"AND EXISTS ( select client from MS_MSGSTAT where client=a.client AND proc_init=a.IDENTIY_NO AND swift_msg_rep = '512_E') ");
	strcat(chr_l_sel_msg_stmt," ORDER BY a.ORIG_REFNO,a.DATEOF_INPUT");

	}
	else
	{
		APL_DATA_MISSING("INVALID MSG NO",APL_NULL_STRING,APL_NULL_STRING);
		APL_GOBACK_FAIL;	
	}

		} 
		  
       	

	    if(strcmp(p_msg_no,"592") == 0)
	    {
	     l_msgaddr = MVTBCANCELMSGNO;
		 if(strlen(l_ms_msgent_structa_a.proc_init) != 0)
		 {
		    strcpy(chr_l_refno,l_ms_msgent_structa_a.proc_init);
		 }


			 EXEC SQL SELECT deal_cd
			 INTO :chr_l_trcode
			 FROM
			   DL_DEAL
    	     WHERE
			 CLIENT =RTRIM(:l_ms_msgent_structa_a.client) and
		     IDENTIY_NO   = RTRIM(:l_ms_msgent_structa_a.proc_init);

		           IS_ANY_ORA_ERROR

		   if ( chr_l_trcode[0] == DEALCD_DF )
         {
		       strcpy(chr_l_msgno,I_MSGNO_522);
	  	   }
		   else if ( chr_l_trcode[0] == DEALCD_RF )
		   {	
		       strcpy(chr_l_msgno,I_MSGNO_520);
		   }
		   else if ( chr_l_trcode[0] == DEALCD_DVP )
		   {		
				strcpy(chr_l_msgno,I_MSGNO_523);
		   }
		   else if ( chr_l_trcode[0] == DEALCD_RVP )
		   {
			    strcpy(chr_l_msgno,I_MSGNO_521);
		   }
         else if ( chr_l_trcode[0] == DEALCD_CD )
         {
            strcpy(chr_l_msgno,I_MSGNO_521);
         }
         else if ( chr_l_trcode[0] == DEALCD_CR )
         {
            strcpy(chr_l_msgno,I_MSGNO_523);
         }
         else if ( chr_l_trcode[0] == DEALCD_DCD )
         {
            strcpy(chr_l_msgno,I_MSGNO_523);
         }
         else if ( chr_l_trcode[0] == DEALCD_RCR )
         {
            strcpy(chr_l_msgno,I_MSGNO_521);
         }
		   else
		   {
			  APL_INSERT_ERROR_DATA_INTG("Trd Code","Value Unknown",APL_NULL_STRING)
		   }
			EXEC SQL SELECT substr(vtb_clt_name,1,35)
                    INTO :chr_h_vtb_acct_name
                    FROM MT_CORE_SYS_PARAMS;

         IS_ANY_ORA_ERROR

			
			*p_STAT_VAL=realloc(*p_STAT_VAL,sizeof(MS_STATIC_VAL)*8); 
         *p_SEL_VAL=realloc(*p_SEL_VAL,sizeof(MS_STATIC_VAL)*6); 

		   strcpy((*p_STAT_VAL)[0].link_val,"DUMMY");
		   strcpy((*p_STAT_VAL)[0].link_tag,"DUMMY");
		   strcpy((*p_STAT_VAL)[1].link_val,"DOMSEC");
		   strcpy((*p_STAT_VAL)[1].link_tag,chr_h_dom_instr);
		   strcpy((*p_STAT_VAL)[2].link_val,"IDENTIY_NO");
		   strcpy((*p_STAT_VAL)[2].link_tag,chr_l_refno);
		   strcpy((*p_STAT_VAL)[3].link_val,"MSG_IDENT_NO");
		   strcpy((*p_STAT_VAL)[3].link_tag,chr_l_msgno);
      	strcpy((*p_STAT_VAL)[4].link_val,"NATION");
      	strcpy((*p_STAT_VAL)[4].link_tag,h_nation_code);
			strcpy((*p_STAT_VAL)[5].link_val,"VTBACCNAME"); 
         strcpy((*p_STAT_VAL)[5].link_tag,chr_h_vtb_acct_name);
		   strcpy((*p_STAT_VAL)[6].link_val,"");
		   strcpy((*p_STAT_VAL)[6].link_tag,"");
		
			strcpy((*p_SEL_VAL)[0].link_val,"DOMESTIC_CPCLT");
			strcpy((*p_SEL_VAL)[1].link_val,"CP_CLT");
			strcpy((*p_SEL_VAL)[2].link_val,"CLIENT");
			strcpy((*p_SEL_VAL)[3].link_val,"NEW_DOMCP");
			strcpy((*p_SEL_VAL)[4].link_val,"UNIQREFNO");
			strcpy((*p_SEL_VAL)[5].link_val,"");
			strcpy((*p_SEL_VAL)[5].link_tag,"");

			
	     strcpy(chr_l_sel_msg_stmt,"select a.client,a.IDENTIY_NO as PROC_INIT,substr(to_char(a.deal_date,'YYMMDD'),1,6) as DEAL_DATE,");
		  strcat(chr_l_sel_msg_stmt,"substr(to_char(a.DATEOF_INPUT,'YYMMDD'),1,6) as DEAL_DT,to_char(a.setl_date,'YYMMDD') as setl_date,substr(to_char(a.TRANS_DATE,'YYMMDD'),1,6) as TRANS_DATE,");
	
	      strcat(chr_l_sel_msg_stmt,"decode(a.domestic_cpclt, '");
        strcat(chr_l_sel_msg_stmt,chr_h_citibank_acct_code);
        strcat(chr_l_sel_msg_stmt,"',d.vtb_client,a.domestic_cpclt) as DOMESTIC_CPCLT,a.PARTIAL_IND_B,a.domestic_cpclt as NEW_DOMCP,a.ORIG_REFNO,");
        strcat(chr_l_sel_msg_stmt,"decode(a.domestic_cpclt, '");
        strcat(chr_l_sel_msg_stmt,chr_h_citibank_acct_code);
        strcat(chr_l_sel_msg_stmt,"','");
        strcat(chr_l_sel_msg_stmt,chr_h_vtb_acct_name);
        strcat(chr_l_sel_msg_stmt,"',e.cln_name) as DOMESTIC_CPNAME,a.UNIQ_IDENT_NO as UNIQREFNO,");		
			
	 	  strcat(chr_l_sel_msg_stmt," decode(b.INSTR_TYPE,'BON',decode(c.CLN_FMT_RPTIND,'Y','FMT'");
		  strcat(chr_l_sel_msg_stmt,",b.INSTR_TYPE),b.INSTR_TYPE) as FTYPEOFINSTR,decode(b.INSTR_TYPE,'BON',decode(c.CLN_FMT_RPTIND,'Y',to_char(a.QTY*b.NOMINAL_VALUE),a.QTY),a.QTY) as FENT_POS,");
		  strcat(chr_l_sel_msg_stmt,"b.INSTR_ISIN,b.INSTR_TYPE,b.instr_code,a.AMOUNT,substr(replace(replace(b.instr_name,chr(13),NULL),chr(10),NULL),1,35) as INSTR_NAME,b.currency_cd,b.currency_cd as CCYAMOUNT,");
        strcat(chr_l_sel_msg_stmt,"substr(replace(replace(c.cln_name,chr(13),NULL),chr(10),NULL),1,35) as CLNT_NAME,c.CLN_FMT_RPTIND,c.CLN_USE_ISIN_IND as FLGISIN,");
                               
			strcat(chr_l_sel_msg_stmt," c.CLN_TAXABLE_IND  as IND_83C83D, ");
						  			  
			 
         strcat(chr_l_sel_msg_stmt," c.cln_vtb_client ");
			strcat(chr_l_sel_msg_stmt," ,a.deal_cd,a.cp_clt,");
			strcat(chr_l_sel_msg_stmt," decode(a.domestic_cpclt,f.custody_clt_cd,'Y','N') as ISDOMCITI, ");
			strcat(chr_l_sel_msg_stmt," to_char(a.setl_date,'YYYYMMDD') as NEW_SETDT, to_char(a.deal_date,'YYYYMMDD') as NEW_TRDT, ");
			strcat(chr_l_sel_msg_stmt," c.cln_vtb_client as NEW_VTB,decode(b.INSTR_TYPE,'BON',decode(c.CLN_FMT_RPTIND,'Y',to_char(a.QTY*b.NOMINAL_VALUE),a.QTY),a.QTY) as QTY");
         
			strcat(chr_l_sel_msg_stmt,",decode(a.dl_class,'27','26','29','26',a.dl_class) as DL_CLASS ");
         strcat(chr_l_sel_msg_stmt," from dl_deal a,MT_INSTRUMENT b,MT_CLIENT c,MT_CLIENT d,MT_CLIENT e,MT_CORE_SYS_PARAMS f "); 
			strcat(chr_l_sel_msg_stmt," where a.client = c.cln_code and"); 
			strcat(chr_l_sel_msg_stmt," a.client = '");
			strcat(chr_l_sel_msg_stmt,l_ms_msgent_structa_a.client); 
			strcat(chr_l_sel_msg_stmt,"' and a.IDENTIY_NO = '"); 
			strcat(chr_l_sel_msg_stmt,chr_l_refno);
			strcat(chr_l_sel_msg_stmt,"' and a.instr_code = b.INSTR_CODE");
			strcat(chr_l_sel_msg_stmt," and c.CLN_BRK_ALL != 'B' and c.checker is not null ");
			strcat(chr_l_sel_msg_stmt," and c.STATUS != '"); 
			strcat(chr_l_sel_msg_stmt,STATUS_CLS_AUTH);
			strcat(chr_l_sel_msg_stmt,"' ");
			strcat(chr_l_sel_msg_stmt," and decode(a.cp_clt,NULL,a.domestic_cpclt,a.cp_clt) = d.cln_code ");
         strcat(chr_l_sel_msg_stmt," and a.domestic_cpclt = e.cln_code ");


			} 

        if( !strcmp(p_msg_no,"599EXP")  )
        { 
          l_msgaddr = MORDEREXPMSGNO;       
				
          

			

      *p_STAT_VAL = realloc(*p_STAT_VAL,sizeof(MS_STATIC_VAL)*4);
      *p_SEL_VAL = realloc(*p_SEL_VAL,sizeof(MS_STATIC_VAL)*3); 
    
      strcpy((*p_STAT_VAL)[0].link_val,"ASOFDATE");
      strcpy((*p_STAT_VAL)[0].link_tag,chr_h_sysdrt_date);
      strcpy((*p_STAT_VAL)[1].link_val,"SUBACCT");
      strcpy((*p_STAT_VAL)[1].link_tag,chr_h_sub_acct_processing);
      strcpy((*p_STAT_VAL)[2].link_val,"CA_NAME");
      strcpy((*p_STAT_VAL)[2].link_tag,chr_h_corporate_name);
      strcpy((*p_STAT_VAL)[3].link_val,"");
      strcpy((*p_STAT_VAL)[3].link_tag,"");


      strcpy((*p_SEL_VAL)[0].link_val,"DUMMY");
      strcpy((*p_SEL_VAL)[0].link_tag,"DUMMY");
      strcpy((*p_SEL_VAL)[1].link_tag,"UNIQREFNO");
      strcpy((*p_SEL_VAL)[2].link_val,"");
      strcpy((*p_SEL_VAL)[2].link_tag,"");

		
		strcpy(chr_l_sel_msg_stmt,"select a.client,a.instr_code,a.ORD_REFNO,a.ORD_REFNO as PROC_INIT,a.BUY_SELL_IND,a.LIMIT_IND,a.LIMIT_PR,a.ex_arena,a.ORD_QTY,a.EXEC_QTY,substr(to_char(a.DATEOF_CANCEL,'DD/MM/YYYY'),1,10) as DATEOF_CANCEL,decode(a.DATEOF_CANCEL,NULL,'N',DECODE(a.checker,NULL,'N','Y')) as ISCANCELLED,");
	strcat(chr_l_sel_msg_stmt,"substr(replace(replace(c.cln_name,chr(13),NULL),chr(10),NULL),1,35 ) as CLNT_NAME,c.CLN_USE_ISIN_IND as FLGISINUSE,c.CLN_SHORTNM as ALPHACODE,c.cln_master,");
	strcat(chr_l_sel_msg_stmt,"b.INSTR_ISIN ,b.currency_cd,substr(replace(replace(b.instr_name,chr(13),NULL),chr(10),NULL),1,35 ) as INSTR_NAME, '");
	strcat(chr_l_sel_msg_stmt,chr_new_unique_ref_num);  
	strcat(chr_l_sel_msg_stmt,"' as UNIQREFNO,substr(replace(replace(d.cln_name,chr(13),NULL),chr(10),NULL),1,35 ) as MSTACC_CNAME ");
	strcat(chr_l_sel_msg_stmt," from OR_ORDERDETAILS a,MT_INSTRUMENT b, MT_CLIENT c,MT_CLIENT d");
	strcat(chr_l_sel_msg_stmt," where  a.client='");
   strcat(chr_l_sel_msg_stmt,l_ms_msgent_structa_a.client);
   strcat(chr_l_sel_msg_stmt,"'");
	
	strcat(chr_l_sel_msg_stmt,"and ( (  NVL(a.EXEC_QTY,0) < a.ORD_QTY AND ( (a.EXP_DATE is NOT NULL) AND (a.EXP_DATE <= '");
	strcat(chr_l_sel_msg_stmt,chr_h_system_date);
	strcat(chr_l_sel_msg_stmt,"' ) ) ) OR (a.DATEOF_CANCEL is not null and a.checker is not null) )"  );
	strcat(chr_l_sel_msg_stmt," and  b.instr_code = a.instr_code ");
	strcat(chr_l_sel_msg_stmt," and  c.cln_code = a.client ");
	strcat(chr_l_sel_msg_stmt," and  d.cln_code = c.cln_master ");

   strcat(chr_l_sel_msg_stmt," and c.STATUS != '");
   strcat(chr_l_sel_msg_stmt,STATUS_CLS_AUTH);
   strcat(chr_l_sel_msg_stmt,"' ");
	strcat(chr_l_sel_msg_stmt," AND   NOT EXISTS ( select client from MS_MSGSTAT where client=a.client AND proc_init=a.ORD_REFNO  AND swift_msg_rep = '599EXP') ");
	strcat(chr_l_sel_msg_stmt,"order by ORD_REFNO");

		 } 
		
        if(strcmp(p_msg_no,"100N01") == 0)
        {
          l_msgaddr = MNOSTROACCMSGNO;
          
          CO_SplitStr((*p_imsgent_struct).proc_data,
                     ';', &int_noelem, &chr_l_param);

          *p_STAT_VAL = realloc(*p_STAT_VAL,sizeof(MS_STATIC_VAL)*14);
          *p_SEL_VAL = realloc(*p_SEL_VAL,sizeof(MS_STATIC_VAL)*4);

          strcpy((*p_STAT_VAL)[1].link_val,"IDENTIY_NO");
          strcpy((*p_STAT_VAL)[1].link_tag,l_ms_msgent_structa_a.proc_init);
          strcpy((*p_STAT_VAL)[2].link_val,"VAL_DATE");
          strcpy((*p_STAT_VAL)[2].link_tag,chr_l_param[0]);
          strcpy((*p_STAT_VAL)[3].link_val,"ACCYCODE");
          strcpy((*p_STAT_VAL)[3].link_tag,chr_l_param[1]);
          strcpy((*p_STAT_VAL)[4].link_val,"CURRENCY_CD");
          strcpy((*p_STAT_VAL)[4].link_tag,chr_l_param[2]);
          strcpy((*p_STAT_VAL)[5].link_val,"AMOUNT");
          strcpy((*p_STAT_VAL)[5].link_tag,chr_l_param[3]);
          strcpy((*p_STAT_VAL)[6].link_val,"C_D_IND");
          strcpy((*p_STAT_VAL)[6].link_tag,chr_l_param[4]);
          strcpy((*p_STAT_VAL)[7].link_val,"INSTR_ISIN");
          strcpy((*p_STAT_VAL)[7].link_tag,chr_l_param[5]);
          strcpy((*p_STAT_VAL)[8].link_val,"MODULE_IND");
          strcpy((*p_STAT_VAL)[8].link_tag,chr_l_param[6]);
          strcpy((*p_STAT_VAL)[9].link_val,"BCNTRYCODE");
          strcpy((*p_STAT_VAL)[9].link_tag,h_nation_code);
          strcpy((*p_STAT_VAL)[10].link_val,"cln_master");
          strcpy((*p_STAT_VAL)[11].link_val,"REFACCOUNT");
          strcpy((*p_STAT_VAL)[12].link_val,"CLIENT");
          strcpy((*p_STAT_VAL)[12].link_tag,l_ms_msgent_structa_a.client);
          strcpy((*p_STAT_VAL)[13].link_val,"");
          strcpy((*p_STAT_VAL)[13].link_tag,"");

          strcpy(chr_l_msgval,ltoa(l_msgaddr));

			EXEC SQL SELECT cln_master
                     INTO :chr_l_client
                     FROM MT_CLIENT
                    WHERE cln_code = :l_ms_msgent_structa_a.client;
          IS_ANY_ORA_ERROR

          
          EXEC SQL SELECT concat('/',identify)
                     INTO :chr_l_refer
                     FROM MT_MSGADDRESS
                    WHERE cln_code = :l_ms_msgent_structa_a.client
                      AND MSG_IDENT_NO = :chr_l_msgval
                      AND identify IS NOT NULL
                      AND ROWNUM < 2;
          IS_ANY_ORA_ERROR

          if ( APL_ZERO_RESULT_SET )
             {
               
               EXEC SQL SELECT concat('/',identify)
                          INTO :chr_l_refer
                          FROM MT_MSGADDRESS
                         WHERE cln_code = :chr_l_client
                           AND MSG_IDENT_NO = :chr_l_msgval
                           AND identify IS NOT NULL
                           AND ROWNUM < 2;

               IS_ANY_ORA_ERROR

               if ( APL_ZERO_RESULT_SET )
                  APL_GOBACK_FAIL
             }
	
			strcpy((*p_STAT_VAL)[10].link_tag,chr_l_client);
          strcpy((*p_STAT_VAL)[11].link_tag,chr_l_refer);


			 strcpy((*p_SEL_VAL)[0].link_val,"UNIQREFNO");
			 strcpy((*p_SEL_VAL)[1].link_val,"");
			 strcpy((*p_SEL_VAL)[1].link_val,"");

          strcpy(chr_l_sel_msg_stmt,"SELECT a.COUNTRY as ACNTRYCODE,'");
          strcat(chr_l_sel_msg_stmt,chr_new_unique_ref_num);
          strcat(chr_l_sel_msg_stmt,"' as UNIQREFNO ");
          strcat(chr_l_sel_msg_stmt," FROM MT_CLIENT a");
          strcat(chr_l_sel_msg_stmt," WHERE a.cln_code = '");
          strcat(chr_l_sel_msg_stmt,l_ms_msgent_structa_a.client);
          strcat(chr_l_sel_msg_stmt,"' AND ");
          strcat(chr_l_sel_msg_stmt," a.CLN_BRK_ALL != 'B' and a.checker is not null and ");
          strcat(chr_l_sel_msg_stmt," a.STATUS != '");
          strcat(chr_l_sel_msg_stmt,STATUS_CLS_AUTH);
          strcat(chr_l_sel_msg_stmt,"' and NOT EXISTS (SELECT 1 FROM ");
          strcat(chr_l_sel_msg_stmt," MS_MSGSTAT f where f.swift_msg_rep = '");
          strcat(chr_l_sel_msg_stmt,p_msg_no);
          strcat(chr_l_sel_msg_stmt,"' AND  a.cln_code = f.client AND ");
          strcat(chr_l_sel_msg_stmt," f.proc_init = '");
          strcat(chr_l_sel_msg_stmt,l_ms_msgent_structa_a.proc_init);
          strcat(chr_l_sel_msg_stmt,"')");

        }


		  *p_sel_msg_stmt = chr_l_sel_msg_stmt;
	APL_GOBACK_SUCCESS

RETURN_SUCCESS:

	
	
		APL_FREE(chr_l_mm);
		APL_FREE(chr_l_dd);
		APL_FREE(chr_p_as_of_date);
		APL_FREE(chr_p_yy);
		APL_FREE(chr_l_last_update);
		APL_FREE(chr_l_historical);
		APL_FREE(chr_l_zero_bal);
		APL_FREE(chr_l_week_stm);
		APL_FREE(chr_l_loc_stat);
		APL_FREE(chr_p_choice);
		APL_FREE(chr_p_nopendgs);
		APL_FREE(chr_l_mult_548);
		APL_FREE(chr_selpendgs);
		APL_FREE(chr_temp_part);
		
        //APL_IF_DEBUG
        //{
                CO_ProcMonitor(APL_OUT_FILE,"Exiting successfully from select fn \n",NULL,NULL);

        //}
        return APL_SUCCESS;

RETURN_FAILURE:

	
   
		APL_FREE(chr_l_mm);
		APL_FREE(chr_l_dd);
		APL_FREE(chr_p_as_of_date);
		APL_FREE(chr_p_yy);
		APL_FREE(chr_l_last_update);
		APL_FREE(chr_l_historical);
		APL_FREE(chr_l_zero_bal);
		APL_FREE(chr_l_week_stm);
		APL_FREE(chr_l_loc_stat);
		APL_FREE(chr_p_choice);
		APL_FREE(chr_p_nopendgs);
		APL_FREE(chr_l_mult_548);
		APL_FREE(chr_selpendgs);
		APL_FREE(chr_temp_part);
		
        APL_IF_DEBUG
        {
                CO_ProcMonitor(APL_OUT_FILE,"Exiting unsuccesfully \n",NULL,NULL);
        }
        return APL_FAILURE;
}



int MS_Proc_SelExec(long *p_next_seq_no_15022,char *p_msg_no,MS_MSGENT_STRUCT *p_imsgent,char *p_sel_msg_stmt,MS_STATIC_VAL *p_stat_val,MS_STATIC_VAL **p_sel_val,FILE *INFO_FILE,int *p_seq_no,long *p_msg_seq_no,int *int_p_retstat,DEBUG_INFO_STRUCT_H **l_debug_info_ptr)
{

struct sqlca sqlca;


SQLDA *bind_dp;   
SQLDA *select_dp; 
/**char chr_h_sel_msg_stmt[15000]; **/
char *chr_h_sel_msg_stmt ;



int dbl_i=0,int_returnval = 0;
#ifdef APL_THREADS
        APL_SET_CONTEXT
        EXEC SQL CONTEXT USE :my_ctx_local;
#endif

chr_h_sel_msg_stmt = (char *)calloc(15000,sizeof(char));
memset(chr_h_sel_msg_stmt,APL_NULL_CHAR,15000);


	printf("*********executing=|%s|\n",p_sel_msg_stmt);
	
    if ((bind_dp =
            sqlald(MAX_ITEMS, MAX_VNAMERR_LEN, MAX_INAMERR_LEN)) == (SQLDA *) 0)
    {
   CO_InsertErr(l_debug_info_ptr, ERR_NO_MEMORY,APL_NULL_STRING, APL_NULL_STRING,APL_NULL_STRING, __LINE__,__FILE__);
        return APL_FAILURE;

    }

    if ((select_dp =
        sqlald (MAX_ITEMS, MAX_VNAMERR_LEN, MAX_INAMERR_LEN)) == (SQLDA *) 0)
    {
   CO_InsertErr(l_debug_info_ptr, ERR_NO_MEMORY,APL_NULL_STRING, APL_NULL_STRING,APL_NULL_STRING,__LINE__,__FILE__);
        return APL_FAILURE;
    }
    select_dp->N = MAX_ITEMS;

    
    for (dbl_i = 0; dbl_i < MAX_ITEMS; dbl_i++) 
   {
        bind_dp->I[dbl_i] = (short *) malloc(sizeof (short));
        select_dp->I[dbl_i] = (short *) malloc(sizeof(short));
        bind_dp->V[dbl_i] = (char *) malloc(1);
        select_dp->V[dbl_i] = (char *) malloc(1);
    }
				
		strcpy(chr_h_sel_msg_stmt,p_sel_msg_stmt); 
  /*** Added (int) for AIX migration***/
  printf("\nNaren --- Sel Msg Stmt Before Prepare: [%s] \nLen:[%d]\n", chr_h_sel_msg_stmt,(int) strlen(chr_h_sel_msg_stmt));
  fflush(stdout);

   	EXEC SQL PREPARE S FROM :chr_h_sel_msg_stmt;

	IS_ANY_ORA_ERROR


   	EXEC SQL DECLARE sel_data_cur CURSOR FOR S;

       

        EXEC SQL OPEN sel_data_cur  USING DESCRIPTOR bind_dp;

        IS_ANY_ORA_ERROR
        

        
	   int_returnval = 0;
    if (strcmp(p_msg_no,"IPO_CSD") != 0)
     {                      
	int_returnval = MS_Proc_SelectLst(p_next_seq_no_15022,p_msg_no,p_imsgent,INFO_FILE,p_stat_val,p_sel_val,p_seq_no,p_msg_seq_no,bind_dp,select_dp,chr_h_sel_msg_stmt,l_debug_info_ptr);
	 }
  else
   {
 int_returnval = MS_Proc_SelectLstIPO(p_msg_no,p_stat_val,p_sel_val,p_seq_no,bind_dp,select_dp,chr_h_sel_msg_stmt,l_debug_info_ptr);
 }

        for (dbl_i = 0; dbl_i < MAX_ITEMS; dbl_i++)
        {
            if (bind_dp->V[dbl_i] != (char *) 0)
               free(bind_dp->V[dbl_i]);
            free(bind_dp->I[dbl_i]);   
            if (select_dp->V[dbl_i] != (char *) 0)
                free(select_dp->V[dbl_i]);
            free(select_dp->I[dbl_i]); 
        }

    	
    	sqlclu(bind_dp);
    	sqlclu(select_dp);

    	
    	EXEC SQL CLOSE sel_data_cur;
        if(int_returnval == APL_FAILURE)
		APL_GOBACK_FAIL
        else
		APL_GOBACK_SUCCESS
                
  
RETURN_SUCCESS:

        APL_IF_DEBUG
        {
                CO_ProcMonitor(APL_OUT_FILE,"Exiting successfully \n",NULL,NULL);

        }
		  free(chr_h_sel_msg_stmt);
        return APL_SUCCESS;

RETURN_FAILURE:
        APL_IF_DEBUG
        {
                CO_ProcMonitor(APL_OUT_FILE,"Exiting unsuccesfully\n",NULL,NULL);
        }
		  free(chr_h_sel_msg_stmt);
        return APL_FAILURE;



}

//AIX - Warnings Removal
int MS_Proc_SelectLst(long *p_next_seq_no_15022,char *p_msg_no,MS_MSGENT_STRUCT *p_imsgent,FILE *INFO_FILE,MS_STATIC_VAL *p_STAT_VAL,MS_STATIC_VAL **p_SEL_VAL,int *p_seq_no,long *p_msg_seq_no,SQLDA *bind_dp,SQLDA *select_dp,char *p_sel_msg_stmt,DEBUG_INFO_STRUCT_H **l_debug_info_ptr)
{
	
 printf("\n TestPrintf Entered function MS_Proc_SelectLst()");
 fflush(stdout);


    int dbl_i, int_null_ok, int_precision, int_scale,int_nlen=0;
    char chr_colname[201]=APL_NULL_STRING;
	 char *chr_posofspace;
	 
	 int int_l_new_sch_ind=0;

	 int identity_no=0;
	 int int_ndatalen=0;
	 int int_stat_ctr=0;
	 int int_sel_ctr=0;
	 int int_sel_flg=0;
	 int int_mem_sel_ctr=0;


  
  char     chr_l_client_check[APL_CLIENT_LENGTH]      = APL_NULL_STRING;
  char     chr_l_refno_check[APL_TXNREFNO_LEN]       = APL_NULL_STRING;

  
  char chr_l_reverse_check[2] = APL_NULL_STRING; 
  char chr_l_reverse_check_new[17] = APL_NULL_STRING;   /*vaibhav KOTAK-UAT I-SolveID:361*/
  char chr_l_weekly_check[2] = APL_NULL_STRING;
  char chr_l_hist_check[2] = APL_NULL_STRING;
  char chr_sys_access_stamp[APL_DATE_LEN];
	 


		double tot_portfolio_amt_new=0;
		char chr_client_new[APL_CLIENT_LENGTH];
		char chr_mstacc_new[APL_CLIENT_LENGTH];
		char chr_l_temp_str[25]=APL_NULL_STRING;
		//fpos_t l_curr_pos=0;     /*Commented for Linux Mig*/
		//fpos_t l_insert_pos=0;   /*Commented for Linux Mig*/
                long long l_curr_pos=0;  /*Added for Linux Mig*/
                long long l_insert_pos=0; /*Added for Linux Mig*/
		

    struct sqlca sqlca;
    #ifdef APL_THREADS
        APL_SET_CONTEXT
        EXEC SQL CONTEXT USE :my_ctx_local;
    #endif
    memset(chr_colname,APL_NULL_CHAR,201);


	
	memset(chr_mstacc_new,APL_NULL_CHAR,APL_CLIENT_LENGTH);
	memset(chr_client_new,APL_NULL_CHAR,APL_CLIENT_LENGTH);
	memset(chr_l_temp_str,APL_NULL_CHAR,25);

		
    identity_no = *p_seq_no;
    if ((strncmp(p_sel_msg_stmt, "SELECT", 6) != 0) &&
        (strncmp(p_sel_msg_stmt, "select", 6) != 0))
    {
        select_dp->F = 0;
        APL_GOBACK_FAIL;
    }

    

    select_dp->N = MAX_ITEMS;

    EXEC SQL DESCRIBE SELECT LIST FOR S INTO select_dp;

    IS_ANY_ORA_ERROR

    

    
    select_dp->N = select_dp->F;
    for (dbl_i = 0; dbl_i < select_dp->F; dbl_i++)
    {
        
        sqlnul (&(select_dp->T[dbl_i]), &(select_dp->T[dbl_i]), &int_null_ok);

        switch (select_dp->T[dbl_i])
        {
			
            case 1: case 96 : 
                break;
            case  2 : 
                sqlprc (&(select_dp->L[dbl_i]), &int_precision, &int_scale);
                      
                if (int_precision == 0) int_precision = 40;
                      
                
                if (int_scale > 0)
                    select_dp->L[dbl_i] = sizeof(double);
                else
                    select_dp->L[dbl_i] = sizeof(int);
                break;

            case  8 : 
                select_dp->L[dbl_i] = 240;
                break;

			
            case 11: case 69: case 104 : 
                select_dp->L[dbl_i] = 18;

            case 12 : 
                select_dp->L[dbl_i] = 19;
					 break;

			
		   
				default :
					 select_dp->T[dbl_i]=1;
        }
        
	//START - Changes done by Sanket Savla for IB_7214 for avoiding Memory corruption  ICIC
         if (select_dp->T[dbl_i] != 2)
	{		
           select_dp->V[dbl_i] = (char *) realloc(select_dp->V[dbl_i],
                                    select_dp->L[dbl_i] + 1);
		memset(select_dp->V[dbl_i],APL_NULL_CHAR,select_dp->L[dbl_i] + 1);
	}
         else
	{
           select_dp->V[dbl_i] = (char *) realloc(select_dp->V[dbl_i],
                                    select_dp->L[dbl_i]);
	memset(select_dp->V[dbl_i],APL_NULL_CHAR,select_dp->L[dbl_i]);
	}


        
        if (select_dp->T[dbl_i] != 24 && select_dp->T[dbl_i] != 2)
            select_dp->T[dbl_i] = 1;

        
        if (select_dp->T[dbl_i] == 2)
        { // AIX - Warnings
          if (int_scale > 0)
             select_dp->T[dbl_i] = 4;  
          else
             select_dp->T[dbl_i] = 3;  
        }
    }
     
    if (APL_FAILURE ==CO_RtvSysDtTime(chr_sys_access_stamp, l_debug_info_ptr))
      {
         APL_GOBACK_FAIL
      }

    
    for (;;)
    {
        EXEC SQL FETCH sel_data_cur USING DESCRIPTOR select_dp;
		
				
				int_mem_sel_ctr = 0;
            while((strlen((*p_SEL_VAL)[int_mem_sel_ctr].link_val) != 0) && (strcmp((*p_SEL_VAL)[int_mem_sel_ctr].link_val," ") != 0))
				{
               memset((*p_SEL_VAL)[int_mem_sel_ctr].link_tag,APL_NULL_CHAR,501);
					
					int_mem_sel_ctr++;
				}
		
        if(sqlca.sqlcode == 1403)
		break;



        identity_no++; 
        fprintf(INFO_FILE,"%dEOF=F\n",identity_no);

        
        for (dbl_i = 0; dbl_i < select_dp->F; dbl_i++)
        {

	
	

           memset(chr_colname,APL_NULL_CHAR,201);
           chr_posofspace = strstr(select_dp->S[dbl_i]," ");
           if(chr_posofspace == NULL)
                strcpy(chr_colname,select_dp->S[dbl_i]);
           else
           {
                int_nlen = chr_posofspace - select_dp->S[dbl_i];
                strncpy(chr_colname,select_dp->S[dbl_i],int_nlen);
           }


            fprintf(INFO_FILE,"%d",identity_no);
 
           
            
            fprintf(INFO_FILE,"%s", chr_colname); 
	    fprintf(INFO_FILE,"=");
            fflush(INFO_FILE);
            int_sel_ctr=0;
            int_sel_flg=0;
           printf("\n Here..VaibhavK....Column Name is |%s|",chr_colname);
		   fflush(stdout);
            while(strlen((*p_SEL_VAL)[int_sel_ctr].link_val) != 0)
            {
                if(strcmp((*p_SEL_VAL)[int_sel_ctr].link_val,chr_colname) == 0)
                {
                        int_sel_flg=1;
			break;
 		}
                if(strcmp((*p_SEL_VAL)[int_sel_ctr].link_val,"DUMMY") == 0)
                {
                     strcpy((*p_SEL_VAL)[int_sel_ctr].link_tag,"DUMMY");
		}
                int_sel_ctr++;
                
            }
             /***************Vaibhav KOTAK-UAT I-solve Id:230 17 Apr 2007  **************/ 
            if(strcmp(chr_colname,"CONTACT_DETAILS") == 0)
            {
	        printf("\n ****VaibhavK******");
			fflush(stdout);

	        printf("\n I Got Contact Details.... so im printing it blank......brb...."); 
			fflush(stdout);

	        //fprintf(INFO_FILE,"");AIX Warning Removal changes
	        fprintf(INFO_FILE,"%s","");
	        int_ndatalen = (int)select_dp->L[dbl_i];
	      if(int_sel_flg == 1)
	      {
	        printf("\n Now i got Contact_Details value in SEL_VAL Tag");
			fflush(stdout);

	        memset((*p_SEL_VAL)[int_sel_ctr].link_tag,APL_NULL_CHAR,501);

		exec sql select length(rtrim(substr(:select_dp->V[dbl_i],1,:select_dp->L[dbl_i]))) into
		:int_ndatalen from dual;
		strncpy((*p_SEL_VAL)[int_sel_ctr].link_tag,select_dp->V[dbl_i],int_ndatalen);
		strcat((*p_SEL_VAL)[int_sel_ctr].link_tag,APL_NULL_STRING);
	       }
	      }
              /***************Vaibhav KOTAK-UAT I-solve Id:230 17 Apr 2007  **************/
            else
            {     
                   //printf("\n  ...........VaibhavK checking for if condition:|%d|",select_dp->I[dbl_i]);
            if (*select_dp->I[dbl_i] < 0)
            {
                 printf("\n Tag is [%s] and im in if loop 1...........",chr_colname);  
                if (select_dp->T[dbl_i] == 4)
                {
                  if(int_sel_flg == 1)
                  {
                     strcpy((*p_SEL_VAL)[int_sel_ctr].link_tag," ");
		     (*p_SEL_VAL)[int_sel_ctr].NUM_VAL = 0;
		  }
                  fprintf(INFO_FILE,"%-*c ",(int)select_dp->L[dbl_i]+3, ' ');
                }
                else
                {
                  if(int_sel_flg == 1)
                     strcpy((*p_SEL_VAL)[int_sel_ctr].link_tag," ");

                }
            }
            else
            {
                printf("\n Tag is [%s] and im in else loop 1...........",chr_colname);
				fflush(stdout);

                if (select_dp->T[dbl_i] == 3)     
                {
                  if(int_sel_flg == 1)
                     (*p_SEL_VAL)[int_sel_ctr].NUM_VAL = *(int *)select_dp->V[dbl_i];
                  fprintf (INFO_FILE,"%*d ", (int)select_dp->L[dbl_i],
                                 *(int *)select_dp->V[dbl_i]);
                }
                else if (select_dp->T[dbl_i] == 4)     
                {
                  if(int_sel_flg == 1)
                     (*p_SEL_VAL)[int_sel_ctr].NUM_VAL = *(double *)select_dp->V[dbl_i];
                  if(*(double *)select_dp->V[dbl_i] != 0)
                     fprintf (INFO_FILE,"%*lf", (int)select_dp->L[dbl_i],
                                 *(double *)select_dp->V[dbl_i]);
                  else
                     fprintf (INFO_FILE,"0");
                }
                else                          
		{
                  int_ndatalen = (int)select_dp->L[dbl_i];
                  if(int_sel_flg == 1)
                  {
                        memset((*p_SEL_VAL)[int_sel_ctr].link_tag,APL_NULL_CHAR,501);
								
                        exec sql select length(rtrim(substr(:select_dp->V[dbl_i],1,:select_dp->L[dbl_i]))) into 
                        :int_ndatalen from dual;
                    	 strncpy((*p_SEL_VAL)[int_sel_ctr].link_tag,select_dp->V[dbl_i],int_ndatalen);
                    	strcat((*p_SEL_VAL)[int_sel_ctr].link_tag,APL_NULL_STRING);
                      
  			
                  }
        
		
		
		  if((strncmp(p_msg_no,"53x",3) == 0) || (strcmp(p_msg_no,"572") == 0) || (strcmp(p_msg_no,"539") == 0) || (strcmp(p_msg_no, MS_MSGNO_52XN01) == 0) || (strcmp(p_msg_no, MS_MSGNO_54XN02)==0) || (strcmp(p_msg_no, MS_MSGNO_538) == 0)||(strcmp(p_msg_no,"596N02") == 0)||(strcmp(p_msg_no,"596P") == 0)||(strcmp(p_msg_no,"534") == 0))
		  {
 
                                 printf("\n ******dbl_i =|%d|",dbl_i);
								 fflush(stdout);
		  
			  if (dbl_i==0)
			  {
				  memset(chr_l_client_check,APL_NULL_CHAR,APL_CLIENT_LENGTH);
				  sprintf (chr_l_client_check,"%-*.*s", int_ndatalen,int_ndatalen, select_dp->V[dbl_i]);
			  }
			  if (dbl_i==1)
			  {
				  memset(chr_l_refno_check,APL_NULL_CHAR,APL_TXNREFNO_LEN);
				  sprintf (chr_l_refno_check,"%-*.*s", int_ndatalen,int_ndatalen, select_dp->V[dbl_i]);
                                  strcat(chr_l_refno_check,APL_NULL_STRING);  /*Vaibhav KOTAK-UAT I-Solve:361*/
                                  printf("\n **** 1Ref No: |%s|",chr_l_refno_check);
								  fflush(stdout);
			  }
           
			  if (dbl_i==2)
			  {
				  memset(chr_l_reverse_check_new,APL_NULL_CHAR,17);  /* Before it is 2  KOTAK-UAT I-Solve:361*/
				  sprintf (chr_l_reverse_check_new,"%-*.*s", int_ndatalen,int_ndatalen, select_dp->V[dbl_i]);
                                  printf("\n ****  Reverse Chk: |%s|",chr_l_reverse_check_new);
								  fflush(stdout);
			  }
			  if ((dbl_i==3)&& (strcmp(p_msg_no,"572") == 0) )
			  {
				  memset(chr_l_weekly_check,APL_NULL_CHAR,2);
				  sprintf (chr_l_weekly_check,"%-*.*s", int_ndatalen,int_ndatalen, select_dp->V[dbl_i]);
			  }			  
			  if ((dbl_i==4)&& (strcmp(p_msg_no,"572") == 0) )
			  {
				  memset(chr_l_hist_check,APL_NULL_CHAR,2);
				  sprintf (chr_l_hist_check,"%-*.*s", int_ndatalen,int_ndatalen, select_dp->V[dbl_i]);
			  }			  
		  }
                  fprintf (INFO_FILE,"%-*.*s ", int_ndatalen,
                            int_ndatalen, select_dp->V[dbl_i]);
                   //printf("\n *******( select_dp->L[dbl_i] ) ==> ( %lf )",select_dp->L[dbl_i]); Changes done for AIX Migration
                   printf("\n *******( select_dp->L[dbl_i] ) ==> ( %d )",select_dp->L[dbl_i]);
				   fflush(stdout);

                   printf("\n *******( select_dp->V[dbl_i] ) ==> ( %s )",select_dp->V[dbl_i]);
				   fflush(stdout);
		}
            }
         }  /***************Vaibhav KOTAK-UAT I-solve Id:230 17 Apr 2007  **************/ 
	    fprintf(INFO_FILE,"\n");
        }

                   printf("\n VaibhavK$$$$ Identity NUmber(1) = |%s|",chr_l_refno_check);
				   fflush(stdout);

		  
		  if(APL_FAILURE == MS_Rtv_OTHValues(p_next_seq_no_15022,p_msg_no,1,*p_SEL_VAL,p_STAT_VAL,&identity_no,p_msg_seq_no,INFO_FILE,l_debug_info_ptr))
				APL_GOBACK_FAIL
         
	               printf("\n VaibhavK$$$$ Identity NUmber(2) = |%s|",chr_l_refno_check);	
				   fflush(stdout);
			
			if(strncmp(p_msg_no,"53x",3) == 0)
			{
				printf("\n updating DL_DEAL for client=:%s: and IDENTIY_NO=:%s:",chr_l_client_check,chr_l_refno_check);
				fflush(stdout);

				EXEC SQL UPDATE DL_DEAL
				SET MSG_STAT = ltrim(rtrim(MSG_STAT))||'A'
				WHERE CLIENT=RTRIM(:chr_l_client_check)
				AND   IDENTIY_NO  =RTRIM(:chr_l_refno_check)
            AND INSTRUMENT_DT IS NOT NULL ; 

				IS_ANY_ORA_ERROR
	         
            

            EXEC SQL UPDATE DL_DEAL
            SET MSG_STAT = substr(MSG_STAT,1,instr(MSG_STAT,'A') - 1) ||
            substr(MSG_STAT, instr(MSG_STAT,'A') + 1, length(MSG_STAT))
            WHERE CLIENT=RTRIM(:chr_l_client_check)
            AND   IDENTIY_NO  =RTRIM(:chr_l_refno_check)
            AND INSTR(NVL(MSG_STAT,' '),'A') > 0
            AND INSTRUMENT_DT IS NULL;
         
            IS_ANY_ORA_ERROR

          

   		}

			if(strcmp(p_msg_no,"572") == 0)
			{
			
         
            int_stat_ctr=0;
            if(int_l_new_sch_ind ==0 )
            {
               while(strlen(p_STAT_VAL[int_stat_ctr].link_val) != 0)
               {
                  if(strcmp(p_STAT_VAL[int_stat_ctr].link_val,"CONTACTSEQ") == 0)
                  {
                     int_l_new_sch_ind = 1;
                     break;
                  }
                  int_stat_ctr++;
               }
            }
            if(int_l_new_sch_ind !=0 )
            {

             if (strcmp(chr_l_reverse_check,"Y")== 0)
             {
					if(strcmp(chr_l_weekly_check,"Y")== 0)
					{
               printf("\n updating DL_DEALRST with MSG_STAT 'IX' for client=:%s: and IDENTIY_NO=:%s:",chr_l_client_check,chr_l_refno_check);
			   fflush(stdout);

               EXEC SQL UPDATE DL_DEALRST
               SET MSG_STAT = ltrim(rtrim(MSG_STAT))||'IX'
               WHERE CLIENT=RTRIM(:chr_l_client_check)
               AND   IDENTIY_NO  =RTRIM(:chr_l_refno_check)
               AND INSTR(NVL(MSG_STAT,' '),'IX') = 0;

               IS_ANY_ORA_ERROR

					}
					else
					{
               printf("\n updating DL_DEALRST with MSG_STAT 'I' for client=:%s: and IDENTIY_NO=:%s:",chr_l_client_check,chr_l_refno_check);
			   fflush(stdout);

               EXEC SQL UPDATE DL_DEALRST
               SET MSG_STAT = ltrim(rtrim(MSG_STAT))||'I'
               WHERE CLIENT=RTRIM(:chr_l_client_check)
               AND   IDENTIY_NO  =RTRIM(:chr_l_refno_check)
               AND INSTR(NVL(MSG_STAT,' '),'I') = 0
					AND INSTR(NVL(MSG_STAT,' '),'P') = 0;

               IS_ANY_ORA_ERROR
 					}
             }
              else
              {
					if (strcmp(chr_l_weekly_check,"Y")== 0)
					{
						
						if (strcmp(chr_l_hist_check,"Y")== 0)
						{
                  	printf("\n updating DL_COPYHISTORY with MSG_STAT 'IX' for client=:%s: and IDENTIY_NO=:%s:",chr_l_client_check,chr_l_refno_check);
					fflush(stdout);

                  	EXEC SQL UPDATE DL_COPYHISTORY
                  	SET MSG_STAT = ltrim(rtrim(MSG_STAT))||'IX'
                  	WHERE CLIENT=RTRIM(:chr_l_client_check)
                  	AND   IDENTIY_NO  =RTRIM(:chr_l_refno_check)
                  	AND INSTR(NVL(MSG_STAT,' '),'IX') = 0
                  	AND INSTRUMENT_DT IS NOT NULL;

							IS_ANY_ORA_ERROR
						}
						else
						{
         	         printf("\n updating DL_DEAL with MSG_STAT 'IX' for client=:%s: and IDENTIY_NO=:%s:",chr_l_client_check,chr_l_refno_check);
					 fflush(stdout); 

            	      EXEC SQL UPDATE DL_DEAL
               	   SET MSG_STAT = ltrim(rtrim(MSG_STAT))||'IX'
                  	WHERE CLIENT=RTRIM(:chr_l_client_check)
                  	AND   IDENTIY_NO  =RTRIM(:chr_l_refno_check)
                  	AND INSTR(NVL(MSG_STAT,' '),'IX') = 0
                  	AND INSTRUMENT_DT IS NOT NULL;

 	                 IS_ANY_ORA_ERROR
						}
					}
					else
					{
               	printf("\n updating DL_DEAL with MSG_STAT 'I' for client=:%s: and IDENTIY_NO=:%s:",chr_l_client_check,chr_l_refno_check);
				fflush(stdout);

               	EXEC SQL UPDATE DL_DEAL
               	SET MSG_STAT = ltrim(rtrim(MSG_STAT))||'I',
						access_stamp=:chr_sys_access_stamp
               	WHERE CLIENT=RTRIM(:chr_l_client_check)
               	AND   IDENTIY_NO  =RTRIM(:chr_l_refno_check)
               	AND INSTR(NVL(MSG_STAT,' '),'I') = 0
               	AND INSTRUMENT_DT IS NOT NULL;
    				
               	IS_ANY_ORA_ERROR
					 }
              }
            }
            else
            {


            if (strcmp(chr_l_reverse_check,"Y")== 0)
              {
               EXEC SQL UPDATE DL_DEALRST
               SET MSG_STAT = ltrim(rtrim(MSG_STAT))||'R'
               WHERE CLIENT=RTRIM(:chr_l_client_check)
               AND   IDENTIY_NO  =RTRIM(:chr_l_refno_check)
               AND INSTR(NVL(MSG_STAT,' '),'R') = 0
					AND INSTR(NVL(MSG_STAT,' '),'P')=0;

               IS_ANY_ORA_ERROR
              }
            else
              {
					printf("\n updating DL_DEAL for client=:%s: and IDENTIY_NO=:%s:",chr_l_client_check,chr_l_refno_check);
					fflush(stdout);

					EXEC SQL UPDATE DL_DEAL
					SET MSG_STAT = ltrim(rtrim(MSG_STAT))||'B',
					access_stamp=:chr_sys_access_stamp
					WHERE CLIENT=RTRIM(:chr_l_client_check)
					AND   IDENTIY_NO  =RTRIM(:chr_l_refno_check)
               AND INSTR(NVL(MSG_STAT,' '),'B') = 0 
               AND INSTRUMENT_DT IS NOT NULL;


               IS_ANY_ORA_ERROR
              }
				}


				IS_ANY_ORA_ERROR
			}

         if(strcmp(p_msg_no,"538") == 0)
         {
            int_stat_ctr=0;
            if(int_l_new_sch_ind ==0 )
            {
               while(strlen(p_STAT_VAL[int_stat_ctr].link_val) != 0)
               {
                  if(strcmp(p_STAT_VAL[int_stat_ctr].link_val,"CONTACTSEQ") == 0)
                  {
                     int_l_new_sch_ind = 1;
                     break;
                  }
                  int_stat_ctr++;
               }
            }
            if(int_l_new_sch_ind ==0 )
            {
                  printf("\n updating DL_LOCNCHG for client=:%s: and iden_no=:%s:",chr_l_client_check,chr_l_refno_check);
					fflush(stdout);

                  EXEC SQL UPDATE DL_LOCNCHG
                  SET LOC_CHNG_STAT='AA',
                  access_stamp=:chr_sys_access_stamp
                  WHERE client=RTRIM(:chr_l_client_check)
                  AND   IDEN_NO  =RTRIM(:chr_l_refno_check)
                  AND LOC_CHNG_STAT ='IA';

                  IS_ANY_ORA_ERROR

            }
            else
            {
                  EXEC SQL UPDATE DL_LOCNCHG
                  SET LOC_CHNG_STAT='II',
                  access_stamp=:chr_sys_access_stamp
                  WHERE client=RTRIM(:chr_l_client_check)
                  AND   IDEN_NO  =RTRIM(:chr_l_refno_check)
                  AND LOC_CHNG_STAT ='IA';

                  IS_ANY_ORA_ERROR
            }

         }
			

			if((strcmp(p_msg_no,"596N02") == 0) ||
			  (strcmp(p_msg_no,"596P") == 0) ||
			  (strcmp(p_msg_no,"534") == 0) ||
			  (strcmp(p_msg_no,"539") == 0))/* 539 condition added ISKB 660 Chirag 26022008 */
			{
				printf("***** The count_of chr_flag is being incremented \n\n");
				fflush(stdout);

				printf("***** CLIENT IS : %s \n\n",chr_l_client_check);
				fflush(stdout);

				printf("***** IDENTIY_NO IS : %s\n\n", chr_l_refno_check);
				fflush(stdout);

					EXEC SQL UPDATE DL_DEAL
					SET CNT_548=DECODE(CNT_548,99,0,CNT_548+1)
					WHERE  CLIENT=RTRIM(:chr_l_client_check)
					AND   IDENTIY_NO  =RTRIM(:chr_l_refno_check);

					IS_ANY_ORA_ERROR
				printf("***** The count_of chr_flag is being incremented \n\n");
					fflush(stdout);
			}
			if(strcmp(p_msg_no,"539") == 0)
			{
				printf("\n updating DL_DEAL for client=:%s: and IDENTIY_NO=:%s:",chr_l_client_check,chr_l_refno_check);
				fflush(stdout);

				EXEC SQL UPDATE DL_DEAL
				SET MSG_STAT = ltrim(rtrim(MSG_STAT))||'C'
				WHERE CLIENT=RTRIM(:chr_l_client_check)
				AND   IDENTIY_NO  =RTRIM(:chr_l_refno_check);

				IS_ANY_ORA_ERROR
			}
			
				
         if( (strcmp(p_msg_no, MS_MSGNO_52XN01) == 0) || (strcmp(p_msg_no, MS_MSGNO_54XN02)==0) )
         {
            printf("\n updating DL_DEAL for client=:%s: and IDENTIY_NO=:%s:",chr_l_client_check,chr_l_refno_check);
			fflush(stdout);

            EXEC SQL UPDATE DL_DEAL
            SET MSG_STAT = ltrim(rtrim(MSG_STAT))||'E'
            WHERE CLIENT=RTRIM(:chr_l_client_check)
            AND   IDENTIY_NO  =RTRIM(:chr_l_refno_check);
         }
				

        int_stat_ctr=0;
	//while(strlen(p_STAT_VAL[int_stat_ctr].link_val) != 0)//Commented and && Cond added by Gouse for ISKB_6013 - Junk Chars in DAT File
        while((strlen(p_STAT_VAL[int_stat_ctr].link_val) != 0) && (strcmp(p_STAT_VAL[int_stat_ctr].link_val,"") != 0 ))
        {
            fprintf(INFO_FILE,"%d",identity_no);
            fprintf(INFO_FILE,"%s", p_STAT_VAL[int_stat_ctr].link_val); 
	    		fprintf(INFO_FILE,"=");
            fprintf(INFO_FILE,"%s\n", p_STAT_VAL[int_stat_ctr].link_tag);
            int_stat_ctr++; 
        }
		

		
		if((strcmp(p_msg_no,"535B") == 0 || strcmp(p_msg_no,"571") == 0))	
		{
			if(!strlen(chr_mstacc_new))	
			{
				strcpy(chr_mstacc_new,(*p_SEL_VAL)[6].link_tag);
				strcpy(chr_client_new,(*p_SEL_VAL)[9].link_tag);
					if(strcmp(p_STAT_VAL[21].link_tag,"N") == 0)
						tot_portfolio_amt_new = tot_portfolio_amt_new - atof(p_STAT_VAL[15].link_tag);
					else
						tot_portfolio_amt_new = tot_portfolio_amt_new + atof(p_STAT_VAL[15].link_tag);
			}
			else
			{
				if(strcmp(p_STAT_VAL[11].link_tag,"Y") == 0)	
				{
					if(strcmp(chr_mstacc_new,(*p_SEL_VAL)[6].link_tag) == 0)	
					{
						memset(chr_mstacc_new,APL_NULL_CHAR,APL_CLIENT_LENGTH);
						memset(chr_client_new,APL_NULL_CHAR,APL_CLIENT_LENGTH);
						strcpy(chr_mstacc_new,(*p_SEL_VAL)[6].link_tag);
						strcpy(chr_client_new,(*p_SEL_VAL)[9].link_tag);
							if(strcmp(p_STAT_VAL[21].link_tag,"N") == 0)
								tot_portfolio_amt_new = tot_portfolio_amt_new - atof(p_STAT_VAL[15].link_tag);
							else
								tot_portfolio_amt_new = tot_portfolio_amt_new + atof(p_STAT_VAL[15].link_tag);
					}
					else	
					{
					
						fgetpos(INFO_FILE,&l_curr_pos);
						l_insert_pos = l_insert_pos -2;
						fsetpos(INFO_FILE,&l_insert_pos);
						fflush(INFO_FILE);
						
						fprintf(INFO_FILE,"%s","Y");
						memset(chr_mstacc_new,APL_NULL_CHAR,APL_CLIENT_LENGTH);
						memset(chr_client_new,APL_NULL_CHAR,APL_CLIENT_LENGTH);
						strcpy(chr_mstacc_new,(*p_SEL_VAL)[6].link_tag);
						strcpy(chr_client_new,(*p_SEL_VAL)[9].link_tag);
						tot_portfolio_amt_new=0;
							if(strcmp(p_STAT_VAL[21].link_tag,"N") == 0)
								tot_portfolio_amt_new = tot_portfolio_amt_new - atof(p_STAT_VAL[15].link_tag);
							else
								tot_portfolio_amt_new = tot_portfolio_amt_new + atof(p_STAT_VAL[15].link_tag);
						fsetpos(INFO_FILE,&l_curr_pos);
					}
				}
				else	
				{
					if(strcmp(chr_client_new,(*p_SEL_VAL)[9].link_tag) == 0)	
					{
						memset(chr_mstacc_new,APL_NULL_CHAR,APL_CLIENT_LENGTH);
						memset(chr_client_new,APL_NULL_CHAR,APL_CLIENT_LENGTH);
						strcpy(chr_mstacc_new,(*p_SEL_VAL)[6].link_tag);
						strcpy(chr_client_new,(*p_SEL_VAL)[9].link_tag);
							if(strcmp(p_STAT_VAL[21].link_tag,"N") == 0)
								tot_portfolio_amt_new = tot_portfolio_amt_new - atof(p_STAT_VAL[15].link_tag);
							else
								tot_portfolio_amt_new = tot_portfolio_amt_new + atof(p_STAT_VAL[15].link_tag);
					}
					else	
					{
					
						memset(chr_l_temp_str,APL_NULL_CHAR,25);
						fgetpos(INFO_FILE,&l_curr_pos);
						l_insert_pos = l_insert_pos - 2;
						fsetpos(INFO_FILE,&l_insert_pos);
						fflush(INFO_FILE);
						
						fprintf(INFO_FILE,"%s","Y");
						memset(chr_mstacc_new,APL_NULL_CHAR,APL_CLIENT_LENGTH);
						memset(chr_client_new,APL_NULL_CHAR,APL_CLIENT_LENGTH);
						strcpy(chr_mstacc_new,(*p_SEL_VAL)[6].link_tag);
						strcpy(chr_client_new,(*p_SEL_VAL)[9].link_tag);
						tot_portfolio_amt_new=0;
							if(strcmp(p_STAT_VAL[21].link_tag,"N") == 0)
								tot_portfolio_amt_new = tot_portfolio_amt_new - atof(p_STAT_VAL[15].link_tag);
							else
								tot_portfolio_amt_new = tot_portfolio_amt_new + atof(p_STAT_VAL[15].link_tag);
						fsetpos(INFO_FILE,&l_curr_pos);
					}
				}
			}

			if(tot_portfolio_amt_new < 0)
			{
				fprintf(INFO_FILE,"%d",identity_no);
				fprintf(INFO_FILE,"%s","NEW_NCONSTOTPORTFOLIO=N"); 
				fprintf(INFO_FILE,"%s\n",p_STAT_VAL[18].link_tag);
				fprintf(INFO_FILE,"%d",identity_no);
				fprintf(INFO_FILE,"%s","NEW_CONSTOTPORTFOLIO="); 
				fprintf(INFO_FILE,"%lf\n",fabs(tot_portfolio_amt_new));
				fprintf(INFO_FILE,"%d",identity_no);
				fprintf(INFO_FILE,"%s","CCYNEW_CONSTOTPORTFOLIO="); 
				fprintf(INFO_FILE,"%s\n",p_STAT_VAL[18].link_tag);
			}
			else
			{
				fprintf(INFO_FILE,"%d",identity_no);
				fprintf(INFO_FILE,"%s","NEW_NCONSTOTPORTFOLIO="); 
				fprintf(INFO_FILE,"%s\n",p_STAT_VAL[18].link_tag);
				fprintf(INFO_FILE,"%d",identity_no);
				fprintf(INFO_FILE,"%s","NEW_CONSTOTPORTFOLIO="); 
				fprintf(INFO_FILE,"%lf\n",tot_portfolio_amt_new);
				fprintf(INFO_FILE,"%d",identity_no);
				fprintf(INFO_FILE,"%s","CCYNEW_CONSTOTPORTFOLIO="); 
				fprintf(INFO_FILE,"%s\n",p_STAT_VAL[18].link_tag);
			}
			fprintf(INFO_FILE,"%d",identity_no);
			fprintf(INFO_FILE,"%s","NEW_CONSTOTPORTFOLIOIND"); 
			fprintf(INFO_FILE,"%s\n","=N");
			fgetpos(INFO_FILE,&l_insert_pos);	
		}
    }

	


if(identity_no > 0)
{
	if((strcmp(p_msg_no,"535B") == 0 || strcmp(p_msg_no,"571") == 0))	
	{
	
		memset(chr_l_temp_str,APL_NULL_CHAR,25);
		fgetpos(INFO_FILE,&l_curr_pos);	
		l_insert_pos = l_insert_pos -2;
		fsetpos(INFO_FILE,&l_insert_pos);	
		fflush(INFO_FILE);
		
		fprintf(INFO_FILE,"%s","Y");
		memset(chr_mstacc_new,APL_NULL_CHAR,APL_CLIENT_LENGTH);
		memset(chr_client_new,APL_NULL_CHAR,APL_CLIENT_LENGTH);
		strcpy(chr_mstacc_new,(*p_SEL_VAL)[6].link_tag);
		strcpy(chr_client_new,(*p_SEL_VAL)[9].link_tag);
		tot_portfolio_amt_new=0;
		fsetpos(INFO_FILE,&l_curr_pos);	
	}
}

     
	 if(APL_FAILURE == MS_Rtv_OTHValues(p_next_seq_no_15022,p_msg_no,2,*p_SEL_VAL,p_STAT_VAL,&identity_no,p_msg_seq_no,INFO_FILE,l_debug_info_ptr))
		APL_GOBACK_FAIL
    APL_GOBACK_SUCCESS;

RETURN_SUCCESS:

        CO_ProcMonitor(APL_OUT_FILE,"Exiting successfully  out of MS_Proc_SelectLst\n",NULL,NULL);
        *p_seq_no = identity_no;
        return APL_SUCCESS;

RETURN_FAILURE:
        CO_ProcMonitor(APL_OUT_FILE,"Exiting unsuccesfully out of MS_Proc_SelectLst\n",NULL,NULL);
        *p_seq_no = identity_no;
        return APL_FAILURE;

}

int MS_Rtv_DataFlName(char *chr_p_filename,long *p_msg_seq_no,DEBUG_INFO_STRUCT_H **l_debug_info_ptr)
{
PRO_GSEQNUM_STRUCT_H l_pro_gseqnum_struct_h_msg;
int int_returnval=0;

#ifdef APL_THREADS
        APL_SET_CONTEXT
        EXEC SQL CONTEXT USE :my_ctx_local;
#endif
strcpy(l_pro_gseqnum_struct_h_msg.sequencename,"MSGDAT");
strcpy(l_pro_gseqnum_struct_h_msg.seq_attrb_a,APL_NULL_STRING);
strcpy(l_pro_gseqnum_struct_h_msg.seq_attrb_b,APL_NULL_STRING);
strcpy(l_pro_gseqnum_struct_h_msg.seq_attrb_c,APL_NULL_STRING);
l_pro_gseqnum_struct_h_msg.last_usednum = 0;
l_pro_gseqnum_struct_h_msg.seq_start = 0;
l_pro_gseqnum_struct_h_msg.last_seqnum = 0;
l_pro_gseqnum_struct_h_msg.seq_stepby = 0;


      int_returnval = CO_RtvNxtSeqNum(&l_pro_gseqnum_struct_h_msg,l_debug_info_ptr);

      *p_msg_seq_no = int_returnval;

             strcpy(chr_p_filename,"T00");
             strcat(chr_p_filename,ltoa(int_returnval));
             strcat(chr_p_filename,".DAT");

APL_GOBACK_SUCCESS // AIX - Warnings

RETURN_SUCCESS:

        CO_ProcMonitor(APL_OUT_FILE,"Exiting successfully  out of IGenDataFile\n",NULL,NULL);

        return APL_SUCCESS;
/* AIX - Warnings
RETURN_FAILURE:
        CO_ProcMonitor(APL_OUT_FILE,"Exiting unsuccesfully out of IGenDataFile\n",NULL,NULL);
        return APL_FAILURE;
*/
}


int MT_Rtv_CashAcc(char *chr_p_client, 
							char *p_defccy_flg, 
							char *p_cash_acc,
							DEBUG_INFO_STRUCT_H **l_debug_info_ptr)
{

EXEC SQL BEGIN DECLARE SECTION;

char chr_h_gl_account[APL_CLIENT_LENGTH]=APL_NULL_STRING;
short i_ibbs_account=0;
char h_dl_client[APL_CLIENT_LENGTH] = APL_NULL_STRING;
char h_defcurrency_flg[APL_FLAG_LENGTH] =  APL_NULL_STRING;
char chr_h_iban_account[APL_IBANACC_LEN] = APL_NULL_STRING;
short i_iban_account=0;
EXEC SQL VAR chr_h_gl_account IS STRING;
EXEC SQL VAR chr_h_iban_account IS STRING;
EXEC SQL VAR h_dl_client IS STRING;
EXEC SQL VAR h_defcurrency_flg IS STRING;

EXEC SQL END DECLARE SECTION;

memset(chr_h_gl_account, APL_NULL_CHAR, APL_CLIENT_LENGTH);
memset(chr_h_iban_account,APL_NULL_CHAR,APL_IBANACC_LEN);

i_ibbs_account = 0;
i_iban_account = 0;
strcpy(h_dl_client, chr_p_client);
strcpy(h_defcurrency_flg, p_defccy_flg);

CO_ProcMonitor(APL_OUT_FILE,"Entered processtion MT_Rtv_CashAcc\n",NULL,NULL);
fflush(stdout);


sqlca.sqlcode=0L;

if(l_cond_ibanacc == 1)
{
	EXEC SQL SELECT IBAN_CLT INTO :chr_h_iban_account:i_iban_account
		FROM DL_CASHCLT
		WHERE CLIENT = :h_dl_client AND 
		DEFAULT_CCY = :h_defcurrency_flg;
		
		IS_ANY_ORA_ERROR

	if(strcmp(chr_h_iban_account,APL_NULL_STRING)==0)
	{
	   EXEC SQL SELECT IBAN_CLT INTO :chr_h_iban_account:i_iban_account
		FROM DL_CASHCLT
		WHERE CLIENT = :h_dl_client 
		AND DEFAULT_CCY = 'X'
		AND ROWNUM < 2;

		IS_ANY_ORA_ERROR
	
		if(strcmp(chr_h_iban_account,APL_NULL_STRING)==0)
		{
		   EXEC SQL SELECT GL_ACCOUNT INTO :chr_h_iban_account:i_iban_account
			FROM DL_CASHCLT
			WHERE CLIENT = :h_dl_client
			AND DEFAULT_CCY = :h_defcurrency_flg;

			IS_ANY_ORA_ERROR

	if(strcmp(chr_h_iban_account,APL_NULL_STRING)==0)
	{
	   EXEC SQL SELECT GL_ACCOUNT INTO :chr_h_iban_account:i_iban_account
			FROM DL_CASHCLT
			WHERE CLIENT = :h_dl_client AND
			DEFAULT_CCY ='X'
			AND ROWNUM < 2;	

		IS_ANY_ORA_ERROR
	
	   if(sqlca.sqlcode == 	1403)
	   {
		EXEC SQL SELECT IBAN_CLT INTO :chr_h_iban_account:i_iban_account
				FROM DL_CASHCLT
			WHERE CLIENT = :h_dl_client AND
			DEFAULT_CCY ='Y';

			IS_ANY_ORA_ERROR
	
		if(strcmp(chr_h_iban_account,APL_NULL_STRING)==0)
		{
		   EXEC SQL SELECT GL_ACCOUNT INTO :chr_h_iban_account:i_iban_account
			FROM DL_CASHCLT
			WHERE CLIENT = :h_dl_client AND
			DEFAULT_CCY = 'Y';
		
			IS_ANY_ORA_ERROR
   
		   if(sqlca.sqlcode == 1403)
		   {
			EXEC SQL SELECT IBAN_CLT INTO :chr_h_iban_account:i_iban_account
				FROM DL_CASHCLT
				WHERE CLIENT = :h_dl_client AND
				GL_ACCOUNT = (SELECT CLN_GL_ACCOUNT FROM MT_CLIENT
						WHERE CLIENT = :h_dl_client)
				AND ROWNUM < 2;
				
			   IS_ANY_ORA_ERROR	

			if(strcmp(chr_h_iban_account,APL_NULL_STRING)==0)
			{
			   EXEC	SQL SELECT CLN_GL_ACCOUNT INTO :chr_h_iban_account:i_iban_account
				FROM MT_CLIENT
				WHERE CLN_CODE = :h_dl_client;

				IS_ANY_ORA_ERROR
			}	
		    }
		}
	    }
	}
	}
	}
	strcpy(p_cash_acc,chr_h_iban_account);
}
else
{	
EXEC SQL SELECT GL_ACCOUNT INTO :chr_h_gl_account:i_ibbs_account
		FROM DL_CASHCLT
		WHERE CLIENT = :h_dl_client AND
				DEFAULT_CCY = :h_defcurrency_flg;

IS_ANY_ORA_ERROR

if(sqlca.sqlcode == 1403 )
{
	sqlca.sqlcode=0L;
	EXEC SQL SELECT GL_ACCOUNT INTO :chr_h_gl_account:i_ibbs_account
		FROM DL_CASHCLT
		WHERE CLIENT = :h_dl_client AND
				DEFAULT_CCY = 'Y';

	IS_ANY_ORA_ERROR

	if(sqlca.sqlcode == 1403 )
	{
		sqlca.sqlcode=0L;
		EXEC SQL SELECT CLN_GL_ACCOUNT INTO :chr_h_gl_account:i_ibbs_account
			FROM MT_CLIENT
			WHERE CLN_CODE = :h_dl_client;

		IS_ANY_ORA_ERROR
	}
}

strcpy(p_cash_acc, chr_h_gl_account);
}

APL_GOBACK_SUCCESS



       RETURN_SUCCESS:

        APL_IF_DEBUG
         {
            CO_ProcMonitor(APL_OUT_FILE,"Exiting successfully out of MT_Rtv_CashAcc\n",NULL,NULL);
         }
        return APL_SUCCESS;

        RETURN_FAILURE:

        APL_IF_DEBUG
         {
            CO_ProcMonitor(APL_OUT_FILE,"Exiting unsuccessfully out of MT_Rtv_CashAcc\n",NULL,NULL);
         }
         return APL_FAILURE;
}

int MS_Proc_SelectLstIPO(char *p_msg_no,MS_STATIC_VAL *p_STAT_VAL,MS_STATIC_VAL **p_SEL_VAL,int *p_seq_no,SQLDA *bind_dp,SQLDA *select_dp,char *p_sel_msg_stmt,DEBUG_INFO_STRUCT_H **l_debug_info_ptr)//AIX - Warnings Removal
{
    int dbl_i, int_null_ok, int_precision, int_scale,int_nlen=0;
    char chr_colname[201],*chr_posofspace;
	 
	 int int_l_new_sch_ind=0;

	 int identity_no=0,int_ndatalen=0,int_stat_ctr=0,int_sel_ctr=0,int_sel_flg=0,int_mem_sel_ctr=0;


  
  char     chr_l_client_check[APL_CLIENT_LENGTH]      = APL_NULL_STRING;
  char     chr_l_refno_check[APL_TXNREFNO_LEN]       = APL_NULL_STRING;
  
 
  char chr_l_reverse_check[2] = APL_NULL_STRING;
  char chr_l_weekly_check[2] = APL_NULL_STRING;
  char chr_l_hist_check[2] = APL_NULL_STRING;
  char chr_sys_access_stamp[APL_DATE_LEN];
	 


		double tot_portfolio_amt_new=0;
		char chr_client_new[APL_CLIENT_LENGTH];
		char chr_mstacc_new[APL_CLIENT_LENGTH];
		char chr_l_temp_str[25]=APL_NULL_STRING;
		//fpos_t l_curr_pos=0;  /*Commented for Linux Mig*/
		//fpos_t l_insert_pos=0;  /*Commented for Linux Mig*/
                long long l_curr_pos=0;  /*Added for Linux Mig*/
                long long l_insert_pos=0; /*Added for Linux Mig*/
		

    struct sqlca sqlca;
    #ifdef APL_THREADS
        APL_SET_CONTEXT
        EXEC SQL CONTEXT USE :my_ctx_local;
    #endif
    memset(chr_colname,APL_NULL_CHAR,201);


	
	memset(chr_mstacc_new,APL_NULL_CHAR,APL_CLIENT_LENGTH);
	memset(chr_client_new,APL_NULL_CHAR,APL_CLIENT_LENGTH);
	memset(chr_l_temp_str,APL_NULL_CHAR,25);

		
    identity_no = *p_seq_no;
    if ((strncmp(p_sel_msg_stmt, "SELECT", 6) != 0) &&
        (strncmp(p_sel_msg_stmt, "select", 6) != 0))
    {
        select_dp->F = 0;
        APL_GOBACK_FAIL;
    }

    

    select_dp->N = MAX_ITEMS;

    EXEC SQL DESCRIBE SELECT LIST FOR S INTO select_dp;

    IS_ANY_ORA_ERROR

    

    
    select_dp->N = select_dp->F;
    for (dbl_i = 0; dbl_i < select_dp->F; dbl_i++)
    {
        
        sqlnul (&(select_dp->T[dbl_i]), &(select_dp->T[dbl_i]), &int_null_ok);

        switch (select_dp->T[dbl_i])
        {
			
            case 1: case 96 : 
                break;
            case  2 : 
                sqlprc (&(select_dp->L[dbl_i]), &int_precision, &int_scale);
                      
                if (int_precision == 0) int_precision = 40;
                      
                
                if (int_scale > 0)
                    select_dp->L[dbl_i] = sizeof(double);
                else
                    select_dp->L[dbl_i] = sizeof(int);
                break;

            case  8 : 
                select_dp->L[dbl_i] = 240;
                break;

			
            case 11: case 69: case 104 : 
                select_dp->L[dbl_i] = 18;

            case 12 : 
                select_dp->L[dbl_i] = 19;
					 break;

			
		   
				default :
					 select_dp->T[dbl_i]=1;
        }
        

//START - Changes done by Sanket Savla for IB_7214 for avoiding Memory corruption
         if (select_dp->T[dbl_i] != 2)
	{
           select_dp->V[dbl_i] = (char *) realloc(select_dp->V[dbl_i],
                                    select_dp->L[dbl_i] + 1);
		memset(select_dp->V[dbl_i],APL_NULL_CHAR,select_dp->L[dbl_i] + 1);
	}
         else
	{
           select_dp->V[dbl_i] = (char *) realloc(select_dp->V[dbl_i],
                                    select_dp->L[dbl_i]);
		memset(select_dp->V[dbl_i],APL_NULL_CHAR,select_dp->L[dbl_i]);
	}


        
        if (select_dp->T[dbl_i] != 24 && select_dp->T[dbl_i] != 2)
            select_dp->T[dbl_i] = 1;

        
        if (select_dp->T[dbl_i] == 2)
        { // AIX - Warnings
          if (int_scale > 0)
             select_dp->T[dbl_i] = 4;  
          else
             select_dp->T[dbl_i] = 3;  
        }
    }
     

    
    for (;;)
    {
        EXEC SQL FETCH sel_data_cur USING DESCRIPTOR select_dp;

		
        if(sqlca.sqlcode == 1403)
		break;

		
				
				int_mem_sel_ctr = 0;
            while((strlen((*p_SEL_VAL)[int_mem_sel_ctr].link_val) != 0) && (strcmp((*p_SEL_VAL)[int_mem_sel_ctr].link_val," ") != 0))
				{
               memset((*p_SEL_VAL)[int_mem_sel_ctr].link_tag,APL_NULL_CHAR,501);
					
					int_mem_sel_ctr++;
				}


        
        for (dbl_i = 0; dbl_i < select_dp->F; dbl_i++)
        {

	
	

           memset(chr_colname,APL_NULL_CHAR,201);
           chr_posofspace = strstr(select_dp->S[dbl_i]," ");
           if(chr_posofspace == NULL)
                strcpy(chr_colname,select_dp->S[dbl_i]);
           else
           {
                int_nlen = chr_posofspace - select_dp->S[dbl_i];
                strncpy(chr_colname,select_dp->S[dbl_i],int_nlen);
           }

		   
            int_sel_ctr=0;
            int_sel_flg=0;
            while(strlen((*p_SEL_VAL)[int_sel_ctr].link_val) != 0)
            {
                if(strcmp((*p_SEL_VAL)[int_sel_ctr].link_val,chr_colname) == 0)
               {
                        int_sel_flg=1;
								break;
 					}
                if(strcmp((*p_SEL_VAL)[int_sel_ctr].link_val,"DUMMY") == 0)
                {
                     strcpy((*p_SEL_VAL)[int_sel_ctr].link_tag,"DUMMY");
						}
                int_sel_ctr++;
                
            }

            
            if (*select_dp->I[dbl_i] < 0)
            {
                if (select_dp->T[dbl_i] == 4)
                {
                  if(int_sel_flg == 1)
                  {
                     strcpy((*p_SEL_VAL)[int_sel_ctr].link_tag," ");
		    				 (*p_SEL_VAL)[int_sel_ctr].NUM_VAL = 0;
		 				 }
                }
                else
                {
                  if(int_sel_flg == 1)
                     strcpy((*p_SEL_VAL)[int_sel_ctr].link_tag," ");
                }
            }
            else
            {
                if (select_dp->T[dbl_i] == 3)     
                {
                  if(int_sel_flg == 1)
							{
                     (*p_SEL_VAL)[int_sel_ctr].NUM_VAL = *(int *)select_dp->V[dbl_i];
                     //sprintf((*p_SEL_VAL)[int_sel_ctr].link_tag, "%lf",*(int *)select_dp->V[dbl_i]); CHanges done for AIX Migration
                     sprintf((*p_SEL_VAL)[int_sel_ctr].link_tag, "%d",*(int *)select_dp->V[dbl_i]);
							}
            	 }
                else if (select_dp->T[dbl_i] == 4)     
                {
                  if(int_sel_flg == 1)
						{
                     (*p_SEL_VAL)[int_sel_ctr].NUM_VAL = *(double *)select_dp->V[dbl_i];
                     sprintf((*p_SEL_VAL)[int_sel_ctr].link_tag  ,"%lf",*(double *)select_dp->V[dbl_i]);
						}
					}	
                else                          
				{
                  int_ndatalen = (int)select_dp->L[dbl_i];
                  if(int_sel_flg == 1)
                  {
                        memset((*p_SEL_VAL)[int_sel_ctr].link_tag,APL_NULL_CHAR,501);
								
                        exec sql select length(rtrim(substr(:select_dp->V[dbl_i],1,:select_dp->L[dbl_i]))) into 
                        :int_ndatalen from dual;
                    	 strncpy((*p_SEL_VAL)[int_sel_ctr].link_tag,select_dp->V[dbl_i],int_ndatalen);
                    	strcat((*p_SEL_VAL)[int_sel_ctr].link_tag,APL_NULL_STRING);
											
                  }
             } 
	      }
	}
}
APL_GOBACK_SUCCESS


RETURN_SUCCESS:

        CO_ProcMonitor(APL_OUT_FILE,"Exiting successfully  out of MS_Proc_SelectLstIPO\n",NULL,NULL);
        *p_seq_no = identity_no;
	return APL_SUCCESS;

RETURN_FAILURE:
        CO_ProcMonitor(APL_OUT_FILE,"Exiting unsuccesfully out of MS_Proc_SelectLstIPO\n",NULL,NULL);
        *p_seq_no = identity_no;
        return APL_FAILURE;
}
