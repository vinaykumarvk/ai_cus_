/*	********************************************************************************
 *    COPYRIGHT NOTICE
 *
 *   Copyright 2005 Polaris Software Lab Limited. All rights reserved.
 *
 *   These materials are confidential and proprietary to 
 *    Polaris Software Lab Limited and no part of these materials should
 *    be reproduced, published, transmitted or distributed in any form or
 *    by any means, electronic, mechanical, photocopying, recording or 
 *    otherwise, or stored in any information storage or retrieval system
 *    of any nature nor should the materials be disclosed to third parties
 *    or used in any other manner for which this is not authorized, without
 *    the prior express written authorization of Polaris Software Lab Limited.
 ***********************************************************************************/

#define APL_MSG_REF_NO_LEN	35 
#define APL_EVENT_TYPE_LEN 2
#define APL_MSG_FUNC_LEN	35 
#define APL_MSGSTS_LEN 3

#include <stdlib.h>
#include <string.h>
#include "CR_Common.h"
#include "Intellect_Common.h"
#include "IV_Control_A.h"
#include "DL_Interface.h"
#include "Df_Fe.h"
#include "CO_Commdef.h"
#include "MS_Swift.h"

char 		 	chr_g_client[APL_CLIENT_LENGTH] 	= APL_NULL_STRING;
char			g_refno[17] 							= APL_NULL_STRING;
char			chr_g_msg_no[MS_MSGNO_LEN] 		= APL_NULL_STRING;
char 			g_msgrefno[APL_MSG_REF_NO_LEN] 	= APL_NULL_STRING;
char   		g_receivedon[APL_DATE_LEN] 		= APL_NULL_STRING;
char  		g_msgfunc[APL_MSG_FUNC_LEN] 		= APL_NULL_STRING;
char 			g_secode[APL_INSTRUMENTCODE_LEN] = APL_NULL_STRING;
char 			g_event_type[APL_EVENT_TYPE_LEN] = APL_NULL_STRING;
char 			g_catrd[2] 								= APL_NULL_STRING;
char 			g_rec_from_sent_to[APL_CLIENT_LENGTH] = APL_NULL_STRING;
char 			g_msgsts[APL_MSGSTS_LEN] 			= APL_NULL_STRING;

short			g_refno_ind = 1;
short			g_account_ind = 1;
short			g_msg_no_ind = 1;
short			g_msgrefno_ind = 1;
short			g_receivedon_ind =1;
short			g_msgfunc_ind = 1;
short			g_secode_ind = 1;
short			g_event_type_ind = 1;
short			g_rec_from_sent_to_ind = 1;
short 		g_msgsts_ind= 1;
short 		g_catrd_ind = 1;

  EXEC SQL INCLUDE SQLCA;
  
  
  
int SetIncCommFlg(char *p_rep_date, char *p_msg_stat,FILE *p_fl_userlog_a,DEBUG_INFO_STRUCT_H **l_debug_info_ptr)
{

	EXEC SQL BEGIN DECLARE SECTION;
	struct sqlca sqlca;
	EXEC SQL END DECLARE SECTION;
	sqlca.sqlcode = 0L;
	fflush(stdout);
/*	printf("\n p_msg_stat= |%s|  p_rep_date= |%s| g_refno=|%s| g_refno_ind=  |%d| chr_g_msg_no=|%s| g_msg_no_ind =|%d|  g_receivedon=|%s| g_receivedon_ind =|%d| g_msgfunc = |%s| g_msgfunc_ind = |%d| g_msgrefno = |%s| g_msgrefno_ind= |%d| g_event_type = |%s|  g_event_type_ind = |%d| g_secode = |%s| g_secode_ind = |%d| g_rec_from_sent_to=|%s| g_rec_from_sent_to_ind =|%d| chr_g_client= |%s| g_account_ind = |%d| ", p_msg_stat	  ,p_rep_date,g_refno,g_refno_ind,chr_g_msg_no,g_msg_no_ind ,g_receivedon,g_receivedon_ind,g_msgfunc,g_msgfunc_ind,g_msgrefno,g_msgrefno_ind,g_event_type ,g_event_type_ind,g_secode,g_secode_ind,g_rec_from_sent_to,g_rec_from_sent_to_ind,chr_g_client,g_account_ind ); */

	fflush(stdout);
	printf("\n Before Updating ");
	EXEC SQL UPDATE DF_COMMON_MSGRPT 
		SET REP_FLG = 'Y'
		WHERE MSG_STS = DECODE(:p_msg_stat,'ALL',MSG_STS,:p_msg_stat)
		AND REP_FLG = 'N'
		AND (to_char(RECEIVED_ON,'DD/MM/YYYY') <= to_char(to_date(:g_receivedon,'DD/MM/YYYY'),'DD/MM/YYYY'))
		AND (REF_NO = :g_refno OR :g_refno_ind = 0)
		AND (MSG_NO = :chr_g_msg_no OR :g_msg_no_ind =0 )
		/*AND (to_char(RECEIVED_ON,'DD/MM/YYYY') = to_char(to_date(:g_receivedon,'dd/mm/yyyy'), 'dd/mm/yyyy') OR :g_receivedon_ind =0)*/
		AND (MSG_FUNC = :g_msgfunc OR :g_msgfunc_ind = 0)
		AND (MSG_REF_NO = :g_msgrefno OR :g_msgrefno_ind = 0)
		AND (event_type = :g_event_type OR :g_event_type_ind = 0)
		AND (INSTR_CODE = :g_secode OR :g_secode_ind = 0)
		AND (REC_FROM_SENT_TO = :g_rec_from_sent_to OR :g_rec_from_sent_to_ind = 0)
		AND (IN_OUT = 'I')
		AND (ACCOUNT = :chr_g_client OR :g_account_ind = 0);
	printf("\n rows updated = |%d| ",sqlca.sqlerrd[2]);
	IS_ANY_ORA_ERROR;

	APL_GOBACK_SUCCESS;

RETURN_SUCCESS:
	{
		CO_ProcMonitor(APL_OUT_FILE, "Exiting Out Of SetIncCommFlg successfully\n",
				NULL, NULL);
		return(APL_SUCCESS);
	}

RETURN_FAILURE:
	{
		CO_ProcMonitor(APL_OUT_FILE, "Exiting Out Of SetIncCommFlg unsuccessfully\n",
				l_debug_info_ptr, NULL);
		return(APL_FAILURE);
	}
}
  
  
  
int main(int argc,char *argv[])
{
	struct sqlca sqlca; 
	int i,j;
	char chr_intl_msg_arch_dir[PATH_LENGTH],chr_report_dir[PATH_LENGTH],chr_path[PATH_LENGTH];
	char chr_l_sesaminipath[PATH_LENGTH] = APL_NULL_STRING;
	char  **chr_param_list=(char **)NULL;
	int   int_no_elm = 0;
	FILE *fp_SesamIni = (FILE *) NULL;
	DEBUG_INFO_STRUCT_H   *l_debug_info_struct = NULL, **l_debug_info_ptr = &l_debug_info_struct;

	EXEC SQL BEGIN DECLARE SECTION;

		char chr_custody_id_b[APL_USERID_LEN];
		char chr_uname[APL_USERID_LEN];
		char chr_passwd[APL_PASSWD_LEN];
		EXEC SQL VAR chr_uname 			IS STRING;
		EXEC SQL VAR chr_passwd 		IS STRING;
		EXEC SQL VAR chr_g_client 		IS STRING;
		EXEC SQL VAR chr_g_msg_no 		IS STRING;
		EXEC SQL VAR g_msgfunc 			IS STRING;
		EXEC SQL VAR g_receivedon 		IS STRING;
		EXEC SQL VAR g_msgrefno 		IS STRING;
		EXEC SQL VAR g_refno 			IS STRING;
		EXEC SQL VAR g_rec_from_sent_to IS STRING;
		EXEC SQL VAR g_secode 			IS STRING;
		EXEC SQL VAR g_event_type 		IS STRING;
		EXEC SQL VAR chr_uname 			IS STRING;
		EXEC SQL VAR chr_passwd 		IS STRING;
		EXEC SQL VAR g_msgsts 			IS STRING;
		EXEC SQL VAR g_catrd 			IS STRING;

	EXEC SQL END DECLARE SECTION;

	if(CO_Get_DBConnect(l_debug_info_ptr) == APL_FAILURE)
	{
		APL_GOBACK_FAIL
	}

	if (  CO_SplitStr(argv[9],'|',&int_no_elm,&chr_param_list) == APL_FAILURE)
	{
		CO_ProcMonitor(APL_OUT_FILE,"Split String Function returned failure",NULL,NULL);
		APL_GOBACK_FAIL
	}

	if (APL_DEBUG_YES)
	{
		printf("arg0 %s \n", argv[0]);
		printf("arg1 %s\n ", argv[1]);
		printf("arg2 %s \n", argv[2]);
		printf("arg3 %s \n", argv[3]);
		printf("arg4 %s \n", argv[4]);
		printf("arg5 %s \n", argv[5]);
		printf("arg6 %s \n", argv[6]);
		printf("arg7 %s \n", argv[7]);
		printf("arg8 %s \n", argv[8]);
		printf("arg9 %s \n", argv[9]);
		printf("event type1 %s\n",chr_param_list[0]);
		printf("account2  %s \n",chr_param_list[1]);
		printf("msgno3 %s\n ",chr_param_list[2]);
		printf("msgfunc4 %s\n",chr_param_list[3]);
		printf("receivedon5 %s\n",chr_param_list[4]);
		printf("msgrefno6 %s \n",chr_param_list[5] );
		printf("g_refno7 %s \n",chr_param_list[6]);
		printf("g_rec_from_sent_to8 %s\n",chr_param_list[7]);
		printf("g_secode9 %s\n",chr_param_list[8]);
		printf("g_msgsts10 %s\n",chr_param_list[9]);
		printf("g_catrd11 %s\n",chr_param_list[10]);
	}
	strcpy(g_event_type,chr_param_list[0]);
	strcpy(chr_g_client,chr_param_list[1]);
	strcpy(chr_g_msg_no,chr_param_list[2]);
	strcpy(g_msgfunc,chr_param_list[3]);
	strcpy(g_receivedon,chr_param_list[4]);
	strcpy(g_msgrefno,chr_param_list[5]);
	strcpy(g_refno,chr_param_list[6]);
	strcpy(g_rec_from_sent_to,chr_param_list[7]);
	strcpy(g_secode,chr_param_list[8]);
	strcpy(g_msgsts,chr_param_list[9]);
	strcpy(g_catrd,chr_param_list[10]);

	if (strcmp(g_msgsts,APL_NULL_STRING)==0)
		g_msgsts_ind=0;

	if (strcmp(g_catrd,APL_NULL_STRING)==0)
		g_catrd_ind=0;

	if (strcmp(chr_g_client,APL_NULL_STRING)==0)
		g_account_ind=0;

	if (strcmp(chr_g_client,APL_NULL_STRING)==0)
		g_account_ind=0;

	if (strcmp(chr_g_msg_no,APL_NULL_STRING)==0)
		g_msg_no_ind=0;


	if (strcmp(g_receivedon,APL_NULL_STRING)==0)
		g_receivedon_ind=0;


	if (strcmp(g_msgfunc,APL_NULL_STRING)==0)
		g_msgfunc_ind=0;


	if (strcmp(g_msgrefno,APL_NULL_STRING)==0)
		g_msgrefno_ind=0;

	if (strcmp(g_refno,APL_NULL_STRING)==0)
		g_refno_ind=0;

	if (strcmp(g_event_type,APL_NULL_STRING)==0)
		g_event_type_ind=0;


	if (strcmp(g_secode,APL_NULL_STRING)==0)
		g_secode_ind=0;

	if (strcmp(g_rec_from_sent_to,APL_NULL_STRING)==0)
		g_rec_from_sent_to_ind=0;
	printf("\n **************** BEFORE CALLING GenIncCommRpt **********\n");

	if (APL_FAILURE == GenIncCommRpt(argv, fp_SesamIni, l_debug_info_ptr))
	{
		printf("Returned unsuccessfully from GenIncCommRpt\n");
		IS_ANY_ORA_ERROR
			APL_GOBACK_FAIL;
	}
	else
	{
		printf("Returned successfully from GenIncCommRpt.\n");
		IS_ANY_ORA_ERROR
			APL_GOBACK_SUCCESS;
	}

APL_GOBACK_SUCCESS;
RETURN_SUCCESS :
	printf("status completed %s|%s|%s\n",argv[0],argv[1],argv[2]);
	if(BT_Status_Completed(argv[0],
				argv[1],
				argv[2],
				l_debug_info_ptr)   ==  APL_FAILURE )
	{
		APL_GOBACK_FAIL
	}
	/* CO_Proc_RptClose(fp_SesamIni, l_debug_info_ptr); ....donno why this was done ???? */
	EXEC SQL COMMIT WORK;
	if(sqlca.sqlcode != 0)APL_GOBACK_FAIL
		exit(0);

RETURN_FAILURE    :
	printf(" Process Not completed %s|%s|%s\n",argv[0],argv[1],argv[2]);
	EXEC SQL ROLLBACK;
	/* CO_Proc_RptClose(fp_SesamIni, l_debug_info_ptr); ....donno why this was done ???? */
	exit(-1);

}
  
int MS_Chk_IncRptMsgAlrdyPrcd(FILE *p_fl_userlog_a, DEBUG_INFO_STRUCT_H **l_debug_info_ptr)
{
	EXEC SQL BEGIN DECLARE SECTION;
	int int_h_tmp_total1 = 0;
	int int_h_tmp_total2 = 0;
	struct sqlca sqlca;
	EXEC SQL END DECLARE SECTION;

	sqlca.sqlcode = 0L;

	EXEC SQL SELECT NVL(COUNT(*), 0)
		INTO :int_h_tmp_total1
		FROM  DF_COMMON_MSGRPT 
		WHERE REP_FLG = 'N';
	IS_ANY_ORA_ERROR

		APL_IF_DEBUG
		{
			printf("Testing for activity of Inc. Msg. daemon....\n");
		}
	fflush(stdout);
	sleep(5);

	EXEC SQL SELECT NVL(COUNT(*), 0)
		INTO :int_h_tmp_total2
		FROM DF_COMMON_MSGRPT 
		WHERE REP_FLG = 'N';
	IS_ANY_ORA_ERROR;

	if (int_h_tmp_total1 != int_h_tmp_total2)
	{
		fprintf(p_fl_userlog_a,"Incoming Messages Daemon is currently processing messages. \
				Please fire for report after sometime \n");

		APL_GOBACK_FAIL
	}

	APL_GOBACK_SUCCESS;

RETURN_SUCCESS:
	{
		CO_ProcMonitor(APL_OUT_FILE,"Exiting Out Of MS_Chk_IncRptMsgAlrdyPrcd successfully\n",NULL, NULL);
		fflush(APL_OUT_FILE);
		return(APL_SUCCESS);
	}

RETURN_FAILURE:
	{
		CO_ProcMonitor(APL_OUT_FILE,"Exiting Out Of MS_Chk_IncRptMsgAlrdyPrcd unsuccessfully\n", l_debug_info_ptr, NULL);
		fflush(APL_OUT_FILE);
		return(APL_FAILURE);
	}
}

  
int GenIncCommRpt(char **argv, FILE *p_fp_sesamini,DEBUG_INFO_STRUCT_H **l_debug_info_ptr)
{

	EXEC SQL BEGIN DECLARE SECTION;
	char chr_h_batch_in_proc_rowid[APL_ROWID_LEN] = APL_NULL_STRING;
	struct sqlca sqlca;
	EXEC SQL END DECLARE SECTION;
	char chr_l_repfilenm[PATH_LENGTH];
	char chr_l_date[APL_DATE_LEN] = APL_NULL_STRING;
	char chr_l_now[APL_DATE_LEN] = APL_NULL_STRING;
	FILE *fp_UserLog = (FILE *)NULL;
	FILE *fp_Report = (FILE *)NULL;
	char chr_l_reportpath[PATH_LENGTH], chr_l_archpath[PATH_LENGTH];
	sqlca.sqlcode = 0L;

	APL_IF_DEBUG
	{
		printf("to execute the   query\n");

	}

 
		EXEC SQL SELECT ROWID
		INTO :chr_h_batch_in_proc_rowid
		FROM    SYS_BATCHPROC
		WHERE   PROCESS_NAME  = RTRIM(:argv[0])
		AND     PROC_INIT     = RTRIM(:argv[1])
		AND     STARTDATE   = :argv[2]
		AND     STATUS      = 'started'
		FOR UPDATE OF STATUS;

		IS_ANY_ORA_ERROR

		APL_IF_DEBUG
		{
		printf("row id %s\n",chr_h_batch_in_proc_rowid);
		}

		if ( APL_ZERO_RESULT_SET )
		{
		fprintf(APL_OUT_FILE, "Record not int_found in Batch In Proc. with status_ind as started.\n");

		fflush(APL_OUT_FILE);
		APL_GOBACK_FAIL
		}

		if ( APL_FAILURE == CO_Rtv_RptFileName("5I", APL_LOGFILE_DESC, 100,argv[5], argv, &fp_UserLog, &l_debug_info_ptr) )
		{
			printf("Could not open User Log file.\n");
			APL_GOBACK_FAIL
		}

		APL_IF_DEBUG
		{
			printf("reached after opening the chr_log file");
		}

		memset(chr_l_reportpath, APL_NULL_CHAR, PATH_LENGTH);
		memset(chr_l_archpath, APL_NULL_CHAR, PATH_LENGTH);

		printf("Report Generation started.....\n");
		fprintf(fp_UserLog,"Report Generation started.....\n");

		if(Rtv_Dir_Path( "INTL_REP_PATH",
					chr_l_reportpath,
					l_debug_info_ptr) == APL_FAILURE)
		{
			APL_GOBACK_FAIL
		}
		if(Rtv_Dir_Path( "INTL_MSINC_ARC_PATH",
					chr_l_archpath,
					l_debug_info_ptr) == APL_FAILURE)
		{
			APL_GOBACK_FAIL
		}

		printf("Report Generation started. 1#...\n");
		if ( APL_FAILURE == CO_Rtv_RptFileName("5I", "Incoming Msg Report", 100,argv[5], argv, &fp_Report,l_debug_info_ptr) )
		{
			printf("\n Inside Failure ");
			fprintf(fp_UserLog, "Could not open User Log file.\n");
			fflush(fp_UserLog);
			APL_GOBACK_FAIL
		}
		fflush(stdout);

		printf("Report Generation started. X#...\n");

		memset(chr_l_repfilenm, APL_NULL_CHAR, PATH_LENGTH);
		printf("Report Generation started. 2#...\n");
		fprintf(fp_Report,"\n");  /*** Keep First line Blank ****/

		if ( APL_FAILURE == CO_Rtv_FileNm_From_Pointer(fp_Report, chr_l_reportpath,chr_l_repfilenm) )
		{
			fprintf(fp_UserLog, "Could not get Name of Report File knowing the pointer.\n");
			fflush(fp_UserLog);
			APL_GOBACK_FAIL
		}


		strcat(chr_l_reportpath, chr_l_repfilenm);

		APL_IF_DEBUG
		{
			printf("report file name %s \n",chr_l_repfilenm);
			printf("report file chr_path %s \n",chr_l_reportpath);

		}

		printf("Report Generation started. 3#...\n");

		if ( APL_FAILURE == CO_RtvMachDtTime(chr_l_now, l_debug_info_ptr) )
		{
			APL_GOBACK_FAIL
		}
		sscanf(chr_l_now, "%[^ ]",chr_l_date);
		strcat(chr_l_date,APL_NULL_TIME);
		APL_IF_DEBUG
		{
			printf("time  %s \n",chr_l_date);

		}
		fflush(stdout);
		fprintf(fp_Report,"***************************************************************************************************\n");
		fprintf(fp_Report,"%20s TRADE RELATED MESSAGES ( %s )\n","",chr_l_date);
		fprintf(fp_Report,"***************************************************************************************************\n");
		fprintf(fp_Report,"---------------------------------------------------------------------------------------------------\n");
		fprintf(fp_Report,"%10s MSG NO      : %s%15s  \n","",chr_g_msg_no,"");
		fprintf(fp_Report,"%10s RECEIVED ON : %s%15s  \n","",g_receivedon,"");
		fprintf(fp_Report,"---------------------------------------------------------------------------------------------------\n");
		fprintf(fp_Report,"%10s MSG STATUS  : %s%15s  ","",g_msgsts,"");
		/*** might be a macro should be here ****/
		if ( strcmp(g_msgsts,"STP") ==0 )
				fprintf(fp_Report,"( STRAIGHT THROUGH PROCESSED)");
		else if (!strcmp(g_msgsts,"RPR"))
				fprintf(fp_Report," ( REPAIR QUEUE MESSAGES )");
		else if (!strcmp(g_msgsts,"RJT"))
				fprintf(fp_Report," ( REJECTED MESSAGES)");
		else if (!strcmp(g_msgsts,"ALL"))
				fprintf(fp_Report," ( ALL MESSAGES)");

				
		fprintf(fp_Report,"\n---------------------------------------------------------------------------------------------------\n");
		/**** Support Team has put summary on hold 
		if ( APL_FAILURE ==GenCommSummary(fp_UserLog,fp_Report,chr_l_date, l_debug_info_ptr))
		{
			APL_GOBACK_FAIL
		} ***/

		if (APL_FAILURE == dump_message(fp_UserLog,fp_Report, chr_l_date,chr_l_archpath,chr_l_repfilenm,g_msgsts,l_debug_info_ptr))
		{
			APL_GOBACK_FAIL
		}

		if (APL_FAILURE == SetIncCommFlg(chr_l_date, g_msgsts, fp_UserLog, l_debug_info_ptr))
		{
			APL_GOBACK_FAIL
		}

 
	EXEC SQL UPDATE SYS_BATCHPROC
	SET STATUS = 'completed'
	WHERE ((PROCESS_NAME = :argv[0])
	AND     PROC_INIT = RTRIM(:argv[1])
	AND     STARTDATE = :argv[2]
	AND (STATUS = 'started'));

	IS_ANY_ORA_ERROR

	if ( APL_ZERO_RESULT_SET )
	{
		fprintf(APL_OUT_FILE, "Record not int_found in Batch In Proc. for marking status_ind as completed.\n");
		fflush(APL_OUT_FILE);
		APL_GOBACK_FAIL
	}

APL_GOBACK_SUCCESS;

RETURN_SUCCESS:
{
	CO_ProcMonitor(APL_OUT_FILE, "Exiting Out Of MS_Prnt_IncMsgRpt successfully\n", NULL, NULL);
	fprintf(fp_UserLog,"Report Completed successfully.\n");
	fflush(APL_OUT_FILE);
	fclose(fp_Report);
	fclose(fp_UserLog);
	return(APL_SUCCESS);
}

RETURN_FAILURE:
{
	CO_ProcMonitor(APL_OUT_FILE, "Exiting Out Of MS_Prnt_IncMsgRpt unsuccessfully\n", l_debug_info_ptr, NULL);
	fprintf(fp_UserLog,"Report Generation has errors....\n");
	CO_ProcMonitor(fp_UserLog, APL_NULL_STRING, l_debug_info_ptr, NULL);
	fclose(fp_Report);
	fclose(fp_UserLog);
	return(APL_FAILURE);
}
}

int GenCommSummary(FILE *p_fp_userlog, FILE *p_fp_report,char *p_rep_date, DEBUG_INFO_STRUCT_H **l_debug_info_ptr)
{
	EXEC SQL BEGIN DECLARE SECTION;
	int i=0;
	int int_h_no_of_processed;
	int h_no_of_trdinp;
	int h_no_of_trdcanc;
	int h_no_of_trdinpSTP;
	int h_no_of_trdcancSTP;
	int h_no_of_trdinpRJT;
	int h_no_of_trdcancRJT;
	int h_no_of_trdinpRPR;
	int h_no_of_trdcancRPR;
	int h_no_of_trdsett;
	int h_no_of_trdsettRPR;
	int h_no_of_trdsettRJT; 	
	int h_no_of_trdsettSTP;
	int h_no_of_trdconf;
	int h_no_of_trdconfSTP;
	int h_no_of_trdconfRPR;
	int h_no_of_trdconfRJT;
	int h_no_of_evEnt;
	int h_no_of_evEntRJT;
	int h_no_of_evEntRPR;
	int h_no_of_evEntSTP;
	int h_no_of_evPayt;
	int h_no_of_evPaytRJT;
	int h_no_of_evPaytRPR;
	int h_no_of_evPaytSTP;
	int h_no_of_evInt;
	int h_no_of_evIntSTP;
	int h_no_of_evIntRPR;
	int h_no_of_evIntRJT;
	int h_no_of_ca;
	int int_h_no_of_trd;
	int h_no_of_trdupdufl;
	int h_no_of_trdupduflRPR;
	int h_no_of_trdupduflRJT;
	int h_no_of_trdupduflSTP;
	int h_no_of_carev;
	int h_no_of_carevRPR;
	int h_no_of_carevRJT;
	int h_no_of_carevSTP;
	int h_no_of_caresp;
	int h_no_of_carespRPR;
	int h_no_of_carespRJT;
	int h_no_of_carespSTP;
	int h_no_of_carights;
	int h_no_of_carightsRPR;
	int h_no_of_carightsRJT;
	int h_no_of_carightsSTP;
	int h_no_of_canarr;
	int h_no_of_canarrSTP;
	int h_no_of_canarrRPR;
	int h_no_of_canarrRJT;


	struct sqlca sqlca;


	EXEC SQL END DECLARE SECTION;



	APL_IF_DEBUG
	{	 
		printf("entered the function GenSummary\n");
		printf("global refno ind %d\n",g_refno_ind);

	}



	EXEC SQL SELECT NVL(COUNT(DISTINCT FILE_NAME), 0)
		INTO :int_h_no_of_processed
		FROM DF_COMMON_MSGRPT
		WHERE ((RECEIVED_ON = :p_rep_date) OR (RECEIVED_ON < :p_rep_date))
		AND (REP_FLG = 'N')
		AND (REF_NO = :g_refno OR :g_refno_ind = 0)
		AND (MSG_NO = :chr_g_msg_no OR :g_msg_no_ind =0 )
		AND (to_char(RECEIVED_ON,'DD/MM/YYYY') = to_char(to_date(:g_receivedon,'dd/mm/yyyy'), 'dd/mm/yyyy') OR :g_receivedon_ind =0)
		AND (MSG_FUNC = :g_msgfunc OR :g_msgfunc_ind = 0)
		AND (MSG_REF_NO = :g_msgrefno OR :g_msgrefno_ind = 0)
		AND (event_type = :g_event_type OR :g_event_type_ind = 0)
		AND (INSTR_CODE = :g_secode OR :g_secode_ind = 0)
		AND (REC_FROM_SENT_TO = :g_rec_from_sent_to OR :g_rec_from_sent_to_ind = 0)
		AND (IN_OUT = 'I')
		AND (ACCOUNT = :chr_g_client OR :g_account_ind = 0);

	/*
		EXEC SQL SELECT NVL(COUNT(DISTINCT FILE_NAME), 0)
INTO :int_h_no_of_processed
FROM DF_COMMON_MSGRPT;
*/
	printf("Sql code %d\n",sqlca.sqlcode); 


	IS_ANY_ORA_ERROR;


	APL_IF_DEBUG
	{
		printf("total no of messages processed %d\n",int_h_no_of_processed);

	}

	EXEC SQL SELECT NVL(COUNT(DISTINCT FILE_NAME), 0)
		INTO :h_no_of_trdinp
		FROM DF_COMMON_MSGRPT
		WHERE ((RECEIVED_ON = :p_rep_date) OR (RECEIVED_ON < :p_rep_date))
		AND (REP_FLG = 'N')
		AND (REF_NO = :g_refno OR :g_refno_ind = 0)
		AND (MSG_NO = :chr_g_msg_no OR :g_msg_no_ind =0 )
		AND (to_char(RECEIVED_ON,'DD/MM/YYYY') = to_char(to_date(:g_receivedon,'dd/mm/yyyy'), 'dd/mm/yyyy') OR :g_receivedon_ind =0)
		AND (MSG_REF_NO = :g_msgrefno OR :g_msgrefno_ind = 0)
		AND (event_type = :g_event_type OR :g_event_type_ind = 0)
		AND (INSTR_CODE = :g_secode OR :g_secode_ind = 0)
		AND (REC_FROM_SENT_TO = :g_rec_from_sent_to OR :g_rec_from_sent_to_ind = 0)
		AND (IN_OUT = 'I')
		AND (ACCOUNT = :chr_g_client OR :g_account_ind = 0)
		AND ((MSG_NO='541') OR (MSG_NO='540') OR (MSG_NO='542') OR (MSG_NO='543')) 
		AND MSG_FUNC='Trade-Input';

	IS_ANY_ORA_ERROR  

		EXEC SQL SELECT NVL(COUNT(DISTINCT FILE_NAME), 0)
		INTO :h_no_of_trdcanc
		FROM DF_COMMON_MSGRPT
		WHERE ((RECEIVED_ON = :p_rep_date) OR (RECEIVED_ON < :p_rep_date))
		AND (REP_FLG = 'N')
		AND (REF_NO = :g_refno OR :g_refno_ind = 0)
		AND (MSG_NO = :chr_g_msg_no OR :g_msg_no_ind =0 )
		AND (to_char(RECEIVED_ON,'DD/MM/YYYY') = to_char(to_date(:g_receivedon,'dd/mm/yyyy'), 'dd/mm/yyyy') OR :g_receivedon_ind =0)
		AND (MSG_FUNC = :g_msgfunc OR :g_msgfunc_ind = 0)
		AND (MSG_REF_NO = :g_msgrefno OR :g_msgrefno_ind = 0)
		AND (event_type = :g_event_type OR :g_event_type_ind = 0)
		AND (INSTR_CODE = :g_secode OR :g_secode_ind = 0)
		AND (REC_FROM_SENT_TO = :g_rec_from_sent_to OR :g_rec_from_sent_to_ind = 0)
		AND (IN_OUT = 'I')
		AND (ACCOUNT = :chr_g_client OR :g_account_ind = 0)
		AND ((MSG_NO='541') OR (MSG_NO='540') OR (MSG_NO='542') OR (MSG_NO='543'))
		AND MSG_FUNC = 'Trade-Canc';
	IS_ANY_ORA_ERROR

		EXEC SQL SELECT NVL(COUNT(DISTINCT FILE_NAME), 0)
		INTO :h_no_of_trdinpSTP
		FROM DF_COMMON_MSGRPT
		WHERE ((RECEIVED_ON = :p_rep_date) OR (RECEIVED_ON < :p_rep_date))
		AND (REP_FLG = 'N')
		AND (REF_NO = :g_refno OR :g_refno_ind = 0)
		AND (MSG_NO = :chr_g_msg_no OR :g_msg_no_ind =0 )
		AND (to_char(RECEIVED_ON,'DD/MM/YYYY') = to_char(to_date(:g_receivedon,'dd/mm/yyyy'), 'dd/mm/yyyy') OR :g_receivedon_ind =0)
		AND (MSG_FUNC = :g_msgfunc OR :g_msgfunc_ind = 0)
		AND (MSG_REF_NO = :g_msgrefno OR :g_msgrefno_ind = 0)
		AND (event_type = :g_event_type OR :g_event_type_ind = 0)
		AND (INSTR_CODE = :g_secode OR :g_secode_ind = 0)
		AND (REC_FROM_SENT_TO = :g_rec_from_sent_to OR :g_rec_from_sent_to_ind = 0)
		AND (IN_OUT = 'I')
		AND (ACCOUNT = :chr_g_client OR :g_account_ind = 0)
		AND ((MSG_NO='541') OR (MSG_NO='540') OR (MSG_NO='542') OR (MSG_NO='543'))
		AND MSG_FUNC = 'Trade-Input'
		AND MSG_STS ='STP';
	IS_ANY_ORA_ERROR



		EXEC SQL SELECT NVL(COUNT(DISTINCT FILE_NAME), 0)
		INTO :h_no_of_trdcancSTP
		FROM DF_COMMON_MSGRPT
		WHERE ((RECEIVED_ON = :p_rep_date) OR (RECEIVED_ON < :p_rep_date))
		AND (REP_FLG = 'N')
		AND (REF_NO = :g_refno OR :g_refno_ind = 0)
		AND (MSG_NO = :chr_g_msg_no OR :g_msg_no_ind =0 )
		AND (to_char(RECEIVED_ON,'DD/MM/YYYY') = to_char(to_date(:g_receivedon,'dd/mm/yyyy'), 'dd/mm/yyyy') OR :g_receivedon_ind =0)
		AND (MSG_FUNC = :g_msgfunc OR :g_msgfunc_ind = 0)
		AND (MSG_REF_NO = :g_msgrefno OR :g_msgrefno_ind = 0)
		AND (event_type = :g_event_type OR :g_event_type_ind = 0)
		AND (INSTR_CODE = :g_secode OR :g_secode_ind = 0)
		AND (REC_FROM_SENT_TO = :g_rec_from_sent_to OR :g_rec_from_sent_to_ind = 0)
		AND (IN_OUT = 'I')
		AND (ACCOUNT = :chr_g_client OR :g_account_ind = 0)
		AND ((MSG_NO='541') OR (MSG_NO='540') OR (MSG_NO='542') OR (MSG_NO='543'))
		AND MSG_FUNC = 'Trade-Canc'
		AND MSG_STS ='STP';

	IS_ANY_ORA_ERROR
		EXEC SQL SELECT NVL(COUNT(DISTINCT FILE_NAME), 0)
		INTO :h_no_of_trdinpRJT
		FROM DF_COMMON_MSGRPT
		WHERE ((RECEIVED_ON = :p_rep_date) OR (RECEIVED_ON < :p_rep_date))
		AND (REP_FLG = 'N')
		AND (REF_NO = :g_refno OR :g_refno_ind = 0)
		AND (MSG_NO = :chr_g_msg_no OR :g_msg_no_ind =0 )
		AND (to_char(RECEIVED_ON,'DD/MM/YYYY') = to_char(to_date(:g_receivedon,'dd/mm/yyyy'), 'dd/mm/yyyy') OR :g_receivedon_ind =0)
		AND (MSG_FUNC = :g_msgfunc OR :g_msgfunc_ind = 0)
		AND (MSG_REF_NO = :g_msgrefno OR :g_msgrefno_ind = 0)
		AND (event_type = :g_event_type OR :g_event_type_ind = 0)
		AND (INSTR_CODE = :g_secode OR :g_secode_ind = 0)
		AND (REC_FROM_SENT_TO = :g_rec_from_sent_to OR :g_rec_from_sent_to_ind = 0)
		AND (IN_OUT = 'I')
		AND (ACCOUNT = :chr_g_client OR :g_account_ind = 0)
		AND ((MSG_NO='541') OR (MSG_NO='540') OR (MSG_NO='542') OR (MSG_NO='543'))
		AND MSG_FUNC = 'Trade-Input'
		AND MSG_STS ='RJT';

	IS_ANY_ORA_ERROR

		EXEC SQL SELECT NVL(COUNT(DISTINCT FILE_NAME), 0)
		INTO :h_no_of_trdcancRJT
		FROM DF_COMMON_MSGRPT
		WHERE ((RECEIVED_ON = :p_rep_date) OR (RECEIVED_ON < :p_rep_date))
		AND (REP_FLG = 'N')
		AND (REF_NO = :g_refno OR :g_refno_ind = 0)
		AND (MSG_NO = :chr_g_msg_no OR :g_msg_no_ind =0 )
		AND (to_char(RECEIVED_ON,'DD/MM/YYYY') = to_char(to_date(:g_receivedon,'dd/mm/yyyy'), 'dd/mm/yyyy') OR :g_receivedon_ind =0)
		AND (MSG_FUNC = :g_msgfunc OR :g_msgfunc_ind = 0)
		AND (MSG_REF_NO = :g_msgrefno OR :g_msgrefno_ind = 0)
		AND (event_type = :g_event_type OR :g_event_type_ind = 0)
		AND (INSTR_CODE = :g_secode OR :g_secode_ind = 0)
		AND (REC_FROM_SENT_TO = :g_rec_from_sent_to OR :g_rec_from_sent_to_ind = 0)
		AND (IN_OUT = 'I')
		AND (ACCOUNT = :chr_g_client OR :g_account_ind = 0)
		AND ((MSG_NO='541') OR (MSG_NO='540') OR (MSG_NO='542') OR (MSG_NO='543'))
		AND MSG_FUNC = 'Trade-Canc'
		AND MSG_STS ='RJT';
	IS_ANY_ORA_ERROR
		EXEC SQL SELECT NVL(COUNT(DISTINCT FILE_NAME), 0)
		INTO :h_no_of_trdinpRPR
		FROM DF_COMMON_MSGRPT
		WHERE ((RECEIVED_ON = :p_rep_date) OR (RECEIVED_ON < :p_rep_date))
		AND (REP_FLG = 'N')
		AND (REF_NO = :g_refno OR :g_refno_ind = 0)
		AND (MSG_NO = :chr_g_msg_no OR :g_msg_no_ind =0 )
		AND (to_char(RECEIVED_ON,'DD/MM/YYYY') = to_char(to_date(:g_receivedon,'dd/mm/yyyy'), 'dd/mm/yyyy') OR :g_receivedon_ind =0)
		AND (MSG_FUNC = :g_msgfunc OR :g_msgfunc_ind = 0)
		AND (MSG_REF_NO = :g_msgrefno OR :g_msgrefno_ind = 0)
		AND (event_type = :g_event_type OR :g_event_type_ind = 0)
		AND (INSTR_CODE = :g_secode OR :g_secode_ind = 0)
		AND (REC_FROM_SENT_TO = :g_rec_from_sent_to OR :g_rec_from_sent_to_ind = 0)
		AND (IN_OUT = 'I')
		AND (ACCOUNT = :chr_g_client OR :g_account_ind = 0)
		AND ((MSG_NO='541') OR (MSG_NO='540') OR (MSG_NO='542') OR (MSG_NO='543'))
		AND MSG_FUNC = 'Trade-Input'
		AND MSG_STS ='RPR';
	IS_ANY_ORA_ERROR;

		EXEC SQL SELECT NVL(COUNT(DISTINCT FILE_NAME), 0)
		INTO :h_no_of_trdcancRPR
		FROM DF_COMMON_MSGRPT
		WHERE ((RECEIVED_ON = :p_rep_date) OR (RECEIVED_ON < :p_rep_date))
		AND (REP_FLG = 'N')
		AND (REF_NO = :g_refno OR :g_refno_ind = 0)
		AND (MSG_NO = :chr_g_msg_no OR :g_msg_no_ind =0 )
		AND ((to_char(RECEIVED_ON,'DD/MM/YYYY') = to_char(to_date(:g_receivedon,'dd/mm/yyyy'), 'dd/mm/yyyy') OR :g_receivedon_ind =0))
		AND (MSG_FUNC = :g_msgfunc OR :g_msgfunc_ind = 0)
		AND (MSG_REF_NO = :g_msgrefno OR :g_msgrefno_ind = 0)
		AND (event_type = :g_event_type OR :g_event_type_ind = 0)
		AND (INSTR_CODE = :g_secode OR :g_secode_ind = 0)
		AND (REC_FROM_SENT_TO = :g_rec_from_sent_to OR :g_rec_from_sent_to_ind = 0)
		AND (IN_OUT = 'I')
		AND (ACCOUNT = :chr_g_client OR :g_account_ind = 0)
		AND ((MSG_NO='541') OR (MSG_NO='540') OR (MSG_NO='542') OR (MSG_NO='543'))
		AND MSG_FUNC = 'Trade-Canc'
		AND MSG_STS ='RPR';


	IS_ANY_ORA_ERROR

		EXEC SQL SELECT NVL(COUNT(DISTINCT FILE_NAME), 0)
		INTO :h_no_of_trdsett
		FROM DF_COMMON_MSGRPT
		WHERE ((RECEIVED_ON = :p_rep_date) OR (RECEIVED_ON < :p_rep_date))
		AND (REP_FLG = 'N')
		AND (REF_NO = :g_refno OR :g_refno_ind = 0)
		AND (MSG_NO = :chr_g_msg_no OR :g_msg_no_ind =0 )
		AND (to_char(RECEIVED_ON,'DD/MM/YYYY') = to_char(to_date(:g_receivedon,'dd/mm/yyyy'), 'dd/mm/yyyy') OR :g_receivedon_ind =0)
		AND (MSG_FUNC = :g_msgfunc OR :g_msgfunc_ind = 0)
		AND (MSG_REF_NO = :g_msgrefno OR :g_msgrefno_ind = 0)
		AND (event_type = :g_event_type OR :g_event_type_ind = 0)
		AND (INSTR_CODE = :g_secode OR :g_secode_ind = 0)
		AND (REC_FROM_SENT_TO = :g_rec_from_sent_to OR :g_rec_from_sent_to_ind = 0)
		AND (IN_OUT = 'I')
		AND (ACCOUNT = :chr_g_client OR :g_account_ind = 0)
		AND ((MSG_NO='544') OR (MSG_NO='545') OR (MSG_NO='546') OR (MSG_NO='547'))
		AND MSG_FUNC = 'Trade-Sett';

	IS_ANY_ORA_ERROR

		EXEC SQL SELECT NVL(COUNT(DISTINCT FILE_NAME), 0)
		INTO :h_no_of_trdsettRPR
		FROM DF_COMMON_MSGRPT
		WHERE ((RECEIVED_ON = :p_rep_date) OR (RECEIVED_ON < :p_rep_date))
		AND (REP_FLG = 'N')
		AND (REF_NO = :g_refno OR :g_refno_ind = 0)
		AND (MSG_NO = :chr_g_msg_no OR :g_msg_no_ind =0 )
		AND (to_char(RECEIVED_ON,'DD/MM/YYYY') = to_char(to_date(:g_receivedon,'dd/mm/yyyy'), 'dd/mm/yyyy') OR :g_receivedon_ind =0)
		AND (MSG_FUNC = :g_msgfunc OR :g_msgfunc_ind = 0)
		AND (MSG_REF_NO = :g_msgrefno OR :g_msgrefno_ind = 0)
		AND (event_type = :g_event_type OR :g_event_type_ind = 0)
		AND (INSTR_CODE = :g_secode OR :g_secode_ind = 0)
		AND (REC_FROM_SENT_TO = :g_rec_from_sent_to OR :g_rec_from_sent_to_ind = 0)
		AND (IN_OUT = 'I')
		AND (ACCOUNT = :chr_g_client OR :g_account_ind = 0)
		AND ((MSG_NO='544') OR (MSG_NO='545') OR (MSG_NO='546') OR (MSG_NO='547'))
		AND MSG_FUNC = 'Trade-Sett'
		AND MSG_STS ='RPR';
	IS_ANY_ORA_ERROR



		EXEC SQL SELECT NVL(COUNT(DISTINCT FILE_NAME), 0)
		INTO :h_no_of_trdsettSTP
		FROM DF_COMMON_MSGRPT
		WHERE ((RECEIVED_ON = :p_rep_date) OR (RECEIVED_ON < :p_rep_date))
		AND (REP_FLG = 'N')
		AND (REF_NO = :g_refno OR :g_refno_ind = 0)
		AND (MSG_NO = :chr_g_msg_no OR :g_msg_no_ind =0 )
		AND (to_char(RECEIVED_ON,'DD/MM/YYYY') = to_char(to_date(:g_receivedon,'dd/mm/yyyy'), 'dd/mm/yyyy') OR :g_receivedon_ind =0)
		AND (MSG_REF_NO = :g_msgrefno OR :g_msgrefno_ind = 0)
		AND (event_type = :g_event_type OR :g_event_type_ind = 0)
		AND (INSTR_CODE = :g_secode OR :g_secode_ind = 0)
		AND (REC_FROM_SENT_TO = :g_rec_from_sent_to OR :g_rec_from_sent_to_ind = 0)
		AND (IN_OUT = 'I')
		AND (ACCOUNT = :chr_g_client OR :g_account_ind = 0)
		AND ((MSG_NO='544') OR (MSG_NO='545') OR (MSG_NO='546') OR (MSG_NO='547'))
		AND MSG_FUNC = 'Trade-Sett'
		AND MSG_STS ='STP';

	IS_ANY_ORA_ERROR
		EXEC SQL SELECT NVL(COUNT(DISTINCT FILE_NAME), 0)
		INTO :h_no_of_trdsettRJT
		FROM DF_COMMON_MSGRPT
		WHERE ((RECEIVED_ON = :p_rep_date) OR (RECEIVED_ON < :p_rep_date))
		AND (REP_FLG = 'N')
		AND (REF_NO = :g_refno OR :g_refno_ind = 0)
		AND (MSG_NO = :chr_g_msg_no OR :g_msg_no_ind =0 )
		AND (to_char(RECEIVED_ON,'DD/MM/YYYY') = to_char(to_date(:g_receivedon,'dd/mm/yyyy'), 'dd/mm/yyyy') OR :g_receivedon_ind =0)
		AND (MSG_REF_NO = :g_msgrefno OR :g_msgrefno_ind = 0)
		AND (event_type = :g_event_type OR :g_event_type_ind = 0)
		AND (INSTR_CODE = :g_secode OR :g_secode_ind = 0)
		AND (REC_FROM_SENT_TO = :g_rec_from_sent_to OR :g_rec_from_sent_to_ind = 0)
		AND (IN_OUT = 'I')
		AND (ACCOUNT = :chr_g_client OR :g_account_ind = 0)
		AND ((MSG_NO='544') OR (MSG_NO='545') OR (MSG_NO='546') OR (MSG_NO='547'))
		AND MSG_FUNC = 'Trade-Sett'
		AND MSG_STS ='RJT';

	IS_ANY_ORA_ERROR
		EXEC SQL SELECT NVL(COUNT(DISTINCT FILE_NAME), 0)
		INTO :h_no_of_trdconf
		FROM DF_COMMON_MSGRPT
		WHERE ((RECEIVED_ON = :p_rep_date) OR (RECEIVED_ON < :p_rep_date))
		AND (REP_FLG = 'N')
		AND (REF_NO = :g_refno OR :g_refno_ind = 0)
		AND (MSG_NO = :chr_g_msg_no OR :g_msg_no_ind =0 )
		AND (to_char(RECEIVED_ON,'DD/MM/YYYY') = to_char(to_date(:g_receivedon,'dd/mm/yyyy'), 'dd/mm/yyyy') OR :g_receivedon_ind =0)
		AND (MSG_REF_NO = :g_msgrefno OR :g_msgrefno_ind = 0)
		AND (event_type = :g_event_type OR :g_event_type_ind = 0)
		AND (INSTR_CODE = :g_secode OR :g_secode_ind = 0)
		AND (REC_FROM_SENT_TO = :g_rec_from_sent_to OR :g_rec_from_sent_to_ind = 0)
		AND (IN_OUT = 'I')
		AND (ACCOUNT = :chr_g_client OR :g_account_ind = 0)
		AND ((MSG_NO='548'))
		AND MSG_FUNC = 'Trade-Conf';

	IS_ANY_ORA_ERROR


		EXEC SQL SELECT NVL(COUNT(DISTINCT FILE_NAME), 0)
		INTO :h_no_of_trdconfRPR
		FROM DF_COMMON_MSGRPT
		WHERE ((RECEIVED_ON = :p_rep_date) OR (RECEIVED_ON < :p_rep_date))
		AND (REP_FLG = 'N')
		AND (REF_NO = :g_refno OR :g_refno_ind = 0)
		AND (MSG_NO = :chr_g_msg_no OR :g_msg_no_ind =0 )
		AND (to_char(RECEIVED_ON,'DD/MM/YYYY') = to_char(to_date(:g_receivedon,'dd/mm/yyyy'), 'dd/mm/yyyy') OR :g_receivedon_ind =0)
		AND (MSG_REF_NO = :g_msgrefno OR :g_msgrefno_ind = 0)
		AND (event_type = :g_event_type OR :g_event_type_ind = 0)
		AND (INSTR_CODE = :g_secode OR :g_secode_ind = 0)
		AND (REC_FROM_SENT_TO = :g_rec_from_sent_to OR :g_rec_from_sent_to_ind = 0)
		AND (IN_OUT = 'I')
		AND (ACCOUNT = :chr_g_client OR :g_account_ind = 0)
		AND ((MSG_NO='548'))
		AND MSG_FUNC = 'Trade-Conf'
		AND MSG_STS = 'RPR';
	IS_ANY_ORA_ERROR
		EXEC SQL SELECT NVL(COUNT(DISTINCT FILE_NAME), 0)
		INTO :h_no_of_trdconfRJT
		FROM DF_COMMON_MSGRPT
		WHERE ((RECEIVED_ON = :p_rep_date) OR (RECEIVED_ON < :p_rep_date))
		AND (REP_FLG = 'N')
		AND (REF_NO = :g_refno OR :g_refno_ind = 0)
		AND (MSG_NO = :chr_g_msg_no OR :g_msg_no_ind =0 )
		AND (to_char(RECEIVED_ON,'DD/MM/YYYY') = to_char(to_date(:g_receivedon,'dd/mm/yyyy'), 'dd/mm/yyyy') OR :g_receivedon_ind =0)
		AND (MSG_REF_NO = :g_msgrefno OR :g_msgrefno_ind = 0)
		AND (event_type = :g_event_type OR :g_event_type_ind = 0)
		AND (INSTR_CODE = :g_secode OR :g_secode_ind = 0)
		AND (REC_FROM_SENT_TO = :g_rec_from_sent_to OR :g_rec_from_sent_to_ind = 0)
		AND (IN_OUT = 'I')
		AND (ACCOUNT = :chr_g_client OR :g_account_ind = 0)
		AND ((MSG_NO='548'))
		AND MSG_FUNC = 'Trade-Conf'
		AND MSG_STS= 'RJT' ;
	IS_ANY_ORA_ERROR

		EXEC SQL SELECT NVL(COUNT(DISTINCT FILE_NAME), 0)
		INTO :h_no_of_trdconfSTP
		FROM DF_COMMON_MSGRPT
		WHERE ((RECEIVED_ON = :p_rep_date) OR (RECEIVED_ON < :p_rep_date))
		AND (REP_FLG = 'N')
		AND (REF_NO = :g_refno OR :g_refno_ind = 0)
		AND (MSG_NO = :chr_g_msg_no OR :g_msg_no_ind =0 )
		AND (to_char(RECEIVED_ON,'DD/MM/YYYY') = to_char(to_date(:g_receivedon,'dd/mm/yyyy'), 'dd/mm/yyyy') OR :g_receivedon_ind =0)
		AND (MSG_REF_NO = :g_msgrefno OR :g_msgrefno_ind = 0)
		AND (event_type = :g_event_type OR :g_event_type_ind = 0)
		AND (INSTR_CODE = :g_secode OR :g_secode_ind = 0)
		AND (REC_FROM_SENT_TO = :g_rec_from_sent_to OR :g_rec_from_sent_to_ind = 0)
		AND (IN_OUT = 'I')
		AND (ACCOUNT = :chr_g_client OR :g_account_ind = 0)
		AND ((MSG_NO='548') )
		AND MSG_FUNC = 'Trade-Conf'
		AND MSG_STS = 'STP';
	IS_ANY_ORA_ERROR

		EXEC SQL SELECT NVL(COUNT(DISTINCT FILE_NAME), 0)
		INTO :h_no_of_trdupdufl
		FROM DF_COMMON_MSGRPT
		WHERE ((RECEIVED_ON = :p_rep_date) OR (RECEIVED_ON < :p_rep_date))
		AND (REP_FLG = 'N')
		AND (REF_NO = :g_refno OR :g_refno_ind = 0)
		AND (MSG_NO = :chr_g_msg_no OR :g_msg_no_ind =0 )
		AND (to_char(RECEIVED_ON,'DD/MM/YYYY') = to_char(to_date(:g_receivedon,'dd/mm/yyyy'), 'dd/mm/yyyy') OR :g_receivedon_ind =0)
		AND (MSG_REF_NO = :g_msgrefno OR :g_msgrefno_ind = 0)
		AND (event_type = :g_event_type OR :g_event_type_ind = 0)
		AND (INSTR_CODE = :g_secode OR :g_secode_ind = 0)
		AND (REC_FROM_SENT_TO = :g_rec_from_sent_to OR :g_rec_from_sent_to_ind = 0)
		AND (IN_OUT = 'I')
		AND (ACCOUNT = :chr_g_client OR :g_account_ind = 0)
		AND ((MSG_NO='548') )
		AND MSG_FUNC = 'Trade-UpdFcl';

	IS_ANY_ORA_ERROR
		EXEC SQL SELECT NVL(COUNT(DISTINCT FILE_NAME), 0)
		INTO :h_no_of_trdupduflRPR
		FROM DF_COMMON_MSGRPT
		WHERE ((RECEIVED_ON = :p_rep_date) OR (RECEIVED_ON < :p_rep_date))
		AND (REP_FLG = 'N')
		AND (REF_NO = :g_refno OR :g_refno_ind = 0)
		AND (MSG_NO = :chr_g_msg_no OR :g_msg_no_ind =0 )
		AND (to_char(RECEIVED_ON,'DD/MM/YYYY') = to_char(to_date(:g_receivedon,'dd/mm/yyyy'), 'dd/mm/yyyy') OR :g_receivedon_ind =0)
		AND (MSG_REF_NO = :g_msgrefno OR :g_msgrefno_ind = 0)
		AND (event_type = :g_event_type OR :g_event_type_ind = 0)
		AND (INSTR_CODE = :g_secode OR :g_secode_ind = 0)
		AND (REC_FROM_SENT_TO = :g_rec_from_sent_to OR :g_rec_from_sent_to_ind = 0)
		AND (IN_OUT = 'I')
		AND (ACCOUNT = :chr_g_client OR :g_account_ind = 0)
		AND ((MSG_NO='548') )
		AND MSG_FUNC = 'Trade-UpdFcl'
		AND MSG_STS = 'RPR' ;
	IS_ANY_ORA_ERROR

		EXEC SQL SELECT NVL(COUNT(DISTINCT FILE_NAME), 0)
		INTO :h_no_of_trdupduflRJT
		FROM DF_COMMON_MSGRPT
		WHERE ((RECEIVED_ON = :p_rep_date) OR (RECEIVED_ON < :p_rep_date))
		AND (REP_FLG = 'N')
		AND (REF_NO = :g_refno OR :g_refno_ind = 0)
		AND (MSG_NO = :chr_g_msg_no OR :g_msg_no_ind =0 )
		AND (to_char(RECEIVED_ON,'DD/MM/YYYY') = to_char(to_date(:g_receivedon,'dd/mm/yyyy'), 'dd/mm/yyyy') OR :g_receivedon_ind =0)
		AND (MSG_REF_NO = :g_msgrefno OR :g_msgrefno_ind = 0)
		AND (event_type = :g_event_type OR :g_event_type_ind = 0)
		AND (INSTR_CODE = :g_secode OR :g_secode_ind = 0)
		AND (REC_FROM_SENT_TO = :g_rec_from_sent_to OR :g_rec_from_sent_to_ind = 0)
		AND (IN_OUT = 'I')
		AND (ACCOUNT = :chr_g_client OR :g_account_ind = 0)
		AND ((MSG_NO='548') )
		AND MSG_FUNC = 'Trade-UpdFcl'
		AND MSG_STS = 'RJT' ;
	IS_ANY_ORA_ERROR

		EXEC SQL SELECT NVL(COUNT(DISTINCT FILE_NAME), 0)
		INTO :h_no_of_trdupduflSTP
		FROM DF_COMMON_MSGRPT
		WHERE ((RECEIVED_ON = :p_rep_date) OR (RECEIVED_ON < :p_rep_date))
		AND (REP_FLG = 'N')
		AND (REF_NO = :g_refno OR :g_refno_ind = 0)
		AND (MSG_NO = :chr_g_msg_no OR :g_msg_no_ind =0 )
		AND (to_char(RECEIVED_ON,'DD/MM/YYYY') = to_char(to_date(:g_receivedon,'dd/mm/yyyy'), 'dd/mm/yyyy') OR :g_receivedon_ind =0)
		AND (MSG_REF_NO = :g_msgrefno OR :g_msgrefno_ind = 0)
		AND (event_type = :g_event_type OR :g_event_type_ind = 0)
		AND (INSTR_CODE = :g_secode OR :g_secode_ind = 0)
		AND (REC_FROM_SENT_TO = :g_rec_from_sent_to OR :g_rec_from_sent_to_ind = 0)
		AND (IN_OUT = 'I')
		AND (ACCOUNT = :chr_g_client OR :g_account_ind = 0)
		AND ((MSG_NO='548') )
		AND MSG_FUNC = 'Trade-UpdFcl'
		AND MSG_STS = 'STP' ;
	IS_ANY_ORA_ERROR
		EXEC SQL SELECT NVL(COUNT(DISTINCT FILE_NAME), 0)
		INTO :h_no_of_ca
		FROM DF_COMMON_MSGRPT
		WHERE ((RECEIVED_ON = :p_rep_date) OR (RECEIVED_ON < :p_rep_date))
		AND (REP_FLG = 'N')
		AND (REF_NO = :g_refno OR :g_refno_ind = 0)
		AND (MSG_NO = :chr_g_msg_no OR :g_msg_no_ind =0 )
		AND (to_char(RECEIVED_ON,'DD/MM/YYYY') = to_char(to_date(:g_receivedon,'dd/mm/yyyy'), 'dd/mm/yyyy') OR :g_receivedon_ind =0)
		AND (MSG_REF_NO = :g_msgrefno OR :g_msgrefno_ind = 0)
		AND (event_type = :g_event_type OR :g_event_type_ind = 0)
		AND (INSTR_CODE = :g_secode OR :g_secode_ind = 0)
		AND (REC_FROM_SENT_TO = :g_rec_from_sent_to OR :g_rec_from_sent_to_ind = 0)
		AND (IN_OUT = 'I')
		AND (ACCOUNT = :chr_g_client OR :g_account_ind = 0)
		AND TRD_CA='C' ;
	IS_ANY_ORA_ERROR


		EXEC SQL SELECT NVL(COUNT(DISTINCT FILE_NAME), 0)
		INTO :int_h_no_of_trd
		FROM DF_COMMON_MSGRPT
		WHERE ((RECEIVED_ON = :p_rep_date) OR (RECEIVED_ON < :p_rep_date))
		AND (REP_FLG = 'N')
		AND (REF_NO = :g_refno OR :g_refno_ind = 0)
		AND (MSG_NO = :chr_g_msg_no OR :g_msg_no_ind =0 )
		AND (to_char(RECEIVED_ON,'DD/MM/YYYY') = to_char(to_date(:g_receivedon,'dd/mm/yyyy'), 'dd/mm/yyyy') OR :g_receivedon_ind =0)
		AND (MSG_REF_NO = :g_msgrefno OR :g_msgrefno_ind = 0)
		AND (event_type = :g_event_type OR :g_event_type_ind = 0)
		AND (INSTR_CODE = :g_secode OR :g_secode_ind = 0)
		AND (REC_FROM_SENT_TO = :g_rec_from_sent_to OR :g_rec_from_sent_to_ind = 0)
		AND (IN_OUT = 'I')
		AND (ACCOUNT = :chr_g_client OR :g_account_ind = 0)
		AND TRD_CA= 'T' ;
	IS_ANY_ORA_ERROR

		EXEC SQL SELECT NVL(COUNT(DISTINCT FILE_NAME), 0)
		INTO :h_no_of_evInt
		FROM DF_COMMON_MSGRPT
		WHERE ((RECEIVED_ON = :p_rep_date) OR (RECEIVED_ON < :p_rep_date))
		AND (REP_FLG = 'N')
		AND (REF_NO = :g_refno OR :g_refno_ind = 0)
		AND (MSG_NO = :chr_g_msg_no OR :g_msg_no_ind =0 )
		AND (to_char(RECEIVED_ON,'DD/MM/YYYY') = to_char(to_date(:g_receivedon,'dd/mm/yyyy'), 'dd/mm/yyyy') OR :g_receivedon_ind =0)
		AND (MSG_REF_NO = :g_msgrefno OR :g_msgrefno_ind = 0)
		AND (event_type = :g_event_type OR :g_event_type_ind = 0)
		AND (INSTR_CODE = :g_secode OR :g_secode_ind = 0)
		AND (REC_FROM_SENT_TO = :g_rec_from_sent_to OR :g_rec_from_sent_to_ind = 0)
		AND (IN_OUT = 'I')
		AND (ACCOUNT = :chr_g_client OR :g_account_ind = 0)
		AND TRD_CA='C' 
		AND MSG_NO ='564'
		AND MSG_FUNC = 'CA_INTI';	
	IS_ANY_ORA_ERROR


		EXEC SQL SELECT NVL(COUNT(DISTINCT FILE_NAME), 0)
		INTO :h_no_of_evIntRPR
		FROM DF_COMMON_MSGRPT
		WHERE ((RECEIVED_ON = :p_rep_date) OR (RECEIVED_ON < :p_rep_date))
		AND (REP_FLG = 'N')
		AND (REF_NO = :g_refno OR :g_refno_ind = 0)
		AND (MSG_NO = :chr_g_msg_no OR :g_msg_no_ind =0 )
		AND (to_char(RECEIVED_ON,'DD/MM/YYYY') = to_char(to_date(:g_receivedon,'dd/mm/yyyy'), 'dd/mm/yyyy') OR :g_receivedon_ind =0)
		AND (MSG_REF_NO = :g_msgrefno OR :g_msgrefno_ind = 0)
		AND (event_type = :g_event_type OR :g_event_type_ind = 0)
		AND (INSTR_CODE = :g_secode OR :g_secode_ind = 0)
		AND (REC_FROM_SENT_TO = :g_rec_from_sent_to OR :g_rec_from_sent_to_ind = 0)
		AND (IN_OUT = 'I')
		AND (ACCOUNT = :chr_g_client OR :g_account_ind = 0)
		AND MSG_NO ='564'
		AND MSG_FUNC = 'CA_INTI'
		AND MSG_STS = 'RPR';

	IS_ANY_ORA_ERROR


		EXEC SQL SELECT NVL(COUNT(DISTINCT FILE_NAME), 0)
		INTO :h_no_of_evIntRJT
		FROM DF_COMMON_MSGRPT
		WHERE ((RECEIVED_ON = :p_rep_date) OR (RECEIVED_ON < :p_rep_date))
		AND (REP_FLG = 'N')
		AND (REF_NO = :g_refno OR :g_refno_ind = 0)
		AND (MSG_NO = :chr_g_msg_no OR :g_msg_no_ind =0 )
		AND (to_char(RECEIVED_ON,'DD/MM/YYYY') = to_char(to_date(:g_receivedon,'dd/mm/yyyy'), 'dd/mm/yyyy') OR :g_receivedon_ind =0)
		AND (MSG_REF_NO = :g_msgrefno OR :g_msgrefno_ind = 0)
		AND (event_type = :g_event_type OR :g_event_type_ind = 0)
		AND (INSTR_CODE = :g_secode OR :g_secode_ind = 0)
		AND (REC_FROM_SENT_TO = :g_rec_from_sent_to OR :g_rec_from_sent_to_ind = 0)
		AND (IN_OUT = 'I')
		AND (ACCOUNT = :chr_g_client OR :g_account_ind = 0)
		AND MSG_NO ='564'
		AND MSG_FUNC = 'CA_INTI'
		AND MSG_STS = 'RJT';

	IS_ANY_ORA_ERROR

		EXEC SQL SELECT NVL(COUNT(DISTINCT FILE_NAME), 0)
		INTO :h_no_of_evIntSTP
		FROM DF_COMMON_MSGRPT
		WHERE ((RECEIVED_ON = :p_rep_date) OR (RECEIVED_ON < :p_rep_date))
		AND (REP_FLG = 'N')
		AND (REF_NO = :g_refno OR :g_refno_ind = 0)
		AND (MSG_NO = :chr_g_msg_no OR :g_msg_no_ind =0 )
		AND (to_char(RECEIVED_ON,'DD/MM/YYYY') = to_char(to_date(:g_receivedon,'dd/mm/yyyy'), 'dd/mm/yyyy') OR :g_receivedon_ind =0)
		AND (MSG_REF_NO = :g_msgrefno OR :g_msgrefno_ind = 0)
		AND (event_type = :g_event_type OR :g_event_type_ind = 0)
		AND (INSTR_CODE = :g_secode OR :g_secode_ind = 0)
		AND (REC_FROM_SENT_TO = :g_rec_from_sent_to OR :g_rec_from_sent_to_ind = 0)
		AND (IN_OUT = 'I')
		AND (ACCOUNT = :chr_g_client OR :g_account_ind = 0)
		AND MSG_NO ='564'
		AND MSG_FUNC = 'CA_INIT'
		AND MSG_STS = 'STP';

	IS_ANY_ORA_ERROR


		EXEC SQL SELECT NVL(COUNT(DISTINCT FILE_NAME), 0)
		INTO :h_no_of_evEnt
		FROM DF_COMMON_MSGRPT
		WHERE ((RECEIVED_ON = :p_rep_date) OR (RECEIVED_ON < :p_rep_date))
		AND (REP_FLG = 'N')
		AND (REF_NO = :g_refno OR :g_refno_ind = 0)
		AND (MSG_NO = :chr_g_msg_no OR :g_msg_no_ind =0 )
		AND (to_char(RECEIVED_ON,'DD/MM/YYYY') = to_char(to_date(:g_receivedon,'dd/mm/yyyy'), 'dd/mm/yyyy') OR :g_receivedon_ind =0)
		AND (MSG_REF_NO = :g_msgrefno OR :g_msgrefno_ind = 0)
		AND (event_type = :g_event_type OR :g_event_type_ind = 0)
		AND (INSTR_CODE = :g_secode OR :g_secode_ind = 0)
		AND (REC_FROM_SENT_TO = :g_rec_from_sent_to OR :g_rec_from_sent_to_ind = 0)
		AND (IN_OUT = 'I')
		AND (ACCOUNT = :chr_g_client OR :g_account_ind = 0)
		AND MSG_NO ='564'
		AND MSG_FUNC = 'CA_ENTIT';


	IS_ANY_ORA_ERROR

		EXEC SQL SELECT NVL(COUNT(DISTINCT FILE_NAME), 0)
		INTO :h_no_of_evEntSTP
		FROM DF_COMMON_MSGRPT
		WHERE ((RECEIVED_ON = :p_rep_date) OR (RECEIVED_ON < :p_rep_date))
		AND (REP_FLG = 'N')
		AND (REF_NO = :g_refno OR :g_refno_ind = 0)
		AND (MSG_NO = :chr_g_msg_no OR :g_msg_no_ind =0 )
		AND (to_char(RECEIVED_ON,'DD/MM/YYYY') = to_char(to_date(:g_receivedon,'dd/mm/yyyy'), 'dd/mm/yyyy') OR :g_receivedon_ind =0)
		AND (MSG_REF_NO = :g_msgrefno OR :g_msgrefno_ind = 0)
		AND (event_type = :g_event_type OR :g_event_type_ind = 0)
		AND (INSTR_CODE = :g_secode OR :g_secode_ind = 0)
		AND (REC_FROM_SENT_TO = :g_rec_from_sent_to OR :g_rec_from_sent_to_ind = 0)
		AND (IN_OUT = 'I')
		AND (ACCOUNT = :chr_g_client OR :g_account_ind = 0)
		AND MSG_NO ='564'
		AND MSG_FUNC = 'CA_ENTIT'
		AND MSG_STS  = 'STP';
	IS_ANY_ORA_ERROR

		EXEC SQL SELECT NVL(COUNT(DISTINCT FILE_NAME), 0)
		INTO :h_no_of_evEntRPR
		FROM DF_COMMON_MSGRPT
		WHERE ((RECEIVED_ON = :p_rep_date) OR (RECEIVED_ON < :p_rep_date))
		AND (REP_FLG = 'N')
		AND (REF_NO = :g_refno OR :g_refno_ind = 0)
		AND (MSG_NO = :chr_g_msg_no OR :g_msg_no_ind =0 )
		AND (to_char(RECEIVED_ON,'DD/MM/YYYY') = to_char(to_date(:g_receivedon,'dd/mm/yyyy'), 'dd/mm/yyyy') OR :g_receivedon_ind =0)
		AND (MSG_REF_NO = :g_msgrefno OR :g_msgrefno_ind = 0)
		AND (event_type = :g_event_type OR :g_event_type_ind = 0)
		AND (INSTR_CODE = :g_secode OR :g_secode_ind = 0)
		AND (REC_FROM_SENT_TO = :g_rec_from_sent_to OR :g_rec_from_sent_to_ind = 0)
		AND (IN_OUT = 'I')
		AND (ACCOUNT = :chr_g_client OR :g_account_ind = 0)
		AND MSG_NO ='564'
		AND MSG_FUNC = 'CA_ENTIT'
		AND MSG_STS  = 'RPR';


	IS_ANY_ORA_ERROR


		EXEC SQL SELECT NVL(COUNT(DISTINCT FILE_NAME), 0)
		INTO :h_no_of_evEntRJT
		FROM DF_COMMON_MSGRPT
		WHERE ((RECEIVED_ON = :p_rep_date) OR (RECEIVED_ON < :p_rep_date))
		AND (REP_FLG = 'N')
		AND (REF_NO = :g_refno OR :g_refno_ind = 0)
		AND (MSG_NO = :chr_g_msg_no OR :g_msg_no_ind =0 )
		AND (to_char(RECEIVED_ON,'DD/MM/YYYY') = to_char(to_date(:g_receivedon,'dd/mm/yyyy'), 'dd/mm/yyyy') OR :g_receivedon_ind =0)
		AND (MSG_REF_NO = :g_msgrefno OR :g_msgrefno_ind = 0)
		AND (event_type = :g_event_type OR :g_event_type_ind = 0)
		AND (INSTR_CODE = :g_secode OR :g_secode_ind = 0)
		AND (REC_FROM_SENT_TO = :g_rec_from_sent_to OR :g_rec_from_sent_to_ind = 0)
		AND (IN_OUT = 'I')
		AND (ACCOUNT = :chr_g_client OR :g_account_ind = 0)
		AND MSG_NO ='564'
		AND MSG_FUNC = 'CA_ENTIT'
		AND MSG_STS  = 'RJT';

	IS_ANY_ORA_ERROR




		EXEC SQL SELECT NVL(COUNT(DISTINCT FILE_NAME), 0)
		INTO :h_no_of_evPayt
		FROM DF_COMMON_MSGRPT
		WHERE ((RECEIVED_ON = :p_rep_date) OR (RECEIVED_ON < :p_rep_date))
		AND (REP_FLG = 'N')
		AND (REF_NO = :g_refno OR :g_refno_ind = 0)
		AND (MSG_NO = :chr_g_msg_no OR :g_msg_no_ind =0 )
		AND (to_char(RECEIVED_ON,'DD/MM/YYYY') = to_char(to_date(:g_receivedon,'dd/mm/yyyy'), 'dd/mm/yyyy') OR :g_receivedon_ind =0)
		AND (MSG_REF_NO = :g_msgrefno OR :g_msgrefno_ind = 0)
		AND (event_type = :g_event_type OR :g_event_type_ind = 0)
		AND (INSTR_CODE = :g_secode OR :g_secode_ind = 0)
		AND (REC_FROM_SENT_TO = :g_rec_from_sent_to OR :g_rec_from_sent_to_ind = 0)
		AND (IN_OUT = 'I')
		AND (ACCOUNT = :chr_g_client OR :g_account_ind = 0)
		AND MSG_NO ='566'
		AND MSG_FUNC = 'CA_PAY';

	IS_ANY_ORA_ERROR  

		EXEC SQL SELECT NVL(COUNT(DISTINCT FILE_NAME), 0)
		INTO :h_no_of_evPaytRPR
		FROM DF_COMMON_MSGRPT
		WHERE ((RECEIVED_ON = :p_rep_date) OR (RECEIVED_ON < :p_rep_date))
		AND (REP_FLG = 'N')
		AND (REF_NO = :g_refno OR :g_refno_ind = 0)
		AND (MSG_NO = :chr_g_msg_no OR :g_msg_no_ind =0 )
		AND (to_char(RECEIVED_ON,'DD/MM/YYYY') = to_char(to_date(:g_receivedon,'dd/mm/yyyy'), 'dd/mm/yyyy') OR :g_receivedon_ind =0)
		AND (MSG_REF_NO = :g_msgrefno OR :g_msgrefno_ind = 0)
		AND (event_type = :g_event_type OR :g_event_type_ind = 0)
		AND (INSTR_CODE = :g_secode OR :g_secode_ind = 0)
		AND (REC_FROM_SENT_TO = :g_rec_from_sent_to OR :g_rec_from_sent_to_ind = 0)
		AND (IN_OUT = 'I')
		AND (ACCOUNT = :chr_g_client OR :g_account_ind = 0)
		AND MSG_NO ='566'
		AND MSG_FUNC = 'CA_PAY'
		AND MSG_STS = 'RPR';

	IS_ANY_ORA_ERROR


		EXEC SQL SELECT NVL(COUNT(DISTINCT FILE_NAME), 0)
		INTO :h_no_of_evPaytRJT
		FROM DF_COMMON_MSGRPT
		WHERE ((RECEIVED_ON = :p_rep_date) OR (RECEIVED_ON < :p_rep_date))
		AND (REP_FLG = 'N')
		AND (REF_NO = :g_refno OR :g_refno_ind = 0)
		AND (MSG_NO = :chr_g_msg_no OR :g_msg_no_ind =0 )
		AND (to_char(RECEIVED_ON,'DD/MM/YYYY') = to_char(to_date(:g_receivedon,'dd/mm/yyyy'), 'dd/mm/yyyy') OR :g_receivedon_ind =0)
		AND (MSG_REF_NO = :g_msgrefno OR :g_msgrefno_ind = 0)
		AND (event_type = :g_event_type OR :g_event_type_ind = 0)
		AND (INSTR_CODE = :g_secode OR :g_secode_ind = 0)
		AND (REC_FROM_SENT_TO = :g_rec_from_sent_to OR :g_rec_from_sent_to_ind = 0)
		AND (IN_OUT = 'I')
		AND (ACCOUNT = :chr_g_client OR :g_account_ind = 0)
		AND MSG_NO ='566'
		AND MSG_FUNC = 'CA_PAY'
		AND MSG_STS = 'RJT';

	IS_ANY_ORA_ERROR

		EXEC SQL SELECT NVL(COUNT(DISTINCT FILE_NAME), 0)
		INTO :h_no_of_evPaytSTP
		FROM DF_COMMON_MSGRPT
		WHERE ((RECEIVED_ON = :p_rep_date) OR (RECEIVED_ON < :p_rep_date))
		AND (REP_FLG = 'N')
		AND (REF_NO = :g_refno OR :g_refno_ind = 0)
		AND (MSG_NO = :chr_g_msg_no OR :g_msg_no_ind =0 )
		AND (to_char(RECEIVED_ON,'DD/MM/YYYY') = to_char(to_date(:g_receivedon,'dd/mm/yyyy'), 'dd/mm/yyyy') OR :g_receivedon_ind =0)
		AND (MSG_REF_NO = :g_msgrefno OR :g_msgrefno_ind = 0)
		AND (event_type = :g_event_type OR :g_event_type_ind = 0)
		AND (INSTR_CODE = :g_secode OR :g_secode_ind = 0)
		AND (REC_FROM_SENT_TO = :g_rec_from_sent_to OR :g_rec_from_sent_to_ind = 0)
		AND (IN_OUT = 'I')
		AND (ACCOUNT = :chr_g_client OR :g_account_ind = 0)
		AND MSG_NO ='566'
		AND MSG_FUNC = 'CA_PAY'
		AND MSG_STS = 'STP';

	IS_ANY_ORA_ERROR





		EXEC SQL SELECT NVL(COUNT(DISTINCT FILE_NAME), 0)
		INTO :h_no_of_carev
		FROM DF_COMMON_MSGRPT
		WHERE ((RECEIVED_ON = :p_rep_date) OR (RECEIVED_ON < :p_rep_date))
		AND (REP_FLG = 'N')
		AND (REF_NO = :g_refno OR :g_refno_ind = 0)
		AND (MSG_NO = :chr_g_msg_no OR :g_msg_no_ind =0 )
		AND (to_char(RECEIVED_ON,'DD/MM/YYYY') = to_char(to_date(:g_receivedon,'dd/mm/yyyy'), 'dd/mm/yyyy') OR :g_receivedon_ind =0)
		AND (MSG_REF_NO = :g_msgrefno OR :g_msgrefno_ind = 0)
		AND (event_type = :g_event_type OR :g_event_type_ind = 0)
		AND (INSTR_CODE = :g_secode OR :g_secode_ind = 0)
		AND (REC_FROM_SENT_TO = :g_rec_from_sent_to OR :g_rec_from_sent_to_ind = 0)
		AND (IN_OUT = 'I')
		AND (ACCOUNT = :chr_g_client OR :g_account_ind = 0)
		AND MSG_NO ='564'
		AND MSG_FUNC = 'CA_REV';



	IS_ANY_ORA_ERROR

		EXEC SQL SELECT NVL(COUNT(DISTINCT FILE_NAME), 0)
		INTO :h_no_of_carevRPR
		FROM DF_COMMON_MSGRPT
		WHERE ((RECEIVED_ON = :p_rep_date) OR (RECEIVED_ON < :p_rep_date))
		AND (REP_FLG = 'N')
		AND (REF_NO = :g_refno OR :g_refno_ind = 0)
		AND (MSG_NO = :chr_g_msg_no OR :g_msg_no_ind =0 )
		AND (to_char(RECEIVED_ON,'DD/MM/YYYY') = to_char(to_date(:g_receivedon,'dd/mm/yyyy'), 'dd/mm/yyyy') OR :g_receivedon_ind =0)
		AND (MSG_REF_NO = :g_msgrefno OR :g_msgrefno_ind = 0)
		AND (event_type = :g_event_type OR :g_event_type_ind = 0)
		AND (INSTR_CODE = :g_secode OR :g_secode_ind = 0)
		AND (REC_FROM_SENT_TO = :g_rec_from_sent_to OR :g_rec_from_sent_to_ind = 0)
		AND (IN_OUT = 'I')
		AND (ACCOUNT = :chr_g_client OR :g_account_ind = 0)
		AND MSG_NO ='564'
		AND MSG_FUNC = 'CA_REV'
		AND MSG_STS='RPR';

	IS_ANY_ORA_ERROR

		EXEC SQL SELECT NVL(COUNT(DISTINCT FILE_NAME), 0)
		INTO :h_no_of_carevSTP
		FROM DF_COMMON_MSGRPT
		WHERE ((RECEIVED_ON = :p_rep_date) OR (RECEIVED_ON < :p_rep_date))
		AND (REP_FLG = 'N')
		AND (REF_NO = :g_refno OR :g_refno_ind = 0)
		AND (MSG_NO = :chr_g_msg_no OR :g_msg_no_ind =0 )
		AND (to_char(RECEIVED_ON,'DD/MM/YYYY') = to_char(to_date(:g_receivedon,'dd/mm/yyyy'), 'dd/mm/yyyy') OR :g_receivedon_ind =0)
		AND (MSG_REF_NO = :g_msgrefno OR :g_msgrefno_ind = 0)
		AND (event_type = :g_event_type OR :g_event_type_ind = 0)
		AND (INSTR_CODE = :g_secode OR :g_secode_ind = 0)
		AND (REC_FROM_SENT_TO = :g_rec_from_sent_to OR :g_rec_from_sent_to_ind = 0)
		AND (IN_OUT = 'I')
		AND (ACCOUNT = :chr_g_client OR :g_account_ind = 0)
		AND MSG_NO ='564'
		AND MSG_FUNC = 'CA_REV'
		AND MSG_STS='STP';

	IS_ANY_ORA_ERROR

		EXEC SQL SELECT NVL(COUNT(DISTINCT FILE_NAME), 0)
		INTO :h_no_of_carevRJT
		FROM DF_COMMON_MSGRPT
		WHERE ((RECEIVED_ON = :p_rep_date) OR (RECEIVED_ON < :p_rep_date))
		AND (REP_FLG = 'N')
		AND (REF_NO = :g_refno OR :g_refno_ind = 0)
		AND (MSG_NO = :chr_g_msg_no OR :g_msg_no_ind =0 )
		AND (to_char(RECEIVED_ON,'DD/MM/YYYY') = to_char(to_date(:g_receivedon,'dd/mm/yyyy'), 'dd/mm/yyyy') OR :g_receivedon_ind =0)
		AND (MSG_REF_NO = :g_msgrefno OR :g_msgrefno_ind = 0)
		AND (event_type = :g_event_type OR :g_event_type_ind = 0)
		AND (INSTR_CODE = :g_secode OR :g_secode_ind = 0)
		AND (REC_FROM_SENT_TO = :g_rec_from_sent_to OR :g_rec_from_sent_to_ind = 0)
		AND (IN_OUT = 'I')
		AND (ACCOUNT = :chr_g_client OR :g_account_ind = 0)
		AND MSG_NO ='564'
		AND MSG_FUNC = 'CA_REV'
		AND MSG_STS='RJT';

	IS_ANY_ORA_ERROR



		EXEC SQL SELECT NVL(COUNT(DISTINCT FILE_NAME), 0)
		INTO :h_no_of_carespRJT
		FROM DF_COMMON_MSGRPT
		WHERE ((RECEIVED_ON = :p_rep_date) OR (RECEIVED_ON < :p_rep_date))
		AND (REP_FLG = 'N')
		AND (REF_NO = :g_refno OR :g_refno_ind = 0)
		AND (MSG_NO = :chr_g_msg_no OR :g_msg_no_ind =0 )
		AND (to_char(RECEIVED_ON,'DD/MM/YYYY') = to_char(to_date(:g_receivedon,'dd/mm/yyyy'), 'dd/mm/yyyy') OR :g_receivedon_ind =0)
		AND (MSG_REF_NO = :g_msgrefno OR :g_msgrefno_ind = 0)
		AND (event_type = :g_event_type OR :g_event_type_ind = 0)
		AND (INSTR_CODE = :g_secode OR :g_secode_ind = 0)
		AND (REC_FROM_SENT_TO = :g_rec_from_sent_to OR :g_rec_from_sent_to_ind = 0)
		AND (IN_OUT = 'I')
		AND (ACCOUNT = :chr_g_client OR :g_account_ind = 0)
		AND MSG_NO ='565'
		AND MSG_FUNC = 'CA_RESP'
		AND MSG_STS='RJT';

	IS_ANY_ORA_ERROR


		EXEC SQL SELECT NVL(COUNT(DISTINCT FILE_NAME), 0)
		INTO :h_no_of_carespRPR
		FROM DF_COMMON_MSGRPT
		WHERE ((RECEIVED_ON = :p_rep_date) OR (RECEIVED_ON < :p_rep_date))
		AND (REP_FLG = 'N')
		AND (REF_NO = :g_refno OR :g_refno_ind = 0)
		AND (MSG_NO = :chr_g_msg_no OR :g_msg_no_ind =0 )
		AND (to_char(RECEIVED_ON,'DD/MM/YYYY') = to_char(to_date(:g_receivedon,'dd/mm/yyyy'), 'dd/mm/yyyy') OR :g_receivedon_ind =0)
		AND (MSG_REF_NO = :g_msgrefno OR :g_msgrefno_ind = 0)
		AND (event_type = :g_event_type OR :g_event_type_ind = 0)
		AND (INSTR_CODE = :g_secode OR :g_secode_ind = 0)
		AND (REC_FROM_SENT_TO = :g_rec_from_sent_to OR :g_rec_from_sent_to_ind = 0)
		AND (IN_OUT = 'I')
		AND (ACCOUNT = :chr_g_client OR :g_account_ind = 0)
		AND MSG_NO ='565'
		AND MSG_FUNC = 'CA_RESP'
		AND MSG_STS='RPR';

	IS_ANY_ORA_ERROR


		EXEC SQL SELECT NVL(COUNT(DISTINCT FILE_NAME), 0)
		INTO :h_no_of_carespSTP
		FROM DF_COMMON_MSGRPT
		WHERE ((RECEIVED_ON = :p_rep_date) OR (RECEIVED_ON < :p_rep_date))
		AND (REP_FLG = 'N')
		AND (REF_NO = :g_refno OR :g_refno_ind = 0)
		AND (MSG_NO = :chr_g_msg_no OR :g_msg_no_ind =0 )
		AND (to_char(RECEIVED_ON,'DD/MM/YYYY') = to_char(to_date(:g_receivedon,'dd/mm/yyyy'), 'dd/mm/yyyy') OR :g_receivedon_ind =0)
		AND (MSG_REF_NO = :g_msgrefno OR :g_msgrefno_ind = 0)
		AND (event_type = :g_event_type OR :g_event_type_ind = 0)
		AND (INSTR_CODE = :g_secode OR :g_secode_ind = 0)
		AND (REC_FROM_SENT_TO = :g_rec_from_sent_to OR :g_rec_from_sent_to_ind = 0)
		AND (IN_OUT = 'I')
		AND (ACCOUNT = :chr_g_client OR :g_account_ind = 0)
		AND MSG_NO ='566'
		AND MSG_FUNC = 'CA_RESP'
		AND MSG_STS='STP';

	IS_ANY_ORA_ERROR



		EXEC SQL SELECT NVL(COUNT(DISTINCT FILE_NAME), 0)
		INTO :h_no_of_caresp
		FROM DF_COMMON_MSGRPT
		WHERE ((RECEIVED_ON = :p_rep_date) OR (RECEIVED_ON < :p_rep_date))
		AND (REP_FLG = 'N')
		AND (REF_NO = :g_refno OR :g_refno_ind = 0)
		AND (MSG_NO = :chr_g_msg_no OR :g_msg_no_ind =0 )
		AND (to_char(RECEIVED_ON,'DD/MM/YYYY')= to_char(to_date(:g_receivedon,'dd/mm/yyyy'), 'dd/mm/yyyy') OR :g_receivedon_ind =0)
		AND (MSG_REF_NO = :g_msgrefno OR :g_msgrefno_ind = 0)
		AND (event_type = :g_event_type OR :g_event_type_ind = 0)
		AND (INSTR_CODE = :g_secode OR :g_secode_ind = 0)
		AND (REC_FROM_SENT_TO = :g_rec_from_sent_to OR :g_rec_from_sent_to_ind = 0)
		AND (IN_OUT = 'I')
		AND (ACCOUNT = :chr_g_client OR :g_account_ind = 0)
		AND MSG_NO ='565'
		AND MSG_FUNC = 'CA_RESP'
		AND MSG_STS='RJT';

	IS_ANY_ORA_ERROR





		EXEC SQL SELECT NVL(COUNT(DISTINCT FILE_NAME), 0)
		INTO :h_no_of_canarr
		FROM DF_COMMON_MSGRPT
		WHERE ((RECEIVED_ON = :p_rep_date) OR (RECEIVED_ON < :p_rep_date))
		AND (REP_FLG = 'N')
		AND (REF_NO = :g_refno OR :g_refno_ind = 0)
		AND (MSG_NO = :chr_g_msg_no OR :g_msg_no_ind =0 )
		AND (to_char(RECEIVED_ON,'DD/MM/YYYY') = to_char(to_date(:g_receivedon,'dd/mm/yyyy'), 'dd/mm/yyyy') OR :g_receivedon_ind =0)
		AND (MSG_REF_NO = :g_msgrefno OR :g_msgrefno_ind = 0)
		AND (event_type = :g_event_type OR :g_event_type_ind = 0)
		AND (INSTR_CODE = :g_secode OR :g_secode_ind = 0)
		AND (REC_FROM_SENT_TO = :g_rec_from_sent_to OR :g_rec_from_sent_to_ind = 0)
		AND (IN_OUT = 'I')
		AND (ACCOUNT = :chr_g_client OR :g_account_ind = 0)
		AND MSG_NO ='568'
		AND MSG_FUNC = 'CA_NARR';


	IS_ANY_ORA_ERROR





		EXEC SQL SELECT NVL(COUNT(DISTINCT FILE_NAME), 0)
		INTO :h_no_of_canarrRPR
		FROM DF_COMMON_MSGRPT
		WHERE ((RECEIVED_ON = :p_rep_date) OR (RECEIVED_ON < :p_rep_date))
		AND (REP_FLG = 'N')
		AND (REF_NO = :g_refno OR :g_refno_ind = 0)
		AND (MSG_NO = :chr_g_msg_no OR :g_msg_no_ind =0 )
		AND (to_char(RECEIVED_ON,'DD/MM/YYYY') = to_char(to_date(:g_receivedon,'dd/mm/yyyy'), 'dd/mm/yyyy') OR :g_receivedon_ind =0)
		AND (MSG_REF_NO = :g_msgrefno OR :g_msgrefno_ind = 0)
		AND (event_type = :g_event_type OR :g_event_type_ind = 0)
		AND (INSTR_CODE = :g_secode OR :g_secode_ind = 0)
		AND (REC_FROM_SENT_TO = :g_rec_from_sent_to OR :g_rec_from_sent_to_ind = 0)
		AND (IN_OUT = 'I')
		AND (ACCOUNT = :chr_g_client OR :g_account_ind = 0)
		AND MSG_NO ='568'
		AND MSG_FUNC = 'CA_NARR'
		AND MSG_STS='RPR';

	IS_ANY_ORA_ERROR





		EXEC SQL SELECT NVL(COUNT(DISTINCT FILE_NAME), 0)
		INTO :h_no_of_canarrSTP
		FROM DF_COMMON_MSGRPT
		WHERE ((RECEIVED_ON = :p_rep_date) OR (RECEIVED_ON < :p_rep_date))
		AND (REP_FLG = 'N')
		AND (REF_NO = :g_refno OR :g_refno_ind = 0)
		AND (MSG_NO = :chr_g_msg_no OR :g_msg_no_ind =0 )
		AND (to_char(RECEIVED_ON,'DD/MM/YYYY') = to_char(to_date(:g_receivedon,'dd/mm/yyyy'), 'dd/mm/yyyy') OR :g_receivedon_ind =0)
		AND (MSG_REF_NO = :g_msgrefno OR :g_msgrefno_ind = 0)
		AND (event_type = :g_event_type OR :g_event_type_ind = 0)
		AND (INSTR_CODE = :g_secode OR :g_secode_ind = 0)
		AND (REC_FROM_SENT_TO = :g_rec_from_sent_to OR :g_rec_from_sent_to_ind = 0)
		AND (IN_OUT = 'I')
		AND (ACCOUNT = :chr_g_client OR :g_account_ind = 0)
		AND MSG_NO ='568'
		AND MSG_FUNC = 'CA_NARR'
		AND MSG_STS='STP';

	IS_ANY_ORA_ERROR



		EXEC SQL SELECT NVL(COUNT(DISTINCT FILE_NAME), 0)
		INTO :h_no_of_carightsRJT
		FROM DF_COMMON_MSGRPT
		WHERE ((RECEIVED_ON = :p_rep_date) OR (RECEIVED_ON < :p_rep_date))
		AND (REP_FLG = 'N')
		AND (REF_NO = :g_refno OR :g_refno_ind = 0)
		AND (MSG_NO = :chr_g_msg_no OR :g_msg_no_ind =0 )
		AND (to_char(RECEIVED_ON,'DD/MM/YYYY') = to_char(to_date(:g_receivedon,'dd/mm/yyyy'), 'dd/mm/yyyy') OR :g_receivedon_ind =0)
		AND (MSG_REF_NO = :g_msgrefno OR :g_msgrefno_ind = 0)
		AND (event_type = :g_event_type OR :g_event_type_ind = 0)
		AND (INSTR_CODE = :g_secode OR :g_secode_ind = 0)
		AND (REC_FROM_SENT_TO = :g_rec_from_sent_to OR :g_rec_from_sent_to_ind = 0)
		AND (IN_OUT = 'I')
		AND (ACCOUNT = :chr_g_client OR :g_account_ind = 0)
		AND MSG_NO ='568'
		AND MSG_FUNC = 'CA_RIGHTS'
		AND MSG_STS='RJT';

	IS_ANY_ORA_ERROR


		EXEC SQL SELECT NVL(COUNT(DISTINCT FILE_NAME), 0)
		INTO :h_no_of_carights
		FROM DF_COMMON_MSGRPT
		WHERE ((RECEIVED_ON = :p_rep_date) OR (RECEIVED_ON < :p_rep_date))
		AND (REP_FLG = 'N')
		AND (REF_NO = :g_refno OR :g_refno_ind = 0)
		AND (MSG_NO = :chr_g_msg_no OR :g_msg_no_ind =0 )
		AND (to_char(RECEIVED_ON,'DD/MM/YYYY') = to_char(to_date(:g_receivedon,'dd/mm/yyyy'), 'dd/mm/yyyy') OR :g_receivedon_ind =0)
		AND (MSG_REF_NO = :g_msgrefno OR :g_msgrefno_ind = 0)
		AND (event_type = :g_event_type OR :g_event_type_ind = 0)
		AND (INSTR_CODE = :g_secode OR :g_secode_ind = 0)
		AND (REC_FROM_SENT_TO = :g_rec_from_sent_to OR :g_rec_from_sent_to_ind = 0)
		AND (IN_OUT = 'I')
		AND (ACCOUNT = :chr_g_client OR :g_account_ind = 0)
		AND MSG_NO ='566'
		AND MSG_FUNC = 'CA_RIGHTS';

	EXEC SQL SELECT NVL(COUNT(DISTINCT FILE_NAME), 0)
		INTO :h_no_of_carightsRPR
		FROM DF_COMMON_MSGRPT
		WHERE ((RECEIVED_ON = :p_rep_date) OR (RECEIVED_ON < :p_rep_date))
		AND (REP_FLG = 'N')
		AND (REF_NO = :g_refno OR :g_refno_ind = 0)
		AND (MSG_NO = :chr_g_msg_no OR :g_msg_no_ind =0 )
		AND (to_char(RECEIVED_ON,'DD/MM/YYYY') = to_char(to_date(:g_receivedon,'dd/mm/yyyy'), 'dd/mm/yyyy') OR :g_receivedon_ind =0)
		AND (MSG_REF_NO = :g_msgrefno OR :g_msgrefno_ind = 0)
		AND (event_type = :g_event_type OR :g_event_type_ind = 0)
		AND (INSTR_CODE = :g_secode OR :g_secode_ind = 0)
		AND (REC_FROM_SENT_TO = :g_rec_from_sent_to OR :g_rec_from_sent_to_ind = 0)
		AND (IN_OUT = 'I')
		AND (ACCOUNT = :chr_g_client OR :g_account_ind = 0)
		AND MSG_NO ='566'
		AND MSG_FUNC = 'CA_RIGHTS'
		AND MSG_STS='RPR';

	IS_ANY_ORA_ERROR

		EXEC SQL SELECT NVL(COUNT(DISTINCT FILE_NAME), 0)
		INTO :h_no_of_carightsSTP
		FROM DF_COMMON_MSGRPT
		WHERE ((RECEIVED_ON = :p_rep_date) OR (RECEIVED_ON < :p_rep_date))
		AND (REP_FLG = 'N')
		AND (REF_NO = :g_refno OR :g_refno_ind = 0)
		AND (MSG_NO = :chr_g_msg_no OR :g_msg_no_ind =0 )
		AND (to_char(RECEIVED_ON,'DD/MM/YYYY') = to_char(to_date(:g_receivedon,'dd/mm/yyyy'), 'dd/mm/yyyy') OR :g_receivedon_ind =0)
		AND (MSG_REF_NO = :g_msgrefno OR :g_msgrefno_ind = 0)
		AND (event_type = :g_event_type OR :g_event_type_ind = 0)
		AND (INSTR_CODE = :g_secode OR :g_secode_ind = 0)
		AND (REC_FROM_SENT_TO = :g_rec_from_sent_to OR :g_rec_from_sent_to_ind = 0)
		AND (IN_OUT = 'I')
		AND (ACCOUNT = :chr_g_client OR :g_account_ind = 0)
		AND MSG_NO ='566'
		AND MSG_FUNC = 'CA_RIGHTS'
		AND MSG_STS='STP';

	IS_ANY_ORA_ERROR





		fprintf(p_fp_report,"\n");
	fprintf(p_fp_report,"\n");
	fprintf(p_fp_report,"***************************************************************************************************\n");
	fprintf(p_fp_report,"                             Summary Till chr_last Requsest Made                         \n");
	fprintf(p_fp_report,"***************************************************************************************************\n");
	fprintf(p_fp_report,"\n");
	fprintf(p_fp_report,"\n");

	fprintf(p_fp_report,"%10sTotal number of messages processed                                 : %d\n","",int_h_no_of_processed);
	fprintf(p_fp_report,"%10sTotal number of messages for Deal Input                            : %d\n","",h_no_of_trdcanc);
	fprintf(p_fp_report,"%10sTotal number of messages Deal Input            Messages STP        : %d\n","",h_no_of_trdinpSTP);
	fprintf(p_fp_report,"%10sTotal number of messages Deal Input            Messages RPR        : %d\n","",h_no_of_trdinpRPR);
	fprintf(p_fp_report,"%10sTotal number of messages Deal Input            Messages RJT        : %d\n","",h_no_of_trdinpRJT);
	fprintf(p_fp_report,"%10sTotal number of messages Deal for Cancellation                     : %d\n","",h_no_of_trdcanc);
	fprintf(p_fp_report,"%10sTotal number of messages Deal for Cancellation     Messages  STP   : %d\n","",h_no_of_trdcancSTP);
	fprintf(p_fp_report,"%10sTotal number of messages Deal for Cancellation     Messages  RPR   : %d\n","",h_no_of_trdcancRPR);
	fprintf(p_fp_report,"%10sTotal number of messages Deal for Cancellation     Messages  RJT   : %d\n","",h_no_of_trdcancRJT);

	fprintf(p_fp_report,"%10sTotal number of messages for  BCN Input                            : %d\n","",h_no_of_trdcanc);
	fprintf(p_fp_report,"%10sTotal number of messages BCN  Input            Messages STP        : %d\n","",h_no_of_trdinpSTP);
	fprintf(p_fp_report,"%10sTotal number of messages BCN  Input            Messages RPR        : %d\n","",h_no_of_trdinpRPR);
	fprintf(p_fp_report,"%10sTotal number of messages BCN  Input            Messages RJT        : %d\n","",h_no_of_trdinpRJT);
	fprintf(p_fp_report,"%10sTotal number of messages BCN  for Cancellation                     : %d\n","",h_no_of_trdcanc);
	fprintf(p_fp_report,"%10sTotal number of messages BCN  for Cancellation     Messages  STP   : %d\n","",h_no_of_trdcancSTP);
	fprintf(p_fp_report,"%10sTotal number of messages BCN  for Cancellation     Messages  RPR   : %d\n","",h_no_of_trdcancRPR);
	fprintf(p_fp_report,"%10sTotal number of messages BCN  for Cancellation     Messages  RJT   : %d\n","",h_no_of_trdcancRJT);
	fprintf(p_fp_report,"***************************************************************************************************\n");

	APL_GOBACK_SUCCESS

		RETURN_SUCCESS:

		{
			CO_ProcMonitor(APL_OUT_FILE, "Exiting Out Of GenCommSummary successfully\n", NULL, NULL);
			return(APL_SUCCESS);
		}

RETURN_FAILURE:
	{
		CO_ProcMonitor(APL_OUT_FILE, "Exiting Out Of GenCommSummary  unsuccessfully\n", NULL, NULL);
		return(APL_FAILURE);
	}
}


int  dump_message(FILE *p_fp_userlog, FILE *p_fp_report, char *p_rep_date, char *p_archmsgnm, char *p_repfilenm,char *p_msgstat, DEBUG_INFO_STRUCT_H **l_debug_info_ptr)
{
	char last_trd_ca[2];
	char chr_l_bad_file[PATH_LENGTH] = APL_NULL_STRING;
	char last_filename[PATH_LENGTH] = APL_NULL_STRING; 
	EXEC SQL BEGIN DECLARE SECTION;
	char chr_h_mesg_status[4] = APL_NULL_STRING;
	FILE *fp_content = (FILE *) NULL ;
	FILE *fp_msgfile = (FILE *) NULL;
	struct sqlca sqlca;
	DF_COMMON_MSGRPT_STRUCT_H h_common_report;
	DF_COMMON_MSGRPT_STRUCT_I i_common_report={0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};

	char chr_reason_desc[41] = APL_NULL_STRING;
	int int_l_isfirstmsg=1; 
	char chr_command[500];
	char last_msgstatus[4];
	char l_last_trdca[2];
	char chr_l_msgline[LINERR_LENGTH] = APL_NULL_STRING;
	char chr_l_temp_msgline[LINERR_LENGTH] = APL_NULL_STRING;
	int i=1;    
	char l_str_qry1[50]=APL_NULL_STRING;
	char l_str_qry2[50]=APL_NULL_STRING;
	char l_str_qry3[50]=APL_NULL_STRING;
	char l_str_qry4[50]=APL_NULL_STRING;
	char l_str_qry5[50]=APL_NULL_STRING;

	EXEC SQL VAR h_common_report.h_file_name IS STRING;
	EXEC SQL VAR h_common_report.h_msgsts IS STRING;
	EXEC SQL VAR h_common_report.h_failure_reason IS STRING;
	EXEC SQL END DECLARE SECTION;
	/*	
		i_common_report = (DF_COMMON_MSGRPT_STRUCT_I *)calloc(1,sizeof(DF_COMMON_MSGRPT_STRUCT_I));

		memset(i_common_report,APL_NULL_STRING,sizeof(DF_COMMON_MSGRPT_STRUCT_I));
		*/

	APL_IF_DEBUG 
		printf("Entered function dump_message\n");

	if(strcmp(g_refno,APL_NULL_STRING) == 0)
	{	
		strcpy(g_refno,"%");
		strcpy(l_str_qry1,"or REF_NO IS NULL");
	}
	if(strcmp(g_msgrefno,APL_NULL_STRING) == 0)
	{
		strcpy(g_msgrefno,"%");
		strcpy(l_str_qry2,"or MSG_REF_NO IS NULL");
	}

	if(strcmp(g_event_type,APL_NULL_STRING) == 0)
	{
		strcpy(g_event_type,"%");
		strcpy(l_str_qry3,  "or EVENT_TYPE IS NULL");
	}

	if(strcmp(g_secode,APL_NULL_STRING) == 0)
	{
		strcpy(g_secode,"%");
		strcpy(l_str_qry4,"or INSTR_CODE IS NULL");
	}
	if(strcmp(g_rec_from_sent_to,APL_NULL_STRING) == 0)
	{
		strcpy(g_rec_from_sent_to,"%");
		strcpy(l_str_qry5," or REC_FROM_SENT_TO IS NULL");
	}

	printf("\n ********** p_Re_Date = |%s| ",g_receivedon);
	fflush(stdout);
	EXEC SQL DECLARE REPORT_CURSOR CURSOR FOR   
		SELECT ACCOUNT,REF_NO, INSTR_CODE,MSG_NO,RECEIVED_ON,MSG_FUNC,MIS_INFO,
				 FILE_NAME,FAILURE_REASON,REP_FLG, MSG_STS,REC_FROM_SENT_TO,MSG_REF_NO, 
				 IN_OUT, TRD_CA,event_type,CA_ID  FROM DF_COMMON_MSGRPT
		WHERE (to_char(RECEIVED_ON,'DD/MM/YYYY') <=  to_char(to_date(:g_receivedon,'DD/MM/YYYY'),'DD/MM/YYYY'))
		AND  (MSG_STS = DECODE(:p_msgstat,'ALL',MSG_STS,:p_msgstat))
		AND (REP_FLG = 'N')
		AND (MSG_NO = :chr_g_msg_no OR :g_msg_no_ind =0 )
		AND (IN_OUT = 'I')
		ORDER BY MSG_STS,MSG_NO,MSG_FUNC,FILE_NAME,TRD_CA;
	if( sqlca.sqlcode != 0 )
		printf("sqlcode is %d\n",sqlca.sqlcode); 

	EXEC SQL OPEN REPORT_CURSOR;
	IS_ANY_ORA_ERROR;

		APL_IF_DEBUG
		{
			printf("main query executed \n");

		}

	for ( ; ; )
	{ 
		memset(&h_common_report, NULL, sizeof(DF_COMMON_MSGRPT_STRUCT_H));
		memset(&i_common_report, 0, sizeof(DF_COMMON_MSGRPT_STRUCT_I));
		APL_IF_DEBUG
		{
			printf("common report structure memset done \n");

		}

		EXEC SQL FETCH REPORT_CURSOR
			INTO  :h_common_report:i_common_report;
		printf("Cursor sqlcode %d\n",sqlca.sqlcode);	
		if(sqlca.sqlcode == 1403)
			break;
		IS_ANY_ORA_ERROR	;

		APL_IF_DEBUG
		{
			printf("fetch of the report cursor done  \n");

		}
		if ( APL_ZERO_RESULT_SET )
		{
			break;
		}


		if ((int_l_isfirstmsg) && !strcmp(h_common_report.h_trd_ca,"C"))
		{
			fprintf(p_fp_report, "\n\n\n");
			fprintf(p_fp_report,"***************************************************************************************************\n");
			fprintf(p_fp_report, "%30s CA RELATED MESSAGES\n\n\n","");
			fprintf(p_fp_report,"**************************************************************************************************\n\n");
			int_l_isfirstmsg = 0;
		}

		if(strcmp(l_last_trdca,h_common_report.h_trd_ca) && !strcmp(h_common_report.h_trd_ca,"T")) 
		{
			fprintf(p_fp_report, "\n\n\n");
		}

		if(strcmp(last_filename,h_common_report.h_file_name))
		{
			fprintf(p_fp_report,"**************************************************************************************************\n\n");

			fprintf(p_fp_report,"%5s%d.FILENAME : %s %2s Message Number : %s %2s Message Function : %s\n","",i++,h_common_report.h_file_name,"",h_common_report.h_msg_no,"",h_common_report.h_msg_func);

			fprintf(p_fp_report,"--------------------------------------------------------------------------------------------------\n\n");
			memset(chr_command, APL_NULL_CHAR, 500);
			APL_IF_DEBUG
			{
				printf("report file  name %s \n",h_common_report.h_file_name );
				printf("directory name    %s \n",p_archmsgnm);

			}
			sprintf(chr_command,"%s/%s", p_archmsgnm, h_common_report.h_file_name);

			if ((fp_content = fopen(chr_command,"r")) == (FILE *) NULL )
			{
				fprintf(p_fp_userlog,"Failed To Open The Incoming Message File %s \n",  h_common_report.h_file_name);
				fprintf(p_fp_report,"                                                        **File Not Found. **\n");
				fflush(p_fp_userlog);
				fflush(p_fp_report);
			}
			else
			{
				fclose(fp_content);
				if ( (fp_msgfile = fopen(chr_command, "r")) == (FILE *)NULL )
				{
					{
						fprintf(p_fp_userlog, "Could not read contents of message file.\n");
						fflush(p_fp_userlog);
						APL_GOBACK_FAIL
					}
				}
				else
				{
					while ( !feof(fp_msgfile) )
					{
						memset(chr_l_msgline, APL_NULL_CHAR, LINERR_LENGTH);
						memset(chr_l_temp_msgline, APL_NULL_CHAR, LINERR_LENGTH);
						fscanf(fp_msgfile, "%[^\n]\n", chr_l_temp_msgline);
						strncpy(chr_l_msgline, chr_l_temp_msgline, LINERR_LENGTH -1 );
						chr_l_msgline[strlen(chr_l_msgline)] =APL_NULL_CHAR;
						CO_WrLog_WODtTime(p_fp_report, chr_l_msgline, NULL, NULL);
					}
					fclose(fp_msgfile);
				}                 
			}

			fprintf(p_fp_report,"-------------------------------------------------------------------------------------------------\n\n");

			APL_IF_DEBUG
			{
				printf("message status_ind %s \n",h_common_report.h_msgsts );
			}

			if(!strcmp(h_common_report.h_msgsts,"RJT"))
				strcpy(chr_reason_desc,"REASONS FOR REJECTION\n");
			else if(!strcmp(h_common_report.h_msgsts,"RPR"))
				strcpy(chr_reason_desc,"REASONS FOR REPAIR\n");
			else if(!strcmp(h_common_report.h_msgsts,"STP"))
				strcpy(chr_reason_desc,"STRAIGHT THROUGH PROCESSED\n");

			fprintf(p_fp_report,"%10s %s \n","",chr_reason_desc);	
			fprintf(p_fp_report,"--------------------------------------------------------------------------------------------------\n\n");


			APL_IF_DEBUG
			{
				printf("Failure Reason %s ",h_common_report.h_failure_reason);

			}
			fprintf(p_fp_report,"%10s(*) %s \n","",h_common_report.h_failure_reason); 
			strcpy(chr_reason_desc,APL_NULL_STRING);
		}
		else 
		{
			if(!strcmp(last_msgstatus,h_common_report.h_msgsts))
			{
				fprintf(p_fp_report,"%10s(*) %s \n","",h_common_report.h_failure_reason);
			} 
			else
			{	
				fprintf(p_fp_report,"--------------------------------------------------------------------------------------------------\n");
				fprintf(p_fp_report,"**************************************************************************************************\n\n");
				fprintf(p_fp_report,"%5s%d.  FILENAME : %s %2s Message Number : %s %2s Message Function : %s\n","",i++,h_common_report.h_file_name,"",h_common_report.h_msg_no,"",h_common_report.h_msg_func);
				fprintf(p_fp_report,"--------------------------------------------------------------------------------------------------\n\n");
				memset(chr_command, APL_NULL_CHAR, 500);
				sprintf(chr_command,"%s/%s", p_archmsgnm, h_common_report.h_file_name);
				if ((fp_content = fopen(chr_command,"r")) == (FILE *) NULL )
				{
					fprintf(p_fp_userlog,"Failed To Open The Incoming Message File %s \n", h_common_report.h_file_name);
					fprintf(p_fp_report,"                                                        **File Not Found. **\n");
					fflush(p_fp_userlog);
					fflush(p_fp_report);
					memset(chr_l_bad_file, APL_NULL_CHAR,PATH_LENGTH);
					strcpy(chr_l_bad_file, h_common_report.h_file_name);
				}
				else
				{
					fclose(fp_content);
					if ( (fp_msgfile = fopen(chr_command, "r")) == (FILE *)NULL )
					{
						fprintf(p_fp_userlog, "Could not read contents of message file.\n");
						fflush(p_fp_userlog);
						APL_GOBACK_FAIL
					}
					else
					{
						while ( !feof(fp_msgfile) )
						{
							memset(chr_l_msgline, APL_NULL_CHAR, LINERR_LENGTH);
							memset(chr_l_temp_msgline, APL_NULL_CHAR, LINERR_LENGTH);
							fscanf(fp_msgfile, "%[^\n]\n", chr_l_temp_msgline);
							strncpy(chr_l_msgline, chr_l_temp_msgline, LINERR_LENGTH -1 );
							CO_WrLog_WODtTime(p_fp_report, chr_l_msgline, NULL, NULL);
						}
						fclose(fp_msgfile);
					}
					fprintf(p_fp_report,"--------------------------------------------------------------------------------------------------\n\n");
					strcpy(chr_reason_desc,APL_NULL_STRING);
				}
				fprintf(p_fp_report,"--------------------------------------------------------------------------------------------------\n\n");

				if(!strcmp(h_common_report.h_msgsts,"RJT"))
					strcpy(chr_reason_desc,"REASONS FOR REJECTION\n");
				else if(!strcmp(h_common_report.h_msgsts,"RPR"))
					strcpy(chr_reason_desc,"REASONS FOR REPAIR\n");
				else if(!strcmp(h_common_report.h_msgsts,"STP"))
					strcpy(chr_reason_desc,"STRAIGHT THROUGH PROCESSED\n");
				else if ( !strcmp(h_common_report.h_msgsts,"TMO")) /** not needed */
					strcpy(chr_reason_desc,"TIME OUT\n");

				fprintf(p_fp_report,"%10s %s \n","",chr_reason_desc);	
				fprintf(p_fp_report,"--------------------------------------------------------------------------------------------------\n\n");
				fprintf(p_fp_report,"%10s(*) %s \n","",h_common_report.h_failure_reason);
				strcpy(chr_reason_desc,APL_NULL_STRING);
			}
		}
		strcpy(l_last_trdca,h_common_report.h_trd_ca);
		strcpy(last_filename, h_common_report.h_file_name);
		strcpy(last_msgstatus,h_common_report.h_msgsts);
		fflush(p_fp_report);
	}


	EXEC SQL CLOSE REPORT_CURSOR;
	IS_ANY_ORA_ERROR;

	APL_GOBACK_SUCCESS;


RETURN_SUCCESS:
	{
		CO_ProcMonitor(APL_OUT_FILE, "Exiting Out Of dump_common_report successfully\n", NULL, NULL); 
		fflush(p_fp_report);
		return(APL_SUCCESS);
	}

RETURN_FAILURE:
	{
		CO_ProcMonitor(APL_OUT_FILE, "Exiting Out Of dump_common_report unsuccessfully\n", l_debug_info_ptr, NULL);
		fflush(p_fp_report);
		return(APL_FAILURE);
	}
}
