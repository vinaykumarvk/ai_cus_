

  



 
#include "CO_HostStructdef.h" 
#include "CO_Externdef.h"
#define ERR_PAGELENGTH	55
#define BLANKS_8	"        "
#define APL_FUNC_PRV 	"PRV"



EXEC SQL INCLUDE SQLCA.H;

int CBLRErr_RepFn(char *chr_p_err_filedesc, 
						FILE *p_err_filehandle, 
						char *p_errflg,
						FILE *p_logfile,
						INTL_ENV_DATA_STRUCT_H *p_intl_envdatastruct_h, 
						DEBUG_INFO_STRUCT_H **l_debug_info_ptr)
{
	short p_eocursor = 0;
   char chr_l_dclient[APL_CLIENT_LENGTH] = APL_NULL_STRING;
   char chr_l_cclient[APL_CLIENT_LENGTH] = APL_NULL_STRING;
	char chr_l_wording[66] = APL_NULL_STRING;
	char chr_l_errflg = APL_NULL_CHAR;
	int	int_l_count = 0;
	short l_lineCount = 11;
	short p_pgno  = 1;

	DL_LOCALREPPROC_STRUCT_H *l_dl_loc_repproc_struct_h = NULL;
	DL_LOCALREPPROC_STRUCT_I *l_dl_localrepproc_struct_ia = NULL;

	l_dl_loc_repproc_struct_h = (DL_LOCALREPPROC_STRUCT_H *)malloc(sizeof(DL_LOCALREPPROC_STRUCT_H));
	l_dl_localrepproc_struct_ia = (DL_LOCALREPPROC_STRUCT_I *)malloc(sizeof(DL_LOCALREPPROC_STRUCT_I));

   EXEC SQL BEGIN DECLARE SECTION;
   EXEC SQL VAR l_dl_loc_repproc_struct_h->h_dl_client IS STRING;
   EXEC SQL VAR l_dl_loc_repproc_struct_h->h_indentity_no IS STRING;
   EXEC SQL VAR l_dl_loc_repproc_struct_h->h_instr_code IS STRING;
   EXEC SQL VAR l_dl_loc_repproc_struct_h->h_ctclt IS STRING;
   EXEC SQL VAR l_dl_loc_repproc_struct_h->h_dbclt IS STRING;
   EXEC SQL VAR l_dl_loc_repproc_struct_h->h_domcpclt_cd IS STRING;
   EXEC SQL VAR l_dl_loc_repproc_struct_h->h_ord_ind IS STRING;
   EXEC SQL VAR l_dl_loc_repproc_struct_h->h_lrdltype IS STRING;
   EXEC SQL VAR l_dl_loc_repproc_struct_h->h_dealcd IS STRING;
   EXEC SQL VAR l_dl_loc_repproc_struct_h->h_reset_ind IS STRING;
   EXEC SQL END DECLARE SECTION;
	

	APL_IF_DEBUG
	{
		fprintf(APL_OUT_FILE,"Entered CBLRErr_RepFn\n");
	}
	CO_ProcMonitor(   p_logfile, "Entered processtion CDCBLRErr_RepFn\n", NULL, NULL);

	APL_MALLOC_FAIL(l_dl_loc_repproc_struct_h);
	APL_MALLOC_FAIL(l_dl_localrepproc_struct_ia);

	EXEC SQL SELECT COUNT(*) INTO :int_l_count FROM DL_LOCALREPPROC WHERE R_CODE = 2;

	IS_ANY_ORA_ERROR;

	fprintf( p_logfile, "The number of l_debuglist recs is :%d\n",int_l_count);

	if ( int_l_count > 0 )
	{
		if (APL_FAILURE == CBLRErrRepHdrFn(chr_p_err_filedesc,p_err_filehandle,p_pgno,p_logfile,l_debug_info_ptr))
		{
			APL_GOBACK_FAIL
		}

		if (APL_FAILURE == CR_Def_LRErrEntCursor(l_debug_info_ptr))
		{
			APL_GOBACK_FAIL
		}

		while (p_eocursor == 0)
		{
			if (APL_FAILURE == CR_Rtv_LRErrEntCursor(&p_eocursor,l_dl_loc_repproc_struct_h,l_dl_localrepproc_struct_ia,l_debug_info_ptr))
			{
				APL_GOBACK_FAIL
			}

			if (p_eocursor != 0)
			{
				continue;
			}
			
			strcpy(chr_l_dclient,l_dl_loc_repproc_struct_h->h_dbclt);
			strcpy(chr_l_cclient,l_dl_loc_repproc_struct_h->h_ctclt);

			if (APL_FAILURE == CR_Proc_LRErrWordCursor(l_dl_loc_repproc_struct_h,chr_l_wording,chr_l_dclient,chr_l_cclient,l_debug_info_ptr))
			{
				APL_GOBACK_FAIL
			}

			if (l_lineCount > ERR_PAGELENGTH)
			{
				l_lineCount = 11;
				p_pgno++;
				if ( p_pgno > 1 )
				{
					fprintf(p_err_filehandle,"\f");
				}
				if (APL_FAILURE == CBLRErrRepHdrFn(chr_p_err_filedesc,p_err_filehandle,p_pgno,p_logfile,l_debug_info_ptr))
				{
					APL_GOBACK_FAIL
				}
			}
			fprintf(p_err_filehandle,"%-20s%-20s%-65s%21.lf\n",chr_l_dclient,chr_l_cclient,chr_l_wording,l_dl_loc_repproc_struct_h->h_qty);
			l_lineCount++;
		}  

		EXEC SQL ROLLBACK WORK;
		IS_ANY_ORA_ERROR;
		*p_errflg = 'Y';
	}
	else
	{
		fprintf(p_err_filehandle,"NO ERRORS TO REPORT\n");
	}	

	APL_GOBACK_SUCCESS
	
  	RETURN_SUCCESS :
	{
		CO_ProcMonitor(   p_logfile, "Exiting CBLRErr_RepFn processtion successfully\n", NULL, NULL);
		APL_IF_DEBUG
		{
			fprintf(APL_OUT_FILE,"Exiting CBLRErr_RepFn successfully\n");
		}
		APL_FREE(l_dl_loc_repproc_struct_h);
		APL_FREE(l_dl_localrepproc_struct_ia);
		return(APL_SUCCESS);
	}

	RETURN_FAILURE :
	{
		CO_ProcMonitor(   p_logfile, "Exiting CBLRErr_RepFn processtion with Failure\n", NULL, NULL);
		APL_IF_DEBUG
		{
			fprintf(APL_OUT_FILE,"Exiting CBLRErr_RepFn with errors\n");
		}
		APL_FREE(l_dl_loc_repproc_struct_h);
		APL_FREE(l_dl_localrepproc_struct_ia);
		return(APL_FAILURE);
	}
}




int CBLROpBkFn(char * p_procdate,
					char *chr_p_oprec_filedesc, 
					FILE *p_oprec_filehandle,
					short p_heading,
					short *p_status_ind,
					FILE *p_logfile,
					INTL_ENV_DATA_STRUCT_H *p_intl_envdatastruct_h, 
					DEBUG_INFO_STRUCT_H **l_debug_info_ptr)
{

   char chr_l_dclient[20] = APL_NULL_STRING;
   char chr_l_cclient[20] = APL_NULL_STRING;
	
	char chr_l_wording[66] = APL_NULL_STRING;
	char chr_l_previnstrcode[APL_INSTRUMENTCODE_LEN] = APL_NULL_STRING;
	char chr_p_instrdesc[131] = APL_NULL_STRING;
	char chr_p_isin[13] = APL_NULL_STRING;
	short j = 0;
	short l_lineCount = 11;
	short p_pgno  = 0;
	short p_eocursor = 0;
	double l_totquantity	 = 0;
	char chr_l_prnttotqty  = 'N';
	
	int int_l_seq_nbr = 1;
   char chr_l_temp_cclient[20] = APL_NULL_STRING;
   char chr_l_temp_dclient[20] = APL_NULL_STRING;
	char chr_l_typeofacc[2] = APL_NULL_STRING;
	char chr_l_ourtheir[2] = APL_NULL_STRING;
   char chr_l_typeoftrd[3] = APL_NULL_STRING;  
   char chr_l_trcode_a[2] = APL_NULL_STRING;  
   char chr_l_trade_status[3] = APL_NULL_STRING;  

	
   char chr_l_temp_accslash[20] = APL_NULL_STRING;

	DL_LOCALREPPROC_STRUCT_H *l_dl_loc_repproc_struct_h = NULL;
	DL_LOCALREPPROC_STRUCT_I *l_dl_localrepproc_struct_ia = NULL;

	l_dl_loc_repproc_struct_h = (DL_LOCALREPPROC_STRUCT_H *)malloc(sizeof(DL_LOCALREPPROC_STRUCT_H)) ;
	l_dl_localrepproc_struct_ia = (DL_LOCALREPPROC_STRUCT_I *)malloc(sizeof(DL_LOCALREPPROC_STRUCT_I)) ;

   EXEC SQL BEGIN DECLARE SECTION;
   EXEC SQL VAR l_dl_loc_repproc_struct_h->h_dl_client IS STRING;
   EXEC SQL VAR l_dl_loc_repproc_struct_h->h_indentity_no IS STRING;
   EXEC SQL VAR l_dl_loc_repproc_struct_h->h_instr_code IS STRING;
   EXEC SQL VAR l_dl_loc_repproc_struct_h->h_ctclt IS STRING;
   EXEC SQL VAR l_dl_loc_repproc_struct_h->h_dbclt IS STRING;
   EXEC SQL VAR l_dl_loc_repproc_struct_h->h_domcpclt_cd IS STRING;
   EXEC SQL VAR l_dl_loc_repproc_struct_h->h_ord_ind IS STRING;
   EXEC SQL VAR l_dl_loc_repproc_struct_h->h_lrdltype IS STRING;
   EXEC SQL VAR l_dl_loc_repproc_struct_h->h_dealcd IS STRING;
   EXEC SQL VAR l_dl_loc_repproc_struct_h->h_reset_ind IS STRING;
	EXEC SQL VAR chr_l_temp_accslash IS STRING;
	EXEC SQL VAR chr_l_typeoftrd IS STRING;
	EXEC SQL VAR chr_l_trcode_a IS STRING;
	EXEC SQL VAR chr_l_trade_status IS STRING;
   EXEC SQL END DECLARE SECTION;

	APL_IF_DEBUG
	{
		fprintf(APL_OUT_FILE,"Entered CBLROpBkFn\n");
	}

	CO_ProcMonitor(   p_logfile, "Entered processtion CBLROpBkFn\n", NULL, NULL);

	APL_MALLOC_FAIL(l_dl_loc_repproc_struct_h);
	APL_MALLOC_FAIL(l_dl_localrepproc_struct_ia);
	
	if (APL_FAILURE == CR_Chk_EOFLR(p_status_ind, p_heading,l_debug_info_ptr))
	{
		APL_GOBACK_FAIL
	}

	if (*p_status_ind == 3)
	{
		CBLREmptyHdrPrnFn(p_procdate,chr_p_oprec_filedesc,p_oprec_filehandle,p_logfile,l_debug_info_ptr);
	}
	else
	{

		

		
		if (APL_FAILURE == CR_Def_LROpBkCursor( p_heading, l_debug_info_ptr))
		{
			APL_GOBACK_FAIL
		}

		while (p_eocursor == 0)
		{

			if (APL_FAILURE == CR_Rtv_LROpBkCursor (&p_eocursor, p_heading, l_dl_loc_repproc_struct_h,l_dl_localrepproc_struct_ia,l_debug_info_ptr))
			{
				APL_GOBACK_FAIL
			}

			if (p_eocursor != 0)
			{
				for (j = 1; j < 135; j++)
				{
					fprintf(p_oprec_filehandle,"%s","-");
				}
				fprintf(p_oprec_filehandle,"\n");
				fprintf(p_oprec_filehandle,"%-100s%26.lf\n","Suma",l_totquantity);
				continue;
			}
			if (strcmp(chr_l_previnstrcode,l_dl_loc_repproc_struct_h->h_instr_code))
			{
				if (chr_l_prnttotqty == 'Y')
				{ 
					for (j = 1; j < 135; j++)
					{
						fprintf(p_oprec_filehandle,"%s","-");
					}
					fprintf(p_oprec_filehandle,"\n");
					fprintf(p_oprec_filehandle,"%-100s%26.lf\n","Suma",l_totquantity);
				}
				if (APL_FAILURE == CR_Rtv_LRInstrDesc(l_dl_loc_repproc_struct_h->h_instr_code,chr_p_instrdesc,chr_p_isin,l_debug_info_ptr))
				{
					APL_GOBACK_FAIL
				}

				
				int_l_seq_nbr = 1;
				l_totquantity = 0;
				l_lineCount = 11;
				p_pgno++;

            if ( p_pgno > 1 )
            {
               fprintf(p_oprec_filehandle,"\f");
            }

				if ( APL_FAILURE == CBLROpRecHdrPrnFn(chr_p_instrdesc,
																	chr_p_isin,
																	p_pgno, 
																	p_heading,
																	chr_p_oprec_filedesc, 
																	p_oprec_filehandle, 
																	p_logfile,
																	l_debug_info_ptr))
				{
					APL_GOBACK_FAIL
				}
				strcpy(chr_l_previnstrcode,l_dl_loc_repproc_struct_h->h_instr_code);
			}
			
			strcpy(chr_l_dclient,l_dl_loc_repproc_struct_h->h_dbclt);
			strcpy(chr_l_cclient,l_dl_loc_repproc_struct_h->h_ctclt);

			if (APL_FAILURE == CR_Rtv_LRErrWord(l_dl_loc_repproc_struct_h,chr_l_wording,chr_l_dclient,chr_l_cclient,l_debug_info_ptr))
			{
				APL_GOBACK_FAIL
			}

			if (!strcmp(l_dl_loc_repproc_struct_h->h_reset_ind,"Y"))
			{
				strcpy(chr_l_wording,"KOREKTA WNKS");
			}
			
			l_totquantity += l_dl_loc_repproc_struct_h->h_qty;
			chr_l_prnttotqty = 'Y';

			if (!strncmp(chr_l_dclient,"   ",3))
			{
				strcpy(chr_l_dclient,BLANKS_8);
			}

			if (!strncmp(chr_l_cclient,"   ",3))
			{
				strcpy(chr_l_cclient,BLANKS_8);
			}

			if (l_lineCount > ERR_PAGELENGTH)
			{
				l_lineCount = 11;
				p_pgno++;
            if ( p_pgno > 1 )
            {
               fprintf(p_oprec_filehandle,"\f");
            }

            if ( APL_FAILURE == CBLROpRecHdrPrnFn(chr_p_instrdesc,
                                                   chr_p_isin,
                                                   p_pgno, 
                                                   p_heading,
                                                   chr_p_oprec_filedesc, 
                                                   p_oprec_filehandle, 
																	p_logfile,
                                                   l_debug_info_ptr))
            {
               APL_GOBACK_FAIL
            }

			}
			if (l_dl_loc_repproc_struct_h->h_qty != 0)
			{
				
				memset(chr_l_temp_cclient,APL_NULL_CHAR,20);
				memset(chr_l_temp_dclient,APL_NULL_CHAR,20);
				memset(chr_l_typeofacc,APL_NULL_CHAR,2);
				memset(chr_l_ourtheir,APL_NULL_CHAR,2);
				if ( ( !strncmp(chr_l_cclient,"221",3 )) || ( !strncmp(chr_l_cclient,"222",3 )) || ( !strncmp(chr_l_cclient,"224",3 )) )
					  strncpy(chr_l_temp_cclient,chr_l_cclient,7); 
            else
					  strcpy(chr_l_temp_cclient,chr_l_cclient);


				if ( ( !strncmp(chr_l_dclient,"221",3 )) || ( !strncmp(chr_l_dclient,"222",3 )) || ( !strncmp(chr_l_dclient,"224",3 )) )
					  strncpy(chr_l_temp_dclient,chr_l_dclient,7);  
				else
					  strcpy(chr_l_temp_dclient,chr_l_dclient);

				
				if ( ( !strncmp(chr_l_cclient,"210",3 ) ) )
				{
					strncpy(chr_l_temp_cclient, chr_l_cclient,3);	
					chr_l_temp_cclient[3] =  APL_NULL_CHAR ;	
					memset(chr_l_temp_accslash, APL_NULL_CHAR, 20);
					printf("\nThe B4 temp clt slash :%s: temp cacc :%s:\n", chr_l_temp_accslash, chr_l_temp_cclient);
					if (strstr(chr_l_cclient,"/") != NULL)
						strcpy(chr_l_temp_accslash, strstr(chr_l_cclient,"/") + 1);
					else
						strcpy(chr_l_temp_accslash,APL_NULL_STRING);
					printf("\nThe After temp clt slash :%s: temp cacc :%s:\n", chr_l_temp_accslash, chr_l_temp_cclient);
					if(strlen(chr_l_temp_accslash) <= 0)
						{
							printf("\n Bhagwan hi bachaye... no slash present in the C client :%s: \n", chr_l_cclient);
						}
					else	
						{
						 printf("\nThe In else temp clt slash :%s: temp cacc :%s:\n", chr_l_temp_accslash, chr_l_temp_cclient);
						  if ( strcmp(chr_l_temp_accslash, "100001") == 0 )
								{
									strcat(chr_l_temp_cclient, " 09/");
								}
						  else if ( strcmp(chr_l_temp_accslash, "100002") == 0 )
								{
									strcat(chr_l_temp_cclient, " 06/");
								}
						  else 
							  {
								 
								 EXEC SQL SELECT NVL(CLN_CLASS,'1'),CLN_OUR_THEIR_IND
												INTO :chr_l_typeofacc, :chr_l_ourtheir
                                    FROM MT_CLIENT
                                   WHERE CLN_CODE = :chr_l_temp_accslash;
                          
                         IS_ANY_ORA_ERROR
								 if (( strcmp(chr_l_typeofacc,"N")== 0) && (strcmp(chr_l_ourtheir,"O") ==0))
									strcat(chr_l_temp_cclient, " 20/");
                         else if (( strcmp(chr_l_typeofacc ,"1")== 0) && (strcmp(chr_l_ourtheir,"O")  ==0))
									strcat(chr_l_temp_cclient, " 00 311/");
                         else
									strcat(chr_l_temp_cclient, " 00/");
                       }
						 printf("\nThe During temp clt slash :%s: temp cacc :%s:\n", chr_l_temp_accslash, chr_l_temp_cclient);
						strcat(chr_l_temp_cclient,APL_NULL_STRING);		
						strcat(chr_l_temp_cclient, chr_l_temp_accslash);		
						strcat(chr_l_temp_cclient, APL_NULL_STRING);		
						}
					printf("\nThe Final after temp clt slash :%s: temp cacc :%s:\n", chr_l_temp_accslash, chr_l_temp_cclient);
				}
				if ( ( !strncmp(chr_l_dclient,"210",3 ) ) )
				{
					strncpy(chr_l_temp_dclient, chr_l_dclient,3);	
					chr_l_temp_dclient[3] =  APL_NULL_CHAR ;	
					memset(chr_l_temp_accslash, APL_NULL_CHAR, 20);
					printf("\nThe B4 temp clt slash :%s: temp dacc :%s:\n", chr_l_temp_accslash, chr_l_temp_dclient);
					if (strstr(chr_l_dclient,"/") != NULL)
						strcpy(chr_l_temp_accslash, strstr(chr_l_dclient,"/") + 1);
					else
						strcpy(chr_l_temp_accslash,APL_NULL_STRING);
					printf("\nThe After temp clt slash :%s: temp dacc :%s:\n", chr_l_temp_accslash, chr_l_temp_dclient);
					if(strlen(chr_l_temp_accslash) <= 0)
						{
							printf("\n Bhagwan hi bachaye... no slash present in the D client :%s: \n", chr_l_dclient);
						}
					else	
						{
						  if ( strcmp(chr_l_temp_accslash, "100001") == 0 )
								{
									strcat(chr_l_temp_dclient, " 09/");
								}
						  else if ( strcmp(chr_l_temp_accslash, "100002") == 0 )
								{
									strcat(chr_l_temp_dclient, " 06/");
								}
						  else 
								{
								 
								 EXEC SQL SELECT NVL(CLN_CLASS,'1'),CLN_OUR_THEIR_IND
												INTO :chr_l_typeofacc, :chr_l_ourtheir
                                    FROM MT_CLIENT
                                   WHERE CLN_CODE = :chr_l_temp_accslash;
                          
                         IS_ANY_ORA_ERROR
								 if (( strcmp(chr_l_typeofacc,"N")== 0) && (strcmp(chr_l_ourtheir,"O") ==0))
									strcat(chr_l_temp_dclient, " 20/");
                         else if (( strcmp(chr_l_typeofacc,"1")== 0) && (strcmp(chr_l_ourtheir,"O")  ==0))
									strcat(chr_l_temp_dclient, " 00 311/");
                         else
									strcat(chr_l_temp_dclient, " 00/");
                        }
						printf("\nThe During temp clt slash :%s: temp dacc :%s:\n", chr_l_temp_accslash, chr_l_temp_dclient);
						strcat(chr_l_temp_dclient,APL_NULL_STRING);		
						strcat(chr_l_temp_dclient, chr_l_temp_accslash);		
						strcat(chr_l_temp_dclient, APL_NULL_STRING);		
						}
					printf("\nThe Final After temp clt slash :%s: temp dacc :%s:\n", chr_l_temp_accslash, chr_l_temp_dclient);
				}
				
            
				if ( ( !strncmp(chr_l_cclient,"110",3 ) ) && (strlen(chr_l_cclient) > 3) )
				{
					strncpy(chr_l_temp_cclient, chr_l_cclient,3);	
					chr_l_temp_cclient[3] =  APL_NULL_CHAR ;	
					memset(chr_l_temp_accslash, APL_NULL_CHAR, 20);
					printf("\nThe B4 temp clt slash :%s: temp cacc :%s:\n", chr_l_temp_accslash, chr_l_temp_cclient);
					if (strstr(chr_l_cclient,"/") != NULL)
						strcpy(chr_l_temp_accslash, strstr(chr_l_cclient,"/") + 1);
					else
						strcpy(chr_l_temp_accslash,APL_NULL_STRING);
					printf("\nThe After temp clt slash :%s: temp cacc :%s:\n", chr_l_temp_accslash, chr_l_temp_cclient);
					if(strlen(chr_l_temp_accslash) <= 0)
						{
							printf("\n Bhagwan hi bachaye... no slash present in the C client :%s: \n", chr_l_cclient);
						}
					else	
						{
						 
							 EXEC SQL SELECT NVL(CLN_CLASS,'1'),CLN_OUR_THEIR_IND
											INTO :chr_l_typeofacc, :chr_l_ourtheir
                                 FROM MT_CLIENT
                                WHERE CLN_CODE = :chr_l_temp_accslash;
                          
                         IS_ANY_ORA_ERROR
				 if (( strcmp(chr_l_typeofacc,"N")== 0) && (strcmp(chr_l_ourtheir,"O") ==0))
						strcpy(chr_l_temp_cclient, "160/");
             else
                 {
                 if (( strcmp(chr_l_typeofacc,"1")== 0) && (strcmp(chr_l_ourtheir,"O") ==0))
						strcpy(chr_l_temp_cclient, "311 00/");
                 else
						strcpy(chr_l_temp_cclient, "110/");
                 }
					       printf("\nThe During temp clt slash :%s: temp cacc :%s:\n", chr_l_temp_accslash, chr_l_temp_cclient);
						    strcat(chr_l_temp_cclient, chr_l_temp_accslash);		
						    strcat(chr_l_temp_cclient, APL_NULL_STRING);		
						}
					printf("\nThe Final after temp clt slash :%s: temp cacc :%s:\n", chr_l_temp_accslash, chr_l_temp_cclient);
				}
				if ( ( !strncmp(chr_l_dclient,"110",3 ) ) && (strlen(chr_l_dclient) > 3) )
				{
					strncpy(chr_l_temp_dclient, chr_l_dclient,3);	
					chr_l_temp_dclient[3] =  APL_NULL_CHAR ;	
					memset(chr_l_temp_accslash, APL_NULL_CHAR, 20);
					printf("\nThe B4 temp clt slash :%s: temp dacc :%s:\n", chr_l_temp_accslash, chr_l_temp_dclient);
					if (strstr(chr_l_dclient,"/") != NULL)
						strcpy(chr_l_temp_accslash, strstr(chr_l_dclient,"/") + 1);
					else
						strcpy(chr_l_temp_accslash,APL_NULL_STRING);
					printf("\nThe After temp clt slash :%s: temp dacc :%s:\n", chr_l_temp_accslash, chr_l_temp_dclient);
					if(strlen(chr_l_temp_accslash) <= 0)
						{
							printf("\n Bhagwan hi bachaye... no slash present in the D client :%s: \n", chr_l_dclient);
						}
					else	
						{
						 
							 EXEC SQL SELECT NVL(CLN_CLASS,'1'),CLN_OUR_THEIR_IND
											INTO :chr_l_typeofacc, :chr_l_ourtheir
                                 FROM MT_CLIENT
                               WHERE CLN_CODE = :chr_l_temp_accslash;
                       
                      IS_ANY_ORA_ERROR
						    if (( strcmp(chr_l_typeofacc,"N")== 0) && (strcmp(chr_l_ourtheir,"O") ==0))
								strcpy(chr_l_temp_dclient, "160/");
                      else if (( strcmp(chr_l_typeofacc,"1")== 0) && (strcmp(chr_l_ourtheir,"O") == 0))
                        {
                        
						      strcpy(chr_l_temp_dclient, "311 00/"); 
                        }
                      else
                        strcpy(chr_l_temp_dclient, "110/");
                       printf("\nThe During temp clt slash :%s: temp dacc :%s:\n", chr_l_temp_accslash, chr_l_temp_dclient);
						    strcat(chr_l_temp_dclient, chr_l_temp_accslash);		
						    strcat(chr_l_temp_dclient, APL_NULL_STRING);		
						}
					printf("\nThe Final After temp clt slash :%s: temp dacc :%s:\n", chr_l_temp_accslash, chr_l_temp_dclient);
				}
				
				memset(chr_l_typeoftrd,APL_NULL_CHAR,3);
				memset(chr_l_trcode_a,APL_NULL_CHAR,2);
				memset(chr_l_trade_status,APL_NULL_CHAR,3);
				EXEC SQL SELECT dl_class , deal_cd, DEAL_STAT
							  INTO :chr_l_typeoftrd,:chr_l_trcode_a, :chr_l_trade_status
                       FROM DL_DEAL
                      WHERE CLIENT = :l_dl_loc_repproc_struct_h->h_dl_client
								AND IDENTIY_NO   = :l_dl_loc_repproc_struct_h->h_indentity_no ;

				IS_ANY_ORA_ERROR
           
				printf("\n ******** Account[%s], refno[%s]",l_dl_loc_repproc_struct_h->h_dl_client,l_dl_loc_repproc_struct_h->h_indentity_no);
				printf("\n ******** Typeoftrd[%s], deal_cd[%s]",chr_l_typeoftrd, chr_l_trcode_a);
				printf("\n ******** chr_l_temp_dclient[%s], chr_l_temp_cclient[%s]",chr_l_temp_dclient, chr_l_temp_cclient);
				//printf("\n ******** l_dl_loc_repproc_struct_h->h_dtfld[%s]",l_dl_loc_repproc_struct_h->h_dtfld); Changes done for AIX Migration
				printf("\n ******** l_dl_loc_repproc_struct_h->h_dtfld[%d]",l_dl_loc_repproc_struct_h->h_dtfld);
				if ( strcmp(chr_l_typeoftrd ,"26") == 0 )
					{
					  if ( l_dl_loc_repproc_struct_h->h_dtfld != 3 ) 
						 {
                     if ((strcmp(chr_l_trcode_a,APL_DEAL_RVP)==0) || (strcmp(chr_l_trcode_a,APL_DEAL_RF)==0) || (strcmp(chr_l_trcode_a,APL_DEAL_CR)==0) || (strcmp(chr_l_trcode_a,APL_DEAL_RCR)==0))
						      strcpy(chr_l_temp_dclient,"224/924");
					      else
                        strcpy(chr_l_temp_cclient,"221/924");
                   }
                 else
						 {
                     if ((strcmp(chr_l_trcode_a,APL_DEAL_RVP)==0) || (strcmp(chr_l_trcode_a,APL_DEAL_RF)==0) || (strcmp(chr_l_trcode_a,APL_DEAL_CR)==0) || (strcmp(chr_l_trcode_a,APL_DEAL_RCR)==0))
                       {
                        
						      strcpy(chr_l_temp_cclient,"224/924");
                       }
					      else
						     {
                        strcpy(chr_l_temp_dclient,"221/924");
                       }
						 }
				fprintf(p_oprec_filehandle,"%4d  %-25s%-25s %-60s%26.lf\n",int_l_seq_nbr,chr_l_temp_dclient,chr_l_temp_cclient,chr_l_wording,l_dl_loc_repproc_struct_h->h_qty);
					}
            else
	         fprintf(p_oprec_filehandle,"%4d  %-25s%-25s %-60s%26.lf\n",int_l_seq_nbr,chr_l_temp_dclient,chr_l_temp_cclient,chr_l_wording,l_dl_loc_repproc_struct_h->h_qty);
				l_lineCount++;
				int_l_seq_nbr++;
			}
		}
	}

	APL_GOBACK_SUCCESS
	
  	RETURN_SUCCESS :
	{
		CO_ProcMonitor(   p_logfile, "Exiting CBLROpBkFn processtion successfully\n", NULL, NULL);
		APL_IF_DEBUG
		{
			fprintf(APL_OUT_FILE,"Exiting CBLROpBkFn successfully\n");
		}
		APL_FREE(l_dl_loc_repproc_struct_h);
		APL_FREE(l_dl_localrepproc_struct_ia);
		return(APL_SUCCESS);
	}

	RETURN_FAILURE :
	{
		CO_ProcMonitor(   p_logfile, "Exiting CBLROpBkFn processtion with Failure\n", NULL, NULL);
		APL_IF_DEBUG
		{
			fprintf(APL_OUT_FILE,"Exiting CBLROpBkFn with errors\n");
		}
		APL_FREE(l_dl_loc_repproc_struct_h);
		APL_FREE(l_dl_localrepproc_struct_ia);
		return(APL_FAILURE);
	}
}




int CBLRCusOpBkFn(short *p_status_ind,
						char *p_procdate,
						FILE *p_oprec_filehandle, 
						FILE *p_logfile,
						INTL_ENV_DATA_STRUCT_H *p_intl_envdatastruct_h,
						DEBUG_INFO_STRUCT_H **l_debug_info_ptr)
{

	short i = 0;
	short p_eocursor = 0;
	short l_lineCount = 60;
	short p_pgno  = 0;
	char int_l_type = 'C';
	char chr_l_acctype = 'C';
	char chr_l_ctacc[4] = APL_NULL_STRING;
	char chr_l_client_a[20] = APL_NULL_STRING; 
	
	DL_LOCALREPPROC_STRUCT_H *l_dl_loc_repproc_struct_h = NULL;
	DL_LOCALREPPROC_STRUCT_I *l_dl_localrepproc_struct_ia = NULL;
	DL_LOCALREPSPEC_STRUCT_H *l_dl_localrepspec_struct_ha = NULL;
	DL_LOCALREPSPEC_STRUCT_I *l_dl_localrepspec_struct_ia = NULL;
	char chr_l_wording[66] = APL_NULL_STRING;
	char chr_l_oll_dclient[APL_CLIENT_LENGTH] = APL_NULL_STRING;
	char chr_l_oldinstrcode[APL_INSTRUMENTCODE_LEN] = APL_NULL_STRING;
	char chr_l_oldctacc[4] = APL_NULL_STRING;
	double l_totquantity = 0;
	double l_totquantity_a = 0;
	double l_openbalance = 0;

	APL_IF_DEBUG
	{
		fprintf(APL_OUT_FILE,"Entered CBLRCusOpBkFn \n");
	}
	CO_ProcMonitor(   p_logfile, "Entered processtion CBLRCusOpBkFn\n", NULL, NULL);

	l_dl_loc_repproc_struct_h = (DL_LOCALREPPROC_STRUCT_H *)malloc(sizeof(DL_LOCALREPPROC_STRUCT_H));
	l_dl_localrepproc_struct_ia = (DL_LOCALREPPROC_STRUCT_I *)malloc(sizeof(DL_LOCALREPPROC_STRUCT_I));
	l_dl_localrepspec_struct_ha = (DL_LOCALREPSPEC_STRUCT_H *)malloc(sizeof(DL_LOCALREPSPEC_STRUCT_H)); 
	l_dl_localrepspec_struct_ia = (DL_LOCALREPSPEC_STRUCT_I *)malloc(sizeof(DL_LOCALREPSPEC_STRUCT_I)); 

	APL_MALLOC_FAIL(l_dl_loc_repproc_struct_h); 
	APL_MALLOC_FAIL(l_dl_localrepproc_struct_ia); 
	APL_MALLOC_FAIL(l_dl_localrepspec_struct_ha); 
	APL_MALLOC_FAIL(l_dl_localrepspec_struct_ia); 

   EXEC SQL BEGIN DECLARE SECTION;
   EXEC SQL VAR l_dl_loc_repproc_struct_h->h_dl_client IS STRING;
   EXEC SQL VAR l_dl_loc_repproc_struct_h->h_indentity_no IS STRING;
   EXEC SQL VAR l_dl_loc_repproc_struct_h->h_instr_code IS STRING;
   EXEC SQL VAR l_dl_loc_repproc_struct_h->h_ctclt IS STRING;
   EXEC SQL VAR l_dl_loc_repproc_struct_h->h_dbclt IS STRING;
   EXEC SQL VAR l_dl_loc_repproc_struct_h->h_domcpclt_cd IS STRING;
   EXEC SQL VAR l_dl_loc_repproc_struct_h->h_ord_ind IS STRING;
   EXEC SQL VAR l_dl_loc_repproc_struct_h->h_lrdltype IS STRING;
   EXEC SQL VAR l_dl_loc_repproc_struct_h->h_dealcd IS STRING;
   EXEC SQL VAR l_dl_loc_repproc_struct_h->h_reset_ind IS STRING;

   EXEC SQL VAR l_dl_localrepspec_struct_ha->h_dealclass IS STRING;
   EXEC SQL VAR l_dl_localrepspec_struct_ha->h_dealcd IS STRING;
   EXEC SQL VAR l_dl_localrepspec_struct_ha->h_status_active IS STRING;
   EXEC SQL VAR l_dl_localrepspec_struct_ha->h_dtname IS STRING;
   EXEC SQL VAR l_dl_localrepspec_struct_ha->h_indname IS STRING;
   EXEC SQL VAR l_dl_localrepspec_struct_ha->h_debit_flag IS STRING;
   EXEC SQL VAR l_dl_localrepspec_struct_ha->h_debit_ind_100 IS STRING;
   EXEC SQL VAR l_dl_localrepspec_struct_ha->h_credit_flag IS STRING;
   EXEC SQL VAR l_dl_localrepspec_struct_ha->h_credit_ind_100 IS STRING;
   EXEC SQL VAR l_dl_localrepspec_struct_ha->h_desc IS STRING;
   EXEC SQL VAR l_dl_localrepspec_struct_ha->h_info IS STRING;
   EXEC SQL VAR l_dl_localrepspec_struct_ha->h_iv_cond IS STRING;
   EXEC SQL VAR l_dl_localrepspec_struct_ha->h_local_iv_cond IS STRING;
   EXEC SQL VAR l_dl_localrepspec_struct_ha->h_desc_a IS STRING;
   EXEC SQL VAR l_dl_localrepspec_struct_ha->h_desc_b IS STRING;
   EXEC SQL END DECLARE SECTION;


	if (APL_FAILURE == CR_Rtv_LRCustEntCursor(l_debug_info_ptr))
	{
		APL_GOBACK_FAIL
	}

	l_totquantity_a = 0;

	if (APL_FAILURE == CR_Rtv_LRAccCursor(&p_eocursor, &l_openbalance, l_dl_loc_repproc_struct_h, l_dl_localrepproc_struct_ia,l_debug_info_ptr))
	{
		APL_GOBACK_FAIL
	}

	while (p_eocursor == 0)
	{
		l_totquantity = 0;

		strcpy(chr_l_oll_dclient,l_dl_loc_repproc_struct_h->h_dl_client);
		strcpy(chr_l_oldinstrcode,l_dl_loc_repproc_struct_h->h_instr_code);
		strcpy(chr_l_oldctacc,l_dl_loc_repproc_struct_h->h_ctclt);

		if (p_eocursor == 0)
		{
			if ( l_lineCount > ERR_PAGELENGTH)
			{
				l_lineCount = 11;
				p_pgno++;
            if ( p_pgno > 1 )
            {
               fprintf(p_oprec_filehandle,"\f");
            }

				if (APL_FAILURE == CBLRCusOpHdrPrnFn(int_l_type,
																l_dl_loc_repproc_struct_h->h_ctclt,
																p_procdate,
																l_dl_loc_repproc_struct_h->h_dl_client,
																l_dl_loc_repproc_struct_h->h_instr_code,
																p_pgno,
																p_oprec_filehandle,
																p_logfile,
																l_debug_info_ptr))
				{
					APL_GOBACK_FAIL
				}
			}

			fprintf(p_oprec_filehandle,"%-100s%26.lf\n","Saldo Otwarcia",l_openbalance);
			l_totquantity = l_openbalance;

			if (l_dl_loc_repproc_struct_h->h_dtfld == 0)
			{
				strcpy(chr_l_oldctacc,l_dl_loc_repproc_struct_h->h_ctclt);
				while (!strcmp(l_dl_loc_repproc_struct_h->h_ctclt,chr_l_oldctacc) && 
					(l_dl_loc_repproc_struct_h->h_dtfld == 0) &&
					 p_eocursor == 0 ) 
				{
					l_totquantity_a += l_dl_loc_repproc_struct_h->h_qty;
					if (APL_FAILURE == CR_Rtv_LRAccCursor(&p_eocursor, &l_openbalance, l_dl_loc_repproc_struct_h, l_dl_localrepproc_struct_ia,l_debug_info_ptr))
					{
						APL_GOBACK_FAIL
					}
					continue;
				}

				for (i = 1; i < 135; i++)
				{
					fprintf(p_oprec_filehandle,"%s","-");
				}
				fprintf(p_oprec_filehandle,"\n");
				i = 0;

				fprintf(p_oprec_filehandle,"%-100s%26.lf\n","Saldo Zamkniecia",l_totquantity_a);
				l_totquantity_a = 0;
				continue;
			}
		
			while ((p_eocursor == 0) && !strcmp(chr_l_oll_dclient,l_dl_loc_repproc_struct_h->h_dl_client) &&
												!strcmp(chr_l_oldinstrcode,l_dl_loc_repproc_struct_h->h_instr_code) &&
												!strcmp(chr_l_oldctacc,l_dl_loc_repproc_struct_h->h_ctclt))
			{
				strcpy(chr_l_client_a,l_dl_loc_repproc_struct_h->h_dbclt);
				if (APL_FAILURE == CR_Rtv_LROneSpecCursor(l_dl_loc_repproc_struct_h->h_lrdltype,
													  l_dl_loc_repproc_struct_h->h_dealcd,
													  l_dl_loc_repproc_struct_h->h_dtfld,
													  l_dl_localrepspec_struct_ha,
													  l_dl_localrepspec_struct_ia,
													  l_debug_info_ptr))
				{
					APL_GOBACK_FAIL
				}

				if (l_dl_loc_repproc_struct_h->h_r_code == 0)
				{
					chr_l_acctype = 'C';
					if (APL_FAILURE == CR_Rtv_LROppCust(chr_l_acctype,
															 l_dl_loc_repproc_struct_h->h_dl_client,
															 l_dl_loc_repproc_struct_h->h_domcpclt_cd,
															 l_dl_localrepspec_struct_ha,
															 l_dl_localrepspec_struct_ia,
															 l_dl_loc_repproc_struct_h,
															 l_dl_localrepproc_struct_ia,
															 chr_l_client_a,
															 l_debug_info_ptr))
					{
						APL_GOBACK_FAIL
					}
				}
				else		
				{
					chr_l_acctype = 'D';
					if (APL_FAILURE == CR_Rtv_LROppCust(chr_l_acctype,
															 l_dl_loc_repproc_struct_h->h_dl_client,
															 l_dl_loc_repproc_struct_h->h_domcpclt_cd,
															 l_dl_localrepspec_struct_ha,
															 l_dl_localrepspec_struct_ia,
															 l_dl_loc_repproc_struct_h,
															 l_dl_localrepproc_struct_ia,
															 chr_l_client_a,
															 l_debug_info_ptr))
					{
						APL_GOBACK_FAIL
					}
				}
	
				if ((l_dl_loc_repproc_struct_h->h_qty != 0 ) && (l_dl_loc_repproc_struct_h->h_dtfld != 0))
				{
					if (!strcmp(l_dl_loc_repproc_struct_h->h_reset_ind,"Y"))
					{
						strcpy(chr_l_wording,"KOREKTA WNKS");
					}
					else
					{
						if (APL_FAILURE == CR_Rtv_LRErrWord(l_dl_loc_repproc_struct_h,chr_l_wording,APL_NULL_STRING,APL_NULL_STRING,l_debug_info_ptr))
						{
							APL_GOBACK_FAIL
						}
					}

					if (!strncmp(chr_l_client_a,"   ", 3))
					{
						strcpy(chr_l_client_a,BLANKS_8);
					}
			
					if ( strlen(chr_l_wording) > 0 )
					{
						if ( APL_FAILURE == CO_PadString(chr_l_wording,'R' , 65," ",l_debug_info_ptr))
            		{
              			CO_ProcMonitor(p_logfile,"CBPad_StrFn returned failure\n",NULL,NULL);
              			APL_GOBACK_FAIL
            		}
					}
					else
					{
						i = 0;
						for (i = 1; i < 66; i++)
						{
							chr_l_wording[i] = ' ';
						}
						chr_l_wording[66] = APL_NULL_CHAR;
					}

					if ( strlen(chr_l_client_a) > 0 )
					{
						if ( APL_FAILURE == CO_PadString(chr_l_client_a,'R' , 19," ",l_debug_info_ptr))
            		{
              			CO_ProcMonitor(p_logfile,"CBPad_StrFn returned failure\n",NULL,NULL);
              			APL_GOBACK_FAIL
            		}
					}
					else
					{
						i = 0;
						for (i = 1; i < 20; i++)
						{
							chr_l_wording[i] = ' ';
						}
						chr_l_wording[20] = APL_NULL_CHAR;
					}

					fprintf(p_oprec_filehandle,"%s%s%s",chr_l_wording," ",chr_l_client_a);

					if (l_dl_loc_repproc_struct_h->h_r_code == 1)
					{
						 

						  if ( strcmp(l_dl_loc_repproc_struct_h->h_lrdltype,"18")==0 ||
						  strcmp(l_dl_loc_repproc_struct_h->h_lrdltype, "04") == 0 )  
						{
							fprintf(p_oprec_filehandle,"%26.lf",l_dl_loc_repproc_struct_h->h_qty * -1);
							l_totquantity -= l_dl_loc_repproc_struct_h->h_qty;
						}
						else
						{
							fprintf(p_oprec_filehandle,"%26.lf",l_dl_loc_repproc_struct_h->h_qty);
							l_totquantity += l_dl_loc_repproc_struct_h->h_qty;
						}
					}
					else
					{
						

						if ( strcmp(l_dl_loc_repproc_struct_h->h_lrdltype,"18")==0 ||
						  strcmp(l_dl_loc_repproc_struct_h->h_lrdltype, "04") == 0 )  
						{
							fprintf(p_oprec_filehandle,"%26.lf",l_dl_loc_repproc_struct_h->h_qty );
							l_totquantity += l_dl_loc_repproc_struct_h->h_qty;
						}
						else
						{
							fprintf(p_oprec_filehandle,"%26.lf",l_dl_loc_repproc_struct_h->h_qty * (-1));
							l_totquantity -= l_dl_loc_repproc_struct_h->h_qty;
						}
					}
					fprintf(p_oprec_filehandle,"\n");
					l_lineCount++;
				}
				if (APL_FAILURE == CR_Rtv_LRAccCursor(&p_eocursor, &l_openbalance, l_dl_loc_repproc_struct_h, l_dl_localrepproc_struct_ia,l_debug_info_ptr))
				{
					APL_GOBACK_FAIL
				}

			}
		}	
		i = 0;
		for (i = 1; i < 135; i++)
		{
			fprintf(p_oprec_filehandle,"%s","-");
		}
		fprintf(p_oprec_filehandle,"\n");
		i = 0;
		fprintf(p_oprec_filehandle,"%-100s","Saldo Zamkniecia");
		fprintf(p_oprec_filehandle,"%26.lf\n",l_totquantity);  
		l_lineCount = ERR_PAGELENGTH + 1;

	}

	APL_GOBACK_SUCCESS
	
  	RETURN_SUCCESS :
	{
		CO_ProcMonitor(   p_logfile, "Exiting CBLRCusOpBkFn processtion successfully\n", NULL, NULL);
		APL_IF_DEBUG
		{
			fprintf(APL_OUT_FILE,"Exiting CBLRCusOpBkFn successfully\n");
		}
		APL_FREE(l_dl_loc_repproc_struct_h); 
		APL_FREE(l_dl_localrepproc_struct_ia); 
		APL_FREE(l_dl_localrepspec_struct_ha); 
		APL_FREE(l_dl_localrepspec_struct_ia); 
		return(APL_SUCCESS);
	}

	RETURN_FAILURE :
	{
		CO_ProcMonitor(   p_logfile, "Exiting CBLRCusOpBkFn processtion with Failure\n", NULL, NULL);
		APL_IF_DEBUG
		{
			fprintf(APL_OUT_FILE,"Exiting CBLRCusOpBkFn with errors\n");
		}
		APL_FREE(l_dl_loc_repproc_struct_h); 
		APL_FREE(l_dl_localrepproc_struct_ia); 
		APL_FREE(l_dl_localrepspec_struct_ha); 
		APL_FREE(l_dl_localrepspec_struct_ia); 
		return(APL_FAILURE);
	}
}




int CBLRMainOpBkFn(short *p_status_ind,
							char *p_procdate,
							FILE *p_oprec_filehandle, 
							FILE *p_logfile,
							INTL_ENV_DATA_STRUCT_H *p_intl_envdatastruct_h,
							DEBUG_INFO_STRUCT_H **l_debug_info_ptr)
{

	short i = 0;
	short p_eocursor = 0;
	short l_lineCount = 60;
	short p_pgno  = 0;
	char int_l_type = 'M';
	char chr_l_acctype = 'C';
	char chr_l_ctacc[4] = APL_NULL_STRING;
	char chr_l_client_a[20] = APL_NULL_STRING;
	
	DL_LOCALREPPROC_STRUCT_H *l_dl_loc_repproc_struct_h = NULL;
	DL_LOCALREPPROC_STRUCT_I *l_dl_localrepproc_struct_ia = NULL;
	DL_LOCALREPSPEC_STRUCT_H *l_dl_localrepspec_struct_ha = NULL;
	DL_LOCALREPSPEC_STRUCT_I *l_dl_localrepspec_struct_ia = NULL;
	char chr_l_wording[66] = APL_NULL_STRING;
	char chr_l_oll_dclient[APL_CLIENT_LENGTH] = APL_NULL_STRING;
	char chr_l_oldinstrcode[APL_INSTRUMENTCODE_LEN] = APL_NULL_STRING;
	char chr_l_oldctacc[4] = APL_NULL_STRING;
	double l_totquantity = 0;
	double l_totquantity_a = 0;
	double l_openbalance = 0;

	EXEC SQL BEGIN DECLARE SECTION;
	EXEC SQL VAR l_dl_loc_repproc_struct_h->h_dl_client IS STRING;
	EXEC SQL VAR l_dl_loc_repproc_struct_h->h_indentity_no IS STRING;
	EXEC SQL VAR l_dl_loc_repproc_struct_h->h_instr_code IS STRING;
	EXEC SQL VAR l_dl_loc_repproc_struct_h->h_ctclt IS STRING;
	EXEC SQL VAR l_dl_loc_repproc_struct_h->h_dbclt IS STRING;
	EXEC SQL VAR l_dl_loc_repproc_struct_h->h_domcpclt_cd IS STRING;
	EXEC SQL VAR l_dl_loc_repproc_struct_h->h_ord_ind IS STRING;
	EXEC SQL VAR l_dl_loc_repproc_struct_h->h_lrdltype IS STRING;
	EXEC SQL VAR l_dl_loc_repproc_struct_h->h_dealcd IS STRING;
	EXEC SQL VAR l_dl_loc_repproc_struct_h->h_reset_ind IS STRING;

	EXEC SQL VAR l_dl_localrepspec_struct_ha->h_dealclass IS STRING;
	EXEC SQL VAR l_dl_localrepspec_struct_ha->h_dealcd IS STRING;
	EXEC SQL VAR l_dl_localrepspec_struct_ha->h_status_active IS STRING;
	EXEC SQL VAR l_dl_localrepspec_struct_ha->h_dtname IS STRING;
	EXEC SQL VAR l_dl_localrepspec_struct_ha->h_indname IS STRING;
	EXEC SQL VAR l_dl_localrepspec_struct_ha->h_debit_flag IS STRING;
	EXEC SQL VAR l_dl_localrepspec_struct_ha->h_debit_ind_100 IS STRING;
	EXEC SQL VAR l_dl_localrepspec_struct_ha->h_credit_flag IS STRING;
	EXEC SQL VAR l_dl_localrepspec_struct_ha->h_credit_ind_100 IS STRING;
	EXEC SQL VAR l_dl_localrepspec_struct_ha->h_desc IS STRING;
	EXEC SQL VAR l_dl_localrepspec_struct_ha->h_info IS STRING;
	EXEC SQL VAR l_dl_localrepspec_struct_ha->h_iv_cond IS STRING;
	EXEC SQL VAR l_dl_localrepspec_struct_ha->h_local_iv_cond IS STRING;
	EXEC SQL VAR l_dl_localrepspec_struct_ha->h_desc_a IS STRING;
	EXEC SQL VAR l_dl_localrepspec_struct_ha->h_desc_b IS STRING;
	EXEC SQL END DECLARE SECTION;

	APL_IF_DEBUG
	{
		fprintf(APL_OUT_FILE,"Entered CBLRMainOpBkFn \n");
	}

	CO_ProcMonitor(   p_logfile, "Entered processtion CBLRMainOpBkFn\n", NULL, NULL);

	l_dl_loc_repproc_struct_h = (DL_LOCALREPPROC_STRUCT_H *)malloc(sizeof(DL_LOCALREPPROC_STRUCT_H));
	l_dl_localrepproc_struct_ia = (DL_LOCALREPPROC_STRUCT_I *)malloc(sizeof(DL_LOCALREPPROC_STRUCT_I));
	l_dl_localrepspec_struct_ha = (DL_LOCALREPSPEC_STRUCT_H *)malloc(sizeof(DL_LOCALREPSPEC_STRUCT_H)); 
	l_dl_localrepspec_struct_ia = (DL_LOCALREPSPEC_STRUCT_I *)malloc(sizeof(DL_LOCALREPSPEC_STRUCT_I)); 

	APL_MALLOC_FAIL(l_dl_loc_repproc_struct_h); 
	APL_MALLOC_FAIL(l_dl_localrepproc_struct_ia); 
	APL_MALLOC_FAIL(l_dl_localrepspec_struct_ha); 
	APL_MALLOC_FAIL(l_dl_localrepspec_struct_ia); 

	if (APL_FAILURE == CR_Def_LRCursor(l_debug_info_ptr))
	{
		APL_GOBACK_FAIL
	}


	if (APL_FAILURE == CR_Rtv_LRCursor(&p_eocursor, &l_openbalance, l_dl_loc_repproc_struct_h, l_dl_localrepproc_struct_ia,l_debug_info_ptr))
	{
		APL_GOBACK_FAIL
	}

	while (p_eocursor == 0)
	{	
		l_totquantity = 0;

		strcpy(chr_l_oldinstrcode,l_dl_loc_repproc_struct_h->h_instr_code);
		strcpy(chr_l_oldctacc,l_dl_loc_repproc_struct_h->h_ctclt);

		if (p_eocursor == 0)
		{
			if ( l_lineCount > ERR_PAGELENGTH)
			{
				l_lineCount = 11;
				p_pgno++;
            if ( p_pgno > 1 )
            {
               fprintf(p_oprec_filehandle,"\f");
            }

				if (APL_FAILURE == CBLRCusOpHdrPrnFn(int_l_type,
																l_dl_loc_repproc_struct_h->h_ctclt,
																p_procdate,
																l_dl_loc_repproc_struct_h->h_dl_client,
																l_dl_loc_repproc_struct_h->h_instr_code,
																p_pgno,
																p_oprec_filehandle,
																p_logfile,
																l_debug_info_ptr))
				{
					APL_GOBACK_FAIL
				}
			}

			
		
			EXEC SQL SELECT SUM(NVL(OPENBALANCE,0))
						INTO :l_totquantity
						FROM	DL_LOCALREPSAFEK
						WHERE	INSTR_CODE = :l_dl_loc_repproc_struct_h->h_instr_code
						AND	CREDIT_CLT	 =	:l_dl_loc_repproc_struct_h->h_ctclt;

			if ( sqlca.sqlcode != -1405 )
			{
				IS_ANY_ORA_ERROR;
			}

			fprintf(p_oprec_filehandle,"%-100s%26.lf\n","Saldo Otwarcia",l_totquantity);
			

			if (l_dl_loc_repproc_struct_h->h_dtfld == 0)
			{
				strcpy(chr_l_oldctacc,l_dl_loc_repproc_struct_h->h_ctclt);
				while (!strcmp(l_dl_loc_repproc_struct_h->h_ctclt,chr_l_oldctacc ) &&
						(l_dl_loc_repproc_struct_h->h_dtfld == 0) &&
						(p_eocursor == 0) )
				{
					l_totquantity_a += l_dl_loc_repproc_struct_h->h_qty;
					if (APL_FAILURE == CR_Rtv_LRCursor(&p_eocursor, &l_openbalance, l_dl_loc_repproc_struct_h, l_dl_localrepproc_struct_ia,l_debug_info_ptr))
					{
						APL_GOBACK_FAIL
					}
					continue;
				}

				for (i = 1; i < 135; i++)
				{
					fprintf(p_oprec_filehandle,"%s","-");
				}
				fprintf(p_oprec_filehandle,"\n");
				i = 0;

				fprintf(p_oprec_filehandle,"%-100s%26.lf\n","Saldo Zamkniecia",l_totquantity_a);
				l_totquantity_a=0;
				continue;
			}
		
			while ((p_eocursor == 0) && !strcmp(chr_l_oldinstrcode,l_dl_loc_repproc_struct_h->h_instr_code) &&
												!strcmp(chr_l_oldctacc,l_dl_loc_repproc_struct_h->h_ctclt))
			{
				strcpy(chr_l_client_a,l_dl_loc_repproc_struct_h->h_dbclt);
				if (APL_FAILURE == CR_Rtv_LROneSpecCursor(l_dl_loc_repproc_struct_h->h_lrdltype,
													  l_dl_loc_repproc_struct_h->h_dealcd,
													  l_dl_loc_repproc_struct_h->h_dtfld,
													  l_dl_localrepspec_struct_ha,
													  l_dl_localrepspec_struct_ia,
													  l_debug_info_ptr))
				{
					APL_GOBACK_FAIL
				}

				if (l_dl_loc_repproc_struct_h->h_r_code == 1)
				{
					chr_l_acctype = 'D';
					if (APL_FAILURE == CR_Rtv_LROppCust(chr_l_acctype,
															 l_dl_loc_repproc_struct_h->h_dl_client,
															 l_dl_loc_repproc_struct_h->h_domcpclt_cd,
															 l_dl_localrepspec_struct_ha,
															 l_dl_localrepspec_struct_ia,
															 l_dl_loc_repproc_struct_h,
															 l_dl_localrepproc_struct_ia,
															 chr_l_client_a,
															 l_debug_info_ptr))
					{
						APL_GOBACK_FAIL
					}
				}
				else		
				{
					chr_l_acctype = 'E';
					
					if (APL_FAILURE == CR_Rtv_LROppCust(chr_l_acctype,
															 l_dl_loc_repproc_struct_h->h_dl_client,
															 l_dl_loc_repproc_struct_h->h_domcpclt_cd,
															 l_dl_localrepspec_struct_ha,
															 l_dl_localrepspec_struct_ia,
															 l_dl_loc_repproc_struct_h,
															 l_dl_localrepproc_struct_ia,
															 chr_l_client_a,
															 l_debug_info_ptr))
					{
						APL_GOBACK_FAIL
					}
				}
	
				if (l_dl_loc_repproc_struct_h->h_qty != 0 ) 
				{
					if (!strcmp(l_dl_loc_repproc_struct_h->h_reset_ind,"Y"))
					{
						strcpy(chr_l_wording,"KOREKTA WNKS");
					}
					else
					{
						if (APL_FAILURE == CR_Rtv_LRErrWord(l_dl_loc_repproc_struct_h,chr_l_wording,APL_NULL_STRING,APL_NULL_STRING,l_debug_info_ptr))
						{
							APL_GOBACK_FAIL
						}
					}
					
					if (!strncmp(chr_l_client_a,"   ",3))
					{
						strcpy(chr_l_client_a,BLANKS_8);
					}

               if ( strlen(chr_l_wording) > 0 )
               {
                  if ( APL_FAILURE == CO_PadString(chr_l_wording,'R' , 65," ",l_debug_info_ptr))
                  {
                     CO_ProcMonitor(p_logfile,"CBPad_StrFn returned failure\n",NULL,NULL);
                     APL_GOBACK_FAIL
                  }
               }
               else
               {
                  i = 0;
                  for (i = 1; i < 66; i++)
                  {
                     chr_l_wording[i] = ' ';
                  }
                  chr_l_wording[66] = APL_NULL_CHAR;
               }

               if ( strlen(chr_l_client_a) > 0 )
               {
                  if ( APL_FAILURE == CO_PadString(chr_l_client_a,'R' , 19," ",l_debug_info_ptr))
                  {
                     CO_ProcMonitor(p_logfile,"CBPad_StrFn returned failure\n",NULL,NULL);
                     APL_GOBACK_FAIL
                  }
               }
               else
               {
                  i = 0;
                  for (i = 1; i < 20; i++)
                  {
                     chr_l_wording[i] = ' ';
                  }
                  chr_l_wording[20] = APL_NULL_CHAR;
               }

					fprintf(p_oprec_filehandle,"%s%s%s",chr_l_wording," ",chr_l_client_a);

					

					if (l_dl_loc_repproc_struct_h->h_r_code == 1 ) 
					{
						fprintf(p_oprec_filehandle,"%26.lf",l_dl_loc_repproc_struct_h->h_qty);
						l_totquantity += l_dl_loc_repproc_struct_h->h_qty;
					}
					else
					{
						fprintf(p_oprec_filehandle,"%26.lf",l_dl_loc_repproc_struct_h->h_qty * (-1));
						l_totquantity -= l_dl_loc_repproc_struct_h->h_qty;
					}
					fprintf(p_oprec_filehandle,"\n");
					l_lineCount++;
				}
				if (APL_FAILURE == CR_Rtv_LRCursor(&p_eocursor, &l_openbalance, l_dl_loc_repproc_struct_h, l_dl_localrepproc_struct_ia,l_debug_info_ptr))
				{
					APL_GOBACK_FAIL
				}
			}
		}	
		i = 0;
		for (i = 1; i < 135; i++)
		{
			fprintf(p_oprec_filehandle,"%s","-");
		}
		fprintf(p_oprec_filehandle,"\n");
		i = 0;
		fprintf(p_oprec_filehandle,"%-100s","Saldo Zamkniecia");
		fprintf(p_oprec_filehandle,"%26.lf\n",l_totquantity); 
		l_lineCount = ERR_PAGELENGTH + 1;

	}

	APL_GOBACK_SUCCESS
	
  	RETURN_SUCCESS :
	{
		CO_ProcMonitor(   p_logfile, "Exiting CBLRMainOpBkFn processtion successfully\n", NULL, NULL);
		APL_IF_DEBUG
		{
			fprintf(APL_OUT_FILE,"Exiting CBLRMainOpBkFn successfully\n");
		}
		APL_FREE(l_dl_loc_repproc_struct_h); 
		APL_FREE(l_dl_localrepproc_struct_ia); 
		APL_FREE(l_dl_localrepspec_struct_ha); 
		APL_FREE(l_dl_localrepspec_struct_ia); 
		return(APL_SUCCESS);
	}

	RETURN_FAILURE :
	{
		CO_ProcMonitor(   p_logfile, "Exiting CBLRMainOpBkFn processtion with Failure\n", NULL, NULL);
		APL_IF_DEBUG
		{
			fprintf(APL_OUT_FILE,"Exiting CBLRMainOpBkFn with errors\n");
		}
		APL_FREE(l_dl_loc_repproc_struct_h); 
		APL_FREE(l_dl_localrepproc_struct_ia); 
		APL_FREE(l_dl_localrepspec_struct_ha); 
		APL_FREE(l_dl_localrepspec_struct_ia); 
		return(APL_FAILURE);
	}
}




int CBLRBalRepFn(char *p_procdate,
						FILE *p_oprec_filehandle ,
						FILE *p_logfile,
						INTL_ENV_DATA_STRUCT_H *p_intl_envdatastruct_h,
						DEBUG_INFO_STRUCT_H **l_debug_info_ptr)
{
   int Getisin(char *chr_l_instrcode_a,char *chr_l_isin,DEBUG_INFO_STRUCT_H **l_debug_info_ptr);
	struct sqlca sqlca;
	
	double i_10110sfk = 0.0;
	double i_09110sfk = 0.0;
	double i_00110sfk = 0.0,i_20110sfk = 0.0,i_00160sfk_NP =0.0, i_00110sfk_F5 =0.0;
	double i_10210sfk = 0.0;
	double i_09210sfk = 0.0;
	double i_00210sfk = 0.0,i_20210sfk = 0.0,i_00210sfk_NP= 0.0,i_00210sfk_F5=0.0;
	double i_10120sfk = 0.0;
	double i_09120sfk = 0.0;
	double i_00120sfk = 0.0,i_20120sfk = 0.0;
	double i_06110sfk = 0.0;
	double i_10221sfk = 0.0;
	double i_09221sfk = 0.0;
	double i_00221sfk = 0.0,i_20221sfk = 0.0;
	double i_10222sfk = 0.0;
	double i_09222sfk = 0.0;
	double i_00222sfk = 0.0,i_20222sfk = 0.0;
	double i_00311sfk = 0.0;
	double i_trd_00311sfk = 0.0;
	double i_20311sfk = 0.0; 
   double l_temp_cc3_del = 0.0;
   double l_temp_cc3_rcv = 0.0;
	double i_10224sfk = 0.0;
	double i_09224sfk = 0.0;
	double i_00224sfk = 0.0,i_20224sfk = 0.0;
	double i_06210sfk = 0.0;
	double i_06120sfk = 0.0;
	double i_06221sfk = 0.0;
	double i_06222sfk = 0.0;
	double i_06224sfk = 0.0;
	double i_9241000  = 0.0;
	double i_9241009  = 0.0;
	double i_9241006  = 0.0;

	double l_totdebit_ind 	 = 0.0; 
	double l_totcredit_ind 	 = 0.0; 
	double l_tot210	 = 0.0; 
	double l_tot210_NP = 0.0; 
	double l_tot210_F5 = 0.0; 
	double l_dom221quantity = 0.0; 
	double l_dom222quantity = 0.0; 
	double l_dom224quantity = 0.0; 
	
	
	 
	double l_temp_resi_311_quantity = 0.0;
	double l_temp_100000_qty	=	0.0;
	double l_temp_100001_qty	=	0.0;
	double l_temp_100002_qty	=	0.0;
	
	
	
	double l_temp_311_qty_ex_arena		=	0.0;
	double l_temp_100000_qty_exarena	=	0.0;
	double l_temp_100001_qty_exarena	=	0.0;
	double l_temp_100002_qty_exarena	=	0.0;
	 
	double l_temp_resi_quantity		=	0.0;
	double l_temp_resi_qty_ex_arena		=	0.0;
	double l_temp_resi_311_qty_ex_arena		=	0.0;
	double l_temp_non_resi_311_quantity = 0.0; 
	double l_temp_non_resi_qty_ex_arena		=	0.0;
	double l_temp_non_resi_quantity		=	0.0; 
	double l_temp_non_resi_311_qty_ex_arena		=	0.0;
	int int_flg_nonresi = 0;
	
	int int_l_count = 0;
	int int_l_pgno = 0;
	int i = 0; 
	int int_l_len = 0;
	char chr_l_instr_dtflg ;
	char chr_l_zero[26]	=APL_NULL_STRING ;
	char chr_l_str_totdb[26]	=APL_NULL_STRING ;
	char chr_l_str_totct[26]	=APL_NULL_STRING ;
	char chr_l_isin[13] = APL_NULL_STRING;
	
	char chr_l_client_a[APL_CLIENT_LENGTH]				= APL_NULL_STRING;
	char chr_l_temp_client[APL_CLIENT_LENGTH]		= APL_NULL_STRING; 
	char chr_l_ctcate[3]              				= APL_NULL_STRING;
	char chr_l_temp_ctacc[14]							= APL_NULL_STRING;
	char chr_l_temp_domcpac[11]         				= APL_NULL_STRING;
	char chr_l_new_ctacc[14]								= APL_NULL_STRING;
	char chr_l_instrcode_a[APL_INSTRUMENTCODE_LEN] 				= APL_NULL_STRING;
	char chr_l_clscode_a[5]									= APL_NULL_STRING;
	char int_l_domcpac[APL_CLIENT_LENGTH] 				= APL_NULL_STRING;
	char chr_h_system_date[APL_DATE_LEN]  			= APL_NULL_STRING;
	char chr_l_maxinstr_dt[APL_DATE_LEN]					= APL_NULL_STRING;
	char chr_l_new_maxinstr_dt[11]							= APL_NULL_STRING; 
	short i_maxinstr_dt									=	0;
	char chr_l_lrsettledt1[APL_DATE_LEN]				= APL_NULL_STRING;
	short i_lrsetldt1								=	0;
	char chr_l_lrsettledt2[APL_DATE_LEN]				= APL_NULL_STRING;
	short i_lrsetldt2								=	0;
	char chr_l_firstpg										= APL_NULL_CHAR;
	char chr_l_nodata										= APL_NULL_CHAR;
	char chr_l_str_qty[26]								= APL_NULL_STRING;
	char chr_l_regbrind_a[3]                        = APL_NULL_STRING;
	char   chr_l_temp_trcode[2]                   = APL_NULL_STRING; 
	short i_instrdate = 0;
	short i_regbrflag = 0;
	char chr_l_typeofacc[2]                       = APL_NULL_STRING;
	char chr_l_ourtheir[2]                        = APL_NULL_STRING;

	DL_SAFEK_STRUCT_H    l_dl_safek_struct_ha;
	DL_SAFEK_STRUCT_I	 l_dl_safek_struct_ia_a;

   OR_ORDERDETAILS_STRUCT_H	 l_or_orderdetails_struct_ha_a;
   OR_ORDERDETAILS_STRUCT_I	 l_or_orderdetails_struct_ib;

	SYS_DL_DEAL_STRUCT_H l_sys_dl_deal_struct_ha	;
	SYS_DL_DEAL_STRUCT_I l_sys_dl_deal_struct_ik	;

	DL_LOCALREPPROC3_STRUCT_H l_dl_localrepproc3_struct_h;
	DL_LOCALREPPROC3_STRUCT_I l_dl_localrepproc3_struct_i;
	sqlca.sqlcode=0;
	
	EXEC SQL BEGIN DECLARE SECTION;

	EXEC SQL VAR l_dl_safek_struct_ha.h_instr_code IS STRING;
	EXEC SQL VAR l_dl_safek_struct_ha.h_loccode IS STRING; 
	EXEC SQL VAR l_dl_safek_struct_ha.h_dl_client IS STRING;
	EXEC SQL VAR l_dl_safek_struct_ha.h_access_stamp IS STRING;
	EXEC SQL VAR l_dl_safek_struct_ha.h_pos_stat IS STRING;
	EXEC SQL VAR chr_l_instrcode_a IS STRING;
	EXEC SQL VAR chr_l_clscode_a IS STRING;
	EXEC SQL VAR chr_l_client_a IS STRING;
	EXEC SQL VAR chr_l_maxinstr_dt IS STRING;
	EXEC SQL VAR chr_l_isin IS STRING;
   EXEC SQL VAR chr_l_typeofacc IS STRING;
	EXEC SQL VAR chr_l_ourtheir IS STRING;

	EXEC SQL VAR l_or_orderdetails_struct_ha_a.h_dl_client IS STRING;
	EXEC SQL VAR l_or_orderdetails_struct_ha_a.h_orderindentity_no IS STRING;
	EXEC SQL VAR l_or_orderdetails_struct_ha_a.h_buy_sell_flag IS STRING;
	EXEC SQL VAR l_or_orderdetails_struct_ha_a.h_orderdate IS STRING;
	EXEC SQL VAR l_or_orderdetails_struct_ha_a.h_limit_ind IS STRING;
	EXEC SQL VAR l_or_orderdetails_struct_ha_a.h_isgte_ind IS STRING;
	EXEC SQL VAR l_or_orderdetails_struct_ha_a.h_all_none_ind IS STRING;
	EXEC SQL VAR l_or_orderdetails_struct_ha_a.h_ex_arena IS STRING;
	EXEC SQL VAR l_or_orderdetails_struct_ha_a.h_ord_stat IS STRING;
	EXEC SQL VAR l_or_orderdetails_struct_ha_a.h_instr_code IS STRING;
	EXEC SQL VAR l_or_orderdetails_struct_ha_a.h_maker IS STRING;
	EXEC SQL VAR l_or_orderdetails_struct_ha_a.h_maker_dt IS STRING;
	EXEC SQL VAR l_or_orderdetails_struct_ha_a.h_access_stamp IS STRING;
	EXEC SQL VAR l_or_orderdetails_struct_ha_a.h_checker IS STRING;
	EXEC SQL VAR l_or_orderdetails_struct_ha_a.h_checker_dt IS STRING;
	EXEC SQL VAR l_or_orderdetails_struct_ha_a.h_expirydate IS STRING;
	EXEC SQL VAR l_or_orderdetails_struct_ha_a.h_canceleddate IS STRING;
	EXEC SQL VAR l_or_orderdetails_struct_ha_a.h_candropdate IS STRING;
	EXEC SQL VAR l_or_orderdetails_struct_ha_a.h_broker_cd IS STRING;
	EXEC SQL VAR l_or_orderdetails_struct_ha_a.h_locindentity_no IS STRING;
	EXEC SQL VAR l_or_orderdetails_struct_ha_a.h_lrdltype IS STRING;
	EXEC SQL VAR l_or_orderdetails_struct_ha_a.h_lr_chkdate IS STRING;
	EXEC SQL VAR l_or_orderdetails_struct_ha_a.h_lr_ublckdate IS STRING;
	EXEC SQL VAR l_or_orderdetails_struct_ha_a.h_ublckdate IS STRING;
	EXEC SQL VAR l_or_orderdetails_struct_ha_a.h_lastexecdate IS STRING;
	EXEC SQL VAR l_or_orderdetails_struct_ha_a.h_lastdeal IS STRING;

  EXEC SQL VAR l_sys_dl_deal_struct_ha.h_dl_client         IS STRING;
  EXEC SQL VAR l_sys_dl_deal_struct_ha.h_indentity_no           IS STRING;
  EXEC SQL VAR l_sys_dl_deal_struct_ha.h_dlt            IS STRING;
  EXEC SQL VAR l_sys_dl_deal_struct_ha.h_setldt        IS STRING;
  EXEC SQL VAR l_sys_dl_deal_struct_ha.h_ex_arena         IS STRING;
  EXEC SQL VAR l_sys_dl_deal_struct_ha.h_instrdate           IS STRING;
  EXEC SQL VAR l_sys_dl_deal_struct_ha.h_moneydate         IS STRING;
  EXEC SQL VAR l_sys_dl_deal_struct_ha.h_domcpclt_cd         IS STRING;
  EXEC SQL VAR l_sys_dl_deal_struct_ha.h_isspotdl       IS STRING;
  EXEC SQL VAR l_sys_dl_deal_struct_ha.h_dlfromord      IS STRING;
  EXEC SQL VAR l_sys_dl_deal_struct_ha.h_entry       IS STRING;
  EXEC SQL VAR l_sys_dl_deal_struct_ha.h_reapired_ind       IS STRING;
  EXEC SQL VAR l_sys_dl_deal_struct_ha.h_domcp_custodyclt      IS STRING;
  EXEC SQL VAR l_sys_dl_deal_struct_ha.h_countclt        IS STRING;
  EXEC SQL VAR l_sys_dl_deal_struct_ha.h_countcltnm      IS STRING;
  EXEC SQL VAR l_sys_dl_deal_struct_ha.h_clientof       IS STRING;
  EXEC SQL VAR l_sys_dl_deal_struct_ha.h_custinfo        IS STRING;
  EXEC SQL VAR l_sys_dl_deal_struct_ha.h_fx_reqd          IS STRING;
  EXEC SQL VAR l_sys_dl_deal_struct_ha.h_ispymtlocal      IS STRING;
  EXEC SQL VAR l_sys_dl_deal_struct_ha.h_verfied_with         IS STRING;
  EXEC SQL VAR l_sys_dl_deal_struct_ha.h_brkrno        IS STRING;
  EXEC SQL VAR l_sys_dl_deal_struct_ha.h_fail_cd        IS STRING;
  EXEC SQL VAR l_sys_dl_deal_struct_ha.h_failinfo        IS STRING;
  EXEC SQL VAR l_sys_dl_deal_struct_ha.h_ispart_       IS STRING;
  EXEC SQL VAR l_sys_dl_deal_struct_ha.h_report_at_eom_ind        IS STRING;
  EXEC SQL VAR l_sys_dl_deal_struct_ha.h_billdate          IS STRING;
  EXEC SQL VAR l_sys_dl_deal_struct_ha.h_locindentity_no        IS STRING;
  EXEC SQL VAR l_sys_dl_deal_struct_ha.h_instruct_person       IS STRING;
  EXEC SQL VAR l_sys_dl_deal_struct_ha.h_dealcd          IS STRING;
  EXEC SQL VAR l_sys_dl_deal_struct_ha.h_instr_code          IS STRING;
  EXEC SQL VAR l_sys_dl_deal_struct_ha.h_currencycode         IS STRING;
  EXEC SQL VAR l_sys_dl_deal_struct_ha.h_classofdl       IS STRING;
  EXEC SQL VAR l_sys_dl_deal_struct_ha.h_origindentity_no       IS STRING;
  EXEC SQL VAR l_sys_dl_deal_struct_ha.h_newdt         IS STRING;
  EXEC SQL VAR l_sys_dl_deal_struct_ha.h_maker           IS STRING;
  EXEC SQL VAR l_sys_dl_deal_struct_ha.h_maker_dt         IS STRING;
  EXEC SQL VAR l_sys_dl_deal_struct_ha.h_deal_status    IS STRING;
  EXEC SQL VAR l_sys_dl_deal_struct_ha.h_access_stamp    IS STRING;
  EXEC SQL VAR l_sys_dl_deal_struct_ha.h_info1           IS STRING;
  EXEC SQL VAR l_sys_dl_deal_struct_ha.h_loccode        IS STRING;
  EXEC SQL VAR l_sys_dl_deal_struct_ha.h_reginstr_ind        IS STRING;
  EXEC SQL VAR l_sys_dl_deal_struct_ha.h_pos_stat     IS STRING;
  EXEC SQL VAR l_sys_dl_deal_struct_ha.h_status_reg       IS STRING;
  EXEC SQL VAR l_sys_dl_deal_struct_ha.h_confdate          IS STRING;
  EXEC SQL VAR l_sys_dl_deal_struct_ha.h_matchindentity_no      IS STRING;
  EXEC SQL VAR l_sys_dl_deal_struct_ha.h_markfaildate      IS STRING;
  EXEC SQL VAR l_sys_dl_deal_struct_ha.h_candropdate       IS STRING;
  EXEC SQL VAR l_sys_dl_deal_struct_ha.h_checker         IS STRING;
  EXEC SQL VAR l_sys_dl_deal_struct_ha.h_checker_dt       IS STRING;
  EXEC SQL VAR l_sys_dl_deal_struct_ha.h_instrconv_ind       IS STRING;
  EXEC SQL VAR l_sys_dl_deal_struct_ha.h_ndsbldate         IS STRING;
  EXEC SQL VAR l_sys_dl_deal_struct_ha.h_lrdltype       IS STRING;
  EXEC SQL VAR l_sys_dl_deal_struct_ha.h_ndsdate           IS STRING;
  EXEC SQL VAR l_sys_dl_deal_struct_ha.h_ublckdate         IS STRING;
  EXEC SQL VAR l_sys_dl_deal_struct_ha.h_delrecdate        IS STRING;
  EXEC SQL VAR l_sys_dl_deal_struct_ha.h_lastregdate       IS STRING;
  EXEC SQL VAR l_sys_dl_deal_struct_ha.h_lr_chkdate        IS STRING;
  EXEC SQL VAR l_sys_dl_deal_struct_ha.h_lr_confdate       IS STRING;
  EXEC SQL VAR l_sys_dl_deal_struct_ha.h_lr_instrdate        IS STRING;
  EXEC SQL VAR l_sys_dl_deal_struct_ha.h_tmpoutdate        IS STRING;
  EXEC SQL VAR l_sys_dl_deal_struct_ha.h_tmpretdate        IS STRING;
  EXEC SQL VAR l_sys_dl_deal_struct_ha.h_transmitdate      IS STRING;
  EXEC SQL VAR l_sys_dl_deal_struct_ha.h_hostdate          IS STRING;
  EXEC SQL VAR l_sys_dl_deal_struct_ha.h_lr_ndsbldate      IS STRING;
  EXEC SQL VAR l_sys_dl_deal_struct_ha.h_lr_ndsdate        IS STRING;
  EXEC SQL VAR l_sys_dl_deal_struct_ha.h_lr_ublckdate      IS STRING;
  EXEC SQL VAR l_sys_dl_deal_struct_ha.h_clt_reqdel_flag  IS STRING;
  EXEC SQL VAR l_sys_dl_deal_struct_ha.h_mod_hispos_ind    IS STRING;
  EXEC SQL VAR l_sys_dl_deal_struct_ha.h_updhispos_date    IS STRING;
   
  EXEC SQL VAR l_sys_dl_deal_struct_ha.h_instruct_personnm     IS STRING;
  EXEC SQL VAR l_sys_dl_deal_struct_ha.h_clientofcode   IS STRING;
   
	
	EXEC SQL VAR l_sys_dl_deal_struct_ha.h_misinfo         IS STRING;


  EXEC SQL VAR l_dl_localrepproc3_struct_h.h_instr_code  		 IS STRING;
  EXEC SQL VAR l_dl_localrepproc3_struct_h.h_ctclt         IS STRING;
  EXEC SQL VAR l_dl_localrepproc3_struct_h.h_domcpclt_cd    	 IS STRING;
  EXEC SQL VAR l_dl_localrepproc3_struct_h.h_instr_isin    		 IS STRING;
  EXEC SQL VAR chr_l_regbrind_a                        IS STRING;
	
  EXEC SQL END DECLARE SECTION;
	
	memset(&l_dl_safek_struct_ha,NULL,sizeof(DL_SAFEK_STRUCT_H) );
	memset(&l_dl_safek_struct_ia_a,NULL,sizeof(DL_SAFEK_STRUCT_I) );
	memset(&l_or_orderdetails_struct_ha_a,NULL,sizeof(OR_ORDERDETAILS_STRUCT_H) );
	memset(&l_or_orderdetails_struct_ib,NULL,sizeof(OR_ORDERDETAILS_STRUCT_I) );
	memset(&l_sys_dl_deal_struct_ha,NULL,sizeof(SYS_DL_DEAL_STRUCT_H) );
	memset(&l_sys_dl_deal_struct_ik,NULL,sizeof(SYS_DL_DEAL_STRUCT_I) );
	memset(&l_dl_localrepproc3_struct_h,NULL,sizeof(DL_LOCALREPPROC3_STRUCT_H) );
	memset(&l_dl_localrepproc3_struct_i,NULL,sizeof(DL_LOCALREPPROC3_STRUCT_I) );

	 APL_IF_DEBUG
   {
      fprintf(APL_OUT_FILE,"Entered CBLRBalRepFn\n");
   }
   CO_ProcMonitor(   p_logfile, "Entered processtion CBLRBalRepFn\n", NULL, NULL);	

	chr_l_nodata = 'N';
	EXEC SQL DECLARE safek_curs CURSOR FOR
				SELECT a.* FROM DL_SAFEK a, MT_INSTRUMENT b
				WHERE	a.INSTR_CODE = b.INSTR_CODE
				AND	b.CLASSCD = 'LCR'
				ORDER BY b.INSTR_ISIN; 
				

	EXEC SQL OPEN safek_curs;
	IS_ANY_ORA_ERROR

   EXEC SQL FETCH safek_curs 
            INTO :l_dl_safek_struct_ha:l_dl_safek_struct_ia_a; 
	IS_ANY_ORA_ERROR

	for(;;)
	{
		if ( (APL_ZERO_RESULT_SET) || chr_l_nodata == 'Y' )
		{
			break;
		}
      i_trd_00311sfk = 0.0;
		chr_l_nodata = 'N';
		strcpy(chr_l_instrcode_a,APL_NULL_STRING); 
		strcpy(chr_l_instrcode_a,l_dl_safek_struct_ha.h_instr_code);

		

		while ( (!strcmp(l_dl_safek_struct_ha.h_instr_code,chr_l_instrcode_a) ) )
		{
		    int_flg_nonresi = 0;
	  	    if (CheckNonResident(l_dl_safek_struct_ha.h_dl_client,
									    l_dl_safek_struct_ha.h_instr_code,
									    &int_flg_nonresi,
									    l_debug_info_ptr) == APL_FAILURE)
		      {
			     APL_GOBACK_FAIL
		      }
			
			strcpy(chr_l_client_a,l_dl_safek_struct_ha.h_dl_client);

			if (!strcmp(chr_l_client_a,"311"))
			{
				if(int_flg_nonresi == 0) 
				{
					i_00311sfk = i_00311sfk +l_dl_safek_struct_ha.h_safekeep_pos; 
               i_trd_00311sfk = i_trd_00311sfk +l_dl_safek_struct_ha.h_val_rec - l_dl_safek_struct_ha.h_val_del; 
				}
				else
				{
					i_20311sfk = i_20311sfk +l_dl_safek_struct_ha.h_safekeep_pos; 
				}
			}
			else if(!strcmp(chr_l_client_a,"100000"))
			{
				i_10110sfk = i_10110sfk + l_dl_safek_struct_ha.h_safekeep_pos + l_dl_safek_struct_ha.h_val_rec - l_dl_safek_struct_ha.h_val_del;
				i_10210sfk = i_10210sfk + l_dl_safek_struct_ha.h_safekeep_pos; 
			}
			else if(!strcmp(chr_l_client_a,"100001"))
			{
				i_10110sfk = i_10110sfk + l_dl_safek_struct_ha.h_safekeep_pos + l_dl_safek_struct_ha.h_val_rec - l_dl_safek_struct_ha.h_val_del;
				i_09210sfk = i_09210sfk + l_dl_safek_struct_ha.h_safekeep_pos;
			}
			else if(!strcmp(chr_l_client_a,"100002"))
         {
            i_06110sfk = i_06110sfk + l_dl_safek_struct_ha.h_safekeep_pos + l_dl_safek_struct_ha.h_val_rec - l_dl_safek_struct_ha.h_val_del;
            i_06210sfk = i_06210sfk + l_dl_safek_struct_ha.h_safekeep_pos;
         }
			else
			{
				if(int_flg_nonresi) 
				{
					i_20110sfk = i_20110sfk + l_dl_safek_struct_ha.h_safekeep_pos + l_dl_safek_struct_ha.h_val_rec - l_dl_safek_struct_ha.h_val_del;
            	i_20210sfk = i_20210sfk + l_dl_safek_struct_ha.h_safekeep_pos;
				}
				else
				{
					
               memset(chr_l_typeofacc, APL_NULL_CHAR, 2);
					memset(chr_l_ourtheir, APL_NULL_CHAR, 2);
					EXEC SQL SELECT NVL(CLN_CLASS,'1'), CLN_OUR_THEIR_IND
								  INTO :chr_l_typeofacc, :chr_l_ourtheir
								  FROM MT_CLIENT
                         WHERE cln_code = :l_dl_safek_struct_ha.h_dl_client;
               IS_ANY_ORA_ERROR

					if ((strcmp(chr_l_typeofacc,"N") == 0 ) && (strcmp(chr_l_ourtheir,"O") == 0 ) )
                 {
				      i_00160sfk_NP = i_00160sfk_NP + l_dl_safek_struct_ha.h_safekeep_pos + l_dl_safek_struct_ha.h_val_rec - l_dl_safek_struct_ha.h_val_del;
            	   i_00210sfk_NP = i_00210sfk_NP + l_dl_safek_struct_ha.h_safekeep_pos;
					  }	 
               else if ((strcmp(chr_l_typeofacc,"N")) && (strcmp(chr_l_ourtheir,"O") == 0 ) )
						{
					   i_00311sfk = i_00311sfk + l_dl_safek_struct_ha.h_safekeep_pos ;
                  i_trd_00311sfk = i_trd_00311sfk +l_dl_safek_struct_ha.h_val_rec - l_dl_safek_struct_ha.h_val_del; 
						}
					else
                 {
					   i_00110sfk_F5 = i_00110sfk_F5 + l_dl_safek_struct_ha.h_safekeep_pos + l_dl_safek_struct_ha.h_val_rec - l_dl_safek_struct_ha.h_val_del;
            	   i_00210sfk_F5 = i_00210sfk_F5 + l_dl_safek_struct_ha.h_safekeep_pos;
				     }
			   }
			}

     EXEC SQL  SELECT
                      NVL(sum(A.QTY),0)
                INTO  :l_temp_cc3_del
                FROM DL_DEAL A
      WHERE A.INSTR_CODE =:chr_l_instrcode_a
      AND   A.CLIENT =:chr_l_client_a
      AND   A.DEAL_CD IN ('1','3','5','7')
      AND   A.EX_ARENA ='3'
      AND   A.INSTRUMENT_DT IS NULL
      AND   A.DEAL_STAT='CC' ;

      IS_ANY_ORA_ERROR

     EXEC SQL  SELECT
                      NVL(sum(A.QTY),0)
                INTO  :l_temp_cc3_rcv
                FROM DL_DEAL A
      WHERE A.INSTR_CODE =:chr_l_instrcode_a
      AND   A.CLIENT =:chr_l_client_a
      AND   A.DEAL_CD IN ('2','4','6','8')
      AND   A.EX_ARENA ='3'
      AND   A.INSTRUMENT_DT IS NULL
      AND   A.DEAL_STAT='CC' ;

      IS_ANY_ORA_ERROR



      if((strcmp(chr_l_client_a ,"500616-032")==0) && (strcmp(chr_l_instrcode_a,"DS1110")==0))
      printf("I AM HERE ACCOUNT is %s, INSTR_CODE IS %s, del quantity is %lf, rcv quantity is %lf\n",chr_l_client_a,chr_l_instrcode_a,l_temp_cc3_del,l_temp_cc3_rcv);

         if(!strcmp(chr_l_client_a,"100000"))
         {
            i_10110sfk = i_10110sfk +l_temp_cc3_del - l_temp_cc3_rcv;
         }
         else if(!strcmp(chr_l_client_a,"100001"))
         {
            i_10110sfk = i_10110sfk +l_temp_cc3_del - l_temp_cc3_rcv;
         }
         else if(!strcmp(chr_l_client_a,"100002"))
         {
            i_06110sfk = i_06110sfk +l_temp_cc3_del - l_temp_cc3_rcv;
         }
         else
         {
            if(int_flg_nonresi) 
            {
               i_20110sfk = i_20110sfk +l_temp_cc3_del - l_temp_cc3_rcv;
            }
            else
            {
               if ((strcmp(chr_l_typeofacc,"N") == 0 ) && (strcmp(chr_l_ourtheir,"O") == 0 ) )
                 {
                  i_00160sfk_NP = i_00160sfk_NP +l_temp_cc3_del - l_temp_cc3_rcv;
                 }
               else
                 {
                  if ((strcmp(chr_l_typeofacc,"N") == 0 ) && (strcmp(chr_l_ourtheir,"O") == 0 ) )
                  i_00311sfk = i_00311sfk +l_temp_cc3_del - l_temp_cc3_rcv;
              else
                  {
                  if(strcmp(chr_l_instrcode_a,"DS1110")==0)
                  {
                  printf("I AM HERE %lf\n ",i_00110sfk_F5);
                  }
                  i_00110sfk_F5 = i_00110sfk_F5 +l_temp_cc3_del - l_temp_cc3_rcv;
                  if(strcmp(chr_l_instrcode_a,"DS1110")==0)
                  {
                  printf("I AM HERE %lf\n ",i_00110sfk_F5);
                  }
                  }
                 }
            }
         }

		   EXEC SQL FETCH safek_curs
					  INTO :l_dl_safek_struct_ha:l_dl_safek_struct_ia_a;
		   IS_ANY_ORA_ERROR

			if ( APL_ZERO_RESULT_SET )
			{
				chr_l_nodata = 'Y';
				break;
			}
			chr_l_nodata = 'N';
			continue;

		} 
	
      

		strcpy(chr_l_temp_client,APL_NULL_STRING);
		strcpy(chr_l_temp_trcode,APL_NULL_STRING);



	   EXEC SQL  SELECT 
							 NVL(SUM(DECODE(A.CLIENT,'311',A.QTY,0)),0),
							 NVL(SUM(DECODE(A.CLIENT,'100000',A.QTY,0)),0), 
							 NVL(SUM(DECODE(A.CLIENT,'100001',A.QTY,0)),0), 
							 NVL(SUM(DECODE(A.CLIENT,'100002',A.QTY,0)),0), 
	                   NVL(SUM(DECODE(A.CLIENT,'311',0,
                                      '100000',0,
                                      '100001',0,
                                      '100002',0,
                                      A.QTY)),0)
					 INTO   	
							 :l_temp_non_resi_311_quantity,
							 :l_temp_100000_qty,		
							 :l_temp_100001_qty,		
							 :l_temp_100002_qty,		
							  
							 :l_temp_non_resi_quantity	
					 FROM DL_DEAL A, MT_INSTRUMENT B, MT_CLIENT C
		WHERE A.INSTR_CODE =:chr_l_instrcode_a
		AND   A.DEAL_CD IN ('1','3','5','7')	
      AND   A.FAILREASON_CD='60'
		AND   A.EX_ARENA !='3'
      AND   A.INSTRUMENT_DT IS NULL
      AND   A.DEAL_STAT='CC' 		
		AND 	A.INSTR_CODE = B.INSTR_CODE
		AND 	A.CLIENT = C.CLN_CODE
		AND 	B.PROD_CLASS = '2'
		AND 	B.LOCATION_CD = 'NDS'
		AND 	C.COUNTRY NOT IN ('PO','PL');

		
      

      IS_ANY_ORA_ERROR;

		 
		i_20311sfk	=	i_20311sfk	-	l_temp_non_resi_311_quantity;
		i_10210sfk	=	i_10210sfk	-	l_temp_100000_qty;
		i_09210sfk	=	i_09210sfk	-	l_temp_100001_qty;
		i_06210sfk	=	i_06210sfk	-	l_temp_100002_qty;
		 
		i_20210sfk	=	i_20210sfk	-	l_temp_non_resi_quantity;

		fprintf(p_logfile,"\nFor Trcode 1 and 3\n");
		fprintf(p_logfile,"Instrode : %s\n",chr_l_instrcode_a);
		 
		//fprintf(p_logfile,"Non_Resi_qty : %d\n",l_temp_non_resi_quantity); Changes done for AIX Migration
		fprintf(p_logfile,"Non_Resi_qty : %lf\n",l_temp_non_resi_quantity); 

         
		 
		l_temp_non_resi_311_quantity = 0.0;
		l_temp_100000_qty	=	0.0;
		l_temp_100001_qty	=	0.0;
		l_temp_100002_qty	=	0.0;
		l_temp_non_resi_quantity		=	0.0;
		 

	   EXEC SQL  SELECT 
							 NVL(SUM(DECODE(A.CLIENT,'311',A.QTY,0)),0),
							 NVL(SUM(DECODE(A.CLIENT,'100000',A.QTY,0)),0), 
							 NVL(SUM(DECODE(A.CLIENT,'100001',A.QTY,0)),0), 
							 NVL(SUM(DECODE(A.CLIENT,'100002',A.QTY,0)),0), 
	                   NVL(SUM(DECODE(A.CLIENT,'311',0,
                                      '100000',0,
                                      '100001',0,
                                      '100002',0,
                                       A.QTY)),0)
					 INTO   	
							 :l_temp_non_resi_311_quantity,
							 :l_temp_100000_qty,		
							 :l_temp_100001_qty,		
							 :l_temp_100002_qty,		
							  	
							 :l_temp_non_resi_quantity	
					 FROM DL_DEAL A, MT_INSTRUMENT B, MT_CLIENT C
      WHERE A.INSTR_CODE =:chr_l_instrcode_a
		AND   A.DEAL_CD IN ('2','4','6','8')	
      AND   A.FAILREASON_CD='60'
		AND   A.EX_ARENA !='3'
      AND   A.INSTRUMENT_DT IS NULL
      AND   A.DEAL_STAT='CC' 		
		AND 	A.INSTR_CODE = B.INSTR_CODE
		AND 	A.CLIENT = C.CLN_CODE
		AND 	B.PROD_CLASS = '2'
		AND 	B.LOCATION_CD = 'NDS'
		AND 	C.COUNTRY NOT IN ('PO','PL');
		
      
				
		IS_ANY_ORA_ERROR;

				 
				i_20311sfk	=	i_20311sfk	+	l_temp_non_resi_311_quantity;
				i_10210sfk	=	i_10210sfk	+	l_temp_100000_qty;
				i_09210sfk	=	i_09210sfk	+	l_temp_100001_qty;
				i_06210sfk	=	i_06210sfk	+	l_temp_100002_qty;
				 
				i_20210sfk	=	i_20210sfk	+	l_temp_non_resi_quantity;

		fprintf(p_logfile,"\nFor Trcode 2 and 4\n");
		fprintf(p_logfile,"Instrode : %s\n",chr_l_instrcode_a);
		 
  //fprintf(p_logfile,"Non_Resi_qty : %d\n",l_temp_non_resi_quantity); Changes done for AIX Migration
  fprintf(p_logfile,"Non_Resi_qty : %lf\n",l_temp_non_resi_quantity);



	   EXEC SQL  SELECT 
							 NVL(SUM(DECODE(A.CLIENT,'311',A.QTY,0)),0),
							 NVL(SUM(DECODE(A.CLIENT,'100000',A.QTY,0)),0), 
							 NVL(SUM(DECODE(A.CLIENT,'100001',A.QTY,0)),0), 
							 NVL(SUM(DECODE(A.CLIENT,'100002',A.QTY,0)),0), 
	                   NVL(SUM(DECODE(A.CLIENT,'311',0,
                                      '100000',0,
                                      '100001',0,
                                      '100002',0,
                                      A.QTY)),0)
					 INTO   	
							 :l_temp_resi_311_quantity,
							 :l_temp_100000_qty,		
							 :l_temp_100001_qty,		
							 :l_temp_100002_qty,		
							  
							 :l_temp_resi_quantity	
					 FROM DL_DEAL A, MT_INSTRUMENT B, MT_CLIENT C
		WHERE A.INSTR_CODE =:chr_l_instrcode_a
		AND   A.DEAL_CD IN ('1','3','5','7')	
      AND   A.FAILREASON_CD='60'
      AND   A.INSTRUMENT_DT IS NULL
      AND   A.DEAL_STAT='CC' 		
		AND   A.EX_ARENA !='3'
		AND 	A.INSTR_CODE = B.INSTR_CODE
		AND 	A.CLIENT = C.CLN_CODE
		AND   C.CLN_CLASS = 'N'
		AND   C.CLN_OUR_THEIR_IND = 'O'
      AND   A.ROWID NOT IN (SELECT D.ROWID
                     FROM DL_DEAL D,MT_INSTRUMENT E,MT_CLIENT F
                     WHERE D.client = F.CLN_CODE
                     AND D.instr_code = E.instr_code
                     AND E.PROD_CLASS = '2'
                     AND E.location_cd = 'NDS'
                     AND F.COUNTRY NOT IN ('PO','PL') );

		
      

      IS_ANY_ORA_ERROR;

		 
		i_00311sfk	=	i_00311sfk	-	l_temp_resi_311_quantity;
		i_10210sfk	=	i_10210sfk	-	l_temp_100000_qty;
		i_09210sfk	=	i_09210sfk	-	l_temp_100001_qty;
		i_06210sfk	=	i_06210sfk	-	l_temp_100002_qty;
		 
		
		i_00210sfk_NP	=	i_00210sfk_NP	-	l_temp_resi_quantity;

		fprintf(p_logfile,"\nFor Trcode 1 and 3\n");
		fprintf(p_logfile,"Instrode : %s\n",chr_l_instrcode_a);
		 
  //fprintf(p_logfile,"Resi_qty : %d\n",l_temp_resi_quantity); Changes done for AIX Migration
  fprintf(p_logfile,"Resi_qty : %lf\n",l_temp_resi_quantity);
          
		l_temp_resi_311_quantity		=	0.0;
		l_temp_100000_qty	=	0.0;
		l_temp_100001_qty	=	0.0;
		l_temp_100002_qty	=	0.0;
		l_temp_resi_quantity		=	0.0;
	   EXEC SQL  SELECT 
							 NVL(SUM(DECODE(A.CLIENT,'311',A.QTY,0)),0),
							 NVL(SUM(DECODE(A.CLIENT,'100000',A.QTY,0)),0), 
							 NVL(SUM(DECODE(A.CLIENT,'100001',A.QTY,0)),0), 
							 NVL(SUM(DECODE(A.CLIENT,'100002',A.QTY,0)),0), 
	                   NVL(SUM(DECODE(A.CLIENT,'311',0,
                                      '100000',0,
                                      '100001',0,
                                      '100002',0,
                                      A.QTY)),0)
				   INTO	 :l_temp_resi_311_quantity,
							 :l_temp_100000_qty,		
							 :l_temp_100001_qty,		
							 :l_temp_100002_qty,		
							 :l_temp_resi_quantity	
					 FROM DL_DEAL A, MT_INSTRUMENT B, MT_CLIENT C
		WHERE A.INSTR_CODE =:chr_l_instrcode_a
		AND   A.DEAL_CD IN ('1','3','5','7')	
      AND   A.FAILREASON_CD='60'
		AND   A.EX_ARENA!='3'
      AND   A.INSTRUMENT_DT IS NULL
      AND   A.DEAL_STAT='CC' 		
		AND 	A.INSTR_CODE = B.INSTR_CODE
		AND 	A.CLIENT = C.CLN_CODE
		AND   ( C.CLN_CLASS != 'N' OR ( C.CLN_CLASS = 'N' AND C.CLN_OUR_THEIR_IND ='T'))
      AND   A.ROWID NOT IN (SELECT D.ROWID
                     FROM DL_DEAL D,MT_INSTRUMENT E,MT_CLIENT F
                     WHERE D.client = F.CLN_CODE
                     AND D.instr_code = E.instr_code
                     AND E.PROD_CLASS = '2'
                     AND E.location_cd = 'NDS'
                     AND F.COUNTRY NOT IN ('PO','PL') );

		
      

      IS_ANY_ORA_ERROR;

		 
		i_00311sfk	=	i_00311sfk	-	l_temp_resi_311_quantity;
		i_10210sfk	=	i_10210sfk	-	l_temp_100000_qty;
		i_09210sfk	=	i_09210sfk	-	l_temp_100001_qty;
		i_06210sfk	=	i_06210sfk	-	l_temp_100002_qty;
		 
		
		i_00210sfk_F5	=	i_00210sfk_F5	-	l_temp_resi_quantity;

		
		
		 
		l_temp_resi_311_quantity		=	0.0;
		l_temp_100000_qty	=	0.0;
		l_temp_100001_qty	=	0.0;
		l_temp_100002_qty	=	0.0;
		l_temp_resi_quantity		=	0.0;
		 

	   EXEC SQL  SELECT 
							 NVL(SUM(DECODE(A.CLIENT,'311',A.QTY,0)),0),
							 NVL(SUM(DECODE(A.CLIENT,'100000',A.QTY,0)),0), 
							 NVL(SUM(DECODE(A.CLIENT,'100001',A.QTY,0)),0), 
							 NVL(SUM(DECODE(A.CLIENT,'100002',A.QTY,0)),0), 
	                   NVL(SUM(DECODE(A.CLIENT,'311',0,
                                      '100000',0,
                                      '100001',0,
                                      '100002',0,
                                       QTY)),0)
					 INTO   	
							 :l_temp_resi_311_quantity,
							 :l_temp_100000_qty,		
							 :l_temp_100001_qty,		
							 :l_temp_100002_qty,		
							  	
							 :l_temp_resi_quantity	
					 FROM DL_DEAL A, MT_INSTRUMENT B, MT_CLIENT C
      WHERE A.INSTR_CODE =:chr_l_instrcode_a
		AND   A.DEAL_CD IN ('2','4','6','8')	
      AND   A.FAILREASON_CD='60'
		AND   A.EX_ARENA!='3'
      AND   A.INSTRUMENT_DT IS NULL
      AND   A.DEAL_STAT='CC' 		
		AND 	A.INSTR_CODE = B.INSTR_CODE
		AND 	A.CLIENT = C.CLN_CODE
		AND   C.CLN_CLASS = 'N'
		AND   C.CLN_OUR_THEIR_IND = 'O'
      AND   A.ROWID NOT IN (SELECT D.ROWID
                     FROM DL_DEAL D,MT_INSTRUMENT E,MT_CLIENT F
                     WHERE D.client = F.CLN_CODE
                     AND D.instr_code = E.instr_code
                     AND E.PROD_CLASS = '2'
                     AND E.location_cd = 'NDS'
                     AND F.COUNTRY NOT IN ('PO','PL') );
		
      
				
		IS_ANY_ORA_ERROR;

				 
				i_00311sfk	=	i_00311sfk	+	l_temp_resi_311_quantity;
				i_10210sfk	=	i_10210sfk	+	l_temp_100000_qty;
				i_09210sfk	=	i_09210sfk	+	l_temp_100001_qty;
				i_06210sfk	=	i_06210sfk	+	l_temp_100002_qty;
				 
				
				i_00210sfk_NP	=	i_00210sfk_NP	+	l_temp_resi_quantity;

		
		l_temp_resi_311_quantity		=	0.0;
		l_temp_100000_qty	=	0.0;
		l_temp_100001_qty	=	0.0;
		l_temp_100002_qty	=	0.0;
		l_temp_resi_quantity		=	0.0;

	   EXEC SQL  SELECT 
							 NVL(SUM(DECODE(A.CLIENT,'311',A.QTY,0)),0),
							 NVL(SUM(DECODE(A.CLIENT,'100000',A.QTY,0)),0), 
							 NVL(SUM(DECODE(A.CLIENT,'100001',A.QTY,0)),0), 
							 NVL(SUM(DECODE(A.CLIENT,'100002',A.QTY,0)),0), 
	                   NVL(SUM(DECODE(A.CLIENT,'311',0,
                                      '100000',0,
                                      '100001',0,
                                      '100002',0,
                                       QTY)),0)
					 INTO   	
							 :l_temp_resi_311_quantity,
							 :l_temp_100000_qty,		
							 :l_temp_100001_qty,		
							 :l_temp_100002_qty,		
							  	
							 :l_temp_resi_quantity	
					 FROM DL_DEAL A, MT_INSTRUMENT B, MT_CLIENT C
      WHERE A.INSTR_CODE =:chr_l_instrcode_a
		AND   A.DEAL_CD IN ('2','4','6','8')	
      AND   A.FAILREASON_CD='60'
		AND   A.EX_ARENA!='3'
      AND   A.INSTRUMENT_DT IS NULL
      AND   A.DEAL_STAT='CC' 		
		AND 	A.INSTR_CODE = B.INSTR_CODE
		AND 	A.CLIENT = C.CLN_CODE
		AND   ( C.CLN_CLASS != 'N' OR ( C.CLN_CLASS ='N' AND C.CLN_OUR_THEIR_IND='T'))
      AND   A.ROWID NOT IN (SELECT D.ROWID
                     FROM DL_DEAL D,MT_INSTRUMENT E,MT_CLIENT F
                     WHERE D.client = F.CLN_CODE
                     AND D.instr_code = E.instr_code
                     AND E.PROD_CLASS = '2'
                     AND E.location_cd = 'NDS'
                     AND F.COUNTRY NOT IN ('PO','PL') );
		
      
				
		IS_ANY_ORA_ERROR;

				i_00311sfk	=	i_00311sfk	+	l_temp_resi_311_quantity;
				i_10210sfk	=	i_10210sfk	+	l_temp_100000_qty;
				i_09210sfk	=	i_09210sfk	+	l_temp_100001_qty;
				i_06210sfk	=	i_06210sfk	+	l_temp_100002_qty;
				
				i_00210sfk_F5	=	i_00210sfk_F5	+	l_temp_resi_quantity;

		fprintf(p_logfile,"\nFor Trcode 2 and 4\n");
		fprintf(p_logfile,"Instrode : %s\n",chr_l_instrcode_a);
		 
  //fprintf(p_logfile,"Resi_qty : %d\n",l_temp_resi_quantity); Changes done for AIX Migration
  fprintf(p_logfile,"Resi_qty : %lf\n",l_temp_resi_quantity);


			
		
		
	   


		



	
		
		if( i_00160sfk_NP > 0 )
		{
		   if ( APL_FAILURE == Getisin(chr_l_instrcode_a,chr_l_isin,l_debug_info_ptr) )
			{
				APL_GOBACK_FAIL
			}
			EXEC SQL INSERT INTO DL_LOCALREPPROC3 (INSTR_CODE,CREDITCLIENT,QTY,INSTR_ISIN)
						VALUES ( :chr_l_instrcode_a, '00 160',:i_00160sfk_NP,:chr_l_isin);

			IS_ANY_ORA_ERROR
		}
		if( i_00110sfk_F5 > 0 )
		{
		   if ( APL_FAILURE == Getisin(chr_l_instrcode_a,chr_l_isin,l_debug_info_ptr) )
			{
				APL_GOBACK_FAIL
			}
			EXEC SQL INSERT INTO DL_LOCALREPPROC3 (INSTR_CODE,CREDITCLIENT,QTY,INSTR_ISIN)
						VALUES ( :chr_l_instrcode_a, '00 110',:i_00110sfk_F5,:chr_l_isin);

			IS_ANY_ORA_ERROR
		}
		
		if( i_20110sfk > 0 )
		{
		   if ( APL_FAILURE == Getisin(chr_l_instrcode_a,chr_l_isin,l_debug_info_ptr) )
			{
				APL_GOBACK_FAIL
			}
			EXEC SQL INSERT INTO DL_LOCALREPPROC3 (INSTR_CODE,CREDITCLIENT,QTY,INSTR_ISIN)
						VALUES ( :chr_l_instrcode_a, '20 110',:i_20110sfk,:chr_l_isin);

			IS_ANY_ORA_ERROR
		}
		
		if( i_00210sfk_NP > 0 )
		{
		   if ( APL_FAILURE == Getisin(chr_l_instrcode_a,chr_l_isin,l_debug_info_ptr) )
			{
				APL_GOBACK_FAIL
			}
         memset(chr_l_regbrind_a,APL_NULL_CHAR,3);
         EXEC SQL SELECT REG_BR_IND INTO :chr_l_regbrind_a:i_regbrflag
         FROM MT_INSTRUMENT
         WHERE INSTR_CODE = :chr_l_instrcode_a;

         IS_ANY_ORA_ERROR

         //if(chr_l_regbrind_a=="RG") //AIX Warning Removal
         if(strcmp(chr_l_regbrind_a,"RG") == 0)
         {
            EXEC SQL INSERT INTO DL_LOCALREPPROC3 (INSTR_CODE,CREDITCLIENT,QTY,INSTR_ISIN)
                     VALUES ( :chr_l_instrcode_a, '00 210 09',:i_00210sfk_NP,:chr_l_isin);
         }
         else
         {
            EXEC SQL INSERT INTO DL_LOCALREPPROC3 (INSTR_CODE,CREDITCLIENT,QTY,INSTR_ISIN)
                     VALUES ( :chr_l_instrcode_a, '00 210 20',:i_00210sfk_NP,:chr_l_isin);

         }
			IS_ANY_ORA_ERROR
		}
		if( i_00210sfk_F5 > 0 )
		{
		   if ( APL_FAILURE == Getisin(chr_l_instrcode_a,chr_l_isin,l_debug_info_ptr) )
			{
				APL_GOBACK_FAIL
			}
         memset(chr_l_regbrind_a,APL_NULL_CHAR,3);
         EXEC SQL SELECT REG_BR_IND INTO :chr_l_regbrind_a:i_regbrflag
         FROM MT_INSTRUMENT
         WHERE INSTR_CODE = :chr_l_instrcode_a;

         IS_ANY_ORA_ERROR

         //if(chr_l_regbrind_a=="RG") //AIX Warning Removal
         if(strcmp(chr_l_regbrind_a,"RG") == 0)
         {
            EXEC SQL INSERT INTO DL_LOCALREPPROC3 (INSTR_CODE,CREDITCLIENT,QTY,INSTR_ISIN)
                     VALUES ( :chr_l_instrcode_a, '00 210 09',:i_00210sfk_F5,:chr_l_isin);
         }
         else
         {
            EXEC SQL INSERT INTO DL_LOCALREPPROC3 (INSTR_CODE,CREDITCLIENT,QTY,INSTR_ISIN)
                     VALUES ( :chr_l_instrcode_a, '00 210 00',:i_00210sfk_F5,:chr_l_isin);

         }
			IS_ANY_ORA_ERROR
		}
		if( i_20210sfk > 0 ) 
		{
		   if ( APL_FAILURE == Getisin(chr_l_instrcode_a,chr_l_isin,l_debug_info_ptr) )
			{
				APL_GOBACK_FAIL
			}
         memset(chr_l_regbrind_a,APL_NULL_CHAR,3);
         EXEC SQL SELECT REG_BR_IND INTO :chr_l_regbrind_a:i_regbrflag
         FROM MT_INSTRUMENT
         WHERE INSTR_CODE = :chr_l_instrcode_a;

         IS_ANY_ORA_ERROR
        
         //if(chr_l_regbrind_a=="RG") //AIX Warning Removal
         if(strcmp(chr_l_regbrind_a,"RG") == 0) 
         {
            EXEC SQL INSERT INTO DL_LOCALREPPROC3 (INSTR_CODE,CREDITCLIENT,QTY,INSTR_ISIN)
                     VALUES ( :chr_l_instrcode_a, '20 210 09',:i_20210sfk,:chr_l_isin);
         }
         else
         {
            EXEC SQL INSERT INTO DL_LOCALREPPROC3 (INSTR_CODE,CREDITCLIENT,QTY,INSTR_ISIN)
                     VALUES ( :chr_l_instrcode_a, '20 210 00',:i_20210sfk,:chr_l_isin);

         }
			IS_ANY_ORA_ERROR
		}
		if( (i_00311sfk+i_trd_00311sfk) > 0 )
      {
		   if ( APL_FAILURE == Getisin(chr_l_instrcode_a,chr_l_isin,l_debug_info_ptr) )
			{
				APL_GOBACK_FAIL
			}
         EXEC SQL INSERT INTO DL_LOCALREPPROC3 (INSTR_CODE,CREDITCLIENT,QTY,INSTR_ISIN)
                  VALUES ( :chr_l_instrcode_a, '00 210 00 311',:i_00311sfk,:chr_l_isin);
      
         IS_ANY_ORA_ERROR
			
			EXEC SQL INSERT INTO DL_LOCALREPPROC3 (INSTR_CODE,CREDITCLIENT,QTY,INSTR_ISIN)
                  VALUES ( :chr_l_instrcode_a, '00 311 00',:i_00311sfk+:i_trd_00311sfk,:chr_l_isin);
      
         IS_ANY_ORA_ERROR
		}
		if( i_20311sfk > 0 ) 
      {
		   if ( APL_FAILURE == Getisin(chr_l_instrcode_a,chr_l_isin,l_debug_info_ptr) )
			{
				APL_GOBACK_FAIL
			}
         EXEC SQL INSERT INTO DL_LOCALREPPROC3 (INSTR_CODE,CREDITCLIENT,QTY,INSTR_ISIN)
                  VALUES ( :chr_l_instrcode_a, '20 210 00 311',:i_20311sfk,:chr_l_isin);
      
         IS_ANY_ORA_ERROR
			
			EXEC SQL INSERT INTO DL_LOCALREPPROC3 (INSTR_CODE,CREDITCLIENT,QTY,INSTR_ISIN)
                  VALUES ( :chr_l_instrcode_a, '20 311 00',:i_20311sfk,:chr_l_isin);
      
         IS_ANY_ORA_ERROR
		}

		if ( APL_FAILURE == Getisin(chr_l_instrcode_a,chr_l_isin,l_debug_info_ptr) )
		{
			APL_GOBACK_FAIL
		}
		EXEC SQL INSERT INTO DL_LOCALREPPROC3 (INSTR_CODE,CREDITCLIENT,QTY,INSTR_ISIN)
                  VALUES ( :chr_l_instrcode_a, '00 210 05',0 ,:chr_l_isin);
		
      
      IS_ANY_ORA_ERROR

		if( i_10110sfk > 0 )
      {	
			if ( APL_FAILURE == Getisin(chr_l_instrcode_a,chr_l_isin,l_debug_info_ptr) )
			{
				APL_GOBACK_FAIL
			}
         EXEC SQL INSERT INTO DL_LOCALREPPROC3(INSTR_CODE,CREDITCLIENT,QTY,INSTR_ISIN)
                  VALUES ( :chr_l_instrcode_a, '10 111',:i_10110sfk,:chr_l_isin);
      
         IS_ANY_ORA_ERROR
      }
		if( i_06110sfk > 0 )
      {
			if ( APL_FAILURE == Getisin(chr_l_instrcode_a,chr_l_isin,l_debug_info_ptr) )
			{
				APL_GOBACK_FAIL
			}
         EXEC SQL INSERT INTO DL_LOCALREPPROC3(INSTR_CODE,CREDITCLIENT,QTY,INSTR_ISIN)
                  VALUES ( :chr_l_instrcode_a, '10 130',:i_06110sfk,:chr_l_isin);
      
         IS_ANY_ORA_ERROR
      }
		if( i_10210sfk > 0 )
      {
			if ( APL_FAILURE == Getisin(chr_l_instrcode_a,chr_l_isin,l_debug_info_ptr) )
			{
				APL_GOBACK_FAIL
			}
         EXEC SQL INSERT INTO DL_LOCALREPPROC3(INSTR_CODE,CREDITCLIENT,QTY,INSTR_ISIN)
                  VALUES ( :chr_l_instrcode_a, '10 210 00',:i_10210sfk,:chr_l_isin);
      
         IS_ANY_ORA_ERROR
      }
		if( i_06210sfk > 0 )
      {
			if ( APL_FAILURE == Getisin(chr_l_instrcode_a,chr_l_isin,l_debug_info_ptr) )
			{
				APL_GOBACK_FAIL
			}
         EXEC SQL INSERT INTO DL_LOCALREPPROC3(INSTR_CODE,CREDITCLIENT,QTY,INSTR_ISIN)
                  VALUES ( :chr_l_instrcode_a, '10 210 06',:i_06210sfk,:chr_l_isin);
      
         IS_ANY_ORA_ERROR
      }
		if( i_09210sfk > 0 )
      {
			if ( APL_FAILURE == Getisin(chr_l_instrcode_a,chr_l_isin,l_debug_info_ptr) )
			{
				APL_GOBACK_FAIL
			}
         EXEC SQL INSERT INTO DL_LOCALREPPROC3(INSTR_CODE,CREDITCLIENT,QTY,INSTR_ISIN)
                  VALUES ( :chr_l_instrcode_a, '10 210 09',:i_09210sfk,:chr_l_isin);
      
         IS_ANY_ORA_ERROR
      }
		
		
		l_temp_100000_qty	=	0.0;
		l_temp_100001_qty	=	0.0;
		l_temp_100002_qty	=	0.0;
		

		l_temp_resi_quantity = 0.0; 
		l_temp_non_resi_quantity = 0.0;
		l_temp_resi_311_quantity = 0.0;
		l_temp_non_resi_311_quantity = 0.0;

		
		l_temp_311_qty_ex_arena		=	0.0;
		l_temp_100000_qty_exarena	=	0.0;
		l_temp_100001_qty_exarena	=	0.0;
		l_temp_100002_qty_exarena	=	0.0;
		

		l_temp_resi_311_qty_ex_arena = 0.0; 
		l_temp_non_resi_311_qty_ex_arena = 0.0;
		l_temp_resi_qty_ex_arena = 0.0;
		l_temp_non_resi_qty_ex_arena = 0.0;

		i_10110sfk = 0.0;
		i_06110sfk = 0.0;
		i_09110sfk = 0.0;
		i_06110sfk = 0.0;
		i_00110sfk = 0.0;
		i_10210sfk = 0.0;
		i_09210sfk = 0.0;
		i_06210sfk = 0.0;
		i_00210sfk = 0.0;
		i_00311sfk = 0.0;
		i_00210sfk_NP=0.0;
		i_00210sfk_F5=0.0;
		i_00160sfk_NP=0.0;
		i_00110sfk_F5=0.0;

		i_20210sfk = 0.0; 
		i_20311sfk = 0.0;
		i_20110sfk = 0.0;

		l_totdebit_ind 	  = 0.0;
		l_totcredit_ind    = 0.0;
		l_tot210   = 0.0;
		l_tot210_NP= 0.0;
		l_tot210_F5= 0.0;

		continue;

	}	

	EXEC SQL CLOSE safek_curs;
	IS_ANY_ORA_ERROR

   if (APL_FAILURE == CO_RtvSysDt(chr_h_system_date,
                                       l_debug_info_ptr) )
   {
      APL_GOBACK_FAIL
   }
	
	chr_l_nodata = 'N';

   EXEC SQL DECLARE order_curs CURSOR FOR
            SELECT a.* 
				FROM OR_ORDERDETAILS a, MT_INSTRUMENT b
				WHERE a.CHECKER_DT IS NULL
				AND a.BUY_SELL_IND = 'B'
				AND a.DATEOF_CANCEL IS NULL
				AND a.EXP_DATE IS NOT NULL
				AND a.EXP_DATE >= (SELECT SYS_DATE FROM PRO_SYS_DATE)
				AND a.INSTR_CODE = b.INSTR_CODE
				AND b.CLASSCD = 'LCR' 
				ORDER BY b.INSTR_ISIN,a.CLIENT;   
				
				
   EXEC SQL OPEN order_curs;
   IS_ANY_ORA_ERROR

	EXEC SQL FETCH order_curs
            INTO :l_or_orderdetails_struct_ha_a:l_or_orderdetails_struct_ib;

   IS_ANY_ORA_ERROR


   for(;;)
   {
		if ( (APL_ZERO_RESULT_SET) || chr_l_nodata == 'Y' )
		{
			break;
		}
		chr_l_nodata = 'N';
      strcpy(chr_l_instrcode_a,l_or_orderdetails_struct_ha_a.h_instr_code);

		

      while ( (!strcmp(l_or_orderdetails_struct_ha_a.h_instr_code,chr_l_instrcode_a) ) )
      {
		    int_flg_nonresi = 0;
		    if (CheckNonResident(l_or_orderdetails_struct_ha_a.h_dl_client,   
									    l_or_orderdetails_struct_ha_a.h_instr_code,
									    &int_flg_nonresi,
									    l_debug_info_ptr) == APL_FAILURE)
		      {
			      APL_GOBACK_FAIL
		      }
			strcpy( chr_l_client_a,l_or_orderdetails_struct_ha_a.h_dl_client);

         if (!strcmp(chr_l_client_a,"100000"))
         {
            i_10120sfk = i_10120sfk +l_or_orderdetails_struct_ha_a.h_orderquantity;
         }
         else if(!strcmp(chr_l_client_a,"100001"))
         {
            i_09120sfk = i_09120sfk + l_or_orderdetails_struct_ha_a.h_orderquantity;
         }
         else if(!strcmp(chr_l_client_a,"100002"))
         {
            i_06120sfk = i_06120sfk + l_or_orderdetails_struct_ha_a.h_orderquantity;
         }
         else
         {
				if (int_flg_nonresi == 0) 
            	i_00120sfk = i_00120sfk + l_or_orderdetails_struct_ha_a.h_orderquantity;
				else
            	i_20120sfk = i_20120sfk + l_or_orderdetails_struct_ha_a.h_orderquantity;
         }

		   EXEC SQL FETCH order_curs
         		   INTO :l_or_orderdetails_struct_ha_a:l_or_orderdetails_struct_ib;

  			IS_ANY_ORA_ERROR

			if ( APL_ZERO_RESULT_SET )
			{
				chr_l_nodata = 'Y';
				break;
			}
			chr_l_nodata = 'N';
			continue;

      } 

      if( i_00120sfk > 0 )
      {
			if ( APL_FAILURE == Getisin(chr_l_instrcode_a,chr_l_isin,l_debug_info_ptr) )
			{
				APL_GOBACK_FAIL
			}
         EXEC SQL INSERT INTO DL_LOCALREPPROC3(INSTR_CODE,CREDITCLIENT,QTY,INSTR_ISIN)
                  VALUES ( :chr_l_instrcode_a, '00 120',:i_00120sfk,:chr_l_isin);

         IS_ANY_ORA_ERROR
			
			EXEC SQL SELECT COUNT(*) INTO :int_l_count
						FROM DL_LOCALREPPROC3
						WHERE INSTR_CODE =: chr_l_instrcode_a
						AND CREDITCLIENT = '00 110';
			
			IS_ANY_ORA_ERROR

			if ( int_l_count > 0 )	
			{
				EXEC SQL UPDATE DL_LOCALREPPROC3 
							SET QTY = QTY - :i_00120sfk
							WHERE INSTR_CODE =: chr_l_instrcode_a
							AND CREDITCLIENT = '00 110';

				IS_ANY_ORA_ERROR
      	}
		}

      if( i_20120sfk > 0 ) 
      {
			if ( APL_FAILURE == Getisin(chr_l_instrcode_a,chr_l_isin,l_debug_info_ptr) )
			{
				APL_GOBACK_FAIL
			}
         EXEC SQL INSERT INTO DL_LOCALREPPROC3(INSTR_CODE,CREDITCLIENT,QTY,INSTR_ISIN)
                  VALUES ( :chr_l_instrcode_a, '20 120',:i_20120sfk,:chr_l_isin);

         IS_ANY_ORA_ERROR
			
			EXEC SQL SELECT COUNT(*) INTO :int_l_count
						FROM DL_LOCALREPPROC3
						WHERE INSTR_CODE =: chr_l_instrcode_a
						AND CREDITCLIENT = '20 110';
			
			IS_ANY_ORA_ERROR

			if ( int_l_count > 0 )	
			{
				EXEC SQL UPDATE DL_LOCALREPPROC3 
							SET QTY = QTY - :i_20120sfk
							WHERE INSTR_CODE =: chr_l_instrcode_a
							AND CREDITCLIENT = '20 110';

				IS_ANY_ORA_ERROR
      	}
		}

      if( i_10120sfk > 0 )
      {
			if ( APL_FAILURE == Getisin(chr_l_instrcode_a,chr_l_isin,l_debug_info_ptr) )
			{
				APL_GOBACK_FAIL
			}
         EXEC SQL INSERT INTO DL_LOCALREPPROC3(INSTR_CODE,CREDITCLIENT,QTY,INSTR_ISIN)
                  VALUES ( :chr_l_instrcode_a, '10 120 00',:i_10120sfk,:chr_l_isin);

         IS_ANY_ORA_ERROR

         EXEC SQL SELECT COUNT(*) INTO :int_l_count
						FROM DL_LOCALREPPROC3
                  WHERE INSTR_CODE =: chr_l_instrcode_a
                  AND CREDITCLIENT = '10 111';
        
         IS_ANY_ORA_ERROR

         if ( int_l_count > 0 )   
         {
            EXEC SQL UPDATE DL_LOCALREPPROC3 
                     SET QTY = QTY - :i_10120sfk
                     WHERE INSTR_CODE =: chr_l_instrcode_a
                     AND CREDITCLIENT = '10 111';

            IS_ANY_ORA_ERROR
         }

      }
      if( i_09120sfk > 0 )
      {
			if ( APL_FAILURE == Getisin(chr_l_instrcode_a,chr_l_isin,l_debug_info_ptr) )
			{
				APL_GOBACK_FAIL
			}
         EXEC SQL INSERT INTO DL_LOCALREPPROC3(INSTR_CODE,CREDITCLIENT,QTY,INSTR_ISIN)
                  VALUES ( :chr_l_instrcode_a, '10 120 09',:i_09120sfk,:chr_l_isin);

         IS_ANY_ORA_ERROR

         EXEC SQL SELECT COUNT(*) INTO :int_l_count
						FROM DL_LOCALREPPROC3
                  WHERE INSTR_CODE =: chr_l_instrcode_a
                  AND CREDITCLIENT = '10 111';
        
         IS_ANY_ORA_ERROR

         if ( int_l_count > 0 )   
         {
            EXEC SQL UPDATE DL_LOCALREPPROC3 
                     SET QTY = QTY - :i_09120sfk
                     WHERE INSTR_CODE =: chr_l_instrcode_a
                     AND CREDITCLIENT = '10 111';

            IS_ANY_ORA_ERROR
         }
      }

      if( i_06120sfk > 0 )
      {
			if ( APL_FAILURE == Getisin(chr_l_instrcode_a,chr_l_isin,l_debug_info_ptr) )
			{
				APL_GOBACK_FAIL
			}
         EXEC SQL INSERT INTO DL_LOCALREPPROC3(INSTR_CODE,CREDITCLIENT,QTY,INSTR_ISIN)
                  VALUES ( :chr_l_instrcode_a, '10 120 06',:i_06120sfk,:chr_l_isin);

         IS_ANY_ORA_ERROR

         EXEC SQL SELECT COUNT(*) INTO :int_l_count
						FROM DL_LOCALREPPROC3
                  WHERE INSTR_CODE =: chr_l_instrcode_a
                  AND CREDITCLIENT = '10 130';
        
         IS_ANY_ORA_ERROR

         if ( int_l_count > 0 )   
         {
            EXEC SQL UPDATE DL_LOCALREPPROC3 
                     SET QTY = QTY - :i_06120sfk
                     WHERE INSTR_CODE = :chr_l_instrcode_a
                     AND CREDITCLIENT = '10 130';

            IS_ANY_ORA_ERROR
         }
      }

      i_10120sfk = 0.0;
      i_09120sfk = 0.0;
      i_06120sfk = 0.0;
      i_00120sfk = 0.0;
	
      i_20120sfk = 0.0; 

		continue;

	}
	
	EXEC SQL CLOSE order_curs;
	IS_ANY_ORA_ERROR

	chr_l_nodata = 'N';
 	
   
	
   EXEC SQL DECLARE trade_curs CURSOR FOR
            SELECT a.* 
            FROM DL_DEAL a, MT_INSTRUMENT b
            WHERE a.DEAL_STAT NOT IN ('DD','DU')
				
				AND ( a.LR_DL_CLASS IN ('01','02','04','05','06','08','10','11','12','14','16','17','19')
						  OR ( a.LR_DL_CLASS = '03' AND a.DEAL_CD = '1') )
				AND a.INSTRUMENT_DT IS NULL
            AND (a.VAL_FDT IS NOT NULL AND a.EX_ARENA!='3' AND (FAILREASON_CD IS NULL OR FAILREASON_CD !='60'))
				AND a.INSTR_CODE = b.INSTR_CODE
				AND b.CLASSCD = 'LCR'
				ORDER BY	b.INSTR_ISIN, a.CLIENT;  
				
				

   EXEC SQL OPEN trade_curs;
   IS_ANY_ORA_ERROR

	EXEC SQL FETCH trade_curs
				INTO :l_sys_dl_deal_struct_ha:l_sys_dl_deal_struct_ik;
	IS_ANY_ORA_ERROR

   for(;;)
   {
		if ( ( APL_ZERO_RESULT_SET ) || chr_l_nodata == 'Y' )
		{
			break;
		}
		chr_l_nodata = 'N';
      strcpy(chr_l_instrcode_a,l_sys_dl_deal_struct_ha.h_instr_code);

		strcpy( int_l_domcpac , l_sys_dl_deal_struct_ha.h_domcpclt_cd);

		

      while ( (!strcmp(l_sys_dl_deal_struct_ha.h_domcpclt_cd,int_l_domcpac)) && (!strcmp(l_sys_dl_deal_struct_ha.h_instr_code,chr_l_instrcode_a)) )
      {
		    int_flg_nonresi = 0;
		    if (CheckNonResident(l_sys_dl_deal_struct_ha.h_dl_client,   
									    l_sys_dl_deal_struct_ha.h_instr_code,
									    &int_flg_nonresi,
									    l_debug_info_ptr) == APL_FAILURE)
		    {
			    APL_GOBACK_FAIL
		    }

         strcpy( chr_l_client_a,l_sys_dl_deal_struct_ha.h_dl_client);

         if (!strcmp(chr_l_client_a,"100000"))
         {
				if ( (!strcmp(l_sys_dl_deal_struct_ha.h_dealcd,"2")) ||(!strcmp(l_sys_dl_deal_struct_ha.h_dealcd,"4")) || (!strcmp(l_sys_dl_deal_struct_ha.h_dealcd,"6")) ||(!strcmp(l_sys_dl_deal_struct_ha.h_dealcd,"8")) )
				{
 	           i_10221sfk = i_10221sfk + l_sys_dl_deal_struct_ha.h_qty;
				}
				
				
				else if ( (!strcmp(l_sys_dl_deal_struct_ha.h_lrdltype,"02")) || (!strcmp(l_sys_dl_deal_struct_ha.h_lrdltype,"17")) ) 
				{
					i_10224sfk = i_10224sfk + l_sys_dl_deal_struct_ha.h_qty;
				}
				else
				{
					i_10222sfk = i_10222sfk + l_sys_dl_deal_struct_ha.h_qty;
				}
         }
         else if(!strcmp(chr_l_client_a,"100001"))
         {
				if ( (!strcmp(l_sys_dl_deal_struct_ha.h_dealcd,"2")) ||(!strcmp(l_sys_dl_deal_struct_ha.h_dealcd,"4")) || (!strcmp(l_sys_dl_deal_struct_ha.h_dealcd,"6")) ||(!strcmp(l_sys_dl_deal_struct_ha.h_dealcd,"8")) )
				{
					i_06221sfk = i_06221sfk + l_sys_dl_deal_struct_ha.h_qty;
				}
				
				
				else if ( (!strcmp(l_sys_dl_deal_struct_ha.h_lrdltype,"02")) || (!strcmp(l_sys_dl_deal_struct_ha.h_lrdltype,"17")) )
				{
					i_06224sfk = i_06224sfk + l_sys_dl_deal_struct_ha.h_qty;
				}
				else
				{
					i_06222sfk = i_06222sfk + l_sys_dl_deal_struct_ha.h_qty;
				}
		
         }
         else if(!strcmp(chr_l_client_a,"100002"))
         {
				if ( (!strcmp(l_sys_dl_deal_struct_ha.h_dealcd,"2")) ||(!strcmp(l_sys_dl_deal_struct_ha.h_dealcd,"4")) || (!strcmp(l_sys_dl_deal_struct_ha.h_dealcd,"6")) ||(!strcmp(l_sys_dl_deal_struct_ha.h_dealcd,"8")) )
				{
					i_09221sfk = i_09221sfk + l_sys_dl_deal_struct_ha.h_qty;
				}
				
				
				else if ( (!strcmp(l_sys_dl_deal_struct_ha.h_lrdltype,"02")) || (!strcmp(l_sys_dl_deal_struct_ha.h_lrdltype,"17")) )
				{
					i_09224sfk = i_09224sfk + l_sys_dl_deal_struct_ha.h_qty;
				}
				else
				{
					i_09222sfk = i_09222sfk + l_sys_dl_deal_struct_ha.h_qty;
				}
         }
         else
         {
				if ( (!strcmp(l_sys_dl_deal_struct_ha.h_dealcd,"2")) ||(!strcmp(l_sys_dl_deal_struct_ha.h_dealcd,"4")) || (!strcmp(l_sys_dl_deal_struct_ha.h_dealcd,"6")) ||(!strcmp(l_sys_dl_deal_struct_ha.h_dealcd,"8")) )
				{
					if (int_flg_nonresi == 0) 
						i_00221sfk = i_00221sfk + l_sys_dl_deal_struct_ha.h_qty;
					else
						i_20221sfk = i_20221sfk + l_sys_dl_deal_struct_ha.h_qty;
				}
				
				
		      
				else if ((!strcmp(l_sys_dl_deal_struct_ha.h_dealcd,"1")) ||(!strcmp(l_sys_dl_deal_struct_ha.h_dealcd,"3")) || (!strcmp(l_sys_dl_deal_struct_ha.h_dealcd,"5")) ||(!strcmp(l_sys_dl_deal_struct_ha.h_dealcd,"7")) )
            {
               if ( (!strcmp(l_sys_dl_deal_struct_ha.h_lrdltype,"02")) || (!strcmp(l_sys_dl_deal_struct_ha.h_lrdltype,"17")) )
               {
						if (int_flg_nonresi == 0) 
                  	i_00224sfk = i_00224sfk + l_sys_dl_deal_struct_ha.h_qty;
						else
                  	i_20224sfk = i_20224sfk + l_sys_dl_deal_struct_ha.h_qty;
               }
               else
               {
						if (int_flg_nonresi == 0) 
                  	i_00222sfk = i_00222sfk + l_sys_dl_deal_struct_ha.h_qty;
						else
                  	i_20222sfk = i_20222sfk + l_sys_dl_deal_struct_ha.h_qty;
               }
            }
			}
		   EXEC SQL FETCH trade_curs
           			INTO :l_sys_dl_deal_struct_ha:l_sys_dl_deal_struct_ik;
 		   IS_ANY_ORA_ERROR

			if ( APL_ZERO_RESULT_SET )
			{
				chr_l_nodata = 'Y';
				break;
			}

			chr_l_nodata = 'N';
         continue;

      } 

      if( i_00221sfk > 0 )
      {
			if ( APL_FAILURE == Getisin(chr_l_instrcode_a,chr_l_isin,l_debug_info_ptr) )
			{
				APL_GOBACK_FAIL
			}
         EXEC SQL INSERT INTO DL_LOCALREPPROC3(INSTR_CODE,CREDITCLIENT,QTY,DOMESTIC_CPCLT,INSTR_ISIN)
                  VALUES ( :chr_l_instrcode_a, '00 221',:i_00221sfk,:int_l_domcpac,:chr_l_isin);

         IS_ANY_ORA_ERROR
		}
      if( i_20221sfk > 0 ) 
      {
			if ( APL_FAILURE == Getisin(chr_l_instrcode_a,chr_l_isin,l_debug_info_ptr) )
			{
				APL_GOBACK_FAIL
			}
         EXEC SQL INSERT INTO DL_LOCALREPPROC3(INSTR_CODE,CREDITCLIENT,QTY,DOMESTIC_CPCLT,INSTR_ISIN)
                  VALUES ( :chr_l_instrcode_a, '20 221',:i_20221sfk,:int_l_domcpac,:chr_l_isin);

         IS_ANY_ORA_ERROR
		}
 
      if( i_00222sfk > 0 )
      {
			if ( APL_FAILURE == Getisin(chr_l_instrcode_a,chr_l_isin,l_debug_info_ptr) )
			{
				APL_GOBACK_FAIL
			}
         EXEC SQL INSERT INTO DL_LOCALREPPROC3(INSTR_CODE,CREDITCLIENT,QTY,DOMESTIC_CPCLT,INSTR_ISIN)
						VALUES ( :chr_l_instrcode_a, '00 222',:i_00222sfk,:int_l_domcpac,:chr_l_isin);
         IS_ANY_ORA_ERROR

		}
      if( i_20222sfk > 0 ) 
      {
			if ( APL_FAILURE == Getisin(chr_l_instrcode_a,chr_l_isin,l_debug_info_ptr) )
			{
				APL_GOBACK_FAIL
			}
         EXEC SQL INSERT INTO DL_LOCALREPPROC3(INSTR_CODE,CREDITCLIENT,QTY,DOMESTIC_CPCLT,INSTR_ISIN)
						VALUES ( :chr_l_instrcode_a, '20 222',:i_20222sfk,:int_l_domcpac,:chr_l_isin);
         IS_ANY_ORA_ERROR

		}

		if( i_00224sfk > 0 )
      {
			if ( APL_FAILURE == Getisin(chr_l_instrcode_a,chr_l_isin,l_debug_info_ptr) )
			{
				APL_GOBACK_FAIL
			}
         EXEC SQL INSERT INTO DL_LOCALREPPROC3(INSTR_CODE,CREDITCLIENT,QTY,DOMESTIC_CPCLT,INSTR_ISIN)
                  VALUES ( :chr_l_instrcode_a, '00 224',:i_00224sfk,:int_l_domcpac,:chr_l_isin);
         IS_ANY_ORA_ERROR

      }
		if( i_20224sfk > 0 ) 
      {
			if ( APL_FAILURE == Getisin(chr_l_instrcode_a,chr_l_isin,l_debug_info_ptr) )
			{
				APL_GOBACK_FAIL
			}
         EXEC SQL INSERT INTO DL_LOCALREPPROC3(INSTR_CODE,CREDITCLIENT,QTY,DOMESTIC_CPCLT,INSTR_ISIN)
                  VALUES ( :chr_l_instrcode_a, '20 224',:i_20224sfk,:int_l_domcpac,:chr_l_isin);
         IS_ANY_ORA_ERROR

      }

      if( i_06221sfk > 0 )
      {
			if ( APL_FAILURE == Getisin(chr_l_instrcode_a,chr_l_isin,l_debug_info_ptr) )
			{
				APL_GOBACK_FAIL
			}
         EXEC SQL INSERT INTO DL_LOCALREPPROC3(INSTR_CODE,CREDITCLIENT,QTY,DOMESTIC_CPCLT,INSTR_ISIN)
                  VALUES ( :chr_l_instrcode_a, '10 221 06',:i_06221sfk,:int_l_domcpac,:chr_l_isin);
         IS_ANY_ORA_ERROR

      }
      if( i_06222sfk > 0 )
      {
			if ( APL_FAILURE == Getisin(chr_l_instrcode_a,chr_l_isin,l_debug_info_ptr) )
			{
				APL_GOBACK_FAIL
			}
         EXEC SQL INSERT INTO DL_LOCALREPPROC3(INSTR_CODE,CREDITCLIENT,QTY,DOMESTIC_CPCLT,INSTR_ISIN)
                  VALUES ( :chr_l_instrcode_a, '10 222 06',:i_06222sfk,:int_l_domcpac,:chr_l_isin);
         IS_ANY_ORA_ERROR

      }
      if( i_06224sfk > 0 )
      {
			if ( APL_FAILURE == Getisin(chr_l_instrcode_a,chr_l_isin,l_debug_info_ptr) )
			{
				APL_GOBACK_FAIL
			}
         EXEC SQL INSERT INTO DL_LOCALREPPROC3(INSTR_CODE,CREDITCLIENT,QTY,DOMESTIC_CPCLT,INSTR_ISIN)
                  VALUES ( :chr_l_instrcode_a, '10 224 06',:i_06224sfk,:int_l_domcpac,:chr_l_isin);
         IS_ANY_ORA_ERROR

      }
      if( i_09221sfk > 0 )
      {
			if ( APL_FAILURE == Getisin(chr_l_instrcode_a,chr_l_isin,l_debug_info_ptr) )
			{
				APL_GOBACK_FAIL
			}
         EXEC SQL INSERT INTO DL_LOCALREPPROC3(INSTR_CODE,CREDITCLIENT,QTY,DOMESTIC_CPCLT,INSTR_ISIN)
                  VALUES ( :chr_l_instrcode_a, '10 221 09',:i_09221sfk,:int_l_domcpac,:chr_l_isin);
         IS_ANY_ORA_ERROR

      }
      if( i_09222sfk > 0 )
      {
			if ( APL_FAILURE == Getisin(chr_l_instrcode_a,chr_l_isin,l_debug_info_ptr) )
			{
				APL_GOBACK_FAIL
			}
         EXEC SQL INSERT INTO DL_LOCALREPPROC3(INSTR_CODE,CREDITCLIENT,QTY,DOMESTIC_CPCLT,INSTR_ISIN)
                  VALUES ( :chr_l_instrcode_a, '10 222 09',:i_09222sfk,:int_l_domcpac,:chr_l_isin);
         IS_ANY_ORA_ERROR

      }
      if( i_09224sfk > 0 )
      {
			if ( APL_FAILURE == Getisin(chr_l_instrcode_a,chr_l_isin,l_debug_info_ptr) )
			{
				APL_GOBACK_FAIL
			}
         EXEC SQL INSERT INTO DL_LOCALREPPROC3(INSTR_CODE,CREDITCLIENT,QTY,DOMESTIC_CPCLT,INSTR_ISIN)
                  VALUES ( :chr_l_instrcode_a, '10 224 09',:i_09224sfk,:int_l_domcpac,:chr_l_isin);
         IS_ANY_ORA_ERROR

      }
      if( i_10221sfk > 0 )
      {
			if ( APL_FAILURE == Getisin(chr_l_instrcode_a,chr_l_isin,l_debug_info_ptr) )
			{
				APL_GOBACK_FAIL
			}
         EXEC SQL INSERT INTO DL_LOCALREPPROC3(INSTR_CODE,CREDITCLIENT,QTY,DOMESTIC_CPCLT,INSTR_ISIN)
                  VALUES ( :chr_l_instrcode_a, '10 221 00',:i_10221sfk,:int_l_domcpac,:chr_l_isin);
         IS_ANY_ORA_ERROR

      }
      if( i_10222sfk > 0 )
      {
			if ( APL_FAILURE == Getisin(chr_l_instrcode_a,chr_l_isin,l_debug_info_ptr) )
			{
				APL_GOBACK_FAIL
			}
         EXEC SQL INSERT INTO DL_LOCALREPPROC3(INSTR_CODE,CREDITCLIENT,QTY,DOMESTIC_CPCLT,INSTR_ISIN)
                  VALUES ( :chr_l_instrcode_a, '10 222 00',:i_10222sfk,:int_l_domcpac,:chr_l_isin);
         IS_ANY_ORA_ERROR

      }
      if( i_10224sfk > 0 )
      {
			if ( APL_FAILURE == Getisin(chr_l_instrcode_a,chr_l_isin,l_debug_info_ptr) )
			{
				APL_GOBACK_FAIL
			}
         EXEC SQL INSERT INTO DL_LOCALREPPROC3(INSTR_CODE,CREDITCLIENT,QTY,DOMESTIC_CPCLT,INSTR_ISIN)
                  VALUES ( :chr_l_instrcode_a, '10 224 00',:i_10224sfk,:int_l_domcpac,:chr_l_isin);
         IS_ANY_ORA_ERROR

      }
		i_10221sfk = 0.0;
		i_09221sfk = 0.0;
		i_06221sfk = 0.0;
		i_00221sfk = 0.0;
		i_10222sfk = 0.0;
		i_06222sfk = 0.0;
		i_10221sfk = 0.0;
		i_00222sfk = 0.0;
		i_10224sfk = 0.0;
		i_09224sfk = 0.0;
		i_06224sfk = 0.0;
		i_00224sfk = 0.0;

		i_20221sfk = 0.0; 
		i_20222sfk = 0.0;
		i_20224sfk = 0.0;

		continue;

	}

	EXEC SQL CLOSE trade_curs;
	IS_ANY_ORA_ERROR

	int_l_pgno++ ;
	chr_l_nodata = 'N';

   EXEC SQL DECLARE clrproc3_curs CURSOR FOR
            SELECT * FROM DL_LOCALREPPROC3
            ORDER BY INSTR_ISIN,INSTR_CODE,CREDITCLIENT,DOMESTIC_CPCLT ASC;

   EXEC SQL OPEN clrproc3_curs;
   IS_ANY_ORA_ERROR

   EXEC SQL FETCH clrproc3_curs
            INTO :l_dl_localrepproc3_struct_h:l_dl_localrepproc3_struct_i;

   IS_ANY_ORA_ERROR

   for(;;)
   {
		if ( (APL_ZERO_RESULT_SET) || chr_l_nodata == 'Y' )
		{
			break;
		}
		chr_l_nodata = 'N';
		strcpy ( chr_l_instrcode_a, l_dl_localrepproc3_struct_h.h_instr_code);

		l_totdebit_ind  = 0.0;
		l_totcredit_ind  = 0.0;
		l_tot210 = 0.0;
		l_tot210_NP = 0.0;
		l_tot210_F5 = 0.0;

		strcpy( chr_l_ctcate ,"00");
		chr_l_firstpg = 'Y';
		
		
		while ( !strcmp(chr_l_instrcode_a,l_dl_localrepproc3_struct_h.h_instr_code) && !strncmp(l_dl_localrepproc3_struct_h.h_ctclt,"00",2 ) ) 
		{
				if ( chr_l_nodata == 'Y' )
				{
					break;
				}

				if ( chr_l_firstpg == 'Y' )
				{
					CBLRBalRecHdrPrnFn(p_procdate,chr_l_instrcode_a,int_l_pgno,1,p_oprec_filehandle,p_logfile,l_debug_info_ptr);
					chr_l_firstpg = 'N';
				}

				strcpy(chr_l_temp_ctacc,l_dl_localrepproc3_struct_h.h_ctclt);

				if ( APL_FAILURE == CO_PadString(chr_l_temp_ctacc,'R' , 13," ",l_debug_info_ptr))
            {
              CO_ProcMonitor(p_logfile,"CBPad_StrFn returned failure\n",NULL,NULL);
              APL_GOBACK_FAIL
            }
		
				
				int_l_len = strlen(l_dl_localrepproc3_struct_h.h_ctclt);
				for ( i=3; i <= int_l_len ; i++ )
				{
					chr_l_new_ctacc[i-3] = l_dl_localrepproc3_struct_h.h_ctclt[i] ;
				}
				chr_l_new_ctacc[int_l_len-3] = APL_NULL_CHAR;
           
				
				memset(chr_l_temp_domcpac, APL_NULL_CHAR,11);
				if ( ( !strncmp(chr_l_new_ctacc,"221",3 )) || 
					  ( !strncmp(chr_l_new_ctacc,"222",3 )) || 
					  ( !strncmp(chr_l_new_ctacc,"224",3 )) )
				   strncpy(chr_l_temp_domcpac,l_dl_localrepproc3_struct_h.h_domcpclt_cd,( strlen(l_dl_localrepproc3_struct_h.h_domcpclt_cd)-3 ));
		      else	
					strcpy(chr_l_temp_domcpac,l_dl_localrepproc3_struct_h.h_domcpclt_cd);

				if ( strlen( chr_l_temp_domcpac ) == 0 )
				{
					strcpy(chr_l_temp_domcpac,"          ");
				}
				else
				{
   	         if ( APL_FAILURE == CO_PadString(chr_l_temp_domcpac,'R' , 10," ",l_debug_info_ptr))
      	      {
         	     CO_ProcMonitor(p_logfile,"CBPad_StrFn returned failure \n",NULL,NULL);
            	  APL_GOBACK_FAIL
            	}
				 }

				fprintf(p_oprec_filehandle,"\n");
				fprintf(p_oprec_filehandle,"%s",chr_l_temp_ctacc); 
				
				if ( strcmp(l_dl_localrepproc3_struct_h.h_domcpclt_cd, l_mt_core_sys_params_struct_h.custody_clt_cd)== 0 )
				   fprintf(p_oprec_filehandle,"%4s924       "," ");	
				else  
				   fprintf(p_oprec_filehandle,"%4s%s"," ",chr_l_temp_domcpac);	

				

				

				if ( !strncmp(chr_l_new_ctacc,"210",3 ))
				{
			      if ( APL_FAILURE == CO_ToStr( l_dl_localrepproc3_struct_h.h_qty,25,l_mt_core_sys_params_struct_h.qty_dec_len,chr_l_str_qty ) )
      			{
						CO_ProcMonitor(p_logfile,"CBNumToStr returned failure\n",NULL,NULL);
						APL_GOBACK_FAIL
      			}

					if ( APL_FAILURE == CO_PadString(chr_l_str_qty,'L' , 25," ",l_debug_info_ptr))
 				   {
						CO_ProcMonitor(p_logfile,"CBPad_StrFn returned failure \n",NULL,NULL);
						APL_GOBACK_FAIL
   				}

					fprintf(p_oprec_filehandle,"%4s%s"," ",chr_l_str_qty); 

					strcpy(chr_l_zero,"0");

					if ( APL_FAILURE == CO_PadString(chr_l_zero,'L' , 25," ",l_debug_info_ptr))
 				   {
						CO_ProcMonitor(p_logfile,"CBPad_StrFn returned failure \n",NULL,NULL);
						APL_GOBACK_FAIL
   				}
					
					fprintf(p_oprec_filehandle,"%4s%s"," ",chr_l_zero);			
					l_totdebit_ind = l_totdebit_ind + l_dl_localrepproc3_struct_h.h_qty;
					l_tot210 = l_tot210 + l_dl_localrepproc3_struct_h.h_qty;
					if (!strncmp(chr_l_new_ctacc,"210 00",6))
					   l_tot210_F5 = l_tot210_F5 + l_dl_localrepproc3_struct_h.h_qty;
					else
					   l_tot210_NP = l_tot210_NP + l_dl_localrepproc3_struct_h.h_qty;

		         EXEC SQL FETCH clrproc3_curs
      				      INTO :l_dl_localrepproc3_struct_h:l_dl_localrepproc3_struct_i;

					IS_ANY_ORA_ERROR
				
					if ( APL_ZERO_RESULT_SET )
               {
                  chr_l_nodata = 'Y';
                  break;
               }

               chr_l_nodata = 'N';
					
					strcpy( int_l_domcpac,l_dl_localrepproc3_struct_h.h_domcpclt_cd ) ; 
					if ( !strcmp(chr_l_instrcode_a,l_dl_localrepproc3_struct_h.h_instr_code) && !strncmp(l_dl_localrepproc3_struct_h.h_ctclt,"00",2 ) ) 
					{
						strcpy( chr_l_instrcode_a,l_dl_localrepproc3_struct_h.h_instr_code ) ; 
						
            		int_l_len = strlen(l_dl_localrepproc3_struct_h.h_ctclt);
            		for ( i=3; i <= int_l_len ; i++ )
            		{
               		chr_l_new_ctacc[i-3] = l_dl_localrepproc3_struct_h.h_ctclt[i] ;
            		}
            		chr_l_new_ctacc[int_l_len-3] = APL_NULL_CHAR;
					}		
					else if ( !strcmp(chr_l_instrcode_a,l_dl_localrepproc3_struct_h.h_instr_code) && strncmp(l_dl_localrepproc3_struct_h.h_ctclt,"00",2 ) ) 
					{
						strcpy( chr_l_instrcode_a,l_dl_localrepproc3_struct_h.h_instr_code ) ; 
					}
					
					continue;
				}

				else if ( !strncmp( chr_l_new_ctacc,"221",3 ) )	
				{
					
					strncpy(int_l_domcpac,l_dl_localrepproc3_struct_h.h_domcpclt_cd,( strlen(l_dl_localrepproc3_struct_h.h_domcpclt_cd)-3 ));
					l_dom221quantity = 0.0;
					while  ( (!strncmp( int_l_domcpac,l_dl_localrepproc3_struct_h.h_domcpclt_cd, (strlen(l_dl_localrepproc3_struct_h.h_domcpclt_cd)-3) )) && 
							 ( !strncmp( chr_l_new_ctacc,"221",3 )) && 
						 	 ( !strcmp( chr_l_instrcode_a,l_dl_localrepproc3_struct_h.h_instr_code )) && 
							 ( !strncmp( l_dl_localrepproc3_struct_h.h_ctclt,"00",2 )))
					{
						l_dom221quantity = l_dom221quantity + l_dl_localrepproc3_struct_h.h_qty ;
						l_totdebit_ind = l_totdebit_ind + l_dl_localrepproc3_struct_h.h_qty;
					strncpy(int_l_domcpac,l_dl_localrepproc3_struct_h.h_domcpclt_cd,( strlen(l_dl_localrepproc3_struct_h.h_domcpclt_cd)-3 ));

 	               EXEC SQL FETCH clrproc3_curs
                           INTO :l_dl_localrepproc3_struct_h:l_dl_localrepproc3_struct_i;

                  IS_ANY_ORA_ERROR

						if ( APL_ZERO_RESULT_SET )
 	               {
    	              chr_l_nodata = 'Y';
      	            break;
         	       }

                  chr_l_nodata = 'N';

					
					
					if ( !strcmp(chr_l_instrcode_a,l_dl_localrepproc3_struct_h.h_instr_code) && !strncmp(l_dl_localrepproc3_struct_h.h_ctclt,"00",2 ) ) 
					{
						strcpy( chr_l_instrcode_a,l_dl_localrepproc3_struct_h.h_instr_code ) ; 
						
            		int_l_len = strlen(l_dl_localrepproc3_struct_h.h_ctclt);
            		for ( i=3; i <= int_l_len ; i++ )
            		{
               		chr_l_new_ctacc[i-3] = l_dl_localrepproc3_struct_h.h_ctclt[i] ;
            		}
            		chr_l_new_ctacc[int_l_len-3] = APL_NULL_CHAR;
					}		
					else if ( !strcmp(chr_l_instrcode_a,l_dl_localrepproc3_struct_h.h_instr_code) && strncmp(l_dl_localrepproc3_struct_h.h_ctclt,"00",2 ) ) 
					{
						strcpy( chr_l_instrcode_a,l_dl_localrepproc3_struct_h.h_instr_code ) ; 
					}
					

						continue;
					}

               if ( APL_FAILURE == CO_ToStr( l_dom221quantity,25,l_mt_core_sys_params_struct_h.qty_dec_len,chr_l_str_qty ) )
               {
                  CO_ProcMonitor(p_logfile,"CBNumToStr returned failure\n",NULL,NULL);
                  APL_GOBACK_FAIL
               }

               if ( APL_FAILURE == CO_PadString(chr_l_str_qty,'L' , 25," ",l_debug_info_ptr))
               {
                  CO_ProcMonitor(p_logfile,"CBPad_StrFn returned failure \n",NULL,NULL);
                  APL_GOBACK_FAIL
               }

               fprintf(p_oprec_filehandle,"%4s%s"," ",chr_l_str_qty); 

               

               strcpy(chr_l_zero,"0");

               if ( APL_FAILURE == CO_PadString(chr_l_zero,'L' , 25," ",l_debug_info_ptr))
               {
                  CO_ProcMonitor(p_logfile,"CBPad_StrFn returned failure \n",NULL,NULL);
                  APL_GOBACK_FAIL
               }
        
               fprintf(p_oprec_filehandle,"%4s%s\n"," ",chr_l_zero);         
				
				}

				else if ( !strncmp( chr_l_new_ctacc,"222",3 ) )
				{
					
					strncpy(int_l_domcpac,l_dl_localrepproc3_struct_h.h_domcpclt_cd,( strlen(l_dl_localrepproc3_struct_h.h_domcpclt_cd)-3 ));
					l_dom222quantity = 0.0;
					while  ( (!strncmp( int_l_domcpac,l_dl_localrepproc3_struct_h.h_domcpclt_cd,(strlen(l_dl_localrepproc3_struct_h.h_domcpclt_cd)-3) )) && 
                      ( !strncmp( chr_l_new_ctacc,"222",3 )) && 
                      ( !strcmp( chr_l_instrcode_a,l_dl_localrepproc3_struct_h.h_instr_code )) && 
                      ( !strncmp( l_dl_localrepproc3_struct_h.h_ctclt,"00",2 )))
               {
                  l_dom222quantity = l_dom222quantity + l_dl_localrepproc3_struct_h.h_qty ;
                  l_totcredit_ind = l_totcredit_ind + l_dl_localrepproc3_struct_h.h_qty;
					strncpy(int_l_domcpac,l_dl_localrepproc3_struct_h.h_domcpclt_cd,( strlen(l_dl_localrepproc3_struct_h.h_domcpclt_cd)-3 ));

						EXEC SQL FETCH clrproc3_curs
                           INTO :l_dl_localrepproc3_struct_h:l_dl_localrepproc3_struct_i;

                  IS_ANY_ORA_ERROR
		
						if ( APL_ZERO_RESULT_SET )
   	            {
      	            chr_l_nodata = 'Y';
         	         break;
            	    }

 	                chr_l_nodata = 'N';
					
					
					if ( !strcmp(chr_l_instrcode_a,l_dl_localrepproc3_struct_h.h_instr_code) && !strncmp(l_dl_localrepproc3_struct_h.h_ctclt,"00",2 ) ) 
					{
						strcpy( chr_l_instrcode_a,l_dl_localrepproc3_struct_h.h_instr_code ) ; 
						
            		int_l_len = strlen(l_dl_localrepproc3_struct_h.h_ctclt);
            		for ( i=3; i <= int_l_len ; i++ )
            		{
               		chr_l_new_ctacc[i-3] = l_dl_localrepproc3_struct_h.h_ctclt[i] ;
            		}
            		chr_l_new_ctacc[int_l_len-3] = APL_NULL_CHAR;
					}		
					else if ( !strcmp(chr_l_instrcode_a,l_dl_localrepproc3_struct_h.h_instr_code) && strncmp(l_dl_localrepproc3_struct_h.h_ctclt,"00",2 ) ) 
					{
						strcpy( chr_l_instrcode_a,l_dl_localrepproc3_struct_h.h_instr_code ) ; 
					}
					

                  continue;
               }
					
               if ( APL_FAILURE == CO_ToStr( l_dom222quantity,25,l_mt_core_sys_params_struct_h.qty_dec_len,chr_l_str_qty ) )
               {
                  CO_ProcMonitor(p_logfile,"CBNumToStr returned failure\n",NULL,NULL);
                  APL_GOBACK_FAIL
               }

               if ( APL_FAILURE == CO_PadString(chr_l_str_qty,'L' , 25," ",l_debug_info_ptr))
               {
                  CO_ProcMonitor(p_logfile,"CBPad_StrFn returned failure \n",NULL,NULL);
                  APL_GOBACK_FAIL
               }

               strcpy(chr_l_zero,"0");

               if ( APL_FAILURE == CO_PadString(chr_l_zero,'L' , 25," ",l_debug_info_ptr))
               {
                  CO_ProcMonitor(p_logfile,"CBPad_StrFn returned failure \n",NULL,NULL);
                  APL_GOBACK_FAIL
               }
        
               fprintf(p_oprec_filehandle,"%4s%s"," ",chr_l_zero);         

					fprintf(p_oprec_filehandle,"%4s%s\n"," ",chr_l_str_qty); 
					
				}

				else if ( !strncmp( chr_l_new_ctacc,"224",3))
				{
					fprintf(p_logfile,"inside 224\n");
					fprintf(p_logfile,"Value of chr_l_new_ctacc is %s\n",chr_l_new_ctacc);
					
					strncpy(int_l_domcpac,l_dl_localrepproc3_struct_h.h_domcpclt_cd,( strlen(l_dl_localrepproc3_struct_h.h_domcpclt_cd)-3 ));
               l_dom224quantity = 0.0;
               while  ( (!strncmp( int_l_domcpac,l_dl_localrepproc3_struct_h.h_domcpclt_cd,(strlen(l_dl_localrepproc3_struct_h.h_domcpclt_cd)-3) )) &&              
                      ( !strncmp( chr_l_new_ctacc,"224",3 )) &&                
                      ( !strcmp( chr_l_instrcode_a,l_dl_localrepproc3_struct_h.h_instr_code )) &&               
                      ( !strncmp( l_dl_localrepproc3_struct_h.h_ctclt,"00",2 )))             
               {              
                  l_dom224quantity = l_dom224quantity + l_dl_localrepproc3_struct_h.h_qty ;               
                  l_totcredit_ind = l_totcredit_ind + l_dl_localrepproc3_struct_h.h_qty;           
					strncpy(int_l_domcpac,l_dl_localrepproc3_struct_h.h_domcpclt_cd,( strlen(l_dl_localrepproc3_struct_h.h_domcpclt_cd)-3 ));

						EXEC SQL FETCH clrproc3_curs
                           INTO :l_dl_localrepproc3_struct_h:l_dl_localrepproc3_struct_i;

                  IS_ANY_ORA_ERROR

						if ( APL_ZERO_RESULT_SET )
 	               {
    	              chr_l_nodata = 'Y';
      	           break;
         	      }

  	               chr_l_nodata = 'N';
					
					

					if ( !strcmp(chr_l_instrcode_a,l_dl_localrepproc3_struct_h.h_instr_code) && !strncmp(l_dl_localrepproc3_struct_h.h_ctclt,"00",2 ) ) 
					{
						strcpy( chr_l_instrcode_a,l_dl_localrepproc3_struct_h.h_instr_code ) ; 
						
            		int_l_len = strlen(l_dl_localrepproc3_struct_h.h_ctclt);
            		for ( i=3; i <= int_l_len ; i++ )
            		{
               		chr_l_new_ctacc[i-3] = l_dl_localrepproc3_struct_h.h_ctclt[i] ;
            		}
            		chr_l_new_ctacc[int_l_len-3] = APL_NULL_CHAR;
					}		
					else if ( !strcmp(chr_l_instrcode_a,l_dl_localrepproc3_struct_h.h_instr_code) && strncmp(l_dl_localrepproc3_struct_h.h_ctclt,"00",2 ) ) 
					{
						strcpy( chr_l_instrcode_a,l_dl_localrepproc3_struct_h.h_instr_code ) ; 
					}
					
 
                  continue;               
               }              
					
               if ( APL_FAILURE == CO_ToStr( l_dom224quantity,25,l_mt_core_sys_params_struct_h.qty_dec_len,chr_l_str_qty ) )
               {
                  CO_ProcMonitor(p_logfile,"CBNumToStr returned failure\n",NULL,NULL);
                  APL_GOBACK_FAIL
               }

               if ( APL_FAILURE == CO_PadString(chr_l_str_qty,'L' , 25," ",l_debug_info_ptr))
               {
                  CO_ProcMonitor(p_logfile,"CBPad_StrFn returned failure \n",NULL,NULL);
                  APL_GOBACK_FAIL
               }

               strcpy(chr_l_zero,"0");

               if ( APL_FAILURE == CO_PadString(chr_l_zero,'L' , 25," ",l_debug_info_ptr))
               {
                  CO_ProcMonitor(p_logfile,"CBPad_StrFn returned failure \n",NULL,NULL);
                  APL_GOBACK_FAIL
               }
        
               fprintf(p_oprec_filehandle,"%4s%s"," ",chr_l_zero);         

               fprintf(p_oprec_filehandle,"%4s%s\n"," ",chr_l_str_qty); 
				}

				else
				{
               if ( APL_FAILURE == CO_ToStr( l_dl_localrepproc3_struct_h.h_qty,25,l_mt_core_sys_params_struct_h.qty_dec_len,chr_l_str_qty ) )
               {
                  CO_ProcMonitor(p_logfile,"CBNumToStr returned failure\n",NULL,NULL);
                  APL_GOBACK_FAIL
               }

               if ( APL_FAILURE == CO_PadString(chr_l_str_qty,'L' , 25," ",l_debug_info_ptr))
               {
                  CO_ProcMonitor(p_logfile,"CBPad_StrFn returned failure \n",NULL,NULL);
                  APL_GOBACK_FAIL
               }

               

               strcpy(chr_l_zero,"0");

               if ( APL_FAILURE == CO_PadString(chr_l_zero,'L' , 25," ",l_debug_info_ptr))
               {
                  CO_ProcMonitor(p_logfile,"CBPad_StrFn returned failure \n",NULL,NULL);
                  APL_GOBACK_FAIL
               }
        
               fprintf(p_oprec_filehandle,"%4s%s"," ",chr_l_zero);         

               fprintf(p_oprec_filehandle,"%4s%s\n"," ",chr_l_str_qty); 

					l_totcredit_ind = l_totcredit_ind + l_dl_localrepproc3_struct_h.h_qty;

				   EXEC SQL FETCH clrproc3_curs
      				      INTO :l_dl_localrepproc3_struct_h:l_dl_localrepproc3_struct_i;

  					IS_ANY_ORA_ERROR

					if ( APL_ZERO_RESULT_SET )
               {
                  chr_l_nodata = 'Y';
                  break;
               }

               chr_l_nodata = 'N';
					
					strcpy( int_l_domcpac,l_dl_localrepproc3_struct_h.h_domcpclt_cd ) ; 
					if ( !strcmp(chr_l_instrcode_a,l_dl_localrepproc3_struct_h.h_instr_code) && !strncmp(l_dl_localrepproc3_struct_h.h_ctclt,"00",2 ) ) 
					{
						strcpy( chr_l_instrcode_a,l_dl_localrepproc3_struct_h.h_instr_code ) ; 
						
            		int_l_len = strlen(l_dl_localrepproc3_struct_h.h_ctclt);
            		for ( i=3; i <= int_l_len ; i++ )
            		{
               		chr_l_new_ctacc[i-3] = l_dl_localrepproc3_struct_h.h_ctclt[i] ;
            		}
            		chr_l_new_ctacc[int_l_len-3] = APL_NULL_CHAR;
					}		
					else if ( !strcmp(chr_l_instrcode_a,l_dl_localrepproc3_struct_h.h_instr_code) && strncmp(l_dl_localrepproc3_struct_h.h_ctclt,"00",2 ) ) 
					{
						strcpy( chr_l_instrcode_a,l_dl_localrepproc3_struct_h.h_instr_code ) ; 
					}
					

					continue;
				}

			}

			if ( chr_l_firstpg == 'N')
			{
				fprintf(p_oprec_filehandle,"\n");

				i = 0;
				
				for (i = 1;i < 90; i++)  
				{
				  fprintf(p_oprec_filehandle,"%s","-");
				}
				fprintf(p_oprec_filehandle,"\n");

				
				
					
               strcpy( chr_l_str_totdb,ltoa(l_totdebit_ind) );
               strcpy( chr_l_str_totct,ltoa(l_totcredit_ind) );

               if ( APL_FAILURE == CO_PadString(chr_l_str_totdb,'L' , 25," ",l_debug_info_ptr))
               {
                  CO_ProcMonitor(p_logfile,"CBPad_StrFn returned failure \n",NULL,NULL);
                  APL_GOBACK_FAIL
               }

               if ( APL_FAILURE == CO_PadString(chr_l_str_totct,'L' , 25," ",l_debug_info_ptr))
               {
                  CO_ProcMonitor(p_logfile,"CBPad_StrFn returned failure \n",NULL,NULL);
                  APL_GOBACK_FAIL
               }
        
                        
					
               fprintf(p_oprec_filehandle,"%31s%s%4s%s\n"," ",chr_l_str_totdb," ",chr_l_str_totct);         

				chr_l_instr_dtflg = 'N';
 	
				

         IS_ANY_ORA_ERROR;

         fprintf(p_logfile,"\n*********** Now instr_code is :%s: ********\n",chr_l_instrcode_a);
         printf("\n*********** Now instr_code is :%s: ********\n",chr_l_instrcode_a);
			
			

			 
          memset(chr_l_regbrind_a,APL_NULL_CHAR,3);
          EXEC SQL SELECT REG_BR_IND INTO :chr_l_regbrind_a:i_regbrflag
          FROM MT_INSTRUMENT
          WHERE INSTR_CODE = :chr_l_instrcode_a;

          IS_ANY_ORA_ERROR

           //if(chr_l_regbrind_a=="RG") //AIX Warning Removal
           if(strcmp(chr_l_regbrind_a,"RG") == 0)
           {
			      EXEC SQL SELECT DECODE(MAX(INSTRUMENT_DT),NULL,MAX(LRINSTR_DATE),MAX(INSTRUMENT_DT))
                    INTO :chr_l_maxinstr_dt:i_maxinstr_dt
                    FROM DL_DEAL
                   WHERE INSTR_CODE = :chr_l_instrcode_a
                     AND (INSTRUMENT_DT IS NOT NULL OR (FAILREASON_CD='60' AND DEAL_STAT='CC' AND EX_ARENA !='3' )) 
                     AND CLIENT NOT IN ('100000' , '100001')
                     
                     AND LR_DL_CLASS NOT IN ('07','09','13','15','18','20')
                     AND ((TO_CHAR(INSTRUMENT_DT,'MMYYYY') = ( SELECT TO_CHAR(SYS_DATE,'MMYYYY') FROM PRO_SYS_DATE ))
                         OR (FAILREASON_CD='60' AND DEAL_STAT='CC' AND EX_ARENA !='3' AND
                           (TO_CHAR(ACCESS_STAMP,'MMYYYY') = ( SELECT TO_CHAR(SYS_DATE,'MMYYYY') FROM PRO_SYS_DATE ))))
                     AND DL_DEAL.ROWID NOT IN ( SELECT a.ROWID FROM DL_DEAL a, MT_CLIENT b, MT_INSTRUMENT c
                                                WHERE a.INSTR_CODE = :chr_l_instrcode_a  
                                                  AND b.CLN_CODE = a.CLIENT
                                                  AND b.COUNTRY NOT IN ('PO','PL')
                                                  AND c.INSTR_CODE = a.INSTR_CODE
                                                  AND c.LOCATION_CD = 'NDS'
                                                  AND c.PROD_CLASS = '2' );

				if ( sqlca.sqlcode != -1405 )
				{
					IS_ANY_ORA_ERROR
				}
				
				if (i_maxinstr_dt == -1 )
				{
					strcpy(chr_l_maxinstr_dt, APL_NULL_STRING);
				}

				if ( i_maxinstr_dt == 0)
				{
					EXEC SQL UPDATE MT_INSTRUMENT
					SET LR_SETL_DATE_A = :chr_l_maxinstr_dt:i_maxinstr_dt
					WHERE INSTR_CODE = :chr_l_instrcode_a; ;

					IS_ANY_ORA_ERROR
				}
				else
				{
					EXEC SQL SELECT LR_SETL_DATE_A INTO :chr_l_lrsettledt1:i_lrsetldt1
					FROM MT_INSTRUMENT
					WHERE INSTR_CODE = :chr_l_instrcode_a;
					
					IS_ANY_ORA_ERROR
				
					if ( i_lrsetldt1 == -1 )
					{
						fprintf(p_logfile,"LRSETTLEDT1 NOT FOUND ,FOR OTHER ACCOUNT ,FOR INSTR_CODE = %s",chr_l_instrcode_a );
						APL_GOBACK_FAIL
					}
				   else
					{
						strcpy( chr_l_maxinstr_dt, chr_l_lrsettledt1);
					}			
				}
				
				
				fprintf(p_oprec_filehandle,"\n\n");
				
				
				sscanf(chr_l_maxinstr_dt, "%[^ ]", chr_l_new_maxinstr_dt);
				fprintf(p_oprec_filehandle,"OSTATNI WYCIAG Z DNIA - %s\n",chr_l_new_maxinstr_dt);
				
            fprintf(p_oprec_filehandle,"SALDO 924 00 09    :  %.0lf\n",l_tot210); 
           }
          else
           {
				 memset(chr_l_maxinstr_dt, APL_NULL_CHAR, APL_DATE_LEN);
				 i_maxinstr_dt=0;
			    EXEC SQL SELECT DECODE(MAX(INSTRUMENT_DT),NULL,MAX(LRINSTR_DATE),MAX(INSTRUMENT_DT))
                    INTO :chr_l_maxinstr_dt:i_maxinstr_dt
                    FROM DL_DEAL, MT_CLIENT
                   WHERE INSTR_CODE = :chr_l_instrcode_a
                     AND (INSTRUMENT_DT IS NOT NULL OR (FAILREASON_CD='60' AND DEAL_STAT='CC' AND EX_ARENA !='3' )) 
                     AND DL_DEAL.CLIENT NOT IN ('100000' , '100001')
                     AND LR_DL_CLASS NOT IN ('07','09','13','15','18','20')
                     AND ((TO_CHAR(INSTRUMENT_DT,'MMYYYY') = ( SELECT TO_CHAR(SYS_DATE,'MMYYYY') FROM PRO_SYS_DATE ))
                         OR (FAILREASON_CD='60' AND DEAL_STAT='CC'  AND EX_ARENA !='3'  AND 
                         (TO_CHAR(DL_DEAL.ACCESS_STAMP,'MMYYYY') = ( SELECT TO_CHAR(SYS_DATE,'MMYYYY') FROM PRO_SYS_DATE ))))
                     AND DL_DEAL.ROWID NOT IN ( SELECT a.ROWID FROM DL_DEAL a, MT_CLIENT b, MT_INSTRUMENT c
                                                WHERE a.INSTR_CODE = :chr_l_instrcode_a  
                                                  AND b.CLN_CODE = a.CLIENT
                                                  AND b.COUNTRY NOT IN ('PO','PL')
                                                  AND c.INSTR_CODE = a.INSTR_CODE
                                                  AND c.LOCATION_CD = 'NDS'
                                                  AND c.PROD_CLASS = '2' )
						   AND DL_DEAL.CLIENT = MT_CLIENT.CLN_CODE
							AND (MT_CLIENT.CLN_CLASS != 'N' OR (MT_CLIENT.CLN_CLASS ='N' AND MT_CLIENT.CLN_OUR_THEIR_IND ='T'));


				if ( sqlca.sqlcode != -1405 )
				{
					IS_ANY_ORA_ERROR
				}
				
				if (i_maxinstr_dt == -1 )
				{
					strcpy(chr_l_maxinstr_dt, APL_NULL_STRING);
				}

				if ( i_maxinstr_dt == 0)
				{
					EXEC SQL UPDATE MT_INSTRUMENT
					SET LR_SETL_DATE_A = :chr_l_maxinstr_dt:i_maxinstr_dt
					WHERE INSTR_CODE = :chr_l_instrcode_a; ;

					IS_ANY_ORA_ERROR
				}
				else
				{
					EXEC SQL SELECT LR_SETL_DATE_A INTO :chr_l_lrsettledt1:i_lrsetldt1
					FROM MT_INSTRUMENT
					WHERE INSTR_CODE = :chr_l_instrcode_a;
					
					IS_ANY_ORA_ERROR
				
					if ( i_lrsetldt1 == -1 )
					{
						fprintf(p_logfile,"LRSETTLEDT1 NOT FOUND ,FOR OTHER ACCOUNT ,FOR INSTR_CODE = %s",chr_l_instrcode_a );
						APL_GOBACK_FAIL
					}
				   else
					{
						strcpy( chr_l_maxinstr_dt, chr_l_lrsettledt1);
					}			
				}
				
				
				fprintf(p_oprec_filehandle,"\n\n");
				
				
				sscanf(chr_l_maxinstr_dt, "%[^ ]", chr_l_new_maxinstr_dt);
				fprintf(p_oprec_filehandle,"OSTATNI WYCIAG Z DNIA - %s\n",chr_l_new_maxinstr_dt);
				
            fprintf(p_oprec_filehandle,"SALDO 924 00 00    :  %.0lf\n",l_tot210_F5); 
				
				
				memset(chr_l_maxinstr_dt, APL_NULL_CHAR, APL_DATE_LEN);
				i_maxinstr_dt=0;
				EXEC SQL SELECT DECODE(MAX(INSTRUMENT_DT),NULL,MAX(LRINSTR_DATE),MAX(INSTRUMENT_DT))
                        INTO :chr_l_maxinstr_dt:i_maxinstr_dt
                        FROM DL_DEAL , MT_CLIENT
                       WHERE INSTR_CODE = :chr_l_instrcode_a
                         AND (INSTRUMENT_DT IS NOT NULL OR (FAILREASON_CD='60' AND DEAL_STAT='CC' AND EX_ARENA !='3' )) 
                         AND DL_DEAL.CLIENT NOT IN ('100000' , '100001')
                         AND LR_DL_CLASS NOT IN ('07','09','13','15','18','20')
                         AND ((TO_CHAR(INSTRUMENT_DT,'MMYYYY') = ( SELECT TO_CHAR(SYS_DATE,'MMYYYY') FROM PRO_SYS_DATE ))
                               OR (FAILREASON_CD='60' AND DEAL_STAT='CC' AND EX_ARENA !='3' AND
                          (TO_CHAR(DL_DEAL.ACCESS_STAMP,'MMYYYY') = ( SELECT TO_CHAR(SYS_DATE,'MMYYYY') FROM PRO_SYS_DATE ))))
                         AND DL_DEAL.ROWID NOT IN ( SELECT a.ROWID FROM DL_DEAL a, MT_CLIENT b, MT_INSTRUMENT c
                                                    WHERE a.INSTR_CODE = :chr_l_instrcode_a  
                                                      AND b.CLN_CODE = a.CLIENT
                                                      AND b.COUNTRY NOT IN ('PO','PL')
                                                      AND c.INSTR_CODE = a.INSTR_CODE
                                                      AND c.LOCATION_CD = 'NDS'
                                                      AND c.PROD_CLASS = '2' )
								 AND DL_DEAL.CLIENT = MT_CLIENT.CLN_CODE
								 AND MT_CLIENT.CLN_CLASS = 'N'
								 AND MT_CLIENT.CLN_OUR_THEIR_IND = 'O';

				if ( sqlca.sqlcode != -1405 )
				{
					IS_ANY_ORA_ERROR
				}
				
				if (i_maxinstr_dt == -1 )
				{
					strcpy(chr_l_maxinstr_dt, APL_NULL_STRING);
				}

				if ( i_maxinstr_dt == 0)
				{
					EXEC SQL UPDATE MT_INSTRUMENT
					SET VALID_IPO_DATE = :chr_l_maxinstr_dt:i_maxinstr_dt
					WHERE INSTR_CODE = :chr_l_instrcode_a; ;

					IS_ANY_ORA_ERROR
				}
				else
				{
					EXEC SQL SELECT VALID_IPO_DATE INTO :chr_l_lrsettledt1:i_lrsetldt1
					FROM MT_INSTRUMENT
					WHERE INSTR_CODE = :chr_l_instrcode_a;
					
					IS_ANY_ORA_ERROR
				
					if ( i_lrsetldt1 == -1 )
					{
						fprintf(p_logfile,"LRSETTLEDT1 NOT FOUND ,FOR OTHER ACCOUNT ,FOR INSTR_CODE = %s",chr_l_instrcode_a );
						APL_GOBACK_FAIL
					}
				   else
					{
						strcpy( chr_l_maxinstr_dt, chr_l_lrsettledt1);
					}			
				}
				
				
				fprintf(p_oprec_filehandle,"\n\n");
				
				
				sscanf(chr_l_maxinstr_dt, "%[^ ]", chr_l_new_maxinstr_dt);
				fprintf(p_oprec_filehandle,"OSTATNI WYCIAG Z DNIA - %s\n",chr_l_new_maxinstr_dt);
				
            fprintf(p_oprec_filehandle,"SALDO 924 00 20    :  %.0lf\n",l_tot210_NP); 
          }
			}
				
			l_totdebit_ind  = 0.0;
			l_totcredit_ind  = 0.0;
			l_tot210 = 0.0;
			l_tot210_NP=0.0;
			l_tot210_F5=0.0;

			strcpy( chr_l_ctcate	,"10");
			chr_l_firstpg = 'Y';
			int_l_pgno++ ;

			
			strcpy( int_l_domcpac,l_dl_localrepproc3_struct_h.h_domcpclt_cd ) ; 
			strcpy( chr_l_instrcode_a,l_dl_localrepproc3_struct_h.h_instr_code ) ; 
			strcpy( chr_l_new_ctacc,l_dl_localrepproc3_struct_h.h_ctclt ) ; 
			

			
			while ( !strcmp( l_dl_localrepproc3_struct_h.h_instr_code,chr_l_instrcode_a ) && !strncmp(l_dl_localrepproc3_struct_h.h_ctclt,"10",2 ) )
			{
				if ( chr_l_nodata == 'Y' )
            {
               break;
            }

				if ( chr_l_firstpg == 'Y' )
				{
					fprintf( p_oprec_filehandle,"\f");
					CBLRBalRecHdrPrnFn(p_procdate,chr_l_instrcode_a,int_l_pgno,2,p_oprec_filehandle,p_logfile,l_debug_info_ptr);
					chr_l_firstpg = 'N';
				}	
            strcpy(chr_l_temp_ctacc,l_dl_localrepproc3_struct_h.h_ctclt);

            if ( APL_FAILURE == CO_PadString(chr_l_temp_ctacc,'R' , 13," ",l_debug_info_ptr))
            {
              CO_ProcMonitor(p_logfile,"CBPad_StrFn returned failure\n",NULL,NULL);
              APL_GOBACK_FAIL
            }

            
				
				int_l_len = strlen(l_dl_localrepproc3_struct_h.h_ctclt);
            for ( i=3; i <= int_l_len ; i++ )
            {
					chr_l_new_ctacc[i-3] = l_dl_localrepproc3_struct_h.h_ctclt[i] ;
				}
				chr_l_new_ctacc[int_l_len-3] = APL_NULL_CHAR;
				
				memset(chr_l_temp_domcpac, APL_NULL_CHAR,11);
				if ( ( !strncmp(chr_l_new_ctacc,"221",3 )) || ( !strncmp(chr_l_new_ctacc,"222",3 )) || ( !strncmp(chr_l_new_ctacc,"224",3 )) )
					strncpy(chr_l_temp_domcpac,l_dl_localrepproc3_struct_h.h_domcpclt_cd,( strlen(l_dl_localrepproc3_struct_h.h_domcpclt_cd)-3 ));
				else
					strcpy(chr_l_temp_domcpac,l_dl_localrepproc3_struct_h.h_domcpclt_cd);
				
				if ( strlen( chr_l_temp_domcpac ) == 0 )
            {
               strcpy(chr_l_temp_domcpac,"          ");
            }
            else
            {
            	if ( APL_FAILURE == CO_PadString(chr_l_temp_domcpac,'R' , 10," ",l_debug_info_ptr))
            	{
              		CO_ProcMonitor(p_logfile,"CBPad_StrFn returned failure \n",NULL,NULL);
              		APL_GOBACK_FAIL
            	}
				}

            fprintf(p_oprec_filehandle,"\n");
            fprintf(p_oprec_filehandle,"%s",chr_l_temp_ctacc);           
				
				if ( strcmp(l_dl_localrepproc3_struct_h.h_domcpclt_cd, l_mt_core_sys_params_struct_h.custody_clt_cd)== 0 )
				   fprintf(p_oprec_filehandle,"%4s924       "," ");	
				else  
               fprintf(p_oprec_filehandle,"%4s%s"," ",chr_l_temp_domcpac);  

            

            

            if ( !strncmp(chr_l_new_ctacc,"210",3 ))
            {
               if ( APL_FAILURE == CO_ToStr( l_dl_localrepproc3_struct_h.h_qty,25,l_mt_core_sys_params_struct_h.qty_dec_len,chr_l_str_qty ) )
               {
                  CO_ProcMonitor(p_logfile,"CBNumToStr returned failure\n",NULL,NULL);
                  APL_GOBACK_FAIL
               }

               if ( APL_FAILURE == CO_PadString(chr_l_str_qty,'L' , 25," ",l_debug_info_ptr))
               {
                  CO_ProcMonitor(p_logfile,"CBPad_StrFn returned failure \n",NULL,NULL);
                  APL_GOBACK_FAIL
               }

               fprintf(p_oprec_filehandle,"%4s%s"," ",chr_l_str_qty);
               

               strcpy(chr_l_zero,"0");

               if ( APL_FAILURE == CO_PadString(chr_l_zero,'L' , 25," ",l_debug_info_ptr))
               {
                  CO_ProcMonitor(p_logfile,"CBPad_StrFn returned failure \n",NULL,NULL);
                  APL_GOBACK_FAIL
               }
              fprintf(p_oprec_filehandle,"%4s%s\n"," ",chr_l_zero);         

               l_totdebit_ind = l_totdebit_ind + l_dl_localrepproc3_struct_h.h_qty;
               l_tot210 = l_tot210 + l_dl_localrepproc3_struct_h.h_qty;

					for ( i=7; i <= int_l_len ; i++ )				
					{
						chr_l_temp_ctacc[i-7] = l_dl_localrepproc3_struct_h.h_ctclt[i] ;
					}
					chr_l_temp_ctacc[int_l_len-7] = APL_NULL_CHAR;

					if ( !strncmp(chr_l_temp_ctacc,"00",2) )
					{
						i_9241000 = i_9241000 +l_dl_localrepproc3_struct_h.h_qty;	
					}
					else if ( !strncmp(chr_l_temp_ctacc,"09",2) )
					{
						i_9241009 = i_9241009 +l_dl_localrepproc3_struct_h.h_qty; 
					}
					else if ( !strncmp(chr_l_temp_ctacc,"06",2) )
					{
						i_9241006 = i_9241006 +l_dl_localrepproc3_struct_h.h_qty; 
					}

					EXEC SQL FETCH clrproc3_curs
                     INTO :l_dl_localrepproc3_struct_h:l_dl_localrepproc3_struct_i;

          	   IS_ANY_ORA_ERROR

               if ( APL_ZERO_RESULT_SET )
               {
                  chr_l_nodata = 'Y';
                  break;
               }

               chr_l_nodata = 'N';
					
					strcpy( int_l_domcpac,l_dl_localrepproc3_struct_h.h_domcpclt_cd ) ; 
					if ( !strcmp(chr_l_instrcode_a,l_dl_localrepproc3_struct_h.h_instr_code) && !strncmp(l_dl_localrepproc3_struct_h.h_ctclt,"10",2 ) ) 
					{
						strcpy( chr_l_instrcode_a,l_dl_localrepproc3_struct_h.h_instr_code ) ; 
					
						int_l_len = strlen(l_dl_localrepproc3_struct_h.h_ctclt);
            		for ( i=3; i <= int_l_len ; i++ )
            		{
							chr_l_new_ctacc[i-3] = l_dl_localrepproc3_struct_h.h_ctclt[i] ;
						}
						chr_l_new_ctacc[int_l_len-3] = APL_NULL_CHAR;
					}		
					else if ( !strcmp(chr_l_instrcode_a,l_dl_localrepproc3_struct_h.h_instr_code) && strncmp(l_dl_localrepproc3_struct_h.h_ctclt,"10",2 ) ) 
					{
						strcpy( chr_l_instrcode_a,l_dl_localrepproc3_struct_h.h_instr_code ) ; 
					}
					

               continue;
            }
				else if ( !strncmp(chr_l_new_ctacc,"221",3 ))
				{
               
					strncpy(int_l_domcpac,l_dl_localrepproc3_struct_h.h_domcpclt_cd,( strlen(l_dl_localrepproc3_struct_h.h_domcpclt_cd)-3 ));
               l_dom221quantity = 0.0;
					
               while  ( (!strncmp( int_l_domcpac,l_dl_localrepproc3_struct_h.h_domcpclt_cd,(strlen(l_dl_localrepproc3_struct_h.h_domcpclt_cd)-3) )) && 
                      ( !strncmp( chr_l_new_ctacc,"221",3 )) && 
                      ( !strcmp( chr_l_instrcode_a,l_dl_localrepproc3_struct_h.h_instr_code )) && 
                      ( !strncmp( l_dl_localrepproc3_struct_h.h_ctclt,"10",2 )))
               {
                  l_dom221quantity = l_dom221quantity + l_dl_localrepproc3_struct_h.h_qty ;
                  l_totdebit_ind = l_totdebit_ind + l_dl_localrepproc3_struct_h.h_qty;
					strncpy(int_l_domcpac,l_dl_localrepproc3_struct_h.h_domcpclt_cd,( strlen(l_dl_localrepproc3_struct_h.h_domcpclt_cd)-3 ));

						EXEC SQL FETCH clrproc3_curs
                     INTO :l_dl_localrepproc3_struct_h:l_dl_localrepproc3_struct_i;

            		IS_ANY_ORA_ERROR
 	               if ( APL_ZERO_RESULT_SET )
   	            {
      	            chr_l_nodata = 'Y';
         	         break;
            	   }

  	               chr_l_nodata = 'N';
					
					
					if ( !strcmp(chr_l_instrcode_a,l_dl_localrepproc3_struct_h.h_instr_code) && !strncmp(l_dl_localrepproc3_struct_h.h_ctclt,"10",2 ) ) 
					{
						strcpy( chr_l_instrcode_a,l_dl_localrepproc3_struct_h.h_instr_code ) ; 
						
						int_l_len = strlen(l_dl_localrepproc3_struct_h.h_ctclt);
            		for ( i=3; i <= int_l_len ; i++ )
            		{
							chr_l_new_ctacc[i-3] = l_dl_localrepproc3_struct_h.h_ctclt[i] ;
						}
						chr_l_new_ctacc[int_l_len-3] = APL_NULL_CHAR;
					}		
					else if ( !strcmp(chr_l_instrcode_a,l_dl_localrepproc3_struct_h.h_instr_code) && strncmp(l_dl_localrepproc3_struct_h.h_ctclt,"10",2 ) ) 
					{
						strcpy( chr_l_instrcode_a,l_dl_localrepproc3_struct_h.h_instr_code ) ; 
					}
					
					

                  continue;
               }
               if ( APL_FAILURE == CO_ToStr( l_dom221quantity,25,l_mt_core_sys_params_struct_h.qty_dec_len,chr_l_str_qty ) )
               {
                  CO_ProcMonitor(p_logfile,"CBNumToStr returned failure\n",NULL,NULL);
                  APL_GOBACK_FAIL
               }

               if ( APL_FAILURE == CO_PadString(chr_l_str_qty,'L' , 25," ",l_debug_info_ptr))
               {
                  CO_ProcMonitor(p_logfile,"CBPad_StrFn returned failure \n",NULL,NULL);
                  APL_GOBACK_FAIL
               }

               fprintf(p_oprec_filehandle,"%4s%s"," ",chr_l_str_qty); 
               
					strncpy(int_l_domcpac,l_dl_localrepproc3_struct_h.h_domcpclt_cd,( strlen(l_dl_localrepproc3_struct_h.h_domcpclt_cd)-3 ));
               l_dom222quantity = 0.0;
               while  ( (!strncmp( int_l_domcpac,l_dl_localrepproc3_struct_h.h_domcpclt_cd ,(strlen(l_dl_localrepproc3_struct_h.h_domcpclt_cd)-3))) &&
                      ( !strncmp( chr_l_new_ctacc,"222",3 )) &&
                      ( !strcmp( chr_l_instrcode_a,l_dl_localrepproc3_struct_h.h_instr_code )) &&
                      ( !strncmp( l_dl_localrepproc3_struct_h.h_ctclt,"10",2 )))
               {
                  l_dom222quantity = l_dom222quantity + l_dl_localrepproc3_struct_h.h_qty ;
                  l_totcredit_ind = l_totcredit_ind + l_dl_localrepproc3_struct_h.h_qty;
					strncpy(int_l_domcpac,l_dl_localrepproc3_struct_h.h_domcpclt_cd,( strlen(l_dl_localrepproc3_struct_h.h_domcpclt_cd)-3 ));

						EXEC SQL FETCH clrproc3_curs
                     INTO :l_dl_localrepproc3_struct_h:l_dl_localrepproc3_struct_i;

                  IS_ANY_ORA_ERROR
		
						if ( APL_ZERO_RESULT_SET )
                  {
                     chr_l_nodata = 'Y';
                     break;
                  }

                  chr_l_nodata = 'N';
					
					
					if ( !strcmp(chr_l_instrcode_a,l_dl_localrepproc3_struct_h.h_instr_code) && !strncmp(l_dl_localrepproc3_struct_h.h_ctclt,"10",2 ) ) 
					{
						strcpy( chr_l_instrcode_a,l_dl_localrepproc3_struct_h.h_instr_code ) ; 
						
						int_l_len = strlen(l_dl_localrepproc3_struct_h.h_ctclt);
            		for ( i=3; i <= int_l_len ; i++ )
            		{
							chr_l_new_ctacc[i-3] = l_dl_localrepproc3_struct_h.h_ctclt[i] ;
						}
						chr_l_new_ctacc[int_l_len-3] = APL_NULL_CHAR;
					}		
					else if ( !strcmp(chr_l_instrcode_a,l_dl_localrepproc3_struct_h.h_instr_code) && strncmp(l_dl_localrepproc3_struct_h.h_ctclt,"10",2 ) ) 
					{
						strcpy( chr_l_instrcode_a,l_dl_localrepproc3_struct_h.h_instr_code ) ; 
					}
						
                  continue;
               }
               if ( APL_FAILURE == CO_ToStr( l_dom222quantity,25,l_mt_core_sys_params_struct_h.qty_dec_len,chr_l_str_qty ) )
               {
                  CO_ProcMonitor(p_logfile,"CBNumToStr returned failure\n",NULL,NULL);
                  APL_GOBACK_FAIL
               }

               if ( APL_FAILURE == CO_PadString(chr_l_str_qty,'L' , 25," ",l_debug_info_ptr))
               {
                  CO_ProcMonitor(p_logfile,"CBPad_StrFn returned failure \n",NULL,NULL);
                  APL_GOBACK_FAIL
               }

               
               strcpy(chr_l_zero,"0");

               if ( APL_FAILURE == CO_PadString(chr_l_zero,'L' , 25," ",l_debug_info_ptr))
               {
                  CO_ProcMonitor(p_logfile,"CBPad_StrFn returned failure \n",NULL,NULL);
                  APL_GOBACK_FAIL
               }

               fprintf(p_oprec_filehandle,"%4s%s"," ",chr_l_zero);         

               fprintf(p_oprec_filehandle,"%4s%s\n"," ",chr_l_str_qty); 
            }

            else if(!strncmp( chr_l_new_ctacc,"224",3))
            {
               
					strncpy(int_l_domcpac,l_dl_localrepproc3_struct_h.h_domcpclt_cd,( strlen(l_dl_localrepproc3_struct_h.h_domcpclt_cd)-3 ));
               l_dom224quantity = 0.0;
               while  ( (!strncmp( int_l_domcpac,l_dl_localrepproc3_struct_h.h_domcpclt_cd,(strlen(l_dl_localrepproc3_struct_h.h_domcpclt_cd)-3) )) &&
                      ( !strncmp( chr_l_new_ctacc,"224",3 )) &&
                      ( !strcmp( chr_l_instrcode_a,l_dl_localrepproc3_struct_h.h_instr_code )) &&
                      ( !strncmp( l_dl_localrepproc3_struct_h.h_ctclt,"10",2 )))
               {
                  l_dom224quantity = l_dom224quantity + l_dl_localrepproc3_struct_h.h_qty ;
                  l_totcredit_ind = l_totcredit_ind + l_dl_localrepproc3_struct_h.h_qty;

					strncpy(int_l_domcpac,l_dl_localrepproc3_struct_h.h_domcpclt_cd,( strlen(l_dl_localrepproc3_struct_h.h_domcpclt_cd)-3 ));
						EXEC SQL FETCH clrproc3_curs
                     INTO :l_dl_localrepproc3_struct_h:l_dl_localrepproc3_struct_i;

                  IS_ANY_ORA_ERROR

						if ( APL_ZERO_RESULT_SET )
                  {
                     chr_l_nodata = 'Y';
                     break;
                  }

                  chr_l_nodata = 'N';
					
					
					if ( !strcmp(chr_l_instrcode_a,l_dl_localrepproc3_struct_h.h_instr_code) && !strncmp(l_dl_localrepproc3_struct_h.h_ctclt,"10",2 ) ) 
					{
						strcpy( chr_l_instrcode_a,l_dl_localrepproc3_struct_h.h_instr_code ) ; 
						
						int_l_len = strlen(l_dl_localrepproc3_struct_h.h_ctclt);
            		for ( i=3; i <= int_l_len ; i++ )
            		{
							chr_l_new_ctacc[i-3] = l_dl_localrepproc3_struct_h.h_ctclt[i] ;
						}
						chr_l_new_ctacc[int_l_len-3] = APL_NULL_CHAR;
					}		
					else if ( !strcmp(chr_l_instrcode_a,l_dl_localrepproc3_struct_h.h_instr_code) && strncmp(l_dl_localrepproc3_struct_h.h_ctclt,"10",2 ) ) 
					{
						strcpy( chr_l_instrcode_a,l_dl_localrepproc3_struct_h.h_instr_code ) ; 
					}
					

					

						continue;
               }
               if ( APL_FAILURE == CO_ToStr( l_dom224quantity,25,l_mt_core_sys_params_struct_h.qty_dec_len,chr_l_str_qty ) )
               {
                  CO_ProcMonitor(p_logfile,"CBNumToStr returned failure\n",NULL,NULL);
                  APL_GOBACK_FAIL
               }

               if ( APL_FAILURE == CO_PadString(chr_l_str_qty,'L' , 25," ",l_debug_info_ptr))
               {
                  CO_ProcMonitor(p_logfile,"CBPad_StrFn returned failure \n",NULL,NULL);
                  APL_GOBACK_FAIL
               }

               

               strcpy(chr_l_zero,"0");

               if ( APL_FAILURE == CO_PadString(chr_l_zero,'L' , 25," ",l_debug_info_ptr))
               {
                  CO_ProcMonitor(p_logfile,"CBPad_StrFn returned failure \n",NULL,NULL);
                  APL_GOBACK_FAIL
               }

               fprintf(p_oprec_filehandle,"%4s%s"," ",chr_l_zero);         

               fprintf(p_oprec_filehandle,"%4s%s\n"," ",chr_l_str_qty); 

            }
            else
            {
               if ( APL_FAILURE == CO_ToStr( l_dl_localrepproc3_struct_h.h_qty,25,l_mt_core_sys_params_struct_h.qty_dec_len,chr_l_str_qty ) )
               {
                  CO_ProcMonitor(p_logfile,"CBNumToStr returned failure\n",NULL,NULL);
                  APL_GOBACK_FAIL
               }

               if ( APL_FAILURE == CO_PadString(chr_l_str_qty,'L' , 25," ",l_debug_info_ptr))
               {
                  CO_ProcMonitor(p_logfile,"CBPad_StrFn returned failure \n",NULL,NULL);
                  APL_GOBACK_FAIL
               }

               

               strcpy(chr_l_zero,"0");

               if ( APL_FAILURE == CO_PadString(chr_l_zero,'L' , 25," ",l_debug_info_ptr))
               {
                  CO_ProcMonitor(p_logfile,"CBPad_StrFn returned failure \n",NULL,NULL);
                  APL_GOBACK_FAIL
               }

               fprintf(p_oprec_filehandle,"%4s%s"," ",chr_l_zero);         

               fprintf(p_oprec_filehandle,"%4s%s\n"," ",chr_l_str_qty); 

               l_totcredit_ind = l_totcredit_ind + l_dl_localrepproc3_struct_h.h_qty;

					EXEC SQL FETCH clrproc3_curs
      	      			INTO :l_dl_localrepproc3_struct_h:l_dl_localrepproc3_struct_i;

  	            IS_ANY_ORA_ERROR

					if ( APL_ZERO_RESULT_SET )
					{
						chr_l_nodata = 'Y';
						break;
					}

					chr_l_nodata = 'N';
					
					strcpy( int_l_domcpac,l_dl_localrepproc3_struct_h.h_domcpclt_cd ) ; 
					if ( !strcmp(chr_l_instrcode_a,l_dl_localrepproc3_struct_h.h_instr_code) && !strncmp(l_dl_localrepproc3_struct_h.h_ctclt,"10",2 ) ) 
					{
						strcpy( chr_l_instrcode_a,l_dl_localrepproc3_struct_h.h_instr_code ) ; 
						
						int_l_len = strlen(l_dl_localrepproc3_struct_h.h_ctclt);
            		for ( i=3; i <= int_l_len ; i++ )
            		{
							chr_l_new_ctacc[i-3] = l_dl_localrepproc3_struct_h.h_ctclt[i] ;
						}
						chr_l_new_ctacc[int_l_len-3] = APL_NULL_CHAR;
					}		
					else if ( !strcmp(chr_l_instrcode_a,l_dl_localrepproc3_struct_h.h_instr_code) && strncmp(l_dl_localrepproc3_struct_h.h_ctclt,"10",2 ) ) 
					{
						strcpy( chr_l_instrcode_a,l_dl_localrepproc3_struct_h.h_instr_code ) ; 
					}
					

 	           continue;
				}

			}
			
			if ( chr_l_firstpg == 'N')
			{
				fprintf(p_oprec_filehandle,"\n");
            i = 0;
            
				for (i = 1;i < 90; i++) 
            {
              fprintf(p_oprec_filehandle,"%s","-");
            }
            fprintf(p_oprec_filehandle,"\n");
            

               
               strcpy( chr_l_str_totdb,ltoa(l_totdebit_ind) );
               strcpy( chr_l_str_totct,ltoa(l_totcredit_ind) );

               if ( APL_FAILURE == CO_PadString(chr_l_str_totdb,'L' , 25," ",l_debug_info_ptr))
               {
                  CO_ProcMonitor(p_logfile,"CBPad_StrFn returned failure \n",NULL,NULL);
                  APL_GOBACK_FAIL
               }

               if ( APL_FAILURE == CO_PadString(chr_l_str_totct,'L' , 25," ",l_debug_info_ptr))
               {
                  CO_ProcMonitor(p_logfile,"CBPad_StrFn returned failure \n",NULL,NULL);
                  APL_GOBACK_FAIL
               }

                        
					

					fprintf(p_oprec_filehandle,"%31s%s%4s%s\n"," ",chr_l_str_totdb," ",chr_l_str_totct);

            chr_l_instr_dtflg = 'N';

 	
				
            EXEC SQL SELECT DECODE(MAX(INSTRUMENT_DT),NULL,MAX(LRINSTR_DATE),MAX(INSTRUMENT_DT)) INTO :chr_l_maxinstr_dt:i_maxinstr_dt
			            FROM DL_DEAL
         			   WHERE INSTR_CODE = :chr_l_instrcode_a
            			AND (INSTRUMENT_DT IS NOT NULL OR (FAILREASON_CD='60' AND DEAL_STAT='CC' AND LRINSTR_DATE IS NULL AND EX_ARENA !='3' ))
            			AND CLIENT IN ('100000' , '100001') 
            			
            			AND LR_DL_CLASS NOT IN ('07','09','13','15','18','20')
            			AND TO_CHAR(INSTRUMENT_DT,'MMYYYY') = ( SELECT TO_CHAR(SYS_DATE,'MMYYYY') FROM PRO_SYS_DATE );
				

				if ( sqlca.sqlcode != -1405 )
				{
            	IS_ANY_ORA_ERROR
				}

				if ( i_maxinstr_dt == -1 )
				{
					strcpy(chr_l_maxinstr_dt, APL_NULL_STRING);
				}

            if ( i_maxinstr_dt == 0)
            {
               EXEC SQL UPDATE MT_INSTRUMENT
               SET LR_SETL_DATE_B = :chr_l_maxinstr_dt:i_maxinstr_dt
					WHERE INSTR_CODE = :chr_l_instrcode_a; 

               IS_ANY_ORA_ERROR
            }
            else
            {
               EXEC SQL SELECT LR_SETL_DATE_B INTO :chr_l_lrsettledt2:i_lrsetldt2
               FROM MT_INSTRUMENT
               WHERE INSTR_CODE = :chr_l_instrcode_a;

               IS_ANY_ORA_ERROR

               if ( i_lrsetldt2 == -1 )
               {
                  fprintf(p_logfile,"LRSETTLEDT2 NOT FOUND ,FOR OWN ACCOUNT ,FOR INSTR_CODE = %s",chr_l_instrcode_a );
						
                  
						strcpy( chr_l_maxinstr_dt, chr_h_system_date);
                  
						
               }
               else
               {
                  strcpy( chr_l_maxinstr_dt, chr_l_lrsettledt2);
               }

            }

				fprintf(p_oprec_filehandle,"\n\n");
				
				
				
				sscanf(chr_l_maxinstr_dt, "%[^ ]", chr_l_new_maxinstr_dt);
				fprintf(p_oprec_filehandle,"OSTATNI WYCIAG Z DNIA - %s\n",chr_l_new_maxinstr_dt);
				

				
				if ( i_9241000 > 0 )
				{
					fprintf(p_oprec_filehandle,"SALDO 924 10 00   :   %.0lf\n",i_9241000);
				}
				else if ( i_9241009 > 0 )
				{
					fprintf(p_oprec_filehandle,"SALDO 924 10 09   :   %.0lf\n",i_9241009);
				}
				else if ( i_9241006 > 0 )
				{
					fprintf(p_oprec_filehandle,"SALDO 924 10 06    :  %.0lf\n",i_9241006);
				}

			} 

			

			l_totdebit_ind  = 0.0;
			l_totcredit_ind  = 0.0;
			l_tot210 = 0.0;

			strcpy( chr_l_ctcate	,"20");
			chr_l_firstpg = 'Y';
			int_l_pgno++ ;

			strcpy( int_l_domcpac,l_dl_localrepproc3_struct_h.h_domcpclt_cd ) ; 
			strcpy( chr_l_instrcode_a,l_dl_localrepproc3_struct_h.h_instr_code ) ; 
			strcpy( chr_l_new_ctacc,l_dl_localrepproc3_struct_h.h_ctclt ) ; 

			

			while ( !strcmp(chr_l_instrcode_a,l_dl_localrepproc3_struct_h.h_instr_code) && !strncmp(l_dl_localrepproc3_struct_h.h_ctclt,"20",2 ) ) 
			{
				if ( chr_l_nodata == 'Y' )
				{
					break;
				}

				if ( chr_l_firstpg == 'Y' )
				{
					CBLRBalRecHdrPrnFn(p_procdate,chr_l_instrcode_a,int_l_pgno,3,p_oprec_filehandle,p_logfile,l_debug_info_ptr);
					chr_l_firstpg = 'N';
				}

				strcpy(chr_l_temp_ctacc,l_dl_localrepproc3_struct_h.h_ctclt);

				if ( APL_FAILURE == CO_PadString(chr_l_temp_ctacc,'R' , 13," ",l_debug_info_ptr))
            {
              CO_ProcMonitor(p_logfile,"CBPad_StrFn returned failure\n",NULL,NULL);
              APL_GOBACK_FAIL
            }
		
				
				int_l_len = strlen(l_dl_localrepproc3_struct_h.h_ctclt);
				for ( i=3; i <= int_l_len ; i++ )
				{
					chr_l_new_ctacc[i-3] = l_dl_localrepproc3_struct_h.h_ctclt[i] ;
				}
				chr_l_new_ctacc[int_l_len-3] = APL_NULL_CHAR;
            
				
				memset(chr_l_temp_domcpac, APL_NULL_CHAR,11);
				if ( ( !strncmp(chr_l_new_ctacc,"221",3 )) || 
					  ( !strncmp(chr_l_new_ctacc,"222",3 )) || 
					  ( !strncmp(chr_l_new_ctacc,"224",3 )) )
				   strncpy(chr_l_temp_domcpac,l_dl_localrepproc3_struct_h.h_domcpclt_cd,( strlen(l_dl_localrepproc3_struct_h.h_domcpclt_cd)-3 ));
		      else	
					strcpy(chr_l_temp_domcpac,l_dl_localrepproc3_struct_h.h_domcpclt_cd);

				if ( strlen( chr_l_temp_domcpac ) == 0 )
				{
					strcpy(chr_l_temp_domcpac,"          ");
				}
				else
				{
   	         if ( APL_FAILURE == CO_PadString(chr_l_temp_domcpac,'R' , 10," ",l_debug_info_ptr))
      	      {
         	     CO_ProcMonitor(p_logfile,"CBPad_StrFn returned failure \n",NULL,NULL);
            	  APL_GOBACK_FAIL
            	}
				 }

				fprintf(p_oprec_filehandle,"\n");
				fprintf(p_oprec_filehandle,"%s",chr_l_temp_ctacc); 				
				
				if ( strcmp(l_dl_localrepproc3_struct_h.h_domcpclt_cd, l_mt_core_sys_params_struct_h.custody_clt_cd)== 0 )
				   fprintf(p_oprec_filehandle,"%4s924       "," ");	
				else  
				   fprintf(p_oprec_filehandle,"%4s%s"," ",chr_l_temp_domcpac);	

				

				

				if ( !strncmp(chr_l_new_ctacc,"210",3 ))
				{
			      if ( APL_FAILURE == CO_ToStr( l_dl_localrepproc3_struct_h.h_qty,25,l_mt_core_sys_params_struct_h.qty_dec_len,chr_l_str_qty ) )
      			{
						CO_ProcMonitor(p_logfile,"CBNumToStr returned failure\n",NULL,NULL);
						APL_GOBACK_FAIL
      			}

					if ( APL_FAILURE == CO_PadString(chr_l_str_qty,'L' , 25," ",l_debug_info_ptr))
 				   {
						CO_ProcMonitor(p_logfile,"CBPad_StrFn returned failure \n",NULL,NULL);
						APL_GOBACK_FAIL
   				}

					fprintf(p_oprec_filehandle,"%4s%s"," ",chr_l_str_qty); 

					strcpy(chr_l_zero,"0");

					if ( APL_FAILURE == CO_PadString(chr_l_zero,'L' , 25," ",l_debug_info_ptr))
 				   {
						CO_ProcMonitor(p_logfile,"CBPad_StrFn returned failure \n",NULL,NULL);
						APL_GOBACK_FAIL
   				}
					
					fprintf(p_oprec_filehandle,"%4s%s"," ",chr_l_zero);			
					l_totdebit_ind = l_totdebit_ind + l_dl_localrepproc3_struct_h.h_qty;
					l_tot210 = l_tot210 + l_dl_localrepproc3_struct_h.h_qty;

		         EXEC SQL FETCH clrproc3_curs
      				      INTO :l_dl_localrepproc3_struct_h:l_dl_localrepproc3_struct_i;

					IS_ANY_ORA_ERROR
				
					if ( APL_ZERO_RESULT_SET )
               {
                  chr_l_nodata = 'Y';
                  break;
               }

               chr_l_nodata = 'N';
					
					strcpy( int_l_domcpac,l_dl_localrepproc3_struct_h.h_domcpclt_cd ) ; 
					if ( !strcmp(chr_l_instrcode_a,l_dl_localrepproc3_struct_h.h_instr_code) && !strncmp(l_dl_localrepproc3_struct_h.h_ctclt,"20",2 ) ) 
					{
						strcpy( chr_l_instrcode_a,l_dl_localrepproc3_struct_h.h_instr_code ) ; 
						
            		int_l_len = strlen(l_dl_localrepproc3_struct_h.h_ctclt);
            		for ( i=3; i <= int_l_len ; i++ )
            		{
               		chr_l_new_ctacc[i-3] = l_dl_localrepproc3_struct_h.h_ctclt[i] ;
            		}
            		chr_l_new_ctacc[int_l_len-3] = APL_NULL_CHAR;
					}		
					else if ( !strcmp(chr_l_instrcode_a,l_dl_localrepproc3_struct_h.h_instr_code) && strncmp(l_dl_localrepproc3_struct_h.h_ctclt,"20",2 ) ) 
					{
						strcpy( chr_l_instrcode_a,l_dl_localrepproc3_struct_h.h_instr_code ) ; 
					}
					
					continue;
				}

				else if ( !strncmp( chr_l_new_ctacc,"221",3 ) )	
				{
					
					strncpy(int_l_domcpac,l_dl_localrepproc3_struct_h.h_domcpclt_cd,( strlen(l_dl_localrepproc3_struct_h.h_domcpclt_cd)-3 ));
					l_dom221quantity = 0.0;
					while  ( (!strncmp( int_l_domcpac,l_dl_localrepproc3_struct_h.h_domcpclt_cd, (strlen(l_dl_localrepproc3_struct_h.h_domcpclt_cd)-3) )) && 
							 ( !strncmp( chr_l_new_ctacc,"221",3 )) && 
						 	 ( !strcmp( chr_l_instrcode_a,l_dl_localrepproc3_struct_h.h_instr_code )) && 
							 ( !strncmp( l_dl_localrepproc3_struct_h.h_ctclt,"20",2 )))
					{
						l_dom221quantity = l_dom221quantity + l_dl_localrepproc3_struct_h.h_qty ;
						l_totdebit_ind = l_totdebit_ind + l_dl_localrepproc3_struct_h.h_qty;
					strncpy(int_l_domcpac,l_dl_localrepproc3_struct_h.h_domcpclt_cd,( strlen(l_dl_localrepproc3_struct_h.h_domcpclt_cd)-3 ));

 	               EXEC SQL FETCH clrproc3_curs
                           INTO :l_dl_localrepproc3_struct_h:l_dl_localrepproc3_struct_i;

                  IS_ANY_ORA_ERROR

						if ( APL_ZERO_RESULT_SET )
 	               {
    	              chr_l_nodata = 'Y';
      	            break;
         	       }

                  chr_l_nodata = 'N';

					
					
					if ( !strcmp(chr_l_instrcode_a,l_dl_localrepproc3_struct_h.h_instr_code) && !strncmp(l_dl_localrepproc3_struct_h.h_ctclt,"20",2 ) ) 
					{
						strcpy( chr_l_instrcode_a,l_dl_localrepproc3_struct_h.h_instr_code ) ; 
						
            		int_l_len = strlen(l_dl_localrepproc3_struct_h.h_ctclt);
            		for ( i=3; i <= int_l_len ; i++ )
            		{
               		chr_l_new_ctacc[i-3] = l_dl_localrepproc3_struct_h.h_ctclt[i] ;
            		}
            		chr_l_new_ctacc[int_l_len-3] = APL_NULL_CHAR;
					}		
					else if ( !strcmp(chr_l_instrcode_a,l_dl_localrepproc3_struct_h.h_instr_code) && strncmp(l_dl_localrepproc3_struct_h.h_ctclt,"20",2 ) ) 
					{
						strcpy( chr_l_instrcode_a,l_dl_localrepproc3_struct_h.h_instr_code ) ; 
					}
					

						continue;
					}

               if ( APL_FAILURE == CO_ToStr( l_dom221quantity,25,l_mt_core_sys_params_struct_h.qty_dec_len,chr_l_str_qty ) )
               {
                  CO_ProcMonitor(p_logfile,"CBNumToStr returned failure\n",NULL,NULL);
                  APL_GOBACK_FAIL
               }

               if ( APL_FAILURE == CO_PadString(chr_l_str_qty,'L' , 25," ",l_debug_info_ptr))
               {
                  CO_ProcMonitor(p_logfile,"CBPad_StrFn returned failure \n",NULL,NULL);
                  APL_GOBACK_FAIL
               }

               fprintf(p_oprec_filehandle,"%4s%s"," ",chr_l_str_qty); 

               

               strcpy(chr_l_zero,"0");

               if ( APL_FAILURE == CO_PadString(chr_l_zero,'L' , 25," ",l_debug_info_ptr))
               {
                  CO_ProcMonitor(p_logfile,"CBPad_StrFn returned failure \n",NULL,NULL);
                  APL_GOBACK_FAIL
               }
        
               fprintf(p_oprec_filehandle,"%4s%s\n"," ",chr_l_zero);         
				
				}

				else if ( !strncmp( chr_l_new_ctacc,"222",3 ) )
				{
					
					strncpy(int_l_domcpac,l_dl_localrepproc3_struct_h.h_domcpclt_cd,( strlen(l_dl_localrepproc3_struct_h.h_domcpclt_cd)-3 ));
					l_dom222quantity = 0.0;
					while  ( (!strncmp( int_l_domcpac,l_dl_localrepproc3_struct_h.h_domcpclt_cd,(strlen(l_dl_localrepproc3_struct_h.h_domcpclt_cd)-3) )) && 
                      ( !strncmp( chr_l_new_ctacc,"222",3 )) && 
                      ( !strcmp( chr_l_instrcode_a,l_dl_localrepproc3_struct_h.h_instr_code )) && 
                      ( !strncmp( l_dl_localrepproc3_struct_h.h_ctclt,"20",2 )))
               {
                  l_dom222quantity = l_dom222quantity + l_dl_localrepproc3_struct_h.h_qty ;
                  l_totcredit_ind = l_totcredit_ind + l_dl_localrepproc3_struct_h.h_qty;
					strncpy(int_l_domcpac,l_dl_localrepproc3_struct_h.h_domcpclt_cd,( strlen(l_dl_localrepproc3_struct_h.h_domcpclt_cd)-3 ));

						EXEC SQL FETCH clrproc3_curs
                           INTO :l_dl_localrepproc3_struct_h:l_dl_localrepproc3_struct_i;

                  IS_ANY_ORA_ERROR
		
						if ( APL_ZERO_RESULT_SET )
   	            {
      	            chr_l_nodata = 'Y';
         	         break;
            	    }

 	                chr_l_nodata = 'N';
					
					
					if ( !strcmp(chr_l_instrcode_a,l_dl_localrepproc3_struct_h.h_instr_code) && !strncmp(l_dl_localrepproc3_struct_h.h_ctclt,"20",2 ) ) 
					{
						strcpy( chr_l_instrcode_a,l_dl_localrepproc3_struct_h.h_instr_code ) ; 
						
            		int_l_len = strlen(l_dl_localrepproc3_struct_h.h_ctclt);
            		for ( i=3; i <= int_l_len ; i++ )
            		{
               		chr_l_new_ctacc[i-3] = l_dl_localrepproc3_struct_h.h_ctclt[i] ;
            		}
            		chr_l_new_ctacc[int_l_len-3] = APL_NULL_CHAR;
					}		
					else if ( !strcmp(chr_l_instrcode_a,l_dl_localrepproc3_struct_h.h_instr_code) && strncmp(l_dl_localrepproc3_struct_h.h_ctclt,"20",2 ) ) 
					{
						strcpy( chr_l_instrcode_a,l_dl_localrepproc3_struct_h.h_instr_code ) ; 
					}
					

                  continue;
               }
					
               if ( APL_FAILURE == CO_ToStr( l_dom222quantity,25,l_mt_core_sys_params_struct_h.qty_dec_len,chr_l_str_qty ) )
               {
                  CO_ProcMonitor(p_logfile,"CBNumToStr returned failure\n",NULL,NULL);
                  APL_GOBACK_FAIL
               }

               if ( APL_FAILURE == CO_PadString(chr_l_str_qty,'L' , 25," ",l_debug_info_ptr))
               {
                  CO_ProcMonitor(p_logfile,"CBPad_StrFn returned failure \n",NULL,NULL);
                  APL_GOBACK_FAIL
               }

               strcpy(chr_l_zero,"0");

               if ( APL_FAILURE == CO_PadString(chr_l_zero,'L' , 25," ",l_debug_info_ptr))
               {
                  CO_ProcMonitor(p_logfile,"CBPad_StrFn returned failure \n",NULL,NULL);
                  APL_GOBACK_FAIL
               }
        
               fprintf(p_oprec_filehandle,"%4s%s"," ",chr_l_zero);         

					fprintf(p_oprec_filehandle,"%4s%s\n"," ",chr_l_str_qty); 
					
				}

				else if ( !strncmp( chr_l_new_ctacc,"224",3))
				{
					fprintf(p_logfile,"inside 224\n");
					fprintf(p_logfile,"Value of chr_l_new_ctacc is %s\n",chr_l_new_ctacc);
					
					strncpy(int_l_domcpac,l_dl_localrepproc3_struct_h.h_domcpclt_cd,( strlen(l_dl_localrepproc3_struct_h.h_domcpclt_cd)-3 ));
               l_dom224quantity = 0.0;
               while  ( (!strncmp( int_l_domcpac,l_dl_localrepproc3_struct_h.h_domcpclt_cd,(strlen(l_dl_localrepproc3_struct_h.h_domcpclt_cd)-3) )) &&              
                      ( !strncmp( chr_l_new_ctacc,"224",3 )) &&                
                      ( !strcmp( chr_l_instrcode_a,l_dl_localrepproc3_struct_h.h_instr_code )) &&               
                      ( !strncmp( l_dl_localrepproc3_struct_h.h_ctclt,"20",2 )))             
               {              
                  l_dom224quantity = l_dom224quantity + l_dl_localrepproc3_struct_h.h_qty ;               
                  l_totcredit_ind = l_totcredit_ind + l_dl_localrepproc3_struct_h.h_qty;           
					strncpy(int_l_domcpac,l_dl_localrepproc3_struct_h.h_domcpclt_cd,( strlen(l_dl_localrepproc3_struct_h.h_domcpclt_cd)-3 ));

						EXEC SQL FETCH clrproc3_curs
                           INTO :l_dl_localrepproc3_struct_h:l_dl_localrepproc3_struct_i;

                  IS_ANY_ORA_ERROR

						if ( APL_ZERO_RESULT_SET )
 	               {
    	              chr_l_nodata = 'Y';
      	           break;
         	      }

  	               chr_l_nodata = 'N';
					
					

					if ( !strcmp(chr_l_instrcode_a,l_dl_localrepproc3_struct_h.h_instr_code) && !strncmp(l_dl_localrepproc3_struct_h.h_ctclt,"20",2 ) ) 
					{
						strcpy( chr_l_instrcode_a,l_dl_localrepproc3_struct_h.h_instr_code ) ; 
						
            		int_l_len = strlen(l_dl_localrepproc3_struct_h.h_ctclt);
            		for ( i=3; i <= int_l_len ; i++ )
            		{
               		chr_l_new_ctacc[i-3] = l_dl_localrepproc3_struct_h.h_ctclt[i] ;
            		}
            		chr_l_new_ctacc[int_l_len-3] = APL_NULL_CHAR;
					}		
					else if ( !strcmp(chr_l_instrcode_a,l_dl_localrepproc3_struct_h.h_instr_code) && strncmp(l_dl_localrepproc3_struct_h.h_ctclt,"20",2 ) ) 
					{
						strcpy( chr_l_instrcode_a,l_dl_localrepproc3_struct_h.h_instr_code ) ; 
					}
					
 
                  continue;               
               }              
					
               if ( APL_FAILURE == CO_ToStr( l_dom224quantity,25,l_mt_core_sys_params_struct_h.qty_dec_len,chr_l_str_qty ) )
               {
                  CO_ProcMonitor(p_logfile,"CBNumToStr returned failure\n",NULL,NULL);
                  APL_GOBACK_FAIL
               }

               if ( APL_FAILURE == CO_PadString(chr_l_str_qty,'L' , 25," ",l_debug_info_ptr))
               {
                  CO_ProcMonitor(p_logfile,"CBPad_StrFn returned failure \n",NULL,NULL);
                  APL_GOBACK_FAIL
               }

               strcpy(chr_l_zero,"0");

               if ( APL_FAILURE == CO_PadString(chr_l_zero,'L' , 25," ",l_debug_info_ptr))
               {
                  CO_ProcMonitor(p_logfile,"CBPad_StrFn returned failure \n",NULL,NULL);
                  APL_GOBACK_FAIL
               }
        
               fprintf(p_oprec_filehandle,"%4s%s"," ",chr_l_zero);         

               fprintf(p_oprec_filehandle,"%4s%s\n"," ",chr_l_str_qty); 
				}

				else
				{
               if ( APL_FAILURE == CO_ToStr( l_dl_localrepproc3_struct_h.h_qty,25,l_mt_core_sys_params_struct_h.qty_dec_len,chr_l_str_qty ) )
               {
                  CO_ProcMonitor(p_logfile,"CBNumToStr returned failure\n",NULL,NULL);
                  APL_GOBACK_FAIL
               }

               if ( APL_FAILURE == CO_PadString(chr_l_str_qty,'L' , 25," ",l_debug_info_ptr))
               {
                  CO_ProcMonitor(p_logfile,"CBPad_StrFn returned failure \n",NULL,NULL);
                  APL_GOBACK_FAIL
               }

               

               strcpy(chr_l_zero,"0");

               if ( APL_FAILURE == CO_PadString(chr_l_zero,'L' , 25," ",l_debug_info_ptr))
               {
                  CO_ProcMonitor(p_logfile,"CBPad_StrFn returned failure \n",NULL,NULL);
                  APL_GOBACK_FAIL
               }
        
               fprintf(p_oprec_filehandle,"%4s%s"," ",chr_l_zero);         

               fprintf(p_oprec_filehandle,"%4s%s\n"," ",chr_l_str_qty); 

					l_totcredit_ind = l_totcredit_ind + l_dl_localrepproc3_struct_h.h_qty;

				   EXEC SQL FETCH clrproc3_curs
      				      INTO :l_dl_localrepproc3_struct_h:l_dl_localrepproc3_struct_i;

  					IS_ANY_ORA_ERROR

					if ( APL_ZERO_RESULT_SET )
               {
                  chr_l_nodata = 'Y';
                  break;
               }

               chr_l_nodata = 'N';
					
					strcpy( int_l_domcpac,l_dl_localrepproc3_struct_h.h_domcpclt_cd ) ; 
					if ( !strcmp(chr_l_instrcode_a,l_dl_localrepproc3_struct_h.h_instr_code) && !strncmp(l_dl_localrepproc3_struct_h.h_ctclt,"20",2 ) ) 
					{
						strcpy( chr_l_instrcode_a,l_dl_localrepproc3_struct_h.h_instr_code ) ; 
						
            		int_l_len = strlen(l_dl_localrepproc3_struct_h.h_ctclt);
            		for ( i=3; i <= int_l_len ; i++ )
            		{
               		chr_l_new_ctacc[i-3] = l_dl_localrepproc3_struct_h.h_ctclt[i] ;
            		}
            		chr_l_new_ctacc[int_l_len-3] = APL_NULL_CHAR;
					}		
					else if ( !strcmp(chr_l_instrcode_a,l_dl_localrepproc3_struct_h.h_instr_code) && strncmp(l_dl_localrepproc3_struct_h.h_ctclt,"20",2 ) ) 
					{
						strcpy( chr_l_instrcode_a,l_dl_localrepproc3_struct_h.h_instr_code ) ; 
					}
					

					continue;
				}

			}

			if ( chr_l_firstpg == 'N')
			{
				fprintf(p_oprec_filehandle,"\n");

				i = 0;
				
				for (i = 1;i < 90; i++)  
				{
				  fprintf(p_oprec_filehandle,"%s","-");
				}
				fprintf(p_oprec_filehandle,"\n");

				
				
					
               strcpy( chr_l_str_totdb,ltoa(l_totdebit_ind) );
               strcpy( chr_l_str_totct,ltoa(l_totcredit_ind) );

               if ( APL_FAILURE == CO_PadString(chr_l_str_totdb,'L' , 25," ",l_debug_info_ptr))
               {
                  CO_ProcMonitor(p_logfile,"CBPad_StrFn returned failure \n",NULL,NULL);
                  APL_GOBACK_FAIL
               }

               if ( APL_FAILURE == CO_PadString(chr_l_str_totct,'L' , 25," ",l_debug_info_ptr))
               {
                  CO_ProcMonitor(p_logfile,"CBPad_StrFn returned failure \n",NULL,NULL);
                  APL_GOBACK_FAIL
               }
        
                        
					
               fprintf(p_oprec_filehandle,"%31s%s%4s%s\n"," ",chr_l_str_totdb," ",chr_l_str_totct);         

				chr_l_instr_dtflg = 'N';
 	
				

         IS_ANY_ORA_ERROR;

         fprintf(p_logfile,"\n*********** Now instr_code is :%s: ********\n",chr_l_instrcode_a);
         printf("\n*********** Now instr_code is :%s: ********\n",chr_l_instrcode_a);

			

				EXEC SQL SELECT DECODE(MAX(INSTRUMENT_DT),NULL,MAX(LRINSTR_DATE),MAX(INSTRUMENT_DT))
                      INTO :chr_l_maxinstr_dt:i_maxinstr_dt
                     FROM DL_DEAL
                     WHERE INSTR_CODE = :chr_l_instrcode_a
                     AND (INSTRUMENT_DT IS NOT NULL OR (FAILREASON_CD='60' AND DEAL_STAT='CC' AND EX_ARENA !='3' ))
                     AND CLIENT NOT IN ('100000' , '100001')
                     AND LR_DL_CLASS NOT IN ('07','09','13','15','18','20')
                     AND ((TO_CHAR(INSTRUMENT_DT,'MMYYYY') = ( SELECT TO_CHAR(SYS_DATE,'MMYYYY') FROM PRO_SYS_DATE ))
                           OR (FAILREASON_CD='60' AND DEAL_STAT='CC' AND EX_ARENA !='3'  AND
                           (TO_CHAR(ACCESS_STAMP,'MMYYYY') = ( SELECT TO_CHAR(SYS_DATE,'MMYYYY') FROM PRO_SYS_DATE ))))
                     AND DL_DEAL.ROWID IN ( SELECT a.ROWID FROM DL_DEAL a, MT_CLIENT b, MT_INSTRUMENT c
                                            WHERE a.INSTR_CODE = :chr_l_instrcode_a
                                              AND b.CLN_CODE = a.CLIENT
                                              AND b.COUNTRY NOT IN ('PO','PL')
                                              AND c.INSTR_CODE = a.INSTR_CODE
                                              AND c.LOCATION_CD = 'NDS'
                                              AND c.PROD_CLASS = '2' );
				if ( sqlca.sqlcode != -1405 )
				{
					IS_ANY_ORA_ERROR
				}
				
				if (i_maxinstr_dt == -1 )
				{
					strcpy(chr_l_maxinstr_dt, APL_NULL_STRING);
				}

				if ( i_maxinstr_dt == 0)
				{
					;
					EXEC SQL UPDATE MT_INSTRUMENT
					SET LR_SETL_DATE_C = :chr_l_maxinstr_dt:i_maxinstr_dt
					WHERE INSTR_CODE = :chr_l_instrcode_a; ;

					IS_ANY_ORA_ERROR
				}
				else
				{
					
					EXEC SQL SELECT LR_SETL_DATE_C INTO :chr_l_lrsettledt1:i_lrsetldt1
					FROM MT_INSTRUMENT
					WHERE INSTR_CODE = :chr_l_instrcode_a;
					
					IS_ANY_ORA_ERROR
				
					if ( i_lrsetldt1 == -1 )
					{
						fprintf(p_logfile,"LRSETTLEDT3 NOT FOUND ,FOR OTHER ACCOUNT ,FOR INSTR_CODE = %s",chr_l_instrcode_a );
						APL_GOBACK_FAIL
					}
				   else
					{
						strcpy( chr_l_maxinstr_dt, chr_l_lrsettledt1);
					}			
				}
				
				
				fprintf(p_oprec_filehandle,"\n\n");
				
				
				sscanf(chr_l_maxinstr_dt, "%[^ ]", chr_l_new_maxinstr_dt);
				fprintf(p_oprec_filehandle,"OSTATNI WYCIAG Z DNIA - %s\n",chr_l_new_maxinstr_dt);
				
            memset(chr_l_regbrind_a,APL_NULL_CHAR,3);
            EXEC SQL SELECT REG_BR_IND INTO :chr_l_regbrind_a:i_regbrflag
            FROM MT_INSTRUMENT
            WHERE INSTR_CODE = :chr_l_instrcode_a;

            IS_ANY_ORA_ERROR

            //if(chr_l_regbrind_a=="RG") //AIX Warning Removal
            if(strcmp(chr_l_regbrind_a,"RG") == 0)
            {
               fprintf(p_oprec_filehandle,"SALDO 924 20 09    :  %.0lf\n",l_tot210); 
            }
            else
            {
               fprintf(p_oprec_filehandle,"SALDO 924 20 00    :  %.0lf\n",l_tot210); 
            }
			}

			i_9241000 = 0.0;
			i_9241006 = 0.0;
			i_9241009 = 0.0;
			strcpy( chr_l_maxinstr_dt, chr_h_system_date);			 

			continue;

	}

	EXEC SQL CLOSE clrproc3_curs;
	IS_ANY_ORA_ERROR

	APL_GOBACK_SUCCESS
	
  	RETURN_SUCCESS :
	{
		CO_ProcMonitor(   p_logfile, "Exiting CBLRBalRepFn processtion successfully\n", NULL, NULL);
		APL_IF_DEBUG
		{
			fprintf(APL_OUT_FILE,"Exiting CBLRBalRepFn successfully\n");
		}
		return(APL_SUCCESS);
	}

	RETURN_FAILURE :
	{
		CO_ProcMonitor(   p_logfile, "Exiting CBLRBalRepFn processtion with Failure\n", NULL, NULL);
		APL_IF_DEBUG
		{
			fprintf(APL_OUT_FILE,"Exiting CBLRBalRepFn with errors\n");
		}
		return(APL_FAILURE);
	}
}




int CBLRErrRepHdrFn(char *chr_p_err_filedesc,
							FILE *p_err_filehandle,
							short p_pgno, 
							FILE *p_logfile,
							DEBUG_INFO_STRUCT_H **l_debug_info_ptr)
{
	short i = 0;	
	CO_ProcMonitor(   p_logfile, "Entered CBLRErrRepHdrFn \n", NULL, NULL);

	fprintf(p_err_filehandle,"%55s%s %u\n"," ","STRONA ",p_pgno);
	fprintf(p_err_filehandle,"%s\n%s\n","Bank Handlowy w Warszawie S.A.","924");
	for (i = 1; i < 135; i++)
	{
		fprintf(p_err_filehandle,"%s","-");
	}
	fprintf(p_err_filehandle,"\n");
	i = 0;
	fprintf(p_err_filehandle,"%s\n",chr_p_err_filedesc); 
	fprintf(p_err_filehandle,"%s\n","LISTA NIEDOPASOWANYCH TRANZAKCJI");
	for (i = 1; i < 135; i++)
	{
		fprintf(p_err_filehandle,"%s","-");
	}
	fprintf(p_err_filehandle,"\n");
	i = 0;
	fprintf(p_err_filehandle,"%-16s\n","KONTO");
	fprintf(p_err_filehandle,"%-20s%-20s%-81s%-s\n","Debet","Kredyt","Opis Operacji","Ilosc");
	for (i = 1; i < 135; i++)
	{
		fprintf(p_err_filehandle,"%s","-");
	}
	fprintf(p_err_filehandle,"\n");
   CO_ProcMonitor( p_logfile, "Exiting CBLRErrRepHdrFn processtion with Success.\n", NULL, NULL);	
	return(APL_SUCCESS);
}



int CBLROpRecHdrPrnFn(char *chr_p_instrdesc, 
								char *chr_p_isin, 
								short p_pgno,
								short p_heading,
								char *chr_p_oprec_filedesc,
								FILE *p_oprec_filehandle,
								FILE *p_logfile,
								DEBUG_INFO_STRUCT_H **l_debug_info_ptr)
{
	short i = 0;	
	
	char chr_h_sys_datetime[APL_DATE_LEN]          = APL_NULL_STRING;

	CO_ProcMonitor(   p_logfile, "Entered CBLROpRecHdrPrnFn \n", NULL, NULL);

   if (APL_FAILURE == CO_RtvSysDtTime(chr_h_sys_datetime,
                                       l_debug_info_ptr) )
   {
      return(APL_FAILURE);
   }

	fprintf(p_oprec_filehandle,"%55s%s %u\n"," ","STRONA ",p_pgno);
	if ( p_heading == 1 )
	{
		fprintf(p_oprec_filehandle,"%s\n","Bank Handlowy w Warszawie S.A.");
		fprintf(p_oprec_filehandle,"00 924%105s%s\n"," ",chr_h_sys_datetime);
	}
	else if ( p_heading == 2 )
	{
		fprintf(p_oprec_filehandle,"%s\n","Bank Handlowy w Warszawie S.A.");
		fprintf(p_oprec_filehandle,"10 924%105s%s\n"," ",chr_h_sys_datetime);
	}
	else if ( p_heading == 3 )
	{
		fprintf(p_oprec_filehandle,"%s\n","Bank Handlowy w Warszawie S.A.");
		fprintf(p_oprec_filehandle,"20 924%105s%s\n"," ",chr_h_sys_datetime);
	}
	else
	{
		fprintf(p_oprec_filehandle,"%s\n","Bank Handlowy w Warszawie S.A.");
		fprintf(p_oprec_filehandle,"%113s%s"," ",chr_h_sys_datetime);
	}
	for (i = 1; i < 135; i++)
	{
		fprintf(p_oprec_filehandle,"%s","-");
	}
	fprintf(p_oprec_filehandle,"\n");
	i = 0;
	fprintf(p_oprec_filehandle,"%s\n",chr_p_oprec_filedesc); 
	fprintf(p_oprec_filehandle,"%s%s\n","WALOR : ",chr_p_instrdesc);
	fprintf(p_oprec_filehandle,"%8s%s\n"," ",chr_p_isin);
	for (i = 1; i < 135; i++)
	{
		fprintf(p_oprec_filehandle,"%s","-");
	}
	fprintf(p_oprec_filehandle,"\n");
	i = 0;
	fprintf(p_oprec_filehandle,"%16s\n","KONTO");
	
	fprintf(p_oprec_filehandle,"%-4s  %-25s%-25s%-81s%s\n","Lp.","Debet","Kredyt","Opis Operacji","Ilosc");//AIX Warning Removal
	for (i = 1; i < 145; i++)
	{
		fprintf(p_oprec_filehandle,"%s","-");
	}
	fprintf(p_oprec_filehandle,"\n");

	CO_ProcMonitor(   p_logfile, "Leaving CBLROpRecHdrPrnFn Successfully\n", NULL, NULL);
	return (APL_SUCCESS);
}
	



int CBLRBalRecHdrPrnFn(char *p_procdate,
								char *p_instr_code,
								short p_pgno,
								int	p_heading,
								FILE *p_oprec_filehandle, 
								FILE *p_logfile,
								DEBUG_INFO_STRUCT_H **l_debug_info_ptr)
{
	short i = 0;
	char chr_p_instrdesc[131] = APL_NULL_STRING;
	char chr_p_isin[13] = APL_NULL_STRING;
	char	chr_h_sys_datetime[APL_DATE_LEN]	= APL_NULL_STRING;
	
	APL_IF_DEBUG
	{
		fprintf(APL_OUT_FILE,"Entered CBLRBalRecHdrPrnFn \n");
	}
	CO_ProcMonitor(   p_logfile, "Entered CBLRBalRecHdrPrnFn \n", NULL, NULL);
	
	if (APL_FAILURE == CR_Rtv_LRInstrDesc(p_instr_code,chr_p_instrdesc,chr_p_isin,l_debug_info_ptr))
	{
		APL_GOBACK_FAIL
	}

	if ( APL_FAILURE == CO_RtvSysDtTime( chr_h_sys_datetime, l_debug_info_ptr ) )
	{
		APL_GOBACK_FAIL
	}

	if ( p_pgno != 1 )
	{
		fprintf(p_oprec_filehandle,"\f");  
   }	
	fprintf(p_oprec_filehandle,"\n"); 
	fprintf(p_oprec_filehandle,"%55s%s %u\n"," ","STRONA ",p_pgno);
	if ( p_heading == 1 )
	{
		fprintf(p_oprec_filehandle,"%s\n","Bank Handlowy w Warszawie S.A.");
		fprintf(p_oprec_filehandle,"00 924%50s%s\n"," ",chr_h_sys_datetime);
	}
	else if ( p_heading == 2 )
	{
		fprintf(p_oprec_filehandle,"%s\n","Bank Handlowy w Warszawie S.A.");
		fprintf(p_oprec_filehandle,"10 924%50s%s\n"," ",chr_h_sys_datetime);
	}
	else if ( p_heading == 3 )
	{
		fprintf(p_oprec_filehandle,"%s\n","Bank Handlowy w Warszawie S.A.");
		fprintf(p_oprec_filehandle,"20 924%50s%s\n"," ",chr_h_sys_datetime);
	}
	else
	{
		fprintf(p_oprec_filehandle,"%s\n","Bank Handlowy w Warszawie S.A.");
		fprintf(p_oprec_filehandle,"%50s%s\n"," ",chr_h_sys_datetime);
	}
	for (i = 1; i < 90; i++)
	{
		fprintf(p_oprec_filehandle,"%s","-");
	}
	fprintf(p_oprec_filehandle,"\n");
	i = 0;
	fprintf(p_oprec_filehandle,"%s%.10s\n","Bilans Dzienny z dnia - ",p_procdate); 
	fprintf(p_oprec_filehandle,"%s%s\n","WALOR : ",chr_p_instrdesc);
	fprintf(p_oprec_filehandle,"%8s%s\n"," ",chr_p_isin);
	for (i = 1; i < 90; i++)
	{
		fprintf(p_oprec_filehandle,"%s","-");
	}
	fprintf(p_oprec_filehandle,"\n");
	i = 0;
	fprintf(p_oprec_filehandle,"%-29s","KONTO");
	fprintf(p_oprec_filehandle,"%25s%s%20s%s\n"," ","Debet"," ","Kredyt");
	for (i = 1; i < 90; i++)
	{
		fprintf(p_oprec_filehandle,"%s","-");
	}
	fprintf(p_oprec_filehandle,"\n");


	APL_GOBACK_SUCCESS
	
  	RETURN_SUCCESS :
	{
	   CO_ProcMonitor(   p_logfile, "Leaving CBLRBalRecHdrPrnFn with Success\n", NULL, NULL);	
		APL_IF_DEBUG
		{
			fprintf(APL_OUT_FILE,"Exiting CBLRBalRecHdrPrnFn successfully\n");
		}
		return(APL_SUCCESS);
	}

	RETURN_FAILURE :
	{
		CO_ProcMonitor(   p_logfile, "Leaving CBLRBalRecHdrPrnFn with Failure\n", NULL, NULL);
		APL_IF_DEBUG
		{
			fprintf(APL_OUT_FILE,"Exiting CBLRBalRecHdrPrnFn with errors\n");
		}
		return(APL_FAILURE);
	}
}
	




int CBLREmptyHdrPrnFn(char *p_procdate,
								char *chr_p_oprec_filedesc,
								FILE *p_oprec_filehandle,
								FILE *p_logfile,
								DEBUG_INFO_STRUCT_H **l_debug_info_ptr)
{
	short i = 0;	
	CO_ProcMonitor(   p_logfile, "Entered CBLREmptyHdrPrnFn \n", NULL, NULL);

	fprintf(p_oprec_filehandle,"%s\n%s\n","Bank Handlowy w Warszawie S.A.","924");
	for (i = 1; i < 135; i++)
	{
		fprintf(p_oprec_filehandle,"%s","-");
	}
	fprintf(p_oprec_filehandle,"\n");
	i = 0;
	fprintf(p_oprec_filehandle,"%s\n",chr_p_oprec_filedesc); 
	fprintf(p_oprec_filehandle,"%s\n\n","WALOR : ");
	for (i = 1; i < 135; i++)
	{
		fprintf(p_oprec_filehandle,"%s","-");
	}
	fprintf(p_oprec_filehandle,"\n");
	i = 0;
	fprintf(p_oprec_filehandle,"%16s\n","KONTO");
	
	fprintf(p_oprec_filehandle,"%-4s%-20s%-20s%-81s%s\n","Lp.","Debet","Kredyt","Opis Operacji","Ilosc");//AIX Warning Removal
	for (i = 1; i < 135; i++)
	{
		fprintf(p_oprec_filehandle,"%s","-");
	}
	i = 0;
	fprintf(p_oprec_filehandle,"\n");
	fprintf(p_oprec_filehandle,"%s",chr_p_oprec_filedesc); 
	fprintf(p_oprec_filehandle,"%s\n"," jest pust (y/a) !");
	for (i = 1; i < 135; i++)
	{
		fprintf(p_oprec_filehandle,"%s","-");
	}
	fprintf(p_oprec_filehandle,"\n");
	
	fprintf(p_oprec_filehandle,"\f");

	

	i = 0;
	for (i = 1; i < 135; i++)
	{
		fprintf(p_oprec_filehandle,"%s","-");
	}
	fprintf(p_oprec_filehandle,"\n");
	fprintf(p_oprec_filehandle,"%s\n","STANY POSIADANIA KLIENTA ");
	fprintf(p_oprec_filehandle,"%-10s\n\n","Klient :");
	fprintf(p_oprec_filehandle,"%-10s\n\n","Walor  :");

	i = 0;
	for (i = 1; i < 135; i++)
	{
		fprintf(p_oprec_filehandle,"%s","-");
	}
	fprintf(p_oprec_filehandle,"\n");
	fprintf(p_oprec_filehandle,"%s\n","KONTO  :");
	fprintf(p_oprec_filehandle,"%s","DATA   : ");
	fprintf(p_oprec_filehandle,"%.10s\n",p_procdate);
	//fprintf(p_oprec_filehandle,"%s","Opis Operacji","Konto Przeciw","Ilosc"); Changes done for AIX Migration
	fprintf(p_oprec_filehandle,"%s%s%s","Opis Operacji","Konto Przeciw","Ilosc");
	for (i = 14; i < 100; i++)
	{
		fprintf(p_oprec_filehandle,"%s"," ");
	}
	fprintf(p_oprec_filehandle,"%s    %s\n","Konto Przeciw","Ilosc");

	i = 0;
	for (i = 1; i < 135; i++)
	{
		fprintf(p_oprec_filehandle,"%s","-");
	}
	fprintf(p_oprec_filehandle,"\n");
	fprintf(p_oprec_filehandle,"%s %.10s %s\n","STANY POSIADANIA KLIENTA z dnia ",p_procdate," jest pust (y/a) !");
	i = 0;
	for (i = 1; i < 135; i++)
	{
		fprintf(p_oprec_filehandle,"%s","-");
	}
	fprintf(p_oprec_filehandle,"\n");
	
	fprintf(p_oprec_filehandle,"\f");

	

	i = 0;
	for (i = 1; i < 135; i++)
	{
		fprintf(p_oprec_filehandle,"%s","-");
	}
	fprintf(p_oprec_filehandle,"\n");
	fprintf(p_oprec_filehandle,"%s\n","KSIEGA GLOWNA OPERACJI ");
	fprintf(p_oprec_filehandle,"%-10s\n\n","Walor  :");

	i = 0;
	for (i = 1; i < 135; i++)
	{
		fprintf(p_oprec_filehandle,"%s","-");
	}
	fprintf(p_oprec_filehandle,"\n");
	fprintf(p_oprec_filehandle,"%s\n","KONTO  :");
	fprintf(p_oprec_filehandle,"%s","DATA   : ");
	fprintf(p_oprec_filehandle,"%-.10s\n",p_procdate);
	fprintf(p_oprec_filehandle,"%-60s%-61s%-s\n","Opis Operacji","Konto Przeciw","Ilosc");

	i = 0;
	for (i = 1; i < 135; i++)
	{
		fprintf(p_oprec_filehandle,"%s","-");
	}
	fprintf(p_oprec_filehandle,"\n");
	fprintf(p_oprec_filehandle,"%s %.10s %s\n","KSIEGA GLOWNA OPERACJI z dnia ",p_procdate," jest pust (y/a) !");
	i = 0;
	for (i = 1; i < 135; i++)
	{
		fprintf(p_oprec_filehandle,"%s","-");
	}
	fprintf(p_oprec_filehandle,"\n");
	
	
	
	CO_ProcMonitor(   p_logfile, "Leaving CBLREmptyHdrPrnFn Successfully\n", NULL, NULL);
	return(APL_SUCCESS);
}



int CBLRCusOpHdrPrnFn(char p_type, 
								char *p_ct_clt_A,
								char *p_procdate,
								char *chr_p_client, 
								char *p_instr_code,
								short p_pgno,
								FILE *p_oprec_filehandle, 
								FILE *p_logfile,
								DEBUG_INFO_STRUCT_H **l_debug_info_ptr)
{
	short i = 0;
	char chr_p_instrdesc[131] = APL_NULL_STRING;
	char chr_p_isin[13] = APL_NULL_STRING;
	char chr_p_cname[66] = APL_NULL_STRING;
	char chr_h_system_datetime[APL_DATE_LEN] = APL_NULL_STRING;

	APL_IF_DEBUG
	{
		fprintf(APL_OUT_FILE,"Entered CLRCusOpHdrPrnFn\n");
	}
	CO_ProcMonitor(   p_logfile, "Entered CBLRCusOpHdrPrnFn \n", NULL, NULL);

	if (APL_FAILURE == CR_Rtv_LRInstrDesc(p_instr_code,chr_p_instrdesc,chr_p_isin,l_debug_info_ptr))
	{
		APL_GOBACK_FAIL
	}

	if ( APL_FAILURE == CO_RtvSysDtTime (chr_h_system_datetime, l_debug_info_ptr))
	{
		APL_GOBACK_FAIL
	}

	fprintf(p_oprec_filehandle,"%55s%s %u\n"," ","STRONA ",p_pgno);
	fprintf(p_oprec_filehandle,"%s%50s%s\n%s\n","Bank Handlowy w Warszawie S.A."," ",chr_h_system_datetime,"924");

	for (i = 1; i < 135; i++)
	{
		fprintf(p_oprec_filehandle,"%s","-");
	}
	fprintf(p_oprec_filehandle,"\n");

	if (p_type == 'C')
	{
		if (APL_FAILURE == CR_Rtv_LRCust(chr_p_client,chr_p_cname,l_debug_info_ptr))
		{
			APL_GOBACK_FAIL
		}

		fprintf(p_oprec_filehandle,"%-s\n","STANY POSIADANIA KLIENTA");
		fprintf(p_oprec_filehandle,"%-10s %-s\n","Klient : ",chr_p_cname);
		fprintf(p_oprec_filehandle,"%10s %s\n"," ",chr_p_client);
	}
	else
	{
		fprintf(p_oprec_filehandle,"%s\n","KSIEGA GLOWNA OPERACJI");
	}

	i = 0;
	fprintf(p_oprec_filehandle,"%s%s\n","WALOR : ",chr_p_instrdesc);
	fprintf(p_oprec_filehandle,"%8s%s\n"," ",chr_p_isin);
	for (i = 1; i < 135; i++)
	{
		fprintf(p_oprec_filehandle,"%s","-");
	}
	fprintf(p_oprec_filehandle,"\n");
	i = 0;
	if ( strcmp(p_ct_clt_A,"111") == 0 || strcmp(p_ct_clt_A,"121") == 0 )
	{
		fprintf(p_oprec_filehandle,"%-10s %s%s\n","KONTO","10 ",p_ct_clt_A);
	}
	else if ( strcmp(p_ct_clt_A,"210") == 0 )
	{
		fprintf(p_oprec_filehandle,"%-10s %s%s%s\n","KONTO","00 ",p_ct_clt_A," 00");
	}
	else
	{
		fprintf(p_oprec_filehandle,"%-10s %s%s\n","KONTO","00 ",p_ct_clt_A);
	}
	
	fprintf(p_oprec_filehandle,"%-10s %.10s\n","DATA :",p_procdate);
	//fprintf(p_oprec_filehandle,"%s","Opis Operacji","Konto Przeciw","      Ilosc"); CHanges done for AIX Migration
	fprintf(p_oprec_filehandle,"%s%s%s","Opis Operacji","Konto Przeciw","      Ilosc");
	for (i = 14; i < 100; i++)
	{
		fprintf(p_oprec_filehandle,"%s"," ");
	}
	fprintf(p_oprec_filehandle,"%s    %s\n","Konto Przeciw","      Ilosc");
	for (i = 1; i < 135; i++)
	{
		fprintf(p_oprec_filehandle,"%s","-");
	}
	fprintf(p_oprec_filehandle,"\n");


	APL_GOBACK_SUCCESS
	
  	RETURN_SUCCESS :
	{
		
		CO_ProcMonitor(   p_logfile, "Leaving CBLRCusOpHdrPrnFn Successfully\n", NULL, NULL);
		APL_IF_DEBUG
		{
			fprintf(APL_OUT_FILE,"Exiting CBLRCusOpHdrPrnFn successfully\n");
		}
		return(APL_SUCCESS);
	}

	RETURN_FAILURE :
	CO_ProcMonitor(   p_logfile, "Leaving CBLRCusOpHdrPrnFn with Failure\n", NULL, NULL);
	{
		APL_IF_DEBUG
		{
			fprintf(APL_OUT_FILE,"Exiting CBLRCusOpHdrPrnFn with errors\n");
		}
		return(APL_FAILURE);
	}
}

int Getisin( char *chr_l_instrcode_a,
				 char *chr_l_isin,
				 DEBUG_INFO_STRUCT_H **l_debug_info_ptr)
{
	char chr_l_temp_isin[13] = APL_NULL_STRING;	
	EXEC SQL BEGIN DECLARE SECTION;
	struct sqlca sqlca;
	EXEC SQL END DECLARE SECTION;

	EXEC SQL BEGIN DECLARE SECTION;
	EXEC SQL VAR chr_l_temp_isin IS STRING;
	EXEC SQL END DECLARE SECTION;

	sqlca.sqlcode = 0;

	#ifdef SYS_DEBUG
		fprintf(APL_OUT_FILE,"Entered Getisin() \n");
	#endif

	EXEC SQL SELECT INSTR_ISIN INTO :chr_l_temp_isin
				FROM MT_INSTRUMENT 
				WHERE INSTR_CODE = :chr_l_instrcode_a;

	IS_ANY_ORA_ERROR;
	strcpy( chr_l_isin,chr_l_temp_isin );

	APL_GOBACK_SUCCESS

	RETURN_SUCCESS :
	{
		#ifdef SYS_DEBUG
		fprintf(APL_OUT_FILE,"Exiting Getisin() successfully\n");
		#endif
		return(APL_SUCCESS);
	}
	RETURN_FAILURE :
	{
		#ifdef SYS_DEBUG
		fprintf(APL_OUT_FILE,"Exiting Getisin() with errors\n");
		#endif
		return(APL_FAILURE);
	}

}


int CheckNonResident( char *p_client,
							 char *p_instrcode,
							 int	*p_nonresidentflag,
							 DEBUG_INFO_STRUCT_H **l_debug_info_ptr)
{
   char chr_l_prdtype[3] = APL_NULL_STRING;
	char chr_l_locncode_c[5] = APL_NULL_STRING;
	char chr_l_cntrycode[3] = APL_NULL_STRING;
	short l_i_locncode = 0; 
	struct sqlca sqlca;

   EXEC SQL BEGIN DECLARE SECTION;
   EXEC SQL VAR chr_l_prdtype IS STRING;
	EXEC SQL VAR chr_l_locncode_c IS STRING;
	EXEC SQL VAR chr_l_cntrycode IS STRING;
   EXEC SQL END DECLARE SECTION;

	sqlca.sqlcode = 0;
	*p_nonresidentflag = 0;

   #ifdef SYS_DEBUG
      fprintf(APL_OUT_FILE,"Entered CheckNonResident() \n");
   #endif

   memset(chr_l_prdtype, APL_NULL_CHAR, 3);
	memset(chr_l_locncode_c, APL_NULL_CHAR, 5);
	memset(chr_l_cntrycode, APL_NULL_CHAR, 3);


	EXEC SQL SELECT prod_class, location_cd
				  INTO :chr_l_prdtype, :chr_l_locncode_c:l_i_locncode
              FROM MT_INSTRUMENT
				 WHERE instr_code = RTRIM(:p_instrcode) ;

   IS_ANY_ORA_ERROR;
				  
   EXEC SQL SELECT COUNTRY
				  INTO :chr_l_cntrycode
              FROM MT_CLIENT
             WHERE CLN_CODE = RTRIM(:p_client) ;

   IS_ANY_ORA_ERROR;

	if ( strcmp(chr_l_cntrycode,"PL") && strcmp(chr_l_cntrycode, "PO") && 
		  !strcmp(chr_l_prdtype,"2") && !strcmp(chr_l_locncode_c ,"NDS_IND") &&
			strcmp(p_client ,"100000") && strcmp(p_client, "100001") && strcmp(p_client, "100002") )
        {
          *p_nonresidentflag = 1;
        }
   else
       *p_nonresidentflag = 0;
	

   APL_GOBACK_SUCCESS

   RETURN_SUCCESS :
   {
      #ifdef SYS_DEBUG
      fprintf(APL_OUT_FILE,"Exiting CheckNonResident() successfully\n");
      #endif
      return(APL_SUCCESS);
   }
   RETURN_FAILURE :
   {
      #ifdef SYS_DEBUG
      fprintf(APL_OUT_FILE,"Exiting CheckNonResident() with errors\n");
      #endif
      return(APL_FAILURE);
   }
}
