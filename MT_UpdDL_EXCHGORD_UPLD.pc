/*
 *    COPYRIGHT NOTICE
 *
 *   Copyright 2005 Polaris Software Lab Limited. All rights reserved.
 *
 *   These materials are confidential and proprietary to
 *    Polaris Software Lab Limited and no part of these materials should
 *    be reproduced, published, transmitted or distributed in any form or
 *    by any means, electronic, mechanical, photocopying, recording or
 *    otherwise, or stored in any information storage or retrieval system
 *    of any nature nor should the materials be disclosed to third parties
 *    or used in any other manner for which this is not authorized, without
 *    the prior express written authorization of Polaris Software Lab Limited.
*/
/*********************************************************************
 *
 * Module Name         :      Master Maintenance
 *
 * File Name           :      MT_UpdDL_EXCHGORD_UPLD.pc
 *
 * Description         :      This file contains db functions for updating
 *                            Master Details.
 *
 *
 *            Version Control Block
 *
 * Date        Version     Author         Description       RFS No.
 * ---------   --------  ------------     -------------     ---------
 * 03/01/2006   1.0       Sundar        New file       HDFCDL_005
 *
 *********************************************************************/


#include "CO_HostStructdef.h"

EXEC SQL INCLUDE SQLCA.H;




int DL_ModDBExchgOrd_Upld(DL_EXCHGORD_UPLD_STRUCT_H *p_dl_exchgord_upld_struct_h,char *p_order_no,char *p_exch_code,INTL_ENV_DATA_STRUCT_H *p_intl_envdatastruct_h,DEBUG_INFO_STRUCT_H **l_debug_info_ptr) 

{

	/* Variable Declarations */
	DL_EXCHGORD_UPLD_STRUCT_I *l_dl_exchgord_upld_struct_i;

	struct sqlca sqlca;

	char chr_acc_stamp_compare[APL_DATE_LEN] = APL_NULL_STRING;
	char chr_status_compare[APL_STATUS_LEN] = APL_NULL_STRING;
	char chr_sys_access_stamp[APL_DATE_LEN] = APL_NULL_STRING;
	short p_i_maker, p_i_maker_dt, p_i_checker, p_i_checker_dt, p_i_access_stamp;
	short p_i_access_stamp_compare;
	short p_i_status = 0;
	int int_error_flag = APL_SUCCESS;
	int int_l_rowexists = 0;
	char  *l_key_codes[4];
	char  *l_key_values[4];
	char  chr_l_table_name[50] = APL_NULL_STRING;
	char  chr_l_field_val[40] = APL_NULL_STRING;
	char  l_seq_val[26] = APL_NULL_STRING;
	int 	l_int_count = 0;
	int	int_retval = APL_SUCCESS;
	int l_count_no=0;/* vinay */
    short   int_exist_rec=0; /* jeoti */    	
char  chr_l_buf[BUFFER_LEN] =  APL_NULL_STRING;// Priyanka
        double chr_l_val = 0.0;            /* Added by Gouse - Decimal Length for MF- 01/10/2011 */ 	
    	
#ifdef APL_THREADS
	APL_SET_CONTEXT
		EXEC SQL CONTEXT USE :my_ctx_local;
#endif

	APL_FUNCTION_ENTER(APL_OUT_FILE)
 Alert("MODEiii:|%s|",p_intl_envdatastruct_h->h_mode);

	l_dl_exchgord_upld_struct_i=(DL_EXCHGORD_UPLD_STRUCT_I*)calloc(1,sizeof(DL_EXCHGORD_UPLD_STRUCT_I));

	APL_MALLOC_FAIL(l_dl_exchgord_upld_struct_i)

	p_i_maker =0;
	p_i_maker_dt =0;
	p_i_checker =0;
	p_i_checker_dt =0;
	p_i_access_stamp =0;
	p_i_access_stamp_compare =0;
	
   EXEC SQL VAR l_seq_val IS STRING;	

	memset(l_seq_val,'\0',sizeof(l_seq_val));


	if(!strlen(p_dl_exchgord_upld_struct_h ->h_exchg_code))  l_dl_exchgord_upld_struct_i -> i_exchg_code= -1;
	else
		l_dl_exchgord_upld_struct_i -> i_exchg_code= 0;
	if(!strlen(p_dl_exchgord_upld_struct_h ->h_cln_code))  l_dl_exchgord_upld_struct_i -> i_cln_code= -1;
	else
		l_dl_exchgord_upld_struct_i -> i_cln_code= 0;
	if(!strlen(p_dl_exchgord_upld_struct_h ->h_instr_code))  l_dl_exchgord_upld_struct_i -> i_instr_code= -1;
	else
		l_dl_exchgord_upld_struct_i -> i_instr_code= 0;
	if(!strlen(p_dl_exchgord_upld_struct_h ->h_settl_no))  l_dl_exchgord_upld_struct_i -> i_settl_no= -1;
	else
		l_dl_exchgord_upld_struct_i -> i_settl_no= 0;
	if(!strlen(p_dl_exchgord_upld_struct_h ->h_deal_date)) l_dl_exchgord_upld_struct_i -> i_deal_date= -1;
	else
		l_dl_exchgord_upld_struct_i -> i_deal_date= 0;
	if(!strlen(p_dl_exchgord_upld_struct_h ->h_creation_type))  l_dl_exchgord_upld_struct_i -> i_creation_type= -1;
	else
		l_dl_exchgord_upld_struct_i -> i_creation_type= 0;
	if(!strlen(p_dl_exchgord_upld_struct_h ->h_buy_sell_flg))  l_dl_exchgord_upld_struct_i -> i_buy_sell_flg= -1;
	else
		l_dl_exchgord_upld_struct_i -> i_buy_sell_flg= 0;
/* Start - For EXCH_INSTR_CODE - Rahul */
   if(!strlen(p_dl_exchgord_upld_struct_h ->h_exch_instr_code))  l_dl_exchgord_upld_struct_i -> i_exch_instr_code= -1;
   else
      l_dl_exchgord_upld_struct_i -> i_exch_instr_code= 0;
/* End - For EXCH_INSTR_CODE - Rahul */
//Added by Rahul6 for T0 - start
	if(!strlen(p_dl_exchgord_upld_struct_h ->h_cp_code)) 
		l_dl_exchgord_upld_struct_i -> i_cp_code= -1;
	else
		l_dl_exchgord_upld_struct_i -> i_cp_code= 0;
	//Added by Rahul6 for T0 - end


	if(CO_RtvSysDtTime(chr_sys_access_stamp,l_debug_info_ptr) !=APL_SUCCESS)
	{
		APL_GOBACK_FAIL
	}
	
	/**** For No Delivery Process : vinay kalaskar ********************/
	
	Alert("MODE:|%s|",p_intl_envdatastruct_h->h_mode);
	
	if((!strcmp(p_intl_envdatastruct_h->h_mode,APL_FUNC_INPUT))||
		(!strcmp(p_intl_envdatastruct_h->h_mode,APL_FUNC_MODIFY)))
	{
		
		if(strcmp(p_dl_exchgord_upld_struct_h ->h_order_data,APL_NULL_STRING))
		{
			strcpy(p_dl_exchgord_upld_struct_h ->h_nodelv_repdate,APL_NULL_STRING);
		}
		else
		{
			
			strcpy(p_dl_exchgord_upld_struct_h ->h_nodelv_repdate,APL_NULL_STRING);
			strcpy(p_dl_exchgord_upld_struct_h ->h_order_data,APL_NULL_STRING);
		}

	
	printf("\n instr code is **************|%s|\n",p_dl_exchgord_upld_struct_h->h_instr_code);	
	printf("\n DEAL DATE is **************|%s|\n",p_dl_exchgord_upld_struct_h->h_deal_date);
	printf("\n exchange code is **************|%s|\n",p_dl_exchgord_upld_struct_h->h_exchg_code);
	printf("\n chr_sys_access_stamp=|%s| \n",chr_sys_access_stamp);
	printf("\n Orig Exch Code=|%s| \n",p_exch_code);

      /* ISKB-492 : Query changed by ASHISH 11-10-2007 */
	if(!strcmp(p_exch_code,"OTR"))
		{
			EXEC SQL SELECT COUNT(*) INTO :l_count_no FROM MT_NO_DELV A
										WHERE A.INSTR_CODE=:p_dl_exchgord_upld_struct_h->h_instr_code
							/*			AND TO_DATE(:p_dl_exchgord_upld_struct_h->h_deal_date,'DD/MM/YYYY HH:MI:SS')  Vaibhav 1-Nov2006*/
										AND TRUNC(TO_DATE(:chr_sys_access_stamp,'DD/MM/YYYY HH24:MI:SS'))
										BETWEEN TRUNC(A.NO_DEL_FROM) AND TRUNC(A.NO_DEL_TO)
										AND A.EXCH_CODE =:p_dl_exchgord_upld_struct_h->h_exchg_code;
										/* ISKB-492 Reverting changes */
                                    /*AND A.MKT_TYPE=:p_dl_exchgord_upld_struct_h->h_mkt_type */ /* ISKB-416: ASHISH 17-10-2007 */
                                    /*AND A.STATUS='AA';     */   /* ISKB-492 : ASHISH 11-10-2007 */
		}
		else
		{
/*	EXEC SQL SELECT COUNT(*) INTO :l_count_no FROM MT_NO_DELV A,DL_EXCHGORD_UPLD B  
										WHERE A.INSTR_CODE=:p_dl_exchgord_upld_struct_h->h_instr_code
										AND A.INSTR_CODE=B.INSTR_CODE
										AND TO_DATE(:p_dl_exchgord_upld_struct_h->h_deal_date,'DD/MM/YYYY HH:MI:SS') 
										between A.NO_DEL_FROM  and A.NO_DEL_TO	
										AND A.EXCH_CODE =:p_dl_exchgord_upld_struct_h->h_exchg_code;
*/
/*	changes by AmitB 31/10/2006 to refer only NO-DEL table	*/
	EXEC SQL SELECT COUNT(*) INTO :l_count_no FROM MT_NO_DELV A
										WHERE A.INSTR_CODE=:p_dl_exchgord_upld_struct_h->h_instr_code
							/*			AND TO_DATE(:p_dl_exchgord_upld_struct_h->h_deal_date,'DD/MM/YYYY HH:MI:SS')  Vaibhav 1-Nov2006*/
										AND TRUNC(TO_DATE(:p_dl_exchgord_upld_struct_h->h_deal_date,'DD/MM/YYYY HH:MI:SS'))
										BETWEEN TRUNC(A.NO_DEL_FROM) AND TRUNC(A.NO_DEL_TO)
										AND A.EXCH_CODE =:p_dl_exchgord_upld_struct_h->h_exchg_code;
									/* ISKB-492 Reverting changes */
                                    /*AND A.MKT_TYPE=:p_dl_exchgord_upld_struct_h->h_mkt_type */ /* ISKB-416: ASHISH 17-10-2007 */
                                    /*AND A.STATUS='AA'; */       /* ISKB-492 : ASHISH 11-10-2007 */
		}
	printf("\n Amit:Error=|%d|  l_count_no=|%d| \n",sqlca.sqlcode,l_count_no);
	IS_ANY_ORA_ERROR

	if(l_count_no >0)
	{		
		strcpy(p_dl_exchgord_upld_struct_h ->h_is_nodelv,"Y");
		l_dl_exchgord_upld_struct_i->i_is_nodelv = 0;
	}
	else
	{
		strcpy(p_dl_exchgord_upld_struct_h ->h_is_nodelv,APL_NULL_STRING);
		l_dl_exchgord_upld_struct_i->i_is_nodelv = -1;
	}

	Alert("shrinath");
	//Alert("h_order_data1:|%s|",p_dl_exchgord_upld_struct_h ->h_order_data);
	//Alert("h_is_nodelv:|%s|",p_dl_exchgord_upld_struct_h ->h_is_nodelv);

	}
	
	/*********************************************************************************/
        /* Added by Gouse - Decimal Length for MF- 01/10/2011 - Start */

        IF_COND_EXISTS("QTY_RND_MF_MKT","QTY_RND_FOR_MF_MKT")
        {
                CR_Proc_InstrQtyRound_Chk(p_dl_exchgord_upld_struct_h->h_qty, p_dl_exchgord_upld_struct_h->h_instr_code, &chr_l_val, l_debug_info_ptr );

                p_dl_exchgord_upld_struct_h->h_qty =chr_l_val;

        }
        /* Added by Gouse - Decimal Length for MF- 01/10/2011 - End */ 
	 Alert("*********Rahul:|%s|",p_intl_envdatastruct_h->h_mode);
	if (!strcmp(p_intl_envdatastruct_h->h_mode,APL_FUNC_INPUT))
	{

		APL_IF_DEBUG
		{
			CO_ProcMonitor(APL_OUT_FILE, "Entered Input of Function DL_ModDBExchgOrd_Upld\n",
					NULL,p_intl_envdatastruct_h);
		}
      
      EXEC SQL SELECT exord_seq.nextval INTO :l_seq_val FROM DUAL;
      IS_ANY_ORA_ERROR
   

		/*	Addition of condition for upload	UAT Rohit	*/
		if (strcmp(p_dl_exchgord_upld_struct_h->h_status,STATUS_AUTH))
		{
			strcpy(p_dl_exchgord_upld_struct_h->h_status,STATUS_UAUTH);
	  		/**strcpy(p_dl_exchgord_upld_struct_h->h_order_no,"EXCH_ORD"); 
	  		strcat(p_dl_exchgord_upld_struct_h->h_order_no,l_seq_val); **/
		}

		l_dl_exchgord_upld_struct_i->i_status =0;
		strcpy(p_dl_exchgord_upld_struct_h->h_maker,p_intl_envdatastruct_h->usr);
		l_dl_exchgord_upld_struct_i->i_maker=0;
		strcpy(p_dl_exchgord_upld_struct_h->h_maker_dt,chr_sys_access_stamp);
		l_dl_exchgord_upld_struct_i->i_maker_dt=0;
		strcpy(p_dl_exchgord_upld_struct_h->h_access_stamp,chr_sys_access_stamp);
		l_dl_exchgord_upld_struct_i->i_access_stamp =0;
		printf("Record Maker:- |%s|\n",p_dl_exchgord_upld_struct_h->h_maker);

                /* Jeevan Chages for MCS Upload */
              /* Priyanka -  Commented to allow duplicate order upload
if(strcmp(p_dl_exchgord_upld_struct_h->h_exchg_code,"MCS")== 0)
		{
				EXEC SQL select count(*) into :int_exist_rec from DL_EXCHGORD_UPLD where
					ORDER_NO= :p_dl_exchgord_upld_struct_h->h_order_no and
					BROKER_CD= :p_dl_exchgord_upld_struct_h->h_broker_cd and SETTL_NO=:p_dl_exchgord_upld_struct_h->h_settl_no;
				IS_ANY_ORA_ERROR
                 if (int_exist_rec > 0)
				 {
				if (CO_InsertErr
					(l_debug_info_ptr,
					 MAP_DET_EXIST, 
					 APL_NULL_STRING,
					 APL_NULL_STRING,
					 APL_NULL_STRING,
					 __LINE__,
					 __FILE__
					) != APL_SUCCESS)
				  printf("\n Inside MCS TEST if condition \n");   
					 APL_GOBACK_FAIL
				 }
		} */
             /* Jeevan Chages for MCS Upload -Ends*/

		/*	Addition of GFU Condition UAT	Rohit	*/
		if(strstr(p_dl_exchgord_upld_struct_h->h_maker,"GFU")!=0)
		{
			 IF_COND_EXISTS("DL_DEAL","EXCH")     //bank specific condition added by jeoti
			{

            printf("\n...........inside bank specific condition checking.....1....");


			if(strcmp(p_dl_exchgord_upld_struct_h->h_exchg_code,"BSE") != 0)  //condition added by jeoti
			{

			    EXEC SQL SELECT COUNT(*) into :l_int_count
				FROM DL_EXCHGORD_UPLD WHERE
				ORDER_NO=:p_dl_exchgord_upld_struct_h->h_order_no
				AND BROKER_CD = :p_dl_exchgord_upld_struct_h->h_broker_cd /* HBDL_012 - changes by amish - exchange order enhancement 27/07/2007*/
				AND DEAL_DATE = :p_dl_exchgord_upld_struct_h->h_deal_date /* HBDL_012 - changes by amish - exchange order enhancement 25/07/2007*/
				AND STATUS<>'PM';	
      
			IS_ANY_ORA_ERROR
	
			APL_IF_DEBUG
			{
				printf("Record Count:- %d",l_int_count);
			}	
			
			}
/* ************************added by jeoti************************************************* */

    else    
			{
		
				EXEC SQL SELECT COUNT(*) into :l_int_count
							FROM DL_EXCHGORD_UPLD WHERE
							ORDER_NO=:p_dl_exchgord_upld_struct_h->h_order_no
							AND SETTL_NO = :p_dl_exchgord_upld_struct_h->h_settl_no 
							AND BROKER_CD = :p_dl_exchgord_upld_struct_h->h_broker_cd 
							AND STATUS<>'PM';	
			  
							 IS_ANY_ORA_ERROR
			
							APL_IF_DEBUG
							{
								printf("Record Count:- %d",l_int_count);
							}


			}


			}


			else

			{
			EXEC SQL SELECT COUNT(*) into :l_int_count
				FROM DL_EXCHGORD_UPLD WHERE
				ORDER_NO=:p_dl_exchgord_upld_struct_h->h_order_no
								AND EXCHG_CODE = :p_dl_exchgord_upld_struct_h->h_exchg_code 
								AND DEAL_DATE = :p_dl_exchgord_upld_struct_h->h_deal_date 
				AND STATUS<>'PM';	
      
			IS_ANY_ORA_ERROR
	
			APL_IF_DEBUG
			{
				printf("Record Count:- %d",l_int_count);
			}	
			}

			if (l_int_count > 0)

 {

	IF_COND_EXISTS("DL_DEAL","EXCH")     //bank specific condition added by jeoti

		{

                printf("\n...........inside bank specific condition checking.....2....");


      if(strcmp(p_dl_exchgord_upld_struct_h->h_exchg_code,"BSE") != 0)
				
				{

						EXEC SQL DELETE FROM DL_EXCHGORD_UPLD WHERE 
						ORDER_NO=:p_dl_exchgord_upld_struct_h->h_order_no
						AND DEAL_DATE = :p_dl_exchgord_upld_struct_h->h_deal_date /* HBDL_012 - changes by amish - exchange order enhancement 25/07/2007*/
						AND BROKER_CD = :p_dl_exchgord_upld_struct_h->h_broker_cd /* HBDL_012 - changes by amish - exchange order enhancement 27/07/2007*/
						AND STATUS<>'PM';
					
						IS_ANY_ORA_ERROR

				}
     else
			{

				EXEC SQL DELETE FROM DL_EXCHGORD_UPLD WHERE 
				ORDER_NO=:p_dl_exchgord_upld_struct_h->h_order_no
				AND SETTL_NO = :p_dl_exchgord_upld_struct_h->h_settl_no 
				AND BROKER_CD = :p_dl_exchgord_upld_struct_h->h_broker_cd 
				AND STATUS<>'PM';
			
				IS_ANY_ORA_ERROR
			}	

				}


	else

				{


                 EXEC SQL DELETE FROM DL_EXCHGORD_UPLD WHERE 
						ORDER_NO=:p_dl_exchgord_upld_struct_h->h_order_no
						AND DEAL_DATE = :p_dl_exchgord_upld_struct_h->h_deal_date /* HBDL_012 - changes by amish - exchange order enhancement 25/07/2007*/
						AND EXCHG_CODE = :p_dl_exchgord_upld_struct_h->h_exchg_code /* HBDL_012 - changes by amish - exchange order enhancement 27/07/2007*/
						AND STATUS<>'PM';
					
						IS_ANY_ORA_ERROR


				}

	}	

		}
		

/******************************changes by jeoti ends here*****************************************/


		APL_IF_DEBUG
		{
			printf("p_dl_exchgord_upld_struct_h->h_order_no |%s|\n",p_dl_exchgord_upld_struct_h->h_order_no);
			printf("p_dl_exchgord_upld_struct_h->h_exchg_code |%s|\n",p_dl_exchgord_upld_struct_h->h_exchg_code);
			printf("p_dl_exchgord_upld_struct_h->h_cln_code |%s|\n",p_dl_exchgord_upld_struct_h->h_cln_code);
			printf("p_dl_exchgord_upld_struct_h->h_instr_code |%s|\n",p_dl_exchgord_upld_struct_h->h_instr_code);
			printf("p_dl_exchgord_upld_struct_h->h_broker_cd |%s|\n",p_dl_exchgord_upld_struct_h->h_broker_cd);
			printf("p_dl_exchgord_upld_struct_h->qty %f\n",p_dl_exchgord_upld_struct_h->h_qty);
			printf("p_dl_exchgord_upld_struct_h->settl_no |%s|\n",p_dl_exchgord_upld_struct_h->h_settl_no);
			printf("p_dl_exchgord_upld_struct_h->dl_amt %f\n",p_dl_exchgord_upld_struct_h->h_dl_amt);
			printf("p_dl_exchgord_upld_struct_h->h_deal_date |%s|\n",p_dl_exchgord_upld_struct_h->h_deal_date);
			printf("p_dl_exchgord_upld_struct_h->dl_amt %f\n",p_dl_exchgord_upld_struct_h->h_dl_amt);
			printf("p_dl_exchgord_upld_struct_h->h_mkt_type |%s|\n",p_dl_exchgord_upld_struct_h->h_mkt_type);
			printf("p_dl_exchgord_upld_struct_h->h_scrip_grp |%s|\n",p_dl_exchgord_upld_struct_h->h_scrip_grp);
			printf("p_dl_exchgord_upld_struct_h->h_creation_type |%s|\n",p_dl_exchgord_upld_struct_h->h_creation_type);
			printf("p_dl_exchgord_upld_struct_h->h_deal_ref_no |%s|\n",p_dl_exchgord_upld_struct_h->h_deal_ref_no);
			printf("p_dl_exchgord_upld_struct_h->h_buy_sell_flg |%s|\n",p_dl_exchgord_upld_struct_h->h_buy_sell_flg);
			printf("p_dl_exchgord_upld_struct_h->h_matched |%s|\n",p_dl_exchgord_upld_struct_h->h_matched);
			printf("p_dl_exchgord_upld_struct_h->h_access_stamp |%s|\n",p_dl_exchgord_upld_struct_h->h_access_stamp);
			printf("p_dl_exchgord_upld_struct_h->hh_status |%s|\n",p_dl_exchgord_upld_struct_h->h_status);
			printf("p_dl_exchgord_upld_struct_h->h_maker |%s|\n",p_dl_exchgord_upld_struct_h->h_maker);
			printf("p_dl_exchgord_upld_struct_h->h_makerdt |%s|\n",p_dl_exchgord_upld_struct_h->h_maker_dt);
			printf("p_dl_exchgord_upld_struct_h->checker |%s|\n",p_dl_exchgord_upld_struct_h->h_checker);
			printf("p_dl_exchgord_upld_struct_h->checkerdt |%s|\n",p_dl_exchgord_upld_struct_h->h_checker_dt);
			printf("p_dl_exchgord_upld_struct_h ->h_is_nodelv |%s|\n",p_dl_exchgord_upld_struct_h ->h_is_nodelv);
			printf("p_dl_exchgord_upld_struct_h ->h_exch_instr_code |%s|\n",p_dl_exchgord_upld_struct_h ->h_exch_instr_code);
			//Added by rahul6 for T0
			printf("p_dl_exchgord_upld_struct_h ->h_cp_code |%s|\n",p_dl_exchgord_upld_struct_h ->h_cp_code);
		}


 IF_COND_EXISTS("DL_DEAL","EXCH")     //bank specific condition added by jeoti

		{
          printf("\n...........inside bank specific condition checking.....3....");

		if(strcmp(p_dl_exchgord_upld_struct_h->h_exchg_code,"BSE")== 0)
		{
          
          printf("\n...............for BSE only..........");
         

				EXEC SQL select count(*) into :int_exist_rec from DL_EXCHGORD_UPLD where
					ORDER_NO= :p_dl_exchgord_upld_struct_h->h_order_no and
					BROKER_CD= :p_dl_exchgord_upld_struct_h->h_broker_cd and SETTL_NO=:p_dl_exchgord_upld_struct_h->h_settl_no;


				IS_ANY_ORA_ERROR

				 
                 if (int_exist_rec > 0)

				 {

                  printf("\n..............error is here..........1...\n");

					  
				/*		  if (CO_InsertErr(l_debug_info_ptr,
												 ERR_EXCHGORD_EXISTS,
												p_dl_exchgord_upld_struct_h->h_order_no,
												p_dl_exchgord_upld_struct_h->h_exchg_code,
												 APL_NULL_STRING,
												 __LINE__,
												 __FILE__
												) != APL_SUCCESS)
							
							
							printf("\n Inside if condition \n");
						
				*/

				if (CO_InsertErr
					(l_debug_info_ptr,
					 MAP_DET_EXIST, 
					 APL_NULL_STRING,
					 APL_NULL_STRING,
					 APL_NULL_STRING,
					 __LINE__,
					 __FILE__
					) != APL_SUCCESS)
				
				  printf("\n Inside if condition \n");   
					 APL_GOBACK_FAIL

				 }

/*ISKB_2091 Check whether Broker code exists or not - START*/
			EXEC SQL select count(*) into :int_exist_rec from MT_PTY_EXCH_MAP where 
				PTY_CODE = :p_dl_exchgord_upld_struct_h->h_broker_cd;
				IS_ANY_ORA_ERROR
				 
				if (int_exist_rec == 0)
				{
				 printf("\n Inside if condition where int_exist_rec == 0 for MT_PTY_EXCH_MAP \n");   
				if (CO_InsertErr
								(l_debug_info_ptr,
								 ERR_PARTY_NOT_FOUND, 
								 p_dl_exchgord_upld_struct_h->h_broker_cd,
								 APL_NULL_STRING,
								 APL_NULL_STRING,
								 __LINE__,
								 __FILE__
								) != APL_SUCCESS)
								

				 APL_GOBACK_FAIL
				}

/*ISKB_2091 Check whether Broker code exists or not - END*/
		}

		else

		{

      printf("\n...............for NSE only..........");

			EXEC SQL select count(*) into :int_exist_rec from DL_EXCHGORD_UPLD where
				       ORDER_NO=:p_dl_exchgord_upld_struct_h->h_order_no and
						BROKER_CD= :p_dl_exchgord_upld_struct_h->h_broker_cd and DEAL_DATE=:p_dl_exchgord_upld_struct_h->h_deal_date;



			IS_ANY_ORA_ERROR


			if (int_exist_rec > 0)
				 {

        printf("\n..............error is here..........2...\n");

					  
					/*  if (CO_InsertErr(l_debug_info_ptr,
											 ERR_EXCHGORD_EXISTS,
											p_dl_exchgord_upld_struct_h->h_order_no,
											p_dl_exchgord_upld_struct_h->h_exchg_code,
											 APL_NULL_STRING,
											 __LINE__,
											 __FILE__
											) != APL_SUCCESS)
					*/
					

					if (CO_InsertErr
					(l_debug_info_ptr,
					 MAP_DET_EXIST, 
					 APL_NULL_STRING,
					 APL_NULL_STRING,
					 APL_NULL_STRING,
					 __LINE__,
					 __FILE__
					) != APL_SUCCESS)
							            
                        printf("\n Inside else condition \n");
			                   APL_GOBACK_FAIL

				 }


		}


		}

		else

		

         {

			EXEC SQL select count(*) into :int_exist_rec from DL_EXCHGORD_UPLD where
				       ORDER_NO=:p_dl_exchgord_upld_struct_h->h_order_no and
						EXCHG_CODE=:p_dl_exchgord_upld_struct_h->h_exchg_code and DEAL_DATE=:p_dl_exchgord_upld_struct_h->h_deal_date;



			IS_ANY_ORA_ERROR


			if (int_exist_rec > 0)
				 {
					  
					/*  if (CO_InsertErr(l_debug_info_ptr,
											 ERR_EXCHGORD_EXISTS,
											p_dl_exchgord_upld_struct_h->h_order_no,
											p_dl_exchgord_upld_struct_h->h_exchg_code,
											 APL_NULL_STRING,
											 __LINE__,
											 __FILE__
											) != APL_SUCCESS)
					*/
					

					if (CO_InsertErr
					(l_debug_info_ptr,
					 MAP_DET_EXIST, 
					 APL_NULL_STRING,
					 APL_NULL_STRING,
					 APL_NULL_STRING,
					 __LINE__,
					 __FILE__
					) != APL_SUCCESS)
							            
                        printf("\n Inside else condition \n");
			                   APL_GOBACK_FAIL

				 }


		

		}

		Alert("\n Before insert in order table \n");


	/*Priyanka - order with zero quantity should not be inserted*/
	if(p_dl_exchgord_upld_struct_h->h_qty >0)
		{

		Alert("\n PS - abt to insert \n");
		EXEC SQL INSERT INTO DL_EXCHGORD_UPLD VALUES (:p_dl_exchgord_upld_struct_h:l_dl_exchgord_upld_struct_i);

		IS_ANY_ORA_ERROR_AND_DUPLICATE(MAP_DET_EXIST,APL_NULL_STRING,APL_NULL_STRING,APL_NULL_STRING)
	   
		strcpy(p_order_no,p_dl_exchgord_upld_struct_h->h_order_no);	
		}
		else	/*Priyanka - order with zero quantity should not be inserted*/
		{
		   sprintf(chr_l_buf," Record with Zero Quantity  for order -  |%s| not inserted\n",p_dl_exchgord_upld_struct_h->h_order_no);
		  CO_ProcMonitor(APL_OUT_FILE,chr_l_buf,NULL,NULL);
	
		}

	}
	else
	{

		l_key_codes[0]="ORDER_NO";
		l_key_codes[1] = "DEAL_DATE";	 
		l_key_codes[2] = "BROKER_CD";	
		l_key_codes[3] = APL_NULL_STRING;

		l_key_values[0]=p_dl_exchgord_upld_struct_h -> h_order_no;
		l_key_values[1] = p_dl_exchgord_upld_struct_h -> h_deal_date;	 
		l_key_values[2] = p_dl_exchgord_upld_struct_h -> h_broker_cd;	 
		l_key_values[3] = APL_NULL_STRING;

		strcpy(chr_l_table_name,"DL_EXCHGORD_UPLD");

 IF_COND_EXISTS("DL_DEAL","EXCH")     //bank specific condition added by jeoti
      
		{


          printf("\n...........inside bank specific condition checking.....4....");

 if(strcmp(p_dl_exchgord_upld_struct_h->h_exchg_code,"BSE") != 0)

	{


		int_retval = CR_Rtv_MastChldChrVal( l_key_codes,
				l_key_values,
				chr_l_table_name,
				"ACCESS_STAMP",
				chr_l_field_val,
				l_debug_info_ptr);

		if (int_retval != APL_SUCCESS)
			APL_GOBACK_FAIL


	}

else
		{

					l_key_codes[0]="ORDER_NO";         
					l_key_codes[1]="SETTL_NO";	     
					l_key_codes[2]="BROKER_CD";      
					l_key_codes[3]=APL_NULL_STRING;  

					l_key_values[0]=p_dl_exchgord_upld_struct_h -> h_order_no;
					l_key_values[1]=p_dl_exchgord_upld_struct_h -> h_settl_no;
					l_key_values[2]=p_dl_exchgord_upld_struct_h -> h_broker_cd;
					l_key_values[3] = APL_NULL_STRING;

	            	
				int_retval = CR_Rtv_MastChldChrVal( l_key_codes,
								l_key_values,
								chr_l_table_name,
								"ACCESS_STAMP",
								chr_l_field_val,
								l_debug_info_ptr);

						if (int_retval != APL_SUCCESS)
							APL_GOBACK_FAIL
		}


		}


		else

		{

		int_retval = CR_Rtv_MastChldChrVal( l_key_codes,
				l_key_values,
				chr_l_table_name,
				"ACCESS_STAMP",
				chr_l_field_val,
				l_debug_info_ptr);

		if (int_retval != APL_SUCCESS)
			APL_GOBACK_FAIL


		}


				strcpy(chr_acc_stamp_compare,chr_l_field_val);

		 IF_COND_EXISTS("DL_DEAL","EXCH")     //bank specific condition added by jeoti
{

 printf("\n...........inside bank specific condition checking.....5....");

   if(strcmp(p_dl_exchgord_upld_struct_h->h_exchg_code,"BSE") != 0)

		    {


					l_key_codes[0]="ORDER_NO";
					l_key_codes[1] = "DEAL_DATE";	 
					l_key_codes[2] = "BROKER_CD";	 
					l_key_codes[3] = APL_NULL_STRING;

					l_key_values[0] = p_dl_exchgord_upld_struct_h -> h_order_no;
					l_key_values[1] = p_dl_exchgord_upld_struct_h -> h_deal_date;	
					l_key_values[2] = p_dl_exchgord_upld_struct_h -> h_broker_cd;	
					l_key_values[3] = APL_NULL_STRING;

		int_retval = CR_Rtv_MastChldChrVal( l_key_codes,
				l_key_values,
				chr_l_table_name,
				"STATUS",
				chr_l_field_val,
				l_debug_info_ptr);

		if (int_retval != APL_SUCCESS)
			APL_GOBACK_FAIL

						

		}

else
		{
			
					l_key_codes[0]="ORDER_NO";         
					l_key_codes[1]="SETTL_NO";	     
					l_key_codes[2]="BROKER_CD";      
					l_key_codes[3]=APL_NULL_STRING;  

					l_key_values[0]=p_dl_exchgord_upld_struct_h -> h_order_no;
					l_key_values[1]=p_dl_exchgord_upld_struct_h -> h_settl_no;
					l_key_values[2]=p_dl_exchgord_upld_struct_h -> h_broker_cd;
					l_key_values[3] = APL_NULL_STRING;

						
						
						int_retval = CR_Rtv_MastChldChrVal( l_key_codes,
												l_key_values,
												chr_l_table_name,
												"STATUS",
												chr_l_field_val,
												l_debug_info_ptr);

							if (int_retval != APL_SUCCESS)
								APL_GOBACK_FAIL

							
		
		}


}


else


		{
                     l_key_codes[0]="ORDER_NO";
					l_key_codes[1] = "DEAL_DATE";	 
					l_key_codes[2] = "EXCHG_CODE";	 
					l_key_codes[3] = APL_NULL_STRING;

					l_key_values[0] = p_dl_exchgord_upld_struct_h -> h_order_no;
					l_key_values[1] = p_dl_exchgord_upld_struct_h -> h_deal_date;	
					l_key_values[2] = p_dl_exchgord_upld_struct_h -> h_exchg_code;	
					l_key_values[3] = APL_NULL_STRING;

		int_retval = CR_Rtv_MastChldChrVal( l_key_codes,
				l_key_values,
				chr_l_table_name,
				"STATUS",
				chr_l_field_val,
				l_debug_info_ptr);

		if (int_retval != APL_SUCCESS)
			APL_GOBACK_FAIL
		}



				strcpy(chr_status_compare,chr_l_field_val);
	}

	printf("Reached here --- raks \n");
	if (!strcmp(p_intl_envdatastruct_h->h_mode,APL_FUNC_MODIFY))
	{
		/*
		if(strstr(p_dl_exchgord_upld_struct_h->h_maker,"GFU")==0)
		{
			p_i_checker =-1;
			p_i_checker_dt =-1;
			strcpy(p_dl_exchgord_upld_struct_h->h_checker,APL_NULL_STRING);
			strcpy(p_dl_exchgord_upld_struct_h->h_checker_dt,APL_NULL_STRING);
		}
		*/
		APL_IF_DEBUG
		{
			CO_ProcMonitor(APL_OUT_FILE, "Entered modify of Function MT_ModDBNoDlvDet\n",
					NULL,p_intl_envdatastruct_h);
		}
		
		if (!strcmp(p_dl_exchgord_upld_struct_h->h_access_stamp,chr_acc_stamp_compare))
		{
			strcpy(p_dl_exchgord_upld_struct_h->h_access_stamp,chr_sys_access_stamp);
			l_dl_exchgord_upld_struct_i->i_access_stamp =0;
		if(strstr(p_dl_exchgord_upld_struct_h->h_maker,"GFU")==0)
		{
			strcpy(p_dl_exchgord_upld_struct_h->h_status,STATUS_UAUTH);
		}
		else
			strcpy(p_dl_exchgord_upld_struct_h->h_status,STATUS_AUTH);

			l_dl_exchgord_upld_struct_i->i_status =0;
			
			printf("Just before modify p_dl_exchgord_upld_struct_h ->h_is_nodelv |%s|\n",p_dl_exchgord_upld_struct_h ->h_is_nodelv);

 IF_COND_EXISTS("DL_DEAL","EXCH")     //bank specific condition added by jeoti

{

 printf("\n...........inside bank specific condition checking.....6....");

    if(strcmp(p_dl_exchgord_upld_struct_h->h_exchg_code,"BSE") != 0)    // condition  added by jeoti

		{
			EXEC SQL UPDATE DL_EXCHGORD_UPLD  SET 
				MAKER =:p_intl_envdatastruct_h->usr:p_i_maker,
						MAKER_DT =:chr_sys_access_stamp:p_i_maker_dt,
						CHECKER =:p_dl_exchgord_upld_struct_h->h_checker:p_i_checker,
						CHECKER_DT =:p_dl_exchgord_upld_struct_h->h_checker_dt:p_i_checker_dt,
						STATUS =:p_dl_exchgord_upld_struct_h->h_status:l_dl_exchgord_upld_struct_i->i_status,
/*						EXCHG_CODE =:p_dl_exchgord_upld_struct_h->h_exchg_code :l_dl_exchgord_upld_struct_i-> i_exchg_code, */ /* CHANGES BY AMISH - HBDL_012 - 27/07/2007 */
						CLIENT =:p_dl_exchgord_upld_struct_h->h_cln_code:l_dl_exchgord_upld_struct_i-> i_cln_code,
						INSTR_CODE =:p_dl_exchgord_upld_struct_h->h_instr_code :l_dl_exchgord_upld_struct_i-> i_instr_code,
						BROKER_CD =:p_dl_exchgord_upld_struct_h->h_broker_cd :l_dl_exchgord_upld_struct_i-> i_broker_cd,
						QTY =:p_dl_exchgord_upld_struct_h->h_qty :l_dl_exchgord_upld_struct_i-> i_qty,
						SETTL_NO =:p_dl_exchgord_upld_struct_h->h_settl_no :l_dl_exchgord_upld_struct_i-> i_settl_no,
						DL_PRICE =:p_dl_exchgord_upld_struct_h->h_dl_price :l_dl_exchgord_upld_struct_i-> i_dl_price,
						DL_AMT =:p_dl_exchgord_upld_struct_h->h_dl_amt :l_dl_exchgord_upld_struct_i-> i_dl_amt,
/*						DEAL_DATE =:p_dl_exchgord_upld_struct_h->h_deal_date :l_dl_exchgord_upld_struct_i-> i_deal_date, */ /* HBDL_012 changes by amish - exchange order enhancement 25/07/2007*/
						MKT_TYPE =:p_dl_exchgord_upld_struct_h->h_mkt_type :l_dl_exchgord_upld_struct_i-> i_mkt_type,
						SCRIP_GRP =:p_dl_exchgord_upld_struct_h->h_scrip_grp :l_dl_exchgord_upld_struct_i-> i_scrip_grp,
						CREATION_TYPE =:p_dl_exchgord_upld_struct_h->h_creation_type :l_dl_exchgord_upld_struct_i-> i_creation_type,
						DEAL_REF_NO =:p_dl_exchgord_upld_struct_h->h_deal_ref_no :l_dl_exchgord_upld_struct_i-> i_deal_ref_no,
						BUY_SELL_FLG =:p_dl_exchgord_upld_struct_h->h_buy_sell_flg :l_dl_exchgord_upld_struct_i->i_buy_sell_flg,
						MATCHED =:p_dl_exchgord_upld_struct_h->h_matched :l_dl_exchgord_upld_struct_i-> i_matched,
					   ACCESS_STAMP =:chr_sys_access_stamp:p_i_access_stamp,
						FILELINKINFO =:p_dl_exchgord_upld_struct_h->h_filelinkinfo :l_dl_exchgord_upld_struct_i->i_filelinkinfo,
						ROWSEQUENCE =:p_dl_exchgord_upld_struct_h->h_rowsequence :l_dl_exchgord_upld_struct_i->i_rowsequence,
						IS_NODELV=:p_dl_exchgord_upld_struct_h->h_is_nodelv :l_dl_exchgord_upld_struct_i->i_is_nodelv
					/*	NODELV_REPDATE=:p_dl_exchgord_upld_struct_h->h_nodelv_repdate :l_dl_exchgord_upld_struct_i->i_nodelv_repdate,
						ORDER_DATA=:p_dl_exchgord_upld_struct_h->h_order_data :l_dl_exchgord_upld_struct_i->i_order_data*/

							WHERE 
							ORDER_NO =:p_dl_exchgord_upld_struct_h->h_order_no
							AND BROKER_CD = :p_dl_exchgord_upld_struct_h->h_broker_cd /* HBDL_012 - changes by amish - exchange order enhancement 27/07/2007*/
							AND DEAL_DATE = :p_dl_exchgord_upld_struct_h->h_deal_date; /* HBDL_012 changes by amish - exchange order enhancement 25/07/2007*/

			IS_ANY_ORA_ERROR	

		}
else   
		{
				  EXEC SQL UPDATE DL_EXCHGORD_UPLD  SET 
							MAKER =:p_intl_envdatastruct_h->usr:p_i_maker,
							MAKER_DT =:chr_sys_access_stamp:p_i_maker_dt,
							CHECKER =:p_dl_exchgord_upld_struct_h->h_checker:p_i_checker,
							CHECKER_DT =:p_dl_exchgord_upld_struct_h->h_checker_dt:p_i_checker_dt,
							STATUS=:p_dl_exchgord_upld_struct_h->h_status:l_dl_exchgord_upld_struct_i->i_status,
							CLIENT =:p_dl_exchgord_upld_struct_h->h_cln_code:l_dl_exchgord_upld_struct_i-> i_cln_code,
							INSTR_CODE =:p_dl_exchgord_upld_struct_h->h_instr_code :l_dl_exchgord_upld_struct_i-> i_instr_code,
							BROKER_CD =:p_dl_exchgord_upld_struct_h->h_broker_cd :l_dl_exchgord_upld_struct_i-> i_broker_cd,
							QTY =:p_dl_exchgord_upld_struct_h->h_qty :l_dl_exchgord_upld_struct_i-> i_qty,
							SETTL_NO =:p_dl_exchgord_upld_struct_h->h_settl_no :l_dl_exchgord_upld_struct_i-> i_settl_no,
							DL_PRICE =:p_dl_exchgord_upld_struct_h->h_dl_price :l_dl_exchgord_upld_struct_i-> i_dl_price,
							DL_AMT =:p_dl_exchgord_upld_struct_h->h_dl_amt :l_dl_exchgord_upld_struct_i-> i_dl_amt,
							MKT_TYPE =:p_dl_exchgord_upld_struct_h->h_mkt_type :l_dl_exchgord_upld_struct_i-> i_mkt_type,
							SCRIP_GRP =:p_dl_exchgord_upld_struct_h->h_scrip_grp :l_dl_exchgord_upld_struct_i-> i_scrip_grp,
							CREATION_TYPE =:p_dl_exchgord_upld_struct_h->h_creation_type :l_dl_exchgord_upld_struct_i-> i_creation_type,
							DEAL_REF_NO =:p_dl_exchgord_upld_struct_h->h_deal_ref_no :l_dl_exchgord_upld_struct_i-> i_deal_ref_no,
							BUY_SELL_FLG =:p_dl_exchgord_upld_struct_h->h_buy_sell_flg :l_dl_exchgord_upld_struct_i->i_buy_sell_flg,
							MATCHED =:p_dl_exchgord_upld_struct_h->h_matched :l_dl_exchgord_upld_struct_i-> i_matched,
						   ACCESS_STAMP =:chr_sys_access_stamp:p_i_access_stamp,
							FILELINKINFO =:p_dl_exchgord_upld_struct_h->h_filelinkinfo :l_dl_exchgord_upld_struct_i->i_filelinkinfo,
							ROWSEQUENCE =:p_dl_exchgord_upld_struct_h->h_rowsequence :l_dl_exchgord_upld_struct_i->i_rowsequence,
							IS_NODELV=:p_dl_exchgord_upld_struct_h->h_is_nodelv :l_dl_exchgord_upld_struct_i->i_is_nodelv
						
							WHERE 
							ORDER_NO =:p_dl_exchgord_upld_struct_h->h_order_no
							AND SETTL_NO = :p_dl_exchgord_upld_struct_h->h_settl_no 
							AND BROKER_CD = :p_dl_exchgord_upld_struct_h->h_broker_cd; 

			                 IS_ANY_ORA_ERROR
								 
			}

}

else

			{

               EXEC SQL UPDATE DL_EXCHGORD_UPLD  SET 
				        MAKER =:p_intl_envdatastruct_h->usr:p_i_maker,
						MAKER_DT =:chr_sys_access_stamp:p_i_maker_dt,
						CHECKER =:p_dl_exchgord_upld_struct_h->h_checker:p_i_checker,
						CHECKER_DT =:p_dl_exchgord_upld_struct_h->h_checker_dt:p_i_checker_dt,
						STATUS =:p_dl_exchgord_upld_struct_h->h_status:l_dl_exchgord_upld_struct_i->i_status,
						CLIENT =:p_dl_exchgord_upld_struct_h->h_cln_code:l_dl_exchgord_upld_struct_i-> i_cln_code,
						INSTR_CODE =:p_dl_exchgord_upld_struct_h->h_instr_code :l_dl_exchgord_upld_struct_i-> i_instr_code,
						BROKER_CD =:p_dl_exchgord_upld_struct_h->h_broker_cd :l_dl_exchgord_upld_struct_i-> i_broker_cd,
						QTY =:p_dl_exchgord_upld_struct_h->h_qty :l_dl_exchgord_upld_struct_i-> i_qty,
						SETTL_NO =:p_dl_exchgord_upld_struct_h->h_settl_no :l_dl_exchgord_upld_struct_i-> i_settl_no,
						DL_PRICE =:p_dl_exchgord_upld_struct_h->h_dl_price :l_dl_exchgord_upld_struct_i-> i_dl_price,
						DL_AMT =:p_dl_exchgord_upld_struct_h->h_dl_amt :l_dl_exchgord_upld_struct_i-> i_dl_amt,
						MKT_TYPE =:p_dl_exchgord_upld_struct_h->h_mkt_type :l_dl_exchgord_upld_struct_i-> i_mkt_type,
						SCRIP_GRP =:p_dl_exchgord_upld_struct_h->h_scrip_grp :l_dl_exchgord_upld_struct_i-> i_scrip_grp,
						CREATION_TYPE =:p_dl_exchgord_upld_struct_h->h_creation_type :l_dl_exchgord_upld_struct_i-> i_creation_type,
						DEAL_REF_NO =:p_dl_exchgord_upld_struct_h->h_deal_ref_no :l_dl_exchgord_upld_struct_i-> i_deal_ref_no,
						BUY_SELL_FLG =:p_dl_exchgord_upld_struct_h->h_buy_sell_flg :l_dl_exchgord_upld_struct_i->i_buy_sell_flg,
						MATCHED =:p_dl_exchgord_upld_struct_h->h_matched :l_dl_exchgord_upld_struct_i-> i_matched,
					   ACCESS_STAMP =:chr_sys_access_stamp:p_i_access_stamp,
						FILELINKINFO =:p_dl_exchgord_upld_struct_h->h_filelinkinfo :l_dl_exchgord_upld_struct_i->i_filelinkinfo,
						ROWSEQUENCE =:p_dl_exchgord_upld_struct_h->h_rowsequence :l_dl_exchgord_upld_struct_i->i_rowsequence,
						IS_NODELV=:p_dl_exchgord_upld_struct_h->h_is_nodelv :l_dl_exchgord_upld_struct_i->i_is_nodelv
					

							WHERE 
							ORDER_NO =:p_dl_exchgord_upld_struct_h->h_order_no
							AND EXCHG_CODE = :p_dl_exchgord_upld_struct_h->h_exchg_code 
							AND DEAL_DATE = :p_dl_exchgord_upld_struct_h->h_deal_date; 

			             IS_ANY_ORA_ERROR	
			}

			
		}
		else 
		{
			if (CO_InsertErr
					(l_debug_info_ptr,
					 ERR_ACCESSSTAMP_CHGD, 
					 APL_NULL_STRING,
					 APL_NULL_STRING,
					 APL_NULL_STRING,
					 __LINE__,
					 __FILE__
					) != APL_SUCCESS)
				APL_GOBACK_FAIL
					APL_GOBACK_FAIL
		} 
	}

	if (!strcmp(p_intl_envdatastruct_h->h_mode,APL_FUNC_AUTHORISE))
	{

		APL_IF_DEBUG
		{
			CO_ProcMonitor(APL_OUT_FILE, "Entered authorize of Function MT_ModDBNoDlvDet\n",
					NULL,p_intl_envdatastruct_h);
		}

		if (!strcmp(p_dl_exchgord_upld_struct_h->h_access_stamp,chr_acc_stamp_compare))
		{
			if(strcmp(p_dl_exchgord_upld_struct_h->h_status,STATUS_DEL_UAUTH))
			{
				strcpy(p_dl_exchgord_upld_struct_h->h_access_stamp,chr_sys_access_stamp);
				l_dl_exchgord_upld_struct_i->i_access_stamp =0;
				strcpy(p_dl_exchgord_upld_struct_h->h_checker,p_intl_envdatastruct_h->usr);
				l_dl_exchgord_upld_struct_i->i_checker=0;
				strcpy(p_dl_exchgord_upld_struct_h->h_checker_dt,chr_sys_access_stamp);
				l_dl_exchgord_upld_struct_i->i_checker_dt=0;
				strcpy(p_dl_exchgord_upld_struct_h->h_status,STATUS_AUTH);
				l_dl_exchgord_upld_struct_i->i_status =0;

				IF_COND_EXISTS("DL_DEAL","EXCH")     //bank specific condition added by jeoti

{

	 printf("\n...........inside bank specific condition checking.....7....");

     if(strcmp(p_dl_exchgord_upld_struct_h->h_exchg_code,"BSE") != 0)     //added by jeoti
				
			{
				  EXEC SQL UPDATE DL_EXCHGORD_UPLD SET 
								CHECKER =:p_intl_envdatastruct_h->usr:p_i_checker,
								CHECKER_DT =:chr_sys_access_stamp:p_i_access_stamp,
								ACCESS_STAMP =:chr_sys_access_stamp:p_i_access_stamp,
								STATUS=:p_dl_exchgord_upld_struct_h->h_status:l_dl_exchgord_upld_struct_i->i_status
								WHERE 
								ORDER_NO =:p_dl_exchgord_upld_struct_h->h_order_no
								AND BROKER_CD = :p_dl_exchgord_upld_struct_h->h_broker_cd /* HBDL_012 - changes by amish - exchange order enhancement 27/07/2007 */
								 AND DEAL_DATE = :p_dl_exchgord_upld_struct_h->h_deal_date; /* HBDL_012 - changes by amish - exchange order enhancement 25/07/2007 */

					IS_ANY_ORA_ERROR
					
			}

	else
				{


				EXEC SQL UPDATE DL_EXCHGORD_UPLD SET 
					CHECKER =:p_intl_envdatastruct_h->usr:p_i_checker,
							  CHECKER_DT =:chr_sys_access_stamp:p_i_access_stamp,
							  ACCESS_STAMP =:chr_sys_access_stamp:p_i_access_stamp,
							  STATUS =:p_dl_exchgord_upld_struct_h->h_status:l_dl_exchgord_upld_struct_i->i_status
								  WHERE 
								ORDER_NO =:p_dl_exchgord_upld_struct_h->h_order_no
							AND SETTL_NO = :p_dl_exchgord_upld_struct_h->h_settl_no 
							AND BROKER_CD = :p_dl_exchgord_upld_struct_h->h_broker_cd; 

								 IS_ANY_ORA_ERROR
				}

      }

else
				{
				EXEC SQL UPDATE DL_EXCHGORD_UPLD SET 
					CHECKER =:p_intl_envdatastruct_h->usr:p_i_checker,
							  CHECKER_DT =:chr_sys_access_stamp:p_i_access_stamp,
							  ACCESS_STAMP =:chr_sys_access_stamp:p_i_access_stamp,
							  STATUS =:p_dl_exchgord_upld_struct_h->h_status:l_dl_exchgord_upld_struct_i->i_status
								  WHERE 
								  ORDER_NO =:p_dl_exchgord_upld_struct_h->h_order_no
								  AND EXCHG_CODE = :p_dl_exchgord_upld_struct_h->h_exchg_code /* HBDL_012 - changes by amish - exchange order enhancement 27/07/2007 */
								   AND DEAL_DATE = :p_dl_exchgord_upld_struct_h->h_deal_date; /* HBDL_012 - changes by amish - exchange order enhancement 25/07/2007 */

					IS_ANY_ORA_ERROR
				}

			}
			else  
			{

IF_COND_EXISTS("DL_DEAL","EXCH")     //bank specific condition added by jeoti


{

	 printf("\n...........inside bank specific condition checking.....8....");

     if(strcmp(p_dl_exchgord_upld_struct_h->h_exchg_code,"BSE") != 0)
				{

				EXEC SQL DELETE DL_EXCHGORD_UPLD 
					WHERE 
					ORDER_NO =:p_dl_exchgord_upld_struct_h->h_order_no
					AND BROKER_CD = :p_dl_exchgord_upld_struct_h->h_broker_cd /* HBDL_012 - changes by amish - exchange order enhancement 27/07/2007*/
					AND DEAL_DATE = :p_dl_exchgord_upld_struct_h->h_deal_date; /*  HBDL_012 - changes by amish - exchange order enhancement 25/07/2007*/

				IS_ANY_ORA_ERROR

				}

	else    
				{


                  EXEC SQL DELETE DL_EXCHGORD_UPLD 
					WHERE 
					ORDER_NO =:p_dl_exchgord_upld_struct_h->h_order_no
					AND SETTL_NO = :p_dl_exchgord_upld_struct_h->h_settl_no 
					AND BROKER_CD = :p_dl_exchgord_upld_struct_h->h_broker_cd; 

				IS_ANY_ORA_ERROR

				}

				
			}


			else  

			{

				EXEC SQL DELETE DL_EXCHGORD_UPLD 
					WHERE 
					ORDER_NO =:p_dl_exchgord_upld_struct_h->h_order_no
					AND EXCHG_CODE = :p_dl_exchgord_upld_struct_h->h_exchg_code 
					AND DEAL_DATE = :p_dl_exchgord_upld_struct_h->h_deal_date; 

				IS_ANY_ORA_ERROR
			}

			}
		}
		else 
		{
			if (CO_InsertErr
					(l_debug_info_ptr,
					 ERR_ACCESSSTAMP_CHGD, 
					 APL_NULL_STRING,
					 APL_NULL_STRING,
					 APL_NULL_STRING,
					 __LINE__,
					 __FILE__
					) != APL_SUCCESS)
				APL_GOBACK_FAIL
					APL_GOBACK_FAIL
		} 
	}

	if (!strcmp(p_intl_envdatastruct_h->h_mode,APL_FUNC_RESET))
	{

		APL_IF_DEBUG
		{
			CO_ProcMonitor(APL_OUT_FILE, "Entered reset of Function MT_ModDBNoDlvDet\n",
					NULL,p_intl_envdatastruct_h);
		}

		if (!strcmp(p_dl_exchgord_upld_struct_h->h_access_stamp,chr_acc_stamp_compare))
		{
			/* Added by Vedavati */
			
			if(!strcmp(p_dl_exchgord_upld_struct_h->h_status,"PM"))
			  {

				   IF_COND_EXISTS("DL_DEAL","EXCH")     //bank specific condition added by jeoti
	  {

             printf("\n...........inside bank specific condition checking.....9....");
				  

           if(strcmp(p_dl_exchgord_upld_struct_h->h_exchg_code,"BSE") != 0)
				  {

							   EXEC SQL UPDATE DL_EXCHGORD_UPLD SET MATCHED = 'N'
							   WHERE
					    ORDER_NO =:p_dl_exchgord_upld_struct_h->h_order_no
						AND BROKER_CD = :p_dl_exchgord_upld_struct_h->h_broker_cd  /* HBDL_012 - changes by amish - exchange order enhancement 27/07/2007*/
						AND DEAL_DATE = :p_dl_exchgord_upld_struct_h->h_deal_date; /*  HBDL_012 - changes by amish - exchange order enhancement 25/07/2007*/
							   IS_ANY_ORA_ERROR
					   
				  }
          else
				  {

                     EXEC SQL UPDATE DL_EXCHGORD_UPLD SET MATCHED = 'N'
					     WHERE
					 ORDER_NO =:p_dl_exchgord_upld_struct_h->h_order_no
					AND SETTL_NO = :p_dl_exchgord_upld_struct_h->h_settl_no 
					AND BROKER_CD = :p_dl_exchgord_upld_struct_h->h_broker_cd; 

						   IS_ANY_ORA_ERROR
				  }


				  }


   else

				  {

                  EXEC SQL UPDATE DL_EXCHGORD_UPLD SET MATCHED = 'N'
						   WHERE
						  ORDER_NO =:p_dl_exchgord_upld_struct_h->h_order_no
							AND EXCHG_CODE = :p_dl_exchgord_upld_struct_h->h_exchg_code 
							AND DEAL_DATE = :p_dl_exchgord_upld_struct_h->h_deal_date; 

						   IS_ANY_ORA_ERROR

				  }




			  }
			
			/* Added the || condition - Vedavati */
			if(!strcmp(p_dl_exchgord_upld_struct_h->h_status,STATUS_DEL_UAUTH)||(!strcmp(p_dl_exchgord_upld_struct_h->h_status,"PM")))
			{
				strcpy(p_dl_exchgord_upld_struct_h->h_access_stamp,chr_sys_access_stamp);
				l_dl_exchgord_upld_struct_i->i_access_stamp =0;
				strcpy(p_dl_exchgord_upld_struct_h->h_checker,p_intl_envdatastruct_h->usr);
				l_dl_exchgord_upld_struct_i->i_checker=0;
				strcpy(p_dl_exchgord_upld_struct_h->h_checker_dt,chr_sys_access_stamp);
				l_dl_exchgord_upld_struct_i->i_checker_dt=0;
				strcpy(p_dl_exchgord_upld_struct_h->h_status,STATUS_AUTH);
				l_dl_exchgord_upld_struct_i->i_status =0;
					
				printf("Amit---------Status is %s",p_dl_exchgord_upld_struct_h->h_status);
				/******************* condition added by jeoti***********************************************/
 IF_COND_EXISTS("DL_DEAL","EXCH")     //bank specific condition added by jeoti


	{


		 printf("\n...........inside bank specific condition checking.....10....");

            if(strcmp(p_dl_exchgord_upld_struct_h->h_exchg_code,"BSE") != 0)

				{


				EXEC SQL UPDATE DL_EXCHGORD_UPLD SET 
					CHECKER =:p_intl_envdatastruct_h->usr:p_i_checker,
							  CHECKER_DT =:chr_sys_access_stamp:p_i_access_stamp,
							  ACCESS_STAMP =:chr_sys_access_stamp:p_i_access_stamp,
							  STATUS =:p_dl_exchgord_upld_struct_h->h_status:l_dl_exchgord_upld_struct_i->i_status
								  WHERE 
								  ORDER_NO =:p_dl_exchgord_upld_struct_h->h_order_no
									AND BROKER_CD = :p_dl_exchgord_upld_struct_h->h_broker_cd /* HBDL_012 - changes by amish - exchange order enhancement 27/07/2007*/
								AND DEAL_DATE = :p_dl_exchgord_upld_struct_h->h_deal_date; /* HBDL_012 - changes by amish - exchange order enhancement 25/07/2007*/

				IS_ANY_ORA_ERROR
				
				}

           else
				{
                        EXEC SQL UPDATE DL_EXCHGORD_UPLD SET 
					     CHECKER =:p_intl_envdatastruct_h->usr:p_i_checker,
							  CHECKER_DT =:chr_sys_access_stamp:p_i_access_stamp,
							  ACCESS_STAMP =:chr_sys_access_stamp:p_i_access_stamp,
							  STATUS =:p_dl_exchgord_upld_struct_h->h_status:l_dl_exchgord_upld_struct_i->i_status
								  WHERE 
								ORDER_NO =:p_dl_exchgord_upld_struct_h->h_order_no
								AND SETTL_NO = :p_dl_exchgord_upld_struct_h->h_settl_no 
								AND BROKER_CD = :p_dl_exchgord_upld_struct_h->h_broker_cd; 

				        IS_ANY_ORA_ERROR
				}

				}

				else

				{
                      EXEC SQL UPDATE DL_EXCHGORD_UPLD SET 
					          CHECKER =:p_intl_envdatastruct_h->usr:p_i_checker,
							  CHECKER_DT =:chr_sys_access_stamp:p_i_access_stamp,
							  ACCESS_STAMP =:chr_sys_access_stamp:p_i_access_stamp,
							  STATUS =:p_dl_exchgord_upld_struct_h->h_status:l_dl_exchgord_upld_struct_i->i_status
								  WHERE 
								  ORDER_NO =:p_dl_exchgord_upld_struct_h->h_order_no
									AND EXCHG_CODE = :p_dl_exchgord_upld_struct_h->h_exchg_code /* HBDL_012 - changes by amish - exchange order enhancement 27/07/2007*/
								AND DEAL_DATE = :p_dl_exchgord_upld_struct_h->h_deal_date; /* HBDL_012 - changes by amish - exchange order enhancement 25/07/2007*/

				IS_ANY_ORA_ERROR

				}

				
			}
		}

		
				
		else 
		{
			if (CO_InsertErr
					(l_debug_info_ptr,
					 ERR_ACCESSSTAMP_CHGD, 
					 APL_NULL_STRING,
					 APL_NULL_STRING,
					 APL_NULL_STRING,
					 __LINE__,
					 __FILE__
					) != APL_SUCCESS)
				APL_GOBACK_FAIL
					APL_GOBACK_FAIL
		} 
	}

	if (!strcmp(p_intl_envdatastruct_h->h_mode,APL_FUNC_DELETE))
	{
		p_i_checker =-1;
		p_i_checker_dt =-1;
		strcpy(p_dl_exchgord_upld_struct_h->h_checker,APL_NULL_STRING);
		strcpy(p_dl_exchgord_upld_struct_h->h_checker_dt,APL_NULL_STRING);

		APL_IF_DEBUG
		{
			CO_ProcMonitor(APL_OUT_FILE, "Entered delete of Function MT_ModDBNoDlvDet\n",
					NULL,p_intl_envdatastruct_h);
		}

		if (!strcmp(p_dl_exchgord_upld_struct_h->h_access_stamp,chr_acc_stamp_compare))
		{
			strcpy(p_dl_exchgord_upld_struct_h->h_access_stamp,chr_sys_access_stamp);
			l_dl_exchgord_upld_struct_i->i_access_stamp =0;
			strcpy(p_dl_exchgord_upld_struct_h->h_status,STATUS_DEL_UAUTH);
			l_dl_exchgord_upld_struct_i->i_status =0;

IF_COND_EXISTS("DL_DEAL","EXCH")     //bank specific condition added by jeoti

			{

         printf("\n...........inside bank specific condition checking.....11....");


   if(strcmp(p_dl_exchgord_upld_struct_h->h_exchg_code,"BSE") != 0)

			{

			EXEC SQL UPDATE DL_EXCHGORD_UPLD SET 
				MAKER =:p_intl_envdatastruct_h->usr:p_i_maker,
						MAKER_DT =:chr_sys_access_stamp:p_i_maker_dt,
						CHECKER =:p_dl_exchgord_upld_struct_h->h_checker:p_i_checker,
						CHECKER_DT =:p_dl_exchgord_upld_struct_h->h_checker_dt:p_i_checker_dt,
						STATUS =:p_dl_exchgord_upld_struct_h->h_status:l_dl_exchgord_upld_struct_i->i_status,
						ACCESS_STAMP =:chr_sys_access_stamp:p_i_access_stamp
							WHERE 
							ORDER_NO =:p_dl_exchgord_upld_struct_h->h_order_no
							AND BROKER_CD = :p_dl_exchgord_upld_struct_h->h_broker_cd /* HBDL_012 - changes by amish - exchange order enhancement 27/07/2007*/
							AND DEAL_DATE = :p_dl_exchgord_upld_struct_h->h_deal_date; /* HBDL_012 - changes by amish - exchange order enhancement 25/07/2007*/

			IS_ANY_ORA_ERROR	
			
            }


/******************************added by jeoti****************************************************/

  else
			{


                  EXEC SQL UPDATE DL_EXCHGORD_UPLD SET 
				        MAKER =:p_intl_envdatastruct_h->usr:p_i_maker,
						MAKER_DT =:chr_sys_access_stamp:p_i_maker_dt,
						CHECKER =:p_dl_exchgord_upld_struct_h->h_checker:p_i_checker,
						CHECKER_DT =:p_dl_exchgord_upld_struct_h->h_checker_dt:p_i_checker_dt,
						STATUS =:p_dl_exchgord_upld_struct_h->h_status:l_dl_exchgord_upld_struct_i->i_status,
						ACCESS_STAMP =:chr_sys_access_stamp:p_i_access_stamp
							WHERE 
							ORDER_NO =:p_dl_exchgord_upld_struct_h->h_order_no
							AND SETTL_NO = :p_dl_exchgord_upld_struct_h->h_settl_no 
							AND BROKER_CD = :p_dl_exchgord_upld_struct_h->h_broker_cd; 

			IS_ANY_ORA_ERROR
			}

	}

			else

			{
               EXEC SQL UPDATE DL_EXCHGORD_UPLD SET 
				        MAKER =:p_intl_envdatastruct_h->usr:p_i_maker,
						MAKER_DT =:chr_sys_access_stamp:p_i_maker_dt,
						CHECKER =:p_dl_exchgord_upld_struct_h->h_checker:p_i_checker,
						CHECKER_DT =:p_dl_exchgord_upld_struct_h->h_checker_dt:p_i_checker_dt,
						STATUS =:p_dl_exchgord_upld_struct_h->h_status:l_dl_exchgord_upld_struct_i->i_status,
						ACCESS_STAMP =:chr_sys_access_stamp:p_i_access_stamp
							WHERE 
							ORDER_NO =:p_dl_exchgord_upld_struct_h->h_order_no
							AND EXCHG_CODE = :p_dl_exchgord_upld_struct_h->h_exchg_code 
							AND DEAL_DATE = :p_dl_exchgord_upld_struct_h->h_deal_date; 

			        IS_ANY_ORA_ERROR

			}


			
		}
		else 
		{
			if (CO_InsertErr
					(l_debug_info_ptr,
					 ERR_ACCESSSTAMP_CHGD, 
					 APL_NULL_STRING,
					 APL_NULL_STRING,
					 APL_NULL_STRING,
					 __LINE__,
					 __FILE__
					) != APL_SUCCESS)

				APL_GOBACK_FAIL
			
		} 
	}



	if (int_error_flag == APL_FAILURE)
	{
		APL_GOBACK_FAIL
	}
	APL_GOBACK_SUCCESS

		RETURN_SUCCESS :
		{
			APL_FUNCTION_RET_SUCCESS(APL_OUT_FILE)
				free(l_dl_exchgord_upld_struct_i);
			return(APL_SUCCESS);
		}
RETURN_FAILURE :
	{
		APL_FUNCTION_RET_FAILURE(APL_OUT_FILE)
			free(l_dl_exchgord_upld_struct_i);
		return(APL_FAILURE);
	}

}


int CO_Chk_ValAtExchOrdUpld(DL_EXCHGORD_UPLD_STRUCT_H *p_dl_exchgord_upld_struct_h,DEBUG_INFO_STRUCT_H **l_debug_info_ptr)

{

	struct sqlca sqlca;
	char l_chr_p_Instatus[3]=APL_NULL_STRING;
	char l_chr_p_Clstatus[3]=APL_NULL_STRING;
	char l_chr_p_Setstatus[3]=APL_NULL_STRING;
	short l_i_Status=0;
	short l_i_SetStatus=0;
	short l_i_CStatus=0;
	int int_error_flag=APL_SUCCESS;

#ifdef APL_THREADS
	APL_SET_CONTEXT
		EXEC SQL CONTEXT USE :my_ctx_local;
#endif

	APL_IF_DEBUG
	{
		CO_ProcMonitor(APL_OUT_FILE, "Entered Function CO_Chk_ValAtExchOrdUpldFn \n",
				NULL,NULL);
	}
	memset(l_chr_p_Instatus,NULL,3);
	memset(l_chr_p_Clstatus,NULL,3);
	memset(l_chr_p_Setstatus,NULL,3);

	EXEC SQL SELECT STATUS into :l_chr_p_Instatus:l_i_Status
		FROM MT_INSTRUMENT
		WHERE INSTR_CODE =:p_dl_exchgord_upld_struct_h->h_instr_code;
	IS_ANY_ORA_ERROR
		if (strcmp(l_chr_p_Instatus,STATUS_AUTH))
		{
			if(CO_InsertErr(
						l_debug_info_ptr,
						ERR_EXCHORDUP_INSTRU_CD_NOT_AUTH,
						APL_NULL_STRING,
						APL_NULL_STRING,
						APL_NULL_STRING,
						__LINE__,
						__FILE__
						) == APL_SUCCESS)
				int_error_flag = APL_FAILURE;
		}

	EXEC SQL SELECT STATUS into :l_chr_p_Clstatus:l_i_CStatus
		FROM MT_CLIENT
		WHERE CLN_CODE =:p_dl_exchgord_upld_struct_h->h_cln_code;

	IS_ANY_ORA_ERROR

		if (strcmp(l_chr_p_Clstatus,STATUS_AUTH))
		{
			if(CO_InsertErr(l_debug_info_ptr,
						ERR_EXCHORDUP_CLN_CD_NOT_AUTH,
						APL_NULL_STRING,
						APL_NULL_STRING,
						APL_NULL_STRING,
						__LINE__,
						__FILE__
						) == APL_SUCCESS)
				int_error_flag = APL_FAILURE;
		}

	/***** Start : Retro with HDFC to add Settl Type in Query - Rahul - 01-Apr-2007 *****/	
	IF_COND_EXISTS("DL_SETTL_NO","SETTL_NO_VAL")
	{
		printf("\nin ifffff\n");
		EXEC SQL 
		SELECT STATUS into :l_chr_p_Setstatus:l_i_SetStatus
		FROM MT_SETTL_CAL
		WHERE SETTL_NO =:p_dl_exchgord_upld_struct_h->h_settl_no 
			AND SETTL_TYPE=:p_dl_exchgord_upld_struct_h->h_mkt_type 
			AND EXCH_CODE =:p_dl_exchgord_upld_struct_h->h_exchg_code;
		
		IS_ANY_ORA_ERROR
		printf("\n\tStatus selected after considering Market/Settlement type also\n");
	}
	else
	{
	/***** End : Retro with HDFC to add Settl Type in Query - Rahul - 01-Apr-2007 *****/
		EXEC SQL SELECT STATUS into :l_chr_p_Setstatus:l_i_SetStatus
		FROM MT_SETTL_CAL
		WHERE SETTL_NO =:p_dl_exchgord_upld_struct_h->h_settl_no AND EXCH_CODE =:p_dl_exchgord_upld_struct_h->h_exchg_code;
				/* ISKB-492 Reverting changes */
        /*        AND SETTL_TYPE=:p_dl_exchgord_upld_struct_h->h_mkt_type
                AND STATUS = 'AA' ; *//* ISKB-416: Add by ASHISH 17-10-2007 */
	IS_ANY_ORA_ERROR
	}
	

	IS_ANY_ORA_ERROR

		printf("\n After selection from settlment cal p_dl_exchgord_upld_struct_h->h_settl_no is |%s|",p_dl_exchgord_upld_struct_h->h_settl_no);
		printf("\n After selection from settlment cal p_dl_exchgord_upld_struct_h->h_exchg_code is |%s|",p_dl_exchgord_upld_struct_h->h_exchg_code);
		printf("\n After selection from settlment cal l_chr_p_Setstatus is |%s|",l_chr_p_Setstatus);
		printf("\n After selection from settlment cal l_i_SetStatus is |%d|",l_i_SetStatus);
		if (strcmp(l_chr_p_Setstatus,STATUS_AUTH))
		{
			if(CO_InsertErr(
						l_debug_info_ptr,
						ERR_EXCHORDUP_SETT_NO_NOT_AUTH,
						APL_NULL_STRING,
						APL_NULL_STRING,
						APL_NULL_STRING,
						__LINE__,
						__FILE__
						) == APL_SUCCESS)
				int_error_flag = APL_FAILURE;
		}

	if (int_error_flag == APL_FAILURE)
	{
		APL_GOBACK_FAIL
	}
	else APL_GOBACK_SUCCESS

		RETURN_SUCCESS :
		{

			APL_IF_DEBUG
			{
				CO_ProcMonitor(APL_OUT_FILE, "Function CO_Chk_ValAtExchOrdUpldFn is successful\n",
						NULL,NULL);
			}

			return(APL_SUCCESS);
		}
RETURN_FAILURE :
	{

		APL_IF_DEBUG
		{
			CO_ProcMonitor(APL_OUT_FILE, "Function CO_Chk_ValAtExchOrdUpldFn is unsuccessful\n",
					NULL,NULL);
		}
		return(APL_FAILURE);
	}
}

int	CR_Chk_If_Exists(DL_EXCHGORD_UPLD_STRUCT_H *p_dl_exchgord_upld_struct_h,
							  int								  *p_exists,
							  INTL_ENV_DATA_STRUCT_H		 *p_intl_env_data_struct_h,
							  DEBUG_INFO_STRUCT_H		**l_debug_info_ptr)
{

	DL_EXCHGORD_UPLD_STRUCT_I *l_dl_exchgord_upld_struct_i;
	DL_EXCHGORD_UPLD_STRUCT_H *l_dl_exchgord_upld_struct_h;

   l_dl_exchgord_upld_struct_i=(DL_EXCHGORD_UPLD_STRUCT_I*)calloc(1,sizeof(DL_EXCHGORD_UPLD_STRUCT_I));
   APL_MALLOC_FAIL(l_dl_exchgord_upld_struct_i)

   l_dl_exchgord_upld_struct_h=(DL_EXCHGORD_UPLD_STRUCT_H*)calloc(1,sizeof(DL_EXCHGORD_UPLD_STRUCT_H));
   APL_MALLOC_FAIL(l_dl_exchgord_upld_struct_i)



IF_COND_EXISTS("DL_DEAL","EXCH")     //bank specific condition added by jeoti

	{

       printf("\n...........inside bank specific condition checking.....12....");

   if(strcmp(p_dl_exchgord_upld_struct_h->h_exchg_code,"BSE") != 0)

    {

		EXEC SQL SELECT * 
					INTO :l_dl_exchgord_upld_struct_h:l_dl_exchgord_upld_struct_i
					FROM DL_EXCHGORD_UPLD
					WHERE  ORDER_NO =:p_dl_exchgord_upld_struct_h->h_order_no
					AND BROKER_CD = :p_dl_exchgord_upld_struct_h->h_broker_cd /* HBDL_012 - changes by amish - exchange order enhancement 27/07/2007*/
					AND DEAL_DATE = :p_dl_exchgord_upld_struct_h->h_deal_date; /*  HBDL_012 - changes by amish - 
					exchange order enhancement 25/07/2007*/

	}

/***********************added by jeoti**********************************************************/
else
	{
                 
				 
				 EXEC SQL SELECT * 
					INTO :l_dl_exchgord_upld_struct_h:l_dl_exchgord_upld_struct_i
					FROM DL_EXCHGORD_UPLD
					WHERE 
					ORDER_NO =:p_dl_exchgord_upld_struct_h->h_order_no
					AND SETTL_NO = :p_dl_exchgord_upld_struct_h->h_settl_no 
					AND BROKER_CD = :p_dl_exchgord_upld_struct_h->h_broker_cd; 

	}

	}

	else

	{

                 EXEC SQL SELECT * 
					INTO :l_dl_exchgord_upld_struct_h:l_dl_exchgord_upld_struct_i
					FROM DL_EXCHGORD_UPLD
					WHERE  ORDER_NO =:p_dl_exchgord_upld_struct_h->h_order_no
					AND EXCHG_CODE = :p_dl_exchgord_upld_struct_h->h_exchg_code 
					AND DEAL_DATE = :p_dl_exchgord_upld_struct_h->h_deal_date; 


	}

	if(sqlca.sqlcode ==1403)
	{
		*p_exists= 0;/*Added * as giving warning*/
		printf("Exists: |%d|\n",*p_exists);/*Added * as giving warning*/
		APL_GOBACK_SUCCESS
	}
	else if (sqlca.sqlcode ==0)
	{

		if(strcmp(l_dl_exchgord_upld_struct_h->h_status,"PM")!=0)
		{
			*p_exists= 1;/*Added * as giving warning*/
			printf("Exists: |%d|\n",*p_exists);/*Added * as giving warning*/
			strcpy(p_dl_exchgord_upld_struct_h->h_access_stamp,l_dl_exchgord_upld_struct_h->h_access_stamp);
			APL_GOBACK_SUCCESS
		}
		else
		{
			*p_exists= 2;/*Added * as giving warning*/
			printf("Exists: |%d|\n",*p_exists);/*Added * as giving warning*/
         if (CO_InsertErr (l_debug_info_ptr, ERR_REC_EXIST, APL_NULL_STRING, APL_NULL_STRING, APL_NULL_STRING, __LINE__, __FILE__) != APL_SUCCESS) 
				APL_GOBACK_FAIL 


		}

	}
	else
		IS_ANY_ORA_ERROR

      RETURN_SUCCESS :
		{

	     APL_IF_DEBUG
         {
            CO_ProcMonitor(APL_OUT_FILE, "Function CR_Chk_If_Exists is successful\n", NULL,NULL);
	      }
	      return(APL_SUCCESS);
		}
		RETURN_FAILURE :
	   {

	      APL_IF_DEBUG
		   {
		       CO_ProcMonitor(APL_OUT_FILE, "Function CR_Chk_If_Exists is unsuccessful\n", NULL,NULL);
		   }
		   return(APL_FAILURE);
		}

}
