





#include  <stdlib.h>
#include  <string.h>
#include  "CO_HostStructdef.h" 

const char chr_winalpha[] = "ÀÁÂÃÄÅ¨ÆÇÈÉÊËÌÍÎÏÐÑÒÓÔÕÖ×ØÙÚÛÜÝÞßàáâãäå¸æçèéêëìíîïðñòóôõö÷øùúûüýþÿ";
const char chr_dosalpha[] = "€‚ƒ„…ð†‡ˆ‰Š‹ŒŽ‘’“”•–—˜™š›œžŸ ¡¢£¤¥ñ¦§¨©ª«¬­®¯àáâãäåæçèéêëìíîï";

EXEC SQL INCLUDE sqlca;

#define HF_COMP_DATE	   11	
#define HF_TMP 		 	40

#define HF_PR_CODE	  	4
#define HF_PR_DET 		21
#define HF_CCY	  		4
#define HF_DAY_DT	  	4
#define HD_DAY_YR	 		4
#define HF_PRD_TYPE	 	4
#define HF_DL_CLASS 	3
#define HF_INT_TYPE	  	4
#define HF_LOC	  	5
#define DL_HOFF_SCPRODLINE 	123
#define HF_INT_DOMCP 	11
#define HF_SEC_CD 		9
#define HF_CLT_NAME 		66
#define HF_DEPCD_LEN 		26
#define HF_CUBRK        2  	
#define HF_BASE_CLT 		7
#define HF_STAT_REGNO	21
#define HF_SEC_NAME			51
#define HF_TYPEOFINSTR		4
#define DL_HOFF_SECCLS	   4	
#define HF_SEC_DATE			9	
#define HF_DEAL_DATE			9	
#define HF_ISSUE_DATE		11
#define HF_SETL_DATE		9
#define HF_MATURE_DATE		11
#define HF_SECOP_DATE		9
#define HF_NOM_VAL		20
#define HF_BASE_SEC		7
#define HF_LISTED_IND	2
#define DL_HOFF_SCSECLINE 	184
#define HF_CLT_STAT  3
#define HF_STATUS  3
#define HF_LOC_STAT 3
#define HF_LOC_CODE    5 
#define HF_DEAL_CD  	   2 
#define HF_FREQ_CODE      2  
#define HF_DISCNT_IND_LEN 2  
#define HF_INCOME_RT		21
#define HF_INT_DATE		9 
#define DL_HOFF_SCREGLINE 	56
#define DL_HOFF_SCSECPRSLINE 	67
#define DL_HOFF_SCINSTRLINE    336 
#define DL_HOFF_SCTRSFLINE   	242 
#define HF_CLIENT		11
#define HF_IDENTNO       17 	
#define HF_IDENTNUMBER      11 
#define HF_SEC_LOC      5
#define DL_HOFF_SCCUSTOMLINE 	18
#define HF_SCACCTLINE    	634
#define DL_HOFF_SCLOCLINE 	88
#define HF_LOC_NAME			71
#define HF_BASE_LOC		7
#define HF_CRACTYPE		3
#define HF_CR_LOC 		3
#define DL_HOFF_SCCLOSELINE 	167
#define HF_SCACCPERSLINE 	167 	
#define HF_CLN_CLASS		3	
#define DL_HOFF_SYNLOC	   	6   	
#define DL_HOFF_SYNACC  	   	6   
#define HF_DOMCP_LEN 	   	11  	
#define HF_COUNTCLT    	11  	
#define HF_CLT_TYPE			3
#define HF_CRACTYPE			3	
#define DL_HOFF_STRCRACTYP		3	
#define HF_MAKER				15	
#define HF_LOC_TYPE			3	
#define DL_HOFF_STRLOCTYP		3	
#define HF_CURR_DATE     	11	
#define HF_INSTRUMENT_TYPE	   	4	
#define HF_LOC_IDENTITY	   	17 

int int_g_regen_ind 		= 1 ; 
long g_lng_urnseq 	= 0 ;
long g_lng_urnseq1 	= 0 ;

int RuPadLeft(char *p_str_urn,int p_int_juldate,long *p_lng_urnseqno,int p_int_num,char p_ch_add,DEBUG_INFO_STRUCT_H **l_debug_info_ptr); 


main(int argc , char **argv )
{
 struct sqlca sqlca ;
 DEBUG_INFO_STRUCT_H   *l_debug_info_ptr 			= NULL  ;
 INTL_ENV_DATA_STRUCT_H 							  l_intl_env_data_h ;
 FILE			    *l_finifile   			= NULL ;
 FILE			    *l_logfile    			= NULL ;
 int			    int_l_int_num     			= 0 ;
 int 			    int_l_flg         			= 0 ;
 int				 int_l_int_countrec			= 0 ;
 int 			    int_l_int_retval  			= 0 ;
 char			    chr_uname[APL_USERID_LEN]  = APL_NULL_STRING ;
 char 		    chr_custody_id_b[APL_USERID_LEN] = APL_NULL_STRING ;
 char			    chr_passwd[APL_PASSWD_LEN] = APL_NULL_STRING ;
 char 		    chr_l_inifile[PATH_LENGTH] = APL_NULL_STRING ;
 char 		    chr_l_logdir[PATH_LENGTH]  = APL_NULL_STRING ;
 char			    chr_l_buf[BUFFER_LEN]       = APL_NULL_STRING ;

 char chr_l_h_sysdate[HF_CURR_DATE] 	   = APL_NULL_STRING ; 
 char chr_l_str_parm[2] 						   = APL_NULL_STRING ; 

 int 				int_l_int_count					= 0 ; 
 short 			l_i_sysdate					= 0 ; 

 EXEC SQL VAR chr_uname  IS STRING;
 EXEC SQL VAR chr_custody_id_b IS STRING;
 EXEC SQL VAR chr_passwd IS STRING;

 memset(&l_intl_env_data_h , NULL , sizeof(INTL_ENV_DATA_STRUCT_H)) ;

 

 strcpy(l_intl_env_data_h.usr   ,argv[3]);
 strcpy(l_intl_env_data_h.h_mode     ,argv[4]);
 strcpy(l_intl_env_data_h.processtion ,argv[5]);
 strcpy(l_intl_env_data_h.auth_req ,argv[6]);
 strcpy(l_intl_env_data_h.subprocess   ,argv[7]);
 strcpy(l_intl_env_data_h.h_process   ,argv[8]);

 strcpy(chr_l_inifile,getenv("INTL_ROOT_PATH"));
 strcat(chr_l_inifile,"intl_sun.cfg");

 if ((l_finifile = fopen(chr_l_inifile,"r")) == NULL )
	 APL_GOBACK_FAIL




APL_FETCH_DB_LOGIN_DETAILS(l_finifile , chr_custody_id_b , chr_uname , chr_passwd , 
	  APL_OUT_FILE , &l_debug_info_ptr )

 

 if(CO_DB_Connection_L(chr_uname,chr_passwd,&l_debug_info_ptr)!=APL_SUCCESS)
  APL_GOBACK_FAIL

 

	
 if(APL_FAILURE == CO_Rtv_RptFileName("3i" , APL_LOGFILE_DESC ,100,argv[5],argv,&l_logfile,&l_debug_info_ptr))
 {
  EXEC SQL ROLLBACK WORK RELEASE ;
  APL_GOBACK_FAIL
 }



EXEC SQL COMMIT WORK ;

 if(sqlca.sqlcode)
 {
  CO_Proc_RptClose(l_logfile,&l_debug_info_ptr);
  APL_GOBACK_FAIL
 }

   CO_ProcMonitor(l_logfile ,"\nHand Off File Generation\n",NULL,NULL);
	CO_ProcMonitor(l_logfile ,  "------------------------\n",NULL,NULL);
	CO_ProcMonitor(l_logfile , "Work Committed After LogFile Creation\n",NULL,NULL);

	if(CO_RtvSysParams(&l_debug_info_ptr) != APL_SUCCESS )
	{
   	 CO_ProcMonitor(l_logfile , "Unable to get the system parameters : Rollback Done \n",NULL,&l_intl_env_data_h);
       CO_Proc_RptClose(l_logfile,&l_debug_info_ptr) 	;
		 EXEC SQL ROLLBACK WORK RELEASE ;
		 APL_GOBACK_FAIL
	}

  int_l_int_retval = LockRecFn15(argv,l_logfile,&l_debug_info_ptr)	;

  if (int_l_int_retval != APL_SUCCESS)
  {
	  CO_ProcMonitor(l_logfile,"Unable to lock BATCH_IN_PROC record - Rollback done \n",NULL,&l_intl_env_data_h);
     CO_Proc_RptClose(l_logfile,&l_debug_info_ptr);
 	  EXEC SQL ROLLBACK WORK RELEASE;
	  APL_GOBACK_FAIL
  }

  if ( RuPreHoffCheck(l_logfile,argv,&int_l_int_countrec,l_finifile,l_debug_info_ptr) != APL_SUCCESS ) 
  {

	  CO_ProcMonitor(l_logfile,"RuPreHoffCheck Fn Failed \n",NULL,&l_intl_env_data_h);
     EXEC SQL ROLLBACK WORK RELEASE;
	  APL_GOBACK_FAIL
  }

  if ( int_l_int_countrec )   
	{
	  CO_ProcMonitor(l_logfile,"Check the Exceptions.HandOff File not generated.\n",NULL,&l_intl_env_data_h);
	  APL_GOBACK_SUCCESS
   }

	EXEC SQL SELECT TO_CHAR(SYS_DATE,'dd/chr_mm/yyyy') INTO :chr_l_h_sysdate:l_i_sysdate
	FROM PRO_SYS_DATE ;
	IS_ANY_ORA_ERROR
	
	EXEC SQL select count(*) into :int_l_int_count from 
	DL_LOCALREPDATES where to_char(LR_DT,'dd/chr_mm/yyyy') = :chr_l_h_sysdate ;
	IS_ANY_ORA_ERROR

	strcpy(chr_l_str_parm,argv[9]);

	if( strcmp(chr_l_str_parm,"Y") &&  strcmp(chr_l_str_parm,"N")  )
	{
		fprintf( l_logfile,"Front End Parameter for Regeneration not passed properly\n");
		APL_GOBACK_FAIL
	}
	else if ( !strcmp(chr_l_str_parm,"Y") )
	{
		 

	  if ( int_l_int_count >  0 )
	  {
  		if ( RuHoffRegenerate(argv,l_logfile,l_finifile,l_intl_env_data_h,&l_debug_info_ptr)!=APL_SUCCESS )
  		{
	 	 CO_ProcMonitor(l_logfile,"RuHoffRegenerate Fn Failed \n",NULL,&l_intl_env_data_h);
	  	 APL_GOBACK_FAIL
  		}
	  }
	   else
		{
		 
		  CO_ProcMonitor(l_logfile,"Date Mismatch.\nRuHoffRegenerate Fn Failed \n",NULL,&l_intl_env_data_h);
		  APL_GOBACK_FAIL  
	    }
   }
	else if ( !strcmp(chr_l_str_parm,"N") )
	{
		 

	  if ( int_l_int_count >  0 )
	  {
	 	 CO_ProcMonitor(l_logfile,"Already Generated.User does not want Regeneration.\nRuHoffRegenerate Fn Failed \n",NULL,&l_intl_env_data_h);
	  	 APL_GOBACK_FAIL
     }
   
	}


  if ( RuHoffGen(argv,l_logfile,l_finifile,l_intl_env_data_h,&l_debug_info_ptr) != APL_SUCCESS )
  {
	  CO_ProcMonitor(l_logfile, "RuHoffGen Fn Failed \n",NULL,&l_intl_env_data_h);
	  APL_GOBACK_FAIL
  }
  else
  {
   CO_ProcMonitor(l_logfile,"nRuHoffGen Fn Successful.\n",NULL,NULL);
	APL_GOBACK_SUCCESS
  } 

   APL_GOBACK_SUCCESS 
	
   

	RETURN_SUCCESS :
	{
	  fclose(l_finifile) ;
	 
	  int_l_flg = 0 ;
	  CO_Proc_Exit(argv,l_logfile,&l_debug_info_ptr,int_l_flg);
    
	  if(CO_ChkErr(l_debug_info_ptr)==APL_SUCCESS)
	  {
		   CO_ProcMonitor(l_logfile,APL_NULL_STRING,&l_debug_info_ptr,&l_intl_env_data_h) ;
			CO_FreeErrLst(&l_debug_info_ptr);
	  }

     CO_ProcMonitor(l_logfile,"Record Commited.\nExiting Successfully From Main.\n",NULL,NULL);
	  CO_Proc_RptClose(l_logfile,&l_debug_info_ptr);
	 
	  return(0) ;
	}
	
	RETURN_FAILURE :
	{
	 fclose(l_finifile);

    int_l_flg = 1 ;

	 CO_Proc_Exit(argv,l_logfile,&l_intl_env_data_h,int_l_flg) ;

	 if(CO_ChkErr(l_debug_info_ptr)==APL_SUCCESS)
	 {
		CO_ProcMonitor(l_logfile,APL_NULL_STRING,&l_debug_info_ptr,&l_intl_env_data_h) ;
		CO_FreeErrLst(&l_debug_info_ptr);
	 }

	  CO_ProcMonitor(l_logfile, "Main Fn Failed \n",NULL,&l_intl_env_data_h);
	  CO_Proc_RptClose(l_logfile,&l_debug_info_ptr);

	 return(-1) ;
	}

}





int RuPreHoffCheck( FILE* p_logfile , char **argv , int *p_int_countrec ,FILE *l_finifile,DEBUG_INFO_STRUCT_H **l_debug_info_ptr)
{
struct sqlca sqlca ;
FILE *l_repfile  = NULL ; 
char chr_l_h_client_a[HF_CLIENT]   				= APL_NULL_STRING ; 
char chr_l_h_ruclient[HF_CLIENT] 				= APL_NULL_STRING ;
char chr_l_h_acc_status[HF_CLT_STAT] 		= APL_NULL_STRING ; 
char chr_l_h_ruacc_status[HF_CLT_STAT] 		= APL_NULL_STRING ; 
char chr_l_h_statusus[HF_STATUS] 		= APL_NULL_STRING ; 
char chr_l_h_ruinstr_status[HF_STATUS] 		= APL_NULL_STRING ; 
char chr_l_h_instrcode_A[HF_SEC_CD]     				= APL_NULL_STRING ; 
char chr_l_h_ruinstrcode[HF_SEC_CD]    			= APL_NULL_STRING ; 
char chr_l_h_locncode_a[HF_LOC_CODE] 				= APL_NULL_STRING ; 
char chr_l_h_rulocncode[HF_LOC_CODE] 			= APL_NULL_STRING ; 
char chr_l_h_locn_status[HF_LOC_STAT] 		= APL_NULL_STRING ; 
char chr_l_h_rulocn_status[HF_LOC_STAT] 	= APL_NULL_STRING ; 
char chr_l_h_sysdate[HF_CURR_DATE] 				= APL_NULL_STRING ; 
char chr_l_h_typeofinstr[HF_INSTRUMENT_TYPE] 				= APL_NULL_STRING ; 

int int_l_int_pageno = 1 ;
int int_l_int_ctr    = 0 ; 

EXEC SQL VAR chr_l_h_client_a 		IS STRING ; 
EXEC SQL VAR chr_l_h_ruclient 	IS STRING ; 
EXEC SQL VAR chr_l_h_acc_status 	IS STRING ; 
EXEC SQL VAR chr_l_h_instrcode_A 		IS STRING ; 
EXEC SQL VAR chr_l_h_locncode_a 		IS STRING ; 
EXEC SQL VAR chr_l_h_sysdate 		IS STRING ; 

short l_i_account 		= 0 ;
short l_i_ruaccount 		= 0 ;
short l_i_acc_status 	= 0 ;
short l_i_ruacc_status 	= 0 ;
short l_i_statusus 	= 0 ;
short l_i_ruinstr_status 	= 0 ;
short l_i_instr_code 			= 0 ;
short l_i_ruinstrode 		= 0 ;
short l_i_locncode 		= 0 ; 
short l_i_rulocncode 	= 0 ; 
short l_i_locn_status 	= 0 ; 
short l_i_rulocn_status = 0 ; 
short l_i_sysdate 		= 0 ; 
short l_i_typeofinstr 		= 0 ; 

fprintf(p_logfile,"Reached Function RuPreHoffCheck\n");

if(APL_FAILURE == CO_Rtv_RptFileName("SC","Hand-Off File Report",100,argv[5],argv,&l_repfile,l_debug_info_ptr))
 {
   EXEC SQL ROLLBACK WORK RELEASE ;
   APL_GOBACK_FAIL
 }

EXEC SQL select to_char(SYS_DATE,'dd/chr_mm/yyyy') into :chr_l_h_sysdate:l_i_sysdate from pro_sys_date ; 
IS_ANY_ORA_ERROR 



EXEC SQL declare csprhffacc cursor for select CLN_CODE , STATUS
from MT_CLIENT where ( CLN_BRK_ALL = 'C' or CLN_BRK_ALL = 'A')  and CLN_CLAS = '2';
IS_ANY_ORA_ERROR

EXEC SQL OPEN csprhffacc ; 
IS_ANY_ORA_ERROR 

 for( ; ; )  
 {
	EXEC SQL Fetch csprhffacc into :chr_l_h_client_a:l_i_account , :chr_l_h_acc_status:l_i_acc_status ;
	IS_ANY_ORA_ERROR_CURSOR

	if( APL_ZERO_RESULT_SET )
 	break ;

	EXEC SQL select RU_CLIENT_STAT into :chr_l_h_ruacc_status:l_i_ruacc_status 
	from DL_RUCLIENT where client = :chr_l_h_client_a ; 
   IS_ANY_ORA_ERROR

	if(APL_ZERO_RESULT_SET)
	{
	int_l_int_ctr++;
	if(int_l_int_ctr == 1 )
	  RuReportHdr(l_repfile,&int_l_int_pageno,chr_l_h_sysdate);
	fprintf(l_repfile,"  %-10d",int_l_int_ctr);
 	fprintf(l_repfile,"%-20s","CLIENT");
 	fprintf(l_repfile,"%-19s",chr_l_h_client_a);
 	fprintf(l_repfile,"Not Found in RRMM\n");
	}
	else if( (strcmp(chr_l_h_ruacc_status,"AA")) && !(strcmp(chr_l_h_acc_status,"AA")) )
	{
	int_l_int_ctr++;
	if(int_l_int_ctr == 1 )
	  RuReportHdr(l_repfile,&int_l_int_pageno,chr_l_h_sysdate);
	fprintf(l_repfile,"  %-10d",int_l_int_ctr);
 	fprintf(l_repfile,"%-20s","CLIENT");
 	fprintf(l_repfile,"%-19s",chr_l_h_client_a);
 	fprintf(l_repfile,"Not Authorised in RRMM\n");
	}
	else if( (strcmp(chr_l_h_ruacc_status,"CA")) && !(strcmp(chr_l_h_acc_status,"CA")) )
	{
	int_l_int_ctr++;
	if(int_l_int_ctr == 1 )
	  RuReportHdr(l_repfile,&int_l_int_pageno,chr_l_h_sysdate);
	fprintf(l_repfile,"  %-10d",int_l_int_ctr);
 	fprintf(l_repfile,"%-20s","CLOSED ACCOUNT");
 	fprintf(l_repfile,"%-19s",chr_l_h_client_a);
 	fprintf(l_repfile,"Account Not Closed in RRMM\n");
	}
	else if( !(strcmp(chr_l_h_ruacc_status,"CA")) && (strcmp(chr_l_h_acc_status,"CA")) )
	{
	int_l_int_ctr++;
	if(int_l_int_ctr == 1 )
	  RuReportHdr(l_repfile,&int_l_int_pageno,chr_l_h_sysdate);
	fprintf(l_repfile,"  %-10d",int_l_int_ctr);
 	fprintf(l_repfile,"%-20s","CLIENT");
 	fprintf(l_repfile,"%-19s",chr_l_h_client_a);
 	fprintf(l_repfile,"Live Account Closed in RRMM\n");
	}

	if(int_l_int_ctr && int_l_int_ctr % 53 == 0 )
	  RuReportHdr(l_repfile,&int_l_int_pageno,chr_l_h_sysdate);

  }

	EXEC SQL ClOSE csprhffacc ; 
	IS_ANY_ORA_ERROR 




   EXEC SQL declare csprhffacc1 cursor for select client from DL_RUCLIENT where
	RU_CLIENT_STAT != 'CA' and
	client not in ( select CLN_CODE from MT_CLIENT ) ;
	IS_ANY_ORA_ERROR 

	EXEC SQL OPEN csprhffacc1 ; 
	IS_ANY_ORA_ERROR 

	for( ; ;  )
	{

	 EXEC SQL Fetch csprhffacc1 into :chr_l_h_ruclient:l_i_ruaccount ; 
	 IS_ANY_ORA_ERROR_CURSOR

	 if(APL_ZERO_RESULT_SET)
	  break ;
    int_l_int_ctr++;
	if(int_l_int_ctr == 1 )
	  RuReportHdr(l_repfile,&int_l_int_pageno,chr_l_h_sysdate);
	 fprintf(l_repfile,"  %-10d",int_l_int_ctr);
 	 fprintf(l_repfile,"%-20s","DELETED ACCOUNT");
 	 fprintf(l_repfile,"%-19s",chr_l_h_ruclient);
 	 fprintf(l_repfile,"Account Not Closed in RRMM\n");

	if(int_l_int_ctr && int_l_int_ctr % 53 == 0 )
	  RuReportHdr(l_repfile,&int_l_int_pageno,chr_l_h_sysdate);
	}
 
	EXEC SQL Close csprhffacc1 ; 
   IS_ANY_ORA_ERROR 




EXEC SQL declare csprhffsec cursor for select instr_code , STATUS
from MT_INSTRUMENT ;
IS_ANY_ORA_ERROR

EXEC SQL OPEN csprhffsec ; 
IS_ANY_ORA_ERROR

for( ; ; )  
 {

	EXEC SQL Fetch csprhffsec into :chr_l_h_instrcode_A:l_i_instr_code , :chr_l_h_statusus:l_i_statusus;
	IS_ANY_ORA_ERROR_CURSOR

	if( APL_ZERO_RESULT_SET )
 	break ;

	EXEC SQL select RU_INSTR_STAT into :chr_l_h_ruinstr_status:l_i_ruacc_status 
	from DL_RUINSTRUMENT where instr_code = :chr_l_h_instrcode_A ; 
   IS_ANY_ORA_ERROR
 
	if(APL_ZERO_RESULT_SET)
	{
	int_l_int_ctr++;
	if(int_l_int_ctr == 1 )
	  RuReportHdr(l_repfile,&int_l_int_pageno,chr_l_h_sysdate);
	fprintf(l_repfile,"  %-10d",int_l_int_ctr);
 	fprintf(l_repfile,"%-20s","INSTRUMENT");
 	fprintf(l_repfile,"%-19s",chr_l_h_instrcode_A);
	fprintf(l_repfile,"Not Found in RRMM\n");
	}
	else if( (strcmp(chr_l_h_ruinstr_status,"AA")) && !(strcmp(chr_l_h_statusus,"AA")) )
	{
	int_l_int_ctr++;
	if(int_l_int_ctr == 1 )
	  RuReportHdr(l_repfile,&int_l_int_pageno,chr_l_h_sysdate);
	fprintf(l_repfile,"  %-10d",int_l_int_ctr);
 	fprintf(l_repfile,"%-20s","INSTRUMENT");
 	fprintf(l_repfile,"%-19s",chr_l_h_instrcode_A);
 	fprintf(l_repfile,"Not Authorised in RRMM\n");
	}

	if(int_l_int_ctr && int_l_int_ctr % 53 == 0 )
	  RuReportHdr(l_repfile,&int_l_int_pageno,chr_l_h_sysdate);
 }

	EXEC SQL Close csprhffsec ; 
	IS_ANY_ORA_ERROR


 




EXEC SQL declare csprhffloc cursor for select  location_cd , STATUS
from MT_LOCATION ;
IS_ANY_ORA_ERROR

EXEC SQL OPEN csprhffloc ; 
IS_ANY_ORA_ERROR

for( ; ; )  
 {

	EXEC SQL Fetch csprhffloc into :chr_l_h_locncode_a:l_i_locncode , :chr_l_h_locn_status:l_i_locn_status ;
	IS_ANY_ORA_ERROR_CURSOR

	if( APL_ZERO_RESULT_SET )
 	break ;

	EXEC SQL select RU_LOC_STAT into :chr_l_h_rulocn_status:l_i_rulocn_status 
	from DL_RULOCATION where LOC = :chr_l_h_locncode_a ;
   IS_ANY_ORA_ERROR

	if(APL_ZERO_RESULT_SET)
	{
	int_l_int_ctr++;
	if(int_l_int_ctr == 1 )
	  RuReportHdr(l_repfile,&int_l_int_pageno,chr_l_h_sysdate);
	fprintf(l_repfile,"  %-10d",int_l_int_ctr);
 	fprintf(l_repfile,"%-20s","LOC");
 	fprintf(l_repfile,"%-19s",chr_l_h_locncode_a);
 	fprintf(l_repfile,"Not Found in RRMM\n");
	}
	else if( (strcmp(chr_l_h_rulocn_status,"AA")) && !(strcmp(chr_l_h_locn_status,"AA")) )
	{
	int_l_int_ctr++;
	if(int_l_int_ctr == 1 )
	  RuReportHdr(l_repfile,&int_l_int_pageno,chr_l_h_sysdate);
	fprintf(l_repfile,"  %-10d",int_l_int_ctr);
 	fprintf(l_repfile,"%-20s","LOC");
 	fprintf(l_repfile,"%-19s",chr_l_h_locncode_a);
 	fprintf(l_repfile,"Not Authorised in RRMM\n");
	}

	if(int_l_int_ctr && int_l_int_ctr % 53 == 0 )
	  RuReportHdr(l_repfile,&int_l_int_pageno,chr_l_h_sysdate);
 }

	EXEC SQL Close csprhffloc ; 
   IS_ANY_ORA_ERROR


 

   
	*p_int_countrec = int_l_int_ctr ;

	if( !int_l_int_ctr )
	{
		CO_ProcMonitor(l_repfile,"No Exceptions Found\n",NULL,NULL);
	}


   APL_GOBACK_SUCCESS

	 RETURN_SUCCESS :
	 {
	 CO_ProcMonitor(p_logfile,"Successful in RuPreHoffCheck processtion\n",NULL,NULL);
	 CO_Proc_RptClose(l_repfile,l_debug_info_ptr);
	 return(APL_SUCCESS);
	 }

    RETURN_FAILURE :
	 {
	 CO_ProcMonitor(p_logfile,"Failed in RuPreHoffCheck processtion\n",NULL,NULL);
	 CO_Proc_RptClose(l_repfile,l_debug_info_ptr);
	 return(APL_FAILURE);
	 }


}


 

int RuHoffRegenerate(char **argv,FILE *p_logfile,FILE *p_finifile,DEBUG_INFO_STRUCT_H *l_intl_env_data_h,DEBUG_INFO_STRUCT_H **l_debug_info_ptr) 
{
   char chr_l_h_sysdate[HF_CURR_DATE]   	= APL_NULL_STRING ;
   char chr_l_h_sysyr[3]   						= APL_NULL_STRING ;
	char chr_l_str_juldate[6]				  	= APL_NULL_STRING ;
	char chr_l_str_temp[6]					  	= APL_NULL_STRING ;
	int  int_l_int_padlen = 3 ;  

	int  int_l_jul_date   	= 0 ; 
	short l_i_sysdate 	= 0 ; 
	short l_i_sysyr	 	= 0 ; 

   EXEC SQL VAR chr_l_h_sysdate   IS STRING ; 
   EXEC SQL VAR chr_l_h_sysyr	   IS STRING ; 
	EXEC SQL VAR chr_l_str_juldate IS STRING ; 

   memset(chr_l_h_sysdate,'\0',HF_CURR_DATE);
   memset(chr_l_h_sysyr,'\0',3);
   memset(chr_l_str_juldate,'\0',6);
   memset(chr_l_str_temp,'\0',6);

	if(CO_Rtv_JulDt(&int_l_jul_date,l_debug_info_ptr)!= APL_SUCCESS)
	 APL_GOBACK_FAIL

   EXEC SQL SELECT TO_CHAR(SYS_DATE,'dd/chr_mm/yyyy') , TO_CHAR(SYS_DATE,'yy') 
	INTO :chr_l_h_sysdate:l_i_sysdate , :chr_l_h_sysyr:l_i_sysyr 
	FROM PRO_SYS_DATE ;
	IS_ANY_ORA_ERROR 

	strcpy(chr_l_str_juldate,chr_l_h_sysyr);

	sprintf(chr_l_str_temp,"%d",int_l_jul_date);
   CO_PadString(chr_l_str_temp,'L',int_l_int_padlen,"0",l_debug_info_ptr);
	strcat(chr_l_str_juldate,chr_l_str_temp);
   fprintf(p_logfile,"l_str_juldate = %s\n",chr_l_str_juldate);

	EXEC SQL update DL_LOCALREPDATES set LR_DT = ( select LR_DT from DL_LOCALREPDATES where CLR_NAME = 2 ) where CLR_NAME = 1 ;
	IS_ANY_ORA_ERROR 
	
	EXEC SQL update dl_deal set lcl_identno = NULL where substr(lcl_identno,1,5) = :chr_l_str_juldate ; 
	IS_ANY_ORA_ERROR 
	
	EXEC SQL update DL_RUSAFEK  set NEW_OLD_IND = 'N' where to_char(NEW_DT,'dd/chr_mm/yyyy') = :chr_l_h_sysdate ; 
	IS_ANY_ORA_ERROR 

	APL_GOBACK_SUCCESS

	 RETURN_SUCCESS :
	 {
	  int_g_regen_ind = 2 ; 
	  CO_ProcMonitor(p_logfile,"Successful in RuHoffRegenarate processtion\n",NULL,NULL);
     return(APL_SUCCESS);
    }

	 RETURN_FAILURE :
	 {
	  CO_ProcMonitor(p_logfile,"Unsuccessful in RuHoffRegenerate processtion\n",NULL,NULL);
     return(APL_FAILURE);
    }
	  

}


 


int RuHoffGen(char** argv,FILE* p_logfile,FILE* p_ptr_ini_file,INTL_ENV_DATA_STRUCT_H * p_intl_envdatastruct_h,DEBUG_INFO_STRUCT_H** l_debug_info_ptr)
{
 struct sqlca sqlca ;
 FILE  *l_ptr_fopenfile  			= NULL ;
 FILE  *l_ptr_fopenfile_hdr		= NULL ;
 FILE  *l_ptr_fopenfile_det 		= NULL ;
 FILE  *l_ptr_symrepfile  			= NULL ;
 FILE  *l_ptr_fopenfile_temp     = NULL ;
 INTL_REPT_STRUCT_H *l_intl_rept_struct_ha 		= NULL;

 char chr_l_str_filename[PATH_LENGTH]	      = APL_NULL_STRING ; 
 char chr_l_str_filename_hdr[PATH_LENGTH]     = APL_NULL_STRING ; 
 char chr_l_str_filename_det[PATH_LENGTH]	   = APL_NULL_STRING ; 
 char chr_l_str_repname_a[PATH_LENGTH]	      	= APL_NULL_STRING ; 
 char chr_l_sysdate_b[9]								= APL_NULL_STRING ; 
 char chr_l_str_handoff_dir[PATH_LENGTH]   	= APL_NULL_STRING ; 
 char chr_l_str_temp[30]   							= APL_NULL_STRING ; 
 char chr_l_str_reportfile[PATH_LENGTH]   		= APL_NULL_STRING ; 
 char chr_l_str_report_dir[PATH_LENGTH]   		= APL_NULL_STRING ; 
 char chr_l_str_noofblocks[3]    					= APL_NULL_STRING ; 
 char chr_command[(4*PATH_LENGTH)] 			= APL_NULL_STRING ;
 
 int  int_l_int_noofblocks  			= 0 ; 
 int  int_l_int_posn  					= 0 ;

 
 char chr_l_str_filename_temp[PATH_LENGTH]    = APL_NULL_STRING ;
 char chr_l_str_finhandoff_dir[PATH_LENGTH]   = APL_NULL_STRING ;
 char chr_l_nstr_filename[PATH_LENGTH]        = APL_NULL_STRING ;

 memset(chr_l_str_filename,NULL,sizeof(chr_l_str_filename));
 memset(chr_l_str_filename_hdr,NULL,sizeof(chr_l_str_filename_hdr));
 memset(chr_l_str_filename_det,NULL,sizeof(chr_l_str_filename_det));
 memset(chr_l_str_handoff_dir,NULL,sizeof(chr_l_str_handoff_dir));
 memset(chr_l_sysdate_b,NULL,sizeof(chr_l_sysdate_b));
 memset(chr_l_nstr_filename,NULL,sizeof(chr_l_nstr_filename));
 memset(chr_l_str_filename_temp,NULL,sizeof(chr_l_str_filename_temp));
 memset(chr_command,APL_NULL_CHAR,4*PATH_LENGTH);

 fprintf(p_logfile,"Entered Function RuHoffGen\n");

 l_intl_rept_struct_ha = (INTL_REPT_STRUCT_H *)calloc(1, sizeof(INTL_REPT_STRUCT_H));
 APL_MALLOC_FAIL(l_intl_rept_struct_ha) ;

 if (CO_ReadToken(p_ptr_ini_file,"INTL_HF_PATH",chr_l_str_handoff_dir,l_debug_info_ptr) != APL_SUCCESS)
	APL_GOBACK_FAIL
 
 if (CO_ReadToken(p_ptr_ini_file,"SESAM_RRMMHANDOFF_DIR",chr_l_str_finhandoff_dir,l_debug_info_ptr) != APL_SUCCESS)
	APL_GOBACK_FAIL


 strcpy(chr_l_str_filename, chr_l_str_handoff_dir);
 strcpy(chr_l_str_filename_temp, chr_l_str_handoff_dir);
 strcpy(chr_l_nstr_filename, chr_l_str_finhandoff_dir);
 strcpy(chr_l_str_filename_hdr, chr_l_str_handoff_dir);
 strcpy(chr_l_str_filename_det, chr_l_str_handoff_dir);

 EXEC SQL select to_char(SYS_DATE,'yyyymmdd') into :chr_l_sysdate_b from pro_sys_date ;
 IS_ANY_ORA_ERROR

 strcpy(chr_l_str_repname_a,chr_l_sysdate_b);
 strcat(chr_l_str_repname_a,".SES");
 strcat(chr_l_str_filename,chr_l_str_repname_a);
 strcat(chr_l_nstr_filename,chr_l_str_repname_a);
  
 fprintf(p_logfile,"Hoff File Name = %s\n",chr_l_str_filename);

 strcpy(l_intl_rept_struct_ha->report_name, chr_l_str_repname_a);
 strcpy(l_intl_rept_struct_ha->report_desc, APL_HOFF_FILE_DESC);
 strcpy(l_intl_rept_struct_ha->report_date, argv[2]);
 l_intl_rept_struct_ha->report_width = 100 ;
 strcpy(l_intl_rept_struct_ha->task_desc, argv[5]);
 strcpy(l_intl_rept_struct_ha->fe_be_ind, APL_BE_IND);
 strcpy(l_intl_rept_struct_ha->usr, argv[3]);

 if (APL_FAILURE == CO_Proc_DBRptIns( l_intl_rept_struct_ha,l_debug_info_ptr ))
  APL_GOBACK_FAIL

 if((l_ptr_fopenfile = fopen(chr_l_str_filename,"w")) == NULL )
 {
  fprintf(p_logfile,"Error Opening the h_file into which the records are to be written\n");
  APL_GOBACK_FAIL
 }


 strcat(chr_l_str_filename_hdr,"hoff_hdr");
 strcat(chr_l_str_filename_det,"hoff_det");
 strcat(chr_l_str_filename_temp,"temp_file");

 if((l_ptr_fopenfile_temp = fopen(chr_l_str_filename_temp,"w")) == NULL )
 {
  fprintf(p_logfile,"Error Opening the temp h_file into which the records are to be written\n");
  APL_GOBACK_FAIL
 }

 if((l_ptr_fopenfile_hdr = fopen(chr_l_str_filename_hdr,"w")) == NULL )
 {
  fprintf(p_logfile,"Error Opening the h_file into which the records are to be written\n");
  APL_GOBACK_FAIL
 }

 if((l_ptr_fopenfile_det = fopen(chr_l_str_filename_det,"w")) == NULL )
 {
  fprintf(p_logfile,"Error Opening the h_file into which the records are to be written\n");
  APL_GOBACK_FAIL
 }


 
 if (CO_ReadToken(p_ptr_ini_file,"INTL_REP_PATH",chr_l_str_report_dir,l_debug_info_ptr) != APL_SUCCESS)
	APL_GOBACK_FAIL

 strcat(chr_l_str_reportfile,chr_l_str_report_dir);
 strcat(chr_l_str_reportfile,"SYMREP.TXT");

 strcpy(l_intl_rept_struct_ha->report_name, "SYMREP.TXT");
 strcpy(l_intl_rept_struct_ha->report_desc, "Report File");

 
 if (APL_FAILURE == CO_Proc_DBRptIns( l_intl_rept_struct_ha,l_debug_info_ptr ))
  APL_GOBACK_FAIL

 if((l_ptr_symrepfile = fopen(chr_l_str_reportfile,"w")) == NULL )
 {
  fprintf(p_logfile,"Error Opening the Report File into which the records are to be written\n");
  APL_GOBACK_FAIL
 }


  if ( RuHoffGenSCPROD(l_ptr_fopenfile_det,&int_l_int_noofblocks,p_logfile,l_ptr_symrepfile,&p_intl_envdatastruct_h,&l_debug_info_ptr) != APL_SUCCESS )
  {
	  CO_ProcMonitor(p_logfile,"RuHoffGenSCPROD Fn Failed \n",NULL,p_intl_envdatastruct_h);
	  APL_GOBACK_FAIL
  }

  if ( RuHoffGenSCSEC(l_ptr_fopenfile_det,&int_l_int_noofblocks,p_logfile,l_ptr_symrepfile,&p_intl_envdatastruct_h,&l_debug_info_ptr) != APL_SUCCESS )
  {
	  CO_ProcMonitor(p_logfile,"RuHoffGenSCSEC Fn Failed \n",NULL,p_intl_envdatastruct_h);
	  APL_GOBACK_FAIL
  }

  if ( RuHoffGenSCREG(l_ptr_fopenfile_det,&int_l_int_noofblocks,p_logfile,l_ptr_symrepfile,&p_intl_envdatastruct_h,&l_debug_info_ptr) != APL_SUCCESS )
  {
	  CO_ProcMonitor(p_logfile,"RuHoffGenSCREG Fn Failed \n",NULL,p_intl_envdatastruct_h);
	  APL_GOBACK_FAIL
  }




  if ( RuHoffGenSCCUSTOM(l_ptr_fopenfile_det,&int_l_int_noofblocks,p_logfile,l_ptr_symrepfile,&p_intl_envdatastruct_h,&l_debug_info_ptr) != APL_SUCCESS )
  {
	  CO_ProcMonitor(p_logfile,"RuHoffGenSCCUSTOM Fn Failed \n",NULL,p_intl_envdatastruct_h);
	  APL_GOBACK_FAIL
  }

  if ( RuHoffGenSCLOC(l_ptr_fopenfile_det,&int_l_int_noofblocks,p_logfile,l_ptr_symrepfile,&p_intl_envdatastruct_h,&l_debug_info_ptr) != APL_SUCCESS )
  {
	  CO_ProcMonitor(p_logfile,"RuHoffGenSCLOC Fn Failed \n",NULL,p_intl_envdatastruct_h);
	  APL_GOBACK_FAIL
  }

  if ( RuHoffGenSCACCT(l_ptr_fopenfile_det,&int_l_int_noofblocks,p_logfile,l_ptr_symrepfile,&p_intl_envdatastruct_h,&l_debug_info_ptr) != APL_SUCCESS )
  {
	  CO_ProcMonitor(p_logfile,"RuHoffGenSCACCT Fn Failed \n",NULL,p_intl_envdatastruct_h);
	  APL_GOBACK_FAIL
  }

  if ( RuHoffGenSCACCPERS(l_ptr_fopenfile_det,&int_l_int_noofblocks,p_logfile,l_ptr_symrepfile,&p_intl_envdatastruct_h,&l_debug_info_ptr) != APL_SUCCESS )
  {
	  CO_ProcMonitor(p_logfile,"RuHoffGenSCACCPERS Fn Failed \n",NULL,p_intl_envdatastruct_h);
	  APL_GOBACK_FAIL
  }

	printf("\n*************************************\n Now calling RuHoffGenSCINSTR : \n");
  if ( RuHoffGenSCINSTR(l_ptr_fopenfile_det,&int_l_int_noofblocks,p_logfile,l_ptr_symrepfile,&p_intl_envdatastruct_h,&l_debug_info_ptr) != APL_SUCCESS )
  {
	printf("\n*************************************\n Failure in  RuHoffGenSCINSTR : \n");
	  CO_ProcMonitor(p_logfile,"RuHoffGenSCINSTR Fn Failed \n",NULL,p_intl_envdatastruct_h);
	  APL_GOBACK_FAIL
  }
	printf("\n*************************************\n after calling RuHoffGenSCINSTR : \n");

  if ( RuHoffGenSCTRSF(l_ptr_fopenfile_det,&int_l_int_noofblocks,p_logfile,l_ptr_symrepfile,&p_intl_envdatastruct_h,&l_debug_info_ptr) != APL_SUCCESS )
  {
	  CO_ProcMonitor(p_logfile,"RuHoffGenSCTRSF Fn Failed \n",NULL,p_intl_envdatastruct_h);
	  APL_GOBACK_FAIL
  }

  if ( RuHoffGenSCCLOSE(l_ptr_fopenfile_det,&int_l_int_noofblocks,p_logfile,l_ptr_symrepfile,&p_intl_envdatastruct_h,&l_debug_info_ptr) != APL_SUCCESS )
  {
	  CO_ProcMonitor(p_logfile,"RuHoffGenSCCLOSE Fn Failed \n",NULL,p_intl_envdatastruct_h);
	  APL_GOBACK_FAIL
  }

 
 

 RuPadRight(chr_l_str_temp,"#",1);
 RuPadRight(chr_l_str_temp,"CUSTODY",9);
 RuPadRight(chr_l_str_temp,chr_l_sysdate_b,8);
 RuPadRight(chr_l_str_temp,"01",2);
 RuPadRight(chr_l_str_temp,"",3);
 
 fprintf(l_ptr_fopenfile_hdr,chr_l_str_temp);


 sprintf(chr_l_str_noofblocks,"%-2d",int_l_int_noofblocks);
 fprintf(l_ptr_fopenfile_hdr,chr_l_str_noofblocks); 
 strcpy(chr_l_str_temp,"");
 RuPadRight(chr_l_str_temp,"",250);
 fprintf(l_ptr_fopenfile_hdr,"%s",chr_l_str_temp);
 
 fprintf(l_ptr_fopenfile_hdr,"\n");

 fclose(l_ptr_fopenfile_temp); 
 fclose(l_ptr_fopenfile_hdr); 
 fclose(l_ptr_fopenfile_det); 
 fclose(l_ptr_symrepfile); 

 strcpy(chr_command,"");
 strcat(chr_command,"cat ");
 strcat(chr_command,chr_l_str_filename_hdr);
 strcat(chr_command," ");
 strcat(chr_command,chr_l_str_filename_det);
 strcat(chr_command," > ");
 strcat(chr_command,chr_l_str_filename_temp);
 system(chr_command);



 if((l_ptr_fopenfile_temp = fopen(chr_l_str_filename_temp,"r")) == NULL )
 {
  fprintf(p_logfile,"Error Opening the h_file into which the records are already written\n");
  APL_GOBACK_FAIL
 }

 if((l_ptr_fopenfile = fopen(chr_l_str_filename,"w")) == NULL )
 {
  fprintf(p_logfile,"Error in Opening the h_file in Handoff Area\n");
  APL_GOBACK_FAIL
 }

 if ( convtodoschar(l_ptr_fopenfile_temp,l_ptr_fopenfile)!= APL_SUCCESS )
 {
	  CO_ProcMonitor(p_logfile,"convtodoschar Fn Failed \n",NULL,p_intl_envdatastruct_h);
	  APL_GOBACK_FAIL
 }
 
 fclose(l_ptr_fopenfile); 
 fclose(l_ptr_fopenfile_temp); 
 strcpy(chr_command,"rm -f ");
 strcat(chr_command,chr_l_str_filename_hdr);
 system(chr_command);

 strcpy(chr_command,"rm -f ");
 strcat(chr_command,chr_l_str_filename_det);
 system(chr_command);

 strcpy(chr_command,"rm -f ");
 strcat(chr_command,chr_l_str_filename_temp);
 system(chr_command);

 fprintf(p_logfile,"Copying File to Final RRMM Handoff Area\n");
 
 strcpy(chr_command,"");
 strcat(chr_command,"cp ");
 strcat(chr_command,chr_l_str_filename);
 strcat(chr_command," ");
 strcat(chr_command,chr_l_nstr_filename);
 system(chr_command);

 fprintf(p_logfile,"File copied to Final RRMM Handoff Area\n");
	 
	 
	 if( int_g_regen_ind == 1) 
	 {
	 	EXEC SQL update DL_LOCALREPDATES set LR_DT = ( select LR_DT from DL_LOCALREPDATES where CLR_NAME = 1 ) where CLR_NAME = 2 ;
	 	IS_ANY_ORA_ERROR 
    
	 	EXEC SQL update DL_LOCALREPDATES set LR_DT = ( select SYS_DATE from pro_sys_date ) 
	 	where CLR_NAME = 1 ; 
	 	IS_ANY_ORA_ERROR 
	 }
	 else
	 {
	 	EXEC SQL update DL_LOCALREPDATES set LR_DT = ( select SYS_DATE from pro_sys_date ) 
	 	where CLR_NAME = 1 ; 
	 	IS_ANY_ORA_ERROR 
	 }

  
 APL_GOBACK_SUCCESS   

	 RETURN_SUCCESS :
	 {
	 CO_ProcMonitor(p_logfile,"Successful in RuHoffGen processtion\n",NULL,NULL);
	 CO_FreeErrLst(l_debug_info_ptr);
	 return(APL_SUCCESS);
	 }

    RETURN_FAILURE :
	 {
	 CO_ProcMonitor(p_logfile,"Failed in RuHoffGen processtion\n",NULL,NULL);
	 CO_FreeErrLst(l_debug_info_ptr);
	 return(APL_FAILURE);
	 }

} 






int RuHoffGenSCPROD(FILE* p_ptr_fopenfile,int *p_int_noofblocks,FILE *p_logfile,FILE *p_ptr_symrepfile,INTL_ENV_DATA_STRUCT_H * p_intl_envdatastruct_h,DEBUG_INFO_STRUCT_H** l_debug_info_ptr)
{
   struct sqlca sqlca ;
   char chr_l_h_prcode[HF_PR_CODE] 		= APL_NULL_STRING ;
	char chr_l_h_prdesc[HF_PR_DET] 		= APL_NULL_STRING ;
	char chr_l_h_ccy[HF_CCY]  		   	= APL_NULL_STRING ;
	char chr_l_h_day_dt[HF_DAY_DT] 		= APL_NULL_STRING ;
	char chr_l_h_dayyr[HD_DAY_YR] 			= APL_NULL_STRING ;
	char chr_l_h_prdtyp[HF_PRD_TYPE] 		= APL_NULL_STRING ;
	char chr_l_h_inttyp[HF_INT_TYPE] 		= APL_NULL_STRING ;
	char chr_l_h_location[HF_LOC] 	= APL_NULL_STRING ;

   char chr_l_str_scprodline[DL_HOFF_SCPRODLINE] = APL_NULL_STRING ; 
	

	int int_l_int_noofrec 	= 0 ;
	int int_l_int_crc 			= 0 ; 

   short l_i_prcode    	= 0 ;
   short l_i_prdesc   	= 0 ;
   short l_i_ccy    		= 0 ;
	short l_i_day_dt    	= 0 ;
   short l_i_dayyr    	= 0 ;
   short l_i_prdtyp    	= 0 ;
	short l_i_inttyp    	= 0 ;
   short l_i_location   = 0 ;
 
   EXEC SQL VAR chr_l_h_prcode 	IS STRING ; 
   EXEC SQL VAR chr_l_h_prdesc 	IS STRING ; 
   EXEC SQL VAR chr_l_h_ccy 		IS STRING ; 
   EXEC SQL VAR chr_l_h_day_dt 	IS STRING ; 
   EXEC SQL VAR chr_l_h_dayyr		IS STRING ; 
   EXEC SQL VAR chr_l_h_prdtyp 	IS STRING ; 
   EXEC SQL VAR chr_l_h_inttyp 	IS STRING ; 
   EXEC SQL VAR chr_l_h_location 	IS STRING ; 

   memset(chr_l_h_prcode		,'\0',HF_PR_CODE);
   memset(chr_l_h_prdesc		,'\0',HF_PR_DET);
   memset(chr_l_h_ccy			,'\0',HF_CCY);
   memset(chr_l_h_day_dt		,'\0',HF_DAY_DT);
   memset(chr_l_h_dayyr		,'\0',HD_DAY_YR);
   memset(chr_l_h_prdtyp		,'\0',HF_PRD_TYPE);
   memset(chr_l_h_inttyp		,'\0',HF_INT_TYPE);
   memset(chr_l_h_location	,'\0',HF_LOC);

   memset(chr_l_str_scprodline,'\0',DL_HOFF_SCPRODLINE);

  

    EXEC SQL DECLARE cscprod CURSOR FOR 
	 SELECT PR_CODE , PR_DET , MT_CURRENCY , DAY_DATE , DAY_YEAR , PRD_TYPE , INTTYPE , LOC from DL_RUPRODUCT ;
    IS_ANY_ORA_ERROR 

	 EXEC SQL OPEN cscprod ;
    IS_ANY_ORA_ERROR 

	for( ; ; )
	{

	 EXEC SQL FETCH cscprod into :chr_l_h_prcode:l_i_prcode ,:chr_l_h_prdesc:l_i_prdesc ,:chr_l_h_ccy:l_i_ccy ,
	 :chr_l_h_day_dt:l_i_day_dt , :chr_l_h_dayyr:l_i_dayyr ,
	 :chr_l_h_prdtyp:l_i_prdtyp , :chr_l_h_inttyp:l_i_inttyp ,:chr_l_h_location:l_i_location ; 
    IS_ANY_ORA_ERROR_CURSOR

	 if(APL_ZERO_RESULT_SET)
	  break;

    strcpy(chr_l_str_scprodline," ");

    RuPadRight(chr_l_str_scprodline,"SCPROD",9);
    RuPadRight(chr_l_str_scprodline,chr_l_h_prcode, 3);
    RuPadRight(chr_l_str_scprodline,chr_l_h_prdesc,20);
    RuPadRight(chr_l_str_scprodline,chr_l_h_ccy,3);
    RuPadRight(chr_l_str_scprodline,chr_l_h_day_dt,3);
    RuPadRight(chr_l_str_scprodline,chr_l_h_dayyr,3);
    RuPadRight(chr_l_str_scprodline,chr_l_h_prdtyp,3);
    RuPadRight(chr_l_str_scprodline,"CTD",3);

	 if ( !strcmp(chr_l_h_prdtyp,"EQT") )
      RuPadRight(chr_l_str_scprodline,"1",20);
    else
      RuPadRight(chr_l_str_scprodline,"100",20);
  
    RuPadRight(chr_l_str_scprodline,chr_l_h_inttyp,3);
    RuPadRight(chr_l_str_scprodline,"",30);

    if( !strcmp(chr_l_h_location,"MICX"))
      RuPadRight(chr_l_str_scprodline,"2",20);
 	 else
      RuPadRight(chr_l_str_scprodline,"",20);
 
	int_l_int_noofrec++ ;
	
	if(int_l_int_noofrec == 1)
	{
	 
	 
	 if( RuGenHoffHdr(p_ptr_fopenfile,"SCPROD","21","122","New SYMBOLS's products") != APL_SUCCESS )
	  APL_GOBACK_FAIL
	}

	fprintf(p_ptr_fopenfile,chr_l_str_scprodline);
	fprintf(p_ptr_fopenfile,"\n");

   RuAddCRCFn(chr_l_str_scprodline,&int_l_int_crc);

 } 

	 EXEC SQL Close cscprod;
	 IS_ANY_ORA_ERROR

	 

    if ( int_l_int_noofrec ) 
	  {
	   if ( RuGenHoffFtr(p_ptr_fopenfile,"SCPROD",int_l_int_noofrec,int_l_int_crc) != APL_SUCCESS) 
	   APL_GOBACK_FAIL 
	   (*p_int_noofblocks)++ ; 
	  }



	 fprintf(p_ptr_symrepfile,"\n");
	 fprintf(p_ptr_symrepfile,"%10s","");
	 fprintf(p_ptr_symrepfile,"%10s","SCPROD");
	 fprintf(p_ptr_symrepfile,"%10d",int_l_int_noofrec);
	 fprintf(p_ptr_symrepfile,"%15s","cruproduct");
	 fprintf(p_ptr_symrepfile,"%10d",int_l_int_noofrec);


    APL_GOBACK_SUCCESS


	 
	 
	 RETURN_FAILURE:
      CO_ProcMonitor(p_logfile,"Exiting out of RuGenHoffSCPROD Fn Unsuccessfully\n",NULL,NULL);
	   return (APL_FAILURE);

	 RETURN_SUCCESS:
      CO_ProcMonitor(p_logfile,"Exiting out of RuGenHoffSCPROD Fn Successfully\n",NULL,NULL);
	   return (APL_SUCCESS);

 }






int RuHoffGenSCSEC(FILE* p_ptr_fopenfile,int *p_int_noofblocks,FILE *p_logfile,FILE *p_ptr_symrepfile,INTL_ENV_DATA_STRUCT_H * p_intl_envdatastruct_h,DEBUG_INFO_STRUCT_H** l_debug_info_ptr)
{
   struct sqlca sqlca ;
   char chr_l_h_statregno[HF_STAT_REGNO]  	= APL_NULL_STRING ;
	char chr_l_h_instrcode_A[HF_SEC_CD] 			= APL_NULL_STRING ;

	char chr_l_h_listedflg[HF_LISTED_IND] 	= APL_NULL_STRING ;
	char chr_l_h_prcode[HF_PR_CODE] 			= APL_NULL_STRING ;
	char chr_l_h_instrnmlng[HF_SEC_NAME] 			= APL_NULL_STRING ;
	char chr_l_h_instrnmshrt[HF_SEC_NAME]			= APL_NULL_STRING ; 
	char chr_l_h_sectyp[HF_TYPEOFINSTR] 			= APL_NULL_STRING ;
	char chr_l_h_issue_dt[HF_ISSUE_DATE] 		= APL_NULL_STRING ;
	char chr_l_h_secopdt[HF_SECOP_DATE] 		= APL_NULL_STRING ;
	char chr_l_h_mature_dt[HF_MATURE_DATE] 	= APL_NULL_STRING ;
	char chr_l_h_instrcls[DL_HOFF_SECCLS] 			= APL_NULL_STRING ;
	char chr_l_h_typeofinstr[HF_INSTRUMENT_TYPE]			= APL_NULL_STRING ;

   char chr_l_str_scinstrline[DL_HOFF_SCSECLINE] = APL_NULL_STRING ;
	char chr_l_str_temp[HF_TMP] 				= APL_NULL_STRING ;

	double l_h_nominal_value 	= 0.0 ;
	long chr_l_h_basinstr   	= 0 ; 
	char chr_l_str_nomval[HF_NOM_VAL]			= APL_NULL_STRING ;
	char chr_l_str_basinstr[HF_BASE_SEC]       = APL_NULL_STRING ;
   char chr_l_dcompdt[HF_COMP_DATE] 			= APL_NULL_STRING ;

	int  int_l_int_noofrec 			= 0 ;
	int  int_l_int_crc 				= 0 ; 

   short l_i_statregno 		   = 0 ;
   short l_i_instr_code   			= 0 ;
   short l_i_prcode    			= 0 ;
	short l_i_instrnmlng  			= 0 ;
	short l_i_instrnmshrt			= 0 ;
   short l_i_sectyp    			= 0 ;
   short l_i_issue_dt     		= 0 ;
	short l_i_secopdt    		= 0 ;
   short l_i_mature_dt    		= 0 ;
   short l_i_instrcls    			= 0 ;
   short l_i_basinstr    			= 0 ;
   short l_i_nomval    			= 0 ;
   short l_i_typeofinstr   			= 0 ;
   short l_i_listedflg 			= 0 ;
   short l_i_dcompdt    		= 0 ;

   EXEC SQL VAR chr_l_h_instrcode_A 	IS STRING;
   EXEC SQL VAR chr_l_h_statregno IS STRING;
   EXEC SQL VAR chr_l_dcompdt 		IS STRING;
   EXEC SQL VAR chr_l_h_instrnmlng  IS STRING;
   EXEC SQL VAR chr_l_h_instrnmshrt IS STRING;
   EXEC SQL VAR chr_l_h_prcode 	IS STRING;
   EXEC SQL VAR chr_l_h_sectyp 	IS STRING;
   EXEC SQL VAR chr_l_h_issue_dt 	IS STRING;
   EXEC SQL VAR chr_l_h_mature_dt IS STRING;
   EXEC SQL VAR chr_l_h_secopdt 	IS STRING;
   EXEC SQL VAR chr_l_h_instrcls 	IS STRING;
   EXEC SQL VAR chr_l_h_typeofinstr 	IS STRING;
   EXEC SQL VAR chr_l_h_listedflg IS STRING;

   memset(chr_l_h_instrcode_A    , '\0' , HF_SEC_CD ) ;
   memset(chr_l_h_statregno , '\0' , HF_SEC_CD ) ;
   memset(chr_l_dcompdt     , '\0' , HF_COMP_DATE) ;
   memset(chr_l_h_instrnmlng  , '\0' , HF_SEC_NAME ) ;
   memset(chr_l_h_instrnmshrt , '\0' , HF_SEC_NAME ) ;
   memset(chr_l_h_prcode    , '\0' , HF_PR_CODE ) ;
   memset(chr_l_h_sectyp    , '\0' , HF_TYPEOFINSTR ) ;
   memset(chr_l_h_issue_dt  , '\0' , HF_ISSUE_DATE ) ;
   memset(chr_l_h_mature_dt , '\0' , HF_MATURE_DATE ) ;
   memset(chr_l_h_secopdt   , '\0' , HF_SECOP_DATE ) ;
   memset(chr_l_h_typeofinstr   , '\0' , HF_INSTRUMENT_TYPE ) ;
   memset(chr_l_h_instrcls    , '\0' , DL_HOFF_SECCLS ) ;
   memset(chr_l_h_listedflg , '\0' , HF_LISTED_IND ) ;
   memset(chr_l_str_nomval  , '\0' , HF_NOM_VAL ) ;
   memset(chr_l_str_basinstr  , '\0' , HF_BASE_SEC ) ;
   memset(chr_l_str_scinstrline  , '\0' , DL_HOFF_SCSECLINE ) ;
   memset(chr_l_str_temp       , '\0' , HF_TMP ) ;
	
	
    EXEC SQL Select to_char(LR_DT,'dd/chr_mm/yyyy') into :chr_l_dcompdt:l_i_dcompdt from DL_LOCALREPDATES 
	 where CLR_NAME = :int_g_regen_ind ;
	 IS_ANY_ORA_ERROR 

    EXEC SQL DECLARE cscsec CURSOR FOR 
	 SELECT STAT_REG_NO, instr_code 
	 from DL_RUSRN   
	 where to_date(to_char(maker_dt,'dd/chr_mm/yyyy'),'dd/chr_mm/yyyy') > to_date(:chr_l_dcompdt,'dd/chr_mm/yyyy') 
	 and checker_dt IS NOT NULL ; 
	 IS_ANY_ORA_ERROR

	 EXEC SQL OPEN cscsec ;
    IS_ANY_ORA_ERROR

	 for( ; ; )
	 {

    EXEC SQL FETCH cscsec into :chr_l_h_statregno:l_i_statregno , :chr_l_h_instrcode_A:l_i_instr_code ; 
	 IS_ANY_ORA_ERROR_CURSOR

	 if(APL_ZERO_RESULT_SET)
	  break;

    EXEC SQL select INSTR_TYPE,to_char(ISSUE_DATE,'yyyymmdd'),to_char(MATURE_DT,'yyyymmdd'),NOMINAL_VALUE,LISTED_IND
	 into :chr_l_h_typeofinstr:l_i_typeofinstr , :chr_l_h_issue_dt:l_i_issue_dt, :chr_l_h_mature_dt:l_i_mature_dt , 
	 :l_h_nominal_value:l_i_nomval , :chr_l_h_listedflg:l_i_listedflg 
	 from MT_INSTRUMENT where instr_code = :chr_l_h_instrcode_A ; 
	 IS_ANY_ORA_ERROR

    EXEC SQL select PR_CODE , substr(SEC_NM,1,50) , substr(SEC_NM,1,25) , TYPEOFINSTR , INSTRUMENT_OPDT , SEC_CLS , 
	 BASEINSTRUMENT , to_char(INSTRUMENT_OPDT,'yyyymmdd')
	 into :chr_l_h_prcode:l_i_prcode ,:chr_l_h_instrnmlng:l_i_instrnmlng , :chr_l_h_instrnmshrt:l_i_instrnmshrt ,
	 :chr_l_h_sectyp:l_i_sectyp , :chr_l_h_secopdt:l_i_secopdt ,
	 :chr_l_h_instrcls:l_i_instrcls ,:chr_l_h_basinstr:l_i_basinstr ,
	 :chr_l_h_secopdt:l_i_secopdt 
	 from DL_RUINSTRUMENT where instr_code = :chr_l_h_instrcode_A ; 
	 IS_ANY_ORA_ERROR

    strcpy(chr_l_str_scinstrline," ");
	 
    RuPadRight(chr_l_str_scinstrline,"SCSEC",9);
    
	 strcpy(chr_l_str_temp,"");
	 RuPadRight(chr_l_str_temp,chr_l_h_prcode,3);
    RuPadRight(chr_l_str_temp,"-",1);
    RuPadRight(chr_l_str_temp,chr_l_h_statregno,20);
    RuPadRight(chr_l_str_scinstrline,chr_l_str_temp,24);

    RuPadRight(chr_l_str_scinstrline,chr_l_h_instrnmlng,50);
    RuPadRight(chr_l_str_scinstrline,chr_l_h_instrnmshrt,25);
    RuPadRight(chr_l_str_scinstrline,chr_l_h_sectyp,3);
	 
	 
	 if( !(strcmp(chr_l_h_typeofinstr,"BON")) || !(strcmp(chr_l_h_typeofinstr,"FMT") ) )
	  {
      RuPadRight(chr_l_str_scinstrline,chr_l_h_issue_dt,10);
      RuPadRight(chr_l_str_scinstrline,chr_l_h_mature_dt,10);
	  }
    else
	  {
      RuPadRight(chr_l_str_scinstrline,chr_l_h_secopdt,10);
      RuPadRight(chr_l_str_scinstrline,"",10);
 	  }

      RuPadRight(chr_l_str_scinstrline,chr_l_h_instrcls,3);

 	   sprintf(chr_l_str_basinstr,"%ld",chr_l_h_basinstr);
      RuPadRight(chr_l_str_scinstrline,chr_l_str_basinstr,6);

	   sprintf(chr_l_str_nomval,"%0.2f",l_h_nominal_value);

   if( strcmp(chr_l_h_typeofinstr,"SHS"))
     
      RuPadRight(chr_l_str_scinstrline,chr_l_str_nomval,-20);
   else
      RuPadRight(chr_l_str_scinstrline,"",20);
    
		RuPadRight(chr_l_str_scinstrline,chr_l_h_listedflg,21);

	 int_l_int_noofrec++ ;

	if( int_l_int_noofrec == 1 )
	{
	 if( RuGenHoffHdr(p_ptr_fopenfile,"SCSEC","11","183","New instrument issues") != APL_SUCCESS )
	   APL_GOBACK_FAIL
	}

	 fprintf(p_ptr_fopenfile,chr_l_str_scinstrline);
	 fprintf(p_ptr_fopenfile,"\n");

    RuAddCRCFn(chr_l_str_scinstrline,&int_l_int_crc);

    } 

	 EXEC SQL Close cscsec ;
	 IS_ANY_ORA_ERROR

 	if(int_l_int_noofrec)
 	{
		if ( RuGenHoffFtr(p_ptr_fopenfile,"SCSEC",int_l_int_noofrec,int_l_int_crc) != APL_SUCCESS) 
	  		APL_GOBACK_FAIL 
		(*p_int_noofblocks)++ ; 
 	}

	 fprintf(p_ptr_symrepfile,"\n");
	 fprintf(p_ptr_symrepfile,"%10s","");
	 fprintf(p_ptr_symrepfile,"%10s","SCSEC");
	 fprintf(p_ptr_symrepfile,"%10d",int_l_int_noofrec);
	 fprintf(p_ptr_symrepfile,"%15s","cruinstrurity");
	 fprintf(p_ptr_symrepfile,"%10d",int_l_int_noofrec);


   APL_GOBACK_SUCCESS

	
	RETURN_FAILURE:
     CO_ProcMonitor(p_logfile,"Exiting out of RuGenHoffSCSEC Fn Unsuccessfully\n",NULL,NULL);
	  return (APL_FAILURE);

	RETURN_SUCCESS:
     CO_ProcMonitor(p_logfile,"Exiting out of RuGenHoffSCSEC Fn Successfully\n",NULL,NULL);
	  return(APL_SUCCESS);

 }





int RuHoffGenSCREG(FILE* p_ptr_fopenfile,int *p_int_noofblocks,FILE *p_logfile,FILE *p_ptr_symrepfile,INTL_ENV_DATA_STRUCT_H *p_intl_envdatastruct_h,DEBUG_INFO_STRUCT_H** l_debug_info_ptr)
{
   struct sqlca sqlca ;
   char chr_l_h_statregno[HF_STAT_REGNO]  		= APL_NULL_STRING ;
	char chr_l_h_instrcode_A[HF_SEC_CD] 				= APL_NULL_STRING ;
	char chr_l_h_prcode[HF_PR_CODE] 				= APL_NULL_STRING ;

   char chr_l_str_scregline[DL_HOFF_SCREGLINE] 	= APL_NULL_STRING ;
	char chr_l_str_temp[HF_TMP] 					= APL_NULL_STRING ;

   char chr_l_dcompdt[HF_COMP_DATE] 				= APL_NULL_STRING ;

	int int_l_int_noofrec 			= 0 ;
	int int_l_int_crc 			  	   = 0 ; 

   short l_i_statregno 		   = 0 ;
   short l_i_instr_code   			= 0 ;
   short l_i_prcode    			= 0 ;
   short l_i_dcompdt    		= 0 ;
  
   EXEC SQL VAR chr_l_h_statregno IS STRING ; 
   EXEC SQL VAR chr_l_h_instrcode_A    IS STRING ; 
   EXEC SQL VAR chr_l_h_prcode    IS STRING ; 
   EXEC SQL VAR chr_l_dcompdt     IS STRING ; 

   memset(chr_l_h_statregno   , '\0' , HF_STAT_REGNO ) ;
   memset(chr_l_h_instrcode_A      , '\0' , HF_SEC_CD ) ;
   memset(chr_l_h_prcode      , '\0' , HF_PR_CODE ) ;
   memset(chr_l_dcompdt       , '\0' , HF_COMP_DATE) ;
   memset(chr_l_str_scregline , '\0' , DL_HOFF_SCREGLINE) ;
   memset(chr_l_str_temp      , '\0' , HF_TMP) ;

    


    EXEC SQL Select to_char(LR_DT,'dd/chr_mm/yyyy') into :chr_l_dcompdt:l_i_dcompdt from DL_LOCALREPDATES 
	 where CLR_NAME = :int_g_regen_ind ;
	 IS_ANY_ORA_ERROR 

    EXEC SQL DECLARE cscreg CURSOR FOR 
	 SELECT STAT_REG_NO, instr_code 
	 FROM DL_RUSRN   
	 where to_date(to_char(maker_dt,'dd/chr_mm/yyyy'),'dd/chr_mm/yyyy') > to_date(:chr_l_dcompdt,'dd/chr_mm/yyyy') 
	 and checker_dt IS NOT NULL 
	 order by instr_code , STAT_REG_NO ; 
	 IS_ANY_ORA_ERROR

	 EXEC SQL OPEN cscreg ;
    IS_ANY_ORA_ERROR

	for( ; ; )
	{

    EXEC SQL FETCH cscreg into :chr_l_h_statregno:l_i_statregno , :chr_l_h_instrcode_A:l_i_instr_code ; 
	 IS_ANY_ORA_ERROR_CURSOR

	 if(APL_ZERO_RESULT_SET)
	  break;

    EXEC SQL select PR_CODE into :chr_l_h_prcode:l_i_prcode
	 from DL_RUINSTRUMENT where instr_code = :chr_l_h_instrcode_A ; 
	 IS_ANY_ORA_ERROR

    strcpy(chr_l_str_scregline," ");
	 RuPadRight(chr_l_str_scregline,"SCREG",9);
    
	 strcpy(chr_l_str_temp,"");
    RuPadRight(chr_l_str_temp,chr_l_h_prcode,3);
    RuPadRight(chr_l_str_temp,"-",1);
    RuPadRight(chr_l_str_temp,chr_l_h_statregno,20);
    RuPadRight(chr_l_str_scregline,chr_l_str_temp,24);
    
	 RuPadRight(chr_l_str_scregline,chr_l_h_statregno,20);

	 int_l_int_noofrec++ ;

	 if(int_l_int_noofrec == 1)
	 {
	  if( RuGenHoffHdr(p_ptr_fopenfile,"SCREG","3","55","New registration numbers of instrument") != APL_SUCCESS )
	  APL_GOBACK_FAIL
	 }

	 fprintf(p_ptr_fopenfile,chr_l_str_scregline);
	 fprintf(p_ptr_fopenfile,"\n");

    RuAddCRCFn(chr_l_str_scregline,&int_l_int_crc);

   } 

	 EXEC SQL Close cscreg ;

	 IS_ANY_ORA_ERROR

	if(int_l_int_noofrec)
	{
	 if ( RuGenHoffFtr(p_ptr_fopenfile,"SCREG",int_l_int_noofrec,int_l_int_crc) != APL_SUCCESS) 
	  APL_GOBACK_FAIL 
	  (*p_int_noofblocks)++ ; 
   }

	 fprintf(p_ptr_symrepfile,"\n");
	 fprintf(p_ptr_symrepfile,"%10s","");
	 fprintf(p_ptr_symrepfile,"%10s","SCREG");
	 fprintf(p_ptr_symrepfile,"%10d",int_l_int_noofrec);
	 fprintf(p_ptr_symrepfile,"%15s","crusrn");
	 fprintf(p_ptr_symrepfile,"%10d",0); 


   APL_GOBACK_SUCCESS

	
	RETURN_FAILURE:
     CO_ProcMonitor(p_logfile,"Exiting out of RuGenHoffSCREG Fn Unsuccessfully\n",NULL,NULL);
	  return (APL_FAILURE);

	RETURN_SUCCESS:
     CO_ProcMonitor(p_logfile,"Exiting out of RuGenHoffSCREG Fn Successfully\n",NULL,NULL);
	  return(APL_SUCCESS);

 }






int RuHoffGenSCSECPRS(FILE* p_ptr_fopenfile,int *p_int_noofblocks,FILE *p_logfile,FILE *p_ptr_symrepfile,INTL_ENV_DATA_STRUCT_H * p_intl_envdatastruct_h,DEBUG_INFO_STRUCT_H** l_debug_info_ptr)
{
   struct sqlca sqlca ;
   char chr_l_h_statregno[HF_STAT_REGNO]  		= APL_NULL_STRING ;
	char chr_l_h_instrcode_A[HF_SEC_CD] 				= APL_NULL_STRING ;
	char chr_l_h_prcode[HF_PR_CODE] 				= APL_NULL_STRING ;
	char chr_l_h_typeofinstr[HF_INSTRUMENT_TYPE] 			= APL_NULL_STRING ; 
   char chr_l_h_frq_cd[HF_FREQ_CODE] 				= APL_NULL_STRING ;
	char chr_l_h_discountflg[HF_DISCNT_IND_LEN] 	= APL_NULL_STRING ; 
	char chr_l_h_mature_dt[HF_MATURE_DATE] 		= APL_NULL_STRING ; 
	char chr_l_h_issue_dt[HF_ISSUE_DATE] 			= APL_NULL_STRING ; 
	char chr_l_h_sysdate[HF_CURR_DATE] 			= APL_NULL_STRING ; 
   char chr_l_h_intdate[HF_INT_DATE]				= APL_NULL_STRING ; 
   char chr_l_dcompdt[HF_COMP_DATE] 				= APL_NULL_STRING ;
   char chr_l_str_scinstrprsline[DL_HOFF_SCSECPRSLINE]	= APL_NULL_STRING ;
	char chr_l_str_temp[HF_TMP] 					= APL_NULL_STRING ;
	char chr_l_str_inc_rt[HF_INCOME_RT] 			= APL_NULL_STRING ;
 
	double l_h_instr_inc_rate    	= 0.0 ;
	int    int_l_h_totnoyears 	= 0 ; 
	int    int_l_h_days 			= 0 ; 
	int    int_l_int_totnoint 	= 0 ;
	int    int_l_int_divisor  	= 0 ;
	int    int_l_int_tobeadded  = 0 ;
	int    int_l_int_ctr  		= 0 ;
	int    int_l_int_intdate		= 0 ;
	int    int_l_int_instrrec		= 0 ;
	int    int_l_int_bonrec		= 0 ;
	int    int_l_int_totinstrrec  = 0 ;
	int  	 int_l_int_noofrec 	= 0 ;
	int    int_l_int_crc 			= 0 ; 

   short l_i_statregno 	   = 0 ;
   short l_i_instr_code   		= 0 ;
   short l_i_prcode    		= 0 ;
   short l_i_dcompdt    	= 0 ;
   short l_i_inc_rt 			= 0 ; 
	short l_i_frq_cd 			= 0 ; 
	short l_i_typeofinstr 		= 0 ; 
	short l_i_discountflg 	= 0 ; 
	short l_i_mature_dt 		= 0 ; 
	short l_i_issue_dt 		= 0 ; 
	short l_i_totnoyears 	= 0 ; 
	short l_i_intdate 		= 0 ; 
	short l_i_sysdate 		= 0 ; 
	short l_i_days  	 		= 0 ; 

   EXEC SQL VAR chr_l_h_instrcode_A		    	IS STRING ; 
   EXEC SQL VAR chr_l_h_prcode    		IS STRING ; 
   EXEC SQL VAR chr_l_dcompdt     		IS STRING ; 
   EXEC SQL VAR chr_l_h_mature_dt     	IS STRING ; 
   EXEC SQL VAR chr_l_h_issue_dt      	IS STRING ; 
   EXEC SQL VAR chr_l_h_sysdate       	IS STRING ; 
   EXEC SQL VAR chr_l_h_typeofinstr       	IS STRING ; 
   EXEC SQL VAR chr_l_h_discountflg   	IS STRING ; 

   memset(chr_l_h_statregno 	   , '\0' , HF_STAT_REGNO ) 	;
   memset(chr_l_h_instrcode_A      		, '\0' , HF_SEC_CD ) 		;
   memset(chr_l_h_prcode      		, '\0' , HF_PR_CODE ) 		;
   memset(chr_l_h_mature_dt   		, '\0' , HF_MATURE_DATE ) 	;
   memset(chr_l_h_issue_dt    		, '\0' , HF_ISSUE_DATE ) 	;
   memset(chr_l_h_sysdate     		, '\0' , HF_CURR_DATE ) 		;
   memset(chr_l_h_typeofinstr     		, '\0' , HF_INSTRUMENT_TYPE ) 		;
   memset(chr_l_dcompdt       		, '\0' , HF_COMP_DATE) 		;
   memset(chr_l_str_scinstrprsline 	, '\0' , DL_HOFF_SCSECPRSLINE)	;
   memset(chr_l_str_temp      		, '\0' , HF_TMP) 	 	   ;

    EXEC SQL Select to_char(LR_DT,'dd/chr_mm/yyyy') into :chr_l_dcompdt:l_i_dcompdt from DL_LOCALREPDATES
	 where CLR_NAME = :int_g_regen_ind;
	 IS_ANY_ORA_ERROR 

    EXEC SQL DECLARE cscinstrprs CURSOR FOR 
	 SELECT a.STAT_REG_NO, a.instr_code 
	 from DL_RUSRN a , MT_INSTRUMENT b 
	 where to_date(to_char(a.maker_dt,'dd/chr_mm/yyyy'),'dd/chr_mm/yyyy') > to_date(:chr_l_dcompdt,'dd/chr_mm/yyyy') 
	 and a.checker_dt IS NOT NULL 
	 and a.instr_code = b.instr_code 
	 order by a.instr_code , a.STAT_REG_NO ; 
	 IS_ANY_ORA_ERROR

	 EXEC SQL OPEN cscinstrprs ;
    IS_ANY_ORA_ERROR

	for( ; ; )
	{

    EXEC SQL FETCH cscinstrprs into :chr_l_h_statregno:l_i_statregno , :chr_l_h_instrcode_A:l_i_instr_code ; 
	 IS_ANY_ORA_ERROR_CURSOR

	 if(APL_ZERO_RESULT_SET)
	  break;

    EXEC SQL select PR_CODE into :chr_l_h_prcode:l_i_prcode
	 from DL_RUINSTRUMENT where instr_code = :chr_l_h_instrcode_A ; 
	 IS_ANY_ORA_ERROR

	 EXEC SQL select INSTR_INT_RATE , FREQ_CODE , INSTR_TYPE , DISCT_IND , to_char(MATURE_DT,'yyyymmdd') , 
	 to_char(ISSUE_DATE,'yyyymmdd') ,  MATURE_DT - ISSUE_DATE  
	 into :l_h_instr_inc_rate:l_i_inc_rt , :chr_l_h_frq_cd:l_i_frq_cd ,:chr_l_h_typeofinstr:l_i_typeofinstr , 
	 :chr_l_h_discountflg:l_i_discountflg,
	 :chr_l_h_mature_dt:l_i_mature_dt , chr_l_h_issue_dt:l_i_issue_dt , int_l_h_totnoyears:l_i_totnoyears 
    from MT_INSTRUMENT where instr_code = :chr_l_h_instrcode_A ; 
	 IS_ANY_ORA_ERROR
	
	 strcpy(chr_l_str_inc_rt,"");
	 sprintf(chr_l_str_inc_rt,"%0.2f",l_h_instr_inc_rate);

	 if ( !(strcmp(chr_l_h_frq_cd,"A")) )
	  {
		int_l_int_divisor 		= 365 ;
		int_l_int_tobeadded 	= 365 ;
	  }	
	 else if ( !(strcmp(chr_l_h_frq_cd,"S")) )
	  {
		int_l_int_divisor 		= 183 ;
		int_l_int_tobeadded 	= 183 ;
	  }	
	 else if ( !(strcmp(chr_l_h_frq_cd,"Q")) )
	  {
		int_l_int_divisor 		= 91 ;
		int_l_int_tobeadded 	= 91 ;
	  }
	 else if ( !(strcmp(chr_l_h_frq_cd,"M")) )
		{
		 int_l_int_divisor 	= 30 ;
		 int_l_int_tobeadded 	= 30 ;
	   }
	 else 
		{
		 int_l_int_divisor 	= 1000 ;
		 int_l_int_tobeadded 	= 0 	 ;
	   }


    if( ( !(strcmp(chr_l_h_typeofinstr,"BON")) || !(strcmp(chr_l_h_typeofinstr,"FMT")) ) && !(strcmp(chr_l_h_discountflg,"N")) )
      int_l_int_totnoint = int_l_h_totnoyears / int_l_int_divisor ; 
    else
		int_l_int_totnoint = 1;

   
		EXEC SQL SELECT TO_CHAR(SYS_DATE,'dd/chr_mm/yyyy') INTO 
      :chr_l_h_sysdate:l_i_sysdate
	   FROM PRO_SYS_DATE ;
		IS_ANY_ORA_ERROR


    for( int_l_int_ctr = 0 ; int_l_int_ctr < int_l_int_totnoint ; int_l_int_ctr++ )
	 {
    	strcpy(chr_l_str_scinstrprsline," ");
      RuPadRight(chr_l_str_scinstrprsline , "SCSECPRS",9);

    	strcpy(chr_l_str_temp,"");
		RuPadRight(chr_l_str_temp ,chr_l_h_prcode,3);
		RuPadRight(chr_l_str_temp ,"-",1);
		RuPadRight(chr_l_str_temp ,chr_l_h_statregno,20);
      RuPadRight(chr_l_str_scinstrprsline , chr_l_str_temp , 24 );

      if( ( !(strcmp(chr_l_h_typeofinstr,"BON")) || !(strcmp(chr_l_h_typeofinstr,"FMT")) ) && (strcmp(chr_l_h_discountflg,"Y")) )
       {
        EXEC SQL select to_char( to_date(:chr_l_h_issue_dt,'yyyymmdd') + :int_l_int_tobeadded*:int_l_int_ctr , 'yyyymmdd')
		  into :chr_l_h_intdate:l_i_intdate from dual ;
        
		  IS_ANY_ORA_ERROR

        RuPadRight(chr_l_str_scinstrprsline , chr_l_h_intdate , 10 );
        RuPadRight(chr_l_str_scinstrprsline , chr_l_str_inc_rt , 20 );

        EXEC SQL select to_date(:chr_l_h_intdate,'yyyymmdd') - to_date(:chr_l_h_sysdate,'dd/chr_mm/yyyy')
		  into :int_l_h_days:l_i_days from dual ;
		  IS_ANY_ORA_ERROR

	 	  if (int_l_h_days >= 0 )
         RuPadRight(chr_l_str_scinstrprsline,"N",1);
        else
         RuPadRight(chr_l_str_scinstrprsline,"Y",1);
      }
      else if( ( !(strcmp(chr_l_h_typeofinstr,"BON")) || !(strcmp(chr_l_h_typeofinstr,"FMT")) ) && !(strcmp(chr_l_h_discountflg,"Y")) )
      { 
         RuPadRight(chr_l_str_scinstrprsline , chr_l_h_mature_dt , 10 );
         RuPadRight(chr_l_str_scinstrprsline , "0" , 20 );


        EXEC SQL select to_date(:chr_l_h_mature_dt,'yyyymmdd') - to_date(:chr_l_h_sysdate,'dd/chr_mm/yyyy')
		  into :int_l_h_days:l_i_days from dual ;
		  IS_ANY_ORA_ERROR

	 	  if (int_l_h_days >= 0 )
         RuPadRight(chr_l_str_scinstrprsline,"N",1);
        else
         RuPadRight(chr_l_str_scinstrprsline,"Y",1);

      }
		else
		{
         RuPadRight(chr_l_str_scinstrprsline , "" , 10 );
         RuPadRight(chr_l_str_scinstrprsline , "" , 20 );
         RuPadRight(chr_l_str_scinstrprsline , "" , 1 );
      }

	  	 int_l_int_noofrec++ ; 

	    if( int_l_int_noofrec == 1 )
		 {
			 if( RuGenHoffHdr(p_ptr_fopenfile,"SCSECPRS","5","66","The detailed table of issue coupons") != APL_SUCCESS )
	  		  APL_GOBACK_FAIL
		 }

	  	 fprintf(p_ptr_fopenfile,chr_l_str_scinstrprsline);
	  	 fprintf(p_ptr_fopenfile,"\n");

     	 RuAddCRCFn(chr_l_str_scinstrprsline,&int_l_int_crc);

    } 

	} 

	 EXEC SQL Close cscinstrprs ;
	 IS_ANY_ORA_ERROR

	if(int_l_int_noofrec)
	{
		if ( RuGenHoffFtr(p_ptr_fopenfile,"SCSECPRS",int_l_int_noofrec,int_l_int_crc) != APL_SUCCESS) 
	 		APL_GOBACK_FAIL 
	   (*p_int_noofblocks)++ ; 
	}

    EXEC SQL  select count(*) into :int_l_int_totinstrrec from DL_RUINSTRUMENT ;
	 IS_ANY_ORA_ERROR
    
	 EXEC SQL  select count(*) into :int_l_int_bonrec from DL_RUINSTRUMENT a , MT_INSTRUMENT b 
	 where ( b.INSTR_TYPE = 'BON' or b.INSTR_TYPE = 'FMT') and b.DISCT_IND = 'N' 
	 and a.instr_code = b.instr_code ;
	 IS_ANY_ORA_ERROR

	 EXEC SQL select count(*) into :int_l_int_instrrec from DL_RUSRN   
	 where to_date(to_char(maker_dt,'dd/chr_mm/yyyy'),'dd/chr_mm/yyyy') > to_date(:chr_l_dcompdt,'dd/chr_mm/yyyy') 
	 and checker_dt IS NOT NULL ; 
	 IS_ANY_ORA_ERROR

	 fprintf(p_ptr_symrepfile,"\n");
	 fprintf(p_ptr_symrepfile,"%10s","");
	 fprintf(p_ptr_symrepfile,"%10s","SCSECPRS");
	 fprintf(p_ptr_symrepfile,"%10d",int_l_int_noofrec);
	 fprintf(p_ptr_symrepfile,"%15s","cruinstrurity");
	 fprintf(p_ptr_symrepfile,"%10d",int_l_int_instrrec); 
	 fprintf(p_ptr_symrepfile,"%15s","BON/FMT");
	 fprintf(p_ptr_symrepfile,"%10d",int_l_int_bonrec); 
	 fprintf(p_ptr_symrepfile,"%15s","SHS/DISC");
	 fprintf(p_ptr_symrepfile,"%10d",int_l_int_totinstrrec - int_l_int_bonrec); 

   APL_GOBACK_SUCCESS

	
	RETURN_FAILURE:
     CO_ProcMonitor(p_logfile,"Exiting out of RuGenHoffSCSECPRS Fn Unsuccessfully\n",NULL,NULL);
	  return (APL_FAILURE);

	RETURN_SUCCESS:
     CO_ProcMonitor(p_logfile,"Exiting out of RuGenHoffSCSECPRS Fn Successfully\n",NULL,NULL);
	  return(APL_SUCCESS);


 }





int RuHoffGenSCCUSTOM(FILE* p_ptr_fopenfile,int *p_int_noofblocks,FILE *p_logfile,FILE *p_ptr_symrepfile,INTL_ENV_DATA_STRUCT_H *p_intl_envdatastruct_h,DEBUG_INFO_STRUCT_H** l_debug_info_ptr)
{
   struct sqlca sqlca ;
   char chr_l_h_client_a[HF_CLIENT]  				= APL_NULL_STRING ;
   char chr_l_h_instrcode_A[HF_SEC_CD]   				= APL_NULL_STRING ;
	char chr_l_h_baseacc[HF_BASE_CLT] 				= APL_NULL_STRING ;
	char chr_l_h_basinstr[HF_BASE_SEC] 					= APL_NULL_STRING ;

   char chr_l_str_sccustomline[DL_HOFF_SCCUSTOMLINE]	= APL_NULL_STRING ;
   char chr_l_dcompdt[HF_COMP_DATE] 				= APL_NULL_STRING ;

	int  int_l_int_noofrec 			= 0 ;
	int  int_l_int_accrec 			= 0 ;
	int  int_l_int_instrrec 			= 0 ;
	int  int_l_int_crc 				= 0 ; 

   short l_i_account 		   = 0 ;
   short l_i_instr_code  		   = 0 ;
   short l_i_baseacc   			= 0 ;
   short l_i_basinstr   			= 0 ;
   short l_i_dcompdt    		= 0 ;
   short l_i_instrrec	    		= 0 ;
   
   EXEC SQL VAR chr_l_h_client_a IS STRING ;
   EXEC SQL VAR chr_l_h_instrcode_A  IS STRING ;
   EXEC SQL VAR chr_l_h_baseacc IS STRING ;
   EXEC SQL VAR chr_l_h_basinstr  IS STRING ;
   EXEC SQL VAR chr_l_dcompdt 	 IS STRING ;

   memset(chr_l_h_client_a,			'\0',HF_CLIENT);
   memset(chr_l_h_instrcode_A ,			'\0',HF_SEC_CD);
   memset(chr_l_h_baseacc,			'\0',HF_BASE_CLT);
   memset(chr_l_h_basinstr ,			'\0',HF_BASE_SEC);
   memset(chr_l_dcompdt,				'\0',HF_COMP_DATE);
   memset(chr_l_str_sccustomline,	'\0',DL_HOFF_SCCUSTOMLINE);

   EXEC SQL Select to_char(LR_DT,'dd/chr_mm/yyyy') into :chr_l_dcompdt:l_i_dcompdt from DL_LOCALREPDATES
	where CLR_NAME = :int_g_regen_ind ;
	IS_ANY_ORA_ERROR 

   EXEC SQL DECLARE csccustom1 CURSOR FOR 
	SELECT MT_CLIENT.CLN_CODE , DL_RUCLIENT.BASECLT  
	from MT_CLIENT , DL_RUCLIENT where 
	to_date(to_char(MT_CLIENT.CLN_DATEOF_INPUT,'dd/chr_mm/yyyy'),'dd/chr_mm/yyyy') > to_date(:chr_l_dcompdt,'dd/chr_mm/yyyy') 
	and MT_CLIENT.CHECKER_DT IS NOT NULL 
	and MT_CLIENT.CLN_BRK_ALL != 'B' and MT_CLIENT.CLN_CLAS = '2' and MT_CLIENT.CLN_CODE = DL_RUCLIENT.client ; 
	IS_ANY_ORA_ERROR

	EXEC SQL OPEN csccustom1 ;
   IS_ANY_ORA_ERROR

	 for( ; ; )
	 {

    EXEC SQL FETCH csccustom1 into :chr_l_h_client_a:l_i_account , :chr_l_h_baseacc:l_i_baseacc  ; 
	 IS_ANY_ORA_ERROR_CURSOR

	 if(APL_ZERO_RESULT_SET)
	  break;

     strcpy(chr_l_str_sccustomline," ");
	  RuPadRight(chr_l_str_sccustomline,"SCCUSTOM",9);
	  
	  RuPadRight(chr_l_str_sccustomline,chr_l_h_baseacc,6);

	 int_l_int_noofrec++ ; 
	 if( int_l_int_noofrec == 1 )
	 {
		if( RuGenHoffHdr(p_ptr_fopenfile,"SCCUSTOM","2","17","New custody clients") != APL_SUCCESS )
	  	  APL_GOBACK_FAIL
	 }

	  fprintf(p_ptr_fopenfile,chr_l_str_sccustomline);
	  fprintf(p_ptr_fopenfile,"\n");

     RuAddCRCFn(chr_l_str_sccustomline,&int_l_int_crc);

    } 

	 EXEC SQL Close csccustom1 ;
	 IS_ANY_ORA_ERROR

	 int_l_int_accrec = int_l_int_noofrec ;


	 

    EXEC SQL DECLARE csccustom2 CURSOR FOR 
	 SELECT MT_INSTRUMENT.instr_code , DL_RUINSTRUMENT.BASEINSTRUMENT   
	 from MT_INSTRUMENT  , DL_RUINSTRUMENT where 
	 to_date(to_char(MT_INSTRUMENT.DATEOF_INPUT,'dd/chr_mm/yyyy'),'dd/chr_mm/yyyy') > to_date(:chr_l_dcompdt,'dd/chr_mm/yyyy') and 
	 MT_INSTRUMENT.checker_dt IS NOT NULL
	 and MT_INSTRUMENT.instr_code = DL_RUINSTRUMENT.instr_code ; 
	 IS_ANY_ORA_ERROR

	 EXEC SQL OPEN csccustom2 ;
    IS_ANY_ORA_ERROR

	 for( ; ; )
	 {

    EXEC SQL FETCH csccustom2 into :chr_l_h_instrcode_A:l_i_instr_code , :chr_l_h_basinstr:l_i_basinstr ; 
	 IS_ANY_ORA_ERROR_CURSOR

	 if(APL_ZERO_RESULT_SET)
	  break;

    strcpy(chr_l_str_sccustomline," ");
	 RuPadRight(chr_l_str_sccustomline,"SCCUSTOM",9);
	 RuPadRight(chr_l_str_sccustomline,chr_l_h_basinstr,6);


	 int_l_int_noofrec++ ; 
	
	 if( int_l_int_noofrec == 1 )
	 {
		if( RuGenHoffHdr(p_ptr_fopenfile,"SCCUSTOM","2","17","New custody clients") != APL_SUCCESS )
	  	  APL_GOBACK_FAIL
	 }

	 fprintf(p_ptr_fopenfile,chr_l_str_sccustomline);
	 fprintf(p_ptr_fopenfile,"\n");

    RuAddCRCFn(chr_l_str_sccustomline,&int_l_int_crc);

    } 

	 EXEC SQL Close csccustom2 ;
	 IS_ANY_ORA_ERROR

    

    if ( int_l_int_noofrec ) 
	  {
	   if ( RuGenHoffFtr(p_ptr_fopenfile,"SCCUSTOM",int_l_int_noofrec,int_l_int_crc) != APL_SUCCESS) 
	    APL_GOBACK_FAIL 
	    (*p_int_noofblocks)++ ; 
     }

    EXEC SQL select count(*) into :int_l_int_instrrec:l_i_instrrec from DL_RUSRN 
	 where to_date(to_char(maker_dt,'dd/chr_mm/yyyy'),'dd/chr_mm/yyyy') > to_date(:chr_l_dcompdt,'dd/chr_mm/yyyy') 
	 and checker_dt IS NOT NULL ;
	 IS_ANY_ORA_ERROR

	 

	 fprintf(p_ptr_symrepfile,"\n");
	 fprintf(p_ptr_symrepfile,"%10s","");
	 fprintf(p_ptr_symrepfile,"%10s","SCCUSTOM");
	 fprintf(p_ptr_symrepfile,"%10d",int_l_int_noofrec);
	 fprintf(p_ptr_symrepfile,"%15s","cruaccount");
	 fprintf(p_ptr_symrepfile,"%10d",int_l_int_accrec); 
	 fprintf(p_ptr_symrepfile,"%15s","cruinstrurity");
	 fprintf(p_ptr_symrepfile,"%10d",int_l_int_instrrec); 

   APL_GOBACK_SUCCESS

	
	RETURN_FAILURE:
     CO_ProcMonitor(p_logfile,"Exiting out of RuGenHoffSCCUSTOM Fn Unsuccessfully\n",NULL,NULL);
	  return (APL_FAILURE);

	RETURN_SUCCESS:
     CO_ProcMonitor(p_logfile,"Exiting out of RuGenHoffSCCUSTOM Fn Successfully\n",NULL,NULL);
	  return(APL_SUCCESS);

}






int RuHoffGenSCLOC(FILE* p_ptr_fopenfile,int *p_int_noofblocks,FILE *p_logfile,FILE *p_ptr_symrepfile,INTL_ENV_DATA_STRUCT_H * p_intl_envdatastruct_h,DEBUG_INFO_STRUCT_H** l_debug_info_ptr)
{
   struct sqlca sqlca ;
   char chr_l_h_location[HF_LOC]  	  	= APL_NULL_STRING ;
	char chr_l_h_locnm[HF_LOC_NAME]   				= APL_NULL_STRING ; 
	char chr_l_h_basloc[HF_BASE_LOC] 				= APL_NULL_STRING ;
   char chr_l_str_sclocline[DL_HOFF_SCLOCLINE] 	= APL_NULL_STRING ;
   char chr_l_dcompdt[HF_COMP_DATE] 				= APL_NULL_STRING ;
	
	int  int_l_int_noofrec 				= 0 ;
	int  int_l_int_crc 					= 0 ; 

   short l_i_location 		 	  	= 0 ;
   short l_i_dcompdt 		 	  	= 0 ;
   short l_i_basloc   				= 0 ;
   short l_i_locnm      			= 0 ;
    
   EXEC SQL VAR chr_l_h_location 	IS STRING ;
   EXEC SQL VAR chr_l_h_locnm    	IS STRING ;
   EXEC SQL VAR chr_l_h_basloc   	IS STRING ;
   EXEC SQL VAR chr_l_dcompdt 		IS STRING ;

   memset(chr_l_h_location		,'\0',	HF_LOC)	;
   memset(chr_l_h_locnm   		,'\0',	HF_LOC_NAME)		;
   memset(chr_l_h_basloc  		,'\0',	HF_BASE_LOC)		;
   memset(chr_l_str_sclocline  ,'\0',	DL_HOFF_SCLOCLINE)	;
   memset(chr_l_dcompdt 		   ,'\0',	HF_COMP_DATE)	;

   EXEC SQL Select to_char(LR_DT,'dd/chr_mm/yyyy') into :chr_l_dcompdt:l_i_dcompdt from DL_LOCALREPDATES 
	where CLR_NAME = :int_g_regen_ind ;
	IS_ANY_ORA_ERROR 

   EXEC SQL DECLARE cscloc CURSOR FOR 
	SELECT LOC , substr(LOC_NAME,1,60) , BASELOCATION  
	from DL_RULOCATION where 
	to_date(to_char(maker_dt,'dd/chr_mm/yyyy'),'dd/chr_mm/yyyy') > to_date(:chr_l_dcompdt,'dd/chr_mm/yyyy') and 
	checker_dt IS NOT NULL ; 
	IS_ANY_ORA_ERROR

	EXEC SQL OPEN cscloc ;
   IS_ANY_ORA_ERROR

	 for( ; ; )
	 {

     EXEC SQL FETCH cscloc into :chr_l_h_location:l_i_location , :chr_l_h_locnm:l_i_locnm , :chr_l_h_basloc:l_i_basloc ; 
	  IS_ANY_ORA_ERROR_CURSOR

	  if(APL_ZERO_RESULT_SET)
	   break;

     strcpy(chr_l_str_sclocline," ");
     RuPadRight(chr_l_str_sclocline,"SCLOC",9);
     RuPadRight(chr_l_str_sclocline,chr_l_h_location,10);
     RuPadRight(chr_l_str_sclocline,chr_l_h_locnm,60);
     RuPadRight(chr_l_str_sclocline,chr_l_h_basloc,6);

	  int_l_int_noofrec++ ; 

	  if( int_l_int_noofrec == 1 )
	  {
		if( RuGenHoffHdr(p_ptr_fopenfile,"SCLOC","4","87","Custodian locations") != APL_SUCCESS )
	  		APL_GOBACK_FAIL
	  }

	  fprintf(p_ptr_fopenfile,chr_l_str_sclocline);
	  fprintf(p_ptr_fopenfile,"\n");

     RuAddCRCFn(chr_l_str_sclocline,&int_l_int_crc);

    } 

	 EXEC SQL Close cscloc ;
	 IS_ANY_ORA_ERROR 

    if ( int_l_int_noofrec ) 
	 {
	  if ( RuGenHoffFtr(p_ptr_fopenfile,"SCLOC",int_l_int_noofrec,int_l_int_crc) != APL_SUCCESS) 
	   APL_GOBACK_FAIL 
	   (*p_int_noofblocks)++ ; 
    }

	 fprintf(p_ptr_symrepfile,"\n");
	 fprintf(p_ptr_symrepfile,"%10s","");
	 fprintf(p_ptr_symrepfile,"%10s","SCLOC");
	 fprintf(p_ptr_symrepfile,"%10d",int_l_int_noofrec);
	 fprintf(p_ptr_symrepfile,"%15s","crulocation");
	 fprintf(p_ptr_symrepfile,"%10d",int_l_int_noofrec); 


   APL_GOBACK_SUCCESS 

	
	RETURN_FAILURE:
     CO_ProcMonitor(p_logfile,"Exiting out of RuGenHoffSCLOC Fn Unsuccessfully\n",NULL,NULL);
	  return (APL_FAILURE);

	RETURN_SUCCESS:
     CO_ProcMonitor(p_logfile,"Exiting out of RuGenHoffSCLOC Fn Successfully\n",NULL,NULL);
	  return(APL_SUCCESS);

}





int RuHoffGenSCACCT(FILE* p_ptr_fopenfile,int *p_int_noofblocks,FILE*p_logfile,FILE *p_ptr_symrepfile,INTL_ENV_DATA_STRUCT_H * p_intl_envdatastruct_h,DEBUG_INFO_STRUCT_H** l_debug_info_ptr)
{
 struct sqlca sqlca ;
   char chr_l_h_client_a[HF_CLIENT] 	   		= APL_NULL_STRING ;
   char chr_l_h_glclient[HF_CLIENT] 	  		= APL_NULL_STRING ;
   char chr_l_h_location[HF_LOC] 	   		= APL_NULL_STRING ;
	char chr_l_h_locnm[HF_LOC_NAME] 						= APL_NULL_STRING ;
	char chr_l_h_basloc[HF_BASE_LOC] 					= APL_NULL_STRING ;
	char chr_l_h_cname[HF_CLT_NAME] 						= APL_NULL_STRING ;
	char chr_l_h_depcode[HF_DEPCD_LEN] 				= APL_NULL_STRING ;
	char chr_l_h_intdomcpac[HF_INT_DOMCP] 		= APL_NULL_STRING ;
	char chr_l_h_acctyp[HF_CLT_TYPE] 					= APL_NULL_STRING ;
	char chr_l_h_loctyp[HF_LOC_TYPE] 					= APL_NULL_STRING ;
	char chr_l_h_cubk[HF_CUBRK] 				   	= APL_NULL_STRING ;
	char chr_l_h_cractyp[HF_CRACTYPE] 				= APL_NULL_STRING ;
	long chr_l_h_baseacc = 0 ;
	char chr_l_str_baseacc[HF_BASE_CLT] 				= APL_NULL_STRING ;
	char chr_l_h_maker[HF_MAKER] 				  	   = APL_NULL_STRING ;
	char chr_l_h_domcpac[HF_DOMCP_LEN] 				= APL_NULL_STRING ;
	char chr_l_str_cractyp[HF_CRACTYPE] 				= APL_NULL_STRING ;
	char chr_l_str_glclient[HF_CLIENT] 		= APL_NULL_STRING ;
	char chr_l_str_crloc[HF_CR_LOC]	 				= APL_NULL_STRING ;

   char chr_l_str_scacctline[HF_SCACCTLINE]		= APL_NULL_STRING ;
   char chr_l_str_temp[DL_HOFF_SCLOCLINE]				= APL_NULL_STRING ;

   char chr_l_dcompdt[HF_COMP_DATE] 					= APL_NULL_STRING ;

	int int_l_int_noofrec 					= 0 ;
	int int_l_int_accrec	 					= 0 ;
	int int_l_int_locrec 						= 0 ;
	int int_l_int_crc  						= 0 ; 

   short l_i_account 			 	  	= 0 ;
   short l_i_intdomcpac			 	  	= 0 ;
   short l_i_cubk					 	  	= 0 ;
   short l_i_dcompdt 			 	  	= 0 ;
   short l_i_location 			 	  	= 0 ;
   short l_i_ibbsaccount 		 	  	= 0 ;
   short l_i_basloc 				 	  	= 0 ;
   short l_i_locnm 				 	  	= 0 ;
   short l_i_cname      				= 0 ;
   short l_i_domcpac      				= 0 ;
   short l_i_acctyp      				= 0 ;
   short l_i_loctyp      				= 0 ;
   short l_i_cractyp      				= 0 ;
   short l_i_baseacc      				= 0 ;
   short l_i_depcode      				= 0 ;
   short l_i_maker      				= 0 ;
   short l_i_locrec      				= 0 ;
   short l_i_accrec      				= 0 ;

   EXEC SQL VAR chr_l_h_client_a 		IS STRING ; 
   EXEC SQL VAR chr_l_h_glclient 	IS STRING ; 
   EXEC SQL VAR chr_l_h_location 		IS STRING ; 
   EXEC SQL VAR chr_l_h_locnm 			IS STRING ; 
   EXEC SQL VAR chr_l_h_basloc 		IS STRING ; 
   EXEC SQL VAR chr_l_h_cname 			IS STRING ; 
   EXEC SQL VAR chr_l_h_depcode 		IS STRING ; 
   EXEC SQL VAR chr_l_h_intdomcpac 	IS STRING ; 
   EXEC SQL VAR chr_l_h_acctyp 		IS STRING ; 
   EXEC SQL VAR chr_l_h_loctyp 		IS STRING ; 
   EXEC SQL VAR chr_l_h_cubk 			IS STRING ; 
   EXEC SQL VAR chr_l_h_cractyp 		IS STRING ; 
   EXEC SQL VAR chr_l_h_maker 			IS STRING ; 
   EXEC SQL VAR chr_l_h_domcpac 		IS STRING ; 

   memset(chr_l_h_client_a,			'\0',HF_CLIENT);
	memset(chr_l_h_glclient,		'\0',HF_CLIENT);
	memset(chr_l_h_location,			'\0',HF_LOC);
	memset(chr_l_h_locnm,				'\0',HF_LOC_NAME);
	memset(chr_l_h_basloc,			'\0',HF_BASE_LOC);
	memset(chr_l_h_cname,				'\0',HF_BASE_LOC);
   memset(chr_l_h_depcode,			'\0',HF_DEPCD_LEN);
   memset(chr_l_h_intdomcpac,		'\0',HF_INT_DOMCP);
	memset(chr_l_h_acctyp,			'\0',HF_CLT_TYPE);
	memset(chr_l_h_loctyp,			'\0',HF_LOC_TYPE);
	memset(chr_l_h_cubk,				'\0',HF_CUBRK);
	memset(chr_l_h_cractyp,			'\0',HF_CRACTYPE);
	memset(chr_l_str_baseacc,		'\0',HF_BASE_CLT);
   memset(chr_l_h_maker,				'\0',HF_MAKER);
	memset(chr_l_h_domcpac,			'\0',HF_DOMCP_LEN);
	memset(chr_l_dcompdt,				'\0',HF_COMP_DATE);
	memset(chr_l_str_cractyp,		'\0',HF_CRACTYPE);
	memset(chr_l_str_glclient,	'\0',HF_CLIENT);
	memset(chr_l_str_crloc,			'\0',HF_CR_LOC);
	memset(chr_l_str_scacctline,	'\0',HF_SCACCTLINE);
	memset(chr_l_str_temp,			'\0',HF_TMP);

	
   EXEC SQL Select to_char(LR_DT,'dd/chr_mm/yyyy') into :chr_l_dcompdt:l_i_dcompdt from DL_LOCALREPDATES 
	where CLR_NAME = :int_g_regen_ind ;
	IS_ANY_ORA_ERROR 

	
   EXEC SQL DECLARE cscacct1 CURSOR FOR 
	SELECT MT_CLIENT.CLN_CODE , MT_CLIENT.CLN_GL_ACCOUNT , MT_CLIENT.cln_name , DL_RUCLIENT.CLT_TYP , 
	DL_RUCLIENT.CLTTYP , DL_RUCLIENT.BASECLT , DL_RUCLIENT.maker    
	from MT_CLIENT  , DL_RUCLIENT where 
	to_date(to_char(MT_CLIENT.CLN_DATEOF_INPUT,'dd/chr_mm/yyyy'),'dd/chr_mm/yyyy') > to_date(:chr_l_dcompdt,'dd/chr_mm/yyyy') and 
	MT_CLIENT.CHECKER_DT IS NOT NULL and MT_CLIENT.CLN_CODE = DL_RUCLIENT.client 
	and MT_CLIENT.CLN_CLAS = '2' and MT_CLIENT.CLN_BRK_ALL != 'B' ; 
	IS_ANY_ORA_ERROR

	EXEC SQL OPEN cscacct1  ;
   IS_ANY_ORA_ERROR

  for( ; ; )
  {

   EXEC SQL FETCH cscacct1 into :chr_l_h_client_a:l_i_account , :chr_l_h_glclient:l_i_ibbsaccount ,
	:chr_l_h_cname:l_i_cname ,:chr_l_h_cractyp:l_i_cractyp , :chr_l_h_acctyp:l_i_acctyp ,
	:chr_l_h_baseacc:l_i_baseacc , :chr_l_h_maker:l_i_maker ; 
	IS_ANY_ORA_ERROR_CURSOR

	if(APL_ZERO_RESULT_SET)
	  break;

	if( !(strcmp(chr_l_h_cractyp,"LM")) )
	  strcpy(chr_l_str_cractyp,"LB"); 
	else if( !(strcmp(chr_l_h_cractyp,"LS")))
	  strcpy(chr_l_str_cractyp,"LR");
	else
	  strcpy(chr_l_str_cractyp,"  ");
    
   strcpy(chr_l_str_scacctline," ");

   RuPadRight(chr_l_str_scacctline,"SCACCT",9);
	
	strcpy(chr_l_str_temp,chr_l_h_client_a);
	strcat(chr_l_str_temp,chr_l_h_acctyp);
	strcat(chr_l_str_temp, chr_l_str_cractyp) ; 

   RuPadRight(chr_l_str_scacctline,chr_l_str_temp,25);
   RuPadRight(chr_l_str_scacctline,chr_l_h_acctyp,2);
   RuPadRight(chr_l_str_scacctline,"P",1);

	sprintf(chr_l_str_baseacc,"%ld",chr_l_h_baseacc);
   RuPadRight(chr_l_str_scacctline,chr_l_str_baseacc,6);
   RuPadRight(chr_l_str_scacctline,"",10);
   RuPadRight(chr_l_str_scacctline,chr_l_h_maker,30);

	if(!(strcmp(chr_l_h_acctyp,"KC")))
    RuPadRight(chr_l_str_scacctline,chr_l_str_cractyp,8);
   else
    RuPadRight(chr_l_str_scacctline,"",8);
    
	 RuPadRight(chr_l_str_scacctline,"",25);

	 strncpy(chr_l_str_glclient,chr_l_h_glclient,1);
    
	if( !(strcmp(chr_l_str_glclient,"1")) || !(strcmp(chr_l_str_glclient,"4")) )
	  RuPadRight(chr_l_str_scacctline,chr_l_h_glclient,20);
   else
	  RuPadRight(chr_l_str_scacctline,"",20);

	RuPadRight(chr_l_str_scacctline,"WIRE-TRANSFER",80);
	RuPadRight(chr_l_str_scacctline,"SWIFT_ADDR",80);
	RuPadRight(chr_l_str_scacctline,"SWIFT_ADDR",80);

	RuPadRight(chr_l_str_scacctline,chr_l_h_cname,255);

	int_l_int_noofrec++ ;   

   if( int_l_int_noofrec == 1)
	{
	 if( RuGenHoffHdr(p_ptr_fopenfile,"SCACCT","14","633","New analytical DEPO accounts") != APL_SUCCESS )
	  APL_GOBACK_FAIL
   }
 
	fprintf(p_ptr_fopenfile,chr_l_str_scacctline);
	fprintf(p_ptr_fopenfile,"\n");

   RuAddCRCFn(chr_l_str_scacctline,&int_l_int_crc);

  } 

	EXEC SQL Close cscacct1  ;
	IS_ANY_ORA_ERROR

	 

   EXEC SQL DECLARE cscacct2 CURSOR FOR 
	SELECT LOC , LOC_TYPE , maker , DEPO_CD , LOC_NAME 
	from DL_RULOCATION where 
	to_date(to_char(DATEOF_INPUT,'dd/chr_mm/yyyy'),'dd/chr_mm/yyyy') > to_date(:chr_l_dcompdt,'dd/chr_mm/yyyy') and 
	checker_dt IS NOT NULL ;
	IS_ANY_ORA_ERROR

	EXEC SQL OPEN cscacct2  ;
   IS_ANY_ORA_ERROR

	 for( ; ; )
	 {

    EXEC SQL FETCH cscacct2 into :chr_l_h_location:l_i_location , :chr_l_h_loctyp:l_i_loctyp , :chr_l_h_maker:l_i_maker,
	 :chr_l_h_depcode:l_i_depcode , :chr_l_h_locnm:l_i_locnm ; 
	 IS_ANY_ORA_ERROR_CURSOR

	 if(APL_ZERO_RESULT_SET)
	  break;

	 if( !(strcmp(chr_l_h_location,"VTB")) )
		 strcpy(chr_l_str_crloc,"NR"); 
	 else if( !(strcmp(chr_l_h_location,"MICX")) || !(strcmp(chr_l_h_location,"NRB")))
		 strcpy(chr_l_str_crloc,"NB");
	 else
		 strcpy(chr_l_str_crloc,"NN");

    strcpy(chr_l_str_scacctline," ");
	 RuPadRight(chr_l_str_scacctline,"SCACCT",9);
	 
	 strcpy(chr_l_str_temp,chr_l_h_location);
	 strcat(chr_l_str_temp,chr_l_h_loctyp);
	 strcat(chr_l_str_temp,chr_l_str_crloc);

	 RuPadRight(chr_l_str_scacctline,chr_l_str_temp,25);
	 RuPadRight(chr_l_str_scacctline,chr_l_h_loctyp,2);
	 RuPadRight(chr_l_str_scacctline,"A",1);
	 RuPadRight(chr_l_str_scacctline,"",6);
	 RuPadRight(chr_l_str_scacctline,chr_l_h_location,10);
	 RuPadRight(chr_l_str_scacctline,chr_l_h_maker,30);

	 if( !(chr_l_h_loctyp,"KC"))
	   RuPadRight(chr_l_str_scacctline,chr_l_str_crloc,8);
	 else
	   RuPadRight(chr_l_str_scacctline,"",8);

	 RuPadRight(chr_l_str_scacctline,chr_l_h_depcode,25);
	 RuPadRight(chr_l_str_scacctline,"",20);
	 RuPadRight(chr_l_str_scacctline,"WIRE-TRANSFER",80);
	 RuPadRight(chr_l_str_scacctline,"SWIFT_ADDR",80);
	 RuPadRight(chr_l_str_scacctline,"SWIFT_ADDR",80);

	 RuPadRight(chr_l_str_scacctline,chr_l_h_locnm,255);
   
	 int_l_int_noofrec++ ; 

    if( int_l_int_noofrec == 1)
	 {
	  if( RuGenHoffHdr(p_ptr_fopenfile,"SCACCT","14","633","New analytical DEPO accounts") != APL_SUCCESS )
	   APL_GOBACK_FAIL
    }

	  fprintf(p_ptr_fopenfile,chr_l_str_scacctline);
	  fprintf(p_ptr_fopenfile,"\n");

     RuAddCRCFn(chr_l_str_scacctline,&int_l_int_crc);

   } 

	 EXEC SQL Close cscacct2 ;
	 IS_ANY_ORA_ERROR

    if ( int_l_int_noofrec ) 
	 {
	  if ( RuGenHoffFtr(p_ptr_fopenfile,"SCACCT",int_l_int_noofrec,int_l_int_crc) != APL_SUCCESS) 
	   APL_GOBACK_FAIL 
	   (*p_int_noofblocks)++ ; 
    } 

	EXEC SQL SELECT count(*) into :int_l_int_accrec:l_i_accrec
	from MT_CLIENT , DL_RUCLIENT where 
	to_date(to_char(MT_CLIENT.CLN_DATEOF_INPUT,'dd/chr_mm/yyyy'),'dd/chr_mm/yyyy') > to_date(:chr_l_dcompdt,'dd/chr_mm/yyyy') 
	and MT_CLIENT.CHECKER_DT IS NOT NULL 
	and MT_CLIENT.CLN_BRK_ALL != 'B' and MT_CLIENT.CLN_CLAS = '2' and MT_CLIENT.CLN_CODE = DL_RUCLIENT.client ; 
   IS_ANY_ORA_ERROR 

	EXEC SQL SELECT count(*) into :int_l_int_locrec:l_i_locrec
	from DL_RULOCATION where 
	to_date(to_char(DATEOF_INPUT,'dd/chr_mm/yyyy'),'dd/chr_mm/yyyy') > to_date(:chr_l_dcompdt,'dd/chr_mm/yyyy') and 
	checker_dt IS NOT NULL ; 
   IS_ANY_ORA_ERROR 

	fprintf(p_ptr_symrepfile,"\n");
	fprintf(p_ptr_symrepfile,"%10s","");
	fprintf(p_ptr_symrepfile,"%10s","SCACCT");
	fprintf(p_ptr_symrepfile,"%10d",int_l_int_noofrec);
	fprintf(p_ptr_symrepfile,"%15s","cruaccount");
	fprintf(p_ptr_symrepfile,"%10d",int_l_int_accrec); 
	fprintf(p_ptr_symrepfile,"%15s","crulocation");
	fprintf(p_ptr_symrepfile,"%10d",int_l_int_locrec * 3 ); 

   APL_GOBACK_SUCCESS

	
	RETURN_FAILURE:
     CO_ProcMonitor(p_logfile,"Exiting out of RuGenHoffSCACCT Fn Unsuccessfully\n",NULL,NULL);
	  return (APL_FAILURE);

	RETURN_SUCCESS:
     CO_ProcMonitor(p_logfile,"Exiting out of RuGenHoffSCACCT Fn Successfully\n",NULL,NULL);
	  return(APL_SUCCESS);

}




int RuHoffGenSCINSTR(FILE* p_ptr_fopenfile,int *p_int_noofblocks,FILE*p_logfile,FILE *p_ptr_symrepfile,INTL_ENV_DATA_STRUCT_H * p_intl_envdatastruct_h,DEBUG_INFO_STRUCT_H** l_debug_info_ptr)
{
   struct sqlca sqlca ;
   char chr_l_h_client_a[HF_CLIENT]  	  			= APL_NULL_STRING ;
   char chr_l_h_refno_A[HF_IDENTNO]     	  			= APL_NULL_STRING ;
   char chr_l_h_refnum[HF_IDENTNUMBER]     	  			= APL_NULL_STRING ;
   char chr_l_h_stregno[HF_STAT_REGNO] 	  			= APL_NULL_STRING ;
   char chr_l_h_mstacc1[HF_CLIENT]  	  			= APL_NULL_STRING ;
   char chr_l_h_mstacc2[HF_CLIENT]  	  			= APL_NULL_STRING ;
   char chr_l_h_location[HF_LOC]  	  		= APL_NULL_STRING ;
	char chr_l_h_locnm[HF_LOC_NAME]   					= APL_NULL_STRING ; 
	char chr_l_h_basloc[HF_BASE_LOC] 					= APL_NULL_STRING ;
   char chr_l_h_intdomcpac[HF_INT_DOMCP]		   = APL_NULL_STRING ;
   char chr_l_h_acc_class[HF_CLN_CLASS] 	   	= APL_NULL_STRING ;
   char chr_l_str_scinstrline[DL_HOFF_SCINSTRLINE] 	= APL_NULL_STRING ;
   char chr_l_h_cubk1[HF_CUBRK] 						= APL_NULL_STRING ;
   char chr_l_h_cubk2[HF_CUBRK] 						= APL_NULL_STRING ;
   char chr_l_h_domcpac[HF_DOMCP_LEN] 				= APL_NULL_STRING ;
   char chr_l_h_basacc[HF_BASE_CLT] 					= APL_NULL_STRING ;
   char chr_l_h_basclient[HF_BASE_CLT] 			= APL_NULL_STRING ;
   char chr_l_h_countacc_a[HF_CLIENT] 				= APL_NULL_STRING ;
   char chr_l_h_typoftrd[HF_DL_CLASS] 			= APL_NULL_STRING ;
   char chr_l_h_loctyp[HF_LOC_TYPE] 					= APL_NULL_STRING ;
   char chr_l_h_instrcode_A[HF_SEC_CD] 					= APL_NULL_STRING ;
   char chr_l_str_temp[HF_TMP] 						= APL_NULL_STRING ;
   char chr_l_str_amt[18] 									= APL_NULL_STRING ;
   char chr_l_h_cractyp[3] 									= APL_NULL_STRING ;
   char chr_l_str_cractyp[3] 								= APL_NULL_STRING ;
   char chr_l_str_loctyp[3] 								= APL_NULL_STRING ;
   char chr_l_str_urn[20] 									= APL_NULL_STRING ; 
   char chr_l_h_trdt_a[HF_DEAL_DATE] 						= APL_NULL_STRING ;
   char chr_l_h_instr_dt[HF_SEC_DATE] 						= APL_NULL_STRING ;
  	char chr_l_h_trcode_a[HF_DEAL_CD] 					= APL_NULL_STRING ;
   char chr_l_h_prcode[HF_PR_CODE] 					= APL_NULL_STRING ;
   char chr_l_h_statregno[HF_STAT_REGNO] 			= APL_NULL_STRING ;
   char chr_l_h_typeofinstr[HF_INSTRUMENT_TYPE] 				= APL_NULL_STRING ;
   char chr_l_h_acctyp[HF_CLT_TYPE] 					= APL_NULL_STRING ;
   char chr_l_dcompdt[HF_COMP_DATE] 					= APL_NULL_STRING ;
   char chr_l_h_settledt_a[11] 								= APL_NULL_STRING ;
   char chr_l_h_exarena[3] 									= APL_NULL_STRING ;
   char chr_l_opp_trcode[3] 								= APL_NULL_STRING ;

	

	char     chr_l_mainfuncarea[APL_MAINFUNCAREA_LEN]      = APL_NULL_STRING;
   char     chr_l_condid_a[APL_CONDID_LEN]                  = APL_NULL_STRING;
	short  	l_cntry_exists = 0 ;
	char 		int_l_temp[20];
   

	int  int_l_int_noofrec 				= 0 ;
	int  int_l_int_ctr 				   = 0 ;
	int  int_l_int_crc 					= 0 ; 
	int  int_l_int_count 					= 0 ; 
    
   double  l_dbl_amount                = 0 ;
   double l_h_quantity_a                = 0.0;
	double l_h_nominal_value                = 0;
	double chr_l_h_amount 				= 0.0 ; 

   short l_i_location 		 	  	= 0 ;
   short l_i_amt		 		 	  	= 0 ;
   short l_i_acctyp	 		 	  	= 0 ;
   short l_i_countacc 		 	  	= 0 ;
   short l_i_refno    		 	  	= 0 ;
   short l_i_refnum    		 	  	= 0 ;
   short l_i_basacc  		 	  	= 0 ;
   short l_i_basaccount		 	  	= 0 ;
   short l_i_domcpac 		 	  	= 0 ;
   short l_i_dcompdt 		 	  	= 0 ;
   short l_i_acc_class 		 	  	= 0 ;
   short l_i_cractyp 		 	  	= 0 ;
   short l_i_account 		 	  	= 0 ;
   short l_i_mstacc1 		 	  	= 0 ;
   short l_i_mstacc2 		 	  	= 0 ;
   short l_i_intdomcpac		 	  	= 0 ;
   short l_i_instr_code			 	  	= 0 ;
   short l_i_basloc   				= 0 ;
   short l_i_locnm      			= 0 ;
   short l_i_cubk1       			= 0 ;
   short l_i_cubk2       			= 0 ;
   short l_i_typoftrd     			= 0 ;
   short l_i_trdt		    			= 0 ;
   short l_i_instr_dt	    			= 0 ;
   short l_i_prcode	    			= 0 ;
   short l_i_typeofinstr	    			= 0 ;
   short l_i_statregno    			= 0 ;
   short l_i_stregno    			= 0 ;
   short int_l_i_trcode	    			= 0 ;
   short l_i_loctyp	    			= 0 ;
   short l_i_nomval	    			= 0 ;
   short int_l_i_qty		    			= 0 ;
   short l_i_count	    			= 0 ;
   short l_i_amount	    			= 0 ;
   short l_i_settledt    			= 0 ;
   short l_i_exarena	    			= 0 ;

	EXEC SQL VAR chr_l_h_client_a 		IS STRING ;  
	EXEC SQL VAR chr_l_h_refno_A	 		IS STRING ;  
	EXEC SQL VAR chr_l_h_mstacc1 		IS STRING ;  
	EXEC SQL VAR chr_l_h_mstacc2 		IS STRING ;  
	EXEC SQL VAR chr_l_h_instrcode_A 		IS STRING ;  
	EXEC SQL VAR chr_l_h_intdomcpac 	IS STRING ;  
	EXEC SQL VAR chr_l_h_acc_class 	IS STRING ;  
	EXEC SQL VAR chr_l_h_basacc 		IS STRING ;  
	EXEC SQL VAR chr_l_h_basclient	IS STRING ;  
	EXEC SQL VAR chr_l_h_basloc 		IS STRING ;  
	EXEC SQL VAR chr_l_h_cractyp	 	IS STRING ;  
	EXEC SQL VAR chr_l_h_locnm	 		IS STRING ;  
	EXEC SQL VAR chr_l_h_domcpac 		IS STRING ;  
	EXEC SQL VAR chr_l_h_location 		IS STRING ;  
	EXEC SQL VAR chr_l_h_cubk1	 		IS STRING ;  
	EXEC SQL VAR chr_l_h_cubk2	 		IS STRING ;  
	EXEC SQL VAR chr_l_h_countacc_a 		IS STRING ;  
	EXEC SQL VAR chr_l_h_typoftrd 		IS STRING ;  
	EXEC SQL VAR chr_l_h_trdt_a 	 		IS STRING ;  
	EXEC SQL VAR chr_l_h_instr_dt	 		IS STRING ;  
	EXEC SQL VAR chr_l_h_prcode	 		IS STRING ;  
	EXEC SQL VAR chr_l_h_statregno		IS STRING ;  
	EXEC SQL VAR chr_l_h_stregno		IS STRING ;  
	EXEC SQL VAR chr_l_h_typeofinstr		IS STRING ;  
	EXEC SQL VAR chr_l_h_trcode_a			IS STRING ;  
	EXEC SQL VAR chr_l_dcompdt	 		IS STRING ;  
	EXEC SQL VAR chr_l_h_settledt_a 		IS STRING ;  
	EXEC SQL VAR chr_l_h_exarena 		IS STRING ;  

   memset(chr_l_h_client_a 		,'\0',HF_CLIENT) ; 
   memset(chr_l_h_refno_A  		,'\0',HF_IDENTNO) ; 
   memset(chr_l_h_mstacc1 		,'\0',HF_CLIENT) ; 
   memset(chr_l_h_mstacc2 		,'\0',HF_CLIENT) ; 
   memset(chr_l_h_instrcode_A 		,'\0',HF_SEC_CD);
   memset(chr_l_h_intdomcpac 	,'\0',HF_INT_DOMCP) ; 
   memset(chr_l_h_acc_class		,'\0',HF_CLN_CLASS) ; 
   memset(chr_l_h_basacc			,'\0',HF_BASE_CLT) ; 
   memset(chr_l_h_basclient	,'\0',HF_BASE_CLT) ; 
   memset(chr_l_h_basloc 		,'\0',HF_BASE_LOC);
   memset(chr_l_h_cractyp 		,'\0',3);
   memset(chr_l_h_locnm			,'\0',HF_LOC_NAME) ; 
   memset(chr_l_h_domcpac		,'\0',HF_DOMCP_LEN ) ; 
   memset(chr_l_h_location		,'\0',HF_LOC) ; 
   memset(chr_l_h_cubk1			,'\0',HF_CUBRK) ; 
   memset(chr_l_h_cubk2			,'\0',HF_CUBRK) ; 
   memset(chr_l_h_countacc_a		,'\0',HF_CLIENT) ; 
   memset(chr_l_h_typoftrd		,'\0',HF_DL_CLASS) ; 
   memset(chr_l_h_trdt_a			,'\0',HF_DEAL_DATE) ; 
   memset(chr_l_h_instr_dt  		,'\0',HF_SEC_DATE) ; 
   memset(chr_l_h_prcode  		,'\0',HF_PR_CODE) ; 
   memset(chr_l_h_statregno  	,'\0',HF_STAT_REGNO) ; 
   memset(chr_l_h_stregno   	,'\0',HF_STAT_REGNO) ; 
   memset(chr_l_h_typeofinstr	  	,'\0',HF_INSTRUMENT_TYPE) ; 
   memset(chr_l_h_trcode_a		  	,'\0',HF_DEAL_CD) ; 
   memset(chr_l_dcompdt			,'\0',HF_COMP_DATE) ; 
   memset(chr_l_h_settledt_a		,'\0',11) ;
   memset(chr_l_h_exarena		,'\0',3) ;
   memset(chr_l_str_scinstrline,'\0',DL_HOFF_SCINSTRLINE) ; 
   memset(chr_l_str_cractyp 	,'\0',3);
   memset(chr_l_str_loctyp 		,'\0',3);


	
   

   EXEC SQL Select to_char(LR_DT,'dd/chr_mm/yyyy') into :chr_l_dcompdt:l_i_dcompdt from DL_LOCALREPDATES 
	where CLR_NAME = :int_g_regen_ind ;
	IS_ANY_ORA_ERROR 

	EXEC SQL select custody_clt_cd into :chr_l_h_intdomcpac:l_i_intdomcpac from MT_CORE_SYS_PARAMS ;
	IS_ANY_ORA_ERROR

	


   EXEC SQL DECLARE cscinstr CURSOR FOR
	SELECT a.location_cd , c.LOC_NAME , c.BASELOCATION , a.client , a.IDENTIY_NO , a.instr_code , a.dl_class , 
	to_char(a.deal_date,'yyyymmdd') ,
	to_char(a.INSTRUMENT_DT,'yyyymmdd') , a.deal_cd ,  a.cp_clt , a.domestic_cpclt , a.QTY  , 
	to_char(a.setl_date,'yyyymmdd') ,
   a.ex_arena , a.AMOUNT
	from dl_deal a , DL_RULOCATION c  where
	((a.ALLOW_DROPDT IS NOT NULL and 
	to_date(to_char(a.ALLOW_DROPDT,'dd/chr_mm/yyyy'),'dd/chr_mm/yyyy') > to_date(:chr_l_dcompdt,'dd/chr_mm/yyyy') ) or
	EXISTS (SELECT 1 FROM MS_MSGSTAT d where a.client = d.client and 
	a.IDENTIY_NO = d.proc_init and d.swift_msg_rep = '53x' and
	d.generate_dt IS NOT NULL and 
	to_date(to_char(d.generate_dt,'dd/chr_mm/yyyy'),'dd/chr_mm/yyyy') > to_date(:chr_l_dcompdt,'dd/chr_mm/yyyy')) )
	and a.lcl_identno IS NULL and
	a.location_cd = c.LOC ; 
   IS_ANY_ORA_ERROR

	EXEC SQL OPEN cscinstr ;
   IS_ANY_ORA_ERROR

 for( ; ; )
 {
	
	printf("The chr_value of sqlca is %d\n",sqlca.sqlcode);
	sqlca.sqlcode = 0L;
	memset(chr_l_h_client_a   ,'\0',HF_CLIENT) ;
   memset(chr_l_h_refno_A   ,'\0',HF_IDENTNO) ;
   memset(chr_l_h_instrcode_A   ,'\0',HF_SEC_CD);
   memset(chr_l_h_acc_class   ,'\0',HF_CLN_CLASS) ;
   memset(chr_l_h_basloc   ,'\0',HF_BASE_LOC);
   memset(chr_l_h_locnm   ,'\0',HF_LOC_NAME) ;
   memset(chr_l_h_domcpac   ,'\0',HF_DOMCP_LEN ) ;
   memset(chr_l_h_location   ,'\0',HF_LOC) ;
   memset(chr_l_h_countacc_a   ,'\0',HF_CLIENT) ;
   memset(chr_l_h_typoftrd   ,'\0',HF_DL_CLASS) ;
   memset(chr_l_h_trdt_a   ,'\0',HF_DEAL_DATE) ;
   memset(chr_l_h_instr_dt   ,'\0',HF_SEC_DATE) ;
   memset(chr_l_h_typeofinstr   ,'\0',HF_INSTRUMENT_TYPE) ;
   memset(chr_l_h_trcode_a   ,'\0',HF_DEAL_CD) ;
   memset(chr_l_h_settledt_a   ,'\0',11) ;
   memset(chr_l_h_exarena   ,'\0',3) ;
	chr_l_h_amount =0.0;
	l_h_quantity_a = 0.0;

   EXEC SQL FETCH cscinstr into :chr_l_h_location:l_i_location , :chr_l_h_locnm:l_i_locnm , 
	:chr_l_h_basloc:l_i_basloc , :chr_l_h_client_a:l_i_account , :chr_l_h_refno_A:l_i_refno , :chr_l_h_instrcode_A:l_i_instr_code , 
	:chr_l_h_typoftrd:l_i_typoftrd ,
	:chr_l_h_trdt_a:l_i_trdt , :chr_l_h_instr_dt:l_i_instr_dt  , :chr_l_h_trcode_a:int_l_i_trcode , :chr_l_h_countacc_a:l_i_countacc , 
	:chr_l_h_domcpac:l_i_domcpac , :l_h_quantity_a:int_l_i_qty , :chr_l_h_settledt_a:l_i_settledt , :chr_l_h_exarena:l_i_exarena ,
	chr_l_h_amount:l_i_amount ; 
	printf("\n After fetch : Acc :%s:, refno :%s:, sec :%s:, clt cls :%s: \n basloc :%s:, locnm :%s:, domestic_cpclt :%s:, locat :%s:, typoftrd :%s:, deal_date :%s:, instr_dt :%s:, deal_cd :%s: \n cp_clt :%s:, quantity :%lf: amount :%lf:, exar :%s: \n", chr_l_h_client_a, chr_l_h_refno_A, chr_l_h_instrcode_A, chr_l_h_acc_class, chr_l_h_basloc, chr_l_h_locnm, chr_l_h_domcpac, chr_l_h_location, chr_l_h_typoftrd, chr_l_h_trdt_a, chr_l_h_instr_dt, chr_l_h_trcode_a, chr_l_h_countacc_a, l_h_quantity_a,  chr_l_h_amount, chr_l_h_exarena);
	printf("The chr_value of sqlca is %d\n",sqlca.sqlcode);
	
	IS_ANY_ORA_ERROR_CURSOR

	if(APL_ZERO_RESULT_SET)
	 break;

	printf("\n Got row for main cscinstr cursor : clt :%s: refno :%s: sec :%s: locnm :%s: \n", chr_l_h_client_a, chr_l_h_refno_A, chr_l_h_instrcode_A, chr_l_h_location);
   EXEC SQL select CLN_CLAS into :chr_l_h_acc_class:l_i_acc_class
	from MT_CLIENT where CLN_CODE = :chr_l_h_client_a ; 
	IS_ANY_ORA_ERROR

	      printf("l_h_account is %s\n",chr_l_h_client_a);
	      printf("l_h_refno is %s\n",chr_l_h_refno_A);
	if(strcmp(chr_l_h_acc_class,"2")) 
	{	
		printf("CONTINUING\n");
	  continue ; 
	  }

   EXEC SQL select cln_master into :chr_l_h_mstacc1 from MT_CLIENT where CLN_CODE = :chr_l_h_client_a ;
	IS_ANY_ORA_ERROR

	EXEC SQL select cln_master into :chr_l_h_mstacc2 from MT_CLIENT where CLN_CODE = :chr_l_h_countacc_a ;
	IS_ANY_ORA_ERROR

      

	if (!strcmp(chr_l_h_trcode_a,"1"))
		strcpy(chr_l_opp_trcode, "2");
	else if (!strcmp(chr_l_h_trcode_a,"2")) 
		strcpy(chr_l_opp_trcode, "1");
	else if (!strcmp(chr_l_h_trcode_a,"3")) 
		strcpy(chr_l_opp_trcode, "4");
	else if (!strcmp(chr_l_h_trcode_a,"4")) 
		strcpy(chr_l_opp_trcode, "3");

	printf("\n B4 select count = :%d: \n", int_l_int_count);
   

   EXEC SQL select count(*) into :int_l_int_count:l_i_count 
   from dl_deal a  , DL_RULOCATION c
   where a.client = :chr_l_h_countacc_a and a.cp_clt = :chr_l_h_client_a and
	a.domestic_cpclt = :chr_l_h_intdomcpac and
	((a.ALLOW_DROPDT IS NOT NULL and 
	to_date(to_char(a.ALLOW_DROPDT,'dd/chr_mm/yyyy'),'dd/chr_mm/yyyy') > to_date(:chr_l_dcompdt,'dd/chr_mm/yyyy')) or
	EXISTS (SELECT 1 FROM MS_MSGSTAT d where a.client = d.client and 
	a.IDENTIY_NO = d.proc_init and d.swift_msg_rep = '53x' and
	d.generate_dt IS NOT NULL and 
	to_date(to_char(d.generate_dt,'dd/chr_mm/yyyy'),'dd/chr_mm/yyyy') > to_date(:chr_l_dcompdt,'dd/chr_mm/yyyy')) )
	and a.lcl_identno IS NULL
	and a.location_cd 	= c.LOC 
	and a.instr_code 		= :chr_l_h_instrcode_A
	and a.QTY 			= :l_h_quantity_a
	and to_char(a.deal_date,'yyyymmdd') = :chr_l_h_trdt_a 
	and a.deal_cd 		= :chr_l_opp_trcode 
	and to_char(a.setl_date,'yyyymmdd') 	= :chr_l_h_settledt_a
	and a.dl_class 	= :chr_l_h_typoftrd
	and a.ex_arena 		= :chr_l_h_exarena 
	and NVL(a.location_cd,0) 	= NVL(:chr_l_h_location,0)
	and ABS((NVL(a.AMOUNT,0)-:chr_l_h_amount)) <= :l_mt_core_sys_params_struct_h.allowed_amtdiff ;
   IS_ANY_ORA_ERROR

	printf("\n After select count = :%d: \n", int_l_int_count);


    EXEC SQL select CLN_CLAS into :chr_l_h_acc_class:l_i_acc_class
	 from MT_CLIENT where CLN_CODE = :chr_l_h_countacc_a ; 
	 IS_ANY_ORA_ERROR

  if ( strlen(chr_l_h_countacc_a) == 0 || strcmp(chr_l_h_domcpac,chr_l_h_intdomcpac) || strcmp(chr_l_h_mstacc1,chr_l_h_mstacc2) || ( !strcmp( chr_l_h_mstacc1,chr_l_h_mstacc2 ) && (int_l_int_count == 0 ) && (!strcmp(chr_l_h_acc_class,"2")) )  )
  {             

	 printf("\n Trade qualifies : Acc :%s: refno :%s: CPacc :%s:, domestic_cpclt :%s: mstacc1 :%s: count:%d: acc_class :%s:\n", chr_l_h_client_a, chr_l_h_refno_A, chr_l_h_countacc_a, chr_l_h_domcpac, chr_l_h_mstacc1, int_l_int_count, chr_l_h_acc_class);
    EXEC SQL select CLT_TYP , BASECLT , CLTTYP into :chr_l_h_cractyp:l_i_cractyp , 
	 :chr_l_h_basclient:l_i_basaccount , :chr_l_h_acctyp:l_i_acctyp
	 from DL_RUCLIENT
	 where client = :chr_l_h_client_a ; 
	 IS_ANY_ORA_ERROR

	 EXEC SQL select PR_CODE , STAT_REG_NO  into :chr_l_h_prcode:l_i_prcode , :chr_l_h_statregno:l_i_statregno 
	 from DL_RUINSTRUMENT where instr_code = :chr_l_h_instrcode_A ; 
	 IS_ANY_ORA_ERROR

	 EXEC SQL select INSTR_TYPE , NOMINAL_VALUE into :chr_l_h_typeofinstr:l_i_typeofinstr , :l_h_nominal_value:l_i_nomval
	 from MT_INSTRUMENT where instr_code = :chr_l_h_instrcode_A ; 
	 IS_ANY_ORA_ERROR

	 EXEC SQL SELECT LOC_TYPE into :chr_l_h_loctyp:l_i_loctyp from DL_RULOCATION 
	 where LOC = :chr_l_h_location ;
	 IS_ANY_ORA_ERROR

    if( !(strcmp(chr_l_h_cractyp,"LM")) )
		strcpy(chr_l_str_cractyp,"LB");
	 else if( !(strcmp(chr_l_h_cractyp,"LS")))
		strcpy(chr_l_str_cractyp,"LR");
	 else
		{ 
		  strcpy(chr_l_str_cractyp,"");
		}

    if( !(strcmp(chr_l_h_location,"VTB")) )
		strcpy(chr_l_str_loctyp,"NR");
	 else if( !(strcmp(chr_l_h_location,"MICX"))   || !(strcmp(chr_l_h_location,"NRB")))
		strcpy(chr_l_str_loctyp,"NB");
	 else
		strcpy(chr_l_str_loctyp,"NN");

	printf("\n sqlcode b4 2nd cursor cruinstr: %d:\n", sqlca.sqlcode);
    EXEC SQL DECLARE cruinstr CURSOR for 
	 Select client, ST_REG_NO , QTY  from DL_RUDEAL where 
	 client = :chr_l_h_client_a and IDENTIY_NO = :chr_l_h_refno_A ; 
	 IS_ANY_ORA_ERROR

	 EXEC SQL open cruinstr ; 
	 IS_ANY_ORA_ERROR
	printf("\n sqlcode Aft 2nd cursor cruinstr : %d:\n", sqlca.sqlcode);

	 for( ; ; )
    {

    EXEC SQL Fetch cruinstr into :chr_l_h_client_a:l_i_account, :chr_l_h_stregno:l_i_stregno , :l_h_quantity_a:int_l_i_qty ; 
	 IS_ANY_ORA_ERROR_CURSOR
	printf("\n sqlcode Aft 2nd cursor cruinstr  fetch : %d: sql errd :%d:\n", sqlca.sqlcode, sqlca.sqlerrd[2]);

	  if(!sqlca.sqlerrd[2])
		{
		 fprintf(p_logfile,"No Record int_found in crutrade!\n");
		 fprintf(p_logfile,"Account = %s , Refno = %s\n",chr_l_h_client_a,chr_l_h_refno_A);
		 break ;
	   }
	  else if(APL_ZERO_RESULT_SET)
		break ; 

	printf("\n VB4 alue of seq g_lng_urnseq :%ld: chr_l_str_urn :%s: \n", g_lng_urnseq, chr_l_str_urn);
	 strcpy(chr_l_str_urn,"");
    RuGenURN(&g_lng_urnseq,chr_l_str_urn,l_debug_info_ptr); 
	printf("\n Aft Value of seq g_lng_urnseq :%ld: chr_l_str_urn :%s: \n", g_lng_urnseq, chr_l_str_urn);

	 strcpy(chr_l_str_scinstrline," ");
	 RuPadRight(chr_l_str_scinstrline,"SCINSTR",9);
	 RuPadRight(chr_l_str_scinstrline,chr_l_str_urn,13);
	 RuPadRight(chr_l_str_scinstrline,"SC",2);
	 RuPadRight(chr_l_str_scinstrline,"SC",2);
	 RuPadRight(chr_l_str_scinstrline,chr_l_h_trdt_a,10);
	 RuPadRight(chr_l_str_scinstrline,chr_l_h_instr_dt,10);
	 
    if( !(strcmp(chr_l_h_trcode_a,"1")) || !(strcmp(chr_l_h_trcode_a,"3")) )
	    RuPadRight(chr_l_str_scinstrline,"2",1);
    else
	    RuPadRight(chr_l_str_scinstrline,"1",1);

	 RuPadRight(chr_l_str_scinstrline,chr_l_h_basclient,6);

	 EXEC SQL select CLN_BRK_ALL into :chr_l_h_cubk1:l_i_cubk1 from MT_CLIENT where CLN_CODE = :chr_l_h_domcpac ;
	 IS_ANY_ORA_ERROR

	 EXEC SQL select CLN_BRK_ALL into :chr_l_h_cubk2:l_i_cubk2 from MT_CLIENT where CLN_CODE = :chr_l_h_countacc_a ;
	 IS_ANY_ORA_ERROR

	 if( (strlen(chr_l_h_domcpac)) && ( !(strcmp(chr_l_h_cubk1,"A")) || !(strcmp(chr_l_h_cubk1,"C")) ) )
	  {
   		

   		EXEC SQL select BASECLT into :chr_l_h_basacc:l_i_basacc from DL_RUCLIENT where client = :chr_l_h_domcpac ; 
			IS_ANY_ORA_ERROR

	  	   RuPadRight(chr_l_str_scinstrline,chr_l_h_basacc,6);
	  }
	 else if( (strlen(chr_l_h_countacc_a)) && ( !(strcmp(chr_l_h_cubk2,"A")) || !(strcmp(chr_l_h_cubk2,"C")) ) )
	  {
   		EXEC SQL select BASECLT into :chr_l_h_basacc:l_i_basacc from DL_RUCLIENT where client = :chr_l_h_countacc_a ; 
			IS_ANY_ORA_ERROR

	  	   RuPadRight(chr_l_str_scinstrline,chr_l_h_basacc,6);
	  }
	 else
	  {
	  	RuPadRight(chr_l_str_scinstrline,"999999",6);
  	  } 	

      strcpy(chr_l_str_temp,"");
	  	RuPadRight(chr_l_str_temp,chr_l_h_prcode,3);
	  	RuPadRight(chr_l_str_temp,"-",1);
	  	RuPadRight(chr_l_str_temp,chr_l_h_stregno,20);
	  	RuPadRight(chr_l_str_scinstrline,chr_l_str_temp,24);


	 strcpy(chr_l_mainfuncarea, "TRD_QTY_LEN");
	 strcpy(chr_l_condid_a, "SEVEN_DEC");
	if (APL_FAILURE == CO_Chk_CntryEnabled(chr_l_mainfuncarea, chr_l_condid_a, &l_cntry_exists, l_debug_info_ptr))
	{
		APL_GOBACK_FAIL;
	}

	 if( !(strcmp(chr_l_h_typeofinstr,"BON")) || !(strcmp(chr_l_h_typeofinstr,"FMT") ))
	  	RuPadRight(chr_l_str_scinstrline,"100",20);
	 else
	  	RuPadRight(chr_l_str_scinstrline,"1",20);
    
	 for(int_l_int_ctr=1;int_l_int_ctr <= 3 ; int_l_int_ctr++)
	 {
	   if( !(strcmp(chr_l_h_typeofinstr,"BON")) || !(strcmp(chr_l_h_typeofinstr,"FMT") ) )
	     l_dbl_amount = l_h_quantity_a * l_h_nominal_value ; 
	   else
		  l_dbl_amount = l_h_quantity_a ; 
	    
		  
		  

			
		  
		  
			if(l_cntry_exists > 0)
			{
				sprintf(int_l_temp,"%s%d%s", "%0.", l_mt_core_sys_params_struct_h.qty_dec_len, "f");
				sprintf(chr_l_str_amt,int_l_temp,l_dbl_amount);
			}
			else
		  	sprintf(chr_l_str_amt,"%lf",l_dbl_amount); 
		  
		  
	  	  RuPadRight(chr_l_str_scinstrline,chr_l_str_amt,20);
    }

	 RuPadRight(chr_l_str_scinstrline,"Y",1);
	 RuPadRight(chr_l_str_scinstrline,"T",1);
	 RuPadRight(chr_l_str_scinstrline,"SCM",3);
	 RuPadRight(chr_l_str_scinstrline,chr_l_h_location,10);
	 

      strcpy(chr_l_str_temp,"");

		EXEC SQL SELECT IDENTIY_NUM into :chr_l_h_refnum:l_i_refnum from DL_RUSRN
		where instr_code = :chr_l_h_instrcode_A and STAT_REG_NO = :chr_l_h_stregno ; 
		IS_ANY_ORA_ERROR

		 

    if( !(strcmp(chr_l_h_trcode_a,"2")) || !(strcmp(chr_l_h_trcode_a,"4")) )
	  {
		strcpy(chr_l_str_temp,chr_l_h_client_a); 
		strcat(chr_l_str_temp,chr_l_h_acctyp);
		strcat(chr_l_str_temp,chr_l_str_cractyp);
		strcat(chr_l_str_temp,chr_l_h_instrcode_A);
		strcat(chr_l_str_temp,chr_l_h_refnum);

	   RuPadRight(chr_l_str_scinstrline,chr_l_str_temp,33);

		strcpy(chr_l_str_temp,chr_l_h_location); 
		strcat(chr_l_str_temp,chr_l_h_loctyp);
		strcat(chr_l_str_temp,chr_l_str_loctyp);
		strcat(chr_l_str_temp,chr_l_h_instrcode_A);
		strcat(chr_l_str_temp,chr_l_h_refnum); 
	   RuPadRight(chr_l_str_scinstrline,chr_l_str_temp,33);

	   RuPadRight(chr_l_str_scinstrline,"",33);
	   RuPadRight(chr_l_str_scinstrline,"",33);
     }
	 else
	  {
	   RuPadRight(chr_l_str_scinstrline,"",33);
	   RuPadRight(chr_l_str_scinstrline,"",33);

		strcpy(chr_l_str_temp,chr_l_h_client_a); 
		strcat(chr_l_str_temp,chr_l_h_acctyp);
		strcat(chr_l_str_temp,chr_l_str_cractyp);
		strcat(chr_l_str_temp,chr_l_h_instrcode_A);
		strcat(chr_l_str_temp,chr_l_h_refnum); 
	   RuPadRight(chr_l_str_scinstrline,chr_l_str_temp,33);
		
		strcpy(chr_l_str_temp,chr_l_h_location); 
		strcat(chr_l_str_temp,chr_l_h_loctyp);
		strcat(chr_l_str_temp,chr_l_str_loctyp);
		strcat(chr_l_str_temp,chr_l_h_instrcode_A);
		strcat(chr_l_str_temp,chr_l_h_refnum); 
	   RuPadRight(chr_l_str_scinstrline,chr_l_str_temp,33);
	  }

	 RuPadRight(chr_l_str_scinstrline,"N",1);
	 RuPadRight(chr_l_str_scinstrline,"Y",1);


    EXEC SQL SELECT AMOUNT into :l_dbl_amount:l_i_amt from DL_RUDEAL 
	 where client = :chr_l_h_client_a and IDENTIY_NO = :chr_l_h_refno_A and ST_REG_NO = :chr_l_h_stregno ; 
	 IS_ANY_ORA_ERROR
	 

	 sprintf(chr_l_str_amt,"%0.2f",l_dbl_amount);

    if( !(strcmp(chr_l_h_trcode_a,"3")) || !(strcmp(chr_l_h_trcode_a,"4")) )
	    RuPadRight(chr_l_str_scinstrline,chr_l_str_amt,20);
    else
	    RuPadRight(chr_l_str_scinstrline,"0",20);


    if( !(strcmp(chr_l_h_typoftrd,"20")) || !(strcmp(chr_l_h_trcode_a,"26")) )
	    RuPadRight(chr_l_str_scinstrline,"Y",1);
    else
	    RuPadRight(chr_l_str_scinstrline,"N",1);

	 int_l_int_noofrec++ ; 

	 if( int_l_int_noofrec == 1 )
	  {
	   
		if( RuGenHoffHdr(p_ptr_fopenfile,"SCINSTR","24","314","DEPO instructions") != APL_SUCCESS )
	    APL_GOBACK_FAIL
	  }

	 fprintf(p_ptr_fopenfile,chr_l_str_scinstrline);
	 fprintf(p_ptr_fopenfile,"\n");

    RuAddCRCFn(chr_l_str_scinstrline,&int_l_int_crc);

  }

  EXEC SQL Close cruinstr ;
  IS_ANY_ORA_ERROR
  
	 strcpy(chr_l_str_urn,"");
	printf("\n B4 Value of seq g_lng_urnseq1 :%ld: chr_l_str_urn :%s: \n", g_lng_urnseq1, chr_l_str_urn);
    RuGenURN(&g_lng_urnseq1,chr_l_str_urn,l_debug_info_ptr); 
	printf("\n Aft Value of seq g_lng_urnseq1 :%ld: chr_l_str_urn :%s: \n", g_lng_urnseq1, chr_l_str_urn);

printf("\n B4 update dl_deal sqlcode :%d: clt :%s: refno :%s:, chr_l_str_urn :%s: \n", sqlca.sqlcode, chr_l_h_client_a, chr_l_h_refno_A, chr_l_str_urn);
    EXEC SQL update dl_deal set lcl_identno = :chr_l_str_urn where client = :chr_l_h_client_a and
    IDENTIY_NO = :chr_l_h_refno_A ;
printf("\n After update dl_deal sqlcode :%d: clt :%s: refno :%s:, chr_l_str_urn :%s: \n", sqlca.sqlcode, chr_l_h_client_a, chr_l_h_refno_A, chr_l_str_urn);
	 IS_ANY_ORA_ERROR
printf("\n After SYS_CHKSQL_ERR  sqlcode :%d: clt :%s: refno :%s:, chr_l_str_urn :%s: \n", sqlca.sqlcode, chr_l_h_client_a, chr_l_h_refno_A, chr_l_str_urn);

  } 

 } 

printf("\n B4 closing cursor :%d:i sqlcode :%d: \n", int_l_int_noofrec, sqlca.sqlcode);
 EXEC SQL Close cscinstr ;
printf("\n Aft closing cursor :%d:i sqlcode :%d: \n", int_l_int_noofrec, sqlca.sqlcode);
 IS_ANY_ORA_ERROR 
printf("\n l_int noof recs :%d: \n", int_l_int_noofrec);
 if(int_l_int_noofrec)
  {
		printf("\n Calling RuGenHoffFtr noofrec :%d: int crc :%d: \n", int_l_int_noofrec,int_l_int_crc);
	  if ( RuGenHoffFtr(p_ptr_fopenfile,"SCINSTR",int_l_int_noofrec,int_l_int_crc) != APL_SUCCESS) 
	   APL_GOBACK_FAIL 
	   (*p_int_noofblocks)++ ; 
		printf("\n Success RuGenHoffFtr noofrec :%d: int crc :%d: \n", int_l_int_noofrec,int_l_int_crc);
  }

	 fprintf(p_ptr_symrepfile,"\n");
	 fprintf(p_ptr_symrepfile,"%10s","");
	 fprintf(p_ptr_symrepfile,"%10s","SCINSTR");
	 fprintf(p_ptr_symrepfile,"%10d",int_l_int_noofrec);

  APL_GOBACK_SUCCESS

	
	RETURN_FAILURE:
     CO_ProcMonitor(p_logfile ,"Exiting out of RuGenHoffSCINSTR Fn Unsuccessfully\n",NULL,NULL);
	  return (APL_FAILURE);

	RETURN_SUCCESS:
     CO_ProcMonitor(p_logfile ,"Exiting out of RuGenHoffSCINSTR Fn Successfully\n",NULL,NULL);
	  return (APL_SUCCESS);

}







int RuHoffGenSCTRSF(FILE* p_ptr_fopenfile,int *p_int_noofblocks,FILE*p_logfile,FILE *p_ptr_symrepfile,INTL_ENV_DATA_STRUCT_H * p_intl_envdatastruct_h,DEBUG_INFO_STRUCT_H** l_debug_info_ptr)
{
   struct sqlca sqlca ;
   char chr_l_h_client_a[HF_CLIENT]  	  			= APL_NULL_STRING ;
   char chr_l_h_locrefno_a[HF_LOC_IDENTITY] 	  			= APL_NULL_STRING ;
   char chr_l_h_refno_A[HF_IDENTNO]  	   			= APL_NULL_STRING ;
   char chr_l_h_countaccrefno[HF_IDENTNO]  			= APL_NULL_STRING ;
   char chr_l_h_mstacc1[HF_CLIENT]  	  			= APL_NULL_STRING ;
   char chr_l_h_mstacc2[HF_CLIENT]  	  			= APL_NULL_STRING ;
   char chr_l_h_locncode_a[HF_LOC_CODE]  	  		= APL_NULL_STRING ;
   char chr_l_h_cplocncode[HF_LOC_CODE]  	  		= APL_NULL_STRING ;
   char chr_l_h_cplcortyp[HF_LOC_CODE]  	  		= APL_NULL_STRING ;
   char chr_l_h_settledt_a[HF_SETL_DATE]  	  		= APL_NULL_STRING ;
   char chr_l_h_location[HF_LOC]  	  		= APL_NULL_STRING ;
	char chr_l_h_locnm[HF_LOC_NAME]   					= APL_NULL_STRING ; 
	char chr_l_h_basloc[HF_BASE_LOC] 					= APL_NULL_STRING ;
   char chr_l_h_intdomcpac[HF_INT_DOMCP]		   = APL_NULL_STRING ;
   char chr_l_h_acc_class[HF_CLN_CLASS] 	   	= APL_NULL_STRING ;
   char chr_l_h_cubk1[HF_CUBRK] 						= APL_NULL_STRING ;
   char chr_l_h_cubk2[HF_CUBRK] 						= APL_NULL_STRING ;
   char chr_l_h_domcpac[HF_DOMCP_LEN] 				= APL_NULL_STRING ;
   char chr_l_h_basacc[HF_BASE_CLT] 					= APL_NULL_STRING ;
   char chr_l_h_countacc_a[HF_CLIENT] 				= APL_NULL_STRING ;
   char chr_l_h_typoftrd[HF_DL_CLASS] 			= APL_NULL_STRING ;
   char chr_l_h_instrcode_A[HF_SEC_CD] 					= APL_NULL_STRING ;
   char chr_l_h_instrloc[HF_SEC_LOC] 					= APL_NULL_STRING ;

	char chr_l_str_temp[HF_TMP] 						= APL_NULL_STRING ;
   char chr_l_str_amt[18] 									= APL_NULL_STRING ;
   char chr_l_h_cractyp[3] 									= APL_NULL_STRING ;
   char chr_l_str_cractyp[3] 								= APL_NULL_STRING ;
   char chr_l_str_urn[20] 									= APL_NULL_STRING ; 
   char chr_l_h_trdt_a[HF_DEAL_DATE] 						= APL_NULL_STRING ;
   char chr_l_h_instr_dt[HF_SEC_DATE] 						= APL_NULL_STRING ;
  	char chr_l_h_trcode_a[HF_DEAL_CD] 					= APL_NULL_STRING ;
   char chr_l_h_prcode[HF_PR_CODE] 					= APL_NULL_STRING ;
   char chr_l_h_statregno[HF_STAT_REGNO] 			= APL_NULL_STRING ;
   char chr_l_h_typeofinstr[HF_INSTRUMENT_TYPE] 				= APL_NULL_STRING ;
   char chr_l_h_acctyp[HF_CLT_TYPE] 					= APL_NULL_STRING ;
	char chr_l_h_accortyp[10] 							   = APL_NULL_STRING ;
   char chr_l_dcompdt[HF_COMP_DATE] 					= APL_NULL_STRING ;
   char chr_l_h_exarena[3]				 					= APL_NULL_STRING ;
   char chr_l_opp_trcode[3]				 					= APL_NULL_STRING ;

	char chr_l_str_cplccortyp[3] 				        	= APL_NULL_STRING ;
	char chr_l_h_acacctyp[3] 				      	  	= APL_NULL_STRING ;
	char chr_l_str_temp1[10] 				     	  		= APL_NULL_STRING ;
	char chr_l_h_cpacctyp[3] 				     			= APL_NULL_STRING ;
	char chr_l_h_lccortyp[10] 				     			= APL_NULL_STRING ;
	char chr_l_h_cplccortyp[10] 				     		= APL_NULL_STRING ;
	char chr_l_h_cploctyp[3] 				     			= APL_NULL_STRING ;
	char chr_l_h_cpcortyp[3] 				     			= APL_NULL_STRING ;
	char chr_l_h_refnum[HF_IDENTNUMBER]        			= APL_NULL_STRING ;
	char chr_l_h_acbasenbr[7] 				     			= APL_NULL_STRING ;
	char chr_l_h_cpbasenbr[7] 				     			= APL_NULL_STRING ;
	char chr_l_h_lcloctyp[3] 				     			= APL_NULL_STRING ;

   char chr_l_str_sctrsfline[DL_HOFF_SCTRSFLINE]  	= APL_NULL_STRING ;

	int  int_l_int_noofrec 				= 0 ;
	int  int_l_int_ctr 				   = 0 ;
	int  int_l_int_crc 					= 0 ; 

	

	char     chr_l_mainfuncarea[APL_MAINFUNCAREA_LEN]      = APL_NULL_STRING;
   char     chr_l_condid_a[APL_CONDID_LEN]                  = APL_NULL_STRING;
	short  	l_cntry_exists = 0 ;
	char 		int_l_temp[20];
	int 		int_quantity_dec_len;
   

   
	double l_dbl_amount 					= 0.0 ;  
	
	 
   
	double l_h_quantity_a						= 0.0 ;
	double l_h_ruquantity 					= 0.0 ; 
   double l_h_nominal_value 				= 0.0 ; 
   double chr_l_h_amount 				= 0.0 ; 

   short l_i_prcode	 		 	  	= 0 ;
   short l_i_amount	 		 	  	= 0 ;
   short l_i_statregno 		 	  	= 0 ;
   short l_i_accortyp 		 	  	= 0 ;
   short l_i_acacctyp 		 	  	= 0 ;
   short l_i_location 		 	  	= 0 ;
   short l_i_locncode				= 0 ; 
   short l_i_cplocncode				= 0 ; 
   short l_i_refno					= 0 ; 
   short l_i_countaccrefno			= 0 ; 
   short int_l_i_qty 		 		 	  	= 0 ;
   short l_i_ruqty 	 		 	  	= 0 ;
   short l_i_countacc 		 	  	= 0 ;
   short l_i_basacc  		 	  	= 0 ;
   short l_i_domcpac 		 	  	= 0 ;
   short l_i_dcompdt 		 	  	= 0 ;
   short l_i_acc_class 		 	  	= 0 ;
   short l_i_cractyp 		 	  	= 0 ;
   short l_i_account 		 	  	= 0 ;
   short l_i_mstacc1 		 	  	= 0 ;
   short l_i_mstacc2 		 	  	= 0 ;
   short l_i_intdomcpac		 	  	= 0 ;
   short l_i_instr_code			 	  	= 0 ;
   short l_i_basloc   				= 0 ;
   short l_i_locnm      			= 0 ;
   short l_i_trdt       			= 0 ;
   short l_i_instr_dt       			= 0 ;
   short l_i_settledt     			= 0 ;
   short l_i_acctyp       			= 0 ;
   short int_l_i_trcode       			= 0 ;
   short l_i_cubk1       			= 0 ;
   short l_i_cubk2      			= 0 ;
   short l_i_typoftrd     			= 0 ;
   short l_i_locrefno     			= 0 ;
   short l_i_instrloc     			= 0 ;
   
	short l_i_cpacctyp				= 0 ;
	short l_i_clocation           = 0 ;
	short l_i_lccortyp            = 0 ;
	short l_i_cpaccount           = 0 ;
	short l_i_cploctyp            = 0 ;
	short l_i_loctyp 		         = 0 ;
	short l_i_cpcortyp            = 0 ;
	short l_i_refnum            	= 0 ;
	short l_i_acbasenbr           = 0 ;
	short l_i_cpbasenbr           = 0 ;
	short l_i_typeofinstr	           	= 0 ;
	short l_i_nomval	           	= 0 ;
	short l_i_exarena	           	= 0 ;

	EXEC SQL VAR chr_l_h_client_a 		IS STRING ;  
	EXEC SQL VAR chr_l_h_refno_A	 		IS STRING ;  
	EXEC SQL VAR chr_l_h_countaccrefno IS STRING ;  
	EXEC SQL VAR chr_l_h_statregno		IS STRING ;  
	EXEC SQL VAR chr_l_h_mstacc1 		IS STRING ;  
	EXEC SQL VAR chr_l_h_mstacc2 		IS STRING ;  
	EXEC SQL VAR chr_l_h_instrcode_A 		IS STRING ;  
	EXEC SQL VAR chr_l_h_intdomcpac 	IS STRING ;  
	EXEC SQL VAR chr_l_h_acc_class 	IS STRING ;  
	EXEC SQL VAR chr_l_h_basacc 		IS STRING ;  
	EXEC SQL VAR chr_l_h_basloc 		IS STRING ;  
	EXEC SQL VAR chr_l_h_cractyp	 	IS STRING ;  
	EXEC SQL VAR chr_l_h_locnm	 		IS STRING ;  
	EXEC SQL VAR chr_l_h_domcpac 		IS STRING ;  
	EXEC SQL VAR chr_l_h_location 		IS STRING ;  
	EXEC SQL VAR chr_l_h_cubk1	 		IS STRING ;  
	EXEC SQL VAR chr_l_h_cubk2	 		IS STRING ;  
	EXEC SQL VAR chr_l_h_countacc_a 		IS STRING ;  
	EXEC SQL VAR chr_l_h_typoftrd 		IS STRING ;  
	EXEC SQL VAR chr_l_h_settledt_a 		IS STRING ;  
	EXEC SQL VAR chr_l_h_prcode 		IS STRING ;  
	EXEC SQL VAR chr_l_dcompdt	 		IS STRING ;  
	EXEC SQL VAR chr_l_h_exarena 		IS STRING ;  
	
	EXEC SQL VAR chr_l_h_cplocncode   IS STRING ;  
	EXEC SQL VAR chr_l_h_accortyp 		IS STRING ;  
	EXEC SQL VAR chr_l_h_acacctyp 		IS STRING ;  
	EXEC SQL VAR chr_l_h_cpacctyp 		IS STRING ;  
	EXEC SQL VAR chr_l_h_lccortyp 		IS STRING ;  
	EXEC SQL VAR chr_l_h_cplccortyp 	IS STRING ;  
	EXEC SQL VAR chr_l_h_cploctyp 		IS STRING ;  
	EXEC SQL VAR chr_l_h_cpcortyp 		IS STRING ;  
	EXEC SQL VAR chr_l_h_refnum 		IS STRING ;  
	EXEC SQL VAR chr_l_h_acbasenbr		IS STRING ;  
	EXEC SQL VAR chr_l_h_cpbasenbr		IS STRING ;  
	EXEC SQL VAR chr_l_h_lcloctyp		IS STRING ;  
	EXEC SQL VAR chr_l_h_locrefno_a		IS STRING ;  

   memset(chr_l_h_cplocncode		,'\0', 10 ) ; 
   memset(chr_l_h_accortyp 			,'\0', 10 ) ; 
   memset(chr_l_h_cpacctyp 			,'\0', 3 ) ; 
   memset(chr_l_h_acacctyp 			,'\0', 3 ) ; 
   memset(chr_l_h_lccortyp 			,'\0', 10 ) ; 
   memset(chr_l_h_cplccortyp 		,'\0', 10 ) ; 
   memset(chr_l_h_cploctyp 			,'\0', 3 ) ; 
   memset(chr_l_h_cpcortyp 			,'\0', 3 ) ; 
   memset(chr_l_h_acbasenbr 		,'\0', 7 ) ; 
   memset(chr_l_h_cpbasenbr 		,'\0', 7 ) ; 
   memset(chr_l_h_lcloctyp 			,'\0', 3 ) ; 
   memset(chr_l_h_locrefno_a 			,'\0', HF_LOC_IDENTITY ) ; 

   memset(chr_l_h_basloc 		,'\0',HF_BASE_LOC);
   memset(chr_l_h_client_a 		,'\0',HF_CLIENT) ; 
   memset(chr_l_h_refno_A	 		,'\0',HF_IDENTNO) ; 
   memset(chr_l_h_countaccrefno,'\0',HF_IDENTNO) ; 
   memset(chr_l_h_refnum	 		,'\0',HF_IDENTNUMBER) ; 
   memset(chr_l_h_statregno		,'\0',HF_STAT_REGNO) ; 
   memset(chr_l_h_instrcode_A 		,'\0',HF_SEC_CD);
   memset(chr_l_h_intdomcpac 	,'\0',HF_INT_DOMCP) ; 
   memset(chr_l_h_acc_class		,'\0',HF_CLN_CLASS) ; 
   memset(chr_l_h_basacc			,'\0',HF_BASE_CLT) ;  
   memset(chr_l_h_cractyp 		,'\0',3);
   memset(chr_l_h_locnm			,'\0',HF_LOC_NAME) ; 
   memset(chr_l_h_domcpac		,'\0',HF_DOMCP_LEN ) ; 
   memset(chr_l_h_location		,'\0',HF_LOC) ; 
   memset(chr_l_h_cubk1			,'\0',HF_CUBRK) ; 
   memset(chr_l_h_cubk2			,'\0',HF_CUBRK) ; 
   memset(chr_l_h_countacc_a		,'\0',HF_CLIENT) ; 
   memset(chr_l_h_typoftrd		,'\0',HF_DL_CLASS) ; 
   memset(chr_l_h_prcode			,'\0',HF_PR_CODE) ; 
   memset(chr_l_dcompdt			,'\0',HF_COMP_DATE) ; 
   memset(chr_l_h_exarena		,'\0',3) ; 
   memset(chr_l_h_settledt_a		,'\0',11) ; 
   memset(chr_l_str_sctrsfline	,'\0',DL_HOFF_SCTRSFLINE) ; 
   memset(chr_l_str_cractyp 	,'\0',3);
   memset(chr_l_str_urn 			,'\0',20);


	

	printf("ENTERED FUNCTION RuHoffGenSCTRSF \n");
	printf("------------------------------------------------------\n");

   EXEC SQL Select to_char(LR_DT,'dd/chr_mm/yyyy') into :chr_l_dcompdt:l_i_dcompdt from DL_LOCALREPDATES 
	where CLR_NAME = :int_g_regen_ind ;

	IS_ANY_ORA_ERROR 

	EXEC SQL select custody_clt_cd into :chr_l_h_intdomcpac:l_i_intdomcpac from MT_CORE_SYS_PARAMS ;
	IS_ANY_ORA_ERROR
	printf("1. The sql load : %d\n",sqlca.sqlcode);
	printf("Reached 1");

  

   EXEC SQL DECLARE csctrsf CURSOR FOR
	SELECT a.location_cd , c.LOC_NAME , c.BASELOCATION , a.client , a.instr_code , a.dl_class , 
	a.deal_cd , a.cp_clt , a.QTY , a.IDENTIY_NO , a.AMOUNT ,
	to_char(a.deal_date,'yyyymmdd') , to_char(a.INSTRUMENT_DT,'yyyymmdd') , to_char(a.setl_date,'yyyymmdd') , a.ex_arena
   from dl_deal a , DL_RULOCATION c
	where a.domestic_cpclt = :chr_l_h_intdomcpac and a.cp_clt IS NOT NULL and
	((a.ALLOW_DROPDT IS NOT NULL and 
	to_date(to_char(a.ALLOW_DROPDT,'dd/chr_mm/yyyy'),'dd/chr_mm/yyyy') > to_date(:chr_l_dcompdt,'dd/chr_mm/yyyy') ) or
	EXISTS (SELECT 1 FROM MS_MSGSTAT d where a.client = d.client and
   a.IDENTIY_NO = d.proc_init and d.swift_msg_rep = '53x' and
	(d.generate_dt IS NOT NULL and 
	to_date(to_char(d.generate_dt,'dd/chr_mm/yyyy'),'dd/chr_mm/yyyy') > to_date(:chr_l_dcompdt,'dd/chr_mm/yyyy')  )) )
   and a.lcl_identno IS NULL and
	a.location_cd = c.LOC ;
	IS_ANY_ORA_ERROR
	printf("2. The sql load : %d\n",sqlca.sqlcode);
	printf("Reached 2");

	EXEC SQL OPEN csctrsf ;
   IS_ANY_ORA_ERROR

	 for( ; ; )
	 {
	printf("3. The sql load : %d\n",sqlca.sqlcode);
	printf("Reached 3");

	  EXEC SQL FETCH csctrsf into :chr_l_h_location:l_i_location , :chr_l_h_locnm:l_i_locnm ,
	  :chr_l_h_basloc:l_i_basloc , :chr_l_h_client_a:l_i_account , :chr_l_h_instrcode_A:l_i_instr_code , :chr_l_h_typoftrd:l_i_typoftrd ,
	  :chr_l_h_trcode_a:int_l_i_trcode , :chr_l_h_countacc_a:l_i_countacc , 
	  :l_h_quantity_a:int_l_i_qty , :chr_l_h_refno_A:l_i_refno , :chr_l_h_amount:l_i_amount ,
	  :chr_l_h_trdt_a:l_i_trdt , :chr_l_h_instr_dt:l_i_instr_dt  , :chr_l_h_settledt_a:l_i_settledt ,chr_l_h_exarena:l_i_exarena ;

	  printf("sqlca.sqlcode is %d\n",sqlca.sqlcode);
	  IS_ANY_ORA_ERROR_CURSOR
	  if(APL_ZERO_RESULT_SET)
	   break;

	printf("account is %s, refno is %s,chr_l_h_countacc_a is %s \n",chr_l_h_client_a,chr_l_h_refno_A,chr_l_h_countacc_a);

    EXEC SQL select CLN_CLAS into :chr_l_h_acc_class:l_i_acc_class
	 from MT_CLIENT where CLN_CODE = :chr_l_h_client_a ; 
	 IS_ANY_ORA_ERROR
	printf("l_acc_class is %s\n",chr_l_h_acc_class);

    EXEC SQL select ltrim(lcl_identno) into :chr_l_h_locrefno_a:l_i_locrefno from dl_deal where 
	 client  = :chr_l_h_client_a and IDENTIY_NO = :chr_l_h_refno_A ;   
	 IS_ANY_ORA_ERROR
	printf("locrefno is |%s|\n",chr_l_h_locrefno_a);
															 
	 IS_ANY_ORA_ERROR

		CO_ProcMonitor(APL_OUT_FILE,"For selecting the matching records\n",NULL,NULL);
		fprintf(p_logfile,"For selecting the matching records\n");

	 if(strcmp(chr_l_h_acc_class,"2")  || strlen(chr_l_h_locrefno_a) ) 
	 {
		printf("CONTINUING****\n");
	  continue ; 
		}
	
   EXEC SQL select CLN_master into :chr_l_h_mstacc1 from MT_CLIENT where CLN_CODE = :chr_l_h_client_a ;
	  printf("sqlca.sqlcode is %d\n",sqlca.sqlcode);
	IS_ANY_ORA_ERROR

	EXEC SQL select CLN_master into :chr_l_h_mstacc2 from MT_CLIENT where CLN_CODE = :chr_l_h_countacc_a ;
	  printf("sqlca.sqlcode is %d\n",sqlca.sqlcode);
	IS_ANY_ORA_ERROR
fprintf(p_logfile,"selected the master client successfully\n");
		CO_ProcMonitor(APL_OUT_FILE,"selected the master client successfully\n",NULL,NULL);
      
printf("\n reached here **************************\n ");	
	printf("6. sqlcode : %d\n",sqlca.sqlcode);
	printf("mstacc1 : %s, mstacc2 : %s,client : %s, cp_clt : %s",chr_l_h_mstacc1,chr_l_h_mstacc2,chr_l_h_client_a,chr_l_h_countacc_a);
	printf("trcode : %s\n",chr_l_h_trcode_a);
   memset(chr_l_opp_trcode, APL_NULL_CHAR, 3);
		if (!strcmp(chr_l_h_trcode_a,"1"))
			strcpy(chr_l_opp_trcode, "2");
		else if (!strcmp(chr_l_h_trcode_a,"2"))
			strcpy(chr_l_opp_trcode, "1");
		else if (!strcmp(chr_l_h_trcode_a,"3"))
			strcpy(chr_l_opp_trcode, "4");
		else if (!strcmp(chr_l_h_trcode_a,"4"))
			strcpy(chr_l_opp_trcode, "3");

	printf("trcode : %s\n",chr_l_h_trcode_a);
	fflush(p_logfile);
	fflush(stdout);
	printf("checking before query\n");
	fflush(stdout);
printf("countacc : %s, clt : %s, intdomcpac : %s,dcompdt : %s,instr_code : %s,quantity : %lf,deal_date : %s,opp_trcode : %s,setl_date : %s,dl_class : %s,ex_arena : %s,location : %s\n",chr_l_h_countacc_a,chr_l_h_client_a,chr_l_h_intdomcpac,chr_l_dcompdt,chr_l_h_instrcode_A,l_h_quantity_a,chr_l_h_trdt_a,chr_l_opp_trcode,chr_l_h_settledt_a,chr_l_h_typoftrd,chr_l_h_exarena,chr_l_h_location);
 
	fflush(stdout);
	printf("Before meemset");
	fflush(stdout);

	memset(chr_l_h_cplocncode,APL_NULL_CHAR, 10 ) ;
	printf("After 1 Memeset");
	fflush(stdout);
	memset(chr_l_h_countaccrefno,APL_NULL_CHAR,HF_IDENTNO) ;
	fflush(stdout);
	printf("After all memeset");
	printf("4. The sql load : %d\n",sqlca.sqlcode);
	fflush(stdout);

	 /* Bageshri -- 10GM */
	printf ( " the values after the chr_last query is->> clt|%s|\n  cp_clt|%s|\n domcacc |%s|\ncompdt  |%s|\ninstr_code |%s|\nqty |%lf|\ntrdt |%s|\nopptrdt |%s| \nsettledt |%s|\ntypeoftrd |%s|\nexarena  |%s|\nloc |%s|\namt |%lf|\nmaxdiff |%d| -----\n",chr_l_h_client_a, chr_l_h_countacc_a, chr_l_h_intdomcpac, chr_l_dcompdt, chr_l_h_instrcode_A, l_h_quantity_a, chr_l_h_trdt_a, chr_l_opp_trcode, chr_l_h_settledt_a, chr_l_h_typoftrd, chr_l_h_exarena, chr_l_h_location, l_dbl_amount, l_mt_core_sys_params_struct_h.allowed_amtdiff);
   
	EXEC SQL select location_cd , IDENTIY_NO into 
	:chr_l_h_cplocncode:l_i_cplocncode , :chr_l_h_countaccrefno:l_i_countaccrefno 
   from dl_deal a , DL_RULOCATION c
   where a.client = :chr_l_h_countacc_a and a.cp_clt = :chr_l_h_client_a and
	a.domestic_cpclt = :chr_l_h_intdomcpac and a.cp_clt IS NOT NULL and
	((a.ALLOW_DROPDT IS NOT NULL and 
	to_date(to_char(a.ALLOW_DROPDT,'dd/chr_mm/yyyy'),'dd/chr_mm/yyyy') > to_date(:chr_l_dcompdt,'dd/chr_mm/yyyy') ) or
   EXISTS (SELECT 1 FROM MS_MSGSTAT d where a.client = d.client and
	a.IDENTIY_NO = d.proc_init and d.swift_msg_rep = '53x' and
	(d.generate_dt IS NOT NULL and 
	to_date(to_char(d.generate_dt,'dd/chr_mm/yyyy'),'dd/chr_mm/yyyy') > to_date(:chr_l_dcompdt,'dd/chr_mm/yyyy')  )))
	and a.lcl_identno IS NULL and
	a.location_cd = c.LOC 
   and a.instr_code      = :chr_l_h_instrcode_A
 	and a.QTY         = :l_h_quantity_a
	and to_char(a.deal_date,'yyyymmdd') = :chr_l_h_trdt_a
	and a.deal_cd      = :chr_l_opp_trcode
	and to_char(a.setl_date,'yyyymmdd')  = :chr_l_h_settledt_a
	and a.dl_class   = :chr_l_h_typoftrd
	and a.ex_arena     = :chr_l_h_exarena
	and NVL(a.location_cd,0)   = NVL(:chr_l_h_location,0)
	and ABS((NVL(a.AMOUNT,0)-:chr_l_h_amount)) <= :l_mt_core_sys_params_struct_h.allowed_amtdiff 
	and rownum < 2;
	 
	
	printf("checking after query\n");
	printf("After finding 2nd leg REFNO IS %s, LOCNCODE is %s\n",chr_l_h_countaccrefno,chr_l_h_cplocncode);
	fflush(stdout);

	fprintf(p_logfile,"cplocncode- %s,countaccrefno- %s,cp_clt- %s,intdomcpacc- %s,client- %s\n",chr_l_h_cplocncode,chr_l_h_countaccrefno,chr_l_h_countacc_a,chr_l_h_intdomcpac,chr_l_h_client_a);	
	fprintf(p_logfile,"instr_code- %s, quantity- %lf, deal_date- %s,deal_cd- %s,setl_date- %s,dl_class- %s,ex_arena- %s,location- %s\n",chr_l_h_instrcode_A,l_h_quantity_a,chr_l_h_trdt_a,chr_l_opp_trcode,chr_l_h_settledt_a,chr_l_h_typoftrd,chr_l_h_exarena,chr_l_h_location);

	fprintf(p_logfile,"%d\n",sqlca.sqlcode);
	printf("5. The dwl h_code is :%d\n",sqlca.sqlcode);
	printf("Reached 6");
	IS_ANY_ORA_ERROR

	EXEC SQL SELECT CLN_CLAS into :chr_l_h_acc_class:l_i_acc_class from MT_CLIENT 
	where CLN_CODE = :chr_l_h_countacc_a ; 
	fprintf(p_logfile,"%d",sqlca.sqlcode);
	printf("6. The dwl h_code is :%d\n",sqlca.sqlcode);
	IS_ANY_ORA_ERROR
	fprintf(p_logfile,"%d",sqlca.sqlcode);
	


fprintf(p_logfile,"Got the matching records successfully\n");
CO_ProcMonitor(APL_OUT_FILE,"Got the matching records successfully\n",NULL,NULL);


printf("\n  mastacc1= %s mastacc2= %s countrefnolen =%d clt class = %s\n", chr_l_h_mstacc1, chr_l_h_mstacc2, strlen(chr_l_h_countaccrefno), chr_l_h_acc_class);

if  ( !strcmp( chr_l_h_mstacc1,chr_l_h_mstacc2 ) &&  strlen(chr_l_h_countaccrefno) && !(strcmp(chr_l_h_acc_class,"2")) ) 
  {
  		
		printf ("\n  in the h_code for internal tables \n");
  		CO_ProcMonitor(APL_OUT_FILE,"Looking into the internal trades\n",NULL,NULL); 
	fprintf(p_logfile,"Looking into the internal trades\n");
      
     EXEC SQL select CLT_TYP , BASECLT , CLTTYP into :chr_l_h_accortyp:l_i_accortyp ,
	  :chr_l_h_acbasenbr:l_i_acbasenbr , :chr_l_h_acacctyp:l_i_acacctyp
	  from DL_RUCLIENT
	  where client = :chr_l_h_client_a ;
	  IS_ANY_ORA_ERROR

     EXEC SQL select CLT_TYP , BASECLT , CLTTYP into :chr_l_h_cpcortyp:l_i_cpcortyp ,
	  :chr_l_h_cpbasenbr:l_i_cpbasenbr , :chr_l_h_cpacctyp:l_i_cpacctyp
	  from DL_RUCLIENT
	  where client = :chr_l_h_countacc_a ;
	  IS_ANY_ORA_ERROR

	  EXEC SQL select location_cd , INSTR_TYPE , NOMINAL_VALUE into 
	  :chr_l_h_instrloc:l_i_instrloc , :chr_l_h_typeofinstr:l_i_typeofinstr , :l_h_nominal_value:l_i_nomval 
		from MT_INSTRUMENT
	  where instr_code = :chr_l_h_instrcode_A ; 
	  IS_ANY_ORA_ERROR

     EXEC SQL select LOC_TYPE into :chr_l_h_lcloctyp from DL_RULOCATION where LOC = :chr_l_h_location ; 
	  IS_ANY_ORA_ERROR

	  EXEC SQL select LOC_TYPE into :chr_l_h_cploctyp:l_i_cploctyp from DL_RULOCATION
	  where LOC = :chr_l_h_cplocncode ;
	  IS_ANY_ORA_ERROR 

	  EXEC SQL select PR_CODE into :chr_l_h_prcode:l_i_prcode from DL_RUINSTRUMENT 
	  where instr_code = :chr_l_h_instrcode_A ;
	  IS_ANY_ORA_ERROR

	  if( !(strcmp(chr_l_h_location,"VTB")) )
		strcpy(chr_l_str_cplccortyp,"NR");
	  else if( !(strcmp(chr_l_h_location,"MICX")) || !(strcmp(chr_l_h_location,"NRB")) )
		strcpy(chr_l_str_cplccortyp,"NB");
	  else
		strcpy(chr_l_str_cplccortyp,"NN");

	  strcpy(chr_l_str_cractyp,"LR");
	  strcpy(chr_l_str_cractyp,"  ");
		printf("\n the client is %s and the refno is %s-->\n", chr_l_h_client_a, chr_l_h_refno_A);
	  EXEC SQL DECLARE cinttrade CURSOR for 
	  Select ST_REG_NO , QTY from DL_RUDEAL where client = :chr_l_h_client_a and IDENTIY_NO = :chr_l_h_refno_A 
	  and INSTRUMENT_DT IS NOT NULL ; 
	  IS_ANY_ORA_ERROR

     EXEC SQL OPEN cinttrade ; 
		CO_ProcMonitor(APL_OUT_FILE,"Successfully opened the cursor\n",NULL,NULL);
		fprintf(p_logfile,"Successfully opened the cursor\n");
	  IS_ANY_ORA_ERROR 
printf("\n before fetch\n");
     for( ; ; )
     {
		printf("\n inside fetch\n");
     EXEC SQL Fetch cinttrade into :chr_l_h_statregno:l_i_statregno , :l_h_ruquantity:l_i_ruqty ; 
	  IS_ANY_ORA_ERROR_CURSOR
		printf("\n --------> chr_l_h_statregno  %s \n", chr_l_h_statregno);
	  if(!sqlca.sqlerrd[2])
		{
		 fprintf(p_logfile,"No Record int_found in crutrade! ");
		 fprintf(p_logfile,"Account = %s , Refno = %s\n",chr_l_h_client_a,chr_l_h_refno_A);
		 printf("\nNo data int_found\n");
		 break ; 
	   }
	  else if(APL_ZERO_RESULT_SET)
		{
			printf("\n to debug\n");
			break ; 
		}
		printf("\nthe statregno after pick is %s\n", chr_l_h_statregno); 
	  EXEC SQL SELECT IDENTIY_NUM into :chr_l_h_refnum:l_i_refnum from DL_RUSRN
	  where instr_code = :chr_l_h_instrcode_A and STAT_REG_NO = :chr_l_h_statregno ; 
	  IS_ANY_ORA_ERROR
     
	  printf ("\n ---------> refnum = %s \n", chr_l_h_refnum);

	  strcpy(chr_l_str_urn,"");
	  RuGenURN(&g_lng_urnseq,chr_l_str_urn,l_debug_info_ptr);

	  strcpy(chr_l_str_sctrsfline," ");
	  RuPadRight(chr_l_str_sctrsfline,"SCTRSF",9);

	  RuPadRight(chr_l_str_sctrsfline,chr_l_str_urn,13);
	  RuPadRight(chr_l_str_sctrsfline,chr_l_h_acbasenbr,6); 
	  RuPadRight(chr_l_str_sctrsfline,chr_l_h_instr_dt,10);

	 strcpy(chr_l_str_temp,"");
	 RuPadRight(chr_l_str_temp,chr_l_h_prcode,3);
	 RuPadRight(chr_l_str_temp,"-",1);
	 RuPadRight(chr_l_str_temp,chr_l_h_statregno,20);
	 RuPadRight(chr_l_str_sctrsfline,chr_l_str_temp,24);

	 strcpy(chr_l_mainfuncarea, "TRD_QTY_LEN");
	 strcpy(chr_l_condid_a, "SEVEN_DEC");
	 if (APL_FAILURE == CO_Chk_CntryEnabled(chr_l_mainfuncarea, chr_l_condid_a, &l_cntry_exists, l_debug_info_ptr))
	 {
		APL_GOBACK_FAIL;
	 }

    if( !(strcmp(chr_l_h_trcode_a,"1")) || !(strcmp(chr_l_h_trcode_a,"3")) )
	  {
	    RuPadRight(chr_l_str_sctrsfline,chr_l_h_location,10); 
	    RuPadRight(chr_l_str_sctrsfline,chr_l_h_cplocncode,10);
	  }
    else
	  {
	    RuPadRight(chr_l_str_sctrsfline,chr_l_h_cplocncode,10);
	    RuPadRight(chr_l_str_sctrsfline,chr_l_h_location,10); 
	  }

	 if( !(strcmp(chr_l_h_typeofinstr,"BON")) || !(strcmp(chr_l_h_typeofinstr,"FMT") ) )
	     l_dbl_amount = l_h_ruquantity * l_h_nominal_value ; 
	 else
	     l_dbl_amount = l_h_ruquantity ; 

		  int_quantity_dec_len = l_mt_core_sys_params_struct_h.qty_dec_len;
	if(l_cntry_exists > 0)
	{
		sprintf(int_l_temp,"%s%d%s", "%0.", int_quantity_dec_len, "f");
		sprintf(chr_l_str_amt,int_l_temp,l_dbl_amount);
	}
	else
   sprintf(chr_l_str_amt,"%0.2f",l_dbl_amount);

	     RuPadRight(chr_l_str_sctrsfline,chr_l_str_amt,20);

    if( !(strcmp(chr_l_h_trcode_a,"1")) || !(strcmp(chr_l_h_trcode_a,"3")) )
	  {
		strcpy(chr_l_str_temp,"");
		strcat(chr_l_str_temp,chr_l_h_countacc_a);
		strcat(chr_l_str_temp,chr_l_h_cpacctyp);
		strcat(chr_l_str_temp,chr_l_h_cpcortyp);
		strcat(chr_l_str_temp,chr_l_h_instrcode_A);
		strcat(chr_l_str_temp,chr_l_h_refnum);
	   RuPadRight(chr_l_str_sctrsfline,chr_l_str_temp,33);
	
		strcpy(chr_l_str_temp,"");
		strcat(chr_l_str_temp,chr_l_h_client_a);
		strcat(chr_l_str_temp,chr_l_h_acacctyp);
		strcat(chr_l_str_temp,chr_l_h_accortyp);
		strcat(chr_l_str_temp,chr_l_h_instrcode_A);
		strcat(chr_l_str_temp,chr_l_h_refnum);
	   RuPadRight(chr_l_str_sctrsfline,chr_l_str_temp,33);
	
		strcpy(chr_l_str_temp,"");
		
		strcat(chr_l_str_temp,chr_l_h_cplocncode);
		strcat(chr_l_str_temp,chr_l_h_cploctyp);
		
		strcat(chr_l_str_temp,chr_l_str_cplccortyp);
		strcat(chr_l_str_temp,chr_l_h_instrcode_A);
		strcat(chr_l_str_temp,chr_l_h_refnum);
	   RuPadRight(chr_l_str_sctrsfline,chr_l_str_temp,33);

		strcpy(chr_l_str_temp,"");
		strcat(chr_l_str_temp,chr_l_h_location);
		strcat(chr_l_str_temp,chr_l_h_lcloctyp);
		strcat(chr_l_str_temp,chr_l_str_cplccortyp); 
		strcat(chr_l_str_temp,chr_l_h_instrcode_A);
		strcat(chr_l_str_temp,chr_l_h_refnum);
	   RuPadRight(chr_l_str_sctrsfline,chr_l_str_temp,33);
	  }
	 else
	  {
		strcpy(chr_l_str_temp,"");
		strcat(chr_l_str_temp,chr_l_h_client_a);
		strcat(chr_l_str_temp,chr_l_h_acacctyp);
		strcat(chr_l_str_temp,chr_l_h_accortyp);
		strcat(chr_l_str_temp,chr_l_h_instrcode_A);
		strcat(chr_l_str_temp,chr_l_h_refnum);
	   RuPadRight(chr_l_str_sctrsfline,chr_l_str_temp,33);
	
		strcpy(chr_l_str_temp,"");
		strcat(chr_l_str_temp,chr_l_h_countacc_a); 
		strcat(chr_l_str_temp,chr_l_h_cpacctyp);
		strcat(chr_l_str_temp,chr_l_h_cpcortyp);
		strcat(chr_l_str_temp,chr_l_h_instrcode_A);
		strcat(chr_l_str_temp,chr_l_h_refnum);
	   RuPadRight(chr_l_str_sctrsfline,chr_l_str_temp,33);
	
		strcpy(chr_l_str_temp,"");
		strcat(chr_l_str_temp,chr_l_h_location);
		strcat(chr_l_str_temp,chr_l_h_lcloctyp);
		strcat(chr_l_str_temp,chr_l_str_cplccortyp); 
		strcat(chr_l_str_temp,chr_l_h_instrcode_A);
		strcat(chr_l_str_temp,chr_l_h_refnum);
	   RuPadRight(chr_l_str_sctrsfline,chr_l_str_temp,33);
		
		strcpy(chr_l_str_temp,"");
		strcat(chr_l_str_temp,chr_l_h_cplocncode);
		strcat(chr_l_str_temp,chr_l_h_cploctyp);
		strcat(chr_l_str_temp,chr_l_str_cplccortyp);
		strcat(chr_l_str_temp,chr_l_h_instrcode_A);
		strcat(chr_l_str_temp,chr_l_h_refnum);
	   RuPadRight(chr_l_str_sctrsfline,chr_l_str_temp,33);

	  }

	   RuPadRight(chr_l_str_sctrsfline,"SCT",3);
	   RuPadRight(chr_l_str_sctrsfline,"Y",1);

     if( !(strcmp(chr_l_h_typoftrd,"20")) || !(strcmp(chr_l_h_trcode_a,"26")) )
	    RuPadRight(chr_l_str_sctrsfline,"Y",1);
     else
	    RuPadRight(chr_l_str_sctrsfline,"N",1);

	  int_l_int_noofrec++ ; 

CO_ProcMonitor(APL_OUT_FILE,"Trying to get the chr_header for the handoff h_file\n",NULL,NULL);	
		fprintf(p_logfile,"Trying to get the chr_header for the handoff h_file\n");
	  if( int_l_int_noofrec == 1 )
	  {
	   
		if( RuGenHoffHdr(p_ptr_fopenfile,"SCTRSF","14","240", "DEPO transfers") != APL_SUCCESS )
	   APL_GOBACK_FAIL 
     }

	CO_ProcMonitor(APL_OUT_FILE,"Successfully generated the chr_header for the handoff h_file\n",NULL,NULL);
	  fprintf(p_ptr_fopenfile,chr_l_str_sctrsfline);
	  fprintf(p_ptr_fopenfile,"\n");

     RuAddCRCFn(chr_l_str_sctrsfline,&int_l_int_crc);

	 }
	 	CO_ProcMonitor(APL_OUT_FILE,"Successfully got the data from the cursor\n",NULL,NULL); 
	  strcpy(chr_l_str_urn,"");
	  RuGenURN(&g_lng_urnseq1,chr_l_str_urn,l_debug_info_ptr);

	  EXEC SQL update dl_deal set lcl_identno = :chr_l_str_urn where client = :chr_l_h_client_a and
	  IDENTIY_NO = :chr_l_h_refno_A ; 
     IS_ANY_ORA_ERROR    
   
	  strcpy(chr_l_str_urn,"");
	  RuGenURN(&g_lng_urnseq1,chr_l_str_urn,l_debug_info_ptr);

	  EXEC SQL update dl_deal set lcl_identno = :chr_l_str_urn where client = :chr_l_h_countacc_a and
	  IDENTIY_NO = :chr_l_h_countaccrefno ; 
     IS_ANY_ORA_ERROR    
	 }
	
    } 

	 EXEC SQL Close csctrsf ;
	 IS_ANY_ORA_ERROR
CO_ProcMonitor(APL_OUT_FILE,"Trying to get the Footer for the Handoff h_file\n",NULL,NULL);	
	 if(int_l_int_noofrec)
	 {
	  if ( RuGenHoffFtr(p_ptr_fopenfile,"SCTRSF",int_l_int_noofrec,int_l_int_crc) != APL_SUCCESS) 
	   APL_GOBACK_FAIL 
	   (*p_int_noofblocks)++ ; 
    }
	CO_ProcMonitor(APL_OUT_FILE,"Successfully generated the footer for the Handoff h_file\n",NULL,NULL);
	 fprintf(p_ptr_symrepfile,"\n");
	 fprintf(p_ptr_symrepfile,"%10s","");
	 fprintf(p_ptr_symrepfile,"%10s","SCTRSF");
	 fprintf(p_ptr_symrepfile,"%10d",int_l_int_noofrec);

   APL_GOBACK_SUCCESS

	
	RETURN_FAILURE:
     CO_ProcMonitor(p_logfile,"Exiting out of RuGenHoffSCTRSF Fn Unsuccessfully\n",NULL,NULL);
     return (APL_FAILURE);

	RETURN_SUCCESS:
     CO_ProcMonitor(p_logfile,"Exiting out of RuGenHoffSCTRSF Fn Successfully\n",NULL,NULL);
	  return (APL_SUCCESS);

}




int RuHoffGenSCCLOSE(FILE *p_ptr_fopenfile,int *p_int_noofblocks,FILE*p_logfile,FILE *p_ptr_symrepfile,INTL_ENV_DATA_STRUCT_H * p_intl_envdatastruct_h,DEBUG_INFO_STRUCT_H** l_debug_info_ptr)
{
   struct sqlca sqlca ;
   char chr_l_h_client_a[HF_CLIENT]  			 = APL_NULL_STRING ;
   char chr_l_h_acc_class[HF_CLN_CLASS]		 = APL_NULL_STRING ;
	char chr_l_h_acctyp[HF_CLT_TYPE] 				 = APL_NULL_STRING ;
	char chr_l_h_cractyp[HF_CLT_TYPE] 				 = APL_NULL_STRING ;
	char chr_l_h_maker[HF_MAKER] 				 	 = APL_NULL_STRING ;

   char chr_l_str_sccloseline[DL_HOFF_SCCLOSELINE] = APL_NULL_STRING ;
	char chr_l_str_temp[HF_TMP] 				 	 = APL_NULL_STRING ;

	char chr_l_str_cractyp[HF_CRACTYPE]			 = APL_NULL_STRING ;
   char chr_l_dcompdt[HF_COMP_DATE] 				 = APL_NULL_STRING ;

	int  int_l_int_noofrec 			= 0 ;
	int  int_l_int_clsrec 			= 0 ;
	int  int_l_int_crc 				= 0 ; 

   short l_i_account 		   = 0 ;
   short l_i_acctyp   			= 0 ;
   short l_i_acc_class  		= 0 ;
   short l_i_cractyp   			= 0 ;
   short l_i_dcompdt   			= 0 ;
	short l_i_maker 	 			= 0 ;
   
	EXEC SQL VAR chr_l_h_client_a 	IS STRING ;  
	EXEC SQL VAR chr_l_h_acc_class IS STRING ;  
	EXEC SQL VAR chr_l_h_acctyp 	IS STRING ;  
	EXEC SQL VAR chr_l_h_cractyp 	IS STRING ;  
	EXEC SQL VAR chr_l_h_maker 		IS STRING ;  

   memset(chr_l_h_client_a 		,'\0',HF_CLIENT) ; 
   memset(chr_l_h_acc_class		,'\0',HF_CLN_CLASS) ; 
   memset(chr_l_h_acctyp			,'\0',HF_CLT_TYPE) ; 
   memset(chr_l_h_cractyp		,'\0',HF_CRACTYPE) ; 
   memset(chr_l_h_maker			,'\0',HF_MAKER) ; 
   memset(chr_l_str_sccloseline,'\0',DL_HOFF_SCCLOSELINE) ; 
   memset(chr_l_dcompdt			,'\0',HF_COMP_DATE) ; 


   EXEC SQL Select to_char(LR_DT,'dd/chr_mm/yyyy') into :chr_l_dcompdt:l_i_dcompdt from DL_LOCALREPDATES 
	where CLR_NAME = :int_g_regen_ind ;
	IS_ANY_ORA_ERROR 

   EXEC SQL select count(*) into :int_l_int_clsrec from DL_RUCLIENT 
	where DL_RUCLIENT.CLIENT_CLOSE_DT IS NOT NULL and  
	to_date(to_char(DL_RUCLIENT.CLIENT_CLOSE_DT,'dd/chr_mm/yyyy'),'dd/chr_mm/yyyy') > to_date(:chr_l_dcompdt,'dd/chr_mm/yyyy') and
	DL_RUCLIENT.checker_dt IS NOT NULL ;
	IS_ANY_ORA_ERROR 

   

   EXEC SQL DECLARE cscclose CURSOR FOR 
	SELECT DL_RUCLIENT.client,DL_RUCLIENT.CLTTYP,DL_RUCLIENT.maker,DL_RUCLIENT.CLT_TYP
	from DL_RUCLIENT    
	where 
	DL_RUCLIENT.CLIENT_CLOSE_DT IS NOT NULL and 
	to_date(to_char(DL_RUCLIENT.CLIENT_CLOSE_DT,'dd/chr_mm/yyyy'),'dd/chr_mm/yyyy') > to_date(:chr_l_dcompdt,'dd/chr_mm/yyyy') and 
	DL_RUCLIENT.checker_dt IS NOT NULL ;
	IS_ANY_ORA_ERROR

	EXEC SQL OPEN cscclose ;
   IS_ANY_ORA_ERROR

	for( ; ; )
	{

    EXEC SQL FETCH cscclose into :chr_l_h_client_a:l_i_account , :chr_l_h_acctyp:l_i_acctyp , 
	 :chr_l_h_maker:l_i_maker , :chr_l_h_cractyp:l_i_cractyp ;
	 IS_ANY_ORA_ERROR_CURSOR

	 if(APL_ZERO_RESULT_SET)
	  break;
   
	 if( !(strcmp(chr_l_h_cractyp,"LM") ))
	  strcpy(chr_l_str_cractyp,"LB");
	 else if( !(strcmp(chr_l_h_cractyp,"LS") ))
	  strcpy(chr_l_str_cractyp,"LR");
	 else
 	  RuPadRight(chr_l_str_cractyp,"",2);

    strcpy(chr_l_str_sccloseline," ");
	 RuPadRight(chr_l_str_sccloseline,"SCCLOSE",9);

	 strcpy(chr_l_str_temp,"");
	 strcat(chr_l_str_temp,chr_l_h_client_a);
	 strcat(chr_l_str_temp,chr_l_h_acctyp);
	 strcat(chr_l_str_temp,chr_l_str_cractyp);

	 RuPadRight(chr_l_str_sccloseline,chr_l_str_temp,25);
	 RuPadRight(chr_l_str_sccloseline,chr_l_h_maker,30);
	 RuPadRight(chr_l_str_sccloseline,"",100);
	 
	 int_l_int_noofrec++ ; 
	 
	 if( int_l_int_noofrec == 1 )
	 {
	  if( RuGenHoffHdr(p_ptr_fopenfile,"SCCLOSE","4","166","Analytical DEPO accounts for closing") != APL_SUCCESS )
	  APL_GOBACK_FAIL
    }

	 fprintf(p_ptr_fopenfile,chr_l_str_sccloseline);
	 fprintf(p_ptr_fopenfile,"\n");

    RuAddCRCFn(chr_l_str_sccloseline,&int_l_int_crc);

   } 

	EXEC SQL Close cscclose ;
	IS_ANY_ORA_ERROR

   if(int_l_int_noofrec)
	{
    if ( RuGenHoffFtr(p_ptr_fopenfile,"SCCLOSE",int_l_int_noofrec,int_l_int_crc) != APL_SUCCESS) 
	  APL_GOBACK_FAIL 
	 (*p_int_noofblocks)++ ; 
   }

	 fprintf(p_ptr_symrepfile,"\n");
	 fprintf(p_ptr_symrepfile,"%10s","");
	 fprintf(p_ptr_symrepfile,"%10s","SCCLOSE");
	 fprintf(p_ptr_symrepfile,"%10d",int_l_int_noofrec);
	 fprintf(p_ptr_symrepfile,"%15s","cruaccount");
	 fprintf(p_ptr_symrepfile,"%10d",int_l_int_clsrec);

   APL_GOBACK_SUCCESS

	

	RETURN_FAILURE:
     CO_ProcMonitor(p_logfile,"Exiting out of RuGenHoffSCCLOSE Fn Unsuccessfully\n",NULL,NULL);
     return(APL_FAILURE);

	RETURN_SUCCESS:
     CO_ProcMonitor(p_logfile,"Exiting out of RuGenHoffSCCLOSE Fn Successfully\n",NULL,NULL);
	  return(APL_SUCCESS);

 }





int RuHoffGenSCACCPERS(FILE* p_ptr_fopenfile,int *p_int_noofblocks,FILE* p_logfile,FILE *p_ptr_symrepfile,INTL_ENV_DATA_STRUCT_H * p_intl_envdatastruct_h,DEBUG_INFO_STRUCT_H** l_debug_info_ptr)
{
   struct sqlca sqlca ;
   char chr_l_h_client_a[HF_CLIENT]  			 	= APL_NULL_STRING ;
   char chr_l_h_refnum[HF_IDENTNO] 	 			 	= APL_NULL_STRING ;
   char chr_l_h_instrcode_A[HF_SEC_CD]   			 	= APL_NULL_STRING ;
   char chr_l_h_statregno[HF_STAT_REGNO]		 	= APL_NULL_STRING ;
   char chr_l_h_location[HF_LOC]  		 	= APL_NULL_STRING ;
   char chr_l_h_acc_class[HF_CLN_CLASS]		 	= APL_NULL_STRING ;
   char chr_l_h_prcode[HF_PR_CODE]	      	 	= APL_NULL_STRING ;
	char chr_l_h_acctyp[HF_CLT_TYPE] 				 	= APL_NULL_STRING ;
	char chr_l_str_cractyp[HF_CRACTYPE]			 	= APL_NULL_STRING ;
	char chr_l_h_cractyp[HF_CRACTYPE]			 		= APL_NULL_STRING ;
	char chr_l_h_maker[HF_MAKER] 				 	 	= APL_NULL_STRING ;
	char chr_l_h_loctyp[HF_LOC_TYPE] 			 	 	= APL_NULL_STRING ;
	char chr_l_str_loctyp[DL_HOFF_STRLOCTYP] 	 	 	= APL_NULL_STRING ;
	char chr_l_h_synacc[DL_HOFF_SYNACC] 	 	 			= APL_NULL_STRING ;
	char chr_l_h_synloc[DL_HOFF_SYNLOC] 	 	 			= APL_NULL_STRING ;
	char chr_l_h_sysdate[HF_CURR_DATE] 	 	 		= APL_NULL_STRING ;
   
	char chr_l_str_scaccpersline[HF_SCACCPERSLINE] = APL_NULL_STRING ;
	char chr_l_str_temp[HF_TMP] 				 	 	= APL_NULL_STRING ;
   char chr_l_dcompdt[HF_COMP_DATE] 				 	= APL_NULL_STRING ;

	int  int_l_int_noofrec 			= 0 ;
	int  int_l_int_accrec 			= 0 ;
	int  int_l_int_instrrec 			= 0 ;
	int  int_l_int_locrec 			= 0 ;
	int  int_l_int_ctr					= 0 ;
	int  int_l_int_crc 				= 0 ; 

   short l_i_account 		   = 0 ;
   short l_i_refnum	 		   = 0 ;
   short l_i_synloc 			   = 0 ;
   short l_i_synacc 			   = 0 ;
   short l_i_instr_code  		   = 0 ;
   short l_i_statregno 		   = 0 ;
   short l_i_location 		   = 0 ;
   short l_i_acc_class 		   = 0 ;
   short l_i_acctyp   			= 0 ;
   short l_i_cractyp   			= 0 ;
   short l_i_loctyp   			= 0 ;
   short l_i_prcode   			= 0 ;
	short l_i_maker 	 			= 0 ;
   short l_i_dcompdt    		= 0 ;
   short l_i_sysdate	 		   = 0 ;
   short l_i_ctr 		    		= 0 ;
   short l_i_accrec	    		= 0 ;
   short l_i_locrec	    		= 0 ;
   short l_i_instrrec	    		= 0 ;
   
   EXEC SQL VAR chr_l_h_client_a 	IS STRING ; 
   EXEC SQL VAR chr_l_h_instrcode_A   	IS STRING ; 
   EXEC SQL VAR chr_l_h_statregno IS STRING ; 
   EXEC SQL VAR chr_l_h_location 	IS STRING ; 
   EXEC SQL VAR chr_l_h_acc_class IS STRING ; 
   EXEC SQL VAR chr_l_h_prcode 	IS STRING ; 
   EXEC SQL VAR chr_l_h_acctyp 	IS STRING ; 
   EXEC SQL VAR chr_l_h_cractyp 	IS STRING ; 
   EXEC SQL VAR chr_l_h_maker 		IS STRING ; 
   EXEC SQL VAR chr_l_h_loctyp 	IS STRING ; 
   EXEC SQL VAR chr_l_h_synacc 	IS STRING ; 
   EXEC SQL VAR chr_l_h_synloc  	IS STRING ; 
   EXEC SQL VAR chr_l_h_refnum  	IS STRING ; 
   EXEC SQL VAR chr_l_h_sysdate  	IS STRING ; 

	memset(chr_l_h_client_a	,'\0',HF_CLIENT);
	memset(chr_l_h_refnum		,'\0',HF_IDENTNUMBER);
	memset(chr_l_h_instrcode_A		,'\0',HF_SEC_CD);
	memset(chr_l_h_statregno	,'\0',HF_STAT_REGNO);
	memset(chr_l_h_acc_class	,'\0',HF_CLN_CLASS);
	memset(chr_l_h_prcode		,'\0',HF_PR_CODE);
	memset(chr_l_h_acctyp 	,'\0',HF_CLT_TYPE);
	memset(chr_l_h_cractyp	,'\0',HF_CRACTYPE);
	memset(chr_l_str_cractyp	,'\0',DL_HOFF_STRCRACTYP);
	memset(chr_l_h_maker		,'\0',HF_MAKER);
	memset(chr_l_h_loctyp		,'\0',HF_LOC_TYPE);
	memset(chr_l_str_loctyp	,'\0',DL_HOFF_STRLOCTYP);
	memset(chr_l_h_synacc		,'\0',DL_HOFF_SYNACC);
	memset(chr_l_h_synloc		,'\0',DL_HOFF_SYNLOC);
	memset(chr_l_h_location	,'\0',HF_LOC);
	memset(chr_l_str_scaccpersline	,'\0',HF_SCACCPERSLINE);
	memset(chr_l_str_temp		,'\0',HF_TMP);
	memset(chr_l_dcompdt		,'\0',HF_COMP_DATE);
	memset(chr_l_h_sysdate	,'\0',HF_CURR_DATE);

        printf("\n Enetered RuHoffGenSCACCPERS ..");
        fflush(stdout);

   EXEC SQL Select to_char(LR_DT,'dd/chr_mm/yyyy') into :chr_l_dcompdt:l_i_dcompdt from DL_LOCALREPDATES 
	where CLR_NAME = :int_g_regen_ind ;
	IS_ANY_ORA_ERROR 

	EXEC SQL select to_char(SYS_DATE,'dd/chr_mm/yyyy') into :chr_l_h_sysdate:l_i_sysdate from pro_sys_date ;
	IS_ANY_ORA_ERROR

   
   
	
	

   EXEC SQL DECLARE cscaccpers1 CURSOR FOR
	SELECT UNIQUE client,instr_code,ST_REG_NO  
	from DL_RUSAFEK   
	where ( NEW_OLD_IND !='O' or NEW_OLD_IND IS NULL)  ;
	IS_ANY_ORA_ERROR

	EXEC SQL OPEN cscaccpers1 ;
   IS_ANY_ORA_ERROR

	

         printf("\n step 1 : ");
         fflush(stdout);
 
	for( ; ; )
	{
         printf("\nm step 2:");
         fflush(stdout);

    EXEC SQL FETCH cscaccpers1 into :chr_l_h_client_a:l_i_account , :chr_l_h_instrcode_A:l_i_instr_code , 
	 :chr_l_h_statregno:l_i_statregno ;
	 IS_ANY_ORA_ERROR_CURSOR

	 if(APL_ZERO_RESULT_SET)
	  break;
 
	 EXEC SQL select count(*) into :int_l_int_ctr:l_i_ctr from DL_RUSAFEK where 
	 client = :chr_l_h_client_a and instr_code = :chr_l_h_instrcode_A and  ST_REG_NO = :chr_l_h_statregno and NEW_OLD_IND = 'O' ;
	 IS_ANY_ORA_ERROR

	 if( int_l_int_ctr > 0 )
	  continue ; 

    EXEC SQL select CLT_TYP , CLTTYP , maker , SYN_CLIENT into 
	 :chr_l_h_cractyp:l_i_cractyp , :chr_l_h_acctyp:l_i_acctyp , :chr_l_h_maker:l_i_maker , :chr_l_h_synacc:l_i_synacc 
	 from DL_RUCLIENT where client = :chr_l_h_client_a  ; 
	 IS_ANY_ORA_ERROR
	 
    EXEC SQL select CLN_CLAS into :chr_l_h_acc_class:l_i_acc_class from MT_CLIENT where 
	 CLN_CODE = :chr_l_h_client_a ; 
	 IS_ANY_ORA_ERROR

  	 if( (strcmp(chr_l_h_acc_class,"2")) )
		continue ;
   
    EXEC SQL select PR_CODE into :chr_l_h_prcode:l_i_prcode from DL_RUINSTRUMENT where
	 instr_code = :chr_l_h_instrcode_A ;  
	 IS_ANY_ORA_ERROR 

	 EXEC SQL select IDENTIY_NUM into :chr_l_h_refnum:l_i_refnum  from DL_RUSRN
	 where instr_code = :chr_l_h_instrcode_A and STAT_REG_NO = :chr_l_h_statregno ;

	 IS_ANY_ORA_ERROR


         printf("\nm step 2A:");
         fflush(stdout);
	 if( !(strcmp(chr_l_h_cractyp,"LM") ))
	  strcpy(chr_l_str_cractyp,"LB");
	 else if( !(strcmp(chr_l_h_cractyp,"LS") ))
	  strcpy(chr_l_str_cractyp,"LR");
	 else
	  { 
       strcpy(chr_l_str_cractyp,"");
     }
	  

    strcpy(chr_l_str_scaccpersline," ");
	 RuPadRight(chr_l_str_scaccpersline,"SCACCPERS",9);

	 strcpy(chr_l_str_temp,chr_l_h_client_a);
	 strcat(chr_l_str_temp,chr_l_h_acctyp);
	 strcat(chr_l_str_temp,chr_l_str_cractyp);
	 strcat(chr_l_str_temp,chr_l_h_instrcode_A);
	 strcat(chr_l_str_temp,chr_l_h_refnum);
	 RuPadRight(chr_l_str_scaccpersline,chr_l_str_temp,33);

	 strcpy(chr_l_str_temp,chr_l_h_client_a);
	 strcat(chr_l_str_temp,chr_l_h_acctyp);
	 strcat(chr_l_str_temp,chr_l_str_cractyp);
	 RuPadRight(chr_l_str_scaccpersline,chr_l_str_temp,25);

	 strcpy(chr_l_str_temp,"");
	 RuPadRight(chr_l_str_temp,chr_l_h_prcode,3);
	 strcat(chr_l_str_temp,"-");
	 RuPadRight(chr_l_str_temp,chr_l_h_statregno,20);
	 RuPadRight(chr_l_str_scaccpersline,chr_l_str_temp,24);

	 RuPadRight(chr_l_str_scaccpersline,"7",25);
	 RuPadRight(chr_l_str_scaccpersline,chr_l_h_maker,30);
	 RuPadRight(chr_l_str_scaccpersline,chr_l_h_synacc,10);
	 RuPadRight(chr_l_str_scaccpersline,"OPEN",8);

	 int_l_int_noofrec++ ;

	if(int_l_int_noofrec == 1)
	{
	  if( RuGenHoffHdr(p_ptr_fopenfile,"SCACCPERS","8","166","New personal DEPO accounts") != APL_SUCCESS )
	   APL_GOBACK_FAIL
	} 

	 fprintf(p_ptr_fopenfile,chr_l_str_scaccpersline);
	 fprintf(p_ptr_fopenfile,"\n");

    RuAddCRCFn(chr_l_str_scaccpersline,&int_l_int_crc);

    

    EXEC SQL update DL_RUSAFEK set NEW_OLD_IND = 'I' , NEW_DT = to_date(:chr_l_h_sysdate,'dd/chr_mm/yyyy') 
	 where client = :chr_l_h_client_a and instr_code = :chr_l_h_instrcode_A and ST_REG_NO = :chr_l_h_statregno ;    
	 IS_ANY_ORA_ERROR

   } 

	EXEC SQL Close cscaccpers1 ;
	IS_ANY_ORA_ERROR

    printf("\n step 3:");
    fflush(stdout);

	

   
   EXEC SQL DECLARE cscaccpers2 CURSOR FOR 
	SELECT UNIQUE location_cd,instr_code,ST_REG_NO 
	from DL_RUSAFEK
	where NEW_OLD_IND !='O' or NEW_OLD_IND IS NULL or NEW_OLD_IND = 'I' ; 
	IS_ANY_ORA_ERROR

	EXEC SQL OPEN cscaccpers2 ;
   IS_ANY_ORA_ERROR

	for( ; ; )
	{
         printf("\n step 4:");
         fflush(stdout);

    EXEC SQL FETCH cscaccpers2 into :chr_l_h_location:l_i_location , :chr_l_h_instrcode_A:l_i_instr_code , 
	 :chr_l_h_statregno:l_i_statregno ;
	 IS_ANY_ORA_ERROR_CURSOR

	 if(APL_ZERO_RESULT_SET)
	  break;
   
	 EXEC SQL select count(*) into :int_l_int_ctr:l_i_ctr from DL_RUSAFEK where 
	 location_cd = :chr_l_h_location and instr_code = :chr_l_h_instrcode_A and  ST_REG_NO = :chr_l_h_statregno and NEW_OLD_IND = 'O' ;
	 IS_ANY_ORA_ERROR

	 if( int_l_int_ctr > 0 )
	  continue ; 

    EXEC SQL select LOC_TYPE , maker , SYN_LOCATION 
	 into :chr_l_h_loctyp:l_i_loctyp ,:chr_l_h_maker:l_i_maker , :chr_l_h_synloc:l_i_synloc 
	 from DL_RULOCATION where LOC = :chr_l_h_location ; 
    IS_ANY_ORA_ERROR

    EXEC SQL select PR_CODE into :chr_l_h_prcode:l_i_prcode from DL_RUINSTRUMENT where
	 instr_code = :chr_l_h_instrcode_A ;  
	 IS_ANY_ORA_ERROR  


	 EXEC SQL select IDENTIY_NUM into :chr_l_h_refnum:l_i_refnum  from DL_RUSRN
	 where instr_code = :chr_l_h_instrcode_A and STAT_REG_NO = :chr_l_h_statregno ;
	 IS_ANY_ORA_ERROR

	 if( !(strcmp(chr_l_h_location,"VTB") ))
	  strcpy(chr_l_str_loctyp,"NR");
	 else if( !(strcmp(chr_l_h_location,"MICX") ) || !(strcmp(chr_l_h_location,"NRB")) )
	  strcpy(chr_l_str_loctyp,"NB");
	 else
	  strcpy(chr_l_str_loctyp,"NN");


    strcpy(chr_l_str_scaccpersline," ");
    RuPadRight(chr_l_str_scaccpersline,"SCACCPERS",9);

	 strcpy(chr_l_str_temp,chr_l_h_location);
	 strcat(chr_l_str_temp,chr_l_h_loctyp); 
	 strcat(chr_l_str_temp,chr_l_str_loctyp);
	 strcat(chr_l_str_temp,chr_l_h_instrcode_A);
	 strcat(chr_l_str_temp,chr_l_h_refnum);
    RuPadRight(chr_l_str_scaccpersline,chr_l_str_temp,33);

	 strcpy(chr_l_str_temp,chr_l_h_location);
	 strcat(chr_l_str_temp,chr_l_h_loctyp);
	 strcat(chr_l_str_temp,chr_l_str_loctyp);
    RuPadRight(chr_l_str_scaccpersline,chr_l_str_temp,25);
   
	 strcpy(chr_l_str_temp,"");
	 RuPadRight(chr_l_str_temp,chr_l_h_prcode,3);
	 RuPadRight(chr_l_str_temp,"-",1);
	 RuPadRight(chr_l_str_temp,chr_l_h_statregno,20);
    RuPadRight(chr_l_str_scaccpersline,chr_l_str_temp,24);

    RuPadRight(chr_l_str_scaccpersline,"5",25);
    RuPadRight(chr_l_str_scaccpersline,chr_l_h_maker,30);
    RuPadRight(chr_l_str_scaccpersline,chr_l_h_synloc,10);
    RuPadRight(chr_l_str_scaccpersline,"OPEN",8);

	 int_l_int_noofrec++ ;

	if(int_l_int_noofrec == 1)
	{
	  if( RuGenHoffHdr(p_ptr_fopenfile,"SCACCPERS","8","166","New personal DEPO accounts") != APL_SUCCESS )
	   APL_GOBACK_FAIL
	} 
	 fprintf(p_ptr_fopenfile,chr_l_str_scaccpersline);
	 fprintf(p_ptr_fopenfile,"\n");

        printf("\n step 6:");
        fflush(stdout);

    RuAddCRCFn(chr_l_str_scaccpersline);
	  

    EXEC SQL update DL_RUSAFEK set NEW_OLD_IND = 'O' , NEW_DT = to_date(:chr_l_h_sysdate,'dd/chr_mm/yyyy') 
	 where location_cd = :chr_l_h_location and instr_code = :chr_l_h_instrcode_A and ST_REG_NO = :chr_l_h_statregno ;    
	 IS_ANY_ORA_ERROR

   } 

        printf("\n step 7:");
        fflush(stdout);

	EXEC SQL Close cscaccpers2 ;
	IS_ANY_ORA_ERROR

	EXEC SQL update DL_RUSAFEK set NEW_OLD_IND = 'O' where NEW_OLD_IND = 'I' ; 
	IS_ANY_ORA_ERROR 

	if(int_l_int_noofrec)
	{
    if ( RuGenHoffFtr(p_ptr_fopenfile,"SCACCPERS",int_l_int_noofrec,int_l_int_crc) != APL_SUCCESS) 
	  APL_GOBACK_FAIL 
	 (*p_int_noofblocks)++ ; 
	}


	 EXEC SQL SELECT count(*) into :int_l_int_accrec:l_i_accrec
	 from MT_CLIENT , DL_RUCLIENT where 
	 to_date(to_char(MT_CLIENT.CLN_DATEOF_INPUT,'dd/chr_mm/yyyy'),'dd/chr_mm/yyyy') > to_date(:chr_l_dcompdt,'dd/chr_mm/yyyy') 
	 and MT_CLIENT.CHECKER_DT IS NOT NULL 
	 and MT_CLIENT.CLN_BRK_ALL != 'B' and MT_CLIENT.CLN_CLAS = '2' and MT_CLIENT.CLN_CODE = DL_RUCLIENT.client ; 
	 IS_ANY_ORA_ERROR

 	 EXEC SQL SELECT count(*) into :int_l_int_locrec:l_i_locrec
	 from DL_RULOCATION where 
	 to_date(to_char(DATEOF_INPUT,'dd/chr_mm/yyyy'),'dd/chr_mm/yyyy') > to_date(:chr_l_dcompdt,'dd/chr_mm/yyyy') and 
	 checker_dt IS NOT NULL ; 
	 IS_ANY_ORA_ERROR

	 EXEC SQL SELECT count(*)  into :int_l_int_instrrec:l_i_instrrec
	 from DL_RUSRN   
	 where to_date(to_char(maker_dt,'dd/chr_mm/yyyy'),'dd/chr_mm/yyyy') > to_date(:chr_l_dcompdt,'dd/chr_mm/yyyy') 
	 and checker_dt IS NOT NULL ; 
	 IS_ANY_ORA_ERROR

	 fprintf(p_ptr_symrepfile,"\n");
	 fprintf(p_ptr_symrepfile,"%10s","");
	 fprintf(p_ptr_symrepfile,"%10s","SCACCPERS");
	 fprintf(p_ptr_symrepfile,"%10d",int_l_int_noofrec);
	 fprintf(p_ptr_symrepfile,"%15s","cruaccount");
	 fprintf(p_ptr_symrepfile,"%10d",int_l_int_accrec);
	 fprintf(p_ptr_symrepfile,"%15s","crulocation");
	 fprintf(p_ptr_symrepfile,"%10d",int_l_int_locrec);
	 fprintf(p_ptr_symrepfile,"%15s","cruinstrurity");
	 fprintf(p_ptr_symrepfile,"%10d",int_l_int_instrrec);

   APL_GOBACK_SUCCESS


	
	RETURN_FAILURE:
     CO_ProcMonitor(p_logfile,"Exiting out of RuGenHoffSCACCPERS Fn Unsuccessfully\n",NULL,NULL);
     return (APL_FAILURE);

	RETURN_SUCCESS:
     CO_ProcMonitor(p_logfile,"Exiting out of RuGenHoffSCACCPERS Fn Successfully\n",NULL,NULL);
	  return (APL_SUCCESS);

}



int RuGenURN(long *p_lng_urnseq,char *p_str_urn,DEBUG_INFO_STRUCT_H **l_debug_info_ptr)
{
  int int_l_int_juldate  = 0 ;
  int int_l_int_retval   = 0 ;
 
  (*p_lng_urnseq)++ ;
 
  CO_Rtv_JulDt(&int_l_int_juldate,l_debug_info_ptr); 

  int_l_int_retval = RuPadLeft(p_str_urn,int_l_int_juldate,p_lng_urnseq,12,'0',l_debug_info_ptr); 
  
  return(APL_SUCCESS) ;

}




int RuAddCRCFn(char *p_str_record,int *p_int_crc)
{
  int  int_l_int_ctr = 0 ;

  for( int_l_int_ctr = 0 ; int_l_int_ctr < strlen(p_str_record) ; int_l_int_ctr++ )
    if(p_str_record[int_l_int_ctr] != ' ')
     (*p_int_crc)++ ;

  return APL_SUCCESS ;

}




int RuPadRight(char *p_str_line , char *p_str_word , int p_int_num)
{
	int  int_l_int_strlen = 0 , int_l_int_ctr = 0 ;
	char *chr_l_str_newword ;

	int_l_int_strlen  = strlen(p_str_word);
	chr_l_str_newword = (char *)malloc( sizeof(char) * (abs(p_int_num) + 1) ) ;

  if( p_int_num >= 0 )
  {
	if( p_int_num <= int_l_int_strlen)
	{
	  strcat(p_str_line,p_str_word);
	  return APL_SUCCESS;
	}
	strcpy(chr_l_str_newword,p_str_word);

	for(int_l_int_ctr = int_l_int_strlen ; int_l_int_ctr < p_int_num ; int_l_int_ctr++ )
	  chr_l_str_newword[int_l_int_ctr] = ' ';

	chr_l_str_newword[int_l_int_ctr] = '\0' ;

	strcat(p_str_line,chr_l_str_newword);
	return APL_SUCCESS;
  
  }
  else  
  {
	p_int_num = -p_int_num ;

	if( p_int_num <= int_l_int_strlen)
	{
	  strcat(p_str_line,p_str_word);
	  return APL_SUCCESS;
	}

	for(int_l_int_ctr = 0 ; int_l_int_ctr < p_int_num - int_l_int_strlen ; int_l_int_ctr++ )
	  chr_l_str_newword[int_l_int_ctr] = ' ';
	  
	chr_l_str_newword[int_l_int_ctr] = '\0' ;
	
	strcat(chr_l_str_newword,p_str_word);
	strcat(p_str_line,chr_l_str_newword);

	return APL_SUCCESS;
	
  }

}




int RuPadLeft(char *p_str_urn,int p_int_juldate,long *p_lng_urnseqno,int p_int_num,char p_ch_add,DEBUG_INFO_STRUCT_H **l_debug_info_ptr)
{
   struct sqlca sqlca ;
	char chr_l_str_juldate[6];
	char chr_l_str_urnseqno[15];
	char chr_l_sys_date[HF_CURR_DATE] ;

	int int_l_int_ctr = 0 ;
   
	EXEC SQL VAR chr_l_sys_date IS STRING ;
   short l_i_sys_date = 0 ; 

	memset(chr_l_sys_date,'\0',HF_CURR_DATE);

	sprintf(chr_l_str_juldate,"%d",p_int_juldate);
	sprintf(chr_l_str_urnseqno,"%d",*p_lng_urnseqno);

   EXEC SQL select to_char(SYS_DATE,'yy') into :chr_l_sys_date:l_i_sys_date from pro_sys_date ;
	IS_ANY_ORA_ERROR

	strcpy(p_str_urn,chr_l_sys_date);

	for(int_l_int_ctr = 2 ; int_l_int_ctr <= 4 - strlen(chr_l_str_juldate) ; int_l_int_ctr++ )
	  p_str_urn[int_l_int_ctr] = p_ch_add;

	  p_str_urn[int_l_int_ctr] = '\0' ; 

	  strcat(p_str_urn,chr_l_str_juldate);

	for( int_l_int_ctr = strlen(p_str_urn) ; int_l_int_ctr <= 10  - strlen(chr_l_str_urnseqno) ; int_l_int_ctr++ )
	  p_str_urn[int_l_int_ctr] = p_ch_add;

	  p_str_urn[int_l_int_ctr] = '\0' ; 
	  strcat(p_str_urn,chr_l_str_urnseqno);

	  APL_GOBACK_SUCCESS

	
	RETURN_FAILURE:
     return (APL_FAILURE);

	RETURN_SUCCESS:
	  return (APL_SUCCESS);

}




int RuGenHoffHdr( FILE *p_ptr_fopenfile , char *p_str_blkname , char *p_str_blkqty , char *p_str_blksize , char *p_str_blktext )
{
   char chr_l_str_temp[275]  = APL_NULL_STRING ; 

   strcpy(chr_l_str_temp,"");
   RuPadRight(chr_l_str_temp,"@",1);
   RuPadRight(chr_l_str_temp,p_str_blkname,9);
   RuPadRight(chr_l_str_temp,p_str_blkqty,5);
   RuPadRight(chr_l_str_temp,p_str_blksize,5);
   RuPadRight(chr_l_str_temp,p_str_blktext,250);
	fprintf(p_ptr_fopenfile,"%s",chr_l_str_temp);
	fprintf(p_ptr_fopenfile,"\n");

	return (APL_SUCCESS) ; 
}





int RuGenHoffFtr( FILE *p_ptr_fopenfile , char *p_str_blkname , int p_blkrec , int p_blkcrc )
{
   char chr_l_str_blkrec[16] 			= APL_NULL_STRING ;
   char chr_l_str_blkcrc[16] 			= APL_NULL_STRING ;
   char chr_l_str_temp[HF_TMP] 	= APL_NULL_STRING ;

	sprintf(chr_l_str_blkrec,"%d",p_blkrec);
	sprintf(chr_l_str_blkcrc,"%d",p_blkcrc);

   strcpy(chr_l_str_temp,"");
   RuPadRight(chr_l_str_temp,"&",1);
   RuPadRight(chr_l_str_temp,p_str_blkname,9);
   RuPadRight(chr_l_str_temp,chr_l_str_blkrec,5);
   RuPadRight(chr_l_str_temp,chr_l_str_blkcrc,5);
	fprintf(p_ptr_fopenfile,"%s",chr_l_str_temp);
	fprintf(p_ptr_fopenfile,"\n");

	return (APL_SUCCESS) ; 

}




int RuReportHdr(FILE *p_logfile,int *p_int_pageno,char *p_h_sysdate)
{
  if( (*p_int_pageno) != 1 )
  fprintf(p_logfile,"--------------------------------------------------------------------------------\n");
  else
  fprintf(p_logfile,"\n");

  fprintf(p_logfile,"                            Pre Handoff Error Report\n");
  fprintf(p_logfile,"                            -------------------------\n");
  fprintf(p_logfile,p_h_sysdate);
  fprintf(p_logfile,"                            CITIBANK");
  fprintf(p_logfile,"                          Page %d\n",*p_int_pageno);
  fprintf(p_logfile,"--------------------------------------------------------------------------------\n");
  fprintf(p_logfile,"  Sr No.    A/S/L               A/S/L Code         Error Description\n");
  fprintf(p_logfile,"--------------------------------------------------------------------------------\n\n\n");
  (*p_int_pageno)++;
  return (APL_SUCCESS);
}


int CO_DB_Connection_L(char *p_username,char *p_passwd,DEBUG_INFO_STRUCT_H
**l_debug_info_ptr)
{
	struct sqlca sqlca;
   sqlca.sqlcode = 0;

	CO_ProcMonitor(APL_OUT_FILE,"Entered processtion CO_DB_Connection_L\n",NULL,NULL);

	EXEC SQL CONNECT :p_username IDENTIFIED BY :p_passwd;

	if (sqlca.sqlcode != 0)
	 APL_GOBACK_FAIL

	APL_GOBACK_SUCCESS

	RETURN_SUCCESS :
	{
	 CO_ProcMonitor(APL_OUT_FILE, "Leaving processtion CO_DB_Connection_L successfully \n",NULL,NULL);
	 return(APL_SUCCESS);
	}

	RETURN_FAILURE :
	{
	 CO_ProcMonitor(APL_OUT_FILE, "Leaving processtion CO_DB_Connection_L with failure \n",NULL,NULL);
	 return(APL_FAILURE);
	}
}




int LockRecFn15(char **argv,FILE *p_ptr_log_file,DEBUG_INFO_STRUCT_H **l_debug_info_ptr )
{
  struct sqlca               sqlca;
  sqlca.sqlcode = 0;
   char                  chr_g_restart_data[APL_RESTARTDATA_LENGTH];
    short                 g_restart_data_i;

EXEC SQL VAR chr_g_restart_data is string;

  CO_ProcMonitor(p_ptr_log_file,"Entered processtion LockRecFn15\n",NULL,NULL);

  EXEC SQL SELECT processing_status INTO :chr_g_restart_data:g_restart_data_i
  FROM SYS_BATCHPROC
  WHERE process_name = :argv[0]
  AND   proc_init = :argv[1]
  AND STARTDATE = :argv[2]
  AND status = 'started'
  FOR UPDATE OF processing_status,status;

  IS_ANY_ORA_ERROR_AND_ZERO_RESULTSET(ERR_REC_NOTFND,APL_NULL_STRING,APL_NULL_STRING,APL_NULL_STRING)

  APL_GOBACK_SUCCESS

  RETURN_SUCCESS :
  {
	CO_ProcMonitor(p_ptr_log_file,"Leaving processtion LockRecFn15 successfully \n",NULL,NULL);
	return(APL_SUCCESS);
  }

  RETURN_FAILURE :
  {
   CO_ProcMonitor(p_ptr_log_file,"Leaving processtion LockRecFn15 with failure \n",NULL,NULL);
	return(APL_FAILURE);
  }
}





int CO_Proc_Exit(char **argv,FILE *p_ptr_log_file,DEBUG_INFO_STRUCT_H **l_debug_info_ptr,int p_flg)
  {
	struct sqlca  sqlca;
	char          chr_l_buf[BUFFER_LEN] = APL_NULL_STRING;

	sqlca.sqlcode = 0;

   CO_ProcMonitor(p_ptr_log_file,"Entered processtion CO_Proc_Exit\n",NULL,NULL);
	
	if (p_flg == 0)
	{
		

      if (CO_ChkErr(*l_debug_info_ptr) != APL_SUCCESS)
		 {
			memset(chr_l_buf,APL_NULL_CHAR,BUFFER_LEN);
			sprintf(chr_l_buf,"Finished HandOff File Generation ");

			EXEC SQL UPDATE SYS_BATCHPROC
			SET stat_det = :chr_l_buf,
			status = 'completed'
			WHERE process_name = :argv[0]
			AND   proc_init = :argv[1]
			AND STARTDATE = :argv[2]
			AND status = 'started';

         IS_ANY_ORA_ERROR_AND_ZERO_RESULTSET(ERR_REC_NOTFND,APL_NULL_STRING,APL_NULL_STRING,APL_NULL_STRING)

		 }

		EXEC SQL COMMIT ;
		CO_ProcMonitor(p_ptr_log_file,"Work Committed \n",NULL,NULL);
	}
		else if (p_flg == 1)
		{
		 EXEC SQL ROLLBACK ;
		 CO_ProcMonitor(p_ptr_log_file,"Rollback done \n",NULL,NULL);
		}


   APL_GOBACK_SUCCESS
	
	RETURN_SUCCESS :
	{
	 CO_ProcMonitor(p_ptr_log_file,"Leaving processtion CO_Proc_Exit successfully \n",NULL,NULL);
	 return(APL_SUCCESS);
	}

	RETURN_FAILURE :
	{
	CO_ProcMonitor(p_ptr_log_file,"Leaving processtion CO_Proc_Exit with failure \n",NULL,NULL);
	return(APL_FAILURE);
	}

}


int convtodoschar(FILE *srcptr,FILE *destptr)
{
long i;
char chr_c1;

if (srcptr == NULL)
    return(APL_FAILURE);

if (destptr == NULL)
    return(APL_FAILURE);
/* COndition in while loop changed for AIX Migration When compiled on AIX using GCC...  The below code goes into infinate loop..  Hence changed the logic
while ((chr_c1=fgetc(srcptr))!=EOF)*/
while ((fgetc(srcptr))!=EOF)
{     
        fseek(srcptr,-1,SEEK_CUR);
        chr_c1=fget(srcptr);     
	i=0;
	while (chr_winalpha[i] != NULL)
	{  if (chr_winalpha[i] == chr_c1  )
	   {  chr_c1 = chr_dosalpha[i]; 
	      break; }
	   i++;
	}
    fprintf(destptr, "%c", chr_c1);
}

return(APL_SUCCESS);
}
