


















#include  <stdlib.h>
#include  <string.h>
#include  "CO_HostStructdef.h"
#include "Intellect_Common.h"

#define FILEPATH_LEN            70
#define FILENAME_LEN_A            80
#define DATE_LEN_A            9
#define PAGE_HDR_LENGTH     10
#define REPORT_WIDTH		      118
#define PAGE_LENGTH             55
#define APL_MAXLINE_SIZE		118


#define CLIENT_LEN_A		 11
#define CLT_NAME_LEN_A		 66
#define CLIENT_NAME_LEN		 71
#define LOC_CD_LEN_A		  5
#define LOC_DET_LEN		 36
#define LOC_NAME_LEN		 71
#define INSTR_CD_LEN_C			  9
#define SAFEK_LENGTH			 26
#define INSTR_NAME_LEN_C		 131
#define STAT_REG_NO_LEN		 21
#define INSTR_NAME_LEN_E		 71
#define DATE_LEN			  9
#define COND_LEN		  2
#define ACSEC_LOC_LEN		  2
#define CATEGORY_LEN		  3


EXEC SQL INCLUDE sqlca;

//main(int argc , char **argv )
int main(int argc,char **argv)//Changes done for AIX Migration
{
  struct sqlca sqlca ;
  DEBUG_INFO_STRUCT_H             *l_debug_info_ptr = NULL  ;
  INTL_ENV_DATA_STRUCT_H       l_intl_env_data_h ;
  FILE			    			*l_finifile   = NULL ;
  FILE			    			*l_logfile    = NULL ;
  int			    				int_l_int_num     = 0 ;
  int 			    			int_l_flg         = 0 ;
  int 			   			int_l_int_retval  = 0 ;
  char			    			**chr_l_str_parm  = NULL ;
  char			    			chr_uname[APL_USERID_LEN]  = APL_NULL_STRING ;
  char 			    			chr_custody_id_b[APL_USERID_LEN] = APL_NULL_STRING ;
  char			    			chr_passwd[APL_PASSWD_LEN] = APL_NULL_STRING ;
  char 			   			chr_l_inifile[PATH_LENGTH] = APL_NULL_STRING ;
  char 			    			chr_l_logdir[PATH_LENGTH]  = APL_NULL_STRING ;
  char			    			chr_l_buf[BUFFER_LEN]       = APL_NULL_STRING ;

  EXEC SQL VAR chr_uname  IS STRING;
  EXEC SQL VAR chr_passwd IS STRING;

  memset(&l_intl_env_data_h , NULL , sizeof(INTL_ENV_DATA_STRUCT_H)) ;

  

  strcpy(l_intl_env_data_h.usr   ,argv[3]);
  strcpy(l_intl_env_data_h.h_mode     ,argv[4]);
  strcpy(l_intl_env_data_h.processtion ,argv[5]);
  strcpy(l_intl_env_data_h.auth_req ,argv[6]);
  strcpy(l_intl_env_data_h.subprocess   ,argv[7]);
  strcpy(l_intl_env_data_h.h_process   ,argv[8]);

  strcpy(chr_l_inifile,getenv("INTL_ROOT_PATH"));
  strcat(chr_l_inifile,"intl_sun.cfg");


  if ((l_finifile = fopen(chr_l_inifile,"r")) == NULL )
   return(-1);

  

  APL_FETCH_DB_LOGIN_DETAILS(l_finifile , chr_custody_id_b , chr_uname , chr_passwd ,APL_OUT_FILE , &l_debug_info_ptr )

  

  if(CO_DB_Connection_L(chr_uname,chr_passwd,&l_debug_info_ptr)!=APL_SUCCESS)
    APL_GOBACK_FAIL

  

  if(APL_FAILURE == CO_Rtv_RptFileName("4i" ,
  				APL_LOGFILE_DESC ,
				100 ,
				argv[5] ,
				argv ,
				&l_logfile ,
				&l_debug_info_ptr) )
  {
   EXEC SQL ROLLBACK WORK RELEASE ;
	
	IS_ANY_ORA_ERROR

   APL_GOBACK_FAIL
  }

  

   EXEC SQL COMMIT WORK ;

	IS_ANY_ORA_ERROR

   if(sqlca.sqlcode)
   {
     CO_Proc_RptClose(l_logfile,&l_debug_info_ptr);
     APL_GOBACK_FAIL
   }

   CO_ProcMonitor(l_logfile , "\nPosition Recon Report\n",NULL,NULL);
   CO_ProcMonitor(l_logfile ,   "--------------------------\n",NULL,NULL);
   CO_ProcMonitor(l_logfile , "Work Committed After LogFile Creation\n",NULL,NULL);

   if(CO_RtvSysParams(&l_debug_info_ptr) != APL_SUCCESS )
   {
    CO_ProcMonitor(l_logfile , "Unable to get the system parameters : Rollback Done \n",NULL,&l_intl_env_data_h);
    CO_Proc_RptClose(l_logfile,&l_debug_info_ptr) 	;
    EXEC SQL ROLLBACK WORK RELEASE ;

	IS_ANY_ORA_ERROR

    APL_GOBACK_FAIL
   }

   int_l_int_retval = LockRecFn15(argv,l_logfile,&l_debug_info_ptr) ;

   if(int_l_int_retval != APL_SUCCESS)
    {
     CO_ProcMonitor(l_logfile, "Unable to lock BATCH_IN_PROC record - Rollback Done \n",NULL, &l_intl_env_data_h) ;
     CO_Proc_RptClose(l_logfile,&l_debug_info_ptr);
     EXEC SQL ROLLBACK WORK RELEASE;

	  IS_ANY_ORA_ERROR

     APL_GOBACK_FAIL
    }

  
  
  
  

  CO_ProcMonitor(l_logfile,"String Split processtion called\n",NULL,NULL);

  if(APL_FAILURE == CO_SplitStr(argv[9],'|',&int_l_int_num,&chr_l_str_parm))  
  {
   CO_ProcMonitor(l_logfile,"String Split Function failed\n",NULL,NULL);
   CO_Proc_RptClose(l_logfile,&l_debug_info_ptr);
   APL_GOBACK_FAIL
  }

if( int_l_int_num == 0 )
  {
   CO_ProcMonitor(l_logfile,"There were no params.Mandatory data missing\n",NULL,NULL); 
   CO_Proc_RptClose(l_logfile,&l_debug_info_ptr);
   APL_GOBACK_FAIL
  }

  

  if (strcmp(chr_l_str_parm[0] , APL_NULL_STRING) == 0)  
  {
   CO_ProcMonitor(l_logfile,"Invalid Data for Report Type.:cannot be null\n",NULL,NULL);
   CO_ProcMonitor(l_logfile,"Unsuccessful in Main\n",NULL,NULL);
   CO_Proc_RptClose(l_logfile,&l_debug_info_ptr);
   APL_GOBACK_FAIL
  }

  if (strcmp(chr_l_str_parm[1] , APL_NULL_STRING) == 0)  
  {
   CO_ProcMonitor(l_logfile,"Invalid Data for Generate Category.:cannot be null\n",NULL,NULL);
   CO_ProcMonitor(l_logfile,"Unsuccessful in Main\n",NULL,NULL);
   CO_Proc_RptClose(l_logfile,&l_debug_info_ptr);
   APL_GOBACK_FAIL
  }

  fprintf(l_logfile,"Parameters Receieved From The Front End\n");
  fprintf(l_logfile,"l_str_parm[0]  = (%s)\n",  chr_l_str_parm[0] );
  fprintf(l_logfile,"l_str_parm[1]  = (%s)\n",  chr_l_str_parm[1] );
  fprintf(l_logfile,"l_str_parm[2]  = (%s)\n",  chr_l_str_parm[2] );
  fprintf(l_logfile,"l_str_parm[3]  = (%s)\n",  chr_l_str_parm[3] );
  fprintf(l_logfile,"l_str_parm[4]  = (%s)\n",  chr_l_str_parm[4] );
  fprintf(l_logfile,"l_str_parm[5]  = (%s)\n",  chr_l_str_parm[5] );  

  if(APL_FAILURE == CO_RtvSysParams(&l_debug_info_ptr))
  {
   CO_ProcMonitor(l_logfile,"Failed to get System Parameters\n",NULL,NULL);
   CO_Proc_RptClose(l_logfile,&l_debug_info_ptr);
   APL_GOBACK_FAIL
  }

  CO_ProcMonitor(l_logfile,  "Successfully got System Parameters\n",NULL,NULL);

  int_l_int_retval = LockRecFn15(argv,l_logfile,&l_debug_info_ptr)	;

  if (int_l_int_retval != APL_SUCCESS)
   {
      CO_ProcMonitor(l_logfile,"Unable to lock BATCH_IN_PROC record - Rollback done \n",NULL,&l_intl_env_data_h);
      CO_Proc_RptClose(l_logfile,&l_debug_info_ptr);
      EXEC SQL ROLLBACK WORK RELEASE;

		IS_ANY_ORA_ERROR

      APL_GOBACK_FAIL
   }


  CO_ProcMonitor( l_logfile,   "Call the PosnreconFn processtion\n",NULL,NULL);

   
  if(PosnReconFn(argv,l_logfile,chr_l_str_parm,&l_intl_env_data_h,&l_debug_info_ptr)==APL_FAILURE)
   {
    int_l_flg = 1 ;

    /* CO_Proc_Exit(argv,l_logfile,&l_intl_env_data_h,int_l_flg) ; OPT:AIX */
    CO_Proc_Exit(argv,l_logfile,&l_debug_info_ptr,int_l_flg) ;

    if(CO_ChkErr(l_debug_info_ptr)==APL_SUCCESS)
    {
     
     CO_ProcMonitor(l_logfile,APL_NULL_STRING,&l_debug_info_ptr,&l_intl_env_data_h) ;
     CO_FreeErrLst(&l_debug_info_ptr);
    }

     CO_ProcMonitor(l_logfile,"Unsuccessful in PosnReconFn processtion \n",NULL,NULL);
     CO_Proc_RptClose(l_logfile,&l_debug_info_ptr);
     APL_GOBACK_FAIL
   }
   else
   {
    int_l_flg = 0 ;
    CO_Proc_Exit(argv,l_logfile,&l_debug_info_ptr,int_l_flg);

    if(CO_ChkErr(l_debug_info_ptr)==APL_SUCCESS)
    {
     
     CO_ProcMonitor(l_logfile,APL_NULL_STRING,&l_debug_info_ptr,&l_intl_env_data_h) ;
     CO_FreeErrLst(&l_debug_info_ptr);
    }

   CO_ProcMonitor(l_logfile,"Record Commited.\nPosnReconFn Successful ,Exiting From main.\n",NULL,NULL);
   CO_Proc_RptClose(l_logfile,&l_debug_info_ptr);
   APL_GOBACK_SUCCESS
  }

   

   RETURN_SUCCESS :
    {
     fclose(l_finifile) ;
     return(0) ;
    }
   RETURN_FAILURE :
    {
     fclose(l_finifile);
     return(-1) ;
    }
}


int PosnReconFn(char **argv,FILE *p_logfile,char **p_str_parm,INTL_ENV_DATA_STRUCT_H *p_intl_envdatastruct_h,DEBUG_INFO_STRUCT_H **l_debug_info_ptr)
{

	char chr_l_str_cond[COND_LEN]    	   	= APL_NULL_STRING; 
	char chr_l_str_acinstrloc[ACSEC_LOC_LEN]		= APL_NULL_STRING;


   FILE  *l_repfile      	    = NULL;
   INTL_REPT_STRUCT_H *l_intl_rept_struct_ha = NULL;

	short l_i_sysdate     = 0 ;


	int int_l_int_pageno = 1;	
	int int_l_nrow = 0;			
	int int_ctr = 0;
	int int_dash_ctr = 1;

	CO_ProcMonitor(p_logfile,"Entered processtion PosnReconFn \n",NULL,p_intl_envdatastruct_h);

	strcpy(chr_l_str_cond   , p_str_parm[0]);
	strcpy(chr_l_str_acinstrloc,p_str_parm[1]);


	IS_ANY_ORA_ERROR

	if (APL_ZERO_RESULT_SET)
   	APL_GOBACK_FAIL


 	if(APL_FAILURE == CO_Rtv_RptFileName("RR" ,
                                "Position Recon Report" ,
                                100 ,
                                argv[5] ,
                                argv ,
                                &l_repfile ,
                                l_debug_info_ptr) )
  	{
   	EXEC SQL ROLLBACK WORK RELEASE ;

		IS_ANY_ORA_ERROR
		CO_ProcMonitor(p_logfile,"  CO_Rtv_RptFileName failed \n",NULL,p_intl_envdatastruct_h);

   	APL_GOBACK_FAIL
  	}

  	

   EXEC SQL COMMIT WORK ;

	IS_ANY_ORA_ERROR


   if(sqlca.sqlcode)
   {
     CO_Proc_RptClose(l_repfile,l_debug_info_ptr);
	  
	  CO_ProcMonitor(p_logfile," Commit failed and so exiting \n",NULL,p_intl_envdatastruct_h);
     APL_GOBACK_FAIL
   }

  

	if (chr_l_str_cond[0] == '0')	
	{
	
		
			
		CO_ProcMonitor(p_logfile," calling the Dsafekrepfn funtion \n",NULL,p_intl_envdatastruct_h);

		if(Dsafekrepfn(p_logfile,l_repfile,p_str_parm,&int_l_int_pageno,&int_l_nrow,&p_intl_envdatastruct_h,&l_debug_info_ptr)==APL_FAILURE)
			{
			
					CO_ProcMonitor(p_logfile," DSafekrepfn returned with a failure \n",NULL,p_intl_envdatastruct_h);
			APL_GOBACK_FAIL
			}	
			
				CO_ProcMonitor(p_logfile," calling the Drrmmrepfn funtion \n",NULL,p_intl_envdatastruct_h);

		if(Drrmmrepfn(p_logfile,l_repfile,p_str_parm,&int_l_int_pageno,&int_l_nrow,&p_intl_envdatastruct_h,&l_debug_info_ptr)==APL_FAILURE)
			{
				
				CO_ProcMonitor(p_logfile," Drrmmrepfn returned with a failure \n",NULL,p_intl_envdatastruct_h);
			APL_GOBACK_FAIL
			}
		
	}

	else if(chr_l_str_cond[0] == '1')  
	{
		
      CO_ProcMonitor(p_logfile," calling the Dsafekrepfn funtion1 \n",NULL,p_intl_envdatastruct_h);

		if(Dsafekrepfn(p_logfile,l_repfile,p_str_parm,&int_l_int_pageno,&int_l_nrow,&p_intl_envdatastruct_h,&l_debug_info_ptr)==APL_FAILURE)		
			{
				
            CO_ProcMonitor(p_logfile,"Dsafekrepfn returned with a failure \n",NULL,p_intl_envdatastruct_h);
			APL_GOBACK_FAIL
			}

	}

	else if(chr_l_str_cond[0] == '2')  
	{
		
      CO_ProcMonitor(p_logfile," calling the Drrmmrepfn funtion \n",NULL,p_intl_envdatastruct_h);

		if(Drrmmrepfn(p_logfile,l_repfile,p_str_parm,&int_l_int_pageno,&int_l_nrow,&p_intl_envdatastruct_h,&l_debug_info_ptr)==APL_FAILURE)
			{
				
            CO_ProcMonitor(p_logfile,"Drrmmrepfn returned with a failure \n",NULL,p_intl_envdatastruct_h);
				APL_GOBACK_FAIL
			}

	}

	EXEC SQL COMMIT ; 
        IS_ANY_ORA_ERROR 

	CO_ProcMonitor(p_logfile,"Work Committed \n",NULL,NULL);
 

	

  	APL_GOBACK_SUCCESS
   
  RETURN_SUCCESS :
  	{       CO_Proc_RptClose(l_repfile,l_debug_info_ptr);
           CO_ProcMonitor(p_logfile,"Successful in PosnReconFn processtion\n",NULL,NULL);
           CO_ProcMonitor(p_logfile, "Errors if Any : ", l_debug_info_ptr, p_intl_envdatastruct_h);
           CO_FreeErrLst(l_debug_info_ptr);
           return(APL_SUCCESS);
   }
   	
	RETURN_FAILURE :
   {
			 CO_Proc_RptClose(l_repfile,l_debug_info_ptr);
          CO_ProcMonitor(p_logfile,"Failed in PosnReconFn processtion\n",NULL,NULL);
          CO_ProcMonitor(p_logfile, "Errors : ", l_debug_info_ptr, p_intl_envdatastruct_h);
          CO_FreeErrLst(l_debug_info_ptr);
          return(APL_FAILURE);
	}


} 




int Dsafekrepfn(FILE *p_logfile,FILE *p_repfile,char **p_str_parm,int *p_int_pageno, int *p_nrow,INTL_ENV_DATA_STRUCT_H *p_intl_envdatastruct_h,DEBUG_INFO_STRUCT_H **l_debug_info_ptr)
{
	fprintf(p_logfile,"Entered Function Dsafekrepfn\n");	
	if (strcmp(p_str_parm[1],"0") == 0) 	
	{
		
      fprintf(p_logfile," calling the DoskAcAll 	funtion \n");
			if(DoskAcAll(p_logfile,p_repfile,p_str_parm,p_int_pageno, p_nrow,&p_intl_envdatastruct_h,&l_debug_info_ptr)==APL_FAILURE)
				{
					
      			fprintf(p_logfile," DoskAcAll returned with a failure \n");
					APL_GOBACK_FAIL
				}
	}
	else if (strcmp(p_str_parm[1],"1") == 0)  
	{
			
      fprintf(p_logfile," calling the DoskLoAll  funtion \n");
			if(DoskLoAll(p_logfile,p_repfile,p_str_parm,p_int_pageno, p_nrow,&p_intl_envdatastruct_h,&l_debug_info_ptr)==APL_FAILURE)
				{
               
               fprintf(p_logfile," DoskLoAll returned with a failure \n");
					APL_GOBACK_FAIL
				}
	}
	else if (strcmp(p_str_parm[1],"2") == 0) 
	{
			
      fprintf(p_logfile," calling the DoskInstrAll funtion \n");
			if(DoskInstrAll(p_logfile,p_repfile,p_str_parm,p_int_pageno,p_nrow,&p_intl_envdatastruct_h,&l_debug_info_ptr)==APL_FAILURE)
				{
               
               fprintf(p_logfile,"  DoskInstrAll returned with a failure \n");
				APL_GOBACK_FAIL
				}
	}
	APL_GOBACK_SUCCESS

	

	RETURN_FAILURE:
		CO_ProcMonitor(p_logfile,"Exiting out of Dsafekrepfn Unsuccessfully\n",NULL,NULL);
		return (APL_FAILURE);

	 RETURN_SUCCESS:
		 CO_ProcMonitor(p_logfile,"Exiting out of Dsafekrepfn Successfully\n",NULL,NULL);
		 return (APL_SUCCESS);

} 



int Drrmmrepfn(FILE *p_logfile,FILE *p_repfile,char **p_str_parm,int *p_int_pageno, int *p_nrow,INTL_ENV_DATA_STRUCT_H *p_intl_envdatastruct_h,DEBUG_INFO_STRUCT_H **l_debug_info_ptr)
{
	fprintf(p_logfile,"Entered Function Drrmmrepfn\n");
	if (strcmp(p_str_parm[1],"0") == 0) 	
	{
			
      CO_ProcMonitor(p_logfile," calling the DorrmAcAll funtion \n",NULL,p_intl_envdatastruct_h);
			if(DorrmAcAll(p_logfile,p_repfile,p_str_parm,p_int_pageno,p_nrow,&p_intl_envdatastruct_h,&l_debug_info_ptr)==APL_FAILURE)	
			{
				
      		CO_ProcMonitor(p_logfile,"  DorrmAcAll returned with a failure \n",NULL,p_intl_envdatastruct_h);
				APL_GOBACK_FAIL
			}
	}
	else if (strcmp(p_str_parm[1],"1") == 0)  
	{
			
      CO_ProcMonitor(p_logfile," calling the DorrmLoAll processtion  \n",NULL,p_intl_envdatastruct_h);
			if(DorrmLoAll(p_logfile,p_repfile,p_str_parm,p_int_pageno,p_nrow,&p_intl_envdatastruct_h,&l_debug_info_ptr)==APL_FAILURE)	
			{
				
            CO_ProcMonitor(p_logfile,"  DorrmLoAll returned with a failure \n",NULL,p_intl_envdatastruct_h);
				APL_GOBACK_FAIL
			}
	}
	else if (strcmp(p_str_parm[1],"2") == 0)  
	{
			
      CO_ProcMonitor(p_logfile," calling the  DorrmInstrAll funtion \n",NULL,p_intl_envdatastruct_h);
			if(DorrmInstrAll(p_logfile,p_repfile,p_str_parm,p_int_pageno,p_nrow,&p_intl_envdatastruct_h,&l_debug_info_ptr)==APL_FAILURE)		
			{
				
            CO_ProcMonitor(p_logfile,"   DorrmInstrAll  returned with a failure \n",NULL,p_intl_envdatastruct_h);

				APL_GOBACK_FAIL
			}
	}
	APL_GOBACK_SUCCESS

	

	RETURN_FAILURE:
		CO_ProcMonitor(p_logfile,"Exiting out of Drrmmrepfn Unsuccessfully\n",NULL,NULL);
		return (APL_FAILURE);

	 RETURN_SUCCESS:
		 CO_ProcMonitor(p_logfile,"Exiting out of Drrmmrepfn Successfully\n",NULL,NULL);
		 return (APL_SUCCESS);

} 



int DoskAcAll(FILE *p_logfile,FILE *p_repfile,char **p_str_parm,int *p_int_pageno, int *p_nrow,INTL_ENV_DATA_STRUCT_H *p_intl_envdatastruct_h,DEBUG_INFO_STRUCT_H **l_debug_info_ptr)
{
	char chr_l_h_client_a[APL_CLIENT_LENGTH] = APL_NULL_STRING ;
	char chr_l_h_instrcode_A[APL_INSTRUMENTCODE_LEN] = APL_NULL_STRING;
	char chr_l_h_location[LOC_CD_LEN_A] = APL_NULL_STRING;	
	char schedule[CATEGORY_LEN] = APL_NULL_STRING;
	char chr_l_h_passdate[APL_DATE_LEN] = APL_NULL_STRING; 

	char chr_l_h_prevclient[APL_CLIENT_LENGTH] = APL_NULL_STRING;

	double l_dbl_val_rectotlval = 0.0; 
	double l_dbl_val_deltotlval = 0.0; 
	double l_dbl_naccredit_indotlval = 0.0; 	 
	
	double l_dbl_safekeep_pos = 0.0;
	double l_dbl_val_rec = 0.0;
	double l_dbl_val_del = 0.0;

	short l_i_account = 0 ;
	short l_i_instr_code = 0;
	short l_i_safek = 0;
	short l_i_confrec = 0;
	short l_i_confdel = 0;
	
	int int_l_nodataflg = 0;  
	int int_l_new_flg = 0;  
	int int_prnt_posn_flg = 0;  
	int int_retval = 0;
	int int_l_recpresent = 0; 
	int int_l_rep_hdr_flg = 0;
	char chr_l_sys_date[APL_DATE_LEN];
				int int_l_diff = 0;
				int int_l_cursor  = 0;

	EXEC SQL VAR chr_l_h_client_a IS STRING ;
	EXEC SQL VAR chr_l_h_instrcode_A IS STRING;
	
	fprintf(p_logfile,"Entered Function DoskAcAll\n");

	if (strcmp(p_str_parm[2]," ") == 0) 	
	{
		strcpy(schedule,"AC");
		

		if (strcmp(p_str_parm[5], "") == 0)
		{
			int_l_cursor = 1;
			 EXEC SQL DECLARE curr_ACsafek1  CURSOR FOR
			SELECT CLIENT,INSTR_CODE,SUM(SAFEKEEP_POS),SUM(VAL_REC),SUM(VAL_DEL) 
			FROM DL_SAFEK
			GROUP BY CLIENT,INSTR_CODE;

			IS_ANY_ORA_ERROR
		}
		else
		{

			strcpy(chr_l_h_passdate, p_str_parm[5]);
			chr_l_h_passdate[19]='\0';


			memset(chr_l_sys_date, APL_NULL_CHAR, APL_DATE_LEN);
			 int_retval = 0;
			 int_retval =  CO_RtvSysDt(chr_l_sys_date, l_debug_info_ptr);

			if (int_retval != APL_SUCCESS)
			{
				CO_ProcMonitor(p_logfile,"Error in getting the system chr_date\n",NULL,NULL);
				APL_GOBACK_FAIL
			}
			int_retval = 0;
		   int_retval =  CO_Pro_DateComp(chr_l_h_passdate, chr_l_sys_date, &int_l_diff, l_debug_info_ptr) ;

			if (int_retval != APL_SUCCESS)
			{
				CO_ProcMonitor(p_logfile,"Error in comparing the dates\n", NULL, NULL);
				APL_GOBACK_FAIL
			}
			fprintf(p_logfile,"value of chr_l_h_passdate is %s\n", chr_l_h_passdate);
			fprintf(p_logfile,"value of chr_l_sys_date is %s\n", chr_l_sys_date);
			fprintf(p_logfile,"value of  int_l_diff is %d\n",int_l_diff);
			/*fprintf(p_logfile,"value of  &int_l_diff is %d\n",&int_l_diff);Changes done for AIX Migration*/

			if ( int_l_diff == 0 )
			{
				fprintf(p_logfile,"current date\n");  // AIX -Warnings Removal
				int_l_cursor = 2;
			 	EXEC SQL DECLARE curr_ACsafek2 CURSOR FOR
				SELECT CLIENT,INSTR_CODE,SUM(SAFEKEEP_POS),SUM(VAL_REC),SUM(VAL_DEL)
				FROM DL_SAFEK
			GROUP BY CLIENT,INSTR_CODE;
				
				IS_ANY_ORA_ERROR
			}
			else if ( int_l_diff > 0)
			{
				int_l_cursor = 3;
				fprintf(p_logfile,"diff> current date\n");    // AIX -Warnings Removal
				EXEC SQL DECLARE curr_ACsafek3 CURSOR FOR
				SELECT CLIENT,INSTR_CODE,SUM(SAFEKEEP_POS),SUM(VAL_REC),SUM(VAL_DEL)
				FROM DL_HISSAFEK WHERE POSIT_DATE = :chr_l_h_passdate
				GROUP BY CLIENT,INSTR_CODE;

				IS_ANY_ORA_ERROR
			}
		}


		if (int_l_cursor == 1) 
		{
			EXEC SQL OPEN curr_ACsafek1;
		}
		else if (int_l_cursor == 2)
		{
			EXEC SQL OPEN curr_ACsafek2;
		}
		else if (int_l_cursor == 3)
		{
			EXEC SQL OPEN curr_ACsafek3;
		}

		IS_ANY_ORA_ERROR
		
		for (;;)
		{

			memset(chr_l_h_client_a,APL_NULL_CHAR,sizeof(APL_CLIENT_LENGTH));
			memset(chr_l_h_instrcode_A,APL_NULL_CHAR,sizeof(APL_INSTRUMENTCODE_LEN));
			if (int_l_cursor == 1)
			{
				EXEC SQL FETCH curr_ACsafek1 INTO :chr_l_h_client_a:l_i_account,:chr_l_h_instrcode_A:l_i_instr_code,:l_dbl_safekeep_pos:l_i_safek,:l_dbl_val_rec:l_i_confrec,l_dbl_val_del:l_i_confdel;
			}
			else if (int_l_cursor == 2)
			{
				EXEC SQL FETCH curr_ACsafek2 INTO :chr_l_h_client_a:l_i_account,:chr_l_h_instrcode_A:l_i_instr_code,:l_dbl_safekeep_pos:l_i_safek,:l_dbl_val_rec:l_i_confrec,l_dbl_val_del:l_i_confdel;
			}
			else if (int_l_cursor == 3)
			{
				EXEC SQL FETCH curr_ACsafek3 INTO :chr_l_h_client_a:l_i_account,:chr_l_h_instrcode_A:l_i_instr_code,:l_dbl_safekeep_pos:l_i_safek,:l_dbl_val_rec:l_i_confrec,l_dbl_val_del:l_i_confdel;
			}
			IS_ANY_ORA_ERROR
			if (!sqlca.sqlerrd[2])
				int_l_nodataflg = 1;
			
			else
				int_l_recpresent = 1;

			if ((APL_ZERO_RESULT_SET) && (int_l_recpresent == 1))
			{
				if(PrnTotPosn(p_logfile,p_repfile,&l_dbl_naccredit_indotlval,&l_dbl_val_rectotlval,&l_dbl_val_deltotlval,p_nrow,&p_intl_envdatastruct_h,&l_debug_info_ptr)==APL_FAILURE)
					APL_GOBACK_FAIL
				int_l_recpresent = 0;
				APL_GOBACK_SUCCESS
			}
	
			if (strcmp(chr_l_h_prevclient,chr_l_h_client_a) != 0 )
			{
				int_l_new_flg = 1;	

				if (strcmp(chr_l_h_prevclient,"") != 0)
				{
					int_prnt_posn_flg = 1;	
					 
				
					if(PrnTotPosn(p_logfile,p_repfile,&l_dbl_naccredit_indotlval,&l_dbl_val_rectotlval,&l_dbl_val_deltotlval,p_nrow,&p_intl_envdatastruct_h,&l_debug_info_ptr)==APL_FAILURE)
						APL_GOBACK_FAIL
					l_dbl_naccredit_indotlval = 0.0; 	
					l_dbl_val_rectotlval = 0.0;
					l_dbl_val_deltotlval = 0.0;
					
					int_prnt_posn_flg = 0;		
				}
				else
				{
					int_l_rep_hdr_flg = 1;
					int_retval = 0;
					int_retval = PrnRepHdrFn(p_logfile, p_repfile,p_int_pageno, p_nrow, p_str_parm, &l_debug_info_ptr);
					if (int_retval != APL_SUCCESS)
					{
						CO_ProcMonitor(p_logfile,"Unable to Write the Header for Generate By Customer\n",NULL,NULL);
						APL_GOBACK_FAIL
					}
				}
			}
			if(DoRrsfkiterations(schedule,int_l_nodataflg,int_l_new_flg,&l_dbl_naccredit_indotlval,&l_dbl_val_rectotlval,&l_dbl_val_deltotlval,p_int_pageno,p_nrow,chr_l_h_client_a,chr_l_h_instrcode_A,chr_l_h_location,l_dbl_safekeep_pos,l_dbl_val_rec,l_dbl_val_del,p_logfile,p_repfile,p_str_parm,&p_intl_envdatastruct_h,&l_debug_info_ptr)==APL_FAILURE)
					APL_GOBACK_FAIL
			
			int_l_new_flg = 0;					
			int_l_rep_hdr_flg = 0;
			if (int_l_nodataflg == 1)
				APL_GOBACK_SUCCESS
			strcpy(chr_l_h_prevclient,chr_l_h_client_a);
		}
		if (int_l_cursor == 1)
		{
			EXEC SQL CLOSE curr_ACsafek1;
		}
		else if (int_l_cursor == 2)
		{
			EXEC SQL CLOSE curr_ACsafek2;
		}
		else if (int_l_cursor == 3)
		{
		   EXEC SQL CLOSE curr_ACsafek3;	
		}

		IS_ANY_ORA_ERROR

		int_l_cursor = 0;

	}
	
	else 
	{
		strcpy(schedule,"AC");
		strcpy(chr_l_h_client_a, p_str_parm[2]);
		int_l_new_flg = 1;  

		int_l_rep_hdr_flg = 1;
		int_retval = 0;
		int_retval = PrnRepHdrFn(p_logfile, p_repfile,p_int_pageno, p_nrow, p_str_parm, &l_debug_info_ptr);
		if (int_retval != APL_SUCCESS)
		{
			CO_ProcMonitor(p_logfile,"Unable to Write the Header for Generate By Customer\n",NULL,NULL);
			APL_GOBACK_FAIL
		}

		
		if (strcmp(p_str_parm[5], "") == 0)
		{
			int_l_cursor = 1;
			EXEC SQL DECLARE curr_ACsafek11 CURSOR FOR
			SELECT CLIENT,INSTR_CODE,SUM(SAFEKEEP_POS),SUM(VAL_REC),SUM(VAL_DEL) 
			FROM DL_SAFEK
			WHERE CLIENT= :chr_l_h_client_a
			GROUP BY CLIENT,INSTR_CODE;
		}
		else
		{
			strcpy(chr_l_h_passdate, p_str_parm[5]);
			chr_l_h_passdate[19]='\0';

         memset(chr_l_sys_date, APL_NULL_CHAR, APL_DATE_LEN);
          int_retval = 0;
          int_retval =  CO_RtvSysDt(chr_l_sys_date, l_debug_info_ptr);

         if (int_retval != APL_SUCCESS)
         {
            CO_ProcMonitor(p_logfile,"Error in getting the system chr_date\n",NULL,NULL);
            APL_GOBACK_FAIL
         }
         int_retval = 0;
         int_retval =  CO_Pro_DateComp(chr_l_h_passdate, chr_l_sys_date, &int_l_diff, l_debug_info_ptr); 

         if (int_retval != APL_SUCCESS)
         {
            CO_ProcMonitor(p_logfile,"Error in comparing the dates\n", NULL, NULL);
            APL_GOBACK_FAIL
         }
			if ( int_l_diff == 0 )
         {
				int_l_cursor = 2;
				EXEC SQL DECLARE curr_ACsafek12 CURSOR FOR
         	SELECT CLIENT,INSTR_CODE,SUM(SAFEKEEP_POS),SUM(VAL_REC),SUM(VAL_DEL)
         	FROM DL_SAFEK
         	WHERE CLIENT= :chr_l_h_client_a
         	GROUP BY CLIENT,INSTR_CODE;

				IS_ANY_ORA_ERROR
			}
			else if ( int_l_diff > 0)
         {
				int_l_cursor = 3;
				 EXEC SQL DECLARE curr_ACsafek13 CURSOR FOR
            SELECT CLIENT,INSTR_CODE,SUM(SAFEKEEP_POS),SUM(VAL_REC),SUM(VAL_DEL)
            FROM DL_HISSAFEK 
				WHERE CLIENT = :chr_l_h_client_a AND
				POSIT_DATE = :chr_l_h_passdate
				GROUP BY CLIENT,INSTR_CODE;

				IS_ANY_ORA_ERROR

			}
		}
		IS_ANY_ORA_ERROR

		if (int_l_cursor == 1)
		{
			EXEC SQL OPEN curr_ACsafek11;		
		}
		else if (int_l_cursor == 2)
		{
			EXEC SQL OPEN curr_ACsafek12;
		}
		else if (int_l_cursor == 3)
		{
			EXEC SQL OPEN curr_ACsafek13;
		}

	
		IS_ANY_ORA_ERROR

		for (;;)
		{
 
			
			memset(chr_l_h_client_a,APL_NULL_CHAR,sizeof(APL_CLIENT_LENGTH));
			memset(chr_l_h_instrcode_A,APL_NULL_CHAR,sizeof(APL_INSTRUMENTCODE_LEN));

			if (int_l_cursor == 1)
			{
				EXEC SQL FETCH curr_ACsafek11 INTO :chr_l_h_client_a:l_i_account,:chr_l_h_instrcode_A:l_i_instr_code,:l_dbl_safekeep_pos:l_i_safek,:l_dbl_val_rec:l_i_confrec,:l_dbl_val_del:l_i_confdel;
			}
			else if (int_l_cursor == 2)
			{
				EXEC SQL FETCH curr_ACsafek12 INTO :chr_l_h_client_a:l_i_account,:chr_l_h_instrcode_A:l_i_instr_code,:l_dbl_safekeep_pos:l_i_safek,:l_dbl_val_rec:l_i_confrec,:l_dbl_val_del:l_i_confdel;
			}
			else if (int_l_cursor == 3)
			{
				EXEC SQL FETCH curr_ACsafek13 INTO :chr_l_h_client_a:l_i_account,:chr_l_h_instrcode_A:l_i_instr_code,:l_dbl_safekeep_pos:l_i_safek,:l_dbl_val_rec:l_i_confrec,:l_dbl_val_del:l_i_confdel;
			}

			IS_ANY_ORA_ERROR
			if (!sqlca.sqlerrd[2])
				int_l_nodataflg = 1;
			else if(APL_ZERO_RESULT_SET)
				break;

			if(DoRrsfkiterations(schedule,int_l_nodataflg,int_l_new_flg,&l_dbl_naccredit_indotlval,&l_dbl_val_rectotlval,&l_dbl_val_deltotlval,p_int_pageno,p_nrow,chr_l_h_client_a,chr_l_h_instrcode_A,chr_l_h_location,l_dbl_safekeep_pos,l_dbl_val_rec,l_dbl_val_del,p_logfile,p_repfile,p_str_parm,&p_intl_envdatastruct_h,&l_debug_info_ptr)==APL_FAILURE)
					APL_GOBACK_FAIL
			
			int_l_new_flg = 0;	
			int_l_rep_hdr_flg = 0;
			if (int_l_nodataflg == 1)
				APL_GOBACK_SUCCESS
		}
	
		
		if(PrnTotPosn(p_logfile,p_repfile,&l_dbl_naccredit_indotlval,&l_dbl_val_rectotlval,&l_dbl_val_deltotlval,p_nrow,&p_intl_envdatastruct_h,&l_debug_info_ptr)==APL_FAILURE)
			APL_GOBACK_FAIL
		
		l_dbl_naccredit_indotlval = 0.0; 	
		l_dbl_val_rectotlval = 0.0;
		l_dbl_val_deltotlval = 0.0;
		if (int_l_cursor == 1)
		{
			EXEC SQL CLOSE curr_ACsafek11;
		}
		else if (int_l_cursor == 2)
		{
			EXEC SQL CLOSE curr_ACsafek12;
		}
		else if (int_l_cursor == 3)
		{
			EXEC SQL CLOSE curr_ACsafek13;
		}

		int_l_cursor = 0;

		IS_ANY_ORA_ERROR

	}

	APL_GOBACK_SUCCESS

	

	RETURN_FAILURE:
		CO_ProcMonitor(p_logfile,"Exiting out of DoskAcAll Unsuccessfully\n",NULL,NULL);
		return (APL_FAILURE);

	 RETURN_SUCCESS:
		 CO_ProcMonitor(p_logfile,"Exiting out of DoskAcAll Successfully\n",NULL,NULL);
		 return (APL_SUCCESS);

} 



int DoskInstrAll(FILE *p_logfile,FILE *p_repfile,char **p_str_parm,int *p_int_pageno, int *p_nrow,INTL_ENV_DATA_STRUCT_H *p_intl_envdatastruct_h,DEBUG_INFO_STRUCT_H **l_debug_info_ptr)
{
	char chr_l_h_client_a[APL_CLIENT_LENGTH] = APL_NULL_STRING ;
	char chr_l_h_instrcode_A[APL_INSTRUMENTCODE_LEN] = APL_NULL_STRING;
	char chr_l_h_location[LOC_CD_LEN_A] = APL_NULL_STRING;	
	char schedule[CATEGORY_LEN] = APL_NULL_STRING;
	char chr_l_h_passdate[APL_DATE_LEN] = APL_NULL_STRING; 

	char chr_l_h_previnstrcode[APL_INSTRUMENTCODE_LEN] = APL_NULL_STRING;

	double l_dbl_val_rectotlval = 0.0; 	
	double l_dbl_naccredit_indotlval = 0.0; 	 
	double l_dbl_val_deltotlval = 0.0; 	
	
	double l_dbl_safekeep_pos = 0.0;
	double l_dbl_val_rec = 0.0;
	double l_dbl_val_del = 0.0;
	
	short l_i_account = 0 ;
	short l_i_instr_code = 0;
	short l_i_safek = 0;
	short l_i_confrec = 0;
	short l_i_confdel = 0;
	
	int int_l_nodataflg = 0;  
	int int_l_new_flg = 0;  
	int int_prnt_posn_flg = 0;  
	int int_retval = 0;
	int int_l_recpresent = 0; 
	int int_l_rep_hdr_flg = 0;
	char chr_l_sys_date[APL_DATE_LEN];
	int int_l_diff = 0;
	int int_l_cursor = 0;


	EXEC SQL VAR chr_l_h_instrcode_A IS STRING;
	EXEC SQL VAR chr_l_h_client_a IS STRING ;
	fprintf(p_logfile,"Entered Function DoskInstrAll\n");

	if (strcmp(p_str_parm[4]," ") == 0) 	
	{
		strcpy(schedule,"SE");
		
		if (strcmp(p_str_parm[5], "") == 0)
      {
			int_l_cursor = 1;
	
			EXEC SQL DECLARE curr_SEsafek1 CURSOR FOR
			SELECT INSTR_CODE,CLIENT,SUM(SAFEKEEP_POS),SUM(VAL_REC),SUM(VAL_DEL) 
			FROM DL_SAFEK
			GROUP BY INSTR_CODE,CLIENT;
		}
		else
		{
			strcpy(chr_l_h_passdate, p_str_parm[5]);
				chr_l_h_passdate[19]='\0';

         memset(chr_l_sys_date, APL_NULL_CHAR, APL_DATE_LEN);
          int_retval = 0;
          int_retval =  CO_RtvSysDt(chr_l_sys_date, l_debug_info_ptr);

         if (int_retval != APL_SUCCESS)
         {
            CO_ProcMonitor(p_logfile,"Error in getting the system chr_date\n",NULL,NULL);
            APL_GOBACK_FAIL
         }
         int_retval = 0;
         int_retval =  CO_Pro_DateComp(chr_l_h_passdate, chr_l_sys_date, &int_l_diff, l_debug_info_ptr); 

         if (int_retval != APL_SUCCESS)
         {
            CO_ProcMonitor(p_logfile,"Error in comparing the dates\n", NULL, NULL);
            APL_GOBACK_FAIL
         }
			if ( int_l_diff == 0 )
         {
				int_l_cursor = 2;
				EXEC SQL DECLARE curr_SEsafek2 CURSOR FOR
         	SELECT INSTR_CODE,CLIENT,SUM(SAFEKEEP_POS),SUM(VAL_REC),SUM(VAL_DEL)
         	FROM DL_SAFEK
        		GROUP BY INSTR_CODE,CLIENT;
			}
			else if ( int_l_diff > 0 )
			{
				int_l_cursor = 3;
				EXEC SQL DECLARE curr_SEsafek3 CURSOR FOR
				SELECT INSTR_CODE,CLIENT,SUM(SAFEKEEP_POS),SUM(VAL_REC),SUM(VAL_DEL)
				FROM DL_HISSAFEK WHERE POSIT_DATE =:chr_l_h_passdate
				 GROUP BY INSTR_CODE,CLIENT;
			}
		}

		IS_ANY_ORA_ERROR

		if (int_l_cursor == 1)
		{
			EXEC SQL OPEN curr_SEsafek1;
		}
		else if (int_l_cursor == 2)
		{
			EXEC SQL OPEN curr_SEsafek2;
		}
		else if (int_l_cursor == 3)
		{
			EXEC SQL OPEN curr_SEsafek3;
		}

		IS_ANY_ORA_ERROR	

		for (;;)
		{

			memset(chr_l_h_client_a,APL_NULL_CHAR,sizeof(APL_CLIENT_LENGTH));
			memset(chr_l_h_instrcode_A,APL_NULL_CHAR,sizeof(APL_INSTRUMENTCODE_LEN));


			if (int_l_cursor == 1)
			{
				EXEC SQL FETCH curr_SEsafek1 INTO :chr_l_h_instrcode_A:l_i_instr_code,:chr_l_h_client_a:l_i_account,:l_dbl_safekeep_pos:l_i_safek,l_dbl_val_rec:l_i_confrec,:l_dbl_val_del:l_i_confdel;
				
			}
			else if (int_l_cursor == 2)
			{
				EXEC SQL FETCH curr_SEsafek2 INTO :chr_l_h_instrcode_A:l_i_instr_code,:chr_l_h_client_a:l_i_account,:l_dbl_safekeep_pos:l_i_safek,l_dbl_val_rec:l_i_confrec,:l_dbl_val_del:l_i_confdel;
			}
			else if (int_l_cursor == 3)
			{
				EXEC SQL FETCH curr_SEsafek3 INTO :chr_l_h_instrcode_A:l_i_instr_code,:chr_l_h_client_a:l_i_account,:l_dbl_safekeep_pos:l_i_safek,l_dbl_val_rec:l_i_confrec,:l_dbl_val_del:l_i_confdel;
			}

			IS_ANY_ORA_ERROR
			if (!sqlca.sqlerrd[2])
				int_l_nodataflg = 1;
			
			else
				int_l_recpresent = 1;

			if ((APL_ZERO_RESULT_SET) && (int_l_recpresent == 1))
			{
				if(PrnTotPosn(p_logfile,p_repfile,&l_dbl_naccredit_indotlval,&l_dbl_val_rectotlval,&l_dbl_val_deltotlval,p_nrow,&p_intl_envdatastruct_h,&l_debug_info_ptr)==APL_FAILURE)
					APL_GOBACK_FAIL
				int_l_recpresent = 0;
				APL_GOBACK_SUCCESS
			}
		

			if (strcmp(chr_l_h_previnstrcode,chr_l_h_instrcode_A) != 0 )
			{
				int_l_new_flg = 1;	

				if (strcmp(chr_l_h_previnstrcode,"") != 0)
				{
					int_prnt_posn_flg = 1;	
					 
				
					if(PrnTotPosn(p_logfile,p_repfile,&l_dbl_naccredit_indotlval,&l_dbl_val_rectotlval,&l_dbl_val_deltotlval,p_nrow,&p_intl_envdatastruct_h,&l_debug_info_ptr)==APL_FAILURE)
						APL_GOBACK_FAIL
					
					l_dbl_naccredit_indotlval = 0.0; 	
					l_dbl_val_rectotlval = 0.0;
					l_dbl_val_deltotlval = 0.0;
					
					int_prnt_posn_flg = 0;		
				}
				else
				{
					int_l_rep_hdr_flg = 1;
					int_retval = 0;
					int_retval = PrnRepHdrFn(p_logfile, p_repfile,p_int_pageno, p_nrow, p_str_parm, &l_debug_info_ptr);
					if (int_retval != APL_SUCCESS)
					{
						CO_ProcMonitor(p_logfile,"Unable to Write the Header for Generate By Customer\n",NULL,NULL);
						APL_GOBACK_FAIL
					}
				}
			}

			if(DoRrsfkiterations(schedule,int_l_nodataflg,int_l_new_flg,&l_dbl_naccredit_indotlval,&l_dbl_val_rectotlval,&l_dbl_val_deltotlval,p_int_pageno,p_nrow,chr_l_h_client_a,chr_l_h_instrcode_A,chr_l_h_location,l_dbl_safekeep_pos,l_dbl_val_rec,l_dbl_val_del,p_logfile,p_repfile,p_str_parm,&p_intl_envdatastruct_h,&l_debug_info_ptr)==APL_FAILURE)
					APL_GOBACK_FAIL
			
			int_l_new_flg = 0;					
			int_l_rep_hdr_flg = 0;
			strcpy(chr_l_h_previnstrcode,chr_l_h_instrcode_A);
			if (int_l_nodataflg == 1)
				APL_GOBACK_SUCCESS
		}

		if (int_l_cursor == 1)
		{
			EXEC SQL CLOSE curr_SEsafek1;		
		}
		else if (int_l_cursor == 2)
		{
			EXEC SQL CLOSE curr_SEsafek2;
		}
		else if (int_l_cursor == 3)
		{
			EXEC SQL CLOSE curr_SEsafek3;
		}
		
		int_l_cursor = 0;
		IS_ANY_ORA_ERROR

	}
	
	else 
	{
		strcpy(schedule,"SE");
		strcpy(chr_l_h_instrcode_A, p_str_parm[4]);
		int_l_new_flg = 1;  
		
		int_l_rep_hdr_flg = 1;
		int_retval = 0;
		int_retval = PrnRepHdrFn(p_logfile, p_repfile,p_int_pageno, p_nrow, p_str_parm, &l_debug_info_ptr);
		if (int_retval != APL_SUCCESS)
		{
			CO_ProcMonitor(p_logfile,"Unable to Write the Header for Generate By Instrode\n",NULL,NULL);
			APL_GOBACK_FAIL
		}

		
      if (strcmp(p_str_parm[5], "") == 0)
      {
			int_l_cursor = 1;
			EXEC SQL DECLARE curr_SEsafek11 CURSOR FOR
			SELECT INSTR_CODE,CLIENT,SUM(SAFEKEEP_POS),SUM(VAL_REC),SUM(VAL_DEL) 
			FROM DL_SAFEK
			WHERE INSTR_CODE= :chr_l_h_instrcode_A
			GROUP BY INSTR_CODE,CLIENT;
		}
		else
      {
			strcpy(chr_l_h_passdate, p_str_parm[5]);
			chr_l_h_passdate[19]='\0';
	
         memset(chr_l_sys_date, APL_NULL_CHAR, APL_DATE_LEN);
          int_retval = 0;
          int_retval =  CO_RtvSysDt(chr_l_sys_date, l_debug_info_ptr);

         if (int_retval != APL_SUCCESS)
         {
            CO_ProcMonitor(p_logfile,"Error in getting the system chr_date\n",NULL,NULL);
            APL_GOBACK_FAIL
         }
         int_retval = 0;
         int_retval =  CO_Pro_DateComp(chr_l_h_passdate, chr_l_sys_date, &int_l_diff, l_debug_info_ptr) ;

         if (int_retval != APL_SUCCESS)
         {
            CO_ProcMonitor(p_logfile,"Error in comparing the dates\n", NULL, NULL);
				APL_GOBACK_FAIL
         }
         if ( int_l_diff == 0 )
         {
				int_l_cursor = 2;
				EXEC SQL DECLARE curr_SEsafek12 CURSOR FOR
        		SELECT INSTR_CODE,CLIENT,SUM(SAFEKEEP_POS),SUM(VAL_REC),SUM(VAL_DEL)
         	FROM DL_SAFEK
         	WHERE INSTR_CODE= :chr_l_h_instrcode_A
         	GROUP BY INSTR_CODE,CLIENT;
			}
			else
			{
				int_l_cursor = 3;
				EXEC SQL DECLARE curr_SEsafek13 CURSOR FOR
            SELECT INSTR_CODE,CLIENT,SUM(SAFEKEEP_POS),SUM(VAL_REC),SUM(VAL_DEL)
            FROM DL_HISSAFEK
				WHERE INSTR_CODE= :chr_l_h_instrcode_A and POSIT_DATE = :chr_l_h_passdate
				GROUP BY INSTR_CODE,CLIENT;
         }
		}	
		IS_ANY_ORA_ERROR

		if (int_l_cursor == 1)
		{
			EXEC SQL OPEN curr_SEsafek11;
		}
		else if (int_l_cursor == 2)
		{
			EXEC SQL OPEN curr_SEsafek12;
		}
		else if (int_l_cursor == 3)
		{
			EXEC SQL OPEN curr_SEsafek13;	
		}
	
		IS_ANY_ORA_ERROR

		for (;;)
		{

			memset(chr_l_h_client_a,APL_NULL_CHAR,sizeof(APL_CLIENT_LENGTH));
         memset(chr_l_h_instrcode_A,APL_NULL_CHAR,sizeof(APL_INSTRUMENTCODE_LEN));		

			if (int_l_cursor == 1)
			{
				EXEC SQL FETCH curr_SEsafek11 INTO :chr_l_h_instrcode_A:l_i_instr_code,:chr_l_h_client_a:l_i_account,:l_dbl_safekeep_pos:l_i_safek,l_dbl_val_rec:l_i_confrec,l_dbl_val_del:l_i_confdel;
			}
			else if (int_l_cursor == 2)
			{
				EXEC SQL FETCH curr_SEsafek12 INTO :chr_l_h_instrcode_A:l_i_instr_code,:chr_l_h_client_a:l_i_account,:l_dbl_safekeep_pos:l_i_safek,l_dbl_val_rec:l_i_confrec,l_dbl_val_del:l_i_confdel;
			}
			else if (int_l_cursor == 3)
			{
				EXEC SQL FETCH curr_SEsafek13 INTO :chr_l_h_instrcode_A:l_i_instr_code,:chr_l_h_client_a:l_i_account,:l_dbl_safekeep_pos:l_i_safek,l_dbl_val_rec:l_i_confrec,l_dbl_val_del:l_i_confdel;
			}

			IS_ANY_ORA_ERROR
			if (!sqlca.sqlerrd[2])
				int_l_nodataflg = 1;
			else if(APL_ZERO_RESULT_SET)
				break;

			if(DoRrsfkiterations(schedule,int_l_nodataflg,int_l_new_flg,&l_dbl_naccredit_indotlval,&l_dbl_val_rectotlval,&l_dbl_val_deltotlval,p_int_pageno,p_nrow,chr_l_h_client_a,chr_l_h_instrcode_A,chr_l_h_location,l_dbl_safekeep_pos,l_dbl_val_rec,l_dbl_val_del,p_logfile,p_repfile,p_str_parm,&p_intl_envdatastruct_h,&l_debug_info_ptr)==APL_FAILURE)
					APL_GOBACK_FAIL
			
			int_l_new_flg = 0;	
			int_l_rep_hdr_flg = 0;
			if (int_l_nodataflg == 1)
				APL_GOBACK_SUCCESS
		}
	
		
		if(PrnTotPosn(p_logfile,p_repfile,&l_dbl_naccredit_indotlval,&l_dbl_val_rectotlval,&l_dbl_val_deltotlval,p_nrow,&p_intl_envdatastruct_h,&l_debug_info_ptr)==APL_FAILURE)
			APL_GOBACK_FAIL
	
		l_dbl_naccredit_indotlval = 0.0; 	
		l_dbl_val_rectotlval = 0.0;
		l_dbl_val_deltotlval = 0.0;

		if (int_l_cursor == 1)
		{
			EXEC SQL CLOSE curr_SEsafek11;
		}
		else if (int_l_cursor == 2)
		{
			EXEC SQL CLOSE curr_SEsafek12;
		}
		else if (int_l_cursor == 3)
		{
			EXEC SQL CLOSE curr_SEsafek13;
		}
		int_l_cursor = 0;

		IS_ANY_ORA_ERROR

	}

	APL_GOBACK_SUCCESS

	

	RETURN_FAILURE:
		CO_ProcMonitor(p_logfile,"Exiting out of DoskInstrAll Unsuccessfully\n",NULL,NULL);
		return (APL_FAILURE);

	 RETURN_SUCCESS:
		 CO_ProcMonitor(p_logfile,"Exiting out of DoskInstrAll Successfully\n",NULL,NULL);
		 return (APL_SUCCESS);

} 





int DoskLoAll(FILE *p_logfile,FILE *p_repfile,char **p_str_parm,int *p_int_pageno, int *p_nrow,INTL_ENV_DATA_STRUCT_H *p_intl_envdatastruct_h,DEBUG_INFO_STRUCT_H **l_debug_info_ptr)
{
	char chr_l_h_client_a[APL_CLIENT_LENGTH] 	= APL_NULL_STRING ;
	char chr_l_h_instrcode_A[APL_INSTRUMENTCODE_LEN] 		= APL_NULL_STRING;
	char chr_l_h_location[LOC_CD_LEN_A] 	= APL_NULL_STRING;	
	char schedule[CATEGORY_LEN] 		= APL_NULL_STRING;
	char chr_l_h_passdate[APL_DATE_LEN] = APL_NULL_STRING; 

	char chr_l_h_prevlocn[LOC_CD_LEN_A] 	= APL_NULL_STRING;

	double l_dbl_val_rectotlval = 0.0; 	
	double l_dbl_val_deltotlval = 0.0; 
	double l_dbl_naccredit_indotlval = 0.0; 	 
	
	double l_dbl_safekeep_pos = 0.0;
	double l_dbl_val_rec = 0.0;
	double l_dbl_val_del = 0.0;

	short l_i_account = 0 ;
	short l_i_instr_code = 0;
	short l_i_location = 0;
	short l_i_safek = 0;
	short l_i_confrec = 0;
	short l_i_confdel = 0;

	int int_l_nodataflg = 0;  
	int int_l_new_flg = 0;  
	int int_prnt_posn_flg = 0;  
	int int_retval = 0;
	int int_l_recpresent = 0; 
	int int_l_rep_hdr_flg = 0;
	char chr_l_sys_date[APL_DATE_LEN];
				int int_l_diff = 0;
	int int_l_cursor = 0;

	EXEC SQL VAR chr_l_h_location IS STRING ;
	EXEC SQL VAR chr_l_h_instrcode_A IS STRING;

	
	fprintf(p_logfile,"Entered Function DoskLoAll\n");

	if (strcmp(p_str_parm[3]," ") == 0) 	
	{
		strcpy(schedule,"LO");
  		

      if (strcmp(p_str_parm[5], "") == 0)
      {
			int_l_cursor = 1;

			EXEC SQL DECLARE curr_LOsafek1 CURSOR FOR
			SELECT LOCATION_CD,INSTR_CODE,SUM(SAFEKEEP_POS),SUM(VAL_REC),SUM(VAL_DEL) 
			FROM DL_SAFEK
			GROUP BY LOCATION_CD,INSTR_CODE;
		}
		else
		{

         strcpy(chr_l_h_passdate, p_str_parm[5]);
			chr_l_h_passdate[19]='\0';

         memset(chr_l_sys_date, APL_NULL_CHAR, APL_DATE_LEN);
			int_retval = 0;
          int_retval =  CO_RtvSysDt(chr_l_sys_date, l_debug_info_ptr);

         if (int_retval != APL_SUCCESS)
         {
            CO_ProcMonitor(p_logfile,"Error in getting the system chr_date\n",NULL,NULL);
            APL_GOBACK_FAIL
         }
         int_retval = 0;
         int_retval =  CO_Pro_DateComp(chr_l_h_passdate, chr_l_sys_date, &int_l_diff, l_debug_info_ptr) ;

         if (int_retval != APL_SUCCESS)
         {
            CO_ProcMonitor(p_logfile,"Error in comparing the dates\n", NULL, NULL);
            APL_GOBACK_FAIL
         }
			if ( int_l_diff == 0 )
         {

				int_l_cursor = 2;
				EXEC SQL DECLARE curr_LOsafek2 CURSOR FOR
         	SELECT LOCATION_CD,INSTR_CODE,SUM(SAFEKEEP_POS),SUM(VAL_REC),SUM(VAL_DEL)
        	 	FROM DL_SAFEK
         	GROUP BY LOCATION_CD,INSTR_CODE;
			}
			else
			{
				int_l_cursor = 3;

				EXEC SQL DECLARE curr_LOsafek3 CURSOR FOR
            SELECT LOCATION_CD,INSTR_CODE,SUM(SAFEKEEP_POS),SUM(VAL_REC),SUM(VAL_DEL)
            FROM DL_HISSAFEK WHERE POSIT_DATE = :chr_l_h_passdate
				GROUP BY LOCATION_CD,INSTR_CODE;
			}
		}
		
		IS_ANY_ORA_ERROR
			
				if (int_l_cursor == 1)
				{
					EXEC SQL OPEN curr_LOsafek1;
				}
				else if (int_l_cursor == 2)
				{
					EXEC SQL OPEN curr_LOsafek2;
				}
				else if (int_l_cursor == 3)
				{
					EXEC SQL OPEN curr_LOsafek3;
				}
		IS_ANY_ORA_ERROR
		for (;;)
		{

			memset(chr_l_h_location,APL_NULL_CHAR,sizeof(LOC_CD_LEN_A));
         memset(chr_l_h_instrcode_A,APL_NULL_CHAR,sizeof(APL_INSTRUMENTCODE_LEN));

			if (int_l_cursor == 1)
			{
				EXEC SQL FETCH curr_LOsafek1 INTO :chr_l_h_location:l_i_location,:chr_l_h_instrcode_A:l_i_instr_code,:l_dbl_safekeep_pos:l_i_safek,:l_dbl_val_rec:l_i_confrec,:l_dbl_val_del:l_i_confdel;	
			}
			else if (int_l_cursor == 2)
			{
				EXEC SQL FETCH curr_LOsafek2 INTO :chr_l_h_location:l_i_location,:chr_l_h_instrcode_A:l_i_instr_code,:l_dbl_safekeep_pos:l_i_safek,:l_dbl_val_rec:l_i_confrec,:l_dbl_val_del:l_i_confdel;	
			}
			else if (int_l_cursor == 3)
			{
				EXEC SQL FETCH curr_LOsafek3 INTO :chr_l_h_location:l_i_location,:chr_l_h_instrcode_A:l_i_instr_code,:l_dbl_safekeep_pos:l_i_safek,:l_dbl_val_rec:l_i_confrec,:l_dbl_val_del:l_i_confdel;
			}

			IS_ANY_ORA_ERROR
			if (!sqlca.sqlerrd[2])
				int_l_nodataflg = 1;
			
			else
				int_l_recpresent = 1;

			if ((APL_ZERO_RESULT_SET) && (int_l_recpresent == 1))
			{
				if(PrnTotPosn(p_logfile,p_repfile,&l_dbl_naccredit_indotlval,&l_dbl_val_rectotlval,&l_dbl_val_deltotlval,p_nrow,&p_intl_envdatastruct_h,&l_debug_info_ptr)==APL_FAILURE)
					APL_GOBACK_FAIL
				int_l_recpresent = 0;
				APL_GOBACK_SUCCESS
			}

			if (strcmp(chr_l_h_prevlocn,chr_l_h_location) != 0 )
			{
				int_l_new_flg = 1;	

				if (strcmp(chr_l_h_prevlocn,"") != 0)
				{
					int_prnt_posn_flg = 1;	
					 
				
					if(PrnTotPosn(p_logfile,p_repfile,&l_dbl_naccredit_indotlval,&l_dbl_val_rectotlval,&l_dbl_val_deltotlval,p_nrow,&p_intl_envdatastruct_h,&l_debug_info_ptr)==APL_FAILURE)
						APL_GOBACK_FAIL
					
					l_dbl_naccredit_indotlval = 0.0; 	
					l_dbl_val_rectotlval = 0.0;
					l_dbl_val_deltotlval = 0.0;

					int_prnt_posn_flg = 0;		
				}
				else
				{
					int_l_rep_hdr_flg = 1;
					int_retval = 0;
					int_retval = PrnRepHdrFn(p_logfile, p_repfile,p_int_pageno, p_nrow, p_str_parm ,& l_debug_info_ptr);
					if (int_retval != APL_SUCCESS)
					{
						CO_ProcMonitor(p_logfile,"Unable to Write the Header for Generate By Location\n",NULL,NULL);
						APL_GOBACK_FAIL
					}
				}
			}
			if(DoRrsfkiterations(schedule,int_l_nodataflg,int_l_new_flg,&l_dbl_naccredit_indotlval,&l_dbl_val_rectotlval,&l_dbl_val_deltotlval,p_int_pageno,p_nrow,chr_l_h_client_a,chr_l_h_instrcode_A,chr_l_h_location,l_dbl_safekeep_pos,l_dbl_val_rec,l_dbl_val_del,p_logfile,p_repfile,p_str_parm,&p_intl_envdatastruct_h,&l_debug_info_ptr)==APL_FAILURE)
					APL_GOBACK_FAIL
			
			int_l_new_flg = 0;					
			int_l_rep_hdr_flg = 0;
			strcpy(chr_l_h_prevlocn,chr_l_h_location);
			if (int_l_nodataflg == 1)
				APL_GOBACK_SUCCESS
		}

		if (int_l_cursor == 1)
		{
			EXEC SQL CLOSE curr_LOsafek1;	
		}
		else if (int_l_cursor == 2)
		{
			EXEC SQL CLOSE curr_LOsafek2;
		}
		else if (int_l_cursor == 3)
		{
			EXEC SQL CLOSE curr_LOsafek3;
		}

		int_l_cursor =0;

	 	IS_ANY_ORA_ERROR

	}
	
	else 
	{
		strcpy(schedule,"LO");
		strcpy(chr_l_h_location, p_str_parm[3]);
		int_l_new_flg = 1;  

		int_l_rep_hdr_flg = 1;
		int_retval = 0;
		int_retval = PrnRepHdrFn(p_logfile, p_repfile,p_int_pageno, p_nrow,p_str_parm, &l_debug_info_ptr);
		if (int_retval != APL_SUCCESS)
		{
			CO_ProcMonitor(p_logfile,"Unable to Write the Header for Generate By Location\n",NULL,NULL);
			APL_GOBACK_FAIL
		}

		
      if (strcmp(p_str_parm[5], "") == 0)
      {
			int_l_cursor = 1;
			EXEC SQL DECLARE curr_LOsafek11 CURSOR FOR
			SELECT LOCATION_CD,INSTR_CODE,SUM(SAFEKEEP_POS),SUM(VAL_REC),SUM(VAL_DEL) 
			FROM DL_SAFEK
			WHERE LOCATION_CD= :chr_l_h_location
			GROUP BY LOCATION_CD,INSTR_CODE;
		}
		else
      {
			strcpy(chr_l_h_passdate, p_str_parm[5]);
			chr_l_h_passdate[19]='\0';

         memset(chr_l_sys_date, APL_NULL_CHAR, APL_DATE_LEN);
          int_retval = 0;
          int_retval =  CO_RtvSysDt(chr_l_sys_date, l_debug_info_ptr);

         if (int_retval != APL_SUCCESS)
         {
            CO_ProcMonitor(p_logfile,"Error in getting the system chr_date\n",NULL,NULL);
            APL_GOBACK_FAIL
         }
         int_retval = 0;
         int_retval =  CO_Pro_DateComp(chr_l_h_passdate, chr_l_sys_date, &int_l_diff, l_debug_info_ptr) ;

         if (int_retval != APL_SUCCESS)
         {
            CO_ProcMonitor(p_logfile,"Error in comparing the dates\n", NULL, NULL);
            APL_GOBACK_FAIL
         }
         if ( int_l_diff == 0 )
         {	
				int_l_cursor = 2;
				EXEC SQL DECLARE curr_LOsafek12 CURSOR FOR
         	SELECT LOCATION_CD,INSTR_CODE,SUM(SAFEKEEP_POS),SUM(VAL_REC),SUM(VAL_DEL)
         	FROM DL_SAFEK
         	WHERE LOCATION_CD= :chr_l_h_location
         	GROUP BY LOCATION_CD,INSTR_CODE;
			}
			else if (int_l_diff > 0)
			{
				int_l_cursor = 3;

				EXEC SQL DECLARE curr_LOsafek13 CURSOR FOR
            SELECT LOCATION_CD,INSTR_CODE,SUM(SAFEKEEP_POS),SUM(VAL_REC),SUM(VAL_DEL)
            FROM DL_HISSAFEK
				WHERE LOCATION_CD= :chr_l_h_location AND POSIT_DATE = :chr_l_h_passdate
				GROUP BY LOCATION_CD,INSTR_CODE;
			}
		}

		IS_ANY_ORA_ERROR

			if (int_l_cursor == 1)
	{
			 EXEC SQL OPEN curr_LOsafek11;	
	}
	else if (int_l_cursor == 2)
	{
			 EXEC SQL OPEN curr_LOsafek12;
	}
	else if (int_l_cursor == 3)
	{
		 EXEC SQL OPEN curr_LOsafek13;
	}
	
		IS_ANY_ORA_ERROR	

		for (;;)
		{

			memset(chr_l_h_location,APL_NULL_CHAR,sizeof(LOC_CD_LEN_A));
         memset(chr_l_h_instrcode_A,APL_NULL_CHAR,sizeof(APL_INSTRUMENTCODE_LEN));

			if (int_l_cursor == 1)
	{
		EXEC SQL FETCH curr_LOsafek11 INTO :chr_l_h_location:l_i_location,:chr_l_h_instrcode_A:l_i_instr_code,:l_dbl_safekeep_pos:l_i_safek,:l_dbl_val_rec:l_i_confrec,:l_dbl_val_del:l_i_confdel;
	
	}
	else if (int_l_cursor == 2)
	{
		EXEC SQL FETCH curr_LOsafek12 INTO :chr_l_h_location:l_i_location,:chr_l_h_instrcode_A:l_i_instr_code,:l_dbl_safekeep_pos:l_i_safek,:l_dbl_val_rec:l_i_confrec,:l_dbl_val_del:l_i_confdel;	
	}
	else if (int_l_cursor == 3)
	{	
		EXEC SQL FETCH curr_LOsafek13 INTO :chr_l_h_location:l_i_location,:chr_l_h_instrcode_A:l_i_instr_code,:l_dbl_safekeep_pos:l_i_safek,:l_dbl_val_rec:l_i_confrec,:l_dbl_val_del:l_i_confdel;
	}

			IS_ANY_ORA_ERROR
			if (!sqlca.sqlerrd[2])
				int_l_nodataflg = 1;
			else if(APL_ZERO_RESULT_SET)
				break;

			if(DoRrsfkiterations(schedule,int_l_nodataflg,int_l_new_flg,&l_dbl_naccredit_indotlval,&l_dbl_val_rectotlval,&l_dbl_val_deltotlval,p_int_pageno,p_nrow,chr_l_h_client_a,chr_l_h_instrcode_A,chr_l_h_location,l_dbl_safekeep_pos,l_dbl_val_rec,l_dbl_val_del,p_logfile,p_repfile,p_str_parm,&p_intl_envdatastruct_h,&l_debug_info_ptr)==APL_FAILURE)
					APL_GOBACK_FAIL
			
			
			int_l_new_flg = 0;	
			int_l_rep_hdr_flg = 0;
			if (int_l_nodataflg == 1)
				APL_GOBACK_SUCCESS
		}
	
		
		
		if(PrnTotPosn(p_logfile,p_repfile,&l_dbl_naccredit_indotlval,&l_dbl_val_rectotlval,&l_dbl_val_deltotlval,p_nrow,&p_intl_envdatastruct_h,&l_debug_info_ptr)==APL_FAILURE)
			APL_GOBACK_FAIL
	
		l_dbl_naccredit_indotlval = 0.0; 	
		l_dbl_val_rectotlval = 0.0;
		l_dbl_val_deltotlval = 0.0;

				if (int_l_cursor == 1)
				{
					EXEC SQL CLOSE curr_LOsafek11;	
				}
				else if (int_l_cursor == 2)
				{
					EXEC SQL CLOSE curr_LOsafek12;
				}
				else if (int_l_cursor == 3)
				{
					EXEC SQL CLOSE curr_LOsafek13;
				}

				int_l_cursor = 0;

				IS_ANY_ORA_ERROR

	}

	APL_GOBACK_SUCCESS

	

	RETURN_FAILURE:
		CO_ProcMonitor(p_logfile,"Exiting out of DoskLoAll Unsuccessfully\n",NULL,NULL);
		return (APL_FAILURE);

	 RETURN_SUCCESS:
		 CO_ProcMonitor(p_logfile,"Exiting out of DoskLoAll Successfully\n",NULL,NULL);
		 return (APL_SUCCESS);

} 





int DorrmAcAll(FILE *p_logfile,FILE *p_repfile,char **p_str_parm,int *p_int_pageno, int *p_nrow,INTL_ENV_DATA_STRUCT_H *p_intl_envdatastruct_h,DEBUG_INFO_STRUCT_H **l_debug_info_ptr)
{
	char chr_l_h_ruclient[APL_CLIENT_LENGTH] 	= APL_NULL_STRING ;
	char chr_l_h_ruaccname[CLIENT_NAME_LEN] 		= APL_NULL_STRING;
	char chr_l_h_accname[CLT_NAME_LEN_A]        = APL_NULL_STRING;
	char chr_l_h_ruinstrcode[APL_INSTRUMENTCODE_LEN]		= APL_NULL_STRING;
	char chr_l_h_stregno[STAT_REG_NO_LEN]   	= APL_NULL_STRING;
	char chr_l_h_rulocation[LOC_CD_LEN_A] 	= APL_NULL_STRING;	
	char schedule[CATEGORY_LEN] 			= APL_NULL_STRING;
	char chr_l_h_passdate[APL_DATE_LEN] = APL_NULL_STRING; 

	char chr_l_h_prevclient[APL_CLIENT_LENGTH] = APL_NULL_STRING;

	double l_dbl_val_rectotlval = 0.0; 
	double l_dbl_val_deltotlval = 0.0; 
	double l_dbl_naccredit_indotlval = 0.0; 	 

	double l_dbl_safekeep_pos = 0.0;
	double l_dbl_val_rec = 0.0;
	double l_dbl_val_del = 0.0;

	
	short l_i_ruaccount = 0 ;
	short l_i_ruaccname = 0;
	short l_i_accname = 0;
	short l_i_stregno = 0;
	short l_i_ruinstrode = 0;
	
	short l_i_safek = 0;
	short l_i_confrec = 0;
	short l_i_confdel = 0;

	int int_l_nodataflg = 0;  
	int int_l_new_flg = 0;  
	int int_l_rep_hdr_flg = 0;  
	int int_retval = 0;
	int int_l_recpresent = 0; 

	EXEC SQL VAR chr_l_h_ruclient IS STRING ;
	EXEC SQL VAR chr_l_h_stregno IS STRING ;
	char chr_l_sys_date[APL_DATE_LEN];
				int int_l_diff = 0;
			int int_l_cursor = 0;

	fprintf(p_logfile,"Entered Function DorrmAcAll\n");

	if (strcmp(p_str_parm[2]," ") == 0) 	
	{
		strcpy(schedule,"AC");

		

      if (strcmp(p_str_parm[5], "") == 0)
      {	
			int_l_cursor = 1;
 			fprintf(p_logfile,"no chr_date is passed for DOrrmAcAll\n");
			EXEC SQL DECLARE curr_ACrrmm1 CURSOR FOR
			SELECT CLIENT,ST_REG_NO,SUM(SAFEKEEP_POS),SUM(VAL_REC),SUM(VAL_DEL) 
			FROM DL_RUSAFEK
			GROUP BY CLIENT,ST_REG_NO;
		}
		else
		{
			strcpy(chr_l_h_passdate, p_str_parm[5]);
			chr_l_h_passdate[19]='\0';

         memset(chr_l_sys_date, APL_NULL_CHAR, APL_DATE_LEN);
          int_retval = 0;
          int_retval =  CO_RtvSysDt(chr_l_sys_date, l_debug_info_ptr);

         if (int_retval != APL_SUCCESS)
         {
            CO_ProcMonitor(p_logfile,"Error in getting the system chr_date\n",NULL,NULL);
            APL_GOBACK_FAIL
         }
         int_retval = 0;
         int_retval =  CO_Pro_DateComp(chr_l_h_passdate, chr_l_sys_date, &int_l_diff, l_debug_info_ptr) ;

         if (int_retval != APL_SUCCESS)
         {
            CO_ProcMonitor(p_logfile,"Error in comparing the dates\n", NULL, NULL);
            APL_GOBACK_FAIL
			}
			fprintf(p_logfile,"value of chr_l_h_passdate is %s\n", chr_l_h_passdate);
			fprintf(p_logfile,"value of chr_l_sys_date is %s\n", chr_l_sys_date);
			fprintf(p_logfile,"value of  int_l_diff is %d\n",int_l_diff);
			/*fprintf(p_logfile,"value of  &int_l_diff is %d\n",&int_l_diff); Changes done for AIX Migration*/

         if ( int_l_diff == 0 )
         {
				int_l_cursor = 2;
				fprintf(p_logfile,"diff is equal 0\n");
				EXEC SQL DECLARE curr_ACrrmm2 CURSOR FOR
         	SELECT CLIENT,ST_REG_NO,SUM(SAFEKEEP_POS),SUM(VAL_REC),SUM(VAL_DEL)
         	FROM DL_RUSAFEK
         	GROUP BY CLIENT,ST_REG_NO;
			}
			else
			{
				int_l_cursor = 3;
				fprintf(p_logfile,"diff is > 0\n");
				EXEC SQL DECLARE curr_ACrrmm3 CURSOR FOR
            SELECT CLIENT,ST_REG_NO,SUM(SAFEKEEP_POS),SUM(VAL_REC),SUM(VAL_DEL)
            FROM DL_RUHISSAFEK WHERE POSIT_DATE = :chr_l_h_passdate
				GROUP BY CLIENT,ST_REG_NO;
         }
		}

		IS_ANY_ORA_ERROR

			if (int_l_cursor == 1)
			{
				EXEC SQL OPEN curr_ACrrmm1;
			}
			else if (int_l_cursor == 2)
			{
				EXEC SQL OPEN curr_ACrrmm2;	
			}
			else if (int_l_cursor == 3)
			{
				EXEC SQL OPEN curr_ACrrmm3;	
			}

		IS_ANY_ORA_ERROR	

		for (;;)
		{
 
			memset(chr_l_h_ruclient,APL_NULL_CHAR,sizeof(APL_CLIENT_LENGTH));
         memset(chr_l_h_stregno,APL_NULL_CHAR,sizeof(STAT_REG_NO_LEN));
			if (int_l_cursor == 1)
			{
				EXEC SQL FETCH curr_ACrrmm1 INTO :chr_l_h_ruclient:l_i_ruaccount,:chr_l_h_stregno:l_i_stregno,:l_dbl_safekeep_pos:l_i_safek,:l_dbl_val_rec:l_i_confrec,:l_dbl_val_del:l_i_confdel;
			}
			else if (int_l_cursor == 2)
			{
				EXEC SQL FETCH curr_ACrrmm2 INTO :chr_l_h_ruclient:l_i_ruaccount,:chr_l_h_stregno:l_i_stregno,:l_dbl_safekeep_pos:l_i_safek,:l_dbl_val_rec:l_i_confrec,:l_dbl_val_del:l_i_confdel;		
			}
			else if (int_l_cursor == 3)
			{
				EXEC SQL FETCH curr_ACrrmm3 INTO :chr_l_h_ruclient:l_i_ruaccount,:chr_l_h_stregno:l_i_stregno,:l_dbl_safekeep_pos:l_i_safek,:l_dbl_val_rec:l_i_confrec,:l_dbl_val_del:l_i_confdel;	
			}

			IS_ANY_ORA_ERROR
			if (!sqlca.sqlerrd[2])
				int_l_nodataflg = 1;
			
			else
				int_l_recpresent = 1;

			if ((APL_ZERO_RESULT_SET) && (int_l_recpresent == 1))
			{
				if(PrnTotRrmmPosn(schedule,p_logfile,p_repfile,&l_dbl_naccredit_indotlval,&l_dbl_val_rectotlval,&l_dbl_val_deltotlval,p_nrow,&p_intl_envdatastruct_h,&l_debug_info_ptr)==APL_FAILURE)
					APL_GOBACK_FAIL
				int_l_recpresent = 0;
				APL_GOBACK_SUCCESS
			}

			if (strcmp(chr_l_h_prevclient,chr_l_h_ruclient) != 0 )
			{
				int_l_new_flg = 1;	


				if (strcmp(chr_l_h_prevclient,"") != 0)
				{
					 
				
					if(PrnTotRrmmPosn(schedule,p_logfile,p_repfile,&l_dbl_naccredit_indotlval,&l_dbl_val_rectotlval,&l_dbl_val_deltotlval,p_nrow,&p_intl_envdatastruct_h,&l_debug_info_ptr)==APL_FAILURE)
						APL_GOBACK_FAIL
					
					l_dbl_naccredit_indotlval = 0.0; 	
					l_dbl_val_rectotlval = 0.0;
					l_dbl_val_deltotlval = 0.0;
				}
				else
				{
					int_l_rep_hdr_flg =1;
					int_retval = 0;
					int_retval = PrnRepHdrFn(p_logfile, p_repfile,p_int_pageno, p_nrow, p_str_parm, &l_debug_info_ptr);
					if (int_retval != APL_SUCCESS)
					{
						CO_ProcMonitor(p_logfile,"Unable to Write the Header for Generate By Customer\n",NULL,NULL);
						APL_GOBACK_FAIL
					}
				}
			}
			if(DoRrmmiterations(schedule,int_l_nodataflg,int_l_new_flg,&l_dbl_naccredit_indotlval,&l_dbl_val_rectotlval,&l_dbl_val_deltotlval,p_int_pageno,p_nrow,chr_l_h_ruclient,chr_l_h_ruinstrcode,chr_l_h_stregno,chr_l_h_rulocation,l_dbl_safekeep_pos,l_dbl_val_rec,l_dbl_val_del,p_logfile,p_repfile,p_str_parm,&p_intl_envdatastruct_h,&l_debug_info_ptr)==APL_FAILURE)
					APL_GOBACK_FAIL
			
			int_l_new_flg = 0;				
			int_l_rep_hdr_flg = 0;
			strcpy(chr_l_h_prevclient,chr_l_h_ruclient);
			if (int_l_nodataflg == 1)
				APL_GOBACK_SUCCESS
		}

			if (int_l_cursor == 1)
			{
				EXEC SQL CLOSE curr_ACrrmm1;
			}
			else if (int_l_cursor == 2)
			{
				EXEC SQL CLOSE curr_ACrrmm2;
			}
			else if (int_l_cursor == 3)
			{
				EXEC SQL CLOSE curr_ACrrmm3;
			}
		int_l_cursor =0;
		IS_ANY_ORA_ERROR

	}
	
	else 
	{
		strcpy(schedule,"AC");
		strcpy(chr_l_h_ruclient, p_str_parm[2]);
		int_l_new_flg = 1;  
	
		if ((strcmp(p_str_parm[0],"0") == 0) && ((*p_nrow) <= (PAGE_LENGTH - 15)))
			int_l_rep_hdr_flg = 2; 
		
		if (int_l_rep_hdr_flg != 2)
		{
			int_retval = 0;
			int_retval = PrnRepHdrFn(p_logfile, p_repfile,p_int_pageno, p_nrow, p_str_parm, &l_debug_info_ptr);
			if (int_retval != APL_SUCCESS)
			{
				CO_ProcMonitor(p_logfile,"Unable to Write the Header for Generate By Customer\n",NULL,NULL);
				APL_GOBACK_FAIL
			}
		}	
		int_l_rep_hdr_flg = 0;

		
      if (strcmp(p_str_parm[5], "") == 0)
      {
			int_l_cursor = 1;
			EXEC SQL DECLARE curr_ACrrmm11 CURSOR FOR
			SELECT CLIENT,ST_REG_NO,SUM(SAFEKEEP_POS),SUM(VAL_REC),SUM(VAL_DEL) 
			FROM DL_RUSAFEK
			WHERE CLIENT= :chr_l_h_ruclient
			GROUP BY CLIENT,ST_REG_NO;
		}
      else
      {
			strcpy(chr_l_h_passdate, p_str_parm[5]);
			chr_l_h_passdate[19]='\0';

         memset(chr_l_sys_date, APL_NULL_CHAR, APL_DATE_LEN);
          int_retval = 0;
          int_retval =  CO_RtvSysDt(chr_l_sys_date, l_debug_info_ptr);

         if (int_retval != APL_SUCCESS)
         {
            CO_ProcMonitor(p_logfile,"Error in getting the system chr_date\n",NULL,NULL);
            APL_GOBACK_FAIL
         }
         int_retval = 0;
         int_retval =  CO_Pro_DateComp(chr_l_h_passdate, chr_l_sys_date, &int_l_diff, l_debug_info_ptr) ;

         if (int_retval != APL_SUCCESS)
         {
            CO_ProcMonitor(p_logfile,"Error in comparing the dates\n", NULL, NULL);
            APL_GOBACK_FAIL
         }
         if ( int_l_diff == 0 )
		   {
				int_l_cursor = 2;
				EXEC SQL DECLARE curr_ACrrmm12 CURSOR FOR
         	SELECT CLIENT,ST_REG_NO,SUM(SAFEKEEP_POS),SUM(VAL_REC),SUM(VAL_DEL)
         	FROM DL_RUSAFEK
         	WHERE CLIENT= :chr_l_h_ruclient 
				GROUP BY CLIENT,ST_REG_NO;
			}
			else if (int_l_diff > 0 ) 
			{
				int_l_cursor = 3;
				EXEC SQL DECLARE curr_ACrrmm13 CURSOR FOR
            SELECT CLIENT,ST_REG_NO,SUM(SAFEKEEP_POS),SUM(VAL_REC),SUM(VAL_DEL)
            FROM DL_RUHISSAFEK
            WHERE CLIENT= :chr_l_h_ruclient AND POSIT_DATE = :chr_l_h_passdate
            GROUP BY CLIENT,ST_REG_NO;
			}
      }
		
		IS_ANY_ORA_ERROR
	
			if (int_l_cursor == 1)
	{
			EXEC SQL OPEN curr_ACrrmm11;	
	}
	else if (int_l_cursor == 2)
	{	
			EXEC SQL OPEN curr_ACrrmm12;
	}
	else if (int_l_cursor == 3)
	{	
		EXEC SQL OPEN curr_ACrrmm13;
	}	

	
		IS_ANY_ORA_ERROR	

		for (;;)
		{

			memset(chr_l_h_ruclient,APL_NULL_CHAR,sizeof(APL_CLIENT_LENGTH));
         memset(chr_l_h_stregno,APL_NULL_CHAR,sizeof(STAT_REG_NO_LEN));
		
			if (int_l_cursor == 1)
			{
				EXEC SQL FETCH curr_ACrrmm11 INTO :chr_l_h_ruclient:l_i_ruaccount,:chr_l_h_stregno:l_i_stregno,:l_dbl_safekeep_pos:l_i_safek,:l_dbl_val_rec:l_i_confrec,:l_dbl_val_del:l_i_confdel;
	
			}
			else if (int_l_cursor == 2)
			{
				EXEC SQL FETCH curr_ACrrmm12 INTO :chr_l_h_ruclient:l_i_ruaccount,:chr_l_h_stregno:l_i_stregno,:l_dbl_safekeep_pos:l_i_safek,:l_dbl_val_rec:l_i_confrec,:l_dbl_val_del:l_i_confdel;	
			}
			else if (int_l_cursor == 3)
			{
				EXEC SQL FETCH curr_ACrrmm13 INTO :chr_l_h_ruclient:l_i_ruaccount,:chr_l_h_stregno:l_i_stregno,:l_dbl_safekeep_pos:l_i_safek,:l_dbl_val_rec:l_i_confrec,:l_dbl_val_del:l_i_confdel;
			}

			IS_ANY_ORA_ERROR
			if (!sqlca.sqlerrd[2])
				int_l_nodataflg = 1;
			else if(APL_ZERO_RESULT_SET)
				break;

			if(DoRrmmiterations(schedule,int_l_nodataflg,int_l_new_flg,&l_dbl_naccredit_indotlval,&l_dbl_val_rectotlval,&l_dbl_val_deltotlval,p_int_pageno,p_nrow,chr_l_h_ruclient,chr_l_h_ruinstrcode,chr_l_h_stregno,chr_l_h_rulocation,l_dbl_safekeep_pos,l_dbl_val_rec,l_dbl_val_del,p_logfile,p_repfile,p_str_parm,&p_intl_envdatastruct_h,&l_debug_info_ptr)==APL_FAILURE)
					APL_GOBACK_FAIL
			
			int_l_new_flg = 0;	
			int_l_rep_hdr_flg = 0;
			if (int_l_nodataflg == 1)
				APL_GOBACK_SUCCESS
		}
	
		
		if(PrnTotRrmmPosn(schedule,p_logfile,p_repfile,&l_dbl_naccredit_indotlval,&l_dbl_val_rectotlval,&l_dbl_val_deltotlval,p_nrow,&p_intl_envdatastruct_h,&l_debug_info_ptr)==APL_FAILURE)
			APL_GOBACK_FAIL
	
		l_dbl_naccredit_indotlval = 0.0; 	
		l_dbl_val_rectotlval = 0.0;
		l_dbl_val_deltotlval = 0.0;

		if (int_l_cursor == 1)
		{
			EXEC SQL CLOSE curr_ACrrmm11;
		}
		else if (int_l_cursor == 2)
		{
			EXEC SQL CLOSE curr_ACrrmm12;
		}
		else if (int_l_cursor == 3)
		{
			EXEC SQL CLOSE curr_ACrrmm13;
		}
			int_l_cursor = 0;

		IS_ANY_ORA_ERROR

	}

	APL_GOBACK_SUCCESS

	

	RETURN_FAILURE:
		CO_ProcMonitor(p_logfile,"Exiting out of DorrmAcAll Unsuccessfully\n",NULL,NULL);
		return (APL_FAILURE);

	 RETURN_SUCCESS:
		 CO_ProcMonitor(p_logfile,"Exiting out of DorrmAcAll Successfully\n",NULL,NULL);
		 return (APL_SUCCESS);

} 




int DorrmInstrAll(FILE *p_logfile,FILE *p_repfile,char **p_str_parm,int *p_int_pageno, int *p_nrow,INTL_ENV_DATA_STRUCT_H *p_intl_envdatastruct_h,DEBUG_INFO_STRUCT_H **l_debug_info_ptr)
{
	char chr_l_h_ruclient[APL_CLIENT_LENGTH]		= APL_NULL_STRING;
	char chr_l_h_ruinstrcode[APL_INSTRUMENTCODE_LEN]		= APL_NULL_STRING;
	char chr_l_h_stregno[STAT_REG_NO_LEN]   	= APL_NULL_STRING;
	char chr_l_h_rulocation[LOC_CD_LEN_A] 	= APL_NULL_STRING;	
	char schedule[CATEGORY_LEN] 			= APL_NULL_STRING;
	char chr_l_h_passdate[APL_DATE_LEN] = APL_NULL_STRING; 

	char chr_l_h_previnstrcode[APL_INSTRUMENTCODE_LEN] 	= APL_NULL_STRING;
	
	double l_dbl_val_rectotlval = 0.0; 
	double l_dbl_val_deltotlval = 0.0; 
	double l_dbl_naccredit_indotlval = 0.0; 	 
	
	double l_dbl_safekeep_pos = 0.0;
	double l_dbl_val_rec = 0.0;
	double l_dbl_val_del = 0.0;

	short l_i_ruinstrode = 0;
	short l_i_stregno = 0;
	short l_i_safek = 0;
	short l_i_confrec = 0;
	short l_i_confdel = 0;

	int int_l_nodataflg = 0;  
	int int_l_new_flg = 0;  
	int int_l_rep_hdr_flg = 0;  
	int int_retval = 0;
	int int_l_recpresent = 0; 
	char chr_l_sys_date[APL_DATE_LEN];
				int int_l_diff = 0;
	int int_l_cursor =0;

	EXEC SQL VAR chr_l_h_ruinstrcode IS STRING ;
	EXEC SQL VAR chr_l_h_stregno IS STRING;

	fprintf(p_logfile,"Entered Function DorrmInstrAll\n");

	if (strcmp(p_str_parm[4]," ") == 0) 	
	{
		strcpy(schedule,"SE");
		

      if (strcmp(p_str_parm[5], "") == 0)
      {
			int_l_cursor =1;

			EXEC SQL DECLARE curr_SErrmm1 CURSOR FOR
			SELECT INSTR_CODE,ST_REG_NO,SUM(SAFEKEEP_POS),SUM(VAL_REC),SUM(VAL_DEL) 
			FROM DL_RUSAFEK
			GROUP BY INSTR_CODE,ST_REG_NO;
		}
		else
		{
			strcpy(chr_l_h_passdate, p_str_parm[5]);
			chr_l_h_passdate[19]='\0';

         memset(chr_l_sys_date, APL_NULL_CHAR, APL_DATE_LEN);
          int_retval = 0;
          int_retval =  CO_RtvSysDt(chr_l_sys_date, l_debug_info_ptr);

         if (int_retval != APL_SUCCESS)
         {
            CO_ProcMonitor(p_logfile,"Error in getting the system chr_date\n",NULL,NULL);
            APL_GOBACK_FAIL
         }
         int_retval = 0;
         int_retval =  CO_Pro_DateComp(chr_l_h_passdate, chr_l_sys_date, &int_l_diff, l_debug_info_ptr) ;

         if (int_retval != APL_SUCCESS)
         {
            CO_ProcMonitor(p_logfile,"Error in comparing the dates\n", NULL, NULL);
            APL_GOBACK_FAIL
			}

         if ( int_l_diff == 0 )
         {
				int_l_cursor =2;
				EXEC SQL DECLARE curr_SErrmm2 CURSOR FOR
 		        SELECT INSTR_CODE,ST_REG_NO,SUM(SAFEKEEP_POS),SUM(VAL_REC),SUM(VAL_DEL)
      	   FROM DL_RUSAFEK
         	GROUP BY INSTR_CODE,ST_REG_NO;
			}
			else if (int_l_diff > 0 ) 
			{
				int_l_cursor =3;
				EXEC SQL DECLARE curr_SErrmm3 CURSOR FOR
				SELECT INSTR_CODE,ST_REG_NO,SUM(SAFEKEEP_POS),SUM(VAL_REC),SUM(VAL_DEL)
				FROM DL_RUHISSAFEK WHERE POSIT_DATE = :chr_l_h_passdate
				GROUP BY INSTR_CODE,ST_REG_NO;
			}
		}


		IS_ANY_ORA_ERROR
		if (int_l_cursor == 1)
			{
				EXEC SQL OPEN curr_SErrmm1;
		}
		else if (int_l_cursor == 2)
		{
			EXEC SQL OPEN curr_SErrmm2;
		}
		else if (int_l_cursor == 3)
		{
			EXEC SQL OPEN curr_SErrmm3;	
		}
		IS_ANY_ORA_ERROR

		for (;;)
		{

			memset(chr_l_h_ruinstrcode,APL_NULL_CHAR,sizeof(APL_INSTRUMENTCODE_LEN));
         memset(chr_l_h_stregno,APL_NULL_CHAR,sizeof(STAT_REG_NO_LEN));
		
			if (int_l_cursor == 1)
			{
				EXEC SQL FETCH curr_SErrmm1 INTO :chr_l_h_ruinstrcode:l_i_ruinstrode,:chr_l_h_stregno:l_i_stregno,:l_dbl_safekeep_pos:l_i_safek,:l_dbl_val_rec:l_i_confrec,:l_dbl_val_del:l_i_confdel;
			}
			else if (int_l_cursor == 2)
			{
				EXEC SQL FETCH curr_SErrmm2 INTO :chr_l_h_ruinstrcode:l_i_ruinstrode,:chr_l_h_stregno:l_i_stregno,:l_dbl_safekeep_pos:l_i_safek,:l_dbl_val_rec:l_i_confrec,:l_dbl_val_del:l_i_confdel;
			}	
			else if (int_l_cursor == 3)
			{
				EXEC SQL FETCH curr_SErrmm3 INTO :chr_l_h_ruinstrcode:l_i_ruinstrode,:chr_l_h_stregno:l_i_stregno,:l_dbl_safekeep_pos:l_i_safek,:l_dbl_val_rec:l_i_confrec,:l_dbl_val_del:l_i_confdel;
			}

			IS_ANY_ORA_ERROR
			if (!sqlca.sqlerrd[2])
				int_l_nodataflg = 1;
			
			else
				int_l_recpresent = 1;
			
			if ((APL_ZERO_RESULT_SET) && (int_l_recpresent == 1))
			{
				if(PrnTotRrmmPosn(schedule,p_logfile,p_repfile,&l_dbl_naccredit_indotlval,&l_dbl_val_rectotlval,&l_dbl_val_deltotlval,p_nrow,&p_intl_envdatastruct_h,&l_debug_info_ptr)==APL_FAILURE)
					APL_GOBACK_FAIL
				int_l_recpresent = 0;
				APL_GOBACK_SUCCESS
			}

			if (strcmp(chr_l_h_previnstrcode,chr_l_h_ruinstrcode) != 0 )
			{
				int_l_new_flg = 1;	

				if (strcmp(chr_l_h_previnstrcode,"") != 0)
				{
					 
				
					if(PrnTotRrmmPosn(schedule,p_logfile,p_repfile,&l_dbl_naccredit_indotlval,&l_dbl_val_rectotlval,&l_dbl_val_deltotlval,p_nrow,&p_intl_envdatastruct_h,&l_debug_info_ptr)==APL_FAILURE)
						APL_GOBACK_FAIL
					
					l_dbl_naccredit_indotlval = 0.0; 	
					l_dbl_val_rectotlval = 0.0;
					l_dbl_val_deltotlval = 0.0;

				}
				else
				{
					int_l_rep_hdr_flg = 1;
					int_retval = 0;
					int_retval = PrnRepHdrFn(p_logfile, p_repfile,p_int_pageno, p_nrow, p_str_parm, &l_debug_info_ptr);
					if (int_retval != APL_SUCCESS)
					{
						CO_ProcMonitor(p_logfile,"Unable to Write the Report Header for Generate By Instrurity\n",NULL,NULL);
						APL_GOBACK_FAIL
					}
				}
			}
	
			if(DoRrmmiterations(schedule,int_l_nodataflg,int_l_new_flg,&l_dbl_naccredit_indotlval,&l_dbl_val_rectotlval,&l_dbl_val_deltotlval,p_int_pageno,p_nrow,chr_l_h_ruclient,chr_l_h_ruinstrcode,chr_l_h_stregno,chr_l_h_rulocation,l_dbl_safekeep_pos,l_dbl_val_rec,l_dbl_val_del,p_logfile,p_repfile,p_str_parm,&p_intl_envdatastruct_h,&l_debug_info_ptr)==APL_FAILURE)
					APL_GOBACK_FAIL
			
			int_l_new_flg = 0;					
			int_l_rep_hdr_flg = 0;
			strcpy(chr_l_h_previnstrcode,chr_l_h_ruinstrcode);
			if (int_l_nodataflg == 1)
				APL_GOBACK_SUCCESS
		}
	
			if (int_l_cursor == 1)
			{
				EXEC SQL CLOSE curr_SErrmm1;
			}
			else if (int_l_cursor == 2)
			{
				EXEC SQL CLOSE curr_SErrmm2;	
			}
			else if (int_l_cursor == 3)
			{
				EXEC SQL CLOSE curr_SErrmm3;
			}
			int_l_cursor =0;
	IS_ANY_ORA_ERROR

	}
	
	else 
	{
		strcpy(schedule,"SE");
		strcpy(chr_l_h_ruinstrcode, p_str_parm[4]);
		
		int_l_new_flg = 1;  

		int_l_rep_hdr_flg = 1;

		if ((strcmp(p_str_parm[0],"0") == 0) && ((*p_nrow) <= (PAGE_LENGTH - 15)))
			int_l_rep_hdr_flg = 2; 
		
		if (int_l_rep_hdr_flg != 2)
		{
			int_retval = 0;
			int_retval = PrnRepHdrFn(p_logfile, p_repfile,p_int_pageno, p_nrow, p_str_parm, &l_debug_info_ptr);
			if (int_retval != APL_SUCCESS)
			{
				CO_ProcMonitor(p_logfile,"Unable to Write the Header for Generate By Customer\n",NULL,NULL);
				APL_GOBACK_FAIL
			}
		}	
		int_l_rep_hdr_flg = 0;

		
      if (strcmp(p_str_parm[5], "") == 0)
      {	
			int_l_cursor =1;

			EXEC SQL DECLARE curr_SErrmm11 CURSOR FOR
			SELECT INSTR_CODE,ST_REG_NO,SUM(SAFEKEEP_POS),SUM(VAL_REC),SUM(VAL_DEL) 
			FROM DL_RUSAFEK
			WHERE INSTR_CODE= :chr_l_h_ruinstrcode
			GROUP BY INSTR_CODE,ST_REG_NO;
		}
		else
		{
         strcpy(chr_l_h_passdate, p_str_parm[5]);
			chr_l_h_passdate[19]='\0';

			memset(chr_l_sys_date, APL_NULL_CHAR, APL_DATE_LEN);
          int_retval = 0;
          int_retval =  CO_RtvSysDt(chr_l_sys_date, l_debug_info_ptr);

         if (int_retval != APL_SUCCESS)
         {
            CO_ProcMonitor(p_logfile,"Error in getting the system chr_date\n",NULL,NULL);
            APL_GOBACK_FAIL
         }
         int_retval = 0;
         int_retval =  CO_Pro_DateComp(chr_l_h_passdate, chr_l_sys_date, &int_l_diff, l_debug_info_ptr) ;

         if (int_retval != APL_SUCCESS)
         {
            CO_ProcMonitor(p_logfile,"Error in comparing the dates\n", NULL, NULL);
            APL_GOBACK_FAIL
         }
         if ( int_l_diff == 0 )
         {
				int_l_cursor =2;
				EXEC SQL DECLARE curr_SErrmm12 CURSOR FOR
         	SELECT INSTR_CODE,ST_REG_NO,SUM(SAFEKEEP_POS),SUM(VAL_REC),SUM(VAL_DEL)
         	FROM DL_RUSAFEK
         	WHERE INSTR_CODE= :chr_l_h_ruinstrcode
         	GROUP BY INSTR_CODE,ST_REG_NO;
			}
			else if ( int_l_diff > 0)
			{
				int_l_cursor =3;
				EXEC SQL DECLARE curr_SErrmm13 CURSOR FOR
         	SELECT INSTR_CODE,ST_REG_NO,SUM(SAFEKEEP_POS),SUM(VAL_REC),SUM(VAL_DEL)
         	FROM DL_RUHISSAFEK WHERE INSTR_CODE= :chr_l_h_ruinstrcode AND POSIT_DATE = :chr_l_h_passdate
				GROUP BY INSTR_CODE,ST_REG_NO;
         }
				
		}
		IS_ANY_ORA_ERROR
		
			if (int_l_cursor == 1)
			{
				 EXEC SQL OPEN curr_SErrmm11;
			}
			else if (int_l_cursor == 2)
			{
				 EXEC SQL OPEN curr_SErrmm12;
			}
			else if (int_l_cursor == 3)
			{
				 EXEC SQL OPEN curr_SErrmm13;
			}
	
		IS_ANY_ORA_ERROR

		for (;;)
		{


			memset(chr_l_h_ruinstrcode,APL_NULL_CHAR,sizeof(APL_INSTRUMENTCODE_LEN));
         memset(chr_l_h_stregno,APL_NULL_CHAR,sizeof(STAT_REG_NO_LEN));
		
			if (int_l_cursor == 1)
			{
				EXEC SQL FETCH curr_SErrmm11 INTO :chr_l_h_ruinstrcode:l_i_ruinstrode,:chr_l_h_stregno:l_i_stregno,:l_dbl_safekeep_pos:l_i_safek,:l_dbl_val_rec:l_i_confrec,:l_dbl_val_del:l_i_confdel;
			}
			else if (int_l_cursor == 2)
			{
				EXEC SQL FETCH curr_SErrmm12 INTO :chr_l_h_ruinstrcode:l_i_ruinstrode,:chr_l_h_stregno:l_i_stregno,:l_dbl_safekeep_pos:l_i_safek,:l_dbl_val_rec:l_i_confrec,:l_dbl_val_del:l_i_confdel;	
			}
			else if (int_l_cursor == 3)
			{
				EXEC SQL FETCH curr_SErrmm13 INTO :chr_l_h_ruinstrcode:l_i_ruinstrode,:chr_l_h_stregno:l_i_stregno,:l_dbl_safekeep_pos:l_i_safek,:l_dbl_val_rec:l_i_confrec,:l_dbl_val_del:l_i_confdel;
			}

			IS_ANY_ORA_ERROR
			if (!sqlca.sqlerrd[2])
				int_l_nodataflg = 1;
			else if(APL_ZERO_RESULT_SET)
				break;

			if(DoRrmmiterations(schedule,int_l_nodataflg,int_l_new_flg,&l_dbl_naccredit_indotlval,&l_dbl_val_rectotlval,&l_dbl_val_deltotlval,p_int_pageno,p_nrow,chr_l_h_ruclient,chr_l_h_ruinstrcode,chr_l_h_stregno,chr_l_h_rulocation,l_dbl_safekeep_pos,l_dbl_val_rec,l_dbl_val_del,p_logfile,p_repfile,p_str_parm,&p_intl_envdatastruct_h,&l_debug_info_ptr)==APL_FAILURE)
					APL_GOBACK_FAIL
			
			int_l_new_flg = 0;	
			int_l_rep_hdr_flg = 0;
			if (int_l_nodataflg == 1)
				APL_GOBACK_SUCCESS
		}

		
		if(PrnTotRrmmPosn(schedule,p_logfile,p_repfile,&l_dbl_naccredit_indotlval,&l_dbl_val_rectotlval,&l_dbl_val_deltotlval,p_nrow,&p_intl_envdatastruct_h,&l_debug_info_ptr)==APL_FAILURE)
			APL_GOBACK_FAIL
	
		l_dbl_naccredit_indotlval = 0.0; 	
		l_dbl_val_rectotlval = 0.0;
		l_dbl_val_deltotlval = 0.0;

			if (int_l_cursor == 1)
			{
				EXEC SQL CLOSE curr_SErrmm11;
			}
			else if (int_l_cursor == 2)
			{
				EXEC SQL CLOSE curr_SErrmm12;
			}
			else if (int_l_cursor == 3)
			{
				EXEC SQL CLOSE curr_SErrmm13;	
			}
		int_l_cursor = 0 ;

		IS_ANY_ORA_ERROR

	}

	APL_GOBACK_SUCCESS

	

	RETURN_FAILURE:
		CO_ProcMonitor(p_logfile,"Exiting out of DorrmInstrAll Unsuccessfully\n",NULL,NULL);
		return (APL_FAILURE);

	 RETURN_SUCCESS:
		 CO_ProcMonitor(p_logfile,"Exiting out of DorrmInstrAll Successfully\n",NULL,NULL);
		 return (APL_SUCCESS);

} 




int DorrmLoAll(FILE *p_logfile,FILE *p_repfile,char **p_str_parm,int *p_int_pageno, int *p_nrow,INTL_ENV_DATA_STRUCT_H *p_intl_envdatastruct_h,DEBUG_INFO_STRUCT_H **l_debug_info_ptr)
{
	char chr_l_h_ruclient[APL_CLIENT_LENGTH]		= APL_NULL_STRING;
	char chr_l_h_ruinstrcode[APL_INSTRUMENTCODE_LEN]		= APL_NULL_STRING;
	char chr_l_h_stregno[STAT_REG_NO_LEN]   	= APL_NULL_STRING;
	char chr_l_h_rulocation[LOC_CD_LEN_A] 	= APL_NULL_STRING;	
	char schedule[CATEGORY_LEN] 			= APL_NULL_STRING;
	char chr_l_h_passdate[APL_DATE_LEN] = APL_NULL_STRING; 

	char chr_l_h_prevlocn[LOC_CD_LEN_A] 		= APL_NULL_STRING;
	
	double l_dbl_val_rectotlval = 0.0; 
	double l_dbl_val_deltotlval = 0.0; 
	double l_dbl_naccredit_indotlval = 0.0; 	 
	
	double l_dbl_safekeep_pos = 0.0;
	double l_dbl_val_rec = 0.0;
	double l_dbl_val_del = 0.0;

	short l_i_rulocation = 0;
	short l_i_stregno = 0;
	short l_i_ruinstrode = 0;
	short l_i_safek = 0;
	short l_i_confrec = 0;
	short l_i_confdel = 0;

	int int_l_nodataflg = 0;  
	int int_l_new_flg = 0;  
	int int_l_rep_hdr_flg = 0;  
	int int_retval = 0;
	int int_l_recpresent = 0; 
	char chr_l_sys_date[APL_DATE_LEN];
				int int_l_diff = 0;
	int int_l_cursor =0;

	EXEC SQL VAR chr_l_h_rulocation IS STRING;
	EXEC SQL VAR chr_l_h_ruinstrcode IS STRING;
	EXEC SQL VAR chr_l_h_stregno IS STRING;

	fprintf(p_logfile,"Entered Function DorrmLoAll\n");

	if (strcmp(p_str_parm[3]," ") == 0) 	
	{
		strcpy(schedule,"LO");
		

      if (strcmp(p_str_parm[5], "") == 0)
      {
			int_l_cursor =1;

			EXEC SQL DECLARE curr_LOrrmm1 CURSOR FOR
			SELECT LOCATION_CD,ST_REG_NO,SUM(SAFEKEEP_POS),SUM(VAL_REC),SUM(VAL_DEL) 
			FROM DL_RUSAFEK
			GROUP BY LOCATION_CD,ST_REG_NO;
		}
		else
		{
			strcpy(chr_l_h_passdate, p_str_parm[5]);
			chr_l_h_passdate[19]='\0';


         memset(chr_l_sys_date, APL_NULL_CHAR, APL_DATE_LEN);
          int_retval = 0;
          int_retval =  CO_RtvSysDt(chr_l_sys_date, l_debug_info_ptr);

         if (int_retval != APL_SUCCESS)
         {
            CO_ProcMonitor(p_logfile,"Error in getting the system chr_date\n",NULL,NULL);
            APL_GOBACK_FAIL
         }
         int_retval = 0;
         int_retval =  CO_Pro_DateComp(chr_l_h_passdate, chr_l_sys_date, &int_l_diff, l_debug_info_ptr) ;

         if (int_retval != APL_SUCCESS)
         {
            CO_ProcMonitor(p_logfile,"Error in comparing the dates\n", NULL, NULL);
            APL_GOBACK_FAIL
			}

         if ( int_l_diff == 0 )
         {
				int_l_cursor = 2;
				EXEC SQL DECLARE curr_LOrrmm2 CURSOR FOR
         	SELECT LOCATION_CD,ST_REG_NO,SUM(SAFEKEEP_POS),SUM(VAL_REC),SUM(VAL_DEL)
         	FROM DL_RUSAFEK
         	GROUP BY LOCATION_CD,ST_REG_NO;
			}
			else
			{
				int_l_cursor =3;
				EXEC SQL DECLARE curr_LOrrmm3 CURSOR FOR
            SELECT LOCATION_CD,ST_REG_NO,SUM(SAFEKEEP_POS),SUM(VAL_REC),SUM(VAL_DEL)
            FROM DL_RUHISSAFEK WHERE POSIT_DATE = :chr_l_h_passdate
				GROUP BY LOCATION_CD,ST_REG_NO;
         }
			
		}

		IS_ANY_ORA_ERROR
		if (int_l_cursor == 1)
			{
				EXEC SQL OPEN curr_LOrrmm1;
		}
		else if (int_l_cursor == 2)
		{
			EXEC SQL OPEN curr_LOrrmm2;
		}
		else if (int_l_cursor == 3)
		{
			EXEC SQL OPEN curr_LOrrmm3;	
		}
			

		IS_ANY_ORA_ERROR

		for (;;)
		{

			memset(chr_l_h_rulocation,APL_NULL_CHAR,sizeof(LOC_CD_LEN_A));
         memset(chr_l_h_stregno,APL_NULL_CHAR,sizeof(STAT_REG_NO_LEN));
		
			if (int_l_cursor == 1)
			{
				EXEC SQL FETCH curr_LOrrmm1 INTO :chr_l_h_rulocation:l_i_rulocation,:chr_l_h_stregno:l_i_stregno,:l_dbl_safekeep_pos:l_i_safek,:l_dbl_val_rec:l_i_confrec,:l_dbl_val_del:l_i_confdel;
			}
			else if (int_l_cursor == 2)
			{
				EXEC SQL FETCH curr_LOrrmm2 INTO :chr_l_h_rulocation:l_i_rulocation,:chr_l_h_stregno:l_i_stregno,:l_dbl_safekeep_pos:l_i_safek,:l_dbl_val_rec:l_i_confrec,:l_dbl_val_del:l_i_confdel;
			}
			else if (int_l_cursor == 3)
			{
				EXEC SQL FETCH curr_LOrrmm3 INTO :chr_l_h_rulocation:l_i_rulocation,:chr_l_h_stregno:l_i_stregno,:l_dbl_safekeep_pos:l_i_safek,:l_dbl_val_rec:l_i_confrec,:l_dbl_val_del:l_i_confdel;
			}

			IS_ANY_ORA_ERROR
			if (!sqlca.sqlerrd[2])
				int_l_nodataflg = 1;
			
			else
				int_l_recpresent = 1;
		
			if ((APL_ZERO_RESULT_SET) && (int_l_recpresent == 1))
			{
				if(PrnTotRrmmPosn(schedule,p_logfile,p_repfile,&l_dbl_naccredit_indotlval,&l_dbl_val_rectotlval,&l_dbl_val_deltotlval,p_nrow,&p_intl_envdatastruct_h,&l_debug_info_ptr)==APL_FAILURE)
					APL_GOBACK_FAIL
				int_l_recpresent = 0;
				APL_GOBACK_SUCCESS
			}


			if (strcmp(chr_l_h_prevlocn,chr_l_h_rulocation) != 0 )
			{
				int_l_new_flg = 1;	

				if (strcmp(chr_l_h_prevlocn,"") != 0)
				{
					 
				
					if(PrnTotRrmmPosn(schedule,p_logfile,p_repfile,&l_dbl_naccredit_indotlval,&l_dbl_val_rectotlval,&l_dbl_val_deltotlval,p_nrow,p_intl_envdatastruct_h,&l_debug_info_ptr)==APL_FAILURE)
						APL_GOBACK_FAIL
	
					l_dbl_naccredit_indotlval = 0.0; 	
					l_dbl_val_rectotlval = 0.0;
					l_dbl_val_deltotlval = 0.0;
					
				}
				else
				{
					int_l_rep_hdr_flg = 1;
					int_retval = 0;
					int_retval = PrnRepHdrFn(p_logfile, p_repfile,p_int_pageno, p_nrow, p_str_parm, &l_debug_info_ptr);
					if (int_retval != APL_SUCCESS)
					{
						CO_ProcMonitor(p_logfile,"Unable to Write the Report Header for Generate By Location\n",NULL,NULL);
						APL_GOBACK_FAIL
					}
				}
			}
			if(DoRrmmiterations(schedule,int_l_nodataflg,int_l_new_flg,&l_dbl_naccredit_indotlval,&l_dbl_val_rectotlval,&l_dbl_val_deltotlval,p_int_pageno,p_nrow,chr_l_h_ruclient,chr_l_h_ruinstrcode,chr_l_h_stregno,chr_l_h_rulocation,l_dbl_safekeep_pos,l_dbl_val_rec,l_dbl_val_del,p_logfile,p_repfile,p_str_parm,&p_intl_envdatastruct_h,&l_debug_info_ptr)==APL_FAILURE)
					APL_GOBACK_FAIL
			
			int_l_new_flg = 0;					
			int_l_rep_hdr_flg = 0;
			strcpy(chr_l_h_prevlocn,chr_l_h_rulocation);
			if (int_l_nodataflg == 1)
				APL_GOBACK_SUCCESS
		}
		
		if (int_l_cursor == 1)
		{
			EXEC SQL CLOSE curr_LOrrmm1;
		}
		else if (int_l_cursor == 2)
		{
			EXEC SQL CLOSE curr_LOrrmm2;
		}
		else if (int_l_cursor == 3)
		{	
			EXEC SQL CLOSE curr_LOrrmm3;
		}

		int_l_cursor =0;
		IS_ANY_ORA_ERROR

	}
	
	else 
	{
		strcpy(schedule,"LO");
		strcpy(chr_l_h_rulocation, p_str_parm[3]);
	
		int_l_new_flg = 1;  
		int_l_rep_hdr_flg = 1;

		if ((strcmp(p_str_parm[0],"0") == 0) && ((*p_nrow) <= (PAGE_LENGTH - 15)))
			int_l_rep_hdr_flg = 2; 
		
		if (int_l_rep_hdr_flg != 2)
		{
			int_retval = 0;
			int_retval = PrnRepHdrFn(p_logfile, p_repfile,p_int_pageno, p_nrow, p_str_parm, &l_debug_info_ptr);
			if (int_retval != APL_SUCCESS)
			{
				CO_ProcMonitor(p_logfile,"Unable to Write the Header for Generate By Customer\n",NULL,NULL);
				APL_GOBACK_FAIL
			}

		}	
		int_l_rep_hdr_flg = 0;

		
      if (strcmp(p_str_parm[5], "") == 0)
      {
			int_l_cursor =1;	
			EXEC SQL DECLARE curr_LOrrmm11 CURSOR FOR
			SELECT LOCATION_CD,ST_REG_NO,SUM(SAFEKEEP_POS),SUM(VAL_REC),SUM(VAL_DEL) 
			FROM DL_RUSAFEK
			WHERE LOCATION_CD= :chr_l_h_rulocation
			GROUP BY LOCATION_CD,ST_REG_NO;
		}
		else
		{
			strcpy(chr_l_h_passdate, p_str_parm[5]);
			chr_l_h_passdate[19]='\0';

         memset(chr_l_sys_date, APL_NULL_CHAR, APL_DATE_LEN);
          int_retval = 0;
          int_retval =  CO_RtvSysDt(chr_l_sys_date, l_debug_info_ptr);

         if (int_retval != APL_SUCCESS)
         {
            CO_ProcMonitor(p_logfile,"Error in getting the system chr_date\n",NULL,NULL);
            APL_GOBACK_FAIL
         }
         int_retval = 0;
         int_retval =  CO_Pro_DateComp(chr_l_h_passdate, chr_l_sys_date, &int_l_diff, l_debug_info_ptr) ;

         if (int_retval != APL_SUCCESS)
         {
            CO_ProcMonitor(p_logfile,"Error in comparing the dates\n", NULL, NULL);
            APL_GOBACK_FAIL
         }
         if ( int_l_diff == 0 )
         {
				int_l_cursor =2;
				EXEC SQL DECLARE curr_LOrrmm12 CURSOR FOR
         	SELECT LOCATION_CD,ST_REG_NO,SUM(SAFEKEEP_POS),SUM(VAL_REC),SUM(VAL_DEL)
         	FROM DL_RUSAFEK
        		 WHERE LOCATION_CD= :chr_l_h_rulocation
         	GROUP BY LOCATION_CD,ST_REG_NO;
      	}
      	else if 	(int_l_diff > 0)
			{
				int_l_cursor = 3;
				EXEC SQL DECLARE curr_LOrrmm13 CURSOR FOR
            SELECT LOCATION_CD,ST_REG_NO,SUM(SAFEKEEP_POS),SUM(VAL_REC),SUM(VAL_DEL)
            FROM DL_RUHISSAFEK
				WHERE LOCATION_CD= :chr_l_h_rulocation
				AND POSIT_DATE = :chr_l_h_passdate
				GROUP BY LOCATION_CD,ST_REG_NO;
			}
		}
		IS_ANY_ORA_ERROR

			if (int_l_cursor == 1)
			{
				EXEC SQL OPEN curr_LOrrmm11;
			}
			else if (int_l_cursor == 2)
			{
				EXEC SQL OPEN curr_LOrrmm12;
			}
			else if (int_l_cursor == 3)
			{
				EXEC SQL OPEN curr_LOrrmm13;
			}
	
		IS_ANY_ORA_ERROR

		for (;;)
		{

			memset(chr_l_h_rulocation,APL_NULL_CHAR,sizeof(LOC_CD_LEN_A));
         memset(chr_l_h_stregno,APL_NULL_CHAR,sizeof(STAT_REG_NO_LEN));

			if (int_l_cursor == 1)
			{
				EXEC SQL FETCH curr_LOrrmm11 INTO :chr_l_h_rulocation:l_i_rulocation,:chr_l_h_stregno:l_i_stregno,:l_dbl_safekeep_pos:l_i_safek,:l_dbl_val_rec:l_i_confrec,:l_dbl_val_del:l_i_confdel;
			}
			else if (int_l_cursor == 2)
			{
				EXEC SQL FETCH curr_LOrrmm12 INTO :chr_l_h_rulocation:l_i_rulocation,:chr_l_h_stregno:l_i_stregno,:l_dbl_safekeep_pos:l_i_safek,:l_dbl_val_rec:l_i_confrec,:l_dbl_val_del:l_i_confdel;
			}
			else if (int_l_cursor == 3)
			{
				EXEC SQL FETCH curr_LOrrmm13 INTO :chr_l_h_rulocation:l_i_rulocation,:chr_l_h_stregno:l_i_stregno,:l_dbl_safekeep_pos:l_i_safek,:l_dbl_val_rec:l_i_confrec,:l_dbl_val_del:l_i_confdel;
			}	

			IS_ANY_ORA_ERROR
			if (!sqlca.sqlerrd[2])
				int_l_nodataflg = 1;
			else if(APL_ZERO_RESULT_SET)
				break;

			if(DoRrmmiterations(schedule,int_l_nodataflg,int_l_new_flg,&l_dbl_naccredit_indotlval,&l_dbl_val_rectotlval,&l_dbl_val_deltotlval,p_int_pageno,p_nrow,chr_l_h_ruclient,chr_l_h_ruinstrcode,chr_l_h_stregno,chr_l_h_rulocation,l_dbl_safekeep_pos,l_dbl_val_rec,l_dbl_val_del,p_logfile,p_repfile,p_str_parm,&p_intl_envdatastruct_h,&l_debug_info_ptr)==APL_FAILURE)
					APL_GOBACK_FAIL
			
			int_l_new_flg = 0;	
			int_l_rep_hdr_flg = 0;
			if (int_l_nodataflg == 1)
				APL_GOBACK_SUCCESS
		}
	
		
		if(PrnTotRrmmPosn(schedule,p_logfile,p_repfile,&l_dbl_naccredit_indotlval,&l_dbl_val_rectotlval,&l_dbl_val_deltotlval,p_nrow,&p_intl_envdatastruct_h,&l_debug_info_ptr)==APL_FAILURE)
			APL_GOBACK_FAIL
		
		l_dbl_naccredit_indotlval = 0.0; 	
		l_dbl_val_rectotlval = 0.0;
		l_dbl_val_deltotlval = 0.0;

		if (int_l_cursor == 1)
		{
			EXEC SQL CLOSE curr_LOrrmm11;
		}
		else if (int_l_cursor == 2)
		{
			EXEC SQL CLOSE curr_LOrrmm12;
		}
		else if (int_l_cursor == 3)
		{
			EXEC SQL CLOSE curr_LOrrmm13;	
		}

	   IS_ANY_ORA_ERROR

	}

	APL_GOBACK_SUCCESS

	

	RETURN_FAILURE:
		CO_ProcMonitor(p_logfile,"Exiting out of DorrmLoAll Unsuccessfully\n",NULL,NULL);
		return (APL_FAILURE);

	 RETURN_SUCCESS:
		 CO_ProcMonitor(p_logfile,"Exiting out of DorrmLoAll Successfully\n",NULL,NULL);
		 return (APL_SUCCESS);

} 




int DoRrsfkiterations(char *schedule,int p_nodataflg,int p_new_flg,double *nclttotlval,double *confrectotlval,double *confdeltotlval,int *p_int_pageno, int *p_nrow,char *p_h_client,char *p_h_instr_code,char *p_h_location,double p_dbl_safek,double p_dbl_confrec,double p_dbl_confdel,FILE *p_logfile,FILE *p_repfile,char **p_str_parm,INTL_ENV_DATA_STRUCT_H *p_intl_envdatastruct_h,DEBUG_INFO_STRUCT_H **l_debug_info_ptr)
{
	
	char chr_l_h_accname[CLT_NAME_LEN_A] 		 	 = APL_NULL_STRING ;
	char chr_l_h_instrdesc[INSTR_NAME_LEN_C]        = APL_NULL_STRING ;
	char chr_l_h_locndesc[LOC_DET_LEN]		 = APL_NULL_STRING ;


	char chr_l_str_ntotlvaal_ip[SAFEK_LENGTH]	 = APL_NULL_STRING; 
	char chr_l_str_ntotlvaal_op[SAFEK_LENGTH]	 = APL_NULL_STRING; 	
	
	short l_i_accname = 0;
	short l_i_instr_name = 0;
	short l_i_locndesc = 0;
	short l_i_repdate = 0;
	
	char chr_l_subhdr_typ[2] = APL_NULL_STRING;	
	char *temp = NULL;
	int int_int_category = 0;
	int int_retval = 0;
	int int_first = 1;					
	int int_dash_ctr = 1;
	
	double ntotlvaal = 0.0; 	
	double ntotlconfr = 0.0;
	double ntotlconfd = 0.0;

	EXEC SQL VAR chr_l_h_accname IS STRING;
	EXEC SQL VAR chr_l_h_instrdesc IS STRING;
	EXEC SQL VAR chr_l_h_locndesc IS STRING;
	
	temp = (char *)calloc(APL_MAXLINE_SIZE, sizeof(char));

	fprintf(p_logfile,"Entered Function DoRrsfkiterations\n");


	if (strcmp(schedule,"AC") == 0)
		int_int_category = 1;
	else if (strcmp(schedule,"SE") == 0)
		int_int_category = 2;
	else if (strcmp(schedule,"LO") == 0)
		int_int_category = 3;

	if (p_nodataflg == 1)
	{
			

		if (int_int_category == 1)
		{
			fprintf(p_logfile,"Core:- No records exist for Customer : %s\n",p_h_client);
			fprintf(p_repfile,"\n\n");
			fprintf(p_repfile,"%30s"," ");
			fprintf(p_repfile, "No Core positions exist for Customer : %s\n\n\n",p_h_client);
		}

		if (int_int_category == 2)
		{
			fprintf(p_logfile,"Core:- No records exist for Instrurity : %s\n",p_h_instr_code);
			fprintf(p_repfile,"\n\n");
			fprintf(p_repfile,"%30s"," ");
			fprintf(p_repfile, "No Core positions exist for Instrurity : %s\n\n\n",p_h_instr_code);
		}
		
		if (int_int_category == 3)
		{
			fprintf(p_logfile,"Core:- No records exist for Location : %s\n",p_h_location);
			fprintf(p_repfile,"\n\n");
			fprintf(p_repfile,"%30s"," ");
			fprintf(p_repfile, "No Core positions exist for Location : %s\n\n\n",p_h_location);
		}
		
		APL_GOBACK_SUCCESS
	}

	switch(int_int_category)
	{
		case 1:            
			if (p_new_flg == 1)
			{

				memset(chr_l_h_accname,APL_NULL_CHAR,sizeof(CLT_NAME_LEN_A));

				EXEC SQL SELECT CLN_NAME INTO :chr_l_h_accname:l_i_accname
				FROM MT_CLIENT WHERE CLN_CODE = :p_h_client;
			
				IS_ANY_ORA_ERROR

				if ((*p_nrow) >= (PAGE_LENGTH - 5))
				{
					
					int_retval = 0;
					int_retval = PrnRepHdrFn(p_logfile, p_repfile,p_int_pageno, p_nrow, p_str_parm, &l_debug_info_ptr);
					if (int_retval != APL_SUCCESS)
					{
						CO_ProcMonitor(p_logfile,"Unable to Write the Header for Generate By Customer\n",NULL,NULL);
						APL_GOBACK_FAIL
					}
				}					
			
				
				fprintf(p_repfile,"ACCOUNT CODE :    ");
				fprintf(p_repfile,p_h_client);
				fprintf(p_repfile,"\nACCOUNT NAME :    ");
				fprintf(p_repfile,chr_l_h_accname);   
				fprintf(p_repfile,"\n");
				for (int_dash_ctr=1;int_dash_ctr<= REPORT_WIDTH;int_dash_ctr++)
				{
					fprintf(p_repfile,"-");
				}
				
				strcpy(chr_l_subhdr_typ,"S");
				int_retval = 0;
				int_retval = SafekDsHeader(p_repfile,p_logfile,p_nrow,chr_l_subhdr_typ);
				if (int_retval != APL_SUCCESS)
				{
					CO_ProcMonitor(p_logfile,"Unable to Write the Sub-Header for Generate By Customer\n",NULL,NULL);
					APL_GOBACK_FAIL
				}
				(*p_nrow) += 5;

			} 

			

			if ((*p_nrow) >= (PAGE_LENGTH - 3))
			{
				int_retval = 0;
				int_retval = PrnRepHdrFn(p_logfile, p_repfile,p_int_pageno, p_nrow, p_str_parm, &l_debug_info_ptr );
				if (int_retval != APL_SUCCESS)
				{
					CO_ProcMonitor(p_logfile,"Unable to Write the Header for Generate By Customer\n",NULL,NULL);
					APL_GOBACK_FAIL
				}
			}

			ntotlvaal = p_dbl_safek; 				
			(*nclttotlval) += ntotlvaal;	

			ntotlconfr = p_dbl_confrec; 			
			(*confrectotlval) += ntotlconfr;	

			ntotlconfd = p_dbl_confdel; 			
			(*confdeltotlval) += ntotlconfd;	
			
			fprintf(p_repfile,"%-10s",p_h_instr_code);
			fprintf(p_repfile,"      ");

			memset(chr_l_h_instrdesc,APL_NULL_CHAR,sizeof(INSTR_NAME_LEN_C));

			EXEC SQL SELECT REPLACE(REPLACE(SUBSTR(LTRIM(MT_INSTRUMENT.INSTR_NAME),1,30),CHR(13),' '),chr(10)) 
			INTO :chr_l_h_instrdesc:l_i_instr_name FROM MT_INSTRUMENT WHERE INSTR_CODE = :p_h_instr_code;

			IS_ANY_ORA_ERROR


			CO_Trim(chr_l_h_instrdesc,' ','R',temp,l_debug_info_ptr);
			strcpy(chr_l_h_instrdesc,temp);
		
			

			fprintf(p_repfile,"%-30s",chr_l_h_instrdesc);

			memset(chr_l_str_ntotlvaal_ip,APL_NULL_CHAR,SAFEK_LENGTH);
			memset(chr_l_str_ntotlvaal_op,APL_NULL_CHAR,SAFEK_LENGTH);

			
			sprintf(chr_l_str_ntotlvaal_ip , "%.2lf" , ntotlconfr);
			int_retval = 0;
			
			CO_Rtv_FormatAmt(ntotlconfr, chr_l_str_ntotlvaal_op, 'Y', 'Y', l_debug_info_ptr);
			

			fprintf(p_repfile,"  ");
			
			CO_Trim(chr_l_str_ntotlvaal_op,' ','L',temp,l_debug_info_ptr);
			strcpy(chr_l_str_ntotlvaal_op,temp);
			temp = (char *)calloc(APL_MAXLINE_SIZE, sizeof(char));
			 fprintf(p_repfile,"%21s",chr_l_str_ntotlvaal_op); 
			

			memset(chr_l_str_ntotlvaal_ip,APL_NULL_CHAR,SAFEK_LENGTH);
			memset(chr_l_str_ntotlvaal_op,APL_NULL_CHAR,SAFEK_LENGTH);
			
			
			sprintf(chr_l_str_ntotlvaal_ip , "%.2lf" , ntotlconfd);
			int_retval = 0;
			
						CO_Rtv_FormatAmt(ntotlconfd, chr_l_str_ntotlvaal_op, 'Y', 'Y', l_debug_info_ptr);
			
			 CO_Trim(chr_l_str_ntotlvaal_op,' ','L',temp,l_debug_info_ptr);
				strcpy(chr_l_str_ntotlvaal_op,temp);
				temp = (char *)calloc(APL_MAXLINE_SIZE, sizeof(char));

			fprintf(p_repfile,"  ");
			
			fprintf(p_repfile,"%16s",chr_l_str_ntotlvaal_op);
			
			memset(chr_l_str_ntotlvaal_ip,APL_NULL_CHAR,SAFEK_LENGTH);
			memset(chr_l_str_ntotlvaal_op,APL_NULL_CHAR,SAFEK_LENGTH);
			
			
			sprintf(chr_l_str_ntotlvaal_ip , "%.2lf" , ntotlvaal);
			int_retval = 0;
			
			CO_Rtv_FormatAmt(ntotlvaal, chr_l_str_ntotlvaal_op, 'Y', 'Y', l_debug_info_ptr);
			
		
			CO_Trim(chr_l_str_ntotlvaal_op,' ','L',temp,l_debug_info_ptr);
         strcpy(chr_l_str_ntotlvaal_op,temp);
         temp = (char *)calloc(APL_MAXLINE_SIZE, sizeof(char));

			fprintf(p_repfile,"  ");
			fprintf(p_repfile,"%15s",chr_l_str_ntotlvaal_op);
			fprintf(p_repfile,"\n");	
			
			memset(chr_l_str_ntotlvaal_ip,APL_NULL_CHAR,SAFEK_LENGTH);
			memset(chr_l_str_ntotlvaal_op,APL_NULL_CHAR,SAFEK_LENGTH);
			
			(*p_nrow)++;
		
		break;            	
	
		case 2:				

			if (p_new_flg == 1)
			{

				memset(chr_l_h_instrdesc,APL_NULL_CHAR,sizeof(INSTR_NAME_LEN_C));

				EXEC SQL SELECT REPLACE(REPLACE(SUBSTR(LTRIM(MT_INSTRUMENT.INSTR_NAME),1,35),CHR(13),' '),chr(10))
				INTO :chr_l_h_instrdesc:l_i_instr_name FROM MT_INSTRUMENT WHERE INSTR_CODE = :p_h_instr_code;

				IS_ANY_ORA_ERROR

				CO_Trim(chr_l_h_instrdesc,' ','R',temp,l_debug_info_ptr);
				strcpy(chr_l_h_instrdesc,temp);

				if ((*p_nrow) >= (PAGE_LENGTH - 3))
				{
					
					int_retval = 0;
					int_retval = PrnRepHdrFn(p_logfile, p_repfile,p_int_pageno, p_nrow, p_str_parm, &l_debug_info_ptr);
					if (int_retval != APL_SUCCESS)
					{
						CO_ProcMonitor(p_logfile,"Unable to Write the Header for Generate By Customer\n",NULL,NULL);
						APL_GOBACK_FAIL
					}
				}					
			
				
				fprintf(p_repfile,"INSTRUMENT CODE :    ");
				fprintf(p_repfile,p_h_instr_code);
				fprintf(p_repfile,"\nINSTRUMENT NAME :    ");
				fprintf(p_repfile,chr_l_h_instrdesc);   
				fprintf(p_repfile,"\n");
				for (int_dash_ctr=1;int_dash_ctr<= REPORT_WIDTH;int_dash_ctr++)
				{
					fprintf(p_repfile,"-");
				}
				
				strcpy(chr_l_subhdr_typ,"A");
				int_retval = 0;
				int_retval = SafekDsHeader(p_repfile,p_logfile,p_nrow,chr_l_subhdr_typ);
				if (int_retval != APL_SUCCESS)
				{
					CO_ProcMonitor(p_logfile,"Unable to Write the Sub-Header for Generate By Instrurity\n",NULL,NULL);
					APL_GOBACK_FAIL
				}
				(*p_nrow) += 5;

			} 

			

			if ((*p_nrow) >= (PAGE_LENGTH - 3))
			{
				int_retval = 0;
				int_retval = PrnRepHdrFn(p_logfile, p_repfile,p_int_pageno, p_nrow, p_str_parm, &l_debug_info_ptr);
				if (int_retval != APL_SUCCESS)
				{
					CO_ProcMonitor(p_logfile,"Unable to Write the Header for Generate By Instrurity\n",NULL,NULL);
					APL_GOBACK_FAIL
				}
			}

			ntotlvaal = p_dbl_safek;            
			(*nclttotlval) += ntotlvaal;  

			ntotlconfr = p_dbl_confrec;         
			(*confrectotlval) += ntotlconfr; 

			ntotlconfd = p_dbl_confdel;         
			(*confdeltotlval) += ntotlconfd; 

			fprintf(p_repfile,"%-10s",p_h_client);
			fprintf(p_repfile,"      ");

			memset(chr_l_h_accname,APL_NULL_CHAR,sizeof(CLT_NAME_LEN_A));

			EXEC SQL SELECT REPLACE(REPLACE(SUBSTR(LTRIM(MT_CLIENT.CLN_NAME),1,30),CHR(13),' '),chr(10))
			INTO :chr_l_h_accname:l_i_accname FROM MT_CLIENT WHERE CLN_CODE = :p_h_client;

			IS_ANY_ORA_ERROR

			temp = (char *)calloc(APL_MAXLINE_SIZE, sizeof(char));
			CO_Trim(chr_l_h_accname,' ','R',temp,l_debug_info_ptr);
			strcpy(chr_l_h_accname,temp);

			fprintf(p_repfile,"%-30s",chr_l_h_accname);

			memset(chr_l_str_ntotlvaal_ip,APL_NULL_CHAR,SAFEK_LENGTH);
			memset(chr_l_str_ntotlvaal_op,APL_NULL_CHAR,SAFEK_LENGTH);
			
			
			sprintf(chr_l_str_ntotlvaal_ip , "%.2lf" , ntotlconfr);
			int_retval = 0;
			
						CO_Rtv_FormatAmt(ntotlconfr, chr_l_str_ntotlvaal_op, 'Y', 'Y', l_debug_info_ptr);
			

			CO_Trim(chr_l_str_ntotlvaal_op,' ','L',temp,l_debug_info_ptr);
			strcpy(chr_l_str_ntotlvaal_op,temp);
			temp = (char *)calloc(APL_MAXLINE_SIZE, sizeof(char));
			
			fprintf(p_repfile,"  ");
			fprintf(p_repfile,"%21s",chr_l_str_ntotlvaal_op);

			memset(chr_l_str_ntotlvaal_ip,APL_NULL_CHAR,SAFEK_LENGTH);
			memset(chr_l_str_ntotlvaal_op,APL_NULL_CHAR,SAFEK_LENGTH);
			
			
			sprintf(chr_l_str_ntotlvaal_ip , "%.2lf" , ntotlconfd);
			int_retval = 0;
			
						CO_Rtv_FormatAmt(ntotlconfd, chr_l_str_ntotlvaal_op, 'Y', 'Y', l_debug_info_ptr);
			

			CO_Trim(chr_l_str_ntotlvaal_op,' ','L',temp,l_debug_info_ptr);
			strcpy(chr_l_str_ntotlvaal_op,temp);
			temp = (char *)calloc(APL_MAXLINE_SIZE, sizeof(char));

			fprintf(p_repfile,"  ");
			fprintf(p_repfile,"%16s",chr_l_str_ntotlvaal_op);

			memset(chr_l_str_ntotlvaal_ip,APL_NULL_CHAR,SAFEK_LENGTH);
			memset(chr_l_str_ntotlvaal_op,APL_NULL_CHAR,SAFEK_LENGTH);

			
			sprintf(chr_l_str_ntotlvaal_ip , "%.2lf" , ntotlvaal);
			int_retval = 0;
			
						CO_Rtv_FormatAmt(ntotlvaal, chr_l_str_ntotlvaal_op, 'Y', 'Y', l_debug_info_ptr);
			

			CO_Trim(chr_l_str_ntotlvaal_op,' ','L',temp,l_debug_info_ptr);
			strcpy(chr_l_str_ntotlvaal_op,temp);
			temp = (char *)calloc(APL_MAXLINE_SIZE, sizeof(char));

			fprintf(p_repfile,"  ");
			fprintf(p_repfile,"%15s",chr_l_str_ntotlvaal_op);
		
			memset(chr_l_str_ntotlvaal_ip,APL_NULL_CHAR,SAFEK_LENGTH);
			memset(chr_l_str_ntotlvaal_op,APL_NULL_CHAR,SAFEK_LENGTH);
		
			
			fprintf(p_repfile,"\n");	
			(*p_nrow)++;

		break;					
	
		case 3:				

			if (p_new_flg == 1)
			{

				memset(chr_l_h_locndesc,APL_NULL_CHAR,sizeof(LOC_DET_LEN));

				EXEC SQL SELECT REPLACE(REPLACE(SUBSTR(LTRIM(MT_LOCATION.LOCATION_DESC),1,35),CHR(13),' '),chr(10))		
				INTO :chr_l_h_locndesc:l_i_locndesc FROM MT_LOCATION WHERE LOCATION_CD = :p_h_location;
				
				IS_ANY_ORA_ERROR
				

				if ((*p_nrow) >= (PAGE_LENGTH - 3))
				{
					
					int_retval = 0;
					int_retval = PrnRepHdrFn(p_logfile, p_repfile,p_int_pageno, p_nrow, p_str_parm, &l_debug_info_ptr);
					if (int_retval != APL_SUCCESS)
					{
						CO_ProcMonitor(p_logfile,"Unable to Write the Header for Generate By Location\n",NULL,NULL);
						APL_GOBACK_FAIL
					}
				}					
			
				
				fprintf(p_repfile,"LOCATION CODE :    ");
				fprintf(p_repfile,p_h_location);
				fprintf(p_repfile,"\nLOCATION DESC :    ");
				fprintf(p_repfile,chr_l_h_locndesc);   
				fprintf(p_repfile,"\n");
				for (int_dash_ctr=1;int_dash_ctr<= REPORT_WIDTH;int_dash_ctr++)
				{
					fprintf(p_repfile,"-");
				}
				
				strcpy(chr_l_subhdr_typ,"S");
				int_retval = 0;
				int_retval = SafekDsHeader(p_repfile,p_logfile,p_nrow,chr_l_subhdr_typ);
				if (int_retval != APL_SUCCESS)
				{
					CO_ProcMonitor(p_logfile,"Unable to Write the Sub-Header for Generate By Location\n",NULL,NULL);
					APL_GOBACK_FAIL
				}
				((*p_nrow) += 5);

			} 

			

			if ((*p_nrow) >= (PAGE_LENGTH - 3))
			{
				int_retval = 0;
				int_retval = PrnRepHdrFn(p_logfile, p_repfile,p_int_pageno, p_nrow, p_str_parm, &l_debug_info_ptr);
				if (int_retval != APL_SUCCESS)
				{
					CO_ProcMonitor(p_logfile,"Unable to Write the Header for Generate By Location\n",NULL,NULL);
					APL_GOBACK_FAIL
				}
			}

			ntotlvaal = p_dbl_safek;            
			(*nclttotlval) += ntotlvaal;  

			ntotlconfr = p_dbl_confrec;         
			(*confrectotlval) += ntotlconfr; 

			ntotlconfd = p_dbl_confdel;         
			(*confdeltotlval) += ntotlconfd; 

			fprintf(p_repfile,"%-10s",p_h_instr_code);
			fprintf(p_repfile,"      ");

			memset(chr_l_h_instrdesc,APL_NULL_CHAR,sizeof(INSTR_NAME_LEN_C));

			EXEC SQL SELECT REPLACE(REPLACE(SUBSTR(LTRIM(MT_INSTRUMENT.INSTR_NAME),1,30),CHR(13),' '),chr(10))
			INTO :chr_l_h_instrdesc:l_i_instr_name FROM MT_INSTRUMENT WHERE INSTR_CODE = :p_h_instr_code;

			IS_ANY_ORA_ERROR

			CO_Trim(chr_l_h_instrdesc,' ','R',temp,l_debug_info_ptr);
			strcpy(chr_l_h_instrdesc,temp);

			fprintf(p_repfile,"%-30s",chr_l_h_instrdesc);

			memset(chr_l_str_ntotlvaal_ip,APL_NULL_CHAR,SAFEK_LENGTH);
			memset(chr_l_str_ntotlvaal_op,APL_NULL_CHAR,SAFEK_LENGTH);
			
			
			sprintf(chr_l_str_ntotlvaal_ip , "%.2lf" , ntotlconfr);
			int_retval = 0;
			
						CO_Rtv_FormatAmt(ntotlconfr, chr_l_str_ntotlvaal_op, 'Y', 'Y', l_debug_info_ptr);
			

			CO_Trim(chr_l_str_ntotlvaal_op,' ','L',temp,l_debug_info_ptr);
			strcpy(chr_l_str_ntotlvaal_op,temp);
			temp = (char *)calloc(APL_MAXLINE_SIZE, sizeof(char));

			fprintf(p_repfile,"  ");
			fprintf(p_repfile,"%21s",chr_l_str_ntotlvaal_op);

			memset(chr_l_str_ntotlvaal_ip,APL_NULL_CHAR,SAFEK_LENGTH);
			memset(chr_l_str_ntotlvaal_op,APL_NULL_CHAR,SAFEK_LENGTH);

			
			sprintf(chr_l_str_ntotlvaal_ip , "%.2lf" , ntotlconfd);
			int_retval = 0;
			
						CO_Rtv_FormatAmt(ntotlconfd, chr_l_str_ntotlvaal_op, 'Y', 'Y', l_debug_info_ptr);
			

			CO_Trim(chr_l_str_ntotlvaal_op,' ','L',temp,l_debug_info_ptr);
			strcpy(chr_l_str_ntotlvaal_op,temp);
			temp = (char *)calloc(APL_MAXLINE_SIZE, sizeof(char));

			fprintf(p_repfile,"  ");
			fprintf(p_repfile,"%16s",chr_l_str_ntotlvaal_op);

			memset(chr_l_str_ntotlvaal_ip,APL_NULL_CHAR,SAFEK_LENGTH);
			memset(chr_l_str_ntotlvaal_op,APL_NULL_CHAR,SAFEK_LENGTH);

			
			sprintf(chr_l_str_ntotlvaal_ip , "%.2lf" , ntotlvaal);
			int_retval = 0;
			
						CO_Rtv_FormatAmt(ntotlvaal, chr_l_str_ntotlvaal_op, 'Y', 'Y', l_debug_info_ptr);
			

			CO_Trim(chr_l_str_ntotlvaal_op,' ','L',temp,l_debug_info_ptr);
			strcpy(chr_l_str_ntotlvaal_op,temp);
			temp = (char *)calloc(APL_MAXLINE_SIZE, sizeof(char));

			fprintf(p_repfile,"  ");
			fprintf(p_repfile,"%15s",chr_l_str_ntotlvaal_op);
			fprintf(p_repfile,"\n");	
			
			memset(chr_l_str_ntotlvaal_ip,APL_NULL_CHAR,SAFEK_LENGTH);
			memset(chr_l_str_ntotlvaal_op,APL_NULL_CHAR,SAFEK_LENGTH);
			
			(*p_nrow)++;

		break;					
	}

	APL_GOBACK_SUCCESS

	

	RETURN_FAILURE:
		CO_ProcMonitor(p_logfile,"Exiting out of DoRrsfkiterations Unsuccessfully\n",NULL,NULL);
		return (APL_FAILURE);

	 RETURN_SUCCESS:
		 CO_ProcMonitor(p_logfile,"Exiting out of DoRrsfkiterations Successfully\n",NULL,NULL);
		 return (APL_SUCCESS);

} 	 




int DoRrmmiterations(char *schedule,int p_nodataflg,int p_new_flg,double *nclttotlval,double *confrectotlval,double * confdeltotlval,int *p_int_pageno, int *p_nrow,char *p_h_ruclient,char *p_h_ruinstrode,char *p_h_stregno,char *p_h_rulocation,double p_dbl_safek,double p_dbl_confrec,double p_dbl_confdel,FILE *p_logfile,FILE *p_repfile,char **p_str_parm,INTL_ENV_DATA_STRUCT_H *p_intl_envdatastruct_h,DEBUG_INFO_STRUCT_H ** l_debug_info_ptr)
{
	
	char chr_l_h_accname[CLT_NAME_LEN_A] 		 	 = APL_NULL_STRING;

	char chr_l_h_ruaccname[CLT_NAME_LEN_A]		 = APL_NULL_STRING;
	char chr_l_h_instrdesc[INSTR_NAME_LEN_C]        = APL_NULL_STRING;
	char chr_l_h_ruinstrdesc[INSTR_NAME_LEN_C]		 = APL_NULL_STRING;
	char chr_l_h_locndesc[LOC_DET_LEN]		 = APL_NULL_STRING;

	char chr_l_str_ntotlvaal_ip[SAFEK_LENGTH]	 = APL_NULL_STRING; 
	char chr_l_str_ntotlvaal_op[SAFEK_LENGTH]	 = APL_NULL_STRING; 	
	
	short l_i_accname = 0 ;
	short l_i_ruaccname = 0;
	short l_i_instr_name = 0;
	short l_i_ruinstrdesc = 0;
	short l_i_locndesc = 0;

	int int_int_category = 0;

	char chr_l_subhdr_typ[2] = APL_NULL_STRING;	
	char *temp = NULL;
	char chr_l_str_temp[30]	= APL_NULL_STRING;
	int int_retval = 0;
	int int_first = 1;					
	int int_dash_ctr = 1;
	
	double ntotlvaal = 0.0; 		
	double ntotlconfr = 0.0;
	double ntotlconfd = 0.0;

	EXEC SQL VAR chr_l_h_accname IS STRING ;
	EXEC SQL VAR chr_l_h_instrdesc IS STRING;
	EXEC SQL VAR chr_l_h_ruinstrdesc IS STRING;
	EXEC SQL VAR chr_l_h_locndesc IS STRING;
	
	temp = (char *)calloc(APL_MAXLINE_SIZE, sizeof(char));

	fprintf(p_logfile,"Entered Function DoRrmmiterations\n"); 


	if (strcmp(schedule,"AC") == 0)
		int_int_category = 1;
	else if (strcmp(schedule,"SE") == 0)
		int_int_category = 2;
	else if (strcmp(schedule,"LO") == 0)
		int_int_category = 3;
	
	if (p_nodataflg == 1)
	{

		if (int_int_category == 1)
		{
			fprintf(p_logfile,"RRMM:- No records exist for Customer : %s\n",p_h_ruclient);
			fprintf(p_repfile,"\n\n");
			fprintf(p_repfile,"%30s"," ");
			fprintf(p_repfile, "No RRMM positions exist for Customer : %s",p_h_ruclient);
		}

		if (int_int_category == 2)
		{
			fprintf(p_logfile,"RRMM:- No records exist for Instrurity : %s\n",p_h_ruinstrode);
			fprintf(p_repfile,"\n\n");
			fprintf(p_repfile,"%30s"," ");
			fprintf(p_repfile, "No RRMM positions exist for Instrurity : %s",p_h_ruinstrode);
		}
		
		if (int_int_category == 3)
		{
			fprintf(p_logfile,"RRMM:- No records exist for Location : %s\n",p_h_rulocation);
			fprintf(p_repfile,"\n\n");
			fprintf(p_repfile,"%30s"," ");
			fprintf(p_repfile, "No RRMM positions exist for Location : %s",p_h_rulocation);
		}
		
		APL_GOBACK_SUCCESS
	}
	
	switch(int_int_category)
	{
		case 1:            
			if (p_new_flg == 1)
			{
				memset(chr_l_h_accname,APL_NULL_CHAR,sizeof(CLT_NAME_LEN_A));
				
				EXEC SQL SELECT SUBSTR(LTRIM(MT_CLIENT.CLN_NAME),1,35) INTO :chr_l_h_accname:l_i_accname
				FROM MT_CLIENT WHERE CLN_CODE = :p_h_ruclient;

				IS_ANY_ORA_ERROR

 				memset(chr_l_h_ruaccname,APL_NULL_CHAR,sizeof(CLT_NAME_LEN_A));

				EXEC SQL SELECT CLIENT_NAME INTO :chr_l_h_ruaccname:l_i_ruaccname
				FROM DL_RUCLIENT WHERE CLIENT = :p_h_ruclient;

				IS_ANY_ORA_ERROR

				if ((*p_nrow) >= (PAGE_LENGTH - 3)) 
				{
					
					int_retval = 0;
					int_retval = PrnRepHdrFn(p_logfile, p_repfile,p_int_pageno, p_nrow, p_str_parm, &l_debug_info_ptr);
					if (int_retval != APL_SUCCESS)
					{
						CO_ProcMonitor(p_logfile,"Unable to Write the Header for Generate By Customer\n",NULL,NULL);
						APL_GOBACK_FAIL
					}
				}					
			
				
				fprintf(p_repfile,"%30s"," ");
				
				fprintf(p_repfile,"  :");
				fprintf(p_repfile,p_h_ruclient);
				fprintf(p_repfile,"\n ");
				fprintf(p_repfile,chr_l_h_ruaccname);
				fprintf(p_repfile,"\nACCOUNT CODE :    ");
				fprintf(p_repfile,p_h_ruclient);
				fprintf(p_repfile,"\nACCOUNT NAME :    ");
				fprintf(p_repfile,chr_l_h_accname);   
				fprintf(p_repfile,"\n");
				for (int_dash_ctr=1;int_dash_ctr<= REPORT_WIDTH;int_dash_ctr++)
				{
					fprintf(p_repfile,"-");
				}
				
				strcpy(chr_l_subhdr_typ ,"S");
				int_retval = 0;
				int_retval = RRMMHeader(p_repfile,p_logfile,p_nrow,chr_l_subhdr_typ);
				if (int_retval != APL_SUCCESS)
				{
					CO_ProcMonitor(p_logfile,"Unable to Write the Sub-Header for Generate By Customer\n",NULL,NULL);
					APL_GOBACK_FAIL
				}
				(*p_nrow) += 8;

			} 

			

			if ((*p_nrow) >= (PAGE_LENGTH - 3))
			{
				int_retval = 0;
				int_retval = PrnRepHdrFn(p_logfile, p_repfile,p_int_pageno, p_nrow, p_str_parm, &l_debug_info_ptr);
				if (int_retval != APL_SUCCESS)
				{
					CO_ProcMonitor(p_logfile,"Unable to Write the Header for Generate By Customer\n",NULL,NULL);
					APL_GOBACK_FAIL
				}
			}

			ntotlvaal = p_dbl_safek;            
			(*nclttotlval) += ntotlvaal;  

			ntotlconfr = p_dbl_confrec;         
			(*confrectotlval) += ntotlconfr; 

			ntotlconfd = p_dbl_confdel;         
			(*confdeltotlval) += ntotlconfd; 

			CO_Trim(p_h_stregno,' ','R',temp,l_debug_info_ptr);
			strcpy(p_h_stregno,temp);
			
			if ((strlen(p_h_stregno) > 20) && (strlen(p_h_stregno) < 31))
			{
				
				strncpy(chr_l_str_temp,p_h_stregno,30);
				fprintf(p_repfile,"%-50s",chr_l_str_temp);
	
			}
			else if ((strlen(p_h_stregno)) < 21)
			{
				
				strncpy(chr_l_str_temp,p_h_stregno,20);
				fprintf(p_repfile,"%-50s",chr_l_str_temp);

			}
			else if ((strlen(p_h_stregno)) > 30)
			{
				
				strncpy(chr_l_str_temp,p_h_stregno,30);
				fprintf(p_repfile,chr_l_str_temp);
				strcpy(chr_l_str_temp,APL_NULL_STRING);

				
				strncpy(chr_l_str_temp,p_h_stregno+30,30);
				fprintf(p_repfile,"\n");
				fprintf(p_repfile,chr_l_str_temp);

			}

				

				
				sprintf(chr_l_str_ntotlvaal_ip , "%.2lf" , ntotlconfr);
				int_retval = 0;
				
							CO_Rtv_FormatAmt(ntotlconfr, chr_l_str_ntotlvaal_op, 'Y', 'Y', l_debug_info_ptr);
				

				CO_Trim(chr_l_str_ntotlvaal_op,' ','L',temp,l_debug_info_ptr);
				strcpy(chr_l_str_ntotlvaal_op,temp);
				temp = (char *)calloc(APL_MAXLINE_SIZE, sizeof(char));

				fprintf(p_repfile,"  ");
				fprintf(p_repfile,"%23s",chr_l_str_ntotlvaal_op);

				memset(chr_l_str_ntotlvaal_ip,APL_NULL_CHAR,SAFEK_LENGTH);
				memset(chr_l_str_ntotlvaal_op,APL_NULL_CHAR,SAFEK_LENGTH);


				
				sprintf(chr_l_str_ntotlvaal_ip , "%.2lf" , ntotlconfd);
				int_retval = 0;
				
							CO_Rtv_FormatAmt(ntotlconfd, chr_l_str_ntotlvaal_op, 'Y', 'Y', l_debug_info_ptr);
				

				CO_Trim(chr_l_str_ntotlvaal_op,' ','L',temp,l_debug_info_ptr);
				strcpy(chr_l_str_ntotlvaal_op,temp);
				temp = (char *)calloc(APL_MAXLINE_SIZE, sizeof(char));
				
				fprintf(p_repfile,"  ");
				fprintf(p_repfile,"%13s",chr_l_str_ntotlvaal_op);

				memset(chr_l_str_ntotlvaal_ip,APL_NULL_CHAR,SAFEK_LENGTH);
				memset(chr_l_str_ntotlvaal_op,APL_NULL_CHAR,SAFEK_LENGTH);
				
				
				sprintf(chr_l_str_ntotlvaal_ip , "%.2lf" , ntotlvaal);
				int_retval = 0;
				
							CO_Rtv_FormatAmt(ntotlvaal, chr_l_str_ntotlvaal_op, 'Y', 'Y', l_debug_info_ptr);
				

				CO_Trim(chr_l_str_ntotlvaal_op,' ','L',temp,l_debug_info_ptr);
				strcpy(chr_l_str_ntotlvaal_op,temp);
				temp = (char *)calloc(APL_MAXLINE_SIZE, sizeof(char));

				fprintf(p_repfile,"  ");
				fprintf(p_repfile,"%18s",chr_l_str_ntotlvaal_op);
				
				memset(chr_l_str_ntotlvaal_ip,APL_NULL_CHAR,SAFEK_LENGTH);
				memset(chr_l_str_ntotlvaal_op,APL_NULL_CHAR,SAFEK_LENGTH);

				if ((strlen(p_h_stregno)) > 30)	
					(*p_nrow) += 2;
				else
					(*p_nrow)++;
				fprintf(p_repfile,"\n");	
		
		break;            	
		
		case 2:				

			if (p_new_flg == 1)
			{

				memset(chr_l_h_instrdesc,APL_NULL_CHAR,sizeof(INSTR_NAME_LEN_C));	

				

				EXEC SQL SELECT REPLACE(REPLACE(SUBSTR(LTRIM(MT_INSTRUMENT.INSTR_NAME),1,35),CHR(13),' '),chr(10)) INTO :chr_l_h_instrdesc:l_i_instr_name FROM MT_INSTRUMENT WHERE INSTR_CODE = :p_h_ruinstrode;


				IS_ANY_ORA_ERROR

				if ((*p_nrow) >= (PAGE_LENGTH - 3)) 
				{
					
					int_retval = 0;
					int_retval = PrnRepHdrFn(p_logfile, p_repfile,p_int_pageno, p_nrow, p_str_parm, &l_debug_info_ptr);
					if (int_retval != APL_SUCCESS)
					{
						CO_ProcMonitor(p_logfile,"Unable to Write the Header for Generate By Customer\n",NULL,NULL);
						APL_GOBACK_FAIL
					}
				}					
			
				
				fprintf(p_repfile,"\nINSTRUMENT CODE :    ");
				fprintf(p_repfile,p_h_ruinstrode);
				fprintf(p_repfile,"  POSITION BY STATREGNO");
				fprintf(p_repfile,"\nINSTRUMENT NAME :    ");
				fprintf(p_repfile,chr_l_h_instrdesc);   
				fprintf(p_repfile,"\n");
				for (int_dash_ctr=1;int_dash_ctr<= REPORT_WIDTH;int_dash_ctr++)
				{
					fprintf(p_repfile,"-");
				}
				
				strcpy(chr_l_subhdr_typ,"A");
				int_retval = 0;
				int_retval = RRMMHeader(p_repfile,p_logfile,p_nrow,chr_l_subhdr_typ);
				if (int_retval != APL_SUCCESS)
				{
					CO_ProcMonitor(p_logfile,"Unable to Write the RRMM Sub-Header for Generate By Instrurity\n",NULL,NULL);
					APL_GOBACK_FAIL
				}
				(*p_nrow) += 5;

			} 

			

			if ((*p_nrow) >= (PAGE_LENGTH - 3))
			{
				int_retval = 0;
				int_retval = PrnRepHdrFn(p_logfile, p_repfile,p_int_pageno, p_nrow, p_str_parm, &l_debug_info_ptr);
				if (int_retval != APL_SUCCESS)
				{
					CO_ProcMonitor(p_logfile,"Unable to Write the RRMM Header for Generate By Instrurity\n",NULL,NULL);
					APL_GOBACK_FAIL
				}
			}

			ntotlvaal = p_dbl_safek;            
			(*nclttotlval) += ntotlvaal;  

			ntotlconfr = p_dbl_confrec;         
			(*confrectotlval) += ntotlconfr; 

			ntotlconfd = p_dbl_confdel;         
			(*confdeltotlval) += ntotlconfd; 

			memset(chr_l_h_ruinstrdesc,APL_NULL_CHAR,sizeof(INSTR_NAME_LEN_C));

			
				strcpy(chr_l_h_ruinstrdesc,p_h_stregno);

			CO_Trim(chr_l_h_ruinstrdesc,' ','R',temp,l_debug_info_ptr);
			strcpy(chr_l_h_ruinstrdesc,temp);
			
			if ((strlen(chr_l_h_ruinstrdesc) > 20) && (strlen(chr_l_h_ruinstrdesc) < 31))
			{
				
				strncpy(chr_l_str_temp,chr_l_h_ruinstrdesc,30);
				fprintf(p_repfile,"%-50s",chr_l_str_temp);

			}
			else if ((strlen(chr_l_h_ruinstrdesc)) < 21)
			{
				
				
				strncpy(chr_l_str_temp,chr_l_h_ruinstrdesc,20);
				fprintf(p_repfile,"%-50s",chr_l_str_temp);
				
			}
			else if ((strlen(chr_l_h_ruinstrdesc)) > 30)
			{
			
				
				strncpy(chr_l_str_temp,chr_l_h_ruinstrdesc,30);
				fprintf(p_repfile,chr_l_str_temp);
				strcpy(chr_l_str_temp,APL_NULL_STRING);

				
				strncpy(chr_l_str_temp,chr_l_h_ruinstrdesc+30,30);
				fprintf(p_repfile,"\n");
				fprintf(p_repfile,chr_l_str_temp);

			}

			

			
			sprintf(chr_l_str_ntotlvaal_ip , "%.2lf" , ntotlconfr);
			int_retval = 0;
			
						CO_Rtv_FormatAmt(ntotlconfr, chr_l_str_ntotlvaal_op, 'Y', 'Y', l_debug_info_ptr);
			

			CO_Trim(chr_l_str_ntotlvaal_op,' ','L',temp,l_debug_info_ptr);
			strcpy(chr_l_str_ntotlvaal_op,temp);
			temp = (char *)calloc(APL_MAXLINE_SIZE, sizeof(char));

			fprintf(p_repfile,"  ");
			fprintf(p_repfile,"%23s",chr_l_str_ntotlvaal_op);

			memset(chr_l_str_ntotlvaal_ip,APL_NULL_CHAR,SAFEK_LENGTH);
			memset(chr_l_str_ntotlvaal_op,APL_NULL_CHAR,SAFEK_LENGTH);

			
			sprintf(chr_l_str_ntotlvaal_ip , "%.2lf" , ntotlconfd);
			int_retval = 0;
			
						CO_Rtv_FormatAmt(ntotlconfd, chr_l_str_ntotlvaal_op, 'Y', 'Y', l_debug_info_ptr);
			
			CO_Trim(chr_l_str_ntotlvaal_op,' ','L',temp,l_debug_info_ptr);
			strcpy(chr_l_str_ntotlvaal_op,temp);
			temp = (char *)calloc(APL_MAXLINE_SIZE, sizeof(char));

			fprintf(p_repfile,"  ");
			fprintf(p_repfile,"%13s",chr_l_str_ntotlvaal_op);

			memset(chr_l_str_ntotlvaal_ip,APL_NULL_CHAR,SAFEK_LENGTH);
			memset(chr_l_str_ntotlvaal_op,APL_NULL_CHAR,SAFEK_LENGTH);
	
			
			sprintf(chr_l_str_ntotlvaal_ip , "%.2lf" , ntotlvaal);
			int_retval = 0;
			
						CO_Rtv_FormatAmt(ntotlvaal, chr_l_str_ntotlvaal_op, 'Y', 'Y', l_debug_info_ptr);
			

			CO_Trim(chr_l_str_ntotlvaal_op,' ','L',temp,l_debug_info_ptr);
			strcpy(chr_l_str_ntotlvaal_op,temp);
			temp = (char *)calloc(APL_MAXLINE_SIZE, sizeof(char));

			fprintf(p_repfile,"  ");
			fprintf(p_repfile,"%18s",chr_l_str_ntotlvaal_op);
			
			memset(chr_l_str_ntotlvaal_ip,APL_NULL_CHAR,SAFEK_LENGTH);
			memset(chr_l_str_ntotlvaal_op,APL_NULL_CHAR,SAFEK_LENGTH);

			if ((strlen(chr_l_h_ruinstrdesc)) > 30)
					(*p_nrow) += 2;
			else
				(*p_nrow)++;
			fprintf(p_repfile,"\n");

		break;					
		
		case 3:				
			
			if (p_new_flg == 1)
			{

				memset(chr_l_h_locndesc,APL_NULL_CHAR,sizeof(LOC_DET_LEN));

				EXEC SQL SELECT REPLACE(REPLACE(SUBSTR(LTRIM(MT_LOCATION.LOCATION_DESC),1,35),CHR(13),' '),chr(10))		
				INTO :chr_l_h_locndesc:l_i_locndesc FROM MT_LOCATION WHERE LOCATION_CD = :p_h_rulocation;
				
				IS_ANY_ORA_ERROR

				if ((*p_nrow) >= (PAGE_LENGTH - 3)) 
				{
					
					int_retval = 0;
					int_retval = PrnRepHdrFn(p_logfile, p_repfile,p_int_pageno, p_nrow, p_str_parm, &l_debug_info_ptr);
					if (int_retval != APL_SUCCESS)
					{
						CO_ProcMonitor(p_logfile,"Unable to Write the Header for Generate By Location\n",NULL,NULL);
						APL_GOBACK_FAIL
					}
				}					
			
				
				fprintf(p_repfile,"\nLOCATION CODE :    ");
				fprintf(p_repfile,p_h_rulocation);
				fprintf(p_repfile,"  POSITION BY STATREGNO");
				fprintf(p_repfile,"\nLOCATION DESC :    ");
				fprintf(p_repfile,chr_l_h_locndesc);   
				fprintf(p_repfile,"\n");
				for (int_dash_ctr=1;int_dash_ctr<= REPORT_WIDTH;int_dash_ctr++)
				{
					fprintf(p_repfile,"-");
				}
				
				strcpy(chr_l_subhdr_typ,"S");
				int_retval = 0;
				int_retval = RRMMHeader(p_repfile,p_logfile,p_nrow,chr_l_subhdr_typ);
				if (int_retval != APL_SUCCESS)
				{
					CO_ProcMonitor(p_logfile,"Unable to Write the RRMM Sub-Header for Generate By Location\n",NULL,NULL);
					APL_GOBACK_FAIL
				}
				(*p_nrow) += 5;

			} 

			

			if ((*p_nrow) >= (PAGE_LENGTH - 3))
			{
				int_retval = 0;
				int_retval = PrnRepHdrFn(p_logfile, p_repfile,p_int_pageno, p_nrow, p_str_parm, &l_debug_info_ptr);
				if (int_retval != APL_SUCCESS)
				{
					CO_ProcMonitor(p_logfile,"Unable to Write the RRMM Header for Generate By Location\n",NULL,NULL);
					APL_GOBACK_FAIL
				}
			}

			ntotlvaal = p_dbl_safek;            
			(*nclttotlval) += ntotlvaal;  

			ntotlconfr = p_dbl_confrec;         
			(*confrectotlval) += ntotlconfr; 

			ntotlconfd = p_dbl_confdel;         
			(*confdeltotlval) += ntotlconfd; 

			CO_Trim(p_h_stregno,' ','R',temp,l_debug_info_ptr);
			strcpy(p_h_stregno,temp);

				

			if ((strlen(p_h_stregno) > 20) && (strlen(p_h_stregno) < 31))
			{
				
				strncpy(chr_l_str_temp,p_h_stregno,30);
				fprintf(p_repfile,"%-50s",chr_l_str_temp);
			}
			else if ((strlen(p_h_stregno)) < 21)
			{
				
				strncpy(chr_l_str_temp,p_h_stregno,20);
				fprintf(p_repfile,"%-50s",chr_l_str_temp);
			}
			else if ((strlen(p_h_stregno)) > 30)
			{
				
				strncpy(chr_l_str_temp,p_h_stregno,30);
				fprintf(p_repfile,chr_l_str_temp);
				strcpy(chr_l_str_temp,APL_NULL_STRING);
			}

					

			

			memset(chr_l_str_ntotlvaal_ip,APL_NULL_CHAR,SAFEK_LENGTH);
			memset(chr_l_str_ntotlvaal_op,APL_NULL_CHAR,SAFEK_LENGTH);
			
			
			sprintf(chr_l_str_ntotlvaal_ip , "%.2lf" , ntotlconfr);
			int_retval = 0;
			
						CO_Rtv_FormatAmt(ntotlconfr, chr_l_str_ntotlvaal_op, 'Y', 'Y', l_debug_info_ptr);
			

			CO_Trim(chr_l_str_ntotlvaal_op,' ','L',temp,l_debug_info_ptr);
			strcpy(chr_l_str_ntotlvaal_op,temp);
			temp = (char *)calloc(APL_MAXLINE_SIZE, sizeof(char));

			fprintf(p_repfile,"  ");
			fprintf(p_repfile,"%23s",chr_l_str_ntotlvaal_op);

			memset(chr_l_str_ntotlvaal_ip,APL_NULL_CHAR,SAFEK_LENGTH);
			memset(chr_l_str_ntotlvaal_op,APL_NULL_CHAR,SAFEK_LENGTH);

			
			sprintf(chr_l_str_ntotlvaal_ip , "%.2lf" , ntotlconfd);
			int_retval = 0;
			
						CO_Rtv_FormatAmt(ntotlconfd, chr_l_str_ntotlvaal_op, 'Y', 'Y', l_debug_info_ptr);
			

			CO_Trim(chr_l_str_ntotlvaal_op,' ','L',temp,l_debug_info_ptr);
			strcpy(chr_l_str_ntotlvaal_op,temp);
			temp = (char *)calloc(APL_MAXLINE_SIZE, sizeof(char));
	
			fprintf(p_repfile,"  ");
			fprintf(p_repfile,"%13s",chr_l_str_ntotlvaal_op);

			memset(chr_l_str_ntotlvaal_ip,APL_NULL_CHAR,SAFEK_LENGTH);
			memset(chr_l_str_ntotlvaal_op,APL_NULL_CHAR,SAFEK_LENGTH);

			
			sprintf(chr_l_str_ntotlvaal_ip , "%.2lf" , ntotlvaal);
			int_retval = 0;
			
						CO_Rtv_FormatAmt(ntotlvaal, chr_l_str_ntotlvaal_op, 'Y', 'Y', l_debug_info_ptr);
			
		
			CO_Trim(chr_l_str_ntotlvaal_op,' ','L',temp,l_debug_info_ptr);
			strcpy(chr_l_str_ntotlvaal_op,temp);
			temp = (char *)calloc(APL_MAXLINE_SIZE, sizeof(char));
	
			fprintf(p_repfile,"  ");
			fprintf(p_repfile,"%18s",chr_l_str_ntotlvaal_op);

			if ((strlen(p_h_stregno)) > 30)
				(*p_nrow) += 2;
			else
				(*p_nrow)++;;
			
			fprintf(p_repfile,"\n");

			memset(chr_l_str_ntotlvaal_ip,APL_NULL_CHAR,SAFEK_LENGTH);
			memset(chr_l_str_ntotlvaal_op,APL_NULL_CHAR,SAFEK_LENGTH);

		break;					
	}

	APL_GOBACK_SUCCESS

	

	RETURN_FAILURE:
		CO_ProcMonitor(p_logfile,"Exiting out of DoRrmmiterations Unsuccessfully\n",NULL,NULL);
		return (APL_FAILURE);

	 RETURN_SUCCESS:
		 CO_ProcMonitor(p_logfile,"Exiting out of DoRrmmiterations Successfully\n",NULL,NULL);
		 return (APL_SUCCESS);

} 	 



int PrnRepHdrFn(FILE *p_logfile, FILE *p_repfile,int *p_int_pageno, int *p_nrow, char **p_str_parm, DEBUG_INFO_STRUCT_H **l_debug_info_ptr)
{
	char chr_l_str_repdate[11] = APL_NULL_STRING ;
	short l_i_repdate = 0;
	char chr_l_str_asof[11] = APL_NULL_STRING ;

	EXEC SQL VAR chr_l_str_repdate IS STRING;

	
	memset(chr_l_str_repdate,APL_NULL_CHAR, 11);
	 memset(chr_l_str_asof,APL_NULL_CHAR, 11);

	EXEC SQL SELECT TO_CHAR(SYS_DATE,'DD/MM/RRRR') INTO :chr_l_str_repdate:l_i_repdate
	FROM PRO_SYS_DATE;

	IS_ANY_ORA_ERROR

	
	if( (*p_int_pageno) != 1 )
		{
			fprintf(p_repfile,"\f");  
			fprintf(p_repfile,"\n");
			fprintf(p_repfile,"%103s","Page ");
			fprintf(p_repfile,"%3d\n\n",*p_int_pageno);  
			
			*p_nrow = 3;
		}
	else if ((*p_int_pageno) == 1)
	{
		fprintf(p_repfile,"\n");
		fprintf(p_repfile,"                                    SAFEKEEPING RRMM RECON REPORT                             ");
		fprintf(p_repfile,"%s\n",chr_l_str_repdate);
		fprintf(p_repfile,"                                    -----------------------------\n");
		fprintf(p_repfile,"As Of:   ");
		CO_ProcMonitor(p_logfile,p_str_parm[5],NULL,NULL);
		CO_ProcMonitor(p_logfile,"\n",NULL,NULL);
		strncpy(chr_l_str_asof, p_str_parm[5],10);
		CO_ProcMonitor(p_logfile, chr_l_str_asof,NULL,NULL);
		fprintf(p_repfile,chr_l_str_asof); 
		
		fprintf(p_repfile,"                           CITIBANK");
		fprintf(p_repfile,"                                            Page %d\n",*p_int_pageno);
		fprintf(p_repfile,"\n\n");
		*p_nrow = 5; 
	}
	(*p_int_pageno)++;
	return (APL_SUCCESS);



   RETURN_FAILURE:
      CO_ProcMonitor(p_logfile,"Exiting out of PrnRepHdrFn Unsuccessfully\n",NULL,NULL);
      return (APL_FAILURE);

}


int SafekDsHeader(FILE *p_repfile,FILE *p_logfile,int *p_nrow,char *p_subhdr_typ)
{
	int int_dash_ctr = 1;

	fprintf(p_logfile,"Entered processtion SafekDsHeader");

	if ((*p_subhdr_typ == 'S' ) || (*p_subhdr_typ == 'L'))
	{
		fprintf(p_repfile,"%-22s","\nINSTRUMENT CODE");
		fprintf(p_repfile,"%-38s","INSTRUMENT DESCRIPTION");
	}

	else if (*p_subhdr_typ == 'A') 
	{
		fprintf(p_repfile,"%-22s","\nACCOUNT CODE");
		fprintf(p_repfile,"%-38s","ACCOUNT DESCRIPTION");
	}
	
	fprintf(p_repfile,"  ");
	fprintf(p_repfile,"%8s","VAL_REC");
	
	fprintf(p_repfile,"%10s","  ");
	fprintf(p_repfile,"%8s","VAL_DEL");

	fprintf(p_repfile,"%10s","    ");
	fprintf(p_repfile,"%8s","SETTLED\n");
	
	for (int_dash_ctr=1;int_dash_ctr<= REPORT_WIDTH;int_dash_ctr++)
	{
		fprintf(p_repfile,"-");
	}
	fprintf(p_repfile,"\n");
	return (APL_SUCCESS);

}  




int RRMMHeader(FILE *p_repfile,FILE *p_logfile,int *p_nrow,char *p_rsubhdr_typ)
{
	int int_dash_ctr = 1;

	fprintf(p_logfile,"Entered processtion RRMMHeader");

	if ((*p_rsubhdr_typ == 'S')  || (*p_rsubhdr_typ == 'L')  || (*p_rsubhdr_typ == 'A'))
	{
		fprintf(p_repfile,"%-64s","\nSTATE REGISTRATION NUMBER");
		
	
		fprintf(p_repfile,"  ");
		fprintf(p_repfile,"%10s","VAL_REC");
	
		fprintf(p_repfile,"%5s","  ");
		fprintf(p_repfile,"%10s","VAL_DEL");

		fprintf(p_repfile,"%5s","  ");
		fprintf(p_repfile,"%15s","SETTLED");
		fprintf(p_repfile,"\n");
		
		
		
		fprintf(p_repfile,"%-103s","  ");  
		
		fprintf(p_repfile,"\n"); 
	}

	for (int_dash_ctr=1;int_dash_ctr<= REPORT_WIDTH;int_dash_ctr++)
	{
		fprintf(p_repfile,"-");
	}
	
	fprintf(p_repfile,"\n");
	return (APL_SUCCESS);


} 




int PrnTotPosn(FILE *p_logfile,FILE *p_repfile,double *nclttotlval,double *confrectotlval,double *confdeltotlval,int *p_nrow,INTL_ENV_DATA_STRUCT_H *p_intl_envdatastruct_h,DEBUG_INFO_STRUCT_H *l_debug_info_ptr)
{
	int int_dash_ctr = 1;
	int int_retval = 0;
	char *temp = NULL;

	double dbl_in_value = 0.0;


	char chr_l_str_nacctotlval_ip[SAFEK_LENGTH]	 = APL_NULL_STRING; 
	char chr_l_str_nacctotlval_op[SAFEK_LENGTH]	 = APL_NULL_STRING; 	

	temp = (char *)calloc(APL_MAXLINE_SIZE, sizeof(char));
	
	fprintf(p_logfile,"Entered processtion PrnTotPosn");

	for (int_dash_ctr=1;int_dash_ctr<= REPORT_WIDTH;int_dash_ctr++)
	{
		fprintf(p_repfile,"-");
	}
	
	fprintf(p_repfile,"\nTOTAL POSITIONS :");
	fprintf(p_repfile,"%29s"," ");

	
	
	memset(chr_l_str_nacctotlval_ip,APL_NULL_CHAR,SAFEK_LENGTH);
	memset(chr_l_str_nacctotlval_op,APL_NULL_CHAR,SAFEK_LENGTH);
	
	sprintf(chr_l_str_nacctotlval_ip , "%.2lf" , *confrectotlval);
	dbl_in_value = *confrectotlval;
	int_retval = 0;
	
				CO_Rtv_FormatAmt(dbl_in_value, chr_l_str_nacctotlval_op, 'Y', 'Y', l_debug_info_ptr);
	

	CO_Trim(chr_l_str_nacctotlval_op,' ','L',temp,&l_debug_info_ptr); //AIX -Warning Removal
	strcpy(chr_l_str_nacctotlval_op,temp);
	temp = (char *)calloc(APL_MAXLINE_SIZE, sizeof(char));
	
	fprintf(p_repfile,"  ");


	fprintf(p_repfile,"%21s",chr_l_str_nacctotlval_op);
	
	memset(chr_l_str_nacctotlval_ip,APL_NULL_CHAR,SAFEK_LENGTH);
	memset(chr_l_str_nacctotlval_op,APL_NULL_CHAR,SAFEK_LENGTH);

	
	
	sprintf(chr_l_str_nacctotlval_ip , "%.2lf" , *confdeltotlval);
	dbl_in_value = 0.0;
	dbl_in_value = *confdeltotlval;
	int_retval = 0;
	
					CO_Rtv_FormatAmt(dbl_in_value, chr_l_str_nacctotlval_op, 'Y', 'Y', l_debug_info_ptr);
	

	CO_Trim(chr_l_str_nacctotlval_op,' ','L',temp,&l_debug_info_ptr); //AIX -Warning Removal
	strcpy(chr_l_str_nacctotlval_op,temp);
	temp = (char *)calloc(APL_MAXLINE_SIZE, sizeof(char));
	
	fprintf(p_repfile,"  ");
	fprintf(p_repfile,"%16s",chr_l_str_nacctotlval_op);
	
	memset(chr_l_str_nacctotlval_ip,APL_NULL_CHAR,SAFEK_LENGTH);
	memset(chr_l_str_nacctotlval_op,APL_NULL_CHAR,SAFEK_LENGTH);
	
	
	
	sprintf(chr_l_str_nacctotlval_ip , "%.2lf" , *nclttotlval);
	dbl_in_value = 0.0;
	dbl_in_value = *nclttotlval;

	int_retval = 0;
	
					CO_Rtv_FormatAmt(dbl_in_value, chr_l_str_nacctotlval_op, 'Y', 'Y', l_debug_info_ptr);
	

	CO_Trim(chr_l_str_nacctotlval_op,' ','L',temp,&l_debug_info_ptr); //AIX -Warning Removal
	strcpy(chr_l_str_nacctotlval_op,temp);
	temp = (char *)calloc(APL_MAXLINE_SIZE, sizeof(char));

	fprintf(p_repfile,"  ");
	fprintf(p_repfile,"%15s",chr_l_str_nacctotlval_op);
	fprintf(p_repfile,"\n");	
	
	for (int_dash_ctr=1;int_dash_ctr<= REPORT_WIDTH;int_dash_ctr++)
	{
		fprintf(p_repfile,"-");
	}
	fprintf(p_repfile,"\n\n");

	(*p_nrow) += 4;
	return (APL_SUCCESS);

	

	RETURN_FAILURE:
		CO_ProcMonitor(p_logfile,"Exiting out of PrnTotPosn Unsuccessfully\n",NULL,NULL);
		return (APL_FAILURE);

} 



int PrnTotRrmmPosn(char *schedule,FILE *p_logfile,FILE *p_repfile,double *nclttotlval,double *confrectotlval,double *confdeltotlval,int *p_nrow,INTL_ENV_DATA_STRUCT_H *p_intl_envdatastruct_h,DEBUG_INFO_STRUCT_H *l_debug_info_ptr)
{
	int int_dash_ctr = 1;
	int int_retval = 0;
	char *temp = NULL;


	double dbl_in_value = 0.0;


	char chr_l_str_nacctotlval_ip[SAFEK_LENGTH]	 = APL_NULL_STRING; 
	char chr_l_str_nacctotlval_op[SAFEK_LENGTH]	 = APL_NULL_STRING; 	

		temp = (char *)calloc(APL_MAXLINE_SIZE, sizeof(char));
	
	fprintf(p_logfile,"Entered processtion PrnTotPosn");

	for (int_dash_ctr=1;int_dash_ctr<= REPORT_WIDTH;int_dash_ctr++)
	{
		fprintf(p_repfile,"-");
	}
	
	fprintf(p_repfile,"\nTOTAL POSITIONS :");
	if (strcmp(schedule,"AC") == 0)
	{
		
		fprintf(p_repfile,"\n :"); //AIX -Warning Removal
		fprintf(p_repfile,"%42s"," ");
		
		
		
	
		memset(chr_l_str_nacctotlval_ip,APL_NULL_CHAR,SAFEK_LENGTH);
		memset(chr_l_str_nacctotlval_op,APL_NULL_CHAR,SAFEK_LENGTH);
		
		sprintf(chr_l_str_nacctotlval_ip , "%.2lf" , *confrectotlval);
		dbl_in_value = 0.0;
		dbl_in_value =  *confrectotlval;
		int_retval = 0;
		
						CO_Rtv_FormatAmt(dbl_in_value, chr_l_str_nacctotlval_op, 'Y', 'Y', l_debug_info_ptr);
		

		CO_Trim(chr_l_str_nacctotlval_op,' ','L',temp,&l_debug_info_ptr); //AIX -Warning Removal
		strcpy(chr_l_str_nacctotlval_op,temp);
		temp = (char *)calloc(APL_MAXLINE_SIZE, sizeof(char));
	
		fprintf(p_repfile,"  ");
		fprintf(p_repfile,"%14s",chr_l_str_nacctotlval_op);
	
		memset(chr_l_str_nacctotlval_ip,APL_NULL_CHAR,SAFEK_LENGTH);
		memset(chr_l_str_nacctotlval_op,APL_NULL_CHAR,SAFEK_LENGTH);

	
		
		sprintf(chr_l_str_nacctotlval_ip , "%.2lf" , *confdeltotlval);
		dbl_in_value =0.0;
		dbl_in_value = *confdeltotlval;
		int_retval = 0;
		
						CO_Rtv_FormatAmt(dbl_in_value, chr_l_str_nacctotlval_op, 'Y', 'Y', l_debug_info_ptr);
		

		CO_Trim(chr_l_str_nacctotlval_op,' ','L',temp,&l_debug_info_ptr); //AIX -Warning Removal
		strcpy(chr_l_str_nacctotlval_op,temp);
		temp = (char *)calloc(APL_MAXLINE_SIZE, sizeof(char));
	
		fprintf(p_repfile,"  ");
		fprintf(p_repfile,"%13s",chr_l_str_nacctotlval_op);
	
		memset(chr_l_str_nacctotlval_ip,APL_NULL_CHAR,SAFEK_LENGTH);
		memset(chr_l_str_nacctotlval_op,APL_NULL_CHAR,SAFEK_LENGTH);
	
	
		
		sprintf(chr_l_str_nacctotlval_ip , "%.2lf" , *nclttotlval);
		dbl_in_value = 0.0;
		dbl_in_value = *nclttotlval;
		int_retval = 0;
		
						CO_Rtv_FormatAmt(dbl_in_value , chr_l_str_nacctotlval_op, 'Y', 'Y', l_debug_info_ptr);
		

		CO_Trim(chr_l_str_nacctotlval_op,' ','L',temp,&l_debug_info_ptr); //AIX -Warning Removal
		strcpy(chr_l_str_nacctotlval_op,temp);
		temp = (char *)calloc(APL_MAXLINE_SIZE, sizeof(char));

		fprintf(p_repfile,"%20s",chr_l_str_nacctotlval_op);
	}
	else
	{
		fprintf(p_repfile,"%30s"," ");
	
		
		
		memset(chr_l_str_nacctotlval_ip,APL_NULL_CHAR,SAFEK_LENGTH);
		memset(chr_l_str_nacctotlval_op,APL_NULL_CHAR,SAFEK_LENGTH);
		
		sprintf(chr_l_str_nacctotlval_ip , "%.2lf" , *confrectotlval);
		dbl_in_value =0.0;
		dbl_in_value = *confrectotlval;
		int_retval = 0;
		
						CO_Rtv_FormatAmt(dbl_in_value, chr_l_str_nacctotlval_op, 'Y', 'Y', l_debug_info_ptr);
		
	
		fprintf(p_repfile,"  ");
		fprintf(p_repfile,"%10s",chr_l_str_nacctotlval_op);

		memset(chr_l_str_nacctotlval_ip,APL_NULL_CHAR,SAFEK_LENGTH);
		memset(chr_l_str_nacctotlval_op,APL_NULL_CHAR,SAFEK_LENGTH);
	
		
		sprintf(chr_l_str_nacctotlval_ip , "%.2lf" , *confdeltotlval);
		dbl_in_value = 0.0;
		dbl_in_value = *confdeltotlval;
		int_retval = 0;
		
						CO_Rtv_FormatAmt(dbl_in_value, chr_l_str_nacctotlval_op, 'Y', 'Y', l_debug_info_ptr);
		

		CO_Trim(chr_l_str_nacctotlval_op,' ','L',temp,&l_debug_info_ptr); //AIX -Warning Removal
		strcpy(chr_l_str_nacctotlval_op,temp);
		temp = (char *)calloc(APL_MAXLINE_SIZE, sizeof(char));
	
		fprintf(p_repfile,"  ");
		fprintf(p_repfile,"%13s",chr_l_str_nacctotlval_op);
	
		memset(chr_l_str_nacctotlval_ip,APL_NULL_CHAR,SAFEK_LENGTH);
		memset(chr_l_str_nacctotlval_op,APL_NULL_CHAR,SAFEK_LENGTH);
	
	
		
		sprintf(chr_l_str_nacctotlval_ip , "%.2lf" , *nclttotlval);
		dbl_in_value = 0.0;
		dbl_in_value = *nclttotlval;
		int_retval = 0;
		
						CO_Rtv_FormatAmt(dbl_in_value, chr_l_str_nacctotlval_op, 'Y', 'Y', l_debug_info_ptr);
		

		CO_Trim(chr_l_str_nacctotlval_op,' ','L',temp,&l_debug_info_ptr); //AIX -Warning Removal
		strcpy(chr_l_str_nacctotlval_op,temp);
		temp = (char *)calloc(APL_MAXLINE_SIZE, sizeof(char));

		fprintf(p_repfile,"%20s",chr_l_str_nacctotlval_op);

	}	
	
	fprintf(p_repfile,"\n");	
	for (int_dash_ctr=1;int_dash_ctr<= REPORT_WIDTH;int_dash_ctr++)
	{
		fprintf(p_repfile,"-");
	}
	fprintf(p_repfile,"\n\n");
	
	if (strcmp(schedule,"AC") == 0)
		(*p_nrow) += 5;
	else
		(*p_nrow) += 4;
	return (APL_SUCCESS);

	

	RETURN_FAILURE:
		CO_ProcMonitor(p_logfile,"Exiting out of PrnTotRrmmPosn Unsuccessfully\n",NULL,NULL);
		return (APL_FAILURE);

} 




int CO_DB_Connection_L(char *p_username,char *p_passwd,DEBUG_INFO_STRUCT_H 
**l_debug_info_ptr)
{
        struct sqlca                                    sqlca;

        sqlca.sqlcode = 0;

        CO_ProcMonitor(APL_OUT_FILE,"Entered processtion CO_DB_Connection_L\n",NULL,NULL);

        EXEC SQL CONNECT :p_username IDENTIFIED BY :p_passwd;

			IS_ANY_ORA_ERROR

        if (sqlca.sqlcode != 0)
                APL_GOBACK_FAIL

        APL_GOBACK_SUCCESS

        RETURN_SUCCESS :
        {
                CO_ProcMonitor(APL_OUT_FILE, "Leaving processtion CO_DB_Connection_L successfully \n",NULL,NULL);
                return(APL_SUCCESS);
        }

        RETURN_FAILURE :
        {
                CO_ProcMonitor(APL_OUT_FILE, "Leaving processtion CO_DB_Connection_L with failure \n",NULL,NULL);
                return(APL_FAILURE);
        }
}






int LockRecFn15(char **argv,FILE *p_ptr_log_file,DEBUG_INFO_STRUCT_H 
**l_debug_info_ptr)
{
   struct sqlca               sqlca;

		char l_temp_processing_status[51] = APL_NULL_STRING;
   sqlca.sqlcode = 0;

   CO_ProcMonitor(p_ptr_log_file,"Entered processtion LockRecFn15\n",NULL,NULL);

   EXEC SQL SELECT processing_status into :l_temp_processing_status 
   FROM SYS_BATCHPROC
   WHERE process_name = :argv[0]
   AND   proc_init = :argv[1]
   AND STARTDATE = :argv[2]
   AND status = 'started'
   FOR UPDATE OF processing_status,status;

   
IS_ANY_ORA_ERROR_AND_ZERO_RESULTSET(ERR_REC_NOTFND,APL_NULL_STRING,APL_NULL_STRING,APL_NULL_STRING)
   APL_GOBACK_SUCCESS

   RETURN_SUCCESS :
   {
      CO_ProcMonitor(p_ptr_log_file,"Leaving processtion LockRecFn15 successfully \n",NULL,NULL);
      return(APL_SUCCESS);
   }

   RETURN_FAILURE :
   {
      CO_ProcMonitor(p_ptr_log_file,"Leaving processtion LockRecFn15 with failure \n",NULL,NULL);
      return(APL_FAILURE);
   }
}







int CO_Proc_Exit(char **argv,FILE *p_ptr_log_file,DEBUG_INFO_STRUCT_H 
**l_debug_info_ptr,int p_flg)
  {
    struct sqlca               sqlca;
    char                       chr_l_buf[BUFFER_LEN] = APL_NULL_STRING;

    sqlca.sqlcode = 0;

    CO_ProcMonitor(p_ptr_log_file,"Entered processtion CO_Proc_Exit\n",NULL,NULL);
    if (p_flg == 0)
    {
       

       if (CO_ChkErr(*l_debug_info_ptr) != APL_SUCCESS)
       {
          memset(chr_l_buf,APL_NULL_CHAR,BUFFER_LEN);
          sprintf(chr_l_buf,"Finished Position Recon Report Generation ");

          EXEC SQL UPDATE SYS_BATCHPROC
          SET stat_det = :chr_l_buf,
              status = 'completed'
          WHERE process_name = :argv[0]
          AND   proc_init = :argv[1]
          AND STARTDATE = :argv[2]
          AND status = 'started';

          
IS_ANY_ORA_ERROR_AND_ZERO_RESULTSET(ERR_REC_NOTFND,APL_NULL_STRING,APL_NULL_STRING,APL_NULL_STRING)

       }

       EXEC SQL COMMIT ;
		 IS_ANY_ORA_ERROR

       CO_ProcMonitor(p_ptr_log_file,"Work Committed \n",NULL,NULL);
    }
    else if (p_flg == 1)
    {
       EXEC SQL ROLLBACK ;
		 IS_ANY_ORA_ERROR

       CO_ProcMonitor(p_ptr_log_file,"Rollback done \n",NULL,NULL);
    }

    APL_GOBACK_SUCCESS
    RETURN_SUCCESS :
    {
       CO_ProcMonitor(p_ptr_log_file,"Leaving processtion CO_Proc_Exit successfully \n",NULL,NULL);
       return(APL_SUCCESS);
    }

    RETURN_FAILURE :
    {
       CO_ProcMonitor(p_ptr_log_file,"Leaving processtion CO_Proc_Exit with failure \n",NULL,NULL);
       return(APL_FAILURE);
    }
}





int CO_ConvToFmtAmt(char *p_strin,char *p_strout)
{

int i , j ,n , int_l_type ;
char chr_oldstr[25] = APL_NULL_STRING;
char chr_newstr[25] = APL_NULL_STRING;

strcpy(chr_oldstr,p_strin);
n=strlen(chr_oldstr) - 6; 



if(n%2 == 0)
 int_l_type = 2 ; 
else
 int_l_type = 1 ; 

for(i=0,j=0;i<strlen(chr_oldstr);i++)
{
 if(n<=0)
 {
  strcpy(chr_newstr,chr_oldstr);
  break;
 }
 else
 {

  chr_newstr[j]=chr_oldstr[i];

 if(i<n)
 {
  if(int_l_type == 1)
  {
   if(i%2 == 0)
   {
   j++;
   chr_newstr[j]=',';
   }
  }
  else
  {
   if((i+1)%2 == 0)
   {
   j++;
   chr_newstr[j]=',';
   }
  }
 }

  j++;

 }
}
i=strlen(chr_newstr);
strncpy(p_strout,chr_newstr,i-3);
return (APL_SUCCESS);

}








 
  



