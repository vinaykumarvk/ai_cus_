





#include "CO_HostStructdef.h"
#include<stdlib.h>
#include "CA_Common.h"
EXEC SQL INCLUDE SQLCA.H;

#define MAXROWS 1000
#define DEC_LEN_RATE 7
#define INTLENGTHRATE 4
#define CCY_EUR_IND  "EUR"
int CDBGenTrdAccFn(char *p_deal_rowid,char *p_batch_no,int *p_runseq,char chr_p_typeofinstr,double *p_dct,double *p_cct,FILE *p_logfile,INTL_ENV_DATA_STRUCT_H *p_intl_envdatastruct_h,DEBUG_INFO_STRUCT_H **l_debug_info_ptr);





int CDBGenGrAccFn(char *p_acdate,char chr_p_typeofinstr,char **argv,FILE *p_repfile,FILE *p_logfile,INTL_ENV_DATA_STRUCT_H *p_intl_envdatastruct_h,DEBUG_INFO_STRUCT_H **l_debug_info_ptr)
{

	
	
	struct sqlca sqlca;
   PRO_GSEQNUM_STRUCT_H     l_pro_gseqno_struct_h;
	FILE  *l_logfile                                   =  NULL;
	int       int_no_of_entries										=	0;
	int       int_l_reccount											=	0;
	int       *int_l_runseq_a											=	0;
	int       int_l_batch_no											=	0;
	int	    int_l_condexists										=	0;	
	int       int_retval												=	0;
	char      chr_l_str_batchno[6]									=	APL_NULL_STRING;
	char	    chr_l_h_trd_client[APL_CLIENT_LENGTH]			=	APL_NULL_STRING;
	char		 chr_l_h_trd_trcode[APL_FLAG_LENGTH]					=	APL_NULL_STRING;
	char      chr_l_h_trd_refno[17]								=	APL_NULL_STRING;
   char      chr_l_h_trd_locncode[APL_LOCNCODE_LENGTH]       =  APL_NULL_STRING;
	char	 	 chr_l_h_trd_hostdt[APL_DATE_LEN]					=	APL_NULL_STRING;
   char      chr_l_h_trd_typeoftrd[DEALTYPE_LEN_A]         =  APL_NULL_STRING;
	char      chr_l_sysdate_b[APL_DATE_LEN]						=	APL_NULL_STRING;
	char      chr_mainfuncarea[APL_MAINFUNCAREA_LEN]     =  APL_NULL_STRING;
   char      chr_l_subfunc_b[APL_MAINFUNCAREA_LEN]          =  APL_NULL_STRING;
   char      chr_l_fieldval[APL_MAINFUNCAREA_LEN]         =  APL_NULL_STRING;
	char      chr_l_h_statinfo[71]                         =  APL_NULL_STRING;
	char  	 chr_l_rf[APL_FLAG_LENGTH]                       =  APL_NULL_STRING;
   char      chr_l_df[APL_FLAG_LENGTH]                       =  APL_NULL_STRING;
   char      chr_l_rvp[APL_FLAG_LENGTH]                      =  APL_NULL_STRING;
   char      chr_l_dvp[APL_FLAG_LENGTH]                      =  APL_NULL_STRING;
	char      chr_l_shs[TYPEOF_INSTR_LEN]                     =  APL_NULL_STRING;
   char      chr_l_rts[TYPEOF_INSTR_LEN]                     =  APL_NULL_STRING;
   char      chr_l_fmt[TYPEOF_INSTR_LEN]                     =  APL_NULL_STRING;
   char      chr_l_bon[TYPEOF_INSTR_LEN]                     =  APL_NULL_STRING;
	char      chr_l_h_trd_rowid[APL_ROWID_LEN]       	   =  APL_NULL_STRING;
   char      chr_l_h_restart_data[APL_RESTARTDATA_LENGTH]    =  APL_NULL_STRING;
	char l_temp_processing_status[51] = APL_NULL_STRING;
	char      chr_l_batch[6]											=	APL_NULL_STRING;	
	char     chr_l_buf[BUFFER_LEN]                         =  APL_NULL_STRING;
	double	 l_h_trd_amount									=	0.0;
	double    l_h_trd_brokercomm									=	0.0;
	double   *l_dcredit_ind;												
	double   *l_ccredit_ind;
	short		 l_i_trd_account									=	0;
	short     l_i_trd_refno										=	0;
	short     l_i_trd_trcode									=	0;
	short		 l_i_trd_locncode									=	0;
	short		 l_i_trd_hostdt									=	0;
	short		 l_i_trd_amount									=	0;
   short     l_i_trd_typeoftrd                        =  0;
	short     l_i_trd_rowid										=	0; 
	short     l_i_trd_brkcomm									=	0;
   short     l_i_restart_data                         =  0;
	

   EXEC SQL VAR   chr_l_h_trd_client            IS STRING;
   EXEC SQL VAR   chr_l_h_trd_trcode             IS STRING;
   EXEC SQL VAR   chr_l_h_trd_locncode           IS STRING;
   EXEC SQL VAR   chr_l_h_trd_hostdt             IS STRING;
	EXEC SQL VAR   chr_l_h_trd_typeoftrd          IS STRING;
	EXEC SQL VAR   chr_l_h_restart_data				IS STRING;

	int_l_runseq_a = (int *)calloc(1, sizeof(int));
   APL_MALLOC_FAIL(int_l_runseq_a);
   (*int_l_runseq_a)=1;  

	l_dcredit_ind = (double *)calloc(1, sizeof(double));
   APL_MALLOC_FAIL(l_dcredit_ind);

	l_ccredit_ind = (double *)calloc(1, sizeof(double));
   APL_MALLOC_FAIL(l_ccredit_ind);

	
	if (strcmp(p_acdate,APL_NULL_STRING) == 0)
	{
		APL_DATA_MISSING("ACC ENTRIES DATE",APL_NULL_STRING,APL_NULL_STRING)
	}	
	

	if ((chr_p_typeofinstr == ' ')||(chr_p_typeofinstr == '\0'))
	{
		APL_DATA_MISSING("INSTRUMENT TYPE",APL_NULL_STRING,APL_NULL_STRING)
	}

	if (CO_ChkErr(*l_debug_info_ptr) ==APL_SUCCESS)
   {
    	  APL_GOBACK_FAIL
   }  
	

   if ( APL_FAILURE == CO_RtvSysDt(  chr_l_sysdate_b,
                                          l_debug_info_ptr ) )
   {
      APL_GOBACK_FAIL;
   }

	   EXEC SQL SELECT PROCESSING_STATUS
            INTO  :chr_l_h_restart_data:l_i_restart_data
            FROM  SYS_BATCHPROC
            WHERE PROCESS_NAME    =  :argv[0]
            AND   PROC_INIT         =  :argv[1]
            AND   STARTDATE   =  :argv[2]
            AND   STATUS      =  'started'
            FOR UPDATE OF PROCESSING_STATUS,STATUS;

   if(APL_ZERO_RESULT_SET)
   {
      CO_ProcMonitor(   p_logfile,
                  "E:No entry in batch_in_proc",
                  NULL,
                  NULL);
      APL_GOBACK_FAIL;
   }

	IS_ANY_ORA_ERROR;


	
	chr_l_rf[0] = DEALCD_RF;
   chr_l_rf[1] = '\0';

   chr_l_df[0] = DEALCD_DF;
   chr_l_df[1] = '\0';

	
	chr_l_rvp[0] = DEALCD_RVP;
   chr_l_rvp[1] = '\0';

   chr_l_dvp[0] = DEALCD_DVP;
   chr_l_dvp[1] = '\0';
	
	strcpy(chr_l_shs,TYPOF_INSTR_SHS);

	strcpy(chr_l_fmt,TYPEOFINSTR_FMT);

   strcpy(chr_l_bon,TYPEOFINSTR_BOND);
   
   strcpy(chr_l_rts,DEALCD_RTS);



	EXEC SQL DECLARE acc_gen CURSOR FOR
				SELECT  a.rowid, 
						  a.client,
						  a.IDENTIY_NO,		
						  a.location_cd,
						  a.dl_class,
					     a.deal_cd,		 
						  a.AMOUNT,
					     a.brokercomm		
				FROM    dl_deal a,MT_CLIENT b,MT_INSTRUMENT c
				WHERE   a.HOST_DATE IS NULL
				AND     ((:l_mt_core_sys_params_struct_h.ord_proc_ind = 'N') or
							(a.client <>:l_mt_core_sys_params_struct_h.brokerage_cd))
			   AND     :p_acdate = decode(a.deal_cd,:chr_l_rf,a.INSTRUMENT_DT,:chr_l_df,a.INSTRUMENT_DT,:chr_l_rvp,a.MONEY_SETL_DT,:chr_l_dvp,a.MONEY_SETL_DT)
            AND    ((DECODE(:chr_p_typeofinstr,'A','A',c.INSTR_TYPE))=(DECODE(:chr_p_typeofinstr,'S',:chr_l_shs,'B',:chr_l_bon,'A'))
                    OR    (DECODE(:chr_p_typeofinstr,'A','A',c.INSTR_TYPE))=(DECODE(:chr_p_typeofinstr,'S',:chr_l_rts,'B',:chr_l_fmt,'A')))
				AND     a.instr_code = c.instr_code 
				AND     a.client=b.CLN_CODE
				AND     a.dl_class != '50'
				FOR UPDATE OF a.HOST_DATE;

	EXEC SQL OPEN acc_gen;
	
	
	IS_ANY_ORA_ERROR

   strcpy(l_pro_gseqno_struct_h.sequencename,"GRACCENTRIES");
   strcpy(l_pro_gseqno_struct_h.seq_attrb_a, APL_NULL_STRING);
   strcpy(l_pro_gseqno_struct_h.seq_attrb_b, APL_NULL_STRING);
   strcpy(l_pro_gseqno_struct_h.seq_attrb_c, APL_NULL_STRING);
   l_pro_gseqno_struct_h.seq_stepby = 1;
   l_pro_gseqno_struct_h.seq_start =l_mt_core_sys_params_struct_h.proc_start_no;
   l_pro_gseqno_struct_h.last_seqnum =l_mt_core_sys_params_struct_h.end_proc_no;
   l_pro_gseqno_struct_h.recycle_ind=RECYCLE_EOD;

   int_retval=CO_RtvNxtSeqNum(&l_pro_gseqno_struct_h,l_debug_info_ptr);
   if (int_retval == APL_FAILURE)
  	  APL_GOBACK_FAIL
   
   else int_l_batch_no=int_retval-1;
	
	CO_ProcMonitor(p_logfile,"entering loop",NULL,NULL);
	for(int_l_reccount=1;;int_l_reccount++)
	{
		EXEC SQL FETCH acc_gen INTO :chr_l_h_trd_rowid:l_i_trd_rowid, 
											 :chr_l_h_trd_client:l_i_trd_account,
											 :chr_l_h_trd_refno:l_i_trd_refno,	
						                :chr_l_h_trd_locncode:l_i_trd_locncode,
								          :chr_l_h_trd_typeoftrd:l_i_trd_typeoftrd,
								          :chr_l_h_trd_trcode:l_i_trd_trcode,
								          :l_h_trd_amount:l_i_trd_amount,
								          :l_h_trd_brokercomm:l_i_trd_brkcomm;
		IS_ANY_ORA_ERROR


		if(APL_ZERO_RESULT_SET)
		{
			break;
		}
		CO_ProcMonitor(p_logfile,chr_l_h_trd_refno,NULL,NULL);
		

	   strcpy(chr_mainfuncarea,"ACC_ENTRIES");
      strcpy(chr_l_subfunc_b,"LOCATION_CD");
      strcpy(chr_l_fieldval,chr_l_h_trd_locncode);
      int_retval = CO_Chk_SplVal(chr_mainfuncarea,chr_l_subfunc_b,chr_l_fieldval,&int_l_condexists,&l_debug_info_ptr);

      if (int_retval == APL_FAILURE)
         APL_GOBACK_FAIL

      if (int_l_condexists > 0)
      {
			if((strcmp(chr_l_h_trd_typeoftrd,DL_BOOKTRF_IND)!= 0)&& (VAL_VP_DEAL(chr_l_h_trd_trcode[0]))&&(l_h_trd_amount!=l_h_trd_brokercomm)&& (l_h_trd_brokercomm > 0))
			{
				int_no_of_entries=3;
			}
			else 
				int_no_of_entries=2;
		}
		else
			int_no_of_entries =2;

	
		if((*int_l_runseq_a)+int_no_of_entries >MAXROWS)
		{
			sprintf(chr_l_h_statinfo,"Batch %d  completed",int_l_batch_no);
			EXEC SQL UPDATE SYS_BATCHPROC
						SET stat_det= :chr_l_h_statinfo
			 	   	WHERE PROCESS_NAME=:argv[0]
               	AND   PROC_INIT=:argv[1]
               	AND   STARTDATE=:argv[2]
               	AND   STATUS='started';
		   if(APL_ZERO_RESULT_SET)
  	      {		 	 
        		CO_ProcMonitor(   p_logfile,
                  		"E:No entry in batch_in_proc",
                  		NULL,
                  		NULL);
      		APL_GOBACK_FAIL;
   	   } 

         IS_ANY_ORA_ERROR;


			sprintf(chr_l_str_batchno,"%d",int_l_batch_no);


			if(strlen(chr_l_str_batchno) != 5)
			{
   			if(APL_FAILURE == CO_PadString(chr_l_str_batchno,'L',5,"0",l_debug_info_ptr))
      			APL_GOBACK_FAIL
			}



			if(APL_FAILURE == CO_Pro_GrAccRep(chr_l_str_batchno,chr_l_sysdate_b,CORE_MOD_IND,argv,p_intl_envdatastruct_h,l_debug_info_ptr))
			{
				APL_GOBACK_FAIL
			}


			EXEC SQL COMMIT WORK;
		
			IS_ANY_ORA_ERROR;	

			int_retval=CO_ProcMonitor(p_logfile,"Reporting Entries Generated",NULL,NULL);
			
			EXEC SQL SELECT PROCESSING_STATUS into :l_temp_processing_status
            FROM SYS_BATCHPROC
            WHERE PROCESS_NAME = :argv[0]
            AND   PROC_INIT      = :argv[1]
            AND   STARTDATE= :argv[2]
            AND   STATUS   = 'started'
         FOR UPDATE OF PROCESSING_STATUS,STATUS;

   		IS_ANY_ORA_ERROR

   		if(APL_ZERO_RESULT_SET)
   		{
      		CO_ProcMonitor(p_logfile,"No Entry in batch in proc\n",NULL,NULL);
      		APL_GOBACK_FAIL
   		}



			
		  EXEC SQL OPEN acc_gen;

		  IS_ANY_ORA_ERROR

			

		  strcpy(l_pro_gseqno_struct_h.sequencename,"GRACCENTRIES");
        strcpy(l_pro_gseqno_struct_h.seq_attrb_a, APL_NULL_STRING);
        strcpy(l_pro_gseqno_struct_h.seq_attrb_b, APL_NULL_STRING);
        strcpy(l_pro_gseqno_struct_h.seq_attrb_c, APL_NULL_STRING);
        l_pro_gseqno_struct_h.seq_stepby = 1;
        l_pro_gseqno_struct_h.seq_start =l_mt_core_sys_params_struct_h.proc_start_no;
        l_pro_gseqno_struct_h.last_seqnum =l_mt_core_sys_params_struct_h.end_proc_no;
        l_pro_gseqno_struct_h.recycle_ind=RECYCLE_EOD;
		
		  int_retval=CO_RtvNxtSeqNum(&l_pro_gseqno_struct_h,l_debug_info_ptr);
        if (int_retval == APL_FAILURE)
       	 APL_GOBACK_FAIL
   
        else int_l_batch_no=int_retval-1;


			
			
			(*int_l_runseq_a) = 1;
			continue;
		}	

		sprintf(chr_l_str_batchno,"%d",int_l_batch_no);

		if(APL_FAILURE == CDBGenTrdAccFn(chr_l_h_trd_rowid,chr_l_str_batchno,int_l_runseq_a,chr_p_typeofinstr,l_dcredit_ind,l_ccredit_ind,p_logfile,p_intl_envdatastruct_h,l_debug_info_ptr))
      {
			IS_ANY_ERROR_FATAL
         memset(chr_l_buf, NULL, BUFFER_LEN);
         sprintf(chr_l_buf, "\nFAILED TO GENERATE ACCOUNTING ENTRIES FOR  %s,%s,%s ", chr_l_str_batchno,chr_l_h_trd_client,chr_l_h_trd_refno);
         CO_ProcMonitor(p_logfile, chr_l_buf, l_debug_info_ptr, p_intl_envdatastruct_h);
         CO_FreeErrLst(l_debug_info_ptr);
      }
      else
      {
			if (!APL_DOUBLE_EQUAL(*l_dcredit_ind,*l_ccredit_ind))
			{
				*l_dcredit_ind = *l_dcredit_ind - (*l_dcredit_ind - *l_ccredit_ind);
			
				

         	

			}	
			

				EXEC SQL UPDATE dl_deal
							SET dl_deal.HOST_DATE=:chr_l_sysdate_b
							WHERE dl_deal.rowid=:chr_l_h_trd_rowid;
				IS_ANY_ORA_ERROR_AND_ZERO_RESULTSET( ERR_DEAL_NF,
                                          chr_l_h_trd_client,
                                          chr_l_h_trd_refno,
                                          APL_NULL_STRING);
		

			

		}
	}
	EXEC SQL CLOSE acc_gen;

	if(!sqlca.sqlerrd[2])
	{
		CO_ProcMonitor(p_logfile,"No Records Processed",NULL,NULL);
		APL_GOBACK_SUCCESS
	}	
	else if(*int_l_runseq_a <= MAXROWS )
	{


		if(strlen(chr_l_str_batchno) != 5)
      {
      	if(APL_FAILURE == CO_PadString(chr_l_str_batchno,'L',5,"0",l_debug_info_ptr))
         APL_GOBACK_FAIL
      }

		if(APL_FAILURE == CO_Pro_GrAccRep(chr_l_str_batchno,chr_l_sysdate_b,CORE_MOD_IND,argv,p_intl_envdatastruct_h,l_debug_info_ptr))
		{
			APL_GOBACK_FAIL
		}
	}

	IS_ANY_ORA_ERROR;

	RETURN_SUCCESS:
	{
		APL_FREE(int_l_runseq_a);
		APL_FREE(l_dcredit_ind);
		APL_FREE(l_ccredit_ind);
		CO_ProcMonitor(p_logfile,"Successfully exiting out of CDBGenGrAccFn",NULL,NULL);
		return(APL_SUCCESS);
	}
		
   RETURN_FAILURE :
	{
		APL_FREE(int_l_runseq_a);
      APL_FREE(l_dcredit_ind);
      APL_FREE(l_ccredit_ind);
		sprintf(chr_l_str_batchno,"%d",int_l_batch_no);

		if(APL_FAILURE ==CO_Pro_GrAccRep(chr_l_str_batchno,chr_l_sysdate_b,CORE_MOD_IND,argv,p_intl_envdatastruct_h,l_debug_info_ptr));
	   {
			CO_ProcMonitor(p_logfile,"not Successful in writing to the chr_logfile the mismatch of DR_FLAG and CREDIT",NULL,NULL);
		}								
		return(APL_FAILURE);
	}
}		



int CDBGenTrdAccFn(char *p_deal_rowid,char *p_batch_no,int *p_runseq,char chr_p_typeofinstr,double *p_dct,double *p_cct,FILE *p_logfile,INTL_ENV_DATA_STRUCT_H *p_intl_envdatastruct_h,DEBUG_INFO_STRUCT_H **l_debug_info_ptr)
{
		
	PRO_GRACCTENT_STRUCT_H  *l_pro_gracctent_struct_ha_a             =  NULL;
   char     chr_l_h_trd_client[APL_CLIENT_LENGTH]       	=  APL_NULL_STRING;
   char     chr_l_h_trd_refno[APL_TXNREFNO_LEN]        	=  APL_NULL_STRING;
   char     chr_l_h_trd_trcode[APL_FLAG_LENGTH]           	=  APL_NULL_STRING;
   char     chr_l_h_trd_ccycode[APL_CCYCODE_LEN]       	=  APL_NULL_STRING;
	char     chr_l_h_trd_locncode[APL_LOCNCODE_LENGTH]        =  APL_NULL_STRING;
	char     chr_l_h_trd_domcpac[APL_CLIENT_LENGTH]				=	APL_NULL_STRING;
   char     chr_l_h_stx_client[GL_ACCOUNT_LEN]     	=  APL_NULL_STRING;
	char     chr_l_h_trd_instr_dt[APL_DATE_LEN]					=	APL_NULL_STRING;
	char     chr_l_h_trd_moneydt[APL_DATE_LEN]					=	APL_NULL_STRING;
	char     chr_l_h_trd_hostdt[APL_DATE_LEN]					=	APL_NULL_STRING;
   char     chr_l_sysdate_b[APL_DATE_LEN]                	=  APL_NULL_STRING;
	char     chr_l_h_trd_brokerno[13]								=	APL_NULL_STRING;
	char     chr_l_h_trd_glclient[APL_CLIENT_LENGTH]		=	APL_NULL_STRING;
	char     chr_l_h_trd_vtbclient[APL_CLIENT_LENGTH]			=	APL_NULL_STRING;
	char   	chr_l_h_domcpac_glaccount[APL_CLIENT_LENGTH]	=	APL_NULL_STRING;
	char     chr_l_h_domcpac_vtbaccount[APL_CLIENT_LENGTH]	=	APL_NULL_STRING;
	char		chr_l_h_citibank_glaccount[APL_CLIENT_LENGTH]	=	APL_NULL_STRING;
	char     chr_l_h_trd_typeoftrd[DEALTYPE_LEN_A]          =  APL_NULL_STRING;
	char		chr_l_h_domcpac_cubk[APL_FLAG_LENGTH]				=	APL_NULL_STRING;
	char		chr_l_h_trd_typeofinstr[TYPEOF_INSTR_LEN]				=	APL_NULL_STRING;
	char		chr_l_h_isin[13]										=	APL_NULL_STRING;
	char		chr_l_h_instrdesc[19]									=	APL_NULL_STRING; 
	char		chr_l_newtext1[33]										= APL_NULL_STRING;  
	char		chr_l_newtext2[33]										= APL_NULL_STRING;  
	char     chr_mainfuncarea[APL_MAINFUNCAREA_LEN]		=	APL_NULL_STRING;
	char		chr_l_subfunc_b[APL_MAINFUNCAREA_LEN]				=	APL_NULL_STRING;
	char		chr_l_fieldval[APL_MAINFUNCAREA_LEN]				=	APL_NULL_STRING;
	char     chr_l_h_cdom[APL_CCYCODE_LEN]						=	APL_NULL_STRING;
	char		chr_l_h_cdom2[APL_CCYCODE_LEN]						=	APL_NULL_STRING;
	char     *chr_l_str_runseq									   =	APL_NULL_STRING;
	char      chr_l_rvp[APL_FLAG_LENGTH]                      =  APL_NULL_STRING;
   char      chr_l_dvp[APL_FLAG_LENGTH]                      =  APL_NULL_STRING;
   char      chr_l_h_trd_cashclient[APL_CLIENT_LENGTH]     =  APL_NULL_STRING;
   char      chr_l_h_main_func_area[APL_MAINFUNCAREA_LEN] =  APL_NULL_STRING;
   char      chr_l_h_sub_func[APL_MAINFUNCAREA_LEN]       =  APL_NULL_STRING;
   char      chr_l_h_ncd_curr[APL_CCYCODE_LEN]				=	APL_NULL_STRING;
   char      chr_l_h_emu_curr[APL_CCYCODE_LEN]				=	APL_NULL_STRING;
   char      chr_l_str_decexchrate[DEC_LEN_RATE]			=	APL_NULL_STRING;
	char      chr_l_str_intexchrate[INTLENGTHRATE]         =  APL_NULL_STRING;
	char      chr_l_str_exchrate[12]								=	APL_NULL_STRING;
   char      **temp												=	NULL;
   char      chr_l_temp_exchrate[14]								=	APL_NULL_STRING;

   double   l_h_trd_brokercomm                        	=  0.0;
   double   l_h_trd_amount                         	=  0.0;
	double   l_h_trd_quantity											=	0.0;
	double   l_round2_trd_amount                       =  0.0;
	double   l_round2_trd_quantity									=	0.0;
	double   int_l_diff												=	0.0;
	double   l_transamount										=	0.0;
	double   i_runsequence;
	double   *l_ccredit_ind;													
	double   *l_dcredit_ind;
   double   l_h_exchgrt										=	0.0;
   double   l_exchgrt_a                                =  0.0;
   double   l_ae_rate												=	0.0;
   double   l_doub_exchgrt									=	0.0;
   double   l_grd_amount										=	0.0;
	double   p_fdcredit_ind                                    =  0.0;
   double   p_fccredit_ind                                    =  0.0;
	
   double   l_h_exchgrt1                             =  0.0;
   double   l_exchgrt1                               =  0.0;
   double   l_ae_rate1                                   =  0.0;
   char     chr_l_ccycode[APL_CCYCODE_LEN]                =  APL_NULL_STRING;

   short    l_i_trd_brkcomm                        	=  0;
   short    l_i_trd_account                        	=  0;
   short    l_i_trd_refno                          	=  0;
   short    l_i_trd_trcode                         	=  0;
   short    l_i_trd_amount                         	=  0;
   short    l_i_trd_ccycode                        	=  0;
	short    l_i_trd_locncode									=	0;
	short    l_i_trd_domcpac									=	0;
   short    l_i_stx_account                        	=  0;
	short    l_i_trd_hostdt										=	0;
	short    l_i_trd_moneydt									=	0;
	short    l_i_trd_instr_dt										=	0;
	short    l_i_trd_brokerno									=	0;
	short    l_i_trd_ibbsaccount								=  0;
	short    l_i_trd_qty											=	0;	
	short    l_i_trd_vtbaccount								=	0;
	short    l_i_trd_typeoftrd                         =  0;
	short    l_i_domcpac_ibbsaccount							=	0;
	short    l_i_domcpac_vtbaccount							=	0;
	short    l_i_domcpac_cubk									=	0;
	short    l_i_citibank_ibbsaccount						=	0;
	short    l_i_trd_typeofinstr									=	0;
	short    int_l_i_isin									         =	0;
	short    l_i_instr_name											=  0;
	short    l_i_cDom									         =	0;
	short    l_i_cDom2									      =	0;
   short    l_i_cashaccount									=	0;

	int      int_l_condexists                              =  0;
 	int      int_retval												=	0;
   int      int_l_periodflg                               =  0; 
	int      int_num													=	0;
	int      int_l_int_exchrate                            =  0;
   int      int_len													=	0;
	long int      int_l_int_rate											=	0;


   EXEC SQL VAR   chr_l_h_trd_client  	 			IS STRING;
   EXEC SQL VAR   chr_l_h_trd_refno     			IS STRING;
   EXEC SQL VAR   chr_l_h_trd_trcode  	   		IS STRING;
   EXEC SQL VAR   chr_l_h_trd_ccycode   			IS STRING;
	EXEC SQL VAR   chr_l_h_trd_domcpac   			IS STRING;
   EXEC SQL VAR   chr_l_h_stx_client   			IS STRING;
	EXEC SQL VAR   chr_l_h_trd_instr_dt     			IS STRING;
	EXEC SQL VAR   chr_l_h_trd_moneydt   			IS STRING;
	EXEC SQL VAR   chr_l_h_trd_hostdt    			IS STRING;
	EXEC SQL VAR   chr_l_h_trd_brokerno  			IS STRING;
	EXEC SQL VAR   chr_l_h_trd_vtbclient			IS STRING;
	EXEC SQL VAR   chr_l_h_domcpac_glaccount 	IS STRING;
	EXEC SQL VAR   chr_l_h_domcpac_vtbaccount		IS STRING;
	EXEC SQL VAR   chr_l_h_citibank_glaccount	IS STRING;
	EXEC SQL VAR   chr_l_h_stx_client				IS STRING;
	EXEC SQL VAR   chr_l_h_domcpac_cubk           IS STRING;
	EXEC SQL VAR   chr_l_h_isin                   IS STRING;
	EXEC SQL VAR   chr_l_h_cdom					   	IS STRING;
	EXEC SQL VAR   chr_l_h_cdom2						IS STRING;
	EXEC SQL VAR   chr_l_h_trd_typeofinstr            IS STRING;
	EXEC SQL VAR   chr_l_h_trd_locncode           IS STRING;
	EXEC SQL VAR   chr_l_h_trd_typeoftrd				IS STRING;
   EXEC SQL VAR   chr_l_h_trd_cashclient        IS STRING;
   EXEC SQL VAR   chr_l_h_main_func_area         IS STRING;
   EXEC SQL VAR   chr_l_h_sub_func               IS STRING;
   EXEC SQL VAR   chr_l_h_ncd_curr               IS STRING;
   EXEC SQL VAR   chr_l_h_emu_curr               IS STRING;
	EXEC SQL VAR   chr_l_ccycode                  IS STRING;



	
	
		if(!strlen(p_deal_rowid))
		{
			 APL_DATA_MISSING("TRADE ROW ID",APL_NULL_STRING,APL_NULL_STRING)
		}
		if(!strlen(p_batch_no))
		{
			 APL_DATA_MISSING("BATCH NUMBER",APL_NULL_STRING,APL_NULL_STRING)
		}
		if (CO_ChkErr(*l_debug_info_ptr) ==APL_SUCCESS)
  	 	{
      	  APL_GOBACK_FAIL
   	}



		if ( APL_FAILURE == CO_RtvSysDt(  chr_l_sysdate_b,
                                          l_debug_info_ptr ) )
   	{
      	APL_GOBACK_FAIL;
   	}


	 l_pro_gracctent_struct_ha_a  = (PRO_GRACCTENT_STRUCT_H *)calloc(1,sizeof(PRO_GRACCTENT_STRUCT_H ));
    APL_MALLOC_FAIL(l_pro_gracctent_struct_ha_a);


   chr_l_rvp[0] = DEALCD_RVP;
   chr_l_rvp[1] = '\0';

   chr_l_dvp[0] = DEALCD_DVP;
   chr_l_dvp[1] = '\0';

	EXEC SQL SELECT a.client,
						 a.IDENTIY_NO,
						 a.AMOUNT,
						 a.QTY,
						 a.location_cd,	
						 a.domestic_cpclt,
						 a.deal_cd,
					  	 a.currency_cd,
                   a.HOST_DATE,
						 a.MONEY_SETL_DT,
						 a.brokercomm,		
						 a.INSTRUMENT_DT,
					    a.BRK_NO,
					    a.dl_class
				INTO   :chr_l_h_trd_client:l_i_trd_account, 
                   :chr_l_h_trd_refno:l_i_trd_refno,
                   :l_h_trd_amount:l_i_trd_amount,
					    :l_h_trd_quantity:l_i_trd_qty,	
						 :chr_l_h_trd_locncode:l_i_trd_locncode,
                   :chr_l_h_trd_domcpac:l_i_trd_domcpac,
                   :chr_l_h_trd_trcode:l_i_trd_trcode, 
                   :chr_l_h_trd_ccycode:l_i_trd_ccycode, 
                   :chr_l_h_trd_hostdt:l_i_trd_hostdt,
						 :chr_l_h_trd_moneydt:l_i_trd_moneydt,
						 :l_h_trd_brokercomm:l_i_trd_brkcomm,	
						 :chr_l_h_trd_instr_dt:l_i_trd_instr_dt,
						 :chr_l_h_trd_brokerno:l_i_trd_brokerno, 
						 :chr_l_h_trd_typeoftrd:l_i_trd_typeoftrd
				FROM   dl_deal a
				WHERE  a.rowid=:p_deal_rowid;	

	  IS_ANY_ORA_ERROR_AND_ZERO_RESULTSET( ERR_DEAL_NF,
                                     		p_deal_rowid, 
                                          APL_NULL_STRING,
                                          APL_NULL_STRING);




	EXEC SQL SELECT b.CLN_GL_ACCOUNT,
                   rtrim(b.CLN_vtb_client,' ')
				INTO   :chr_l_h_trd_glclient:l_i_trd_ibbsaccount,
						 :chr_l_h_trd_vtbclient:l_i_trd_vtbaccount	
				FROM   MT_CLIENT b
				WHERE  b.CLN_CODE=:chr_l_h_trd_client;

	IS_ANY_ORA_ERROR_AND_ZERO_RESULTSET( ERR_ACCNOT_FND,
                                          chr_l_h_trd_client,
                                          APL_NULL_STRING,
                                          APL_NULL_STRING);


	EXEC SQL SELECT b.CLN_GL_ACCOUNT,
						 rtrim(b.CLN_vtb_client,' '),
						 b.CLN_BRK_ALL
				INTO   :chr_l_h_domcpac_glaccount:l_i_domcpac_ibbsaccount,
						 :chr_l_h_domcpac_vtbaccount:l_i_domcpac_vtbaccount,
						 :chr_l_h_domcpac_cubk:l_i_domcpac_cubk
				FROM   MT_CLIENT b					
				WHERE  b.CLN_CODE=:chr_l_h_trd_domcpac;

	IS_ANY_ORA_ERROR_AND_ZERO_RESULTSET( ERR_ACCNOT_FND,
                                          chr_l_h_trd_domcpac,
                                          APL_NULL_STRING,
                                          APL_NULL_STRING);


	EXEC SQL SELECT b.CLN_GL_ACCOUNT
				INTO   :chr_l_h_citibank_glaccount:l_i_citibank_ibbsaccount
				FROM   MT_CLIENT b
				WHERE   b.CLN_CODE=:l_mt_core_sys_params_struct_h.custody_clt_cd;    


	IS_ANY_ORA_ERROR_AND_ZERO_RESULTSET( ERR_ACCNOT_FND,
                                          (char *)l_mt_core_sys_params_struct_h.custody_clt_cd,
                                          APL_NULL_STRING,
                                          APL_NULL_STRING);//Changes done for AIX Migration



   EXEC SQL SELECT MT_INSTRUMENT.INSTR_ISIN,
						 MT_INSTRUMENT.INSTR_TYPE,
						 MT_INSTRUMENT.instr_name
            INTO   :chr_l_h_isin:int_l_i_isin,
						 :chr_l_h_trd_typeofinstr:l_i_trd_typeofinstr,
						 :chr_l_h_instrdesc:l_i_instr_name
            FROM   MT_INSTRUMENT
            WHERE  MT_INSTRUMENT.instr_code =
                                    (SELECT dl_deal.instr_code
                                     FROM dl_deal
                                     WHERE dl_deal.rowid=:p_deal_rowid);


	IS_ANY_ORA_ERROR_AND_ZERO_RESULTSET( ERR_INSTR_NOTFND,
                                          p_deal_rowid,
                                          APL_NULL_STRING,
                                          APL_NULL_STRING);


	EXEC SQL SELECT MT_CLIENT_ENTRIES.STX_CLIENT
				INTO  :chr_l_h_stx_client:l_i_stx_account
				FROM  MT_CLIENT_ENTRIES;  
	
	IS_ANY_ORA_ERROR_AND_ZERO_RESULTSET( ERR_VAL_NF,
                                          "Gen Settl Acc",
                                          APL_NULL_STRING,
                                          APL_NULL_STRING);


	EXEC SQL SELECT PRO_GMATCHVALUE.MAP_VAL                                                                               
            INTO :chr_l_h_cdom:l_i_cDom
            FROM PRO_GMATCHVALUE
            WHERE PRO_GMATCHVALUE.MAPVALUE =
                                        (SELECT MT_CLIENT.COUNTRY
                                         FROM   MT_CLIENT
                                         WHERE MT_CLIENT.CLN_CODE = :chr_l_h_trd_client)
           AND PRO_GMATCHVALUE.MAPTYPE = 'CNTRY_CURR';
	

	  IS_ANY_ORA_ERROR_AND_ZERO_RESULTSET( ERR_VAL_NF,
                                          "Currency Of Acc",
                                          APL_NULL_STRING,
                                          APL_NULL_STRING);


   EXEC SQL SELECT PRO_GMATCHVALUE.MAP_VAL
            INTO :chr_l_h_cdom2:l_i_cDom2
            FROM PRO_GMATCHVALUE
            WHERE PRO_GMATCHVALUE.MAPVALUE =
                                        (SELECT MT_CLIENT.COUNTRY
                      						  FROM   MT_CLIENT
                                         WHERE MT_CLIENT.CLN_CODE = :chr_l_h_trd_domcpac)
			  AND PRO_GMATCHVALUE.MAPTYPE = 'CNTRY_CURR';	
				
	  IS_ANY_ORA_ERROR_AND_ZERO_RESULTSET( ERR_VAL_NF,
                                          "Currency Of Domcpac",
                                          APL_NULL_STRING,
                                          APL_NULL_STRING);




 	  EXEC SQL SELECT gl_client 
   	         INTO :chr_l_h_trd_cashclient:l_i_cashaccount
      		   FROM dl_deal
             	WHERE client=:chr_l_h_trd_client
	            AND IDENTIY_NO=:chr_l_h_trd_refno;

   	IS_ANY_ORA_ERROR_AND_ZERO_RESULTSET(ERR_VAL_NF,
                                         "Cash account",
                                          APL_NULL_STRING,
 		    		  	 							  APL_NULL_STRING);


	
	if (!strcmp(chr_l_h_trd_typeoftrd, DEALTYPE_CORP_A) &&
		!strncmp(chr_l_h_trd_refno, CA_BONDRD_IND, 6))
	{
		CO_PadString(chr_l_h_instrdesc,'R',18," ",l_debug_info_ptr);
		strcpy( chr_l_newtext1, chr_l_h_isin );
		strcat( chr_l_newtext1, chr_l_h_instrdesc );
		strcat( chr_l_newtext1, "FU" ); 
		strcpy( chr_l_newtext2, "LL");
	}
	else
	{
		
		strcpy( chr_l_newtext1, chr_l_h_trd_refno );
		strcpy( chr_l_newtext2, chr_l_h_trd_refno );
	}
		

	

	int_l_periodflg = 0;
   if( APL_FAILURE == CO_Chk_EMU_Period(chr_l_sysdate_b,&int_l_periodflg,l_debug_info_ptr))
	{
		APL_GOBACK_FAIL
	}

#ifdef EMU_PROCESSING

   if (int_l_periodflg == 2)
	{
	

 	  strcpy(chr_l_h_main_func_area,"EMUCONV");
     strcpy(chr_l_h_sub_func,"NCD_CCY");

 	  EXEC SQL SELECT FIELD_VAL
   	         INTO :chr_l_h_ncd_curr
      	      FROM PRO_GSSPLVAL 
         	   WHERE MAIN_FUN=:chr_l_h_main_func_area
            	AND   SUB_PROCESS = :chr_l_h_sub_func
            	AND  NATION=:g_mt_commonsys_params_struct_h.nation_code;
 
  	 IS_ANY_ORA_ERROR
	
  	 strcpy(chr_l_h_main_func_area,"EMUCONV");
  	 strcpy(chr_l_h_sub_func,"EMU_CCY");

 	 EXEC SQL SELECT FIELD_VAL
   	        INTO :chr_l_h_emu_curr
      	     FROM PRO_GSSPLVAL 
         	  WHERE MAIN_FUN=:chr_l_h_main_func_area
           	  AND   SUB_PROCESS = :chr_l_h_sub_func
           	  AND  NATION=:g_mt_commonsys_params_struct_h.nation_code;

 	 IS_ANY_ORA_ERROR

 	 
 
    
 	 EXEC SQL SELECT EXCHGRT
   	        INTO :l_h_exchgrt
      	     FROM MT_EXCHRATE
         	  WHERE currency_cd=:chr_l_h_ncd_curr
              AND DENOM_CCY = :chr_l_h_emu_curr
              AND RATE_DATE = (select MAX(RATE_DATE) from MT_EXCHRATE where currency_cd =:chr_l_h_ncd_curr and DENOM_CCY=:chr_l_h_emu_curr);

    IS_ANY_ORA_ERROR_AND_ZERO_RESULTSET(ERR_VAL_NF,
      	                                 "Exchange Rate",
         	                               APL_NULL_STRING,
		   										    APL_NULL_STRING);


	

 	if(l_mt_core_sys_params_struct_h.dir_indir_fxqt_ind[0] == 'I')
	   l_exchgrt_a = l_h_exchgrt;
   else
      l_exchgrt_a = 1/l_h_exchgrt;


   
 
  
  		if (APL_FAILURE == CO_ToStr(l_h_exchgrt,9,7,chr_l_str_exchrate))
		{
			APL_GOBACK_FAIL
		}

      strcpy(chr_l_temp_exchrate,chr_l_str_exchrate);

		int_len = strlen(chr_l_temp_exchrate);
    
      chr_l_temp_exchrate[int_len]='.';
      chr_l_temp_exchrate[int_len+1]='\0';



 		if (APL_FAILURE == CO_SplitStr( chr_l_temp_exchrate,
      	                             '.',
         	                          &int_num,
            	                       &temp ))
   	{
   		APL_GOBACK_FAIL
   	}

 	   if (int_num != 2)
   	{
			APL_GOBACK_FAIL
		}
	
   	strcpy(chr_l_str_intexchrate,temp[0]);
		strcpy(chr_l_str_decexchrate,temp[1]);

      strcpy(chr_l_str_exchrate,APL_NULL_STRING);

      strcat(chr_l_str_exchrate,chr_l_str_intexchrate);

      strcat(chr_l_str_exchrate,chr_l_str_decexchrate);

		sscanf(chr_l_str_exchrate,"%lf",&l_doub_exchgrt);

	
	
      l_ae_rate = l_exchgrt_a;
	}

   
   if (int_l_periodflg == 3)
   {
     strcpy(chr_l_h_emu_curr,"EUR");

     EXEC SQL SELECT CURRENCY_CD
                 INTO :chr_l_ccycode
                 FROM MT_CLIENT
                WHERE CLIENT=:chr_l_h_trd_client;

     IS_ANY_ORA_ERROR_AND_ZERO_RESULTSET(ERR_VAL_NF,
                                           "Account",
                                           APL_NULL_STRING,
                                           APL_NULL_STRING);


   
    EXEC SQL SELECT EXCHGRT
              INTO :l_h_exchgrt
              FROM MT_EXCHRATE
              WHERE currency_cd=:chr_l_ccycode
              AND DENOM_CCY = :chr_l_h_emu_curr
              AND RATE_DATE = (select MAX(RATE_DATE) from MT_EXCHRATE where currency_cd =:chr_l_ccycode and DENOM_CCY=:chr_l_h_emu_curr);

    IS_ANY_ORA_ERROR_AND_ZERO_RESULTSET(ERR_VAL_NF,
                                          "Exchange Rate",
                                           APL_NULL_STRING,
                                           APL_NULL_STRING);


    EXEC SQL SELECT EXCHGRT
              INTO :l_h_exchgrt1
              FROM MT_EXCHRATE
              WHERE currency_cd=:chr_l_h_trd_ccycode
              AND DENOM_CCY = :chr_l_h_emu_curr
              AND RATE_DATE = (select MAX(RATE_DATE) from MT_EXCHRATE where currency_cd =:chr_l_h_trd_ccycode and DENOM_CCY=:chr_l_h_emu_curr);

    IS_ANY_ORA_ERROR_AND_ZERO_RESULTSET(ERR_VAL_NF,
                                          "Exchange Rate",
                                           APL_NULL_STRING,
                                           APL_NULL_STRING);

   if(l_mt_core_sys_params_struct_h.dir_indir_fxqt_ind[0] == 'I')
      {
        l_exchgrt_a = l_h_exchgrt;
        l_exchgrt1 = l_h_exchgrt1;
      }
   else
      {
        l_exchgrt_a = 1/l_h_exchgrt;
        l_exchgrt1 = 1/l_h_exchgrt1;
      }

 
      if (APL_FAILURE == CO_ToStr(l_h_exchgrt,9,7,chr_l_str_exchrate))
      {
         APL_GOBACK_FAIL
      }

      strcpy(chr_l_temp_exchrate,chr_l_str_exchrate);

      int_len = strlen(chr_l_temp_exchrate);

      chr_l_temp_exchrate[int_len]='.';
      chr_l_temp_exchrate[int_len+1]='\0';



      if (APL_FAILURE == CO_SplitStr( chr_l_temp_exchrate,
                                      '.',
                                      &int_num,
                                      &temp ))
      {
         APL_GOBACK_FAIL
      }

      if (int_num != 2)
      {
         APL_GOBACK_FAIL
      }

      strcpy(chr_l_str_intexchrate,temp[0]);
      strcpy(chr_l_str_decexchrate,temp[1]);

      strcpy(chr_l_str_exchrate,APL_NULL_STRING);

      strcat(chr_l_str_exchrate,chr_l_str_intexchrate);

      strcat(chr_l_str_exchrate,chr_l_str_decexchrate);

      sscanf(chr_l_str_exchrate,"%lf",&l_doub_exchgrt);

   

      l_ae_rate = l_exchgrt_a;
      l_ae_rate1 = l_exchgrt1;
}

#endif	

	

	CO_Round(l_h_trd_amount,2,&l_round2_trd_amount);
	CO_Round(l_h_trd_quantity,2,&l_round2_trd_quantity);

	
   strcpy(chr_mainfuncarea,"ACC_ENTRIES");
   strcpy(chr_l_subfunc_b,"LOCATION_CD");	
	strcpy(chr_l_fieldval,chr_l_h_trd_locncode);

   int_retval=CO_Chk_SplVal(chr_mainfuncarea,chr_l_subfunc_b,chr_l_fieldval,&int_l_condexists,l_debug_info_ptr);
	if (int_retval == APL_FAILURE)
		APL_GOBACK_FAIL

		if((int_l_condexists > 0)&&(strcmp(chr_l_h_trd_typeoftrd,DL_BOOKTRF_IND)!= 0)&& (VAL_VP_DEAL(chr_l_h_trd_trcode[0])))
		{
			
			memset( l_pro_gracctent_struct_ha_a, NULL, sizeof(PRO_GRACCTENT_STRUCT_H) );
			
			l_pro_gracctent_struct_ha_a->h_module_ind[0]='C';
			l_pro_gracctent_struct_ha_a->h_module_ind[1]='\0';
			strcpy(l_pro_gracctent_struct_ha_a->h_proc_num,p_batch_no);

	   	strcpy(l_pro_gracctent_struct_ha_a->h_batch_dt,chr_l_sysdate_b);

	   	/*changes by bageshri for 10G migration */
			l_pro_gracctent_struct_ha_a->h_instr_class[0]= chr_p_typeofinstr; 
			l_pro_gracctent_struct_ha_a->h_instr_class[1]='\0';

			strcpy(l_pro_gracctent_struct_ha_a->h_rec_class,DL_REC_DET);

			l_pro_gracctent_struct_ha_a->h_status_ind[0]=AE_GEN_IND_CHAR;
			l_pro_gracctent_struct_ha_a->h_status_ind[1]='\0';
			if(!strcmp(chr_l_h_trd_typeofinstr,TYPEOFINSTR_FMT))
				strcpy(l_pro_gracctent_struct_ha_a->h_entry,TYPEOFINSTR_BOND);
			else if ((!strcmp(chr_l_h_trd_typeofinstr,TYPOF_INSTR_SHS)) || (!strcmp(chr_l_h_trd_typeofinstr,DEALCD_RTS)))
				strcpy(l_pro_gracctent_struct_ha_a->h_entry,TYPOF_INSTR_SHS);
			else
				strcpy(l_pro_gracctent_struct_ha_a->h_entry,TYPEOFINSTR_BOND);

 			

				if (!strcmp(chr_l_h_trd_cashclient,APL_NULL_STRING))
				{
	   			strcpy(l_pro_gracctent_struct_ha_a->h_dl_client,chr_l_h_trd_glclient);
				}
				else
				{
					strcpy(l_pro_gracctent_struct_ha_a->h_dl_client,chr_l_h_trd_cashclient);
				}
	
			
			
			if ( (int_l_periodflg != 2) && (int_l_periodflg != 3) )
			{  
				strcpy(l_pro_gracctent_struct_ha_a->h_currencycode,chr_l_h_trd_ccycode);
			}
			else
			{
				strcpy(l_pro_gracctent_struct_ha_a->h_currencycode,CCY_EUR_IND);
				
			}

			if (VAL_VP_DEAL(chr_l_h_trd_trcode[0]))
			{
				

			
			if ((int_l_periodflg != 2) && (int_l_periodflg != 3))
				{
					l_pro_gracctent_struct_ha_a->h_trans_amt=l_round2_trd_amount*100;
				}
				else
				{
					
					
					if (int_l_periodflg == 3)
						{
							l_grd_amount = 0.0;
							CO_Round((l_round2_trd_amount/l_ae_rate1), 2, &l_grd_amount);
							l_pro_gracctent_struct_ha_a->h_trans_amt=l_grd_amount*100;
						}
					else
						{
							l_grd_amount = 0.0;
							CO_Round(l_round2_trd_amount*l_ae_rate, 0, &l_grd_amount);
							l_pro_gracctent_struct_ha_a->h_trans_amt=l_grd_amount*100;
						}
				}	
			 	strcpy(l_pro_gracctent_struct_ha_a->h_value_date,chr_l_h_trd_moneydt);	
			}
			else
			{
				
            if (int_l_periodflg == 3)
               l_pro_gracctent_struct_ha_a->h_trans_amt=1;
            else     
               l_pro_gracctent_struct_ha_a->h_trans_amt=100;
            strcpy(l_pro_gracctent_struct_ha_a->h_value_date,chr_l_sysdate_b);
			}

			if(!strcmp(chr_l_h_trd_trcode,chr_l_rvp))
				strcpy(l_pro_gracctent_struct_ha_a->h_deal_cd,DEALCD_215);
			else
				strcpy(l_pro_gracctent_struct_ha_a->h_deal_cd, DEALCD_267);
			
		   if (VAL_RECDEAL(chr_l_h_trd_trcode[0]))
				strcpy(l_pro_gracctent_struct_ha_a->h_db_cr_flag,DEBIT_IND);
         else
				strcpy(l_pro_gracctent_struct_ha_a->h_db_cr_flag,CREDIT_IND_B);
	
			strcpy(l_pro_gracctent_struct_ha_a->h_splgr_clt_cd,chr_l_h_trd_glclient);

			if(!strcmp(chr_l_h_trd_typeofinstr,TYPEOFINSTR_FMT))
				strcpy(l_pro_gracctent_struct_ha_a->h_statistic,"0001");
			else
				strcpy(l_pro_gracctent_struct_ha_a->h_statistic,"0000");	
			

			if((!strcmp(chr_l_h_domcpac_cubk,"B"))&&(strcmp(chr_l_h_trd_domcpac,l_mt_core_sys_params_struct_h.custody_clt_cd)!=0) && (chr_l_h_domcpac_glaccount[0] != '0'))
				strcpy(l_pro_gracctent_struct_ha_a->h_trans_bog, MS_SWIFT_BOGNO_0050);
			else
				strcpy(l_pro_gracctent_struct_ha_a->h_trans_bog,  MS_SWIFT_BOGNO_0731);

			if((!strcmp(chr_l_h_cdom,CCY_GRD_IND)) || (!strcmp(chr_l_h_trd_typeofinstr,TYPEOFINSTR_FMT)))
				l_pro_gracctent_struct_ha_a->h_quantity_items = 0;
			else
				l_pro_gracctent_struct_ha_a->h_quantity_items = l_round2_trd_quantity;



		
				strcpy(l_pro_gracctent_struct_ha_a->h_offset_client,chr_l_h_domcpac_glaccount);
		
	
			if(!strcmp(chr_l_h_cdom,CCY_GRD_IND))
			{
				strcpy(l_pro_gracctent_struct_ha_a->h_broker_cd,"00000");
				strcpy(l_pro_gracctent_struct_ha_a->h_nationality,APL_NULL_STRING);
				strcpy(l_pro_gracctent_struct_ha_a->h_instr_isin,APL_NULL_STRING);
			}
			else
			{
				strncpy(l_pro_gracctent_struct_ha_a->h_broker_cd,chr_l_h_domcpac_vtbaccount,5);
				l_pro_gracctent_struct_ha_a->h_broker_cd[5]='\0';
				strcpy(l_pro_gracctent_struct_ha_a->h_nationality,chr_l_h_cdom);
				strcpy(l_pro_gracctent_struct_ha_a->h_instr_isin,chr_l_h_isin);
			}
								
					
		   strcpy(l_pro_gracctent_struct_ha_a->h_special_tax,APL_NULL_STRING);

	   	strcpy(l_pro_gracctent_struct_ha_a->h_indentity_no,"0000000000");
 
	      strcpy(l_pro_gracctent_struct_ha_a->h_auto_rec_flag,"0000000000");
 
	      strcpy(l_pro_gracctent_struct_ha_a->h_note_a,chr_l_newtext1);	

	      strcpy(l_pro_gracctent_struct_ha_a->h_note_b,chr_l_newtext2);	 
 
		   

			
         if ( (int_l_periodflg != 2) && (int_l_periodflg != 3) )
			{
	   	   l_pro_gracctent_struct_ha_a->h_fcy_amt=0;
	      	l_pro_gracctent_struct_ha_a->h_rt=0; 
            
 			}
			else
			{
		   	if(VAL_FREE_DEAL(chr_l_h_trd_trcode[0]))
         	{
					
               
					if (int_l_periodflg == 1)
					{
            		l_pro_gracctent_struct_ha_a->h_fcy_amt = 0;
						l_pro_gracctent_struct_ha_a->h_rt=l_doub_exchgrt;
               }
				   else if (int_l_periodflg == 3)
					{
						l_pro_gracctent_struct_ha_a->h_fcy_amt = 0;
                  l_pro_gracctent_struct_ha_a->h_rt=0;
               }  
					else
					{
                  l_pro_gracctent_struct_ha_a->h_fcy_amt = 1;
                  l_pro_gracctent_struct_ha_a->h_rt=l_doub_exchgrt;
					}
         	}
				else
				{
               
               if ( int_l_periodflg == 3 )
                 {
                   l_grd_amount = 0.0;
                   if ( strcmp(chr_l_ccycode, CCY_EUR_IND) == 0 )
                      {
                        l_pro_gracctent_struct_ha_a->h_fcy_amt=0;
                        l_pro_gracctent_struct_ha_a->h_rt=0;
                      }
                   else
                      {
                        if ( strcmp(chr_l_ccycode, CCY_GRD_IND) == 0 )
                           {
                             
                             
                             l_pro_gracctent_struct_ha_a->h_fcy_amt = 0;
                             l_pro_gracctent_struct_ha_a->h_rt=0;
                           }
                        else
                           {
                             CO_Round(((l_round2_trd_amount*l_ae_rate)/l_ae_rate1), 2, &l_grd_amount);
                             l_pro_gracctent_struct_ha_a->h_fcy_amt=l_grd_amount*100;
                             l_pro_gracctent_struct_ha_a->h_rt=l_doub_exchgrt;
                           }
                      }
                 }
               else
                 {
                   l_pro_gracctent_struct_ha_a->h_fcy_amt=l_round2_trd_amount*100;
                   l_pro_gracctent_struct_ha_a->h_rt=l_doub_exchgrt;
                 }
				}
				
			}			
	
	   	l_pro_gracctent_struct_ha_a->h_mis_sprd=0;
 
	      

	   	strcpy(l_pro_gracctent_struct_ha_a->h_safekeep_pos,"0");
			
			i_runsequence = *p_runseq;
			chr_l_str_runseq=ltoa((long)i_runsequence); 
      
			if(strlen(chr_l_str_runseq) != 5)
			{
				int_retval = CO_PadString(chr_l_str_runseq,'L',5,"0",l_debug_info_ptr);
				if(int_retval == APL_FAILURE)
					APL_GOBACK_FAIL	
			}
	   	strcpy(l_pro_gracctent_struct_ha_a->h_sequence,chr_l_str_runseq);

	   	strcpy(l_pro_gracctent_struct_ha_a->h_reas_cd,APL_NULL_STRING);

         
         sprintf(l_pro_gracctent_struct_ha_a->h_deal_ident,"%s^%s",chr_l_h_trd_client,chr_l_h_trd_refno);


	      if( APL_FAILURE == CO_Upd_IGrAcctEnt(l_pro_gracctent_struct_ha_a,l_debug_info_ptr))
	 		{
				CO_ProcMonitor(p_logfile,"Returned Unsuccessfully from CM_InsIGRAATENTFn",NULL,NULL);
				APL_GOBACK_FAIL
			}
		   else
		   {
				(*p_runseq)++;
			   if (!strcmp(l_pro_gracctent_struct_ha_a->h_db_cr_flag,DEBIT_IND ))
			   {
					*p_dct += l_pro_gracctent_struct_ha_a->h_trans_amt;
					p_fdcredit_ind += l_pro_gracctent_struct_ha_a->h_fcy_amt;
			   }
			   else
			   {
					*p_cct += l_pro_gracctent_struct_ha_a->h_trans_amt;
					 p_fccredit_ind +=l_pro_gracctent_struct_ha_a->h_fcy_amt;
			   }
			}

	
			if((l_h_trd_amount != l_h_trd_brokercomm) && (l_h_trd_brokercomm > 0))
			{
			

				memset( l_pro_gracctent_struct_ha_a, NULL, sizeof(PRO_GRACCTENT_STRUCT_H) );
    			l_pro_gracctent_struct_ha_a->h_module_ind[0]='C';
				l_pro_gracctent_struct_ha_a->h_module_ind[1]='\0';
      		strcpy(l_pro_gracctent_struct_ha_a->h_proc_num,p_batch_no);
      		strcpy(l_pro_gracctent_struct_ha_a->h_batch_dt,chr_l_sysdate_b);
      		
				/*changes by bageshri for 10G migration */
				l_pro_gracctent_struct_ha_a->h_instr_class[0]=chr_p_typeofinstr;
				l_pro_gracctent_struct_ha_a->h_instr_class[1]='\0';

      		strcpy(l_pro_gracctent_struct_ha_a->h_rec_class,DL_REC_DET);
				l_pro_gracctent_struct_ha_a->h_status_ind[0]=AE_GEN_IND_CHAR;
            l_pro_gracctent_struct_ha_a->h_status_ind[1]='\0';

				
				if(!strcmp(chr_l_h_trd_typeofinstr,TYPEOFINSTR_FMT))
      	      strcpy(l_pro_gracctent_struct_ha_a->h_entry,TYPEOFINSTR_BOND);
         	else if ((!strcmp(chr_l_h_trd_typeofinstr,TYPOF_INSTR_SHS)) || (!strcmp(chr_l_h_trd_typeofinstr,DEALCD_RTS)))
            	strcpy(l_pro_gracctent_struct_ha_a->h_entry,TYPOF_INSTR_SHS);
         	else
            	strcpy(l_pro_gracctent_struct_ha_a->h_entry,TYPEOFINSTR_BOND);
				

   			strcpy(l_pro_gracctent_struct_ha_a->h_dl_client,chr_l_h_domcpac_glaccount);
				
				if ( (int_l_periodflg != 2) && (int_l_periodflg != 3) )
				{
					strcpy(l_pro_gracctent_struct_ha_a->h_currencycode,chr_l_h_trd_ccycode);	
				}
				else
				{
					strcpy(l_pro_gracctent_struct_ha_a->h_currencycode,CCY_EUR_IND);
					
				}
				int_l_diff=fabs(l_h_trd_amount-l_h_trd_brokercomm);
				CO_Round(int_l_diff,2,&l_transamount);
				
				if ( (int_l_periodflg != 2) && (int_l_periodflg != 3) )
				{
					l_pro_gracctent_struct_ha_a->h_trans_amt=l_transamount*100;
         	}
				else
				{
					
					l_grd_amount = 0.0;
					
					if (int_l_periodflg == 3)
						CO_Round((l_transamount/l_ae_rate1), 2, &l_grd_amount);
					else
						CO_Round(l_transamount*l_ae_rate, 0, &l_grd_amount);

					l_pro_gracctent_struct_ha_a->h_trans_amt = l_grd_amount*100;
				}
				if (VAL_VP_DEAL(chr_l_h_trd_trcode[0]))
            {
            	strcpy(l_pro_gracctent_struct_ha_a->h_value_date,chr_l_h_trd_moneydt);
         	}
         	else
         	{
            	strcpy(l_pro_gracctent_struct_ha_a->h_value_date,chr_l_sysdate_b);
         	}

				
				if (VAL_RECDEAL(chr_l_h_trd_trcode[0]))
				{
					if(l_h_trd_amount > l_h_trd_brokercomm)
					{
						strcpy(l_pro_gracctent_struct_ha_a->h_db_cr_flag,CREDIT_IND_B);
					}
					else
					{
						 strcpy(l_pro_gracctent_struct_ha_a->h_db_cr_flag,DEBIT_IND);
					}
				}
				else
				{
					if(l_h_trd_amount > l_h_trd_brokercomm)
					{
					 strcpy(l_pro_gracctent_struct_ha_a->h_db_cr_flag,DEBIT_IND);
					}
					else
					{
					 strcpy(l_pro_gracctent_struct_ha_a->h_db_cr_flag,CREDIT_IND_B);
					}
				} 
				if(!strcmp(l_pro_gracctent_struct_ha_a->h_db_cr_flag,DEBIT_IND))
					strcpy(l_pro_gracctent_struct_ha_a->h_deal_cd,DEALCD_047);
				else
					strcpy(l_pro_gracctent_struct_ha_a->h_deal_cd, DEALCD_097);
			   strcpy(l_pro_gracctent_struct_ha_a->h_splgr_clt_cd,chr_l_h_trd_glclient);

      		strcpy(l_pro_gracctent_struct_ha_a->h_statistic,APL_NULL_STRING);
				strcpy(chr_mainfuncarea,"ACC_ENTRIES");
				strcpy(chr_l_subfunc_b,"BOG_TXN_ACC");
				strcpy(chr_l_fieldval,chr_l_h_domcpac_glaccount);

				int_retval = CO_Chk_SplVal(chr_mainfuncarea,chr_l_subfunc_b,chr_l_fieldval,&int_l_condexists,&l_debug_info_ptr);
				if (int_retval == APL_FAILURE)
					APL_GOBACK_FAIL

      		if (int_l_condexists > 0)
					strcpy(l_pro_gracctent_struct_ha_a->h_trans_bog, MS_SWIFT_BOGNO_0050);
				else
					strcpy(l_pro_gracctent_struct_ha_a->h_trans_bog,  MS_SWIFT_BOGNO_0332);
				
	

      		l_pro_gracctent_struct_ha_a->h_quantity_items = -1; 
			
			
			
		
					strcpy(l_pro_gracctent_struct_ha_a->h_offset_client,chr_l_h_domcpac_glaccount);
			
			

      		strcpy(l_pro_gracctent_struct_ha_a->h_broker_cd,"00000");   
				if(!strcmp(chr_l_h_cdom,CCY_GRD_IND))
					strcpy(l_pro_gracctent_struct_ha_a->h_nationality,APL_NULL_STRING);
				else
					strcpy(l_pro_gracctent_struct_ha_a->h_nationality,chr_l_h_cdom);
      		strcpy(l_pro_gracctent_struct_ha_a->h_instr_isin,APL_NULL_STRING);  
      		strcpy(l_pro_gracctent_struct_ha_a->h_special_tax,APL_NULL_STRING);  
      		strcpy(l_pro_gracctent_struct_ha_a->h_indentity_no,"0000000000");
      		strcpy(l_pro_gracctent_struct_ha_a->h_auto_rec_flag,"0000000000");
			   strcpy(l_pro_gracctent_struct_ha_a->h_note_a,chr_l_newtext1);	
      		strcpy(l_pro_gracctent_struct_ha_a->h_note_b,chr_l_newtext2);	 

            
				
            
            if ( (int_l_periodflg != 2) && (int_l_periodflg != 3) )
				{
      			l_pro_gracctent_struct_ha_a->h_fcy_amt = 0;
      		   l_pro_gracctent_struct_ha_a->h_rt = 0; 
				}
				else
            {
					if(VAL_FREE_DEAL(chr_l_h_trd_trcode[0]))
         		{
                  
                  
                  if (int_l_periodflg == 1)
                  {
                     l_pro_gracctent_struct_ha_a->h_fcy_amt = 0;
                     l_pro_gracctent_struct_ha_a->h_rt = l_doub_exchgrt;
                  }
                  else if (int_l_periodflg == 3)
                   {
                    l_pro_gracctent_struct_ha_a->h_fcy_amt = 0;
                    l_pro_gracctent_struct_ha_a->h_rt=0;
                   }
                  else
                  {
                     l_pro_gracctent_struct_ha_a->h_fcy_amt = 1;
                     l_pro_gracctent_struct_ha_a->h_rt = l_doub_exchgrt;
                  }
         		}
					else
         		{
                  
                  if (int_l_periodflg == 3)
                     {
                       l_grd_amount = 0.0;
                       if ( strcmp(chr_l_ccycode, CCY_EUR_IND) == 0 )
                          {
                           l_pro_gracctent_struct_ha_a->h_fcy_amt=0;
                           l_pro_gracctent_struct_ha_a->h_rt=0;
                          }
                       else
                          {
                            if ( strcmp(chr_l_ccycode, CCY_GRD_IND) == 0 )
                               {
                                 
                                 l_pro_gracctent_struct_ha_a->h_fcy_amt = 0;
                                 l_pro_gracctent_struct_ha_a->h_rt=0;
                               }
                            else
                               {
                                 CO_Round((l_transamount*l_ae_rate)/l_ae_rate1, 2, &l_grd_amount);
                                 l_pro_gracctent_struct_ha_a->h_fcy_amt = l_grd_amount*100;
                                 l_pro_gracctent_struct_ha_a->h_rt=l_doub_exchgrt;
                               }
                          }
                    }
                  else
                    {
                     l_pro_gracctent_struct_ha_a->h_fcy_amt = l_transamount*100;
                     l_pro_gracctent_struct_ha_a->h_rt = l_doub_exchgrt;
                    }
					}
              
				}				
      		l_pro_gracctent_struct_ha_a->h_mis_sprd = 0;

      		
      		strcpy(l_pro_gracctent_struct_ha_a->h_safekeep_pos,"0");
					i_runsequence=*p_runseq;
         
				chr_l_str_runseq=ltoa((long)i_runsequence);
				if(strlen(chr_l_str_runseq)!= 5)
            	int_retval = CO_PadString(chr_l_str_runseq,'L',5,"0",l_debug_info_ptr);
            	if(int_retval == APL_FAILURE)
               	APL_GOBACK_FAIL
         	strcpy(l_pro_gracctent_struct_ha_a->h_sequence,chr_l_str_runseq);

      		strcpy(l_pro_gracctent_struct_ha_a->h_reas_cd,APL_NULL_STRING);
				strcpy(l_pro_gracctent_struct_ha_a->h_deal_ident,APL_NULL_STRING);

			   if( APL_FAILURE == CO_Upd_IGrAcctEnt(l_pro_gracctent_struct_ha_a,l_debug_info_ptr))
            {
					CO_ProcMonitor(p_logfile,"Returned Unsuccessfully from CM_InsIGRAATENTFn",NULL,NULL);
            	APL_GOBACK_FAIL
         	}
            else
            {
            	(*p_runseq)++;
            	if (!strcmp(l_pro_gracctent_struct_ha_a->h_db_cr_flag,DEBIT_IND))
            	{
               	*p_dct += l_pro_gracctent_struct_ha_a->h_trans_amt;
					 	p_fdcredit_ind+= l_pro_gracctent_struct_ha_a->h_fcy_amt;
            	}
            	else
            	{
               	*p_cct += l_pro_gracctent_struct_ha_a->h_trans_amt;
						p_fccredit_ind += l_pro_gracctent_struct_ha_a->h_fcy_amt;
            	}
				}
			}
		
	

	  memset( l_pro_gracctent_struct_ha_a, NULL, sizeof(PRO_GRACCTENT_STRUCT_H) );


   	l_pro_gracctent_struct_ha_a->h_module_ind[0]='C';  
		l_pro_gracctent_struct_ha_a->h_module_ind[1]='\0';
      strcpy(l_pro_gracctent_struct_ha_a->h_proc_num,p_batch_no);
      strcpy(l_pro_gracctent_struct_ha_a->h_batch_dt,chr_l_sysdate_b);
		
		/* changes by bageshri for 10G migration */
		l_pro_gracctent_struct_ha_a->h_instr_class[0]=chr_p_typeofinstr;
		l_pro_gracctent_struct_ha_a->h_instr_class[1]='\0';
      
		strcpy(l_pro_gracctent_struct_ha_a->h_rec_class,DL_REC_DET);
		l_pro_gracctent_struct_ha_a->h_status_ind[0]=AE_GEN_IND_CHAR;
      l_pro_gracctent_struct_ha_a->h_status_ind[1]='\0';

		if(!strcmp(chr_l_h_trd_typeofinstr,TYPEOFINSTR_FMT))
         strcpy(l_pro_gracctent_struct_ha_a->h_entry,TYPEOFINSTR_BOND);
      else if ((!strcmp(chr_l_h_trd_typeofinstr,TYPOF_INSTR_SHS)) || (!strcmp(chr_l_h_trd_typeofinstr,DEALCD_RTS)))
         strcpy(l_pro_gracctent_struct_ha_a->h_entry,TYPOF_INSTR_SHS);
      else
         strcpy(l_pro_gracctent_struct_ha_a->h_entry,TYPEOFINSTR_BOND);

      strcpy(l_pro_gracctent_struct_ha_a->h_dl_client,chr_l_h_stx_client);
      
      if ( (int_l_periodflg != 2) && (int_l_periodflg != 3) )
		{
	   	strcpy(l_pro_gracctent_struct_ha_a->h_currencycode,chr_l_h_trd_ccycode);
		}
		else
		{
			strcpy(l_pro_gracctent_struct_ha_a->h_currencycode,CCY_EUR_IND);
			
		}
		if(l_h_trd_brokercomm != 0)
		{
			CO_Round(l_h_trd_brokercomm,2,&l_transamount);
         
         if ( (int_l_periodflg != 2) && (int_l_periodflg != 3) )
			{
				l_pro_gracctent_struct_ha_a->h_trans_amt = l_transamount*100;
			}
			else
			{
				
				l_grd_amount = 0.0;
            
            if (int_l_periodflg == 3)
                CO_Round((l_transamount/l_ae_rate1), 2, &l_grd_amount);
            else
                CO_Round(l_transamount*l_ae_rate, 0, &l_grd_amount);
            l_pro_gracctent_struct_ha_a->h_trans_amt = l_grd_amount*100;
			}
		}
		else
		{
         
         if ( (int_l_periodflg != 2) && (int_l_periodflg != 3) )
			{
				l_pro_gracctent_struct_ha_a->h_trans_amt =l_round2_trd_amount*100.0;	
			}
			else
			{
            
            l_grd_amount = 0.0;
            
            if (int_l_periodflg == 3)
               CO_Round((l_round2_trd_amount/l_ae_rate1), 2, &l_grd_amount);
            else
               CO_Round(l_round2_trd_amount*l_ae_rate, 0, &l_grd_amount);

            l_pro_gracctent_struct_ha_a->h_trans_amt = l_grd_amount*100.0;
			}
		}


		if (VAL_VP_DEAL(chr_l_h_trd_trcode[0]))	
      { 
        	strcpy(l_pro_gracctent_struct_ha_a->h_value_date,chr_l_h_trd_moneydt);
      }   
      else
      {
         strcpy(l_pro_gracctent_struct_ha_a->h_value_date,chr_l_sysdate_b);
      }

		if (VAL_RECDEAL(chr_l_h_trd_trcode[0]))
		{
			strcpy(l_pro_gracctent_struct_ha_a->h_deal_cd, DEALCD_097);
			strcpy(l_pro_gracctent_struct_ha_a->h_db_cr_flag,CREDIT_IND_B);
		}
		else
		{
			strcpy(l_pro_gracctent_struct_ha_a->h_deal_cd, DEALCD_047);
			strcpy(l_pro_gracctent_struct_ha_a->h_db_cr_flag,DEBIT_IND);
		}
		
	   strcpy(l_pro_gracctent_struct_ha_a->h_splgr_clt_cd,chr_l_h_trd_glclient);
      strcpy(l_pro_gracctent_struct_ha_a->h_statistic,APL_NULL_STRING);
      strcpy(l_pro_gracctent_struct_ha_a->h_trans_bog,"00000");
 
      l_pro_gracctent_struct_ha_a->h_quantity_items = -1;
      strcpy(l_pro_gracctent_struct_ha_a->h_offset_client,"0000000000");    
      strcpy(l_pro_gracctent_struct_ha_a->h_broker_cd,"00000");   
      strcpy(l_pro_gracctent_struct_ha_a->h_nationality,APL_NULL_STRING);  
      strcpy(l_pro_gracctent_struct_ha_a->h_instr_isin,APL_NULL_STRING);
      strcpy(l_pro_gracctent_struct_ha_a->h_special_tax,APL_NULL_STRING); 
      strcpy(l_pro_gracctent_struct_ha_a->h_indentity_no,"0000000000");
      strcpy(l_pro_gracctent_struct_ha_a->h_auto_rec_flag,"0000000000");
		strcpy(l_pro_gracctent_struct_ha_a->h_note_a,chr_l_newtext1);	
      strcpy(l_pro_gracctent_struct_ha_a->h_note_b,chr_l_newtext2);	 

       
      if ( (int_l_periodflg != 2) && (int_l_periodflg != 3) )
		{
      	l_pro_gracctent_struct_ha_a->h_fcy_amt = 0;
         l_pro_gracctent_struct_ha_a->h_rt = 0;
		}
		else
		{
			if(VAL_FREE_DEAL(chr_l_h_trd_trcode[0]))
         {
				if (int_l_periodflg == 1)
				{
            	l_pro_gracctent_struct_ha_a->h_fcy_amt = 0;
					l_pro_gracctent_struct_ha_a->h_rt = l_doub_exchgrt;
            }
            else if (int_l_periodflg == 3)
            {
               l_pro_gracctent_struct_ha_a->h_fcy_amt = 0;
               l_pro_gracctent_struct_ha_a->h_rt=0;
            }
            else
            {
               l_pro_gracctent_struct_ha_a->h_fcy_amt = 1;
               l_pro_gracctent_struct_ha_a->h_rt = l_doub_exchgrt;
            }
         }
			else
         {
            if (l_h_trd_brokercomm != 0)
				{
               
               if (int_l_periodflg == 3)
                  {
                    l_grd_amount = 0.0;
                    if ( strcmp(chr_l_ccycode, CCY_EUR_IND) == 0 )
                       {
                         l_pro_gracctent_struct_ha_a->h_fcy_amt=0;
                         l_pro_gracctent_struct_ha_a->h_rt=0;
                        }
                    else
                       {
                        if ( strcmp(chr_l_ccycode, CCY_GRD_IND) == 0 )
                           {
                             
                             l_pro_gracctent_struct_ha_a->h_fcy_amt=0;
                             l_pro_gracctent_struct_ha_a->h_rt=0;
                           }
                        else
                           {
                             CO_Round((l_transamount*l_ae_rate)/l_ae_rate1, 2, &l_grd_amount);
                             l_pro_gracctent_struct_ha_a->h_fcy_amt=l_grd_amount*100;
                             l_pro_gracctent_struct_ha_a->h_rt = l_doub_exchgrt;
                           }
                       }
                  }
                else
                 {
                   l_pro_gracctent_struct_ha_a->h_fcy_amt=l_transamount*100;
                   l_pro_gracctent_struct_ha_a->h_rt = l_doub_exchgrt;
                 }
				}
				else
				{
               
               if (int_l_periodflg == 3)
                  {
                    l_grd_amount = 0.0;
                    if ( strcmp(chr_l_ccycode, CCY_EUR_IND) == 0 )
                       {
                         l_pro_gracctent_struct_ha_a->h_fcy_amt=0;
                         l_pro_gracctent_struct_ha_a->h_rt=0;
                        }
                    else
                       {
                        if ( strcmp(chr_l_ccycode, CCY_GRD_IND) == 0 )
                           {
                             
                             l_pro_gracctent_struct_ha_a->h_fcy_amt=0;
                             l_pro_gracctent_struct_ha_a->h_rt=0;
                           }
                        else
                           {
                             CO_Round((l_round2_trd_amount*l_ae_rate)/l_ae_rate1, 2, &l_grd_amount);
                             l_pro_gracctent_struct_ha_a->h_fcy_amt=l_grd_amount*100;
                             l_pro_gracctent_struct_ha_a->h_rt = l_doub_exchgrt;
                           }
                       }
                  }
               else
                  {
                    l_pro_gracctent_struct_ha_a->h_fcy_amt=l_round2_trd_amount * 100;
                    l_pro_gracctent_struct_ha_a->h_rt = l_doub_exchgrt;
                  }
				}			
			}
         
		}

      l_pro_gracctent_struct_ha_a->h_mis_sprd = 0;
      
      strcpy(l_pro_gracctent_struct_ha_a->h_safekeep_pos,"0");
			i_runsequence=*p_runseq;
		chr_l_str_runseq=ltoa((long)i_runsequence);
      if(strlen(chr_l_str_runseq) != 5)
      {
         int_retval = CO_PadString(chr_l_str_runseq,'L',5,"0",l_debug_info_ptr);
         if(int_retval == APL_FAILURE)
         	APL_GOBACK_FAIL
       }
       strcpy(l_pro_gracctent_struct_ha_a->h_sequence,chr_l_str_runseq);

      strcpy(l_pro_gracctent_struct_ha_a->h_reas_cd,APL_NULL_STRING);
		strcpy(l_pro_gracctent_struct_ha_a->h_deal_ident,APL_NULL_STRING);

		

         (*p_runseq)++;
         if (!strcmp(l_pro_gracctent_struct_ha_a->h_db_cr_flag,DEBIT_IND))
         {
         	*p_dct += l_pro_gracctent_struct_ha_a->h_trans_amt;
				p_fdcredit_ind += l_pro_gracctent_struct_ha_a->h_fcy_amt;
         }
         else
         {
            *p_cct += l_pro_gracctent_struct_ha_a->h_trans_amt;
				 p_fccredit_ind += l_pro_gracctent_struct_ha_a->h_fcy_amt;
         }

			

				if (*p_dct != *p_cct)
				{
            	if (!strcmp(l_pro_gracctent_struct_ha_a->h_db_cr_flag,DEBIT_IND))
					{
							l_pro_gracctent_struct_ha_a->h_trans_amt=l_pro_gracctent_struct_ha_a->h_trans_amt-(*p_dct - *p_cct);
					}
					else
					{
							 l_pro_gracctent_struct_ha_a->h_trans_amt=l_pro_gracctent_struct_ha_a->h_trans_amt+(*p_dct - *p_cct);
					 }
				 }

			

	      if( APL_FAILURE == CO_Upd_IGrAcctEnt(l_pro_gracctent_struct_ha_a,l_debug_info_ptr))
         {
				CO_ProcMonitor(p_logfile,"Returned Unsuccessfully from CM_InsIGRAATENTFn",NULL,NULL);
         	APL_GOBACK_FAIL
      	}
	}
	else 
	{
		
	    memset( l_pro_gracctent_struct_ha_a, NULL, sizeof(PRO_GRACCTENT_STRUCT_H) );

	 	l_pro_gracctent_struct_ha_a->h_module_ind[0]='C';
		l_pro_gracctent_struct_ha_a->h_module_ind[1]='\0';
      strcpy(l_pro_gracctent_struct_ha_a->h_proc_num,p_batch_no);
      strcpy(l_pro_gracctent_struct_ha_a->h_batch_dt,chr_l_sysdate_b);

		/*changes by bageshri for 10G migration */
		l_pro_gracctent_struct_ha_a->h_instr_class[0]=chr_p_typeofinstr;
		l_pro_gracctent_struct_ha_a->h_instr_class[1]='\0';

      strcpy(l_pro_gracctent_struct_ha_a->h_rec_class,DL_REC_DET);
		l_pro_gracctent_struct_ha_a->h_status_ind[0]=AE_GEN_IND_CHAR;
      l_pro_gracctent_struct_ha_a->h_status_ind[1]='\0';


		if(!strcmp(chr_l_h_trd_typeofinstr,TYPEOFINSTR_FMT))
         strcpy(l_pro_gracctent_struct_ha_a->h_entry,TYPEOFINSTR_BOND);
      else if ((!strcmp(chr_l_h_trd_typeofinstr,TYPOF_INSTR_SHS)) || (!strcmp(chr_l_h_trd_typeofinstr,DEALCD_RTS)))
         strcpy(l_pro_gracctent_struct_ha_a->h_entry,TYPOF_INSTR_SHS);
      else
         strcpy(l_pro_gracctent_struct_ha_a->h_entry,TYPEOFINSTR_BOND);
		
		 if (VAL_FREE_DEAL(chr_l_h_trd_trcode[0]))
			strcpy(l_pro_gracctent_struct_ha_a->h_dl_client,chr_l_h_citibank_glaccount);
		else 
		{
			if (!strcmp(chr_l_h_trd_cashclient,APL_NULL_STRING))
			{
	   		strcpy(l_pro_gracctent_struct_ha_a->h_dl_client,chr_l_h_trd_glclient);
			}
			else
			{
				strcpy(l_pro_gracctent_struct_ha_a->h_dl_client,chr_l_h_trd_cashclient);
			}
		}

		if (VAL_VP_DEAL(chr_l_h_trd_trcode[0]))
		{
			
			
         
         if ( (int_l_periodflg != 2) && (int_l_periodflg != 3 ) )
			{
				l_pro_gracctent_struct_ha_a->h_trans_amt =l_round2_trd_amount*100;
				strcpy(l_pro_gracctent_struct_ha_a->h_currencycode,chr_l_h_trd_ccycode);
			}
			else
			{
				
				l_grd_amount = 0.0;
            
            if (int_l_periodflg == 3)
               {
                 l_grd_amount = 0.0;
                 CO_Round((l_round2_trd_amount/l_ae_rate1), 2, &l_grd_amount);
                 l_pro_gracctent_struct_ha_a->h_trans_amt=l_grd_amount*100;
               }
            else
              {
               CO_Round(l_round2_trd_amount*l_ae_rate, 2, &l_grd_amount);
               l_pro_gracctent_struct_ha_a->h_trans_amt = l_grd_amount*100;
              }
				strcpy(l_pro_gracctent_struct_ha_a->h_currencycode,CCY_EUR_IND);
				
			}
			strcpy(l_pro_gracctent_struct_ha_a->h_value_date,chr_l_h_trd_moneydt);
		}
		else
		{
			
			if (int_l_periodflg == 1)
			{
				l_pro_gracctent_struct_ha_a->h_trans_amt = 100;
			   strcpy(l_pro_gracctent_struct_ha_a->h_currencycode,CCY_GRD_IND);
				
	      } 
         
         else if (int_l_periodflg == 3)
         {
            l_pro_gracctent_struct_ha_a->h_trans_amt = 1;
            strcpy(l_pro_gracctent_struct_ha_a->h_currencycode,CCY_EUR_IND);
         }
         else
         {
            l_pro_gracctent_struct_ha_a->h_trans_amt = 300;
            strcpy(l_pro_gracctent_struct_ha_a->h_currencycode,CCY_EUR_IND);
         }
         strcpy(l_pro_gracctent_struct_ha_a->h_value_date,chr_l_sysdate_b);
      }
		
		if (VAL_RECDEAL(chr_l_h_trd_trcode[0]))
		{
		 	strcpy(l_pro_gracctent_struct_ha_a->h_db_cr_flag,DEBIT_IND);
		}
		else
		{
	  		 strcpy(l_pro_gracctent_struct_ha_a->h_db_cr_flag,CREDIT_IND_B);
		}

	   if(!strcmp(chr_l_h_trd_domcpac,l_mt_core_sys_params_struct_h.custody_clt_cd))
      {
         if(!strcmp(l_pro_gracctent_struct_ha_a->h_db_cr_flag,DEBIT_IND))
				strcpy(l_pro_gracctent_struct_ha_a->h_deal_cd,DEALCD_215); 
			else
				strcpy(l_pro_gracctent_struct_ha_a->h_deal_cd, DEALCD_267);
		}

		else if(!strcmp(l_pro_gracctent_struct_ha_a->h_db_cr_flag,DEBIT_IND))
			strcpy(l_pro_gracctent_struct_ha_a->h_deal_cd,DEALCD_215);
		else
			strcpy(l_pro_gracctent_struct_ha_a->h_deal_cd, DEALCD_267);	

	
	   strcpy(l_pro_gracctent_struct_ha_a->h_splgr_clt_cd,chr_l_h_trd_glclient);
		if(!strcmp(chr_l_h_trd_typeofinstr,TYPEOFINSTR_FMT))
			strcpy(l_pro_gracctent_struct_ha_a->h_statistic,"0001");
		else
			strcpy(l_pro_gracctent_struct_ha_a->h_statistic,"0000");

		if(!strcmp(chr_l_h_cdom,CCY_GRD_IND))
			strcpy(l_pro_gracctent_struct_ha_a->h_trans_bog,"00000");
		else
		{
			strncpy(l_pro_gracctent_struct_ha_a->h_trans_bog,chr_l_h_trd_brokerno,5);
			l_pro_gracctent_struct_ha_a->h_trans_bog[5]='\0';
		}
	   if((!strcmp(chr_l_h_cdom,CCY_GRD_IND)) || (!strcmp(chr_l_h_trd_typeofinstr,TYPEOFINSTR_FMT)))
         l_pro_gracctent_struct_ha_a->h_quantity_items = 0;
      else
      {
         l_pro_gracctent_struct_ha_a->h_quantity_items =l_round2_trd_quantity;
		}
		if(!strcmp(chr_l_h_cdom,CCY_GRD_IND))
			strcpy(l_pro_gracctent_struct_ha_a->h_offset_client,"0000000000");
		else if (VAL_FREE_DEAL(chr_l_h_trd_trcode[0]))
		{
			strcpy(l_pro_gracctent_struct_ha_a->h_offset_client,chr_l_h_citibank_glaccount);
		}
		else
		{
			strcpy(l_pro_gracctent_struct_ha_a->h_offset_client,chr_l_h_domcpac_glaccount);
		}
		
		if(!strcmp(chr_l_h_cdom,CCY_GRD_IND))
			strcpy(l_pro_gracctent_struct_ha_a->h_broker_cd,"00000");
		else
		{
			strncpy(l_pro_gracctent_struct_ha_a->h_broker_cd,chr_l_h_domcpac_vtbaccount,5);
			l_pro_gracctent_struct_ha_a->h_broker_cd[5]='\0';
		}	
      if(!strcmp(chr_l_h_cdom,CCY_GRD_IND))
		{
			strcpy(l_pro_gracctent_struct_ha_a->h_nationality,APL_NULL_STRING);
			strcpy(l_pro_gracctent_struct_ha_a->h_instr_isin,APL_NULL_STRING);
		}
		else 
		{
			strcpy(l_pro_gracctent_struct_ha_a->h_nationality,chr_l_h_cdom);  
			strcpy(l_pro_gracctent_struct_ha_a->h_instr_isin,chr_l_h_isin);
		}
      strcpy(l_pro_gracctent_struct_ha_a->h_special_tax,APL_NULL_STRING); 
      strcpy(l_pro_gracctent_struct_ha_a->h_indentity_no,"0000000000");
      strcpy(l_pro_gracctent_struct_ha_a->h_auto_rec_flag,"0000000000");
      strcpy(l_pro_gracctent_struct_ha_a->h_note_a,chr_l_newtext1);	
      strcpy(l_pro_gracctent_struct_ha_a->h_note_b,chr_l_newtext2);	 
      
      if ( (int_l_periodflg != 2) && (int_l_periodflg != 3) )
		{
      	l_pro_gracctent_struct_ha_a->h_fcy_amt = 0;
         l_pro_gracctent_struct_ha_a->h_rt = 0;
		}
      else
		{
			if(VAL_FREE_DEAL(chr_l_h_trd_trcode[0]))
         {
            
            if (int_l_periodflg ==1)
            {
               l_pro_gracctent_struct_ha_a->h_fcy_amt = 0;
               l_pro_gracctent_struct_ha_a->h_rt = l_doub_exchgrt;
            }
            else if (int_l_periodflg == 3)
            {
               l_pro_gracctent_struct_ha_a->h_fcy_amt = 0;
               l_pro_gracctent_struct_ha_a->h_rt=0;
            }
            else
            {
               l_pro_gracctent_struct_ha_a->h_fcy_amt = 1;
               l_pro_gracctent_struct_ha_a->h_rt = l_doub_exchgrt;
            }

         }
			else
         {
            
            if (int_l_periodflg == 3)
               {
                 if ( strcmp(chr_l_ccycode, CCY_EUR_IND) == 0 )
                    {
                      l_pro_gracctent_struct_ha_a->h_fcy_amt=0;
                      l_pro_gracctent_struct_ha_a->h_rt=0;
                    }
                 else
                    {
                      if ( strcmp(chr_l_ccycode, CCY_GRD_IND) == 0 )
                         {
                           
                           l_pro_gracctent_struct_ha_a->h_fcy_amt=0;
                           l_pro_gracctent_struct_ha_a->h_rt=0;
                         }
                      else
                         {
                           CO_Round(((l_round2_trd_amount*l_ae_rate)/l_ae_rate1), 2, &l_grd_amount);
                           l_pro_gracctent_struct_ha_a->h_fcy_amt=l_grd_amount*100;
                           l_pro_gracctent_struct_ha_a->h_rt=l_doub_exchgrt;
                         }
                    }
               }
            else
              {
                l_pro_gracctent_struct_ha_a->h_fcy_amt = l_round2_trd_amount*100;
                l_pro_gracctent_struct_ha_a->h_rt=l_doub_exchgrt;
              }
			}
				
		}

      l_pro_gracctent_struct_ha_a->h_mis_sprd = 0; 

      

      strcpy(l_pro_gracctent_struct_ha_a->h_safekeep_pos,"0");
		i_runsequence=*p_runseq;
		chr_l_str_runseq=ltoa((long)i_runsequence);
     
      if(strlen(chr_l_str_runseq) != 5)
      {
         int_retval = CO_PadString(chr_l_str_runseq,'L',5,"0",l_debug_info_ptr);
         if(int_retval == APL_FAILURE)
         	APL_GOBACK_FAIL
       }
       strcpy(l_pro_gracctent_struct_ha_a->h_sequence,chr_l_str_runseq);


      strcpy(l_pro_gracctent_struct_ha_a->h_reas_cd,APL_NULL_STRING);

       
        sprintf(l_pro_gracctent_struct_ha_a->h_deal_ident,"%s^%s",chr_l_h_trd_client,chr_l_h_trd_refno);

	   if( APL_FAILURE == CO_Upd_IGrAcctEnt(l_pro_gracctent_struct_ha_a,l_debug_info_ptr))
      {
			CO_ProcMonitor(p_logfile,"Returned Unsuccessfully from CM_InsIGRAATENTFn",NULL,NULL);
         APL_GOBACK_FAIL
      }
      else
      {
         (*p_runseq)++;
         if (!strcmp(l_pro_gracctent_struct_ha_a->h_db_cr_flag,DEBIT_IND))
         {
            *p_dct += l_pro_gracctent_struct_ha_a->h_trans_amt;
				p_fdcredit_ind += l_pro_gracctent_struct_ha_a->h_fcy_amt;

         }
         else
         {
            *p_cct += l_pro_gracctent_struct_ha_a->h_trans_amt;
				p_fccredit_ind += l_pro_gracctent_struct_ha_a->h_fcy_amt;
         }
      }




	  memset( l_pro_gracctent_struct_ha_a, NULL, sizeof(PRO_GRACCTENT_STRUCT_H) );

	
		l_pro_gracctent_struct_ha_a->h_module_ind[0]='C';
	   l_pro_gracctent_struct_ha_a->h_module_ind[1]='\0';
      strcpy(l_pro_gracctent_struct_ha_a->h_proc_num,p_batch_no);
      strcpy(l_pro_gracctent_struct_ha_a->h_batch_dt,chr_l_sysdate_b);

		/*changes by bageshri for 10G migration */
      l_pro_gracctent_struct_ha_a->h_instr_class[0]=chr_p_typeofinstr;
		l_pro_gracctent_struct_ha_a->h_instr_class[1]='\0';
		
      strcpy(l_pro_gracctent_struct_ha_a->h_rec_class,DL_REC_DET);
		l_pro_gracctent_struct_ha_a->h_status_ind[0]=AE_GEN_IND_CHAR;
      l_pro_gracctent_struct_ha_a->h_status_ind[1]='\0';


  	   if(!strcmp(chr_l_h_trd_typeofinstr,TYPEOFINSTR_FMT))
         strcpy(l_pro_gracctent_struct_ha_a->h_entry,TYPEOFINSTR_BOND);
      else if ((!strcmp(chr_l_h_trd_typeofinstr,TYPOF_INSTR_SHS)) || (!strcmp(chr_l_h_trd_typeofinstr,DEALCD_RTS)))
         strcpy(l_pro_gracctent_struct_ha_a->h_entry,TYPOF_INSTR_SHS);
      else
         strcpy(l_pro_gracctent_struct_ha_a->h_entry,TYPEOFINSTR_BOND);
		if (VAL_VP_DEAL(chr_l_h_trd_trcode[0]))
			strcpy(l_pro_gracctent_struct_ha_a->h_dl_client,chr_l_h_domcpac_glaccount);
		else
			strcpy(l_pro_gracctent_struct_ha_a->h_dl_client,chr_l_h_citibank_glaccount);
		
		if (VAL_VP_DEAL(chr_l_h_trd_trcode[0]))
		{
			
         

         
         if ( (int_l_periodflg != 2) && (int_l_periodflg != 3 ) )
			{
				l_pro_gracctent_struct_ha_a->h_trans_amt =l_round2_trd_amount*100;
         	strcpy(l_pro_gracctent_struct_ha_a->h_currencycode,chr_l_h_trd_ccycode);
			}
			else
			{
				
				l_grd_amount = 0.0;
           
            if ( int_l_periodflg == 3)
               {
                 CO_Round((l_round2_trd_amount/l_ae_rate1), 2, &l_grd_amount);
               }
            else
                CO_Round(l_round2_trd_amount*l_ae_rate, 2, &l_grd_amount);
				l_pro_gracctent_struct_ha_a->h_trans_amt =l_grd_amount*100;
         	strcpy(l_pro_gracctent_struct_ha_a->h_currencycode,CCY_EUR_IND);
				
			}
			
         strcpy(l_pro_gracctent_struct_ha_a->h_value_date,chr_l_h_trd_moneydt);
		}
      else
		{
		
      

		
			if (int_l_periodflg == 1)
			{
         	l_pro_gracctent_struct_ha_a->h_trans_amt=100;
            strcpy(l_pro_gracctent_struct_ha_a->h_currencycode,CCY_GRD_IND);
			}
          
         else if (int_l_periodflg == 3)
         {
            l_pro_gracctent_struct_ha_a->h_trans_amt=1;
            strcpy(l_pro_gracctent_struct_ha_a->h_currencycode,CCY_EUR_IND);
         }
         else
         {
            l_pro_gracctent_struct_ha_a->h_trans_amt=300;
            strcpy(l_pro_gracctent_struct_ha_a->h_currencycode,CCY_EUR_IND);
         }
         strcpy(l_pro_gracctent_struct_ha_a->h_value_date,chr_l_sysdate_b);
      }

		if (VAL_RECDEAL(chr_l_h_trd_trcode[0]))
			 strcpy(l_pro_gracctent_struct_ha_a->h_db_cr_flag,CREDIT_IND_B);
      else
			 strcpy(l_pro_gracctent_struct_ha_a->h_db_cr_flag,DEBIT_IND);

		if(!strcmp(chr_l_h_trd_domcpac,l_mt_core_sys_params_struct_h.custody_clt_cd))
		{
			if(!strcmp(l_pro_gracctent_struct_ha_a->h_db_cr_flag,DEBIT_IND))
				strcpy(l_pro_gracctent_struct_ha_a->h_deal_cd,DEALCD_215);
			else
				strcpy(l_pro_gracctent_struct_ha_a->h_deal_cd,  DEALCD_267);
		}
		else if(!strcmp(l_pro_gracctent_struct_ha_a->h_db_cr_flag,CREDIT_IND_B))
		{
			strcpy(l_pro_gracctent_struct_ha_a->h_deal_cd, DEALCD_097);
		}
		else
			strcpy(l_pro_gracctent_struct_ha_a->h_deal_cd, DEALCD_047);
      strcpy(l_pro_gracctent_struct_ha_a->h_splgr_clt_cd,chr_l_h_trd_glclient);

	   if(!strcmp(chr_l_h_trd_typeofinstr,TYPEOFINSTR_FMT))
         strcpy(l_pro_gracctent_struct_ha_a->h_statistic,"0001");
      else
         strcpy(l_pro_gracctent_struct_ha_a->h_statistic,"0000");

		if(!strcmp(chr_l_h_cdom2,CCY_GRD_IND))
			strcpy(l_pro_gracctent_struct_ha_a->h_trans_bog,"00000");
		else
		{
			strncpy(l_pro_gracctent_struct_ha_a->h_trans_bog,chr_l_h_trd_brokerno,5);
			l_pro_gracctent_struct_ha_a->h_trans_bog[5]='\0';
		}
		if((!strcmp(chr_l_h_cdom2,CCY_GRD_IND)) || (!strcmp(chr_l_h_trd_typeofinstr,TYPEOFINSTR_FMT)))
      	l_pro_gracctent_struct_ha_a->h_quantity_items = 0;
		else
		
			l_pro_gracctent_struct_ha_a->h_quantity_items = l_round2_trd_quantity;
		if(!strcmp(chr_l_h_cdom2,CCY_GRD_IND))
		{
			strcpy(l_pro_gracctent_struct_ha_a->h_offset_client,"0000000000");
			strcpy(l_pro_gracctent_struct_ha_a->h_broker_cd,"00000");
			strcpy(l_pro_gracctent_struct_ha_a->h_nationality,APL_NULL_STRING);
			strcpy(l_pro_gracctent_struct_ha_a->h_instr_isin,APL_NULL_STRING);
		}
	   else
		{
			

        	strcpy(l_pro_gracctent_struct_ha_a->h_offset_client,chr_l_h_trd_glclient);
			
			strncpy(l_pro_gracctent_struct_ha_a->h_broker_cd,chr_l_h_domcpac_vtbaccount,5);
         l_pro_gracctent_struct_ha_a->h_broker_cd[5]='\0';

			strcpy(l_pro_gracctent_struct_ha_a->h_nationality,chr_l_h_cdom2);
			strcpy(l_pro_gracctent_struct_ha_a->h_instr_isin,chr_l_h_isin);	
		}
      strcpy(l_pro_gracctent_struct_ha_a->h_special_tax,APL_NULL_STRING);  
      strcpy(l_pro_gracctent_struct_ha_a->h_indentity_no,"0000000000");
      strcpy(l_pro_gracctent_struct_ha_a->h_auto_rec_flag,"0000000000");
      strcpy(l_pro_gracctent_struct_ha_a->h_note_a,chr_l_newtext1);	
      strcpy(l_pro_gracctent_struct_ha_a->h_note_b,chr_l_newtext2);	 
      
      if ( (int_l_periodflg != 2) && (int_l_periodflg != 3) )
		{
     		l_pro_gracctent_struct_ha_a->h_fcy_amt = 0;
      	l_pro_gracctent_struct_ha_a->h_rt = 0;
		}
		else
		{
			if(VAL_FREE_DEAL(chr_l_h_trd_trcode[0]))
			{
				if (int_l_periodflg == 1)
				{
					l_pro_gracctent_struct_ha_a->h_fcy_amt = 0;
					l_pro_gracctent_struct_ha_a->h_rt = l_doub_exchgrt;
            }
            
            else if (int_l_periodflg == 3)
               {
                  l_pro_gracctent_struct_ha_a->h_fcy_amt = 0;
                  l_pro_gracctent_struct_ha_a->h_rt=0;
               }
            else
            {
               l_pro_gracctent_struct_ha_a->h_fcy_amt =1;
               l_pro_gracctent_struct_ha_a->h_rt = l_doub_exchgrt;
            }
			}
			else
			{
            
            if (int_l_periodflg == 3)
               {
                 l_grd_amount = 0.0;
                 if ( strcmp(chr_l_ccycode, CCY_EUR_IND) == 0 )
                    {
                     l_pro_gracctent_struct_ha_a->h_fcy_amt=0;
                     l_pro_gracctent_struct_ha_a->h_rt=0;
                    }
                 else
                    {
                      if ( strcmp(chr_l_ccycode, CCY_GRD_IND) == 0 )
                          {
                            
                            l_pro_gracctent_struct_ha_a->h_fcy_amt=0;
                            l_pro_gracctent_struct_ha_a->h_rt=0;
                          }
                      else
                          {
                            CO_Round(((l_round2_trd_amount*l_ae_rate)/l_ae_rate1), 2, &l_grd_amount);
                            l_pro_gracctent_struct_ha_a->h_fcy_amt=l_grd_amount*100;
                            l_pro_gracctent_struct_ha_a->h_rt=l_doub_exchgrt;
                          }
                    }
               }
             else
               {
                l_pro_gracctent_struct_ha_a->h_fcy_amt =l_round2_trd_amount*100;
                l_pro_gracctent_struct_ha_a->h_rt=l_doub_exchgrt;
               }
			}
      	
		}
		
	
      l_pro_gracctent_struct_ha_a->h_mis_sprd = 0; 
      strcpy(l_pro_gracctent_struct_ha_a->h_safekeep_pos,"0");
		i_runsequence=*p_runseq;
		 chr_l_str_runseq=ltoa((long)i_runsequence);
      if(strlen(chr_l_str_runseq) != 5)
      {
         int_retval = CO_PadString(chr_l_str_runseq,'L',5,"0",l_debug_info_ptr);
         if(int_retval == APL_FAILURE)
            APL_GOBACK_FAIL
       }
       strcpy(l_pro_gracctent_struct_ha_a->h_sequence,chr_l_str_runseq);


      strcpy(l_pro_gracctent_struct_ha_a->h_reas_cd,APL_NULL_STRING);
		strcpy(l_pro_gracctent_struct_ha_a->h_deal_ident,APL_NULL_STRING);
		

		


         (*p_runseq)++;
         if (!strcmp(l_pro_gracctent_struct_ha_a->h_db_cr_flag,DEBIT_IND))
         {
            *p_dct += l_pro_gracctent_struct_ha_a->h_trans_amt;
				p_fdcredit_ind += l_pro_gracctent_struct_ha_a->h_fcy_amt;
         }
         else
         {
            *p_cct += l_pro_gracctent_struct_ha_a->h_trans_amt;
				 p_fccredit_ind += l_pro_gracctent_struct_ha_a->h_fcy_amt;
			}

			

				if (*p_dct != *p_cct)
				{
            	if (!strcmp(l_pro_gracctent_struct_ha_a->h_db_cr_flag,DEBIT_IND))
					{
							l_pro_gracctent_struct_ha_a->h_trans_amt=l_pro_gracctent_struct_ha_a->h_trans_amt-(*p_dct - *p_cct);
					}
					else
					{
						  l_pro_gracctent_struct_ha_a->h_trans_amt=l_pro_gracctent_struct_ha_a->h_trans_amt+(*p_dct - *p_cct);
					}
		   	}

			

	      if( APL_FAILURE == CO_Upd_IGrAcctEnt(l_pro_gracctent_struct_ha_a,l_debug_info_ptr))
         {
				CO_ProcMonitor(p_logfile,"Returned Unsuccessfully from CM_InsIGRAATENTFn",NULL,NULL);
         	APL_GOBACK_FAIL
      	}
	}
	RETURN_SUCCESS :

		CO_ProcMonitor(p_logfile,"Exiting Successfully from CDBGenTrdAccFn",NULL,NULL);	

      #ifdef SYS_DEBUG
         printf( "Leaving Function CDBGenTrdAccFn with success\n");
      #endif

      APL_FREE( l_pro_gracctent_struct_ha_a );

      return(APL_SUCCESS);

   RETURN_FAILURE :

      if (APL_SUCCESS == CO_ChkErr(*l_debug_info_ptr))
      {
         CO_ProcMonitor(p_logfile,
                  "Got Errors : ",
                  l_debug_info_ptr,
                  p_intl_envdatastruct_h);
         CO_FreeErrLst(l_debug_info_ptr);
      }

		
		 CO_ProcMonitor(p_logfile,"Exiting Unsuccessfully from CDBGenTrdAccFn",NULL,NULL); 

      #ifdef SYS_DEBUG
         printf( "Leaving Function CDBGenTrdAccFn with errors\n");
      #endif

      APL_FREE( l_pro_gracctent_struct_ha_a );

      return(APL_FAILURE);
}


  



//main(int argc,char **argv)
int main(int argc,char **argv)//Changes done for AIX Migration
{
   struct sqlca sqlca;
   DEBUG_INFO_STRUCT_H *l_debug_info_ptr             =  NULL;
   INTL_ENV_DATA_STRUCT_H l_intl_env_data_h;
   FILE  *l_finifile                      =  NULL;
   FILE  *l_logfile                       =  NULL;
   FILE  *l_repfile                       =  NULL;
   char  chr_l_logfile_name[PATH_LENGTH]      =  APL_NULL_STRING;
   int   int_l_retval                         =  0;
   char  chr_uname[APL_USERID_LEN]            =  APL_NULL_STRING;
   char  chr_custody_id_b[APL_USERID_LEN]           =  APL_NULL_STRING;
   char  chr_passwd[APL_PASSWD_LEN]           =  APL_NULL_STRING;
   char  chr_l_logdir[PATH_LENGTH]            =  APL_NULL_STRING;
   char  chr_l_inifile[PATH_LENGTH]           =  APL_NULL_STRING;
	char  chr_l_acdate[APL_DATE_LEN]   			=  APL_NULL_STRING;
	char  chr_l_typeofinstr[2]                     =  APL_NULL_STRING;
   EXEC SQL VAR chr_uname IS STRING;
   EXEC SQL VAR chr_custody_id_b IS STRING;
   EXEC SQL VAR chr_passwd IS STRING;
	
	int int_num =0;
	char **temp =NULL;
   sqlca.sqlcode = 0;


    strcpy(chr_l_inifile,getenv("INTL_ROOT_PATH"));
    strcat(chr_l_inifile,"intl_sun.cfg");

   if ( ( l_finifile=fopen(chr_l_inifile,"r") ) == NULL)
   {
      APL_GOBACK_FAIL
   }



	  

   APL_FETCH_DB_LOGIN_DETAILS(l_finifile, chr_custody_id_b, chr_uname, chr_passwd, APL_OUT_FILE, &l_debug_info_ptr)

   EXEC SQL CONNECT :chr_uname IDENTIFIED BY :chr_passwd;

   if (sqlca.sqlcode)
   {
      APL_GOBACK_FAIL
   }
   else
   {
      

      if (APL_FAILURE == CO_Rtv_RptFileName( "3B",
                                          APL_LOGFILE_DESC,
                                          100,
                                          argv[5],
                                          argv,
                                          &l_logfile,
                                          &l_debug_info_ptr ) )
      {
         APL_GOBACK_FAIL
      }


      

	 EXEC SQL COMMIT WORK;

      if (sqlca.sqlcode)
      {
         CO_ProcMonitor(l_logfile, "Could not commit after opening chr_log file", NULL, NULL);
         CO_Proc_RptClose(l_logfile, &l_debug_info_ptr);
         APL_GOBACK_FAIL
      }

      

      if (APL_FAILURE == CO_RtvSysParams(&l_debug_info_ptr))
      {
         CO_ProcMonitor(l_logfile, "Error In Getting System Parameters", NULL, NULL);
			CO_PrnErr(l_debug_info_ptr);
         CO_Proc_RptClose(l_logfile, &l_debug_info_ptr);
         APL_GOBACK_FAIL
      }
	
	   

      if (APL_FAILURE == CO_SplitStr( argv[9],
                                       '|',
                                       &int_num,
                                       &temp ))
      {
         CO_ProcMonitor(l_logfile, "Failure from StrSplitFn", NULL, NULL);
         CO_Proc_RptClose(l_logfile, &l_debug_info_ptr);
         APL_GOBACK_FAIL
      }

      if (int_num != 2)
      {
         CO_ProcMonitor(l_logfile, "Improper Number of arguments", NULL, NULL);
         CO_ProcMonitor(l_logfile, argv[0], NULL, NULL);
         CO_ProcMonitor(l_logfile, argv[1], NULL, NULL);
         CO_ProcMonitor(l_logfile, argv[2], NULL, NULL);
         CO_ProcMonitor(l_logfile, argv[3], NULL, NULL);
         CO_ProcMonitor(l_logfile, argv[4], NULL, NULL);
         CO_ProcMonitor(l_logfile, argv[5], NULL, NULL);
         CO_ProcMonitor(l_logfile, argv[6], NULL, NULL);
         CO_ProcMonitor(l_logfile, argv[7], NULL, NULL);
         CO_ProcMonitor(l_logfile, argv[8], NULL, NULL);
         CO_ProcMonitor(l_logfile, argv[9], NULL, NULL);
         CO_Proc_RptClose(l_logfile, &l_debug_info_ptr);
         APL_GOBACK_FAIL
      }

		strcpy(chr_l_acdate, temp[0]);
      strcpy(chr_l_typeofinstr, temp[1]);


      

      strcpy(l_intl_env_data_h.usr, argv[3]);
      strcpy(l_intl_env_data_h.h_mode, argv[4]);
      strcpy(l_intl_env_data_h.processtion, argv[5]);
      strcpy(l_intl_env_data_h.auth_req, argv[6]);
      strcpy(l_intl_env_data_h.subprocess, argv[7]);
      strcpy(l_intl_env_data_h.h_process, argv[8]);


      

      CO_ProcMonitor(l_logfile, "Calling CDBGenGrAccFn", NULL, NULL);

      int_l_retval = CDBGenGrAccFn(  chr_l_acdate,
											chr_l_typeofinstr[0],
										   argv,
                                 l_repfile,
                                 l_logfile,
                                 &l_intl_env_data_h,
                                 &l_debug_info_ptr);

      CO_ProcMonitor(l_logfile, "Returned from CDBGenGrAccFn", NULL, NULL);

      if ( int_l_retval == APL_FAILURE )
      {
         CO_ProcMonitor(l_logfile, "CDBGenGrAccFn returned failure; ROLLING BACK", NULL, NULL);
         CO_Proc_RptClose(l_logfile, &l_debug_info_ptr);
         EXEC SQL ROLLBACK WORK RELEASE;
         APL_GOBACK_FAIL

		  }
      else
      {
         EXEC SQL UPDATE SYS_BATCHPROC
         SET  status = 'completed'
         WHERE PROCESS_NAME=:argv[0]
         AND   PROC_INIT=:argv[1]
         AND   STARTDATE=:argv[2]
         AND   STATUS='started';

         EXEC SQL COMMIT WORK RELEASE;
         CO_Proc_RptClose(l_logfile, &l_debug_info_ptr);
         APL_GOBACK_SUCCESS
      }
   }
	
	fclose (l_finifile);

   RETURN_SUCCESS:exit(0);

   RETURN_FAILURE : exit(-1);
}
